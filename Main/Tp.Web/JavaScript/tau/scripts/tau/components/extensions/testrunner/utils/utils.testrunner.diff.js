define([],function(){var toString=Object.prototype.toString,hasOwn=Object.prototype.hasOwnProperty,diff=function(){function diff(o,n){var ns={},os={};for(var i=0;i<n.length;i++)ns[n[i]]==null&&(ns[n[i]]={rows:[],o:null}),ns[n[i]].rows.push(i);for(var i=0;i<o.length;i++)os[o[i]]==null&&(os[o[i]]={rows:[],n:null}),os[o[i]].rows.push(i);for(var i in ns){if(!hasOwn.call(ns,i))continue;ns[i].rows.length==1&&typeof os[i]!="undefined"&&os[i].rows.length==1&&(n[ns[i].rows[0]]={text:n[ns[i].rows[0]],row:os[i].rows[0]},o[os[i].rows[0]]={text:o[os[i].rows[0]],row:ns[i].rows[0]})}for(var i=0;i<n.length-1;i++)n[i].text!=null&&n[i+1].text==null&&n[i].row+1<o.length&&o[n[i].row+1].text==null&&n[i+1]==o[n[i].row+1]&&(n[i+1]={text:n[i+1],row:n[i].row+1},o[n[i].row+1]={text:o[n[i].row+1],row:i+1});for(var i=n.length-1;i>0;i--)n[i].text!=null&&n[i-1].text==null&&n[i].row>0&&o[n[i].row-1].text==null&&n[i-1]==o[n[i].row-1]&&(n[i-1]={text:n[i-1],row:n[i].row-1},o[n[i].row-1]={text:o[n[i].row-1],row:i-1});return{o:o,n:n}}return function(o,n){o=o.replace(/\s+$/,""),n=n.replace(/\s+$/,"");var out=diff(o==""?[]:o.split(/\s+/),n==""?[]:n.split(/\s+/)),str="",oSpace=o.match(/\s+/g);oSpace==null?oSpace=[" "]:oSpace.push(" ");var nSpace=n.match(/\s+/g);nSpace==null?nSpace=[" "]:nSpace.push(" ");if(out.n.length==0)for(var i=0;i<out.o.length;i++)str+="<del>"+out.o[i]+oSpace[i]+"</del>";else{if(out.n[0].text==null)for(n=0;n<out.o.length&&out.o[n].text==null;n++)str+="<del>"+out.o[n]+oSpace[n]+"</del>";for(var i=0;i<out.n.length;i++)if(out.n[i].text==null)str+="<ins>"+out.n[i]+nSpace[i]+"</ins>";else{var pre="";for(n=out.n[i].row+1;n<out.o.length&&out.o[n].text==null;n++)pre+="<del>"+out.o[n]+oSpace[n]+"</del>";str+=" "+out.n[i].text+nSpace[i]+pre}}return str}}();return diff})