/**
 * Sinon core utilities. For internal use only.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Spy functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Stub functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Mock functions.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Collections of stubs, spies and mocks.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Fake timer API
 * setTimeout
 * setInterval
 * clearTimeout
 * clearInterval
 * tick
 * reset
 * Date
 *
 * Inspired by jsUnitMockTimeOut from JsUnit
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Minimal Event interface implementation
 *
 * Original implementation by Sven Fuchs: https://gist.github.com/995028
 * Modifications and tests by Christian Johansen.
 *
 * @author Sven Fuchs (svenfuchs@artweb-design.de)
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2011 Sven Fuchs, Christian Johansen
 */
/**
 * Fake XMLHttpRequest object
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * The Sinon "server" mimics a web server that receives requests from
 * sinon.FakeXMLHttpRequest and provides an API to respond to those requests,
 * both synchronously and asynchronously. To respond synchronuously, canned
 * answers have to be provided upfront.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Add-on for sinon.fakeServer that automatically handles a fake timer along with
 * the FakeXMLHttpRequest. The direct inspiration for this add-on is jQuery
 * 1.3.x, which does not use xhr object's onreadystatehandler at all - instead,
 * it polls the object for completion with setInterval. Dispite the direct
 * motivation, there is nothing jQuery-specific in this file, so it can be used
 * in any environment where the ajax implementation depends on setInterval or
 * setTimeout.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Manages fake collections as well as fake utilities such as Sinon's
 * timers and fake XHR implementation in one convenient object.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Test function, sandboxes fakes
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Test case, sandboxes all test functions
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
/**
 * Assertions matching the test spy retrieval interface.
 *
 * @author Christian Johansen (christian@cjohansen.no)
 * @license BSD
 *
 * Copyright (c) 2010-2011 Christian Johansen
 */
var sinon=function(){var buster=function(a,b){function c(a){if(!a)return;for(var b=1,c=arguments.length,d;b<c;++b)for(d in arguments[b])a[d]=arguments[b][d];return a}var d=typeof document!="undefined"&&document.createElement("div");return c(a,{bind:function(a,b){var c=typeof b=="string"?a[b]:b,d=Array.prototype.slice.call(arguments,2);return function(){var b=d.concat(Array.prototype.slice.call(arguments));return c.apply(a,b)}},create:function(){function a(){}return function(c){return a.prototype=c,new a}}(),extend:c,nextTick:function(a){if(typeof process!="undefined"&&process.nextTick)return process.nextTick(a);b(a,0)},functionName:function(a){if(!a)return"";if(a.displayName)return a.displayName;if(a.name)return a.name;var b=a.toString().match(/function\s+([^\(]+)/m);return b&&b[1]||""},isNode:function(a){if(!d)return!1;try{a.appendChild(d),a.removeChild(d)}catch(b){return!1}return!0},isElement:function(b){return b&&a.isNode(b)&&b.nodeType===1}})}(buster||{},setTimeout);buster.format=buster.format||{},buster.format.excludeConstructors=["Object",/^.$/],buster.format.quoteStrings=!0,buster.format.ascii=function(){function a(a){var b=Object.keys&&Object.keys(a)||[];if(b.length==0)for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b.sort()}function b(a,b){if(typeof a!="object")return!1;for(var c=0,d=b.length;c<d;++c)if(b[c]===a)return!0;return!1}function c(a,d,e){if(typeof a=="string"){var f=typeof this.quoteStrings!="boolean"||this.quoteStrings;return d||f?'"'+a+'"':a}return typeof a!="function"||a instanceof RegExp?(d=d||[],b(a,d)?"[Circular]":Object.prototype.toString.call(a)=="[object Array]"?c.array(a):a?buster.isElement(a)?c.element(a):a.toString!==Object.prototype.toString?a.toString():c.object.call(this,a,d,e):""+a):c.func(a)}return c.func=function(a){return"function "+buster.functionName(a)+"() {}"},c.array=function(a,b){b=b||[],b.push(a);var d=[];for(var e=0,f=a.length;e<f;++e)d.push(c(a[e],b));return"["+d.join(", ")+"]"},c.object=function(d,e,f){e=e||[],e.push(d),f=f||0;var g=[],h=a(d),i,j,k,l="",m=3;for(var n=0,o=f;n<o;++n)l+=" ";for(n=0,o=h.length;n<o;++n)i=h[n],k=d[i],b(k,e)?j="[Circular]":j=c.call(this,k,e,f+2),j=(/\s/.test(i)?'"'+i+'"':i)+": "+j,m+=j.length,g.push(j);var p=c.constructorName.call(this,d),q=p?"["+p+"] ":"";return m+f>80?q+"{\n  "+l+g.join(",\n  "+l)+"\n"+l+"}":q+"{ "+g.join(", ")+" }"},c.element=function(a){var b=a.tagName.toLowerCase(),c=a.attributes,d,e=[],f;for(var g=0,h=c.length;g<h;++g){d=c.item(g),f=d.nodeName.toLowerCase().replace("html:","");if(f=="contenteditable"&&d.nodeValue=="inherit")continue;!d.nodeValue||e.push(f+'="'+d.nodeValue+'"')}var i="<"+b+(e.length>0?" ":""),j=a.innerHTML;j.length>20&&(j=j.substr(0,20)+"[...]");var k=i+e.join(" ")+">"+j+"</"+b+">";return k.replace(/ contentEditable="inherit"/,"")},c.constructorName=function(a){var b=buster.functionName(a&&a.constructor),c=this.excludeConstructors||buster.format.excludeConstructors||[];for(var d=0,e=c.length;d<e;++d){if(typeof c[d]=="string"&&c[d]==b)return"";if(c[d].test&&c[d].test(b))return""}return b},c}(),typeof module!="undefined"&&(module.exports=buster.format);var sinon=function(a){function d(a){var c=!1;try{a.appendChild(b),c=b.parentNode==a}catch(d){return!1}finally{try{a.removeChild(b)}catch(d){}}return c}function e(a){return b&&a&&a.nodeType===1&&d(a)}function f(a,b){for(var d in b)c.call(a,d)||(a[d]=b[d])}var b=typeof document!="undefined"&&document.createElement("div"),c=Object.prototype.hasOwnProperty,g={wrapMethod:function(b,d,e){if(!b)throw new TypeError("Should wrap property of object");if(typeof e!="function")throw new TypeError("Method wrapper should be function");var g=b[d],h=typeof g;if(h!="function")throw new TypeError("Attempted to wrap "+h+" property "+d+" as function");if(g.restore&&g.restore.sinon)throw new TypeError("Attempted to wrap "+d+" which is already wrapped");if(g.calledBefore){var i=g.returns?"stubbed":"spied on";throw new TypeError("Attempted to wrap "+d+" which is already "+i)}var j=c.call(b,d);return b[d]=e,e.displayName=d,e.restore=function(){j?b[d]=g:delete b[d]},e.restore.sinon=!0,f(e,g),e},extend:function(b){for(var c=1,d=arguments.length;c<d;c+=1)for(var e in arguments[c])arguments[c].hasOwnProperty(e)&&(b[e]=arguments[c][e]),arguments[c].hasOwnProperty("toString")&&arguments[c].toString!=b.toString&&(b.toString=arguments[c].toString);return b},create:function(b){var c=function(){};return c.prototype=b,new c},deepEqual:function l(a,b){if(typeof a!="object"||typeof b!="object")return a===b;if(e(a)||e(b))return a===b;if(a===b)return!0;var c=Object.prototype.toString.call(a);if(c!=Object.prototype.toString.call(b))return!1;if(c=="[object Array]"){if(a.length!==b.length)return!1;for(var d=0,f=a.length;d<f;d+=1)if(!l(a[d],b[d]))return!1;return!0}var g,h=0,i=0;for(g in a){h+=1;if(!l(a[g],b[g]))return!1}for(g in b)i+=1;return h!=i?!1:!0},functionName:function(b){var c=b.displayName||b.name;if(!c){var d=b.toString().match(/function ([^\s\(]+)/);c=d&&d[1]}return c},functionToString:function m(){if(this.getCall&&this.callCount){var a,b,c=this.callCount;while(c--){a=this.getCall(c).thisValue;for(b in a)if(a[b]===this)return b}}return this.displayName||"sinon fake"},getConfig:function(a){var b={};a=a||{};var c=g.defaultConfig;for(var d in c)c.hasOwnProperty(d)&&(b[d]=a.hasOwnProperty(d)?a[d]:c[d]);return b},format:function(a){return""+a},defaultConfig:{injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},timesInWords:function(b){return b==1&&"once"||b==2&&"twice"||b==3&&"thrice"||(b||0)+" times"},calledInOrder:function(a){for(var b=1,c=a.length;b<c;b++)if(!a[b-1].calledBefore(a[b]))return!1;return!0},orderByFirstCall:function(a){return a.sort(function(a,b){var c=a.getCall(0),d=b.getCall(0),e=c&&c.callId||-1,f=d&&d.callId||-1;return e<f?-1:1})},log:function(){},logError:function(a,b){var c=a+" threw exception: ";g.log(c+"["+b.name+"] "+b.message),b.stack&&g.log(b.stack),setTimeout(function(){throw b.message=c+b.message,b},0)}},h=!1;if(h){try{a={format:require("buster-format")}}catch(i){}module.exports=g,module.exports.spy=require("./sinon/spy"),module.exports.stub=require("./sinon/stub"),module.exports.mock=require("./sinon/mock"),module.exports.collection=require("./sinon/collection"),module.exports.assert=require("./sinon/assert"),module.exports.sandbox=require("./sinon/sandbox"),module.exports.test=require("./sinon/test"),module.exports.testCase=require("./sinon/test_case"),module.exports.assert=require("./sinon/assert")}if(a){var j=g.create(a.format);j.quoteStrings=!1,g.format=function(){return j.ascii.apply(j,arguments)}}else if(h)try{var k=require("util");g.format=function(a){return typeof a=="object"?k.inspect(a):a}}catch(i){}return g}(typeof buster=="object"&&buster);(function(a){function g(b,c){if(!c&&typeof b=="function")return g.create(b);if(!b||!c)return g.create(function(){});var d=b[c];return a.wrapMethod(b,c,g.create(d))}var b=typeof module=="object"&&typeof require=="function",c,d=0,e=[].push,f=Array.prototype.slice;!a&&b&&(a=require("../sinon"));if(!a)return;a.extend(g,function(){function b(a,b,c,d,e){a[b]=function(){if(!this.called)return e?e.apply(this,arguments):!1;var a,f=0;for(var g=0,h=this.callCount;g<h;g+=1){a=this.getCall(g);if(a[d||b].apply(a,arguments)){f+=1;if(c)return!0}}return f===this.callCount}}function h(a,b,c){if(!a)return;var d=b.length;for(var e=0,f=a.length;e<f;e++)if(a[e].matches(b,c))return a[e]}var i=0,j={reset:function(){this.called=!1,this.calledOnce=!1,this.calledTwice=!1,this.calledThrice=!1,this.callCount=0,this.firstCall=null,this.secondCall=null,this.thirdCall=null,this.lastCall=null,this.args=[],this.returnValues=[],this.thisValues=[],this.exceptions=[],this.callIds=[]},create:function(c){function e(){return e.invoke(c,this,f.call(arguments))}var d;return typeof c!="function"?c=function(){}:d=a.functionName(c),a.extend(e,g),delete e.create,a.extend(e,c),e.reset(),e.prototype=c.prototype,e.displayName=d||"spy",e.toString=a.functionToString,e._create=a.spy.create,e.id="spy#"+i++,e},invoke:function(b,c,f){var g=h(this.fakes,f),i,j;this.called=!0,this.callCount+=1,this.calledOnce=this.callCount==1,this.calledTwice=this.callCount==2,this.calledThrice=this.callCount==3,e.call(this.thisValues,c),e.call(this.args,f),e.call(this.callIds,d++);try{g?j=g.invoke(b,c,f):j=(this.func||b).apply(c,f)}catch(k){throw e.call(this.returnValues,undefined),i=k,k}finally{e.call(this.exceptions,i)}return e.call(this.returnValues,j),this.firstCall=this.getCall(0),this.secondCall=this.getCall(1),this.thirdCall=this.getCall(2),this.lastCall=this.getCall(this.callCount-1),j},getCall:function(b){return b<0||b>=this.callCount?null:c.create(this,this.thisValues[b],this.args[b],this.returnValues[b],this.exceptions[b],this.callIds[b])},calledBefore:function(b){return this.called?b.called?this.callIds[0]<b.callIds[b.callIds.length-1]:!0:!1},calledAfter:function(b){return!this.called||!b.called?!1:this.callIds[this.callCount-1]>b.callIds[b.callCount-1]},withArgs:function(){var a=f.call(arguments);if(this.fakes){var b=h(this.fakes,a,!0);if(b)return b}else this.fakes=[];var c=this,d=this._create();return d.matchingAguments=a,e.call(this.fakes,d),d.withArgs=function(){return c.withArgs.apply(c,arguments)},d},matches:function(b,c){var d=this.matchingAguments;if(d.length<=b.length&&a.deepEqual(d,b.slice(0,d.length)))return!c||d.length==b.length},printf:function(b){var c=this,d=f.call(arguments,1),e;return(b||"").replace(/%(.)/g,function(b,f){return e=j.formatters[f],typeof e=="function"?e.call(null,c,d):isNaN(parseInt(f),10)?"%"+f:a.format(d[f-1])})}};return b(j,"calledOn",!0),b(j,"alwaysCalledOn",!1,"calledOn"),b(j,"calledWith",!0),b(j,"alwaysCalledWith",!1,"calledWith"),b(j,"calledWithExactly",!0),b(j,"alwaysCalledWithExactly",!1,"calledWithExactly"),b(j,"neverCalledWith",!1,"notCalledWith",function(){return!0}),b(j,"threw",!0),b(j,"alwaysThrew",!1,"threw"),b(j,"returned",!0),b(j,"alwaysReturned",!1,"returned"),b(j,"calledWithNew",!0),b(j,"alwaysCalledWithNew",!1,"calledWithNew"),b(j,"callArg",!1,"callArgWith",function(){throw new Error(this.toString()+" cannot call arg since it was not yet invoked.")}),j.callArgWith=j.callArg,b(j,"yield",!1,"yield",function(){throw new Error(this.toString()+" cannot yield since it was not yet invoked.")}),j.invokeCallback=j.yield,b(j,"yieldTo",!1,"yieldTo",function(a){throw new Error(this.toString()+" cannot yield to '"+a+"' since it was not yet invoked.")}),j.formatters={c:function(b){return a.timesInWords(b.callCount)},n:function(a){return a.toString()},C:function(a){var b=[];for(var c=0,d=a.callCount;c<d;++c)e.call(b,"    "+a.getCall(c).toString());return b.length>0?"\n"+b.join("\n"):""},t:function(b){var c=[];for(var d=0,f=b.callCount;d<f;++d)e.call(c,a.format(b.thisValues[d]));return c.join(", ")},"*":function(a,b){return b.join(", ")}},j}()),c=function(){function b(b,c,d){var e=a.functionName(b)+c;throw d.length&&(e+=" Received ["+f.call(d).join(", ")+"]"),new Error(e)}return{create:function(e,f,g,h,i,j){var k=a.create(c);return delete k.create,k.proxy=e,k.thisValue=f,k.args=g,k.returnValue=h,k.exception=i,k.callId=typeof j=="number"&&j||d++,k},calledOn:function(b){return this.thisValue===b},calledWith:function(){for(var c=0,d=arguments.length;c<d;c+=1)if(!a.deepEqual(arguments[c],this.args[c]))return!1;return!0},calledWithExactly:function(){return arguments.length==this.args.length&&this.calledWith.apply(this,arguments)},notCalledWith:function(){for(var c=0,d=arguments.length;c<d;c+=1)if(!a.deepEqual(arguments[c],this.args[c]))return!0;return!1},returned:function(b){return this.returnValue===b},threw:function(b){return typeof b=="undefined"||!this.exception?!!this.exception:typeof b=="string"?this.exception.name==b:this.exception===b},calledWithNew:function(b){return this.thisValue instanceof this.proxy},calledBefore:function(a){return this.callId<a.callId},calledAfter:function(a){return this.callId>a.callId},callArg:function(a){this.args[a]()},callArgWith:function(a){var b=f.call(arguments,1);this.args[a].apply(null,b)},yield:function(){var a=this.args;for(var c=0,d=a.length;c<d;++c)if(typeof a[c]=="function"){a[c].apply(null,f.call(arguments));return}b(this.proxy," cannot yield since no callback was passed.",a)},yieldTo:function(a){var c=this.args;for(var d=0,e=c.length;d<e;++d)if(c[d]&&typeof c[d][a]=="function"){c[d][a].apply(null,f.call(arguments,1));return}b(this.proxy," cannot yield to '"+a+"' since no callback was passed.",c)},toString:function(){var b=this.proxy.toString()+"(",c=[];for(var d=0,f=this.args.length;d<f;++d)e.call(c,a.format(this.args[d]));return b=b+c.join(", ")+")",typeof this.returnValue!="undefined"&&(b+=" => "+a.format(this.returnValue)),this.exception&&(b+=" !"+this.exception.name,this.exception.message&&(b+="("+this.exception.message+")")),b}}}(),g.spyCall=c,a.spyCall=c,b?module.exports=g:a.spy=g})(typeof sinon=="object"&&sinon||null),function(a){function c(b,d,e){if(!e||typeof e=="function"){var f;e?f=a.spy&&a.spy.create?a.spy.create(e):e:f=c.create();if(!b&&!d)return a.stub.create();if(!d&&!!b&&typeof b=="object"){for(var g in b)typeof b[g]=="function"&&c(b,g);return b}return a.wrapMethod(b,d,f)}throw new TypeError("Custom stub should be function")}function d(a,b){if(a.callArgAt<0){for(var c=0,d=b.length;c<d;++c){if(!a.callArgProp&&typeof b[c]=="function")return b[c];if(a.callArgProp&&b[c]&&typeof b[c][a.callArgProp]=="function")return b[c][a.callArgProp]}return null}return b[a.callArgAt]}function f(b,c,d){if(b.callArgAt<0){var f;return b.callArgProp?f=a.functionName(b)+" expected to yield to '"+b.callArgProp+"', but no object with such a property was passed.":f=a.functionName(b)+" expected to yield, but no callback was passed.",d.length>0&&(f+=" Received ["+e.call(d,", ")+"]"),f}return"argument at index "+b.callArgAt+" is not a function: "+c}function g(a,b){if(typeof a.callArgAt=="number"){var c=d(a,b);if(typeof c!="function")throw new TypeError(f(a,c,b));c.apply(null,a.callbackArguments)}}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("../sinon"));if(!a)return;var e=Array.prototype.join,h=0;a.extend(c,function(){function d(a,b){return typeof a=="string"?(this.exception=new Error(b||""),this.exception.name=a):a?this.exception=a:this.exception=new Error("Error"),this}var b=Array.prototype.slice;return{create:function(){var d=function(){if(d.exception)throw d.exception;return typeof d.returnArgAt=="number"?arguments[d.returnArgAt]:(g(d,arguments),d.returnValue)};d.id="stub#"+h++;var e=d;return d=a.spy.create(d),d.func=e,a.extend(d,c),d._create=a.stub.create,d.displayName="stub",d.toString=a.functionToString,d},returns:function(b){return this.returnValue=b,this},returnsArg:function(b){if(typeof b!="number")throw new TypeError("argument index is not number");return this.returnArgAt=b,this},"throws":d,throwsException:d,callsArg:function(b){if(typeof b!="number")throw new TypeError("argument index is not number");return this.callArgAt=b,this.callbackArguments=[],this},callsArgWith:function(c){if(typeof c!="number")throw new TypeError("argument index is not number");return this.callArgAt=c,this.callbackArguments=b.call(arguments,1),this},yields:function(){return this.callArgAt=-1,this.callbackArguments=b.call(arguments,0),this},yieldsTo:function(a){return this.callArgAt=-1,this.callArgProp=a,this.callbackArguments=b.call(arguments,1),this}}}()),b?module.exports=c:a.stub=c}(typeof sinon=="object"&&sinon||null),function(a){function d(b){return b?d.create(b):a.expectation.create("Anonymous mock")}var b=typeof module=="object"&&typeof require=="function",c=[].push;!a&&b&&(a=require("../sinon"));if(!a)return;a.mock=d,a.extend(d,function(){function b(a,b){if(!a)return;for(var c=0,d=a.length;c<d;c+=1)b(a[c])}return{create:function(c){if(!c)throw new TypeError("object is null");var e=a.extend({},d);return e.object=c,delete e.create,e},expects:function(d){if(!d)throw new TypeError("method is falsy");this.expectations||(this.expectations={},this.proxies=[]);if(!this.expectations[d]){this.expectations[d]=[];var e=this;a.wrapMethod(this.object,d,function(){return e.invokeMethod(d,this,arguments)}),c.call(this.proxies,d)}var f=a.expectation.create(d);return c.call(this.expectations[d],f),f},restore:function(){var c=this.object;b(this.proxies,function(a){typeof c[a].restore=="function"&&c[a].restore()})},verify:function(){var e=this.expectations||{},f=[],g=[];return b(this.proxies,function(a){b(e[a],function(a){a.met()?c.call(g,a.toString()):c.call(f,a.toString())})}),this.restore(),f.length>0&&a.expectation.fail(f.concat(g).join("\n")),!0},invokeMethod:function(d,e,f){var g=this.expectations&&this.expectations[d],h=g&&g.length||0;for(var i=0;i<h;i+=1)if(!g[i].met()&&g[i].allowsCall(e,f))return g[i].apply(e,f);var j=[];for(i=0;i<h;i+=1)c.call(j,"    "+g[i].toString());j.unshift("Unexpected call: "+a.spyCall.toString.call({proxy:d,args:f})),a.expectation.fail(j.join("\n"))}}}());var e=a.timesInWords;a.expectation=function(){function f(a){return a==0?"never called":"called "+e(a)}function g(a){var b=a.minCalls,c=a.maxCalls;if(typeof b=="number"&&typeof c=="number"){var d=e(b);return b!=c&&(d="at least "+d+" and at most "+e(c)),d}return typeof b=="number"?"at least "+e(b):"at most "+e(c)}function h(a){var b=typeof a.minCalls=="number";return!b||a.callCount>=a.minCalls}function i(a){return typeof a.maxCalls!="number"?!1:a.callCount==a.maxCalls}var b=Array.prototype.slice,d=a.spy.invoke;return{minCalls:1,maxCalls:1,create:function(c){var d=a.extend(a.stub.create(),a.expectation);return delete d.create,d.method=c,d},invoke:function(b,c,e){return this.verifyCallAllowed(c,e),d.apply(this,arguments)},atLeast:function(b){if(typeof b!="number")throw new TypeError("'"+b+"' is not number");return this.limitsSet||(this.maxCalls=null,this.limitsSet=!0),this.minCalls=b,this},atMost:function(b){if(typeof b!="number")throw new TypeError("'"+b+"' is not number");return this.limitsSet||(this.minCalls=null,this.limitsSet=!0),this.maxCalls=b,this},never:function(){return this.exactly(0)},once:function(){return this.exactly(1)},twice:function(){return this.exactly(2)},thrice:function(){return this.exactly(3)},exactly:function(b){if(typeof b!="number")throw new TypeError("'"+b+"' is not a number");return this.atLeast(b),this.atMost(b)},met:function(){return!this.failed&&h(this)},verifyCallAllowed:function(c,d){i(this)&&(this.failed=!0,a.expectation.fail(this.method+" already called "+e(this.maxCalls))),"expectedThis"in this&&this.expectedThis!==c&&a.expectation.fail(this.method+" called with "+c+" as thisValue, expected "+this.expectedThis);if(!("expectedArguments"in this))return;(!d||d.length===0)&&a.expectation.fail(this.method+" received no arguments, expected "+this.expectedArguments.join()),d.length<this.expectedArguments.length&&a.expectation.fail(this.method+" received too few arguments ("+d.join()+"), expected "+this.expectedArguments.join()),this.expectsExactArgCount&&d.length!=this.expectedArguments.length&&a.expectation.fail(this.method+" received too many arguments ("+d.join()+"), expected "+this.expectedArguments.join());for(var f=0,g=this.expectedArguments.length;f<g;f+=1)a.deepEqual(this.expectedArguments[f],d[f])||a.expectation.fail(this.method+" received wrong arguments ("+d.join()+"), expected "+this.expectedArguments.join())},allowsCall:function(c,d){if(this.met())return!1;if("expectedThis"in this&&this.expectedThis!==c)return!1;if("expectedArguments"in this){d=d||[];if(d.length<this.expectedArguments.length)return!1;if(this.expectsExactArgCount&&d.length!=this.expectedArguments.length)return!1;for(var e=0,f=this.expectedArguments.length;e<f;e+=1)if(!a.deepEqual(this.expectedArguments[e],d[e]))return!1;return!0}return!0},withArgs:function(){return this.expectedArguments=b.call(arguments),this},withExactArgs:function(){return this.withArgs.apply(this,arguments),this.expectsExactArgCount=!0,this},on:function(b){return this.expectedThis=b,this},toString:function(){var b=(this.expectedArguments||[]).slice();this.expectsExactArgCount||c.call(b,"[...]");var d=a.spyCall.toString.call({proxy:this.method,args:b}),e=d.replace(", [...","[, ...")+" "+g(this);return this.met()?"Expectation met: "+e:"Expected "+e+" ("+f(this.callCount)+")"},verify:function(){return this.met()||a.expectation.fail(this.toString()),!0},fail:function(a){var b=new Error(a);throw b.name="ExpectationError",b}}}(),b?module.exports=d:a.mock=d}(typeof sinon=="object"&&sinon||null),function(a){function d(a){return a.fakes||(a.fakes=[]),a.fakes}function e(a,b){var c=d(a);for(var e=0,f=c.length;e<f;e+=1)typeof c[e][b]=="function"&&c[e][b]()}function f(a){var b=d(a),c=0;while(c<b.length)b.splice(c,1)}var b=typeof module=="object"&&typeof require=="function",c=[].push;!a&&b&&(a=require("../sinon"));if(!a)return;var g={verify:function(){e(this,"verify")},restore:function(){e(this,"restore"),f(this)},verifyAndRestore:function(){var b;try{this.verify()}catch(c){b=c}this.restore();if(b)throw b},add:function(b){return c.call(d(this),b),b},spy:function(){return this.add(a.spy.apply(a,arguments))},stub:function(c,d,e){if(d){var f=c[d];if(typeof f!="function"){if(!c.hasOwnProperty(d))throw new TypeError("Cannot stub non-existent own property "+d);return c[d]=e,this.add({restore:function(){c[d]=f}})}}return this.add(a.stub.apply(a,arguments))},mock:function(){return this.add(a.mock.apply(a,arguments))},inject:function(b){var c=this;return b.spy=function(){return c.spy.apply(c,arguments)},b.stub=function(){return c.stub.apply(c,arguments)},b.mock=function(){return c.mock.apply(c,arguments)},b}};b?module.exports=g:a.collection=g}(typeof sinon=="object"&&sinon||null);if(typeof sinon=="undefined")var sinon={};(function(global){function addTimer(a,b){if(a.length===0)throw new Error("Function requires at least 1 parameter");var c=id++,d=a[1]||0;return this.timeouts||(this.timeouts={}),this.timeouts[c]={id:c,func:a[0],callAt:this.now+d},b===!0&&(this.timeouts[c].interval=d),c}function parseTime(a){if(!a)return 0;var b=a.split(":"),c=b.length,d=c,e=0,f;if(c>3||!/^(\d\d:){0,2}\d\d?$/.test(a))throw new Error("tick only understands numbers and 'h:m:s'");while(d--){f=parseInt(b[d],10);if(f>=60)throw new Error("Invalid time "+a);e+=f*Math.pow(60,c-d-1)}return e*1e3}function createObject(a){var b;if(Object.create)b=Object.create(a);else{var c=function(){};c.prototype=a,b=new c}return b.Date.clock=b,b}function mirrorDateProperties(a,b){return b.now?a.now=function(){return a.clock.now}:delete a.now,b.toSource?a.toSource=function(){return b.toSource()}:delete a.toSource,a.toString=function c(){return b.toString()},a.prototype=b.prototype,a.parse=b.parse,a.UTC=b.UTC,a.prototype.toUTCString=b.prototype.toUTCString,a}function restore(){var a;for(var b=0,c=this.methods.length;b<c;b++)a=this.methods[b],global[a]=this["_"+a]}function stubGlobal(a,b){b["_"+a]=global[a];if(a=="Date"){var c=mirrorDateProperties(b[a],global[a]);global[a]=c}else{global[a]=function(){return b[a].apply(b,arguments)};for(var d in b[a])b[a].hasOwnProperty(d)&&(global[a][d]=b[a][d])}global[a].clock=b}var id=1;sinon.clock={now:0,create:function(b){var c=createObject(this);typeof b=="number"&&(c.now=b);if(!b||typeof b!="object")return c;throw new TypeError("now should be milliseconds since UNIX epoch")},setTimeout:function(b,c){return addTimer.call(this,arguments,!1)},clearTimeout:function(b){this.timeouts||(this.timeouts=[]),delete this.timeouts[b]},setInterval:function(b,c){return addTimer.call(this,arguments,!0)},clearInterval:function(b){this.clearTimeout(b)},tick:function(b){b=typeof b=="number"?b:parseTime(b);var c=this.now,d=this.now+b,e=this.now,f=this.firstTimerInRange(c,d),g;while(f&&c<=d){if(this.timeouts[f.id]){c=this.now=f.callAt;try{this.callTimer(f)}catch(h){g=g||h}}f=this.firstTimerInRange(e,d),e=c}this.now=d;if(g)throw g},firstTimerInRange:function(a,b){var c,d,e;for(var f in this.timeouts)if(this.timeouts.hasOwnProperty(f)){if(this.timeouts[f].callAt<a||this.timeouts[f].callAt>b)continue;if(!d||this.timeouts[f].callAt<d)e=this.timeouts[f],d=this.timeouts[f].callAt,c={func:this.timeouts[f].func,callAt:this.timeouts[f].callAt,interval:this.timeouts[f].interval,id:this.timeouts[f].id}}return c||null},callTimer:function(timer){try{typeof timer.func=="function"?timer.func.call(null):eval(timer.func)}catch(e){var exception=e}if(!this.timeouts[timer.id]){if(exception)throw exception;return}typeof timer.interval=="number"?this.timeouts[timer.id].callAt+=timer.interval:delete this.timeouts[timer.id];if(exception)throw exception},reset:function(){this.timeouts={}},Date:function(){function b(c,d,e,f,g,h,i){switch(arguments.length){case 0:return new a(b.clock.now);case 1:return new a(c);case 2:return new a(c,d);case 3:return new a(c,d,e);case 4:return new a(c,d,e,f);case 5:return new a(c,d,e,f,g);case 6:return new a(c,d,e,f,g,h);default:return new a(c,d,e,f,g,h,i)}}var a=Date;return mirrorDateProperties(b,a)}()};var methods=["Date","setTimeout","setInterval","clearTimeout","clearInterval"];sinon.useFakeTimers=function(b){var c=sinon.clock.create(b);c.restore=restore,c.methods=Array.prototype.slice.call(arguments,typeof b=="number"?1:0),c.methods.length===0&&(c.methods=methods);for(var d=0,e=c.methods.length;d<e;d++)stubGlobal(c.methods[d],c);return c}})(typeof global!="undefined"?global:this),sinon.timers={setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval,Date:Date},typeof module=="object"&&typeof require=="function"&&(module.exports=sinon),typeof sinon=="undefined"&&(this.sinon={}),function(){var a=[].push;sinon.Event=function(b,c,d){this.initEvent(b,c,d)},sinon.Event.prototype={initEvent:function(a,b,c){this.type=a,this.bubbles=b,this.cancelable=c},stopPropagation:function(){},preventDefault:function(){this.defaultPrevented=!0}},sinon.EventTarget={addEventListener:function(c,d,e){this.eventListeners=this.eventListeners||{},this.eventListeners[c]=this.eventListeners[c]||[],a.call(this.eventListeners[c],d)},removeEventListener:function(b,c,d){var e=this.eventListeners&&this.eventListeners[b]||[];for(var f=0,g=e.length;f<g;++f)if(e[f]==c)return e.splice(f,1)},dispatchEvent:function(b){var c=b.type,d=this.eventListeners&&this.eventListeners[c]||[];for(var e=0;e<d.length;e++)typeof d[e]=="function"?d[e].call(this,b):d[e].handleEvent(b);return!!b.defaultPrevented}}}(),typeof sinon=="undefined"&&(this.sinon={}),sinon.xhr={XMLHttpRequest:this.XMLHttpRequest},function(a){function d(){this.readyState=d.UNSENT,this.requestHeaders={},this.requestBody=null,this.status=0,this.statusText="",typeof d.onCreate=="function"&&d.onCreate(this)}function e(a){if(a.readyState!==d.OPENED)throw new Error("INVALID_STATE_ERR");if(a.sendFlag)throw new Error("INVALID_STATE_ERR")}function f(a,b){if(!a)return;for(var c=0,d=a.length;c<d;c+=1)b(a[c])}function g(a,b){for(var c=0;c<a.length;c++)if(b(a[c])===!0)return!0;return!1}function j(a){if(a.readyState==d.DONE)throw new Error("Request done")}function k(a){if(a.async&&a.readyState!=d.HEADERS_RECEIVED)throw new Error("No headers received")}function l(a){if(typeof a!="string"){var b=new Error("Attempted to respond to fake XMLHttpRequest with "+a+", which is not a string.");throw b.name="InvalidBodyException",b}}var b=sinon.xhr;b.GlobalXMLHttpRequest=a.XMLHttpRequest,b.GlobalActiveXObject=a.ActiveXObject,b.supportsActiveX=typeof b.GlobalActiveXObject!="undefined",b.supportsXHR=typeof b.GlobalXMLHttpRequest!="undefined",b.workingXHR=b.supportsXHR?b.GlobalXMLHttpRequest:b.supportsActiveX?function(){return new b.GlobalActiveXObject("MSXML2.XMLHTTP.3.0")}:!1;var c={"Accept-Charset":!0,"Accept-Encoding":!0,Connection:!0,"Content-Length":!0,Cookie:!0,Cookie2:!0,"Content-Transfer-Encoding":!0,Date:!0,Expect:!0,Host:!0,"Keep-Alive":!0,Referer:!0,TE:!0,Trailer:!0,"Transfer-Encoding":!0,Upgrade:!0,"User-Agent":!0,Via:!0},h=function(a,b,c){switch(c.length){case 0:return a[b]();case 1:return a[b](c[0]);case 2:return a[b](c[0],c[1]);case 3:return a[b](c[0],c[1],c[2]);case 4:return a[b](c[0],c[1],c[2],c[3]);case 5:return a[b](c[0],c[1],c[2],c[3],c[4])}};d.filters=[],d.addFilter=function(a){this.filters.push(a)};var i=/MSIE 6/;d.defake=function(a,b){var c=new sinon.xhr.workingXHR;f(["open","setRequestHeader","send","abort","getResponseHeader","getAllResponseHeaders","addEventListener","overrideMimeType","removeEventListener"],function(b){a[b]=function(){return h(c,b,arguments)}});var e=function(b){f(b,function(b){try{a[b]=c[b]}catch(d){if(!i.test(navigator.userAgent))throw d}})},g=function(){a.readyState=c.readyState,c.readyState>=d.HEADERS_RECEIVED&&e(["status","statusText"]),c.readyState>=d.LOADING&&e(["responseText"]),c.readyState===d.DONE&&e(["responseXML"]),a.onreadystatechange&&a.onreadystatechange.call(a)};if(c.addEventListener){for(var j in a.eventListeners)a.eventListeners.hasOwnProperty(j)&&f(a.eventListeners[j],function(a){c.addEventListener(j,a)});c.addEventListener("readystatechange",g)}else c.onreadystatechange=g;h(c,"open",b)},d.useFilters=!1,sinon.extend(d.prototype,sinon.EventTarget,{async:!0,open:function(b,c,e,f,h){this.method=b,this.url=c,this.async=typeof e=="boolean"?e:!0,this.username=f,this.password=h,this.responseText=null,this.responseXML=null,this.requestHeaders={},this.sendFlag=!1;if(sinon.FakeXMLHttpRequest.useFilters===!0){var i=arguments,j=g(d.filters,function(a){return a.apply(this,i)});j&&sinon.FakeXMLHttpRequest.defake(this,arguments)}else this.readyStateChange(d.OPENED)},readyStateChange:function(b){this.readyState=b;if(typeof this.onreadystatechange=="function")try{this.onreadystatechange()}catch(c){sinon.logError("Fake XHR onreadystatechange handler",c)}this.dispatchEvent(new sinon.Event("readystatechange"))},setRequestHeader:function(b,d){e(this);if(c[b]||/^(Sec-|Proxy-)/.test(b))throw new Error('Refused to set unsafe header "'+b+'"');this.requestHeaders[b]?this.requestHeaders[b]+=","+d:this.requestHeaders[b]=d},setResponseHeaders:function(b){this.responseHeaders={};for(var c in b)b.hasOwnProperty(c)&&(this.responseHeaders[c]=b[c]);this.async&&this.readyStateChange(d.HEADERS_RECEIVED)},send:function(b){e(this);if(!/^(get|head)$/i.test(this.method)){if(this.requestHeaders["Content-Type"]){var c=this.requestHeaders["Content-Type"].split(";");this.requestHeaders["Content-Type"]=c[0]+";charset=utf-8"}else this.requestHeaders["Content-Type"]="text/plain;charset=utf-8";this.requestBody=b}this.errorFlag=!1,this.sendFlag=this.async,this.readyStateChange(d.OPENED),typeof this.onSend=="function"&&this.onSend(this)},abort:function(){this.aborted=!0,this.responseText=null,this.errorFlag=!0,this.requestHeaders={},this.readyState>sinon.FakeXMLHttpRequest.UNSENT&&this.sendFlag&&(this.readyStateChange(sinon.FakeXMLHttpRequest.DONE),this.sendFlag=!1),this.readyState=sinon.FakeXMLHttpRequest.UNSENT},getResponseHeader:function(b){if(this.readyState<d.HEADERS_RECEIVED)return null;if(/^Set-Cookie2?$/i.test(b))return null;b=b.toLowerCase();for(var c in this.responseHeaders)if(c.toLowerCase()==b)return this.responseHeaders[c];return null},getAllResponseHeaders:function(){if(this.readyState<d.HEADERS_RECEIVED)return"";var b="";for(var c in this.responseHeaders)this.responseHeaders.hasOwnProperty(c)&&!/^Set-Cookie2?$/i.test(c)&&(b+=c+": "+this.responseHeaders[c]+"\r\n");return b},setResponseBody:function(b){j(this),k(this),l(b);var c=this.chunkSize||10,e=0;this.responseText="";do this.async&&this.readyStateChange(d.LOADING),this.responseText+=b.substring(e,e+c),e+=c;while(e<b.length);var f=this.getResponseHeader("Content-Type");if(this.responseText&&(!f||/(text\/xml)|(application\/xml)|(\+xml)/.test(f)))try{this.responseXML=d.parseXML(this.responseText)}catch(g){}this.async?this.readyStateChange(d.DONE):this.readyState=d.DONE},respond:function(b,c,e){this.setResponseHeaders(c||{}),this.status=typeof b=="number"?b:200,this.statusText=d.statusCodes[this.status],this.setResponseBody(e||"")}}),sinon.extend(d,{UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4}),d.parseXML=function(b){var c;if(typeof DOMParser!="undefined"){var d=new DOMParser;c=d.parseFromString(b,"text/xml")}else c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b);return c},d.statusCodes={100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choice",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported"},sinon.useFakeXMLHttpRequest=function(){return sinon.FakeXMLHttpRequest.restore=function(d){b.supportsXHR&&(a.XMLHttpRequest=b.GlobalXMLHttpRequest),b.supportsActiveX&&(a.ActiveXObject=b.GlobalActiveXObject),delete sinon.FakeXMLHttpRequest.restore,d!==!0&&delete sinon.FakeXMLHttpRequest.onCreate},b.supportsXHR&&(a.XMLHttpRequest=sinon.FakeXMLHttpRequest),b.supportsActiveX&&(a.ActiveXObject=function(c){return c=="Microsoft.XMLHTTP"||/^Msxml2\.XMLHTTP/i.test(c)?new sinon.FakeXMLHttpRequest:new b.GlobalActiveXObject(c)}),sinon.FakeXMLHttpRequest},sinon.FakeXMLHttpRequest=d}(this),typeof module=="object"&&typeof require=="function"&&(module.exports=sinon);if(typeof sinon=="undefined")var sinon={};sinon.fakeServer=function(){function b(){}function c(a){return b.prototype=a,new b}function d(a){var b=a;Object.prototype.toString.call(a)!="[object Array]"&&(b=[200,{},a]);if(typeof b[2]!="string")throw new TypeError("Fake server response body should be string, but was "+typeof b[2]);return b}function g(a,b,c){var d=a.method,e=!d||d.toLowerCase()==b.toLowerCase(),f=a.url,g=!f||f==c||typeof f.test=="function"&&f.test(c);return e&&g}function h(a,b){var c=this.getHTTPMethod(b),d=b.url;if(!/^https?:\/\//.test(d)||f.test(d))d=d.replace(f,"");if(g(a,this.getHTTPMethod(b),d)){if(typeof a.response=="function"){var e=a.url,h=[b].concat(e?d.match(e).slice(1):[]);return a.response.apply(a,h)}return!0}return!1}var a=[].push,e=window.location,f=new RegExp("^"+e.protocol+"//"+e.host);return{create:function(){var a=c(this);return this.xhr=sinon.useFakeXMLHttpRequest(),a.requests=[],this.xhr.onCreate=function(b){a.addRequest(b)},a},addRequest:function(c){var d=this;a.call(this.requests,c),c.onSend=function(){d.handleRequest(this)},this.autoRespond&&!this.responding&&(setTimeout(function(){d.responding=!1,d.respond()},this.autoRespondAfter||10),this.responding=!0)},getHTTPMethod:function(b){if(this.fakeHTTPMethods&&/post/i.test(b.method)){var c=(b.requestBody||"").match(/_method=([^\b;]+)/);return c?c[1]:b.method}return b.method},handleRequest:function(c){c.async?(this.queue||(this.queue=[]),a.call(this.queue,c)):this.processRequest(c)},respondWith:function(c,e,f){if(arguments.length==1&&typeof c!="function"){this.response=d(c);return}this.responses||(this.responses=[]),arguments.length==1&&(f=c,e=c=null),arguments.length==2&&(f=e,e=c,c=null),a.call(this.responses,{method:c,url:e,response:typeof f=="function"?f:d(f)})},respond:function(){arguments.length>0&&this.respondWith.apply(this,arguments);var b=this.queue||[],c;while(c=b.shift())this.processRequest(c)},processRequest:function(b){try{if(b.aborted)return;var c=this.response||[404,{},""];if(this.responses)for(var d=0,e=this.responses.length;d<e;d++)if(h.call(this,this.responses[d],b)){c=this.responses[d].response;break}b.readyState!=4&&b.respond(c[0],c[1],c[2])}catch(f){sinon.logError("Fake server request processing",f)}},restore:function(){return this.xhr.restore&&this.xhr.restore.apply(this.xhr,arguments)}}}(),typeof module=="object"&&typeof require=="function"&&(module.exports=sinon),function(){function a(){}a.prototype=sinon.fakeServer,sinon.fakeServerWithClock=new a,sinon.fakeServerWithClock.addRequest=function(b){if(b.async){typeof setTimeout.clock=="object"?this.clock=setTimeout.clock:(this.clock=sinon.useFakeTimers(),this.resetClock=!0);if(!this.longestTimeout){var c=this.clock.setTimeout,d=this.clock.setInterval,e=this;this.clock.setTimeout=function(a,b){return e.longestTimeout=Math.max(b,e.longestTimeout||0),c.apply(this,arguments)},this.clock.setInterval=function(a,b){return e.longestTimeout=Math.max(b,e.longestTimeout||0),d.apply(this,arguments)}}}return sinon.fakeServer.addRequest.call(this,b)},sinon.fakeServerWithClock.respond=function(){var b=sinon.fakeServer.respond.apply(this,arguments);return this.clock&&(this.clock.tick(this.longestTimeout||0),this.longestTimeout=0,this.resetClock&&(this.clock.restore(),this.resetClock=!1)),b},sinon.fakeServerWithClock.restore=function(){return this.clock&&this.clock.restore(),sinon.fakeServer.restore.apply(this,arguments)}}();if(typeof module=="object"&&typeof require=="function"){var sinon=require("../sinon");sinon.extend(sinon,require("./util/fake_timers"))}return function(){function b(b,c,d,e){if(!e)return;c.injectInto?c.injectInto[d]=e:a.call(b.args,e)}function c(a){var b=sinon.create(sinon.sandbox);return a.useFakeServer&&(typeof a.useFakeServer=="object"&&(b.serverPrototype=a.useFakeServer),b.useFakeServer()),a.useFakeTimers&&(typeof a.useFakeTimers=="object"?b.useFakeTimers.apply(b,a.useFakeTimers):b.useFakeTimers()),b}var a=[].push;sinon.sandbox=sinon.extend(sinon.create(sinon.collection),{useFakeTimers:function(){return this.clock=sinon.useFakeTimers.apply(sinon,arguments),this.add(this.clock)},serverPrototype:sinon.fakeServer,useFakeServer:function(){var b=this.serverPrototype||sinon.fakeServer;return!b||!b.create?null:(this.server=b.create(),this.add(this.server))},inject:function(a){return sinon.collection.inject.call(this,a),this.clock&&(a.clock=this.clock),this.server&&(a.server=this.server,a.requests=this.server.requests),a},create:function(a){if(!a)return sinon.create(sinon.sandbox);var d=c(a);d.args=d.args||[];var e,f,g=d.inject({});if(a.properties)for(var h=0,i=a.properties.length;h<i;h++)e=a.properties[h],f=g[e]||e=="sandbox"&&d,b(d,a,e,f);else b(d,a,"sandbox",f);return d}}),sinon.sandbox.useFakeXMLHttpRequest=sinon.sandbox.useFakeServer,typeof module!="undefined"&&(module.exports=sinon.sandbox)}(),function(a){function c(b){var c=typeof b;if(c!="function")throw new TypeError("sinon.test needs to wrap a test function, got "+c);return function(){var c=a.getConfig(a.config);c.injectInto=c.injectIntoThis&&this||c.injectInto;var d=a.sandbox.create(c),e,f,g=Array.prototype.slice.call(arguments).concat(d.args);try{f=b.apply(this,g)}finally{d.verifyAndRestore()}return f}}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("../sinon"));if(!a)return;c.config={injectIntoThis:!0,injectInto:null,properties:["spy","stub","mock","clock","server","requests"],useFakeTimers:!0,useFakeServer:!0},b?module.exports=c:a.test=c}(typeof sinon=="object"&&sinon||null),function(a){function c(a,b,c){return function(){b&&b.apply(this,arguments);var d,e;try{e=a.apply(this,arguments)}catch(f){d=f}c&&c.apply(this,arguments);if(d)throw d;return e}}function d(b,d){if(!b||typeof b!="object")throw new TypeError("sinon.testCase needs an object with test functions");d=d||"test";var e=new RegExp("^"+d),f={},g,h,i,j=b.setUp,k=b.tearDown;for(g in b)if(b.hasOwnProperty(g)){h=b[g];if(/^(setUp|tearDown)$/.test(g))continue;if(typeof h=="function"&&e.test(g)){i=h;if(j||k)i=c(h,j,k);f[g]=a.test(i)}else f[g]=b[g]}return f}var b=typeof module=="object"&&typeof require=="function";!a&&b&&(a=require("../sinon"));if(!a||!Object.prototype.hasOwnProperty)return;b?module.exports=d:a.testCase=d}(typeof sinon=="object"&&sinon||null),function(a,b){function f(){var a;for(var b=0,c=arguments.length;b<c;++b)a=arguments[b],a||e.fail("fake is not a spy"),typeof a!="function"&&e.fail(a+" is not a function"),typeof a.getCall!="function"&&e.fail(a+" is not stubbed")}function g(a,c){a=a||b;var d=a.fail||e.fail;d.call(a,c)}function h(a,b,c){arguments.length==2&&(c=b,b=a),e[a]=function(h){f(h);var i=d.call(arguments,1),j=!1;typeof b=="function"?j=!b(h):j=typeof h[b]=="function"?!h[b].apply(h,i):!h[b],j?g(this,h.printf.apply(h,[c].concat(i))):e.pass(a)}}function i(a,b){return!a||/^fail/.test(b)?b:a+b.slice(0,1).toUpperCase()+b.slice(1)}var c=typeof module=="object"&&typeof require=="function",d=Array.prototype.slice,e;!a&&c&&(a=require("../sinon"));if(!a)return;e={failException:"AssertError",fail:function(b){var c=new Error(b);throw c.name=this.failException||e.failException,c},pass:function(b){},callOrder:function(){f.apply(null,arguments);var c="",h="";if(!a.calledInOrder(arguments)){try{c=[].join.call(arguments,", "),h=a.orderByFirstCall(d.call(arguments)).join(", ")}catch(i){}g(this,"expected "+c+" to be "+"called in order but were called as "+h)}else e.pass("callOrder")},callCount:function(c,d){f(c);if(c.callCount!=d){var h="expected %n to be called "+a.timesInWords(d)+" but was called %c%C";g(this,c.printf(h))}else e.pass("callCount")},expose:function(b,c){if(!b)throw new TypeError("target is null or undefined");var d=c||{},e=typeof d.prefix=="undefined"&&"assert"||d.prefix,f=typeof d.includeFail=="undefined"||!!d.includeFail;for(var g in this)g!="export"&&(f||!/^(fail)/.test(g))&&(b[i(e,g)]=this[g]);return b}},h("called","expected %n to have been called at least once but was never called"),h("notCalled",function(a){return!a.called},"expected %n to not have been called but was called %c%C"),h("calledOnce","expected %n to be called once but was called %c%C"),h("calledTwice","expected %n to be called twice but was called %c%C"),h("calledThrice","expected %n to be called thrice but was called %c%C"),h("calledOn","expected %n to be called with %1 as this but was called with %t"),h("alwaysCalledOn","expected %n to always be called with %1 as this but was called with %t"),h("calledWith","expected %n to be called with arguments %*%C"),h("alwaysCalledWith","expected %n to always be called with arguments %*%C"),h("calledWithExactly","expected %n to be called with exact arguments %*%C"),h("alwaysCalledWithExactly","expected %n to always be called with exact arguments %*%C"),h("neverCalledWith","expected %n to never be called with arguments %*%C"),h("threw","%n did not throw exception%C"),h("alwaysThrew","%n did not always throw exception%C"),c?module.exports=e:a.assert=e}(typeof sinon=="object"&&sinon||null,typeof window!="undefined"?window:global),sinon}.call(typeof window!="undefined"&&window||{})