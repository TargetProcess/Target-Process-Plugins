
define('tau/core/class',[],function(){var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,Class=function(){},objId=0,defaultProfiler=function(name,f){return f};return Class.extend=function(prop){function Class(){!initializing&&this.init&&(this.__objectId=objId++,this.init.apply(this,arguments))}var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1,prototype.__profiler=prototype.__profiler||defaultProfiler;for(var name in prop){if(name==="__profiler")continue;var propProxy=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,prop[name]):prop[name];prototype[name]=prototype.__profiler(name,propProxy)}return Class.prototype=prototype,Class.constructor=Class,Class.extend=arguments.callee,Class},Class});
define('tau/core/event',["Underscore"],function(_){var getEventDescription=function(evtName){var evt={},parts=evtName.split(":");return evt.name=parts[0],parts.length>1&&(evt.rule=parts[1]),evt},extractData=function(evt){var args=[];return evt.name?args=[evt.data]:args=_.pluck(_.values(evt),"data"),args},Event=function(){};return Event.implementOn=function(targetObject){var eventProto=Event.prototype;for(var prop in eventProto)targetObject[prop]==undefined&&(targetObject[prop]=eventProto[prop]);return targetObject},Event.signUpOnEvents=function(eventNameParts,targetObject,fnName,property,priority,ordered){var dictionary={},eventNames=[],evtDescriptors={},handler=function(evtArg){if(ordered){var index=eventNameParts.indexOf(evtArg.name);for(var j=0;j<index;j++){var eventNamePart=eventNameParts[j].replace(":last","");if(!dictionary.hasOwnProperty(eventNamePart))return}}dictionary[evtArg.name]=evtArg;if(_(dictionary).keys().length===eventNames.length){var data={};for(var i=0,l=eventNames.length;i<l;i++){var descriptor=evtDescriptors[eventNames[i]];data[descriptor.name]=dictionary[descriptor.name];if(descriptor.rule==="last")continue;delete dictionary[descriptor.name]}data=[data].concat(extractData(data)),targetObject[fnName].apply(targetObject,data)}};for(var i=0,l=eventNameParts.length;i<l;i++){var evtDescription=getEventDescription(eventNameParts[i]),evtName=evtDescription.name;evtDescriptors[evtName]=evtDescription,eventNames.push(evtName),property.on(evtName,handler,targetObject,null,priority)}},Event.subscribeOn=function(targetObject){var _targetObject=_(targetObject);_.forEach(_targetObject.keys(),function(propertyName){var property=targetObject[propertyName];if(!property)return;if(_.isFunction(property.on)){var functionNames=_(targetObject).functionsExt();for(var i=0,len=functionNames.length;i<len;i++){var fnName=functionNames[i],fnNameForProcessing=fnName.replace(/\s*\+\s*/g,"+").replace(/\s*>\s*/g,">"),parts=fnNameForProcessing.split(/\s+/),eventNameParts=parts[1],field=parts[0],priority;if(parts.length<2)continue;parts.length>2&&!isNaN(parts[2])&&(priority=parts[2]);var eventNamePartsConcatArr=eventNameParts.split("+"),eventNamePartsOrderArr=eventNameParts.split(">");if(eventNamePartsConcatArr.length>1&&eventNamePartsOrderArr.length>1)throw"+ and > can not be used for now together";field==propertyName&&(eventNamePartsConcatArr.length>1?Event.signUpOnEvents(eventNamePartsConcatArr,targetObject,fnName,property,priority,!1):eventNamePartsOrderArr.length>1?Event.signUpOnEvents(eventNamePartsOrderArr,targetObject,fnName,property,priority,!0):property.on(eventNameParts,targetObject[fnName],targetObject,null,priority))}}})},Event.unSubscribe=function(targetObject){var _targetObject=_(targetObject);_.each(_targetObject.keys(),function(propertyName){var propertyObject=targetObject[propertyName];propertyObject&&_.isFunction(propertyObject.removeAllListeners)&&propertyObject.removeAllListeners(targetObject)})},Event.prototype=function(){var getPrivate=function(obj){var _=obj.getPrivate&&obj.getPrivate()||obj._||(obj._={});return _.events||(_.events={})},EventEntry=function(eventName){this.name=eventName,this.listeners=[]};EventEntry.prototype={},EventEntry.prototype.getListenerIndex=function(listenerFunction,scope){for(var i=0,listeners=this.listeners;i<listeners.length;i++)if(listeners[i].fn==listenerFunction&&(listeners[i].scopeObj===scope||!listeners[i].scopeObj&&(arguments.length==1||!scope)))return i;return-1};var proto={once:function(eventName,listenerFunction,scopeObj,listenerData,priority){var rl=_.bind(function(f){this.removeListener(eventName,f,scopeObj)},this),listenerFunctionOnce=function(){listenerFunction.apply(this,_.toArray(arguments)),rl(listenerFunctionOnce)};this.on(eventName,listenerFunctionOnce,scopeObj,listenerData,priority)},on:function(eventName,listenerFunction,scopeObj,listenerData,priority){if(_.isString(eventName)&&eventName.indexOf("+")>0){var seq=eventName.split("+");Event.signUpOnEvents(seq,this,listenerFunction,this,priority);return}if(_.isArray(eventName)){var callee=arguments.callee,self=this;_.each(eventName,function(name){callee.call(self,name,listenerFunction,scopeObj,listenerData,priority)});return}var events=getPrivate(this),event=events[eventName]||(events[eventName]=new EventEntry(eventName));if(event.getListenerIndex(listenerFunction,scopeObj)<0){var listeners=event.listeners;scopeObj||(scopeObj=this),isNaN(priority)&&(priority=10);var me=this,listenerFirer=function(caller,publisherData,stopFn,cancelFn,mutex){var ev={name:eventName,sender:this,date:new Date,caller:caller,data:publisherData,listenerData:listenerData,stop:stopFn,cancel:cancelFn,suspendMain:function(){mutex&&mutex.lock()},cancelMain:function(){mutex&&mutex.cancel()},resumeMain:function(){mutex&&mutex.unlock()},removeListener:function(){me.removeListener(eventName,listenerFunction,scopeObj)}},args=[ev].concat(extractData(ev));return listenerFunction.apply(scopeObj,args),ev.data};listenerFirer.fn=listenerFunction,listenerFirer.scopeObj=scopeObj,listenerFirer.priority=priority;for(var i=listeners.length-1;i>=0;i--)if(listeners[i].priority<=priority){listeners.splice(i+1,0,listenerFirer);return}listeners.unshift(listenerFirer)}return this},fire:function(){var stopped=!1,stopEvent=function(){stopped=!0},canceled=!1,cancelEvent=function(){canceled=!0};return function(eventName,data,caller,mutex){var event=getPrivate(this)[eventName],previousStopped=stopped,previousCancelled=canceled;stopped=canceled=!1;if(event){var listeners=event.listeners;if(listeners.length){listeners=listeners.slice(0);for(var i=0;i<listeners.length;i++){var retData=listeners[i].call(this,caller,data,stopEvent,cancelEvent,mutex);typeof retData!="undefined"&&(data=retData);if(stopped||canceled)break}}}var ret=canceled||(typeof data=="undefined"?!1:data);return stopped=previousStopped,canceled=previousCancelled,ret}}(),fireOnce:function(eventName,data,editor){var ret=this.fire(eventName,data,editor);return delete getPrivate(this)[eventName],ret},removeListener:function(eventName,listenerFunction,scopeObj){var event=getPrivate(this)[eventName];if(event){var index=event.getListenerIndex(listenerFunction,scopeObj);index>=0&&event.listeners.splice(index,1)}},removeAllListeners:function(scope){var events=getPrivate(this);for(var key in events)if(events[key].listeners)if(!scope)delete events[key].listeners,delete events[key];else{var listeners=events[key].listeners,validListeners=[];for(var i=0;i<listeners.length;i++)listeners[i].scopeObj!=scope&&validListeners.push(listeners[i]);events[key].listeners=validListeners}},hasListeners:function(eventName){var event=getPrivate(this)[eventName];return event&&event.listeners.length>0},getListeners:function(){var events=getPrivate(this),listeners=[];for(var key in events){var items=events[key].listeners;if(items&&items.length>0){var listenerDetails=[];for(var i=0;i<items.length;i++){var item=items[i],listener={name:"unknown",item:item};item.scopeObj&&item.scopeObj.bus&&item.scopeObj.bus.name?listener.name=item.scopeObj.bus.name:item.scopeObj&&item.scopeObj.name&&(listener.name=item.scopeObj.name),listenerDetails.push(listener)}listeners.push({name:key,items:items,count:items.length,listeners:listenerDetails})}}return listeners},getListenersCount:function(){var events=getPrivate(this),listenersCount=0;for(var key in events)events[key].listeners&&(listenersCount+=events[key].listeners.length);return listenersCount}};return proto.addEventListener=proto.on,proto.unbind=proto.removeAllListeners,proto}(),Event});
define('tau/core/bus.collection',["Underscore","jQuery","tau/core/class","tau/core/event"],function(_,$,Class,Event){var Collection=Class.extend({init:function(){this.buses={}},register:function(bus){this.buses[bus.id]=bus,this.fire("create",{bus:bus})},count:function(excludeGlobalBus){var keys=_.keys(this.buses);return excludeGlobalBus&&(keys=_.without(keys,"global")),keys.length},size:function(){return this.count()},stats:function(){var counts={};_.forEach(this.buses,function(bus,key){counts.hasOwnProperty(bus.name)||(counts[bus.name]=0),counts[bus.name]++}),_.forEach(counts,function(v,key){console.log(key+" : "+v)})},unregister:function(bus){if(bus.id==="global")return;delete this.buses[bus.id],this.fire("destroy",{bus:bus})},getByName:function(name,f){var def=$.Deferred(),cond=function(bus){return bus.name===name},bus=_.find(this.buses,cond);if(!bus){var listener=_.bind(function(def,evt){var bus=evt.data.bus;cond(bus)&&(this.removeListener("create",listener,this),def.resolve(bus))},this,def);this.on("create",listener,this)}else def.resolve(bus);return f&&def.done(f),def},onCreate:function(bus){this.register(bus)},onDestroy:function(bus){this.unregister(bus)},logCount:function(){console.log("#count: "+this.count())},clear:function(){this.buses={}}});return Event.implementOn(Collection.prototype),Collection});
define('tau/core/bus.reg',["Underscore","tau/core/bus.collection"],function(_,BusCollection){var registry=new BusCollection;return window.tau=window.tau||{},_.extend(window.tau,{buses:registry}),registry});
define('tau/core/event.queued',["Underscore","tau/core/event"],function(_,event){function cloneArray(arguments){var args=[];return _.each(arguments,function(v){args.push(v)}),args}var eventQueued=function(){event.call(this,arguments)};_.extend(eventQueued,event),_.extend(eventQueued.prototype,event.prototype);var eventQueue=null,unlockDelegate=function(mutex){var afterArguments=cloneArray(mutex.originalArguments);afterArguments[0]="after_"+afterArguments[0],afterArguments[1]=afterArguments[1]||{},afterArguments[2]=afterArguments[2]||{},!eventQueue||eventQueue.length==0?(event.prototype.fire.apply(mutex.scope,mutex.originalArguments),event.prototype.fire.apply(mutex.scope,afterArguments)):(eventQueue.push({arguments:mutex.originalArguments,scope:mutex.scope}),eventQueue.push({arguments:afterArguments,scope:mutex.scope}))};return eventQueued.prototype.fire=function(eventName,data,caller){var originalArguments=cloneArray(arguments),beforeArguments=cloneArray(originalArguments);beforeArguments[0]="before_"+beforeArguments[0],beforeArguments[1]=beforeArguments[1]||{},beforeArguments[2]=beforeArguments[2]||{};var afterArguments=cloneArray(originalArguments);afterArguments[0]="after_"+afterArguments[0],afterArguments[1]=afterArguments[1]||{},afterArguments[2]=afterArguments[2]||{},beforeArguments[3]={lockCount:0,canceled:!1,originalArguments:originalArguments,scope:this,unlockedDelegate:function(){},setUnlockDelegate:function(delegate){this.unlockedDelegate=delegate},isCanceled:function(){return this.canceled},isLocked:function(){return this.lockCount>0},cancel:function(){this.canceled=!0},lock:function(){this.lockCount++},unlock:function(){this.lockCount--,this.lockCount==0&&(this.unlockedDelegate(this),delete this.originalArguments,delete this.scope)}};if(_.isNull(eventQueue)){eventQueue=[],eventQueue.push({arguments:beforeArguments,scope:this}),eventQueue.push({arguments:originalArguments,scope:this}),eventQueue.push({arguments:afterArguments,scope:this});while(eventQueue.length>0){var args=eventQueue[0].arguments,scope=eventQueue[0].scope;eventQueue.splice(0,1),event.prototype.fire.apply(scope,args);var mutex=args&&args[3];mutex&&(mutex.isLocked()||mutex.isCanceled())&&(eventQueue.splice(0,2),mutex.isCanceled()==0&&mutex.setUnlockDelegate(unlockDelegate))}eventQueue=null}else eventQueue.push({arguments:beforeArguments,scope:this}),eventQueue.push({arguments:originalArguments,scope:this}),eventQueue.push({arguments:afterArguments,scope:this})},eventQueued});
define('tau/core/bus',["Underscore","tau/core/class","tau/core/bus.reg","tau/core/event","tau/core/event.queued"],function(_,Class,busRegistry,event,EventQueued){function debug(bus,arguments,pattern){var data=arguments[1],name=arguments[0];bus.name.match(/(application board)/)&&console.log(bus.name,"["+bus.id+"]",":",name,data||"")}var generateFire=function(eventInterface){return function(eventName,data,sender){this.globalBus&&this.globalBus.fire(eventName,data,this);var args=eventInterface.prototype.fire.apply(this,arguments);return eventName==="destroy"&&(busRegistry.onDestroy(this),delete this.globalBus),args}},queuedFire=generateFire(EventQueued),Bus=Class.extend({globalBus:null,init:function(config){config=config||{};if(config["queue.bus"]||config.queuedBus)this.fire=queuedFire;this.globalBus=config&&config.globalBus?config.globalBus:null,this.name=config&&config.name?config.name:_.uniqueId()+"",_.defaults(config,{id:_.uniqueId("bus_")}),this.id=config.id,busRegistry.onCreate(this)},initialize:function(config){this.fire("initialize",config)},destroy:function(){this.fire("destroy"),delete this.globalBus},getGlobalBus:function(){return this.globalBus}});return event.implementOn(Bus.prototype),Bus.prototype.fire=generateFire(event),Bus});
define('tau/core/Class',[],function(){var initializing=!1,fnTest=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/,Class=function(){},objId=0,defaultProfiler=function(name,f){return f};return Class.extend=function(prop){function Class(){!initializing&&this.init&&(this.__objectId=objId++,this.init.apply(this,arguments))}var _super=this.prototype;initializing=!0;var prototype=new this;initializing=!1,prototype.__profiler=prototype.__profiler||defaultProfiler;for(var name in prop){if(name==="__profiler")continue;var propProxy=typeof prop[name]=="function"&&typeof _super[name]=="function"&&fnTest.test(prop[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,prop[name]):prop[name];prototype[name]=prototype.__profiler(name,propProxy)}return Class.prototype=prototype,Class.constructor=Class,Class.extend=arguments.callee,Class},Class});
define('tau/core/global.bus',["tau/core/bus","app.bus"],function(Bus,promise){var globalBus=new Bus({id:"global",name:"globalBus"});return promise.resolve(globalBus),{bus:null,reset:function(){},get:function(){return globalBus}}});
define('app.path',["jQuery","tau/core/class"],function($,clazz){var appRoot=null,getAppPath=function(constantRequirePath){var result=null,location=window.location,search=location.search,href=location.href,position=search?href.indexOf(search):href.length,pathToPage=href.substr(0,position),pathToPageTokens=pathToPage.split("/");pathToPageTokens.pop();var pathToRequire=$(document).find('script[src*="/require.js"]').attr("src"),pathToRequireTokens=pathToRequire.split("/");pathToRequireTokens.pop();var constantRequirePathTokens=constantRequirePath.split("/");while(".."===pathToRequireTokens[0])pathToRequireTokens.shift(),pathToPageTokens.pop();if(pathToRequireTokens.length===0)for(var i=0;i<constantRequirePathTokens.length;i++)pathToPageTokens.pop();else if(pathToRequireTokens.join("/").toLowerCase()!==constantRequirePathTokens.join("/").toLowerCase())throw"Can't determine application root";return result=pathToPageTokens.join("/"),result},api={get:function(){return appRoot||(appRoot=getAppPath("javascript/tau/scripts"))},tp:{}},tp=api.tp;return tp.UrlParameterCollection=clazz.extend({query:null,_parameters:null,init:function(query){this.query=query;var a=[],b=this.query.split("&"),c="";if(b.length<1)return a;for(i=0;i<b.length;i++)c=b[i].split("="),c[0].length>0&&(a[i]=[c[0],c.length==1?c[0]:c[1]]);this._parameters=a},get:function(key){var parameter=this._findParameter(key);if(parameter)return parameter[1]},_findParameter:function(key){for(var i=0;i<this._parameters.length;i++)if(this._parameters[i][0]==key)return this._parameters[i]},set:function(key,value){var parameter=this._findParameter(key);if(parameter){parameter[1]=value;return}this._parameters.push([key,value])},remove:function(key){for(var i=0;i<this._parameters.length;i++)this._parameters[i][0]==key&&this._parameters.splice(i,1)}}),tp.UrlParameterCollection.prototype.toString=function(){if(this._parameters.length==0)return"";var query="?";for(var i=0;i<this._parameters.length;i++)i>0&&(query+="&"),query+=this._parameters[i][0]+"="+this._parameters[i][1];return query},tp.URL=clazz.extend({init:function(url){url.length==0&&eval('throw "Invalid URL ['+url+']"'),this.url=url,this.port=-1,this.query=this.url.indexOf("?")>=0?this.url.substring(this.url.indexOf("?")+1):"",this.query.indexOf("#")>=0&&(this.query=this.query.substring(0,this.query.indexOf("#"))),this.protocol="",this.host="",this.protocolSep="",this.portSep="";var protocolSepIndex=this.url.indexOf("://");if(protocolSepIndex>=0){this.protocolSep="://",this.protocol=this.url.substring(0,protocolSepIndex).toLowerCase(),this.host=this.url.substring(protocolSepIndex+3),this.host.indexOf("/")>=0&&(this.host=this.host.substring(0,this.host.indexOf("/")));var atIndex=this.host.indexOf("@");if(atIndex>=0){var credentials=this.host.substring(0,atIndex),colonIndex=credentials.indexOf(":");colonIndex>=0?(this.username=credentials.substring(0,colonIndex),this.password=credentials.substring(colonIndex)):this.username=credentials,this.host=this.host.substring(atIndex+1)}var portColonIndex=this.host.indexOf(":");portColonIndex>=0&&(this.portSep=":",this.port=this.host.substring(portColonIndex),this.host=this.host.substring(0,portColonIndex)),this.file=this.url.substring(protocolSepIndex+3),this.file=this.file.substring(this.file.indexOf("/"))}else this.file=this.url;this.file.indexOf("?")>=0&&(this.file=this.file.substring(0,this.file.indexOf("?")));var refSepIndex=url.indexOf("#");refSepIndex>=0?(this.file=this.file.substring(0,refSepIndex),this.reference=this.url.substring(this.url.indexOf("#"))):this.reference="",this.path=this.file,this.query.length>0&&(this.file+="?"+this.query),this.reference.length>0&&(this.file+="#"+this.reference),this._parameters=new tp.UrlParameterCollection(this.query)},getPort:function(){return this.port},getQuery:function(){return this._parameters.toString()},getProtocol:function(){return this.protocol},getHost:function(){return this.host},getUserName:function(){return this.username},getPassword:function(){return this.password},getFile:function(){return this.file},getReference:function(){return this.reference},getPath:function(){return this.path},getAcid:function(){return this.getArgumentValue("acid")},setAcid:function(value){this.setArgumentValue("acid",value)},setArgumentValue:function(key,value){this._parameters.set(key,value)},removeArgument:function(key){this._parameters.remove(key)},getArgumentValue:function(key){var parameter=this._parameters.get(key);return parameter!=null?parameter.replace(/\+/g," "):null}}),tp.URL.prototype.toString=function(){var segments=[this.getProtocol(),this.protocolSep,this.getHost(),this.getPort(),this.getPath(),this.getQuery()],_url="";return $.each(segments,function(){this&&this!=-1&&(_url+=this)}),_url},tp.AcidURL=tp.URL.extend({init:function(url){this._super(url)},toString:function(){var acid=(new tp.URL(document.location.href)).getAcid();return this.setAcid(acid),this._super()}}),tp.WebServiceURL=tp.AcidURL.extend({init:function(url){this._super(api.get()+url)}}),api});
define('tau/core/tau',["Underscore"],function(_){var tau=tau||{};return tau.empty=function(){},tau.ns=function(namespace){var parts=namespace.split("."),currentScope=window;for(var i=0,len=parts.length;i<len;i++){var name=parts[i];typeof currentScope[name]=="undefined"&&(currentScope[name]={}),currentScope=currentScope[name]}},tau.getQueryValueFromUrl=function(url,name){name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+name+"=([^&#]*)",regex=new RegExp(regexS,"i"),results=regex.exec(url);return results==null?"":results[1]},tau.getValueFromQueryString=function(name){var url=window.location.href;return tau.getQueryValueFromUrl(url,name)},tau.getTokenParameterFromQueryString=function(sign){var token=tau.getValueFromQueryString("token");return token!=""?sign+"token="+token:""},tau.extendArgs=function(args,arg){var result=args;return result=[].slice.call(args),result.unshift(arg),result},tau.concat=function(){return String.prototype.concat.apply("",arguments)},tau.createScopedCallbackIfRequired=function(callback){return typeof callback=="function"?callback:tau.createScopedCallback(callback.fn,callback.scope)},tau.createScopedCallback=function(fn,scope){return typeof fn!="function"&&typeof fn.fn=="function"&&(fn=fn.fn,fn.scope&&(scope=fn.scope)),typeof fn=="function"&&scope&&(fn=_.bind(fn,scope)),fn},tau.getCallbacks=function(callbacksObj){var callbacks=callbacksObj||{};_.isFunction(callbacksObj)&&(callbacks={success:callbacksObj}),callbacks.success||(callbacks.success=tau.empty),callbacks.failure||(callbacks.failure=tau.empty);var successFn=tau.createScopedCallback(callbacks.success,callbacks.scope),failureFn=tau.createScopedCallback(callbacks.failure,callbacks.scope);return{success:successFn,failure:failureFn}},tau});
define('tau/store/typesClass',["Underscore","tau/core/class"],function(_,Class){return Class.extend({init:function(){this._dictionary={}},registerType:function(type,dictionary){dictionary[type.name]=type,type.aliases=type.aliases||[],type.refs=type.refs||{},_.each(type.aliases,function(alias){dictionary[alias]=dictionary[alias.toLowerCase()]=type})},register:function(type){var self=this,dictionary=self._dictionary;this.registerType(type,dictionary)},findByKeyword:function(keyword){return this._dictionary[keyword]||null},getDictionary:function(){return this._dictionary}})});
define('tau/store/types',["tau/store/typesClass"],function(TypesClass){return new TypesClass});
define('tau/store/store',["Underscore","tau/core/class","tau/core/tau","tau/store/types","tau/store/typesClass","tau/core/bus","tau/core/global.bus"],function(_,Class,tauUtils,tauTypes,TypesClass,Bus,globalBus){var storeBus=new Bus({"queue.bus":!0,name:"store",globalBus:globalBus.get()}),apiStore={_processCommand:function(commandName,type,config,callbacks){callbacks=callbacks||{};var typeEntity=this.types[type];typeEntity&&(type=typeEntity.name);var command={type:type,name:commandName,config:config,callbacks:callbacks};return this.commands.push(command),this}},unfreeze=function(){var self=this;if(_.isEmpty(self._frozenPromises)){var commands=[].concat(self._frozenCommandsQueue);self._frozenCommandsQueue=[],self.config.proxy.execute(commands)}};return Class.extend({init:function(config){var self=this;self.id=_.uniqueId("store_"),self._frozenCommandsQueue=[],self._frozenPromises={},self.config=config,self.eventEmitter=self.config.eventEmitter||{fire:function(){},on:function(){},removeAllListeners:function(){}};var storeTypes=config.types||config.proxy.types;if(storeTypes){var types=new TypesClass;_(storeTypes).each(function(type){types.register(type)}),apiStore.types=types.getDictionary()}else apiStore.types=tauTypes.getDictionary();var functions=_.functionsExt(config.proxy);_.each(functions,function(fn){var parts=fn.split("api ");if(parts.length!==2)return;var publicName=parts[1];apiStore[publicName]=function(){var args=tauUtils.extendArgs(arguments,publicName);return this._processCommand.apply(this,args)}}),self._extendWithCommonAPI(self,self)},typeMetaInfo:function(type){return apiStore.types[type]},_extendWithCommonAPI:function(obj,store){_.each(_.functionsExt(apiStore),function(fn){if(fn[0]=="_")return;obj[fn]=function(){var api=_.extend({},apiStore);return api.commands=obj.commands||[],api[fn].apply(api,arguments),api.done=function(callbacks){store._done(api.commands,callbacks)},api}})},freeze:function(){var self=this,promiseId=_.uniqueId(),promise={id:promiseId,unfreeze:function(){this.unfreeze=tauUtils.empty,delete self._frozenPromises[promiseId],unfreeze.call(self)}};return self._frozenPromises[promise.id]=promise,promise},register:function(data,typeProperty){this.config.proxy.registerData(data,typeProperty)},registerWithEvents:function(data,typeProperty){var id=data.id,type=data.__type;data.hasOwnProperty("assignable")&&this.evictProperties(id,type,["$ref:assignable[id]"]);var repository=this.config.proxy,r=repository.registerData(data,typeProperty);repository._notifyAboutNewsAndChanges(r,null)},removeWithEvents:function(data,typeProperty){data.type=_.toCamelCase(typeProperty);var repository=this.config.proxy;this.evictPersistedObject(data.id,data.type),repository._populateAfterRemoveEvent(null,{tree:[],deletedData:[data]})},on:function(config,callback){return this.config.proxy.on(config,callback),this.eventEmitter.fire("afterStoreOn",config),this},unbind:function(listener){return this.config.proxy.unbind(listener),this.eventEmitter.fire("afterStoreUnbind",listener),this},_processChain:function(commands,callbacks){callbacks=tauUtils.getCallbacks(callbacks);var commonResult=[].concat(commands);_.each(commands,function(cmd){var cmdCallbacks=tauUtils.getCallbacks(cmd.callbacks),universalCallback=function(r,name){commonResult[_.indexOf(commonResult,cmd)]=r;var notExecuted=_.select(commands,function(command){return command.executed!==!0});cmdCallbacks[name](r);if(notExecuted.length===0){var countOfFailed=_.select(commands,function(command){return command.failed===!0});callbacks[countOfFailed.length>0?"failure":"success"](commonResult)}};cmd.callbacks={success:function(r){storeBus.fire("store.command.executed",r),universalCallback(r,"success")},failure:function(r){storeBus.fire("store.command.failed",r),universalCallback(r,"failure")}}})},done:function(callbacks){tauUtils.getCallbacks(callbacks).success([])},evictProperties:function(id,type,arrayOfPropertyNames){this.config.proxy.evictProperties(id,type,arrayOfPropertyNames)},evictData:function(){this.config.proxy.evictData()},evictPersistedObject:function(id,type){this.config.proxy.evictPersistedObject(id,type)},evictCollection:function(name){this.config.proxy.evictCollection(name)},isPropertyInitialized:function(id,type,propertyName){return this.config.proxy.isPropertyInitialized(id,type,propertyName)},_done:function(commands,callbacks){var self=this;self._processChain(commands,callbacks),_.isEmpty(self._frozenPromises)?self.config.proxy.execute(commands):self._frozenCommandsQueue=[].concat(self._frozenCommandsQueue,commands)}})});
define('tau/store/header',["Underscore","tau/core/tau"],function(_,tau){var tauExtension=_.extend(tau,{ref:function(name,fields){var value={};return value[name]=fields,value},list:function(name,fields){var o=tau.ref(name,fields);return o.list=!0,o},getNextPage:function(value,next,fields){fields=fields||[];var obj={holder:value,url:next,fields:fields};return value.getNextPage=function(){return obj},obj},parseFieldsFromString:function(value){var self=this;value=value.replace(/([\w-]+)\[+/ig,'{"$1":['),value=value.replace(/(\])/ig,"]}"),value=value.substr(0,value.length-1),value=value.replace(/([\w-]+)(,|\])/ig,"'$1'$2");var fields=eval("(function () { return "+value+";})();"),toLowerCase=function(key){var parts=key.split("-");if(parts.length>1){var r=[];return _.each(parts,function(part){r.push(toLowerCase(part))}),r.join("-")}return key.charAt(0).toLowerCase()+key.substr(1)},formatFields=function(fieldsToParse){var f=[];return _.each(fieldsToParse,function(field){if(self.header.isSimple(field)){f.push(toLowerCase(field));return}var obj={},fieldName=self.header.getFieldName(field);obj[toLowerCase(fieldName)]=formatFields(field[fieldName]),f.push(obj)}),f};return formatFields(fields)},formatObject:function(obj,caseName){var self=this,output={data:[],nextPages:[]};if(_.isUndefined(obj)||_.isNull(obj))return output.data=null,output;if(typeof obj!="object")return output.data=obj,output;caseName=caseName?caseName:"Lower";var toLowerCase=function(key){return key.charAt(0)["to"+caseName+"Case"]()+key.substr(1)};if(obj&&(obj.hasOwnProperty("Items")||obj.hasOwnProperty("items"))){var next=obj.next||obj.Next;next&&output.nextPages.push(self.getNextPage(output.data,next,[])),obj=obj.Items||obj.items}if(_.isArray(obj))return _.each(obj,function(value){var formatted=self.formatObject(value,caseName);output.nextPages=output.nextPages.concat(formatted.nextPages||[]),output.data.push(formatted.data)}),output;var r={};return _.each(_.keys(obj),function(key){var correctKey=toLowerCase(key),complexParts=correctKey.split("-");if(complexParts.length>1){var parts=[];_.each(complexParts,function(part){parts.push(toLowerCase(part))}),correctKey=parts.join("-")}var formatObject=self.formatObject(obj[key],caseName);output.nextPages=output.nextPages.concat(formatObject.nextPages||[]),r[correctKey]=formatObject.data}),output.data=r,output},header:{getFieldName:function(field){return _.getFieldName(field)},isSimple:function(field){return _.isString(field)},isList:function(field){return field.list===!0}}});return tauExtension});
define('tau/core/comparer',["Underscore"],function(_){return{isEqualIncluded:function(a,b){if(a===b)return!0;var atype=typeof a,btype=typeof b;if(atype!=btype)return!1;if(a==b)return!0;if(!a&&b||a&&!b)return!1;if(_.isDate(a)&&_.isDate(b))return a.getTime()===b.getTime();if(_.isNaN(a)&&_.isNaN(b))return!1;if(_.isRegExp(a)&&_.isRegExp(b))return a.source===b.source&&a.global===b.global&&a.ignoreCase===b.ignoreCase&&a.multiline===b.multiline;if(atype!=="object")return!1;if(_.isArray(a)&&_.isArray(b)&&a.length!==b.length)return!1;var bKeys=_.keys(b);for(var i=0;i<bKeys.length;i++){var key=bKeys[i];if(a.hasOwnProperty(key)&&!this.isEqualIncluded(a[key],b[key]))return!1}return!0},compare:function(oldObj,newObj){var self=this,results={changes:{}};return oldObj?(_.each(_(newObj).keys(),function(key){var result={value:newObj[key]};if(!oldObj.hasOwnProperty(key)){results.changes[key]=result;return}self.isEqualIncluded(oldObj[key],newObj[key])||(results.changes[key]=result)}),results):results}}});
define('tau/store/db',["Underscore","tau/core/class","tau/store/header","tau/core/comparer"],function(_,Class,tau,comparer){return Class.extend({init:function(config){this.__data={},this.__types=config.types||{}},_getTypeHolder:function(dataHolder,objType){var typeDictionary=dataHolder[objType]||{};return dataHolder.hasOwnProperty(objType)||(dataHolder[objType]=typeDictionary),typeDictionary},_getTypeDictionary:function(objType){return this._getTypeHolder(this.__data,objType)},getPersistedNode:function(id,type){var self=this,recordSet=self.__data[type];if(!recordSet)return null;if(!id)return recordSet;var record=recordSet[id];return record?record:null},_getRefsArray:function(def){return!def||!def.refs?[]:(def.hasOwnProperty("refsArray")||(def.refsArray=_(def.refs).keys()),def.refsArray)},_registerReference:function(value,key,typeDefinition,node,referenceRegister){var self=this,refDefinition=typeDefinition.refs[key];if(_.isUndefined(value)||value===null||value.id===null)return refDefinition.list?[]:null;value.__type=refDefinition.name;var refType=self.__types[refDefinition.name],r=self._register(value,function(n){if(!refType.refs)return;var relationProperty=refDefinition.relationProperty;if(!relationProperty)return;var refPropertyDef=refType.refs[relationProperty];if(!refPropertyDef)return;var isPropertyInitialized=n.data.hasOwnProperty(relationProperty),previousValue=n.data[relationProperty],isList=refPropertyDef.list,selfRef=self._getReferenceObject(node.id,node.__type),registerChanges=function(value){var changes={};changes[refDefinition.relationProperty]=value,referenceRegister.diffs.push({id:n.id,type:self._getOriginType(n),changes:changes})};if(isList&&!isPropertyInitialized)return;isList?_(previousValue).any(function(r){return r.id===node.id})?selfRef=previousValue:(selfRef=previousValue.concat([selfRef]),registerChanges(selfRef)):comparer.isEqualIncluded(selfRef,previousValue)||registerChanges(selfRef),n.data[relationProperty]=selfRef});_.mergeArrayObjects(referenceRegister,r,["diffs"]);var refObj={isReference:!0,type:refDefinition.name,list:!0};return refDefinition.list?_.extend(r.refs,refObj):r.refs[0]},_removeCascadeObjects:function(typeDefinition,data){var self=this,register=self._getRegisterTemplate();return _.each(self._getRefsArray(typeDefinition),function(key){var refDefinition=typeDefinition.refs[key];refDefinition.cascade&&(refDefinition.list?_.each(data[key],function(dbRef){self._extendRegister(register,self.remove(dbRef.id,dbRef.type))}):self._extendRegister(register,self.remove(data[key].id,data[key].type)))}),register},_getOriginType:function(refNode){var type=refNode.__type;return refNode.origin&&(type=refNode.origin.type),type},_removeRefFromObj:function(node,key,register,typeDefinition,id){var self=this,data=node.data;if(!data.hasOwnProperty(key))return;var value=data[key];if(!value)return;var ref=typeDefinition.refs[key];if(!ref.relationProperty)return;var refTypeDefinition=self.__types[ref.name];_.isArray(value)||(value=[value]);for(var i=0,l=value.length;i<l;i++){var refValue=value[i];if(id&&id!==refValue.id)continue;var refNode=self.getPersistedNode(refValue.id,refValue.type);if(!refNode)return;if(!refNode.data.hasOwnProperty(ref.relationProperty))return;register.nodes.push(refNode);var changes={};changes[ref.relationProperty]=null,refTypeDefinition.refs&&refTypeDefinition.refs[ref.relationProperty]&&refTypeDefinition.refs[ref.relationProperty].list?(refNode.data[ref.relationProperty]=_(refNode.data[ref.relationProperty]).select(function(refVal){return refVal.id!=node.id}),changes[ref.relationProperty]=refNode.data[ref.relationProperty]):refNode.data[ref.relationProperty]=null,register.diffs.push({id:refNode.id,type:self._getOriginType(refNode),changes:changes})}},_removeObjectFromRefs:function(typeDefinition,node){var self=this,register=self._getRegisterTemplate();return _(self._getRefsArray(typeDefinition)).each(function(key){self._removeRefFromObj(node,key,register,typeDefinition)}),register},removeProperties:function(id,type,arrayOfPropertyNames){var self=this,node=self.getPersistedNode(id,type);if(!node)return;var data=node.data;_(arrayOfPropertyNames).each(function(propertyName){delete data[propertyName]})},removeFromList:function(id,type,listSet){var self=this,register=self._getRegisterTemplate(),node=self.getPersistedNode(id,type);if(!node)return register;var typeDefinition=self.__types[type],fieldName=tau.header.getFieldName(listSet),data=node.data[fieldName]||[];if(!data)return register;var list=[],entityId=listSet[fieldName].id;_.each(data,function(v){v.id!=entityId?list.push({id:v.id}):self._removeRefFromObj(node,fieldName,register,typeDefinition,entityId)});var regPart={id:id,__type:type};regPart[fieldName]=list;var r=self.register(regPart);return self._extendRegister(r,register),r},remove:function(id,type){var self=this,register=self._getRegisterTemplate(),node=self.getPersistedNode(id,type);if(!node)return register;var typeDefinition=self.__types[type],data=node.data;return register.deletedData.push(_(data).defaults({id:id,type:type})),delete self.__data[type][id],self._extendRegister(register,self._removeCascadeObjects(typeDefinition,data)),self._extendRegister(register,self._removeObjectFromRefs(typeDefinition,node)),register},removeCollection:function(type){var self=this,recordSet=self.__data[type];recordSet&&_.forEach(_.keys(recordSet),function(id){self.remove(id,type)})},isPropertyInitialized:function(id,type,propertyName){var node=this.getPersistedNode(id,type);return node?node.data?node.data.hasOwnProperty(propertyName):!1:!1},_getReferenceObject:function(id,objType){return{isReference:!0,id:id,type:objType}},_attachReference:function(refs,id,objType){var reference=this._getReferenceObject(id,objType);return refs.push(reference),reference},_getParentTypeNames:function(currentType){var self=this;if(!currentType.__parents){currentType.__parents=[];var parent=currentType.parent;while(parent){currentType.__parents.push(parent);var parentType=self.__types[parent];if(!parentType)break;parent=parentType.parent}}return currentType.__parents},_registerParentNodes:function(objType,id,persistedNode){var self=this,currentType=self.__types[objType],origin={data:persistedNode.data,id:id,origin:{id:id,type:objType}},parents=self._getParentTypeNames(currentType);for(var i=0;i<parents.length;i++){var parent=parents[i],typeDictionary=self._getTypeDictionary(parent);typeDictionary[id]=typeDictionary[id]||{},_.extend(typeDictionary[id],origin)}},_getRegisterTemplate:function(){return{refs:[],nodes:[],diffs:[],tree:{},deletedData:[]}},_registerObjectInTree:function(tree,registrationConfig){var self=this,dictionary=self._getTypeHolder(tree,registrationConfig.type);if(!dictionary.hasOwnProperty(registrationConfig.id)){var changes={},type=self.__types[registrationConfig.type],leaveInTree={id:registrationConfig.id,changes:changes},parents=self._getParentTypeNames(type);for(var i=0;i<parents.length;i++){var parentType=self.__types[parents[i]],parentDictionary=self._getTypeHolder(tree,parentType.name);parentDictionary[registrationConfig.id]=leaveInTree}dictionary[registrationConfig.id]=leaveInTree}_.extend(dictionary[registrationConfig.id].changes,registrationConfig.changes)},_extendTree:function(tree,diffs){var self=this;_.each(diffs,function(diff){self._registerObjectInTree(tree,diff)})},_extendRegister:function(register,r){this._extendTree(register.tree,r.diffs),_.mergeArrayObjects(register,r,["diffs","deleteData"])},register:function(data,fn,typeProperty){return this._register(data,fn,typeProperty)},isTypeDetectionRequired:function(type){var typeDefinition=this.__types[type];return typeDefinition.isParentType},getTypeDetectionForNode:function(id,type){if(!this.isTypeDetectionRequired(type))return{required:!1};var persistedNode=this.getPersistedNode(id,type),outR={required:!0};return persistedNode?persistedNode.origin?!persistedNode.origin.id||!persistedNode.origin.type?outR:{required:!1,type:persistedNode.origin.type}:outR:outR},_getTypeDefinitionForRegistration:function(id,objType,obj){var self=this,typeDefinition=self.__types[objType];typeDefinition||(typeDefinition=self.__types[objType.toLowerCase()]);if(typeDefinition.isParentType){var typeDetection=self.getTypeDetectionForNode(id,typeDefinition.name);objType=typeDetection.required?typeDefinition.detectType(obj):typeDetection.type,typeDefinition=self.__types[objType]}return typeDefinition},_register:function(data,fnRegistered,typeProperty){var self=this;typeProperty=typeProperty||"__type";var register=self._getRegisterTemplate();if(_.isEmpty(data))return register;_.isArray(data)||(data=_.isArray(data.items)?data.items:[data]);var type=data[typeProperty];for(var i=0,l=data.length;i<l;i++){var obj=data[i];obj.hasOwnProperty(typeProperty)||(obj[typeProperty]=type),self._registerObject(obj,register,fnRegistered,typeProperty)}return register},_registerObject:function(obj,register,fnRegistered,typeProperty){var self=this,objType=obj[typeProperty],id=obj.id;if(!objType||!id)throw new Error("properties __type and id are required for data registration");var typeDefinition=self._getTypeDefinitionForRegistration(id,objType,obj),registrationConfig={id:id,type:typeDefinition.name,changes:{}},typeDictionary=self._getTypeDictionary(typeDefinition.name),persistedNode=typeDictionary[id];persistedNode||(typeDictionary[id]=persistedNode={__type:typeDefinition.name,data:{id:id},id:id},self._registerParentNodes(typeDefinition.name,id,persistedNode,typeDictionary));var nodeData=persistedNode.data,refDictionary=typeDefinition.refs,registerForReferences=self._getRegisterTemplate();for(var key in obj){if(key==="__type"||key==="id")continue;var newValue=obj[key],oldValue=nodeData[key];refDictionary.hasOwnProperty(key)&&(newValue=self._registerReference(newValue,key,typeDefinition,persistedNode,registerForReferences)),persistedNode.data[key]=newValue,comparer.isEqualIncluded(oldValue,newValue)||(registrationConfig.changes[key]=newValue)}self._extendRegister(register,registerForReferences),persistedNode.data.hasOwnProperty("__type")&&delete persistedNode.data.__type,register.nodes.push(persistedNode),self._extendTree(register.tree,[registrationConfig]),register.diffs.push(registrationConfig),self._attachReference(register.refs,id,typeDefinition.name),fnRegistered&&fnRegistered(persistedNode)},get:function(id,type,config){var self=this;if(!id){var r={data:[],notInitializedFields:[],all:!0};return _.each(_(this._getTypeDictionary(type)).keys(),function(rID){var item=self._get(rID,type,config);r.data.push(item.data),self.mergeFields(r.notInitializedFields,item.notInitializedFields)}),r}return this._get(id,type,config)},_get:function(id,type,config){var self=this;config=config||{};var node=self.getPersistedNode(id,type),typeDefinition=self.__types[type]||{},refs=typeDefinition.refs||{},fields=config.$fields||config.fields||[],result={data:null,type:typeDefinition,notInitializedFields:fields};if(!node)return result;var obj={},notInitializedFields=[],processRef=function(val,fields,notInitFields){var refVal=self._get(val.id,val.type,{fields:fields||[]});return refVal.notInitializedFields.length&&notInitFields.push(refVal.notInitializedFields),refVal.data},data=node.data;return _.each(fields,function(field){var fieldName=tau.header.getFieldName(field),val=data[fieldName];if(_.isUndefined(val)){notInitializedFields.push(field);return}obj[fieldName]=val;if(refs.hasOwnProperty(fieldName)&&val){var notInitRefFields=[];if(_.isArray(val)){var arrVal=val;val=[],_.each(arrVal,function(ref){val.push(processRef(ref,field[fieldName],notInitRefFields))})}else val=processRef(val,field[fieldName],notInitRefFields);if(notInitRefFields.length>0){var m={};m[fieldName]=[],_(notInitRefFields).each(function(f){self.mergeFields(m[fieldName],f)}),m[fieldName].length>0&&notInitializedFields.push(m)}}obj[fieldName]=val}),node.origin&&(type=node.origin.type),{type:typeDefinition,data:_(obj).defaults({id:id,__type:type}),notInitializedFields:notInitializedFields}},mergeFields:function(masterFields,fields,config){return _.mergeFields(masterFields,fields,config)},destroy:function(){delete this.__data,delete this.__types}})});
define('tau/store/repository',["Underscore","tau/core/class","tau/core/event","tau/core/tau","tau/store/header","tau/core/comparer","tau/store/types","tau/store/db"],function(_,Class,event,tau,tauHeader,comparer,tauTypes,Db){var repository=Class.extend({init:function(config){if(!config.service)throw"rest service should be defined";this.__listenerObjects={objects:[],holders:[]},this.__subscriptions={},this.types=config.types||tauTypes.getDictionary(),this._initDb(config),this.service=config.service},_initDb:function(config){config=config||{},this.__allTypeLoadMarkers={},this.db=config.db||new Db({types:this.types})},mergeCommands:function(commands){var commandsDictionary={},self=this;return _.each(commands,function(cmd){cmd=_.defaults(cmd,{name:"get",config:{},callbacks:{}}),cmd.callbacks=tau.getCallbacks(cmd.callbacks),self._processFieldsConfig(cmd,cmd.name==="get"?null:"_getEmptyArray");var commandKey=[cmd.type,cmd.config.id||"_",cmd.name,cmd.config.nested===!0?_.uniqueId():""].join("_");if(!commandsDictionary.hasOwnProperty(commandKey))commandsDictionary[commandKey]=cmd,cmd.commands=[];else{var value=commandsDictionary[commandKey];self.db.mergeFields(value.config.fields,cmd.config.fields),value.commands.push(cmd)}}),commandsDictionary},execute:function(commands){var self=this;_.isArray(commands)||(commands=[commands]);var commandsDictionary=self.mergeCommands(commands);_.each(_.values(commandsDictionary),function(command){if(command.executed===!0)throw"command is already executed. the same command can not be used twice";self["api "+command.name](command)})},_registerListener:function(listenersHolder,config,callback){var listeners=listenersHolder||{},eventName=config.eventName;listeners.hasOwnProperty(eventName)||(listeners[eventName]={});var subscriberId=_.uniqueId(eventName),listenerConfig={id:subscriberId,config:config,callback:tau.createScopedCallbackIfRequired(callback)},holderEvents=listeners[eventName],listener=config.listener;if(listener){if(!listener.__getRepositorySubscriberId){var __repositoryListenerId=_.uniqueId("repository_");listener.__getRepositorySubscriberId=function(){return __repositoryListenerId},this.__listenerObjects[__repositoryListenerId]={listener:listener,holders:[]}}var holder={id:subscriberId,holder:holderEvents};this.__listenerObjects[listener.__getRepositorySubscriberId()].holders.push(holder)}return holderEvents[subscriberId]=listenerConfig,listenerConfig},unbind:function(listener){if(!listener.__getRepositorySubscriberId)return;var self=this,__repositorySubscriberId=listener.__getRepositorySubscriberId(),__listenerObject=self.__listenerObjects[__repositorySubscriberId];if(!__listenerObject)return;var holderConfigs=__listenerObject.holders;if(!holderConfigs)return;_(holderConfigs).each(function(holderConfig){var holder=holderConfig.holder[holderConfig.id];holder.callback=function(){},delete holderConfig.holder[holderConfig.id]}),delete listener.__getRepositorySubscriberId,delete self.__listenerObjects[__repositorySubscriberId]},_getListeners:function(config){var self=this,subscriptions=self._getSubscriptions(config.type);if(!subscriptions)return[];var concreteListeners=subscriptions[config.eventName];if(!concreteListeners)return[];var listeners=[];return _.each(_(concreteListeners).values(),function(listener){var filter=listener.config.filter,hasChanges=listener.config.hasChanges||[];if(filter){var node=self.db.getPersistedNode(config.obj.id,config.obj.type),obj=config.obj;node&&node.data?obj=node.data:config.nodeEvent.changes&&!_.isEmpty(config.nodeEvent.changes)&&(obj=config.nodeEvent.changes);var diffs=comparer.compare(obj,filter);if(_(diffs.changes).keys().length>0)return}if(config.nodeEvent&&hasChanges.length>0){var changes=config.nodeEvent.changes||{},isPassChangesFilter=_(hasChanges).all(function(expectedChange){var parts=expectedChange.split("|"),pass=!1;return parts.length>1?pass=0<_(changes).chain().keys().intersection(parts).size().value():pass=changes.hasOwnProperty(expectedChange),pass});if(!isPassChangesFilter)return}listeners.push(listener)}),listeners},on:function(config,callback){var self=this,type=config.type?self.types[config.type].name:"_all_",holder=self._getSubscriptions(type);return self._registerListener(holder,config,callback)},_getSubscriptions:function(type){return this.__subscriptions.hasOwnProperty(type)||(this.__subscriptions[type]={}),this.__subscriptions[type]},_autoAppend:function(fields,appendix,appendMethod){_.each(appendix,function(a){_.any(fields,function(field){return tauHeader.header.getFieldName(field)===tauHeader.header.getFieldName(a)})||fields[appendMethod?appendMethod:"unshift"](a)})},registerData:function(data,typeProperty){return this.db.register(data,null,typeProperty)},_getEmptyArray:function(){return[]},_getDefaultFields:function(fieldsHolder){var type=this.types[fieldsHolder.type];return _.clone(type?type.fields||[]:[])},_processFieldsConfig:function(fieldsHolder,fnDefaultFields){var self=this;fnDefaultFields=fnDefaultFields||"_getDefaultFields";if(!fieldsHolder.config.fields||fieldsHolder.config.fields.length===0)fieldsHolder.config.fields=self[fnDefaultFields](fieldsHolder);var fields=fieldsHolder.config.fields;self._autoAppend(fields,["id"]);for(var i=fields.length;i>0;i--){var refField=fields[i-1];if(_.isSimple(refField))continue;var fieldName=_.getFieldName(refField),type=fieldsHolder.type?self.types[fieldsHolder.type]:null,refTypeName=null,defaultRefFields=[];if(type&&type.refs&&type.refs[fieldName]){var ref=type.refs[fieldName];ref.list===!0&&(refField.list=!0),defaultRefFields=ref.fields,refTypeName=ref.name}var refHolder={type:refTypeName,config:{fields:refField[fieldName]||defaultRefFields}};refField[fieldName]=self._processFieldsConfig(refHolder,fnDefaultFields)}var len=fields.length;for(i=0;i<len;i++){var name=_.getFieldName(fields[i]);for(var j=i+1;j<len;j++)_.getFieldName(fields[j])===name&&(_.isSimple(fields[i])||_.mergeFields(fields[i][name],fields[j][name]),fields.splice(j,1),len--,j--)}return fields},_invokeCommandCallback:function(callbackName,callbacks,command,value){var self=this;self._invokeCommandCallbackR(callbackName,callbacks,command,value);if(command.config.silent===!0)return;if(!self.__subscriptions._all_||_.isEmpty(self.__subscriptions._all_))return;var listeners=_.values(self.__subscriptions._all_[callbackName]||[]),args={name:callbackName,data:{cmd:command,data:value}};_(listeners).each(function(listener){listener.callback(args)})},_invokeCommandCallbackR:function(callbackName,callbacks,command,value){var self=this;command.executed=!0,callbacks[callbackName]({command:command,data:value}),command.hasOwnProperty("commands")&&_.each(command.commands,function(cmd){cmd.executed=!0,cmd.failed=command.failed,self._invokeCommandCallbackR(callbackName,cmd.callbacks,cmd,value)})},"api removeFromList":function(command){var self=this,callbacks=command.callbacks;command.config.$set=command.config.$set||{},command.callbacks={success:function(r){var newValues=_.extend(_.extend({},command.config.$set),r),register=self.db.removeFromList(command.config.id,command.type,command.config.$set);self._invokeCommandCallback("success",callbacks,command,{}),self._notifyAboutNewsAndChanges(register,command)},failure:function(r){command.failed=!0,self._invokeCommandCallback("failure",callbacks,command,r)}},self._populateBeforeSaveEvent(command),self._processFieldsConfig(command,"_getEmptyArray"),self.service.removeFromList(command)},"api remove":function(command){var self=this,callbacks=command.callbacks;command.callbacks={success:function(r){var register=self.evictPersistedObject(command.config.id,command.type);self._populateAfterRemoveEvent(command,register),self._invokeCommandCallback("success",callbacks,command,command.callbacks)},failure:function(r){command.failed=!0,self._invokeCommandCallback("failure",callbacks,command,r)}},self._populateBeforeRemoveEvent(command),self.service.remove(command)},evictPersistedObject:function(id,type){return this.db.remove(id,this.types[type].name)},evictProperties:function(id,type,arrayOfPropertyNames){this.db.removeProperties(id,this.types[type].name,arrayOfPropertyNames)},evictData:function(){this._initDb()},evictCollection:function(type){this.db.removeCollection(type),this.unmarkRecordSetAsCompleteLoaded(type)},isPropertyInitialized:function(id,type,propertyName){return this.db.isPropertyInitialized(id,type,propertyName)},"api save":function(command){var self=this,callbacks=command.callbacks;command.config.$set=command.config.$set||{},command.callbacks={success:function(r){_.extend(r,{__type:command.type});var newValues={};if(_.isArray(command.config.$set)){newValues=[];for(var i=0;i<command.config.$set.length;i++){var value=_.extend(_.extend({__type:command.type},command.config.$set[i]),r[i]);newValues.push(value)}}else newValues=_.extend(_.extend({},command.config.$set),r);var register=self.db.register(newValues);self._notifyAboutNewsAndChanges(register,command),self._invokeCommandCallback("success",callbacks,command,newValues)},failure:function(r){command.failed=!0,self._invokeCommandCallback("failure",callbacks,command,r)}},self._populateBeforeSaveEvent(command),self._processFieldsConfig(command,"_getEmptyArray"),self.service.save(command)},_notifyAboutNewsAndChanges:function(register,cmd){var self=this;_.each(_.keys(register.tree),function(type){_.each(_(register.tree[type]).values(),function(r){self._populateEvent(cmd,"afterSave",r,{id:r.id,type:type})})})},_populateEvent:function(cmd,eventName,nodeEvent,obj){var id=_.uniqueId("repositoryEvent"),listeners=this._getListeners({type:obj.type,eventName:eventName,nodeEvent:nodeEvent,obj:obj});if(listeners.length!==0){var args={id:id,name:eventName,data:{id:obj.id,type:obj.type,cmd:cmd,obj:obj,changes:nodeEvent.changes}};_(listeners).each(function(listener){listener.callback(args)})}},_populateBeforeRemoveEvent:function(cmd){this._populateEvent(cmd,"beforeRemove",{},{id:cmd.config.id,type:cmd.type})},_populateAfterRemoveEvent:function(cmd,register){var self=this;_.each(register.deletedData,function(dataNode){self._populateEvent(cmd,"afterRemove",{},dataNode)}),self._notifyAboutNewsAndChanges(register,cmd)},_populateBeforeSaveEvent:function(cmd){this._populateEvent(cmd,"beforeSave",{changes:cmd.config.$set||{}},{id:cmd.config.id,type:cmd.type})},markRecordSetAsCompleteLoaded:function(type){this.__allTypeLoadMarkers[type]=!0},unmarkRecordSetAsCompleteLoaded:function(type){this.__allTypeLoadMarkers[type]=!1},isTypeMarkedAsCompleteLoaded:function(type){return this.__allTypeLoadMarkers[type]===!0},_appendDiscriminator:function(typeDefinition,notInitializedFields){var self=this;if(!typeDefinition)throw new Error("Table name is not defined");typeDefinition.isParentType&&_.indexOf(notInitializedFields,"id")>=0&&self._autoAppend(notInitializedFields,[typeDefinition.discriminator],"push"),_.each(notInitializedFields,function(field){if(tauHeader.header.isSimple(field))return;var fieldName=tauHeader.header.getFieldName(field),ref=typeDefinition.refs[fieldName];ref&&self._appendDiscriminator(self.types[ref.name],field[fieldName])})},_processCommandForGet:function(command){var self=this,persistedObject=self.db.get(command.config.id,command.type,command.config),$fields=command.config.fields;if(persistedObject.notInitializedFields.length===0)if(!persistedObject.all||!!self.isTypeMarkedAsCompleteLoaded(command.type))return command.config.fields=$fields,self._invokeCommandCallback("success",command.callbacks,command,persistedObject.data),{isInvoked:!0};var notInitializedFields=persistedObject.notInitializedFields;return persistedObject.all&&!self.isTypeMarkedAsCompleteLoaded(command.type)&&(notInitializedFields=_.clone($fields)),{isInvoked:!1,fields:notInitializedFields}},_runReadCommand:function(command,originFields,notInitializedFields,fnProcess){var self=this;try{self._appendDiscriminator(self.types[command.type],notInitializedFields)}catch(e){command.failed=!0,command.callbacks.failure(null,e);return}_.extend(command.config,{fields:notInitializedFields}),self._processFieldsConfig(command);var callbacks=command.callbacks;command.callbacks={success:function(r){command.config.fields=originFields,_.defaults(r,{__type:command.type});var register=self.db.register(r),dataToReturn=fnProcess(r,register);self._invokeCommandCallback("success",callbacks,command,dataToReturn),command.callbacks=callbacks},failure:function(r){command.config.fields=originFields,command.failed=!0,self._invokeCommandCallback("failure",callbacks,command,r),command.callbacks=callbacks}},this.service[command.name](command)},"api refresh":function(command){var self=this,$fields=command.config.fields,processResponse=function(r,register){return self._notifyAboutNewsAndChanges(register,command),self.db.get(command.config.id,command.type,{fields:$fields}).data};this._runReadCommand(command,$fields,_.clone($fields),processResponse)},"api turboGet":function(command){var self=this,$fields=command.config.fields||[];self._autoAppend($fields,["id"]);var callbacks=command.callbacks;command.callbacks={success:function(r){_.defaults(r,{__type:command.type}),self._invokeCommandCallback("success",callbacks,command,r),command.callbacks=callbacks},failure:function(r){command.failed=!0,self._invokeCommandCallback("failure",callbacks,command,r),command.callbacks=callbacks}},this.service[command.name](command)},"api find":function(command){var self=this,$fields=command.config.fields,processResponse=function(r){var dataToReturn=[];_.each(r,function(record){dataToReturn.push(self.db.get(record.id,command.type,{fields:$fields}).data)});if(r.hasOwnProperty("getNextPage")){dataToReturn.isNextPageAvailable=function(){return!0};var cmdClone=_.clone(command);cmdClone.config=_.clone(cmdClone.config),cmdClone.config.$skip=cmdClone.config.$skip+cmdClone.config.$limit,dataToReturn.getNextPageCommand=function(){return cmdClone}}else dataToReturn.isNextPageAvailable=function(){return!1};return dataToReturn};this._runReadCommand(command,$fields,_.clone($fields),processResponse)},"api get":function(command){var self=this,$fields=command.config.fields,_processCommandForGet=self._processCommandForGet(command);if(_processCommandForGet.isInvoked)return;var processResponse=function(r){return command.config.id||self.markRecordSetAsCompleteLoaded(command.type),self.db.get(command.config.id,command.type,{fields:$fields}).data};this._runReadCommand(command,$fields,_processCommandForGet.fields,processResponse)}});return repository});
define('tau/store/services/formatProperties',[],function(){return{customFields:{}}});
define('tau/store/services/service.arrayToJsonConverter',["Underscore","tau/store/header","tau/store/services/formatProperties"],function(_,tau,properties){return{convertArray:function(config,array){var self=this,result=[],nextPages=[];return array.next&&nextPages.push(tau.getNextPage(result,array.next,config.header)),array=array.items?array.items:array,_.each(array,function(value){var v=self.convert(config,value);result.push(v.data),nextPages=nextPages.concat(v.nextPages)}),{data:result,nextPages:nextPages}},convert:function(config,array){var obj={},self=this,nextPages=[];for(var i=0,len=config.header.length;i<len;i++){var value=array[i];_.isUndefined(value)&&(value=null);var field=config.header[i];if(tau.header.isSimple(field)){properties.hasOwnProperty(field)&&(value=tau.formatObject(value).data),obj[field]=value;continue}var key=tau.header.getFieldName(field),isList=field.list===!0;!_.isNull(value)&&(value.hasOwnProperty("items")||value.hasOwnProperty("Items"))&&(isList=!0);if(_.isEmpty(value)&&!isList){obj[key]=null;continue}if(!_.isNull(value)){var refConfig={header:field[key]},originalValue=value;if(value.hasOwnProperty("items")||value.hasOwnProperty("Items"))value=value.items||value.Items;if(isList){var arr=[];_.each(value,function(a){var converted=self.convert(refConfig,a);nextPages=nextPages.concat(converted.nextPages),arr.push(converted.data)}),value=arr,originalValue.next&&nextPages.push(tau.getNextPage(arr,originalValue.next,refConfig.header))}else{var convertedV=self.convert(refConfig,value);nextPages=nextPages.concat(convertedV.nextPages),value=convertedV.data}}_.isNull(value)&&isList&&(value=[]),obj.hasOwnProperty(key)?_.extend(obj[key],value):obj[key]=value}return{data:obj,nextPages:nextPages}}}});
var JSON;JSON||(JSON={}),function(){function f(n){return n<10?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c=="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];value&&typeof value=="object"&&typeof value.toJSON=="function"&&(value=value.toJSON(key)),typeof rep=="function"&&(value=rep.call(holder,key,value));switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";gap+=indent,partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1)partial[i]=str(i,value)||"null";return v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&typeof rep=="object"){length=rep.length;for(i=0;i<length;i+=1)typeof rep[i]=="string"&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v))}else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(value,replacer,space){var i;gap="",indent="";if(typeof space=="number")for(i=0;i<space;i+=1)indent+=" ";else typeof space=="string"&&(indent=space);rep=replacer;if(!replacer||typeof replacer=="function"||typeof replacer=="object"&&typeof replacer.length=="number")return str("",{"":value});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value=="object")for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),v!==undefined?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();
define("libs/json2", function(){});

define('tau/store/services/service.rest',["Underscore","jQuery","tau/core/Class","tau/store/types","tau/store/services/service.arrayToJsonConverter","tau/store/header","tau/core/tau","libs/json2"],function(_,$,Class,tauTypes,arrayToJsonConverter,tauHeader,utils){var serviceRest=Class.extend({init:function(config){config=config||{},_.defaults(config,{api:$,types:tauTypes.getDictionary()}),this.config=config},removeFromList:function(command){var self=this,fieldName=tauHeader.header.getFieldName(command.config.$set),config={url:self.getUrl(command)+"/"+fieldName+"/"+command.config.$set[fieldName].id,contentType:"application/json; charset=utf-8",type:"POST",processData:!1,dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override","DELETE")}},errorCallback=this.getErrorCallback(command);self.config.api.ajax(config).success(function(){command.callbacks.success({id:command.config.id})}).error(errorCallback)},remove:function(command){var self=this,serviceCommand={Id:command.config.id},config={url:self.getUrl(command),contentType:"application/json; charset=utf-8",type:"POST",processData:!1,data:JSON.stringify(serviceCommand),dataType:"json",beforeSend:function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override","DELETE")}},errorCallback=this.getErrorCallback(command);self.config.api.ajax(config).success(function(){command.callbacks.success({id:command.config.id})}).error(errorCallback)},save:function(command){var ext={$set:command.config.$set||{}};if(command.type==="prioritizer"){_.extend(ext,{$include:this._formIncludes(command.config.fields)}),this.executeCrudCommandViaPageService(command,ext,"save");return}this.executeCrudCommand(command,ext,"save")},getErrorCallback:function(command){var path=this.config.appPath;return function(err){if(err.status===401){document.location.href=path+"/login.aspx?ReturnUrl="+document.location.href;return}try{err.response=$.parseJSON(err.responseText)}catch(e){}finally{command.callbacks.failure(err)}}},executeCrudCommandViaPageService:function(command,commandExt,operation){var self=this,serviceCommand={id:command.config.id,type:command.type};_.extend(serviceCommand,commandExt);var json=JSON.stringify({json:JSON.stringify(serviceCommand)}),config={url:[self.config.appPath,"PageServices/RESTCrud.asmx",operation].join("/"),contentType:"application/json; charset=utf-8",type:"POST",data:json,dataType:"json"},errorCallback=this.getErrorCallback(command);self.config.api.ajax(config).success(function(result){var r={id:result.d.id};if(result.d.isError===!0){command.callbacks.failure({Message:result.d.errorMessage,CRUD:!0});return}if(result.d.jsonToReturn&&result.d.jsonToReturn.length>0){var obj=$.parseJSON(result.d.jsonToReturn);obj=tauHeader.formatObject(obj),_.extend(r,obj.data)}command.callbacks.success(r)}).error(errorCallback)},executeCrudCommand:function(command,commandExt){var self=this;_.defaults(command.config,{format:"json"});var $set=commandExt.$set,serviceCommand={id:command.config.id};_.isArray($set)?serviceCommand=$set:_.extend(serviceCommand,$set);var url=self.getUrl(command,"resultInclude"),format=command.config.format,fields=self._getFields(command),config=self._getApiConfig(url,format,"convert",fields);_.extend(config,{url:url,contentType:"application/json; charset=utf-8",type:"POST",processData:!1,data:JSON.stringify(serviceCommand),dataType:"json"}),self._executeApiCall(command,"json",config)},find:function(command){this.get(command)},refresh:function(command){this.get(command)},getCompleteCallback:function(command){var self=this;return function(r){command.type==="implementationHistory"&&(command.config.hasOwnProperty("acid")?r.id=command.config.acid:command.config.hasOwnProperty("ids")?r.id=r.acid:r.id=command.config.id),command.type==="context"&&(command.config.hasOwnProperty("id")?r.id=command.config.id:r.id=r.acid);if(command.config.nested===!0){var nestedObject=self._getNestedObject(command),nestedResource=tauHeader.header.getFieldName(nestedObject),temp={id:command.config.id};temp[nestedResource]=r,r=temp}command.callbacks.success(r)}},_getArrayConverter:function(fnConvertName,fields){var self=this;return function(textValue){var jsonR=self.config.api.parseJSON(textValue);return arrayToJsonConverter[fnConvertName]({header:fields},jsonR)}},_getJsonConverter:function(){var self=this;return function(textValue){var jsonR=self.config.api.parseJSON(textValue);return tauHeader.formatObject(jsonR)}},_getApiConfig:function(url,format,fnConvertName,fields){var self=this;return{url:url,accepts:{array:"application/x-array"},dataType:format,converters:{"text array":self._getArrayConverter(fnConvertName,fields),"text json":self._getJsonConverter()}}},_getNextPageFields:function(nextPage){var fields=nextPage.fields,include=utils.getQueryValueFromUrl(nextPage.url,"include");return include&&include.length>0&&(fields=tauHeader.parseFieldsFromString(include)),fields},_executeApiCall:function(command,format,config){var self=this,errorCallback=self.getErrorCallback(command),completeCallback=self.getCompleteCallback(command),result=null,nextPages=[],fireIsCompletedIfRequired=function(){var isCompletedCalls=nextPages.length===0;return isCompletedCalls&&completeCallback(result),isCompletedCalls},askNextPages=function(r){for(var j=0,l=r.nextPages.length;j<l;j++){var nextPage=r.nextPages[j];processNextPage(nextPage)}},processNextPage=function(nextPage){var fields=self._getNextPageFields(nextPage),pageConfig=self._getApiConfig(nextPage.url,format,"convertArray",fields);self.config.api.ajax(pageConfig).success(function(r){nextPages=nextPages.concat(r.nextPages||[]);var holder=nextPage.holder;_.each(r.data,function(v){holder.push(v)}),r.data.getNextPage&&(r.data.getNextPage().holder=nextPage.holder),askNextPages(r);var index=_.indexOf(nextPages,nextPage);nextPages.splice(index,1),fireIsCompletedIfRequired()}).error(errorCallback)},processResponse=function(r){result=r.data;if(command.name==="find"){completeCallback(result);return}nextPages=nextPages.concat(r.nextPages||[]),fireIsCompletedIfRequired(),askNextPages(r)};self.config.api.ajax(config).success(processResponse).error(errorCallback)},get:function(command){var self=this;_.defaults(command.config,{format:"array"});var fnConvertName=command.config.nested===!0||!command.config.id?"convertArray":"convert",url=self.getUrl(command),format=command.config.format,fields=self._getFields(command),config=self._getApiConfig(url,format,fnConvertName,fields);self._executeApiCall(command,format,config)},turboGet:function(command){this.get(command)},_formIncludes:function(fields){var includes=[],self=this;return _.each(fields,function(field){if(tauHeader.header.isSimple(field)){var f=field;field.indexOf("$ref")===0&&(f=field.replace("$ref:","")),includes.push(f);return}var fieldName=tauHeader.header.getFieldName(field);includes.push(fieldName+self._formIncludes(field[fieldName]))}),["[",includes.join(","),"]"].join("")},_getQueryOperators:function(){var defaultRenderer=function(key,value){var self=this,outR=[];return _.isArray(value)||(value=[value]),_.each(value,function(v){outR.push("("+key+" "+self.name+" "+JSON.stringify(v)+")")}),outR},nullRenderer=function(key){return["("+key+" "+this.name+")"]},inRenderer=function(key,value){var self=this,outR=[];_.isArray(value)||(value=[value]);var res=[];return _(value).each(function(vr){res.push(JSON.stringify(vr))}),outR.push("("+key+" "+self.name+" ("+res.join(",")+"))"),outR};return{$in:{name:"in",render:inRenderer},$ne:{name:"ne",render:defaultRenderer},$gt:{name:"gt",render:defaultRenderer},$gte:{name:"gte",render:defaultRenderer},$lt:{name:"lt",render:defaultRenderer},$lte:{name:"lte",render:defaultRenderer},$contains:{name:"contains",render:defaultRenderer},$eq:{name:"eq",render:defaultRenderer},$isNull:{name:"is null",render:nullRenderer},$isNotNull:{name:"is not null",render:nullRenderer}}},_isQueryValueWithOperator:function(queryValue,operators){var keys=_(queryValue).keys();if(keys.length===0)return!1;var $operators=operators||this._getQueryOperators();return $operators.hasOwnProperty(keys[0])},_formWhere:function($query,prefix){var filters=[],self=this;prefix=prefix||"";var operators=self._getQueryOperators();return _.each(_($query).keys(),function(key){var value=$query[key],queryKey=prefix+key;if(_.isString(value)||_.isNumber(value)||_.isDate(value)||_.isArray(value)||_.isBoolean(value)||_.isNull(value)){var $operator=value===null?"$isNull":"$eq";filters=filters.concat(operators[$operator].render(queryKey,value));return}if(self._isQueryValueWithOperator(value,operators)){_.each(_(value).keys(),function(op){filters=filters.concat(operators[op].render(queryKey,value[op]))});return}filters.push(self._formWhere(value,queryKey+"."))}),filters},_getWhere:function($query){var filters=this._formWhere($query);return filters.length===0?"":"&where="+encodeURIComponent(_.flatten(filters).join(" and "))},_getNestedObject:function(command){var nestedObject=null;return _.each(command.config.fields,function(field){tauHeader.header.isSimple(field)||(nestedObject=field)}),nestedObject},_getFields:function(command){if(command.config.nested!==!0)return command.config.fields;var nestedObject=this._getNestedObject(command),nestedResource=tauHeader.header.getFieldName(nestedObject);return nestedObject[nestedResource]},_getOrderBy:function(command){return!command.config.$orderBy||command.config.$orderBy===""?"":"&orderBy="+command.config.$orderBy},_getOrderByDesc:function(command){return!command.config.$orderByDesc||command.config.$orderByDesc===""?"":"&orderByDesc="+command.config.$orderByDesc},_encodeRestParams:function(params){return _.isObject(params)&&(params=_.map(params,function(v,k){return{name:k,value:_.isArray(v)?v.join(","):v}})),decodeURIComponent($.param(params))},getUrl:function(command,includeParamName){var self=this,defaults={$skip:0,$limit:999,$query:{}},config=command.config;_.defaults(config,defaults);if(command.type==="context"){config.format="json";if(config.hasOwnProperty("acid"))return[self.config.path,"context.asmx","?acid="+config.acid].join("/");var params={};return params.ids=config.id||config.ids,params.ids||(params.projectIds=config.projectIds||config.projectId||"*",params.teamIds=config.teamIds||config.teamId||"*"),_.each(params,function(v,k){v||delete params[k]}),[self.config.path,"context.asmx?"+self._encodeRestParams(params)].join("/")}if(command.type==="implementationHistory")return config.format="json",[self.config.appPath,"TpReports/ImplementationHistory.ashx?id="+config.id+"&"+(new Date).valueOf()].join("/");var type=self.config.types[command.type]||{resource:command.type},fields=config.fields,url=[self.config.path,type.resource+".asmx",config.id].join("/");if(config.nested===!0){var nestedObject=self._getNestedObject(command),nestedResource=tauHeader.header.getFieldName(nestedObject);fields=nestedObject[nestedResource],url=[url,nestedResource].join("/")}if(command.name&&command.name.indexOf("remove")>=0)return url;_.isArray(config.$set)&&(url+="bulk");var needWhere=command.name==="find"||command.name==="turboGet"||!_.isEmpty(config.$query);return url=[url,"?skip=",config.$skip,"&take=",config.$limit,"&",includeParamName?includeParamName:"include","=",self._formIncludes(fields),needWhere?self._getWhere(config.$query):"",self._getOrderBy(command),self._getOrderByDesc(command),utils.getTokenParameterFromQueryString("&")].join(""),url}});return serviceRest});
define('tau/rules/auto-include-beforeSave',["Underscore"],function(_){return{"auto include beforeSave":function(evt,rule){var self=this,obj=evt.data.obj;for(var i=0;i<rule.fields.length;i++){var field=rule.fields[i];(self.store.isPropertyInitialized(obj.id,obj.type,_.getFieldName(field))||rule.force)&&_.mergeFields(evt.data.cmd.config.fields,[field])}}}});
define('tau/rules/core',["Underscore","tau/core/class","tau/rules/auto-include-beforeSave"],function(_,Class,autoInclude){return Class.extend({init:function(config){var self=this;self.store=config.store||{},config.rulesImpl=config.rulesImpl||{},_.extend(self,autoInclude),_.extend(self,{name:"rules engine"}),_(config.rulesImpl).each(function(ruleImpl){_.extend(self,ruleImpl)}),self.register(config.rules||[])},register:function(rules){var self=this;_.isArray(rules)||(rules=[rules]),_(rules).each(function(rule){_.defaults(rule,{name:_(autoInclude).keys()[0],fields:[],changes:[]});if(!rule.hasOwnProperty("type"))throw"type should be configured for rule";if(rule.fields.length===0)return;_.each(rule.changes,function(change){var fnProcess=function(evt){self[rule.name](evt,rule)},parts=rule.name.split(" ");self.store.on({eventName:parts[parts.length-1],type:rule.type,listener:self,hasChanges:[change]},fnProcess)})})},registerRule:function(rule){var self=this;_.defaults(rule,{fields:[],changes:[]});if(!rule.hasOwnProperty("name"))throw'"name" field should be configured for rule';if(!rule.hasOwnProperty("type"))throw'"type" field should be configured for rule';if(!self.hasOwnProperty(rule.name))throw"unknown rule name ["+rule.name+"]";self[rule.name].call(self,rule)},destroy:function(){var store=this.store;delete this.store,store.unbind(this)}})});
define('tau/rules/rule.auto-include-before-save',["Underscore"],function(_){var fn=function(evt,rule){var rulesEngine=this,obj=evt.data.obj;for(var i=0;i<rule.fields.length;i++){var field=rule.fields[i];(obj.id&&rulesEngine.store.isPropertyInitialized(obj.id,obj.type,_.getFieldName(field))||rule.force)&&_.mergeFields(evt.data.cmd.config.fields,[field])}};return{"auto-include-before-save":function(rule){var rulesEngine=this;if(rule.fields.length===0)return;_.each(rule.changes,function(change){var storeChanges=[change],fnProcess=function(evt){fn.call(rulesEngine,evt,rule)};rulesEngine.store.on({eventName:"beforeSave",type:rule.type,listener:rulesEngine,hasChanges:storeChanges},fnProcess)})}}});
define('tau/rules/rule.auto-action-after-save',["Underscore"],function(_){var fn=function(evt,rule){var rulesEngine=this,evtData=evt.data,cfg={store:rulesEngine.store,data:evtData};rule.action(cfg)};return{"auto-action-after-save":function(rule){var rulesEngine=this,fnProcess=function(evt){fn.call(rulesEngine,evt,rule)},subscriptionConfig={eventName:"afterSave",type:rule.type,listener:rulesEngine};rule.hasOwnProperty("changes")&&rule.changes.length&&(subscriptionConfig.hasChanges=[rule.changes.join("|")]),rulesEngine.store.on(subscriptionConfig,fnProcess)}}});
define('tau/rules/rule.auto-include-before-remove',["Underscore"],function(_){var fn=function(evt,rule){var rulesEngine=this,obj=evt.data.obj;for(var i=0;i<rule.fields.length;i++){var field=rule.fields[i];_.mergeFields(evt.data.cmd.config.fields,[field])}};return{"auto-include-before-remove":function(rule){var rulesEngine=this;if(rule.fields.length===0)return;var fnProcess=function(evt){fn.call(rulesEngine,evt,rule)};rulesEngine.store.on({eventName:"beforeRemove",type:rule.type,listener:rulesEngine},fnProcess)}}});
define('tau/store/types.targetprocess.generated',["tau/store/types"],function(tauTypes){return[{name:"context"},{name:"process",parent:null,resource:"processes",aliases:["Process","processes","Processes"],fields:["id","name"],simpleFields:["id","name","isDefault","description","entityStates-count","projects-count","practices-count","customFields-count"],refs:{entityStates:{list:!0,name:"entityState",multiplicity:"one",relationProperty:"process"},projects:{list:!0,name:"project",multiplicity:"one",relationProperty:"process"},practices:{list:!0,name:"practice",multiplicity:"",relationProperty:""},customFields:{list:!0,name:"customField",multiplicity:"one",relationProperty:"process"}}},{name:"tag",parent:null,resource:"tags",aliases:["Tag","tags","Tags"],fields:["id","name"],simpleFields:["id","name","generals-count"],refs:{generals:{list:!0,name:"general",multiplicity:"",relationProperty:""}}},{name:"milestone",parent:null,resource:"milestones",aliases:["Milestone","milestones","Milestones"],fields:["id","name"],simpleFields:["id","name","description","date","cssClass","projects-count"],refs:{owner:{name:"user",multiplicity:"",relationProperty:"milestones"},projects:{list:!0,name:"project",multiplicity:"",relationProperty:""}}},{name:"practice",parent:null,resource:"practices",aliases:["Practice","practices","Practices"],fields:["id","name"],simpleFields:["id","name","description","processes-count"],refs:{processes:{list:!0,name:"process",multiplicity:"",relationProperty:""}}},{name:"entityType",parent:null,resource:"entityTypes",aliases:["EntityType","entityTypes","EntityTypes"],fields:["id","name"],simpleFields:["id","name","isExtendable","isSearchable","entityStates-count"],refs:{entityStates:{list:!0,name:"entityState",multiplicity:"one",relationProperty:"entityType"}}},{name:"priority",parent:null,resource:"priorities",aliases:["Priority","priorities","Priorities"],fields:["id","name"],simpleFields:["id","name","importance","isDefault"],refs:{entityType:{name:"entityType",multiplicity:"",relationProperty:"priorities"}}},{name:"severity",parent:null,resource:"severities",aliases:["Severity","severities","Severities"],fields:["id","name"],simpleFields:["id","name","importance","isDefault"],refs:{}},{name:"entityState",parent:null,resource:"entityStates",aliases:["EntityState","entityStates","EntityStates"],fields:["id","name"],simpleFields:["id","name","isInitial","isFinal","isPlanned","isCommentRequired","numericPriority","nextStates-count","previousStates-count"],refs:{role:{name:"role",multiplicity:"",relationProperty:"entityStates"},nextStates:{list:!0,name:"entityState",multiplicity:"",relationProperty:""},previousStates:{list:!0,name:"entityState",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"entityStates"},process:{name:"process",multiplicity:"",relationProperty:"entityStates"}}},{name:"general",parent:null,resource:"generals",aliases:["General","generals","Generals"],fields:["id","name"],simpleFields:["id","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"assignable",parent:"general",resource:"assignables",aliases:["Assignable","assignables","Assignables"],fields:["id","name"],simpleFields:["id","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},release:{name:"release",multiplicity:"",relationProperty:"assignables"},iteration:{name:"iteration",multiplicity:"",relationProperty:"assignables"},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"assignables"},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"generalUser",parent:null,resource:"generalUsers",aliases:["GeneralUser","generalUsers","GeneralUsers"],fields:["id","firstName","lastName"],simpleFields:["id","firstName","lastName","email","login","createDate","modifyDate","deleteDate","isActive","isAdministrator","kind","password","avatarUri","assignables-count","comments-count","requests-count"],refs:{assignables:{list:!0,name:"assignable",multiplicity:"",relationProperty:""},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"owner"},requests:{list:!0,name:"request",multiplicity:"",relationProperty:""}}},{name:"user",parent:"generalUser",resource:"users",aliases:["User","users","Users"],fields:["id","activeDirectoryName","firstName","lastName"],simpleFields:["id","weeklyAvailableHours","currentAllocation","currentAvailableHours","availableFrom","availableFutureAllocation","availableFutureHours","isObserver","skills","activeDirectoryName","firstName","lastName","email","login","createDate","modifyDate","deleteDate","isActive","isAdministrator","kind","password","avatarUri","times-count","impediments-count","customActivities-count","revisions-count","teamMembers-count","projectMembers-count","milestones-count","assignables-count","comments-count","requests-count"],refs:{role:{name:"role",multiplicity:"",relationProperty:""},times:{list:!0,name:"time",multiplicity:"one",relationProperty:"user"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"responsible"},customActivities:{list:!0,name:"customActivity",multiplicity:"one",relationProperty:"user"},revisions:{list:!0,name:"revision",multiplicity:"one",relationProperty:"author"},teamMembers:{list:!0,name:"teamMember",multiplicity:"one",relationProperty:"user"},projectMembers:{list:!0,name:"projectMember",multiplicity:"one",relationProperty:"user"},milestones:{list:!0,name:"milestone",multiplicity:"one",relationProperty:"owner"},assignables:{list:!0,name:"assignable",multiplicity:"",relationProperty:""},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"owner"},requests:{list:!0,name:"request",multiplicity:"",relationProperty:""}}},{name:"requester",parent:"generalUser",resource:"requesters",aliases:["Requester","requesters","Requesters"],fields:["id","firstName","lastName"],simpleFields:["id","phone","notes","sourceType","firstName","lastName","email","login","createDate","modifyDate","deleteDate","isActive","isAdministrator","kind","password","avatarUri","assignables-count","comments-count","requests-count"],refs:{company:{name:"company",multiplicity:"",relationProperty:""},assignables:{list:!0,name:"assignable",multiplicity:"",relationProperty:""},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"owner"},requests:{list:!0,name:"request",multiplicity:"",relationProperty:""}}},{name:"project",parent:"general",resource:"projects",aliases:["Project","projects","Projects"],fields:["id","name"],simpleFields:["id","isActive","isProduct","abbreviation","mailReplyAddress","color","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","generals-count","features-count","releases-count","iterations-count","userStories-count","tasks-count","bugs-count","testCases-count","testPlans-count","builds-count","times-count","revisions-count","customActivities-count","projectMembers-count","teamProjects-count","requests-count","testPlanRuns-count","milestones-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{generals:{list:!0,name:"general",multiplicity:"one",relationProperty:"project"},program:{name:"program",multiplicity:"",relationProperty:"projects"},process:{name:"process",multiplicity:"",relationProperty:"projects"},features:{list:!0,name:"feature",multiplicity:"one",relationProperty:"project"},releases:{list:!0,name:"release",multiplicity:"one",relationProperty:"project"},iterations:{list:!0,name:"iteration",multiplicity:"one",relationProperty:"project"},userStories:{list:!0,name:"userStory",multiplicity:"one",relationProperty:"project"},tasks:{list:!0,name:"task",multiplicity:"one",relationProperty:"project"},bugs:{list:!0,name:"bug",multiplicity:"one",relationProperty:"project"},testCases:{list:!0,name:"testCase",multiplicity:"one",relationProperty:"project"},testPlans:{list:!0,name:"testPlan",multiplicity:"one",relationProperty:"project"},builds:{list:!0,name:"build",multiplicity:"one",relationProperty:"project"},times:{list:!0,name:"time",multiplicity:"one",relationProperty:"project"},revisions:{list:!0,name:"revision",multiplicity:"one",relationProperty:"project"},customActivities:{list:!0,name:"customActivity",multiplicity:"one",relationProperty:"project"},company:{name:"company",multiplicity:"",relationProperty:"projects"},projectMembers:{list:!0,name:"projectMember",multiplicity:"one",relationProperty:"project"},teamProjects:{list:!0,name:"teamProject",multiplicity:"one",relationProperty:"project"},requests:{list:!0,name:"request",multiplicity:"one",relationProperty:"project"},testPlanRuns:{list:!0,name:"testPlanRun",multiplicity:"one",relationProperty:"project"},milestones:{list:!0,name:"milestone",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"program",parent:"general",resource:"programs",aliases:["Program","programs","Programs"],fields:["id","name"],simpleFields:["id","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","projects-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{projects:{list:!0,name:"project",multiplicity:"zeroOrOne",relationProperty:"program"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"release",parent:"general",resource:"releases",aliases:["Release","releases","Releases"],fields:["id","name"],simpleFields:["id","isCurrent","units","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","iterations-count","assignables-count","features-count","userStories-count","tasks-count","bugs-count","testPlanRuns-count","requests-count","builds-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"releases"},iterations:{list:!0,name:"iteration",multiplicity:"one",relationProperty:"release"},assignables:{list:!0,name:"assignable",multiplicity:"zeroOrOne",relationProperty:"release"},features:{list:!0,name:"feature",multiplicity:"zeroOrOne",relationProperty:"release"},userStories:{list:!0,name:"userStory",multiplicity:"zeroOrOne",relationProperty:"release"},tasks:{list:!0,name:"task",multiplicity:"zeroOrOne",relationProperty:"release"},bugs:{list:!0,name:"bug",multiplicity:"zeroOrOne",relationProperty:"release"},testPlanRuns:{list:!0,name:"testPlanRun",multiplicity:"zeroOrOne",relationProperty:"release"},requests:{list:!0,name:"request",multiplicity:"zeroOrOne",relationProperty:"release"},builds:{list:!0,name:"build",multiplicity:"one",relationProperty:"release"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"iteration",parent:"general",resource:"iterations",aliases:["Iteration","iterations","Iterations"],fields:["id","name"],simpleFields:["id","isCurrent","velocity","duration","units","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","assignables-count","userStories-count","tasks-count","bugs-count","testPlanRuns-count","requests-count","builds-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"iterations"},release:{name:"release",multiplicity:"",relationProperty:"iterations"},assignables:{list:!0,name:"assignable",multiplicity:"zeroOrOne",relationProperty:"iteration"},userStories:{list:!0,name:"userStory",multiplicity:"zeroOrOne",relationProperty:"iteration"},tasks:{list:!0,name:"task",multiplicity:"zeroOrOne",relationProperty:"iteration"},bugs:{list:!0,name:"bug",multiplicity:"zeroOrOne",relationProperty:"iteration"},testPlanRuns:{list:!0,name:"testPlanRun",multiplicity:"zeroOrOne",relationProperty:"iteration"},requests:{list:!0,name:"request",multiplicity:"zeroOrOne",relationProperty:"iteration"},builds:{list:!0,name:"build",multiplicity:"zeroOrOne",relationProperty:"iteration"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"teamIteration",parent:"general",resource:"teamIterations",aliases:["TeamIteration","teamIterations","TeamIterations"],fields:["id","name"],simpleFields:["id","isCurrent","velocity","duration","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","assignables-count","userStories-count","tasks-count","bugs-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{team:{name:"team",multiplicity:"",relationProperty:"teamIterations"},assignables:{list:!0,name:"assignable",multiplicity:"zeroOrOne",relationProperty:"teamIteration"},userStories:{list:!0,name:"userStory",multiplicity:"zeroOrOne",relationProperty:"teamIteration"},tasks:{list:!0,name:"task",multiplicity:"zeroOrOne",relationProperty:"teamIteration"},bugs:{list:!0,name:"bug",multiplicity:"zeroOrOne",relationProperty:"teamIteration"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"team",parent:"general",resource:"teams",aliases:["Team","teams","Teams"],fields:["id","name"],simpleFields:["id","icon","isActive","abbreviation","iconUri","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","teamMembers-count","teamProjects-count","assignables-count","teamIterations-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{teamMembers:{list:!0,name:"teamMember",multiplicity:"one",relationProperty:"team"},teamProjects:{list:!0,name:"teamProject",multiplicity:"one",relationProperty:"team"},assignables:{list:!0,name:"assignable",multiplicity:"zeroOrOne",relationProperty:"team"},teamIterations:{list:!0,name:"teamIteration",multiplicity:"one",relationProperty:"team"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"feature",parent:"assignable",resource:"features",aliases:["Feature","features","Features"],fields:["id","name"],simpleFields:["id","initialEstimate","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","userStories-count","history-count","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"features"},release:{name:"release",multiplicity:"",relationProperty:"features"},userStories:{list:!0,name:"userStory",multiplicity:"zeroOrOne",relationProperty:"feature"},history:{list:!0,name:"featureHistory",multiplicity:"one",relationProperty:"feature"},assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},iteration:{name:"iteration",multiplicity:"",relationProperty:"assignables"},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"assignables"},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"userStory",parent:"assignable",resource:"userStories",aliases:["UserStory","userStories","UserStories"],fields:["id","name"],simpleFields:["id","initialEstimate","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","tasks-count","bugs-count","testCases-count","times-count","history-count","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"userStories"},feature:{name:"feature",multiplicity:"",relationProperty:"userStories"},tasks:{list:!0,name:"task",multiplicity:"zeroOrOne",relationProperty:"userStory"},bugs:{list:!0,name:"bug",multiplicity:"zeroOrOne",relationProperty:"userStory"},testCases:{list:!0,name:"testCase",multiplicity:"zeroOrOne",relationProperty:"userStory"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"userStory"},release:{name:"release",multiplicity:"",relationProperty:"userStories"},iteration:{name:"iteration",multiplicity:"",relationProperty:"userStories"},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"userStories"},history:{list:!0,name:"userStoryHistory",multiplicity:"one",relationProperty:"userStory"},assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"userStoryHistory",parent:null,resource:"userStoryHistories",aliases:["UserStoryHistory","userStoryHistories","UserStoryHistories"],fields:["id"],simpleFields:["id","date"],refs:{entityState:{name:"entityState",multiplicity:"",relationProperty:"userStoryHistories"},modifier:{name:"generalUser",multiplicity:"",relationProperty:"userStoryHistories"},userStory:{name:"userStory",multiplicity:"",relationProperty:"history"}}},{name:"bugHistory",parent:null,resource:"bugHistories",aliases:["BugHistory","bugHistories","BugHistories"],fields:["id"],simpleFields:["id","date"],refs:{entityState:{name:"entityState",multiplicity:"",relationProperty:"bugHistories"},modifier:{name:"generalUser",multiplicity:"",relationProperty:"bugHistories"},bug:{name:"bug",multiplicity:"",relationProperty:"history"}}},{name:"featureHistory",parent:null,resource:"featureHistories",aliases:["FeatureHistory","featureHistories","FeatureHistories"],fields:["id"],simpleFields:["id","date"],refs:{entityState:{name:"entityState",multiplicity:"",relationProperty:"featureHistories"},modifier:{name:"generalUser",multiplicity:"",relationProperty:"featureHistories"},feature:{name:"feature",multiplicity:"",relationProperty:"history"}}},{name:"requestHistory",parent:null,resource:"requestHistories",aliases:["RequestHistory","requestHistories","RequestHistories"],fields:["id"],simpleFields:["id","date"],refs:{entityState:{name:"entityState",multiplicity:"",relationProperty:"requestHistories"},modifier:{name:"generalUser",multiplicity:"",relationProperty:"requestHistories"},request:{name:"request",multiplicity:"",relationProperty:"history"}}},{name:"taskHistory",parent:null,resource:"taskHistories",aliases:["TaskHistory","taskHistories","TaskHistories"],fields:["id"],simpleFields:["id","date"],refs:{entityState:{name:"entityState",multiplicity:"",relationProperty:"taskHistories"},modifier:{name:"generalUser",multiplicity:"",relationProperty:"taskHistories"},task:{name:"task",multiplicity:"",relationProperty:"history"}}},{name:"impedimentHistory",parent:null,resource:"impedimentHistories",aliases:["ImpedimentHistory","impedimentHistories","ImpedimentHistories"],fields:["id"],simpleFields:["id","date"],refs:{entityState:{name:"entityState",multiplicity:"",relationProperty:"impedimentHistories"},modifier:{name:"generalUser",multiplicity:"",relationProperty:"impedimentHistories"},impediment:{name:"impediment",multiplicity:"",relationProperty:"history"}}},{name:"task",parent:"assignable",resource:"tasks",aliases:["Task","tasks","Tasks"],fields:["id","name"],simpleFields:["id","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","times-count","history-count","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"tasks"},userStory:{name:"userStory",multiplicity:"",relationProperty:"tasks"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"task"},release:{name:"release",multiplicity:"",relationProperty:"tasks"},iteration:{name:"iteration",multiplicity:"",relationProperty:"tasks"},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"tasks"},history:{list:!0,name:"taskHistory",multiplicity:"one",relationProperty:"task"},assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"bug",parent:"assignable",resource:"bugs",aliases:["Bug","bugs","Bugs"],fields:["id","name"],simpleFields:["id","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","times-count","history-count","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"bugs"},build:{name:"build",multiplicity:"",relationProperty:"bugs"},userStory:{name:"userStory",multiplicity:"",relationProperty:"bugs"},severity:{name:"severity",multiplicity:"",relationProperty:"bugs"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"bug"},release:{name:"release",multiplicity:"",relationProperty:"bugs"},iteration:{name:"iteration",multiplicity:"",relationProperty:"bugs"},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"bugs"},history:{list:!0,name:"bugHistory",multiplicity:"one",relationProperty:"bug"},assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"testCase",parent:"general",resource:"testCases",aliases:["TestCase","testCases","TestCases"],fields:["id","name"],simpleFields:["id","steps","success","lastStatus","lastFailureComment","lastRunDate","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","testPlans-count","testCaseRuns-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"testCases"},userStory:{name:"userStory",multiplicity:"",relationProperty:"testCases"},priority:{name:"priority",multiplicity:"",relationProperty:"testCases"},testPlans:{list:!0,name:"testPlan",multiplicity:"",relationProperty:""},testCaseRuns:{list:!0,name:"testCaseRun",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"testCaseRun",parent:null,resource:"testCaseRuns",aliases:["TestCaseRun","testCaseRuns","TestCaseRuns"],fields:["id"],simpleFields:["id","executed","passed","comment","runDate","testCases-count"],refs:{testPlanRun:{name:"testPlanRun",multiplicity:"",relationProperty:"testCaseRuns"},testCases:{list:!0,name:"testCase",multiplicity:"",relationProperty:""}}},{name:"testPlan",parent:"general",resource:"testPlans",aliases:["TestPlan","testPlans","TestPlans"],fields:["id","name"],simpleFields:["id","initialEstimate","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","testCases-count","testPlanRuns-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"testPlans"},testCases:{list:!0,name:"testCase",multiplicity:"",relationProperty:""},testPlanRuns:{list:!0,name:"testPlanRun",multiplicity:"one",relationProperty:"testPlan"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"testPlanRun",parent:"assignable",resource:"testPlanRuns",aliases:["TestPlanRun","testPlanRuns","TestPlanRuns"],fields:["id","name"],simpleFields:["id","passedCount","failedCount","notRunCount","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","testCaseRuns-count","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{release:{name:"release",multiplicity:"",relationProperty:"testPlanRuns"},build:{name:"build",multiplicity:"",relationProperty:"testPlanRuns"},iteration:{name:"iteration",multiplicity:"",relationProperty:"testPlanRuns"},testPlan:{name:"testPlan",multiplicity:"",relationProperty:"testPlanRuns"},project:{name:"project",multiplicity:"",relationProperty:"testPlanRuns"},testCaseRuns:{list:!0,name:"testCaseRun",multiplicity:"one",relationProperty:"testPlanRun"},assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"assignables"},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"time",parent:null,resource:"times",aliases:["Time","times","Times"],fields:["id"],simpleFields:["id","description","spent","remain","isEstimation","date","createDate"],refs:{project:{name:"project",multiplicity:"",relationProperty:"times"},user:{name:"user",multiplicity:"",relationProperty:"times"},assignable:{name:"assignable",multiplicity:"",relationProperty:"times"},role:{name:"role",multiplicity:"",relationProperty:"times"},customActivity:{name:"customActivity",multiplicity:"",relationProperty:"times"}}},{name:"revision",parent:null,resource:"revisions",aliases:["Revision","revisions","Revisions"],fields:["id"],simpleFields:["id","sourceControlId","description","commitDate","revisionFiles-count","assignables-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"revisions"},revisionFiles:{list:!0,name:"revisionFile",multiplicity:"one",relationProperty:"revision"},author:{name:"user",multiplicity:"",relationProperty:"revisions"},assignables:{list:!0,name:"assignable",multiplicity:"",relationProperty:""}}},{name:"revisionFile",parent:null,resource:"revisionFiles",aliases:["RevisionFile","revisionFiles","RevisionFiles"],fields:["id","fileName"],simpleFields:["id","fileName","fileAction"],refs:{revision:{name:"revision",multiplicity:"",relationProperty:"revisionFiles"}}},{name:"customActivity",parent:null,resource:"customActivities",aliases:["CustomActivity","customActivities","CustomActivities"],fields:["id","name"],simpleFields:["id","name","created","estimate","times-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"customActivities"},user:{name:"user",multiplicity:"",relationProperty:"customActivities"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"customActivity"}}},{name:"request",parent:"assignable",resource:"requests",aliases:["Request","requests","Requests"],fields:["id","name"],simpleFields:["id","sourceType","isReplied","isPrivate","effort","effortCompleted","effortToDo","timeSpent","timeRemain","units","leadTime","cycleTime","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","requesters-count","history-count","assignedUser-count","assignments-count","impediments-count","times-count","roleEfforts-count","revisions-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"requests"},release:{name:"release",multiplicity:"",relationProperty:"requests"},iteration:{name:"iteration",multiplicity:"",relationProperty:"requests"},requestType:{name:"requestType",multiplicity:"",relationProperty:"requests"},requesters:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},history:{list:!0,name:"requestHistory",multiplicity:"one",relationProperty:"request"},assignedUser:{list:!0,name:"generalUser",multiplicity:"",relationProperty:""},teamIteration:{name:"teamIteration",multiplicity:"",relationProperty:"assignables"},team:{name:"team",multiplicity:"",relationProperty:"assignables"},priority:{name:"priority",multiplicity:"",relationProperty:"assignables"},entityState:{name:"entityState",multiplicity:"",relationProperty:"assignables"},assignments:{list:!0,name:"assignment",multiplicity:"one",relationProperty:"assignable"},impediments:{list:!0,name:"impediment",multiplicity:"zeroOrOne",relationProperty:"assignable"},times:{list:!0,name:"time",multiplicity:"zeroOrOne",relationProperty:"assignable"},roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"assignable"},revisions:{list:!0,name:"revision",multiplicity:"",relationProperty:""},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"requestType",parent:null,resource:"requestTypes",aliases:["RequestType","requestTypes","RequestTypes"],fields:["id","name"],simpleFields:["id","name","requests-count"],refs:{requests:{list:!0,name:"request",multiplicity:"one",relationProperty:"requestType"}}},{name:"build",parent:"general",resource:"builds",aliases:["Build","builds","Builds"],fields:["id","name"],simpleFields:["id","buildDate","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","bugs-count","testPlanRuns-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{project:{name:"project",multiplicity:"",relationProperty:"builds"},release:{name:"release",multiplicity:"",relationProperty:"builds"},iteration:{name:"iteration",multiplicity:"",relationProperty:"builds"},bugs:{list:!0,name:"bug",multiplicity:"zeroOrOne",relationProperty:"build"},testPlanRuns:{list:!0,name:"testPlanRun",multiplicity:"zeroOrOne",relationProperty:"build"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"comment",parent:null,resource:"comments",aliases:["Comment","comments","Comments"],fields:["id"],simpleFields:["id","description","parentId","createDate"],refs:{general:{name:"general",multiplicity:"",relationProperty:"comments"},owner:{name:"generalUser",multiplicity:"",relationProperty:"comments"}}},{name:"assignment",parent:null,resource:"assignments",aliases:["Assignment","assignments","Assignments"],fields:["id"],simpleFields:["id"],refs:{assignable:{name:"assignable",multiplicity:"",relationProperty:"assignments"},generalUser:{name:"user",multiplicity:"",relationProperty:"assignments"},role:{name:"role",multiplicity:"",relationProperty:"assignments"}}},{name:"role",parent:null,resource:"roles",aliases:["Role","roles","Roles"],fields:["id","name"],simpleFields:["id","name","isPair","hasEffort","roleEfforts-count","entityStates-count"],refs:{roleEfforts:{list:!0,name:"roleEffort",multiplicity:"one",relationProperty:"role"},entityStates:{list:!0,name:"entityState",multiplicity:"one",relationProperty:"role"}}},{name:"impediment",parent:"general",resource:"impediments",aliases:["Impediment","impediments","Impediments"],fields:["id","name"],simpleFields:["id","isPrivate","name","customField1","customField2","customField3","customField4","customField5","customField6","customField7","customField8","customField9","customField10","customField11","customField12","customField13","customField14","customField15","customField16","customField17","customField18","customField19","customField20","customField21","customField22","customField23","customField24","customField25","customField26","customField27","customField28","customField29","customField30","customField31","customField32","customField33","customField34","customField35","customField36","customField37","customField38","customField39","customField40","customField41","customField42","customField43","customField44","customField45","customField46","customField47","customField48","customField49","customField50","customField51","customField52","customField53","customField54","customField55","customField56","customField57","customField58","customField59","customField60","description","startDate","endDate","createDate","modifyDate","lastCommentDate","tags","numericPriority","isNow","isNext","isPrevious","history-count","comments-count","messages-count","tagObjects-count","masterRelations-count","slaveRelations-count","attachments-count"],refs:{assignable:{name:"assignable",multiplicity:"",relationProperty:"impediments"},entityState:{name:"entityState",multiplicity:"",relationProperty:"impediments"},priority:{name:"priority",multiplicity:"",relationProperty:"impediments"},responsible:{name:"user",multiplicity:"",relationProperty:"impediments"},history:{list:!0,name:"impedimentHistory",multiplicity:"one",relationProperty:"impediment"},entityType:{name:"entityType",multiplicity:"",relationProperty:"generals"},owner:{name:"generalUser",multiplicity:"",relationProperty:"generals"},lastCommentedUser:{name:"generalUser",multiplicity:"",relationProperty:"lastCommentedGenerals"},project:{name:"project",multiplicity:"",relationProperty:"generals"},comments:{list:!0,name:"comment",multiplicity:"one",relationProperty:"general"},messages:{list:!0,name:"message",multiplicity:"",relationProperty:""},tagObjects:{list:!0,name:"tag",multiplicity:"",relationProperty:""},masterRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"slave"},slaveRelations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"master"},attachments:{list:!0,name:"attachment",multiplicity:"one",relationProperty:"general"}}},{name:"company",parent:null,resource:"companies",aliases:["Company","companies","Companies"],fields:["id","name"],simpleFields:["id","name","url","description","projects-count"],refs:{projects:{list:!0,name:"project",multiplicity:"zeroOrOne",relationProperty:"company"}}},{name:"roleEffort",parent:null,resource:"roleEfforts",aliases:["RoleEffort","roleEfforts","RoleEfforts"],fields:["id"],simpleFields:["id","initialEstimate","effort","effortCompleted","effortToDo","timeSpent","timeRemain"],refs:{assignable:{name:"assignable",multiplicity:"",relationProperty:"roleEfforts"},role:{name:"role",multiplicity:"",relationProperty:"roleEfforts"}}},{name:"projectMember",parent:null,resource:"projectMembers",aliases:["ProjectMember","projectMembers","ProjectMembers"],fields:["id"],simpleFields:["id","weeklyAvailableHours","membershipStartDate","membershipEndDate","allocation"],refs:{project:{name:"project",multiplicity:"",relationProperty:"projectMembers"},user:{name:"user",multiplicity:"",relationProperty:"projectMembers"},role:{name:"role",multiplicity:"",relationProperty:""}}},{name:"teamMember",parent:null,resource:"teamMembers",aliases:["TeamMember","teamMembers","TeamMembers"],fields:["id"],simpleFields:["id","startDate","endDate"],refs:{team:{name:"team",multiplicity:"",relationProperty:"teamMembers"},user:{name:"user",multiplicity:"",relationProperty:"teamMembers"},role:{name:"role",multiplicity:"",relationProperty:""}}},{name:"teamProject",parent:null,resource:"teamProjects",aliases:["TeamProject","teamProjects","TeamProjects"],fields:["id"],simpleFields:["id","startDate","endDate"],refs:{team:{name:"team",multiplicity:"",relationProperty:"teamProjects"},project:{name:"project",multiplicity:"",relationProperty:"teamProjects"}}},{name:"message",parent:null,resource:"messages",aliases:["Message","messages","Messages"],fields:["id"],simpleFields:["id","subject","recipients","body","isRead","isProcessed","createDate","sendDate","messageType","contentType","generals-count","attachments-count"],refs:{from:{name:"generalUser",multiplicity:"",relationProperty:"messagesFrom"},to:{name:"generalUser",multiplicity:"",relationProperty:"messagesTo"},messageUid:{name:"messageUid",multiplicity:"",relationProperty:""},generals:{list:!0,name:"general",multiplicity:"",relationProperty:""},attachments:{list:!0,name:"attachment",multiplicity:"zeroOrOne",relationProperty:"message"}}},{name:"messageUid",parent:null,resource:"messageUids",aliases:["MessageUid","messageUids","MessageUids"],fields:["id"],simpleFields:["id","uid","mailServer","mailLogin"],refs:{}},{name:"customField",parent:null,resource:"customFields",aliases:["CustomField","customFields","CustomFields"],fields:["id","name","entityFieldName"],simpleFields:["id","name","value","entityFieldName","fieldType","enabledForFilter","required"],refs:{entityType:{name:"entityType",multiplicity:"",relationProperty:"customFields"},process:{name:"process",multiplicity:"",relationProperty:"customFields"}}},{name:"relationType",parent:null,resource:"relationTypes",aliases:["RelationType","relationTypes","RelationTypes"],fields:["id","name"],simpleFields:["id","name","relations-count"],refs:{relations:{list:!0,name:"relation",multiplicity:"one",relationProperty:"relationType"}}},{name:"relation",parent:null,resource:"relations",aliases:["Relation","relations","Relations"],fields:["id"],simpleFields:["id"],refs:{master:{name:"general",multiplicity:"",relationProperty:"slaveRelations"},slave:{name:"general",multiplicity:"",relationProperty:"masterRelations"},relationType:{name:"relationType",multiplicity:"",relationProperty:"relations"}}},{name:"resourceBase",parent:"resource",resource:"resourceBases",aliases:["ResourceBase","resourceBases","ResourceBases"],fields:["id"],simpleFields:["id"],refs:{}},{name:"attachment",parent:null,resource:"attachments",aliases:["Attachment","attachments","Attachments"],fields:["id","name"],simpleFields:["id","name","description","date","mimeType","uri","thumbnailUri","size"],refs:{owner:{name:"generalUser",multiplicity:"",relationProperty:"attachments"},general:{name:"general",multiplicity:"",relationProperty:"attachments"},message:{name:"message",multiplicity:"",relationProperty:"attachments"}}},{name:"generalListItem",parent:null,resource:"generalListItems",aliases:["GeneralListItem","generalListItems","GeneralListItems"],fields:["id","name"],simpleFields:["id","name","parentProjectId","entityTypeId","numericPriority","createDate","startDate","endDate"],refs:{}},{name:"context",parent:null,resource:"contexts",aliases:["Context","contexts","Contexts"],fields:["id"],simpleFields:["id","acid","edition","version","selectedProjects-count","selectedTeams-count","processes-count"],refs:{loggedUser:{name:"user",multiplicity:"",relationProperty:""},culture:{name:"culture",multiplicity:"",relationProperty:""},selectedProjects:{list:!0,name:"projectInfo",multiplicity:"",relationProperty:""},selectedTeams:{list:!0,name:"teamInfo",multiplicity:"",relationProperty:""},processes:{list:!0,name:"processInfo",multiplicity:"",relationProperty:""},appContext:{name:"appContext",multiplicity:"",relationProperty:""}}},{name:"appContext",parent:null,resource:"appContexts",aliases:["AppContext","appContexts","AppContexts"],fields:["id"],simpleFields:["id"],refs:{projectContext:{name:"simpleContext",multiplicity:"",relationProperty:""},teamContext:{name:"simpleContext",multiplicity:"",relationProperty:""}}},{name:"simpleContext",parent:null,resource:"simpleContexts",aliases:["SimpleContext","simpleContexts","SimpleContexts"],fields:["id"],simpleFields:["id","no"],refs:{}},{name:"culture",parent:null,resource:"cultures",aliases:["Culture","cultures","Cultures"],fields:["id","name"],simpleFields:["id","name","decimalSeparator","shortDateFormat","longDateFormat","timePattern"],refs:{}},{name:"processInfo",parent:null,resource:"processInfos",aliases:["ProcessInfo","processInfos","ProcessInfos"],fields:["id","name"],simpleFields:["id","name","isDefault","terms-count","customFields-count","practices-count"],refs:{terms:{list:!0,name:"term",multiplicity:"",relationProperty:""},customFields:{list:!0,name:"customFieldInfo",multiplicity:"",relationProperty:""},practices:{list:!0,name:"practice",multiplicity:"",relationProperty:""}}},{name:"term",parent:null,resource:"terms",aliases:["Term","terms","Terms"],fields:["id","name"],simpleFields:["id","name","value"],refs:{}},{name:"customFieldInfo",parent:null,resource:"customFieldInfos",aliases:["CustomFieldInfo","customFieldInfos","CustomFieldInfos"],fields:["id","name","entityFieldName"],simpleFields:["id","entityKind","name","entityFieldName","value","type","required","listed"],refs:{process:{name:"processInfo",multiplicity:"",relationProperty:"customFields"}}},{name:"projectInfo",parent:null,resource:"projectInfos",aliases:["ProjectInfo","projectInfos","ProjectInfos"],fields:["id","name"],simpleFields:["id","name"],refs:{process:{name:"processInfo",multiplicity:"",relationProperty:""},program:{name:"programInfo",multiplicity:"",relationProperty:""}}},{name:"teamInfo",parent:null,resource:"teamInfos",aliases:["TeamInfo","teamInfos","TeamInfos"],fields:["id","name"],simpleFields:["id","name"],refs:{}},{name:"programInfo",parent:null,resource:"programInfos",aliases:["ProgramInfo","programInfos","ProgramInfos"],fields:["id","name"],simpleFields:["id","name"],refs:{}}]});
define('tau/store/types.targetprocess',["Underscore","tau/store/types","tau/store/types.targetprocess.generated"],function(_,tauTypes,generated){var pascalCaseAndSplit=function(name){var result=[];for(var i=0,len=name.length;i<len;i++){var chr=name.charAt(i);i===0?chr=chr.toUpperCase():chr===chr.toUpperCase()&&result.push(" "),result.push(chr)}return result.join("")},generateTermType=function(key){return{key:key,val:key}},generatePluralTermType=function(key){var lastIndex=key.length-1;if(key.charAt(lastIndex)==="y"){var car=key.substring(0,lastIndex),cdr="ies";key=car+cdr}else key+="s";return{key:key,val:key}},generateBigIconText=function(key){return{key:key+" Big Icon Text",val:key}},generateSmallIconText=function(key){var parts=key.split(" "),len=parts.length,index=len-1||0,seed=parts[index];return{key:key+" Small Icon Text",val:seed.charAt(0)}},detectGeneralType=function(obj){if(obj&&obj.entityType&&obj.entityType.name)return obj.entityType.name;throw"type of entity is not detected"},generateTerms=function(typeName){var key=pascalCaseAndSplit(typeName);return{name:generateTermType(key),names:generatePluralTermType(key),iconBig:generateBigIconText(key),iconSmall:generateSmallIconText(key)}};return _.each(generated,function(type){type.name==="userStory"&&(type.aliases.unshift("story","stories","us"),type.simpleFields.push("tasks-effort-sum","tasks-effortToDo-sum"));if(type.name==="general"||type.name==="assignable")type.isParentType=!0,type.discriminator={entityType:["id","name"]},type.detectType=detectGeneralType;(type.parent==="general"||type.parent==="assignable")&&type.simpleFields.push("customFields"),type.terms=generateTerms(type.name),type.name==="processInfo"&&type.refs&&(type.refs={}),type.name==="context"&&(type.refs||(type.refs={}),type.refs.culture&&delete type.refs.culture,type.refs.appContext&&delete type.refs.appContext,type.refs.selectedProjects={list:!0,name:"project"},type.simpleFields=["id","acid"]),tauTypes.register(type)}),tauTypes.register({name:"implementationHistory",aliases:["stats"]}),tauTypes.register({name:"solution"}),tauTypes.register({name:"prioritizer",fields:["id"],refs:[]}),tauTypes});
define('tau/target.process.rules.registrator',["Underscore","tau/store/types.targetprocess"],function(_,tauTypes){return{typeContainSimpleField:function(type,simpleFieldName){return _.find(type.simpleFields,function(field){return field===simpleFieldName})},registerRules:function(rules,configurator){this.registeredEntityTypes={},this.rules=rules,_.each(tauTypes.getDictionary(),this.registerType,this),rules.register({type:"feature",changes:["initialEstimate"],fields:["timeRemain"]}),rules.register({type:"iteration",changes:["startDate"],fields:["endDate"]}),rules.register({type:"iteration",changes:["endDate"],fields:["startDate"]}),rules.register({type:"teamIteration",changes:["startDate"],fields:["endDate"]}),rules.register({type:"teamIteration",changes:["endDate"],fields:["startDate"]}),rules.register({type:"testPlanRun",changes:["release"],fields:[{build:["id","name"]}]}),rules.register({type:"testPlanRun",changes:["iteration","teamIteration"],fields:[{build:["id","name"]}]}),rules.registerRule({name:"auto-include-before-save",type:"roleEffort",changes:["effort"],fields:[{assignable:["id","effort","effortToDo","effortCompleted","timeSpent","timeRemain"]}]}),rules.registerRule({name:"auto-include-before-save",type:"userStory",changes:["release","iteration","teamIteration"],fields:[{tasks:[{release:["id","name"]},{iteration:["id","name"]},{teamIteration:["id","name"]}]}]}),rules.registerRule({name:"auto-include-before-save",type:"task",changes:["entityState"],fields:[{release:["id","name"]},{iteration:["id","name"]},{teamIteration:["id","name"]}]}),rules.registerRule({name:"auto-action-after-save",type:"assignable",changes:["times"],action:function(cfg){cfg.store.refresh("assignable",{id:cfg.data.id,fields:["effortCompleted","effortToDo","timeSpent","timeRemain",{roleEfforts:["id","effort","effortToDo"]}]}).done()}}),rules.registerRule({name:"auto-action-after-save",type:"feature",changes:["userStories"],action:function(cfg){cfg.store.refresh("feature",{id:cfg.data.id,fields:["effortCompleted","effortToDo","timeSpent","timeRemain","userStories-count","effort",{roleEfforts:["id","effort","effortToDo"]}]}).done()}}),rules.registerRule({name:"auto-action-after-save",type:"iteration",changes:["userStories|bugs"],action:function(cfg){cfg.store.refresh("iteration",{id:cfg.data.id,fields:["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum"]}).done()}}),rules.registerRule({name:"auto-action-after-save",type:"teamIteration",changes:["userStories|bugs"],action:function(cfg){cfg.store.refresh("teamIteration",{id:cfg.data.id,fields:["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum"]}).done()}}),rules.registerRule({name:"auto-action-after-save",type:"release",changes:["userStories"],action:function(cfg){cfg.store.refresh("release",{id:cfg.data.id,fields:["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum",{features:["effortToDo","effortCompleted","userStories-count"]}]}).done()}}),rules.registerRule({name:"auto-action-after-save",type:"userStory",changes:["tasks"],action:function(cfg){var c=cfg.data,type=c.cmd?c.cmd.type:c.obj?c.obj.type:c.type,id=c.cmd?c.cmd.config.id:null;type==="task"&&!id?cfg.store.refresh("userStory",{id:cfg.data.id,fields:["tasks-count","tasks-effort-sum","tasks-effortToDo-sum",{entityState:["id","name"]}]}).done():cfg.store.refresh("userStory",{id:cfg.data.id,fields:["effort","effortToDo","effortCompleted","timeSpent","timeRemain","tasks-count","tasks-effort-sum","tasks-effortToDo-sum"]}).done()}}),rules.registerRule({name:"auto-include-before-save",type:"task",changes:["entityState"],fields:[{userStory:["id","tasks-effort-sum","tasks-effortToDo-sum","effort","effortToDo","effortCompleted","timeSpent","timeRemain","tasks-count",{entityState:["id","name","isInitial","isFinal","isPlanned","isCommentRequired"]}]}]}),rules.registerRule({name:"auto-include-before-save",type:"userStory",changes:["entityState"],fields:["tasks-effortToDo-sum",{feature:["effortToDo","effortCompleted","userStories-count"]},{iteration:["userStories-effortToDo-sum","userStories-effortCompleted-sum"]},{teamIteration:["userStories-effortToDo-sum","userStories-effortCompleted-sum"]},{release:["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum",{features:["effortToDo","effortCompleted","userStories-count"]}]}]}),rules.registerRule({name:"auto-action-after-save",type:"feature",changes:["userStories"],action:function(cfg){cfg.store.refresh("feature",{id:cfg.data.obj.id,fields:["effortToDo","effortCompleted","userStories-count"]}).done()}}),rules.registerRule({name:"auto-include-before-save",type:"bug",changes:["entityState"],fields:[{iteration:["bugs-effortToDo-sum","bugs-effortCompleted-sum"]},{teamIteration:["bugs-effortToDo-sum","bugs-effortCompleted-sum"]}]}),rules.registerRule({name:"auto-action-after-save",type:"roleEffort",changes:["effort"],action:function(cfg){var q=cfg.store,d=cfg.data.obj;q.get(d.type,{id:d.id,fields:[{assignable:["id"]}]}).done({success:function(r){r=r[0];var id=r.data.assignable.id,type=r.data.assignable.__type,autoUpdateMap={task:[{userStory:["id","effort","effortToDo","effortCompleted","timeSpent","timeRemain","tasks-count","tasks-effort-sum","tasks-effortToDo-sum",{roleEfforts:["effort","effortToDo"]}]}],userStory:[{iteration:["userStories-effortToDo-sum","userStories-effortCompleted-sum"]},{teamIteration:["userStories-effortToDo-sum","userStories-effortCompleted-sum"]},{release:["userStories-effortToDo-sum","userStories-effortCompleted-sum"]},{feature:["userStories-count","effort","effortToDo","effortCompleted","timeSpent","timeRemain"]}],bug:[{iteration:["bugs-effortToDo-sum","bugs-effortCompleted-sum"]},{teamIteration:["bugs-effortToDo-sum","bugs-effortCompleted-sum"]},{release:["bugs-effortToDo-sum","bugs-effortCompleted-sum"]}]},fields=autoUpdateMap[type];if(fields){var requiredFields=_(fields).filter(function(field){var fieldName=_.getFieldName(field);return q.isPropertyInitialized(id,type,fieldName)});requiredFields.length&&q.refresh(type,{id:id,fields:requiredFields}).done()}}})}}),rules.registerRule({name:"auto-action-after-save",type:"comment",action:function(cfg){var d=cfg.data,notificationSettings=d.cmd["comment-practices-notification-opts"];if(notificationSettings&&_(notificationSettings).keys().length){var notificationService=configurator.getNotificationService();notificationService.notifyComment(d.id,notificationSettings)}}})},registerType:function(type){var registeredEntityTypes=this.registeredEntityTypes,rules=this.rules;if(!registeredEntityTypes.hasOwnProperty(type.name)){registeredEntityTypes[type.name]=!0,_.each(type.aliases,function(alias){registeredEntityTypes[alias]=!0});var simpleFieldName="endDate";type.refs.hasOwnProperty("entityState")&&this.typeContainSimpleField(type,simpleFieldName)&&(rules.register({type:type.name,changes:["entityState"],fields:["endDate","leadTime","cycleTime"]}),rules.register({type:type.name,changes:["entityState"],fields:[{roleEfforts:["effort","effortToDo"]}]}))}}}});
define('tau/store/factory',["app.path","tau/core/class","tau/store/store","tau/store/repository","tau/store/services/service.rest","tau/core/global.bus","tau/rules/core","tau/rules/rule.auto-include-before-save","tau/rules/rule.auto-action-after-save","tau/rules/rule.auto-include-before-remove","tau/target.process.rules.registrator","tau/store/types","tau/store/db","tau/store/types.targetprocess"],function(AppPath,Class,store,Repository,restService,globalBus,RulesEngine,autoIncludeBeforeSaveRule,autoActionAfterSaveRule,autoActionAfterBeforeRemove,rulesRegistrator,tauTypes,Db,types){var instanceDB=null;return Class.extend({rulesDisabled:!1,clearSingles:function(){instanceDB=null,this.rulesEngine&&(this.rulesEngine.destroy&&this.rulesEngine.destroy(),delete this.rulesEngine),delete this.proxy,delete this.service,delete this.store},clear:function(){this.clearSingles(),delete this.initialData,delete this.appPath,delete this.rulesDisabled},setApplicationPath:function(appPath){if(this.appPath===appPath)return;this.appPath=appPath},getApplicationPath:function(){if(!this.appPath){var path=AppPath.get();return path}return this.appPath},setInitialData:function(data){this.initialData=data},setService:function(service){if(this.service===service)return;this.clearSingles(),this.service=service},getService:function(){return this.service||(this.service=new restService({appPath:this.getApplicationPath(),path:this.getRestPath()})),this.service},getRestPath:function(){return this.getApplicationPath()+"/api/v1"},getDb:function(){return instanceDB||(instanceDB=new Db({types:tauTypes.getDictionary()})),instanceDB},setProxy:function(proxy){this.proxy=proxy},getProxy:function(){return this.proxy||(this.proxy=new Repository({db:this.getDb(),service:this.getService()})),this.initialData&&(this.proxy.registerData(this.initialData),delete this.initialData),this.proxy},disableRules:function(){this.rulesDisabled=!0},enableRules:function(){this.rulesDisabled=!1},initRules:function(services){if(this.rulesDisabled===!0)return;this.rulesEngine=new RulesEngine({store:this.store,rules:[],rulesImpl:[autoIncludeBeforeSaveRule,autoActionAfterSaveRule,autoActionAfterBeforeRemove]}),rulesRegistrator.registerRules(this.rulesEngine,services)},getStore:function(config){return config=config||{},this.store||(config.proxy=this.getProxy(),_.defaults(config,{eventEmitter:globalBus.get()}),this.store=new store(config),this.initRules(config.services)),this.store},setStore:function(store){this.store=store}})});
define('tau/services/keyboard.manager',["Underscore","jQuery","tau/core/class"],function(_,$,Class){return Class.extend({init:function(){this._handlers=[],$(document).keydown(_.bind(this._keyDown,this))},pushHandler:function(handler){this._handlers.push(handler)},popHandler:function(){this._handlers.pop()},_keyDown:function(){if(this._handlers.length==0)return;var handler=_.last(this._handlers);handler&&handler.handleKeyDown&&handler.handleKeyDown.apply(handler,_.toArray(arguments))}})});
define('tau/services/state.manager',["Underscore","tau/core/class"],function(_,Class){var noop=function(){},StateManager=Class.extend({init:function(config){config=config||{};var requiredParameters=[];config.state||requiredParameters.push("state"),config.service||requiredParameters.push("service");if(requiredParameters.length>0)throw"State manager should be initialized with following parameters: ["+requiredParameters.join(",")+"]";this.subscriptions={},this.cfg=config},get:function(params){var self=this;if(!params.id)throw"StateManager.get operation requires parameter [id]";var command=_.defaults(params,{fields:[],callback:noop}),service=this.cfg.service;return service.get(command),self},set:function(params){var self=this;if(!params.id)throw"StateManager.set operation requires parameter [id]";var command=_.defaults(params,{set:{},callback:noop}),service=this.cfg.service;return service.set(command),self},update:function(newHash){var self=this,prvHash=this.cfg.state,actualParams=[];_(newHash).chain().keys().each(function(paramId){actualParams.push(paramId);var p=prvHash[paramId]||{},n=newHash[paramId];if(_.isString(n)||_.isString(p))return;var prevFields=_(p).keys(),currFields=_(n).keys();_(_.union(prevFields,currFields)).each(function(field){if(!_.isEqual(n[field],p[field])){var prev=p.hasOwnProperty(field)?p[field]:null,curr=n.hasOwnProperty(field)?n[field]:null;self.applyChanges({paramId:paramId,fieldName:field,value:curr,delta:{prev:prev,curr:curr}})}})}),_(prvHash).chain().keys().difference(actualParams).each(function(pastParamId){var p=prvHash[pastParamId];if(_.isString(p))return;_(p).chain().keys().each(function(field){self.applyChanges({paramId:pastParamId,fieldName:field,value:null,delta:{prev:p[field],curr:null}})})}),self.cfg.state=newHash},applyChanges:function(config){var sub=this.subscriptions,callbacksInfo=_.clone((sub[config.paramId]||{})[config.fieldName]||[]);for(var i=0,len=callbacksInfo.length;i<len;i++){var ci=callbacksInfo[i];ci&&!ci.isDeleted&&ci.callback.call(ci.scope,config)}},bind:function(config){var paramId=config.paramId,field=config.fieldName,callback=config.callback,listener=config.listener,subs=this.subscriptions;return subs[paramId]=subs[paramId]||{},subs[paramId][field]=subs[paramId][field]||[],subs[paramId][field].push({callback:callback,scope:listener}),this},unbind:function(listener){var subs=this.subscriptions,keys=_(subs).keys();for(var k=0,kLen=keys.length;k<kLen;k++){var paramId=keys[k],fields=_(subs[paramId]).keys();for(var f=0,fLen=fields.length;f<fLen;f++){var fieldName=fields[f],callbacks=subs[paramId][fieldName];for(var c=callbacks.length-1;c>=0;c--)callbacks[c].scope===listener&&(callbacks[c].isDeleted=!0,callbacks.splice(c,1));subs[paramId][fieldName].length===0&&delete subs[paramId][fieldName]}_(subs[paramId]).keys()===0&&delete subs[paramId]}}});return StateManager});
define('tau/services/service.routing',["Underscore","tau/core/class"],function(_,Class){var ServiceRouting=Class.extend({init:function(config){config=config||{},this.config=config,this.external=config.external},get:function(command){var states={},id=command.id,fields=command.fields,len=fields.length,hash=this.external.getHashParam(id);for(var i=0;i<len;i++){var name=fields[i];states[name]=hash.hasOwnProperty(name)?hash[name]:null}command.callback(states)},set:function(command){var id=command.id,set=command.set,hash=this.external.getHashParam(id),newHash=_(hash).extend(set);this.external.setHashParam(id,newHash),command.callback(newHash)}});return ServiceRouting});
define('libs/parseUri',[],function(){function parseUri(str){var o=parseUri.options,m=o.parser[o.strictMode?"strict":"loose"].exec(str),uri={},i=14;while(i--)uri[o.key[i]]=m[i]||"";return uri[o.q.name]={},uri[o.key[12]].replace(o.q.parser,function($0,$1,$2){$1&&(uri[o.q.name][$1]=$2)}),uri}return parseUri.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}},parseUri});
define('tau/services/service.hash',["Underscore","jQuery","tau/core/class","tau/core/event","libs/parseUri","libs/json2"],function(_,$,Class,Event,parseUri){var Service=Class.extend({init:function(configurator){this._id=_.uniqueId("sh"),this.setWindow(configurator.getWindow()),this.setEncoder(configurator.getHashEncoder()||this.encoderDefault())},setWindow:function(windw){this.window&&$(this.window).unbind("hashchange."+this._id),this.window=_.defaults(windw||{},{location:{hash:""}}),$(this.window).bind("hashchange."+this._id,_.bind(function(){this.fire("changed",{hash:this.getHash()})},this))},setEncoder:function(encoder){this.paramsEncoder=encoder},getHash:function(){var hash=this.window.location.hash;while(hash.indexOf("#")===0)hash=hash.substr(1);return this.tryDecodeUri(hash)},setHref:function(href){this.window.location.href=href},getHref:function(){return this.window.location.href},getHrefParsed:function(){return parseUri(this.getHref())},setHash:function(hashStr){this.window.location.replace("#"+hashStr)},triggerChange:function(hash){$(this.window).trigger("hashchange."+this._id,{hash:hash})},hashParams:function(){var result={},hash=this.getHash(),parts=hash.split("&");for(var i=0,len=parts.length;i<len;i++){var token=parts[i],pos=token.indexOf("=");if(pos!==-1){var n=token.substr(0,pos),v=token.substr(pos+1);result[n]=this.paramsEncoder.decode(v)}}return result},getHashParam:function(id,defaultValue){var hash=this.hashParams();return hash[id]||(arguments.length>1?defaultValue:{})},setHashParam:function(id,value){var hash=this.getHash(),newHashString=this.mergeHashParams(hash,id,value);this.setHash(newHashString)},applyHashObject:function(obj){var self=this,newHashString=this.getHash();_.each(obj,function(val,id){newHashString=this.mergeHashParams(newHashString,id,val)},self),self.setHash(newHashString)},mergeHashParams:function(hash,id,value){hash=hash.charAt(0)!=="&"?"&"+hash:hash;var index=hash.indexOf("&"+id+"="),left=index!==-1?index:hash.length;index=hash.indexOf("&",1+left);var right=index!==-1?index:hash.length,serializedParam="";if(value!==null){var v=this.paramsEncoder.encode(value),prefix=hash==="&"?"":"&";serializedParam=prefix+id+"="+v}var head=hash.substring(0,left),tail=hash.substring(right),newHashString=head+serializedParam+tail;return newHashString=newHashString.charAt(0)!=="&"?newHashString:newHashString.substring(1),newHashString},tryDecodeUri:function(hash){var r=hash;try{r=decodeURIComponent(hash)}catch(e){}return r},onHashChange:function(handler){this.on("changed",handler,handler)},unbindHashChange:function(handler){this.removeListener("changed",handler,handler)},encoderDefault:function(){return{encode:function(value){var v=value;return _.isObject(value)&&(v=JSON.stringify(value)),v},decode:function(str){var v=str;return v.charAt(0)==="{"&&v.charAt(v.length-1)==="}"&&(v=JSON.parse(v)),v}}},setDefaultEncoder:function(){this.paramsEncoder=this.encoderDefault()},setFakeWindow:function(){var args=_.toArray(arguments),location;args.length==2?location={hash:args[0],href:args[1]}:_.isString(args[0])?location={hash:args[0]}:location=args[0]||{};var $w=$("<div />");$w.location=_.defaults(location,{hash:"",href:"",replace:function(val){$w.location.hash=_.asString(val),$w.trigger("hashchange",{})}}),this.setWindow($w)}});return Service.prototype.triggerHashChange=Service.prototype.triggerChange,Event.implementOn(Service.prototype),Service});
define('tau/utils/utils.routing/utils.routing.store.hash',["Underscore","jQuery","tau/core/class","tau/core/event","libs/parseUri"],function(_,$,Class,Event,parseUri){var Store=Class.extend({init:function(config){this.config=_.defaults(config,{window:window,v2:!1,safe:!1,encodeBy:function(s){return s},decodeBy:function(s){try{s=decodeURIComponent(s)}catch(e){}return s}}),this.window=this.config.window||window,this.config.v2&&(this.config.external=this.config.configurator.createExternal(this.window)),this.params=[];var self=this;this.hashChangeHandler=function(e){e.stopPropagation(),e.preventDefault();var hash=e.hash||e.target.location.hash;self.fire("urlChanged",{url:self.parseUrl(hash)})},$(this.window).bind("hashchange",this.hashChangeHandler),this.destroyHandler=function(e){self.fire("destroyed",{})},$(this.window).bind("unload",this.destroyHandler)},_extract:function(hash){var internalUrl=hash;if(this.config.safe){hash="?"+hash;var data=parseUri(hash);this.params=data.queryKey,internalUrl=this.params[this.config.safeParameterName]||""}return internalUrl},_generateV2:function(route,useStates){var stateParamName="||legacystate",ext=this.config.external,srcHash=ext.getHash(),tempExt=this.config.configurator.createExternal({location:{hash:srcHash}}),newStates=!_.isEmpty(route.states)&&useStates?route.states:{};return tempExt.setHashParam(stateParamName,newStates),tempExt.getHash()},_generate:function(route,useStates){useStates=!!useStates;var hash="";if(this.config.v2)return hash=this._generateV2(route,useStates),hash;var internalUrl=route.url;return!_.isEmpty(route.states)&&useStates&&(internalUrl+="||"+JSON.stringify(route.states)),hash=internalUrl,this.config.safe&&(this.params[this.config.safeParameterName]=internalUrl,hash=$.param(this.params)),this.config.encodeBy(hash)},_parseUrlV2:function(hash){var parsed={},tmpExternal=this.config.configurator.createExternal({location:{hash:hash}});return parsed.source="#"+tmpExternal.getHash(),parsed.states=tmpExternal.getHashParam("||legacystate"),parsed.url=tmpExternal.getHashParam(this.config.safeParameterName),parsed},parseUrl:function(hash){if(this.config.v2){var parseResult=this._parseUrlV2(hash);return parseResult}hash&&hash[0]=="#"&&(hash=hash.slice(1));var url=this._extract(hash);try{url=this.config.decodeBy(url)}catch(e){}var parsed={url:null,states:{},source:"#"+hash},items=url.split("||");parsed.url=items[0];if(items[1])try{parsed.states=JSON.parse(items[1])}catch(e){}return parsed},generateUrl:function(route,useStates){return this._generate(route,useStates)},setUrl:function(url){var hash="#";_.isObject(url)&&url.hasOwnProperty("url")&&url.hasOwnProperty("states")?hash=this._generate(url,!0):_.isString(url)&&(hash=url),this.window.location.hash=hash},getUrl:function(){return this.parseUrl(this.window.location.hash)}});return Event.implementOn(Store.prototype),Store});
/*
Copyright (c) 2008 Fred Palmer fred.palmer_at_gmail.com

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation
files (the "Software"), to deal in the Software without
restriction, including without limitation the rights to use,
copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the
Software is furnished to do so, subject to the following
conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
OTHER DEALINGS IN THE SOFTWARE.
*/

define('libs/base64/base64',[],function(){function StringBuffer(){this.buffer=[]}function Utf8EncodeEnumerator(input){this._input=input,this._index=-1,this._buffer=[]}function Base64DecodeEnumerator(input){this._input=input,this._index=-1,this._buffer=[]}StringBuffer.prototype.append=function(string){return this.buffer.push(string),this},StringBuffer.prototype.toString=function e(){return this.buffer.join("")};var Base64={codex:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(input){var output=new StringBuffer,enumerator=new Utf8EncodeEnumerator(input);while(enumerator.moveNext()){var chr1=enumerator.current;enumerator.moveNext();var chr2=enumerator.current;enumerator.moveNext();var chr3=enumerator.current,enc1=chr1>>2,enc2=(chr1&3)<<4|chr2>>4,enc3=(chr2&15)<<2|chr3>>6,enc4=chr3&63;isNaN(chr2)?enc3=enc4=64:isNaN(chr3)&&(enc4=64),output.append(this.codex.charAt(enc1)+this.codex.charAt(enc2)+this.codex.charAt(enc3)+this.codex.charAt(enc4))}return output.toString()},decode:function(input){var output=new StringBuffer,enumerator=new Base64DecodeEnumerator(input);while(enumerator.moveNext()){var charCode=enumerator.current;if(charCode<128)output.append(String.fromCharCode(charCode));else if(charCode>191&&charCode<224){enumerator.moveNext();var charCode2=enumerator.current;output.append(String.fromCharCode((charCode&31)<<6|charCode2&63))}else{enumerator.moveNext();var charCode2=enumerator.current;enumerator.moveNext();var charCode3=enumerator.current;output.append(String.fromCharCode((charCode&15)<<12|(charCode2&63)<<6|charCode3&63))}}return output.toString()}};return Utf8EncodeEnumerator.prototype={current:Number.NaN,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=Number.NaN,!1;var charCode=this._input.charCodeAt(++this._index);return charCode==13&&this._input.charCodeAt(this._index+1)==10&&(charCode=10,this._index+=2),charCode<128?this.current=charCode:charCode>127&&charCode<2048?(this.current=charCode>>6|192,this._buffer.push(charCode&63|128)):(this.current=charCode>>12|224,this._buffer.push(charCode>>6&63|128),this._buffer.push(charCode&63|128)),!0}},Base64DecodeEnumerator.prototype={current:64,moveNext:function(){if(this._buffer.length>0)return this.current=this._buffer.shift(),!0;if(this._index>=this._input.length-1)return this.current=64,!1;var enc1=Base64.codex.indexOf(this._input.charAt(++this._index)),enc2=Base64.codex.indexOf(this._input.charAt(++this._index)),enc3=Base64.codex.indexOf(this._input.charAt(++this._index)),enc4=Base64.codex.indexOf(this._input.charAt(++this._index)),chr1=enc1<<2|enc2>>4,chr2=(enc2&15)<<4|enc3>>2,chr3=(enc3&3)<<6|enc4;return this.current=chr1,enc3!=64&&this._buffer.push(chr2),enc4!=64&&this._buffer.push(chr3),!0}},Base64});
define('tau/utils/utils.storage.cookie',["libs/base64/base64"],function(base64){var Encode=function(jsonString){var code=base64.encode(jsonString);return code="#"+code,code},Decode=function(code){var str=code;return code.charAt(0)==="#"&&(code=code.substring(1),str=base64.decode(code)),str},BackwardCompatibilityKey=function(key){return"$"+key},CookiesStorage={set:function(key,value,expiredAt){var k=BackwardCompatibilityKey(key),date=new Date;date.setTime(date.getTime()+31536e6),expiredAt=expiredAt||date.toGMTString();var jsonString=JSON.stringify(value);jsonString=Encode(jsonString);var data=[k+"="+jsonString,"expires="+expiredAt,"path=/"].join("; ");document.cookie=data},get:function(key){var k=BackwardCompatibilityKey(key);k+="=";var val,parts=document.cookie.split(";");for(var i=0;i<parts.length;i++){var kv=parts[i];while(kv.charAt(0)===" ")kv=kv.substring(1,kv.length);kv.indexOf(k)===0&&(val=kv.substring(k.length,kv.length),val=Decode(val),val=JSON.parse(val))}return val},remove:function(key){return CookiesStorage.set(key,"",-1)}};return CookiesStorage});
define('tau/utils/utils.storage',["tau/utils/utils.storage.cookie"],function(storageCookie){var hasStorage=typeof window.localStorage!="undefined"&&window.localStorage!==null&&!!window.localStorage.getItem&&!!window.localStorage.setItem,_localStorage={set:function(key,value){return localStorage.setItem(key,JSON.stringify(value)),!0},get:function(key){var v=localStorage.getItem(key);if(v)try{v=JSON.parse(v)}catch(e){}return v},remove:function(key){return localStorage.removeItem(key)}};return hasStorage?_localStorage:storageCookie});
/*!!
 * JS Signals <http://millermedeiros.github.com/js-signals/>
 * Released under the MIT license <http://www.opensource.org/licenses/mit-license.php>
 * @author Miller Medeiros <http://millermedeiros.com/>
 * @version 0.6
 * @build 174 (04/09/2011 05:27 PM)
 */

(function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener,this._isOnce=isOnce,this.context=listenerContext,this._signal=signal,this._priority=priority||0}var signals={VERSION:"0.6"};SignalBinding.prototype={active:!0,execute:function(paramsArr){var r;return this.active&&(r=this._listener.apply(this.context,paramsArr),this._isOnce&&this.detach()),r},detach:function(){return this._signal.remove(this._listener)},getListener:function(){return this._listener},dispose:function(){this.detach(),this._destroy()},_destroy:function(){delete this._signal,delete this._isOnce,delete this._listener,delete this.context},isOnce:function(){return this._isOnce},toString:function(){return"[SignalBinding isOnce: "+this._isOnce+", active: "+this.active+"]"}},signals.Signal=function(){this._bindings=[]},signals.Signal.prototype={_shouldPropagate:!0,active:!0,_registerListener:function(listener,isOnce,scope,priority){if(typeof listener!="function")throw new Error("listener is a required param of add() and addOnce() and should be a Function.");var prevIndex=this._indexOfListener(listener),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce)throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(isOnce?"Once":"")+"() the same listener without removing the relationship first.")}else binding=new SignalBinding(this,listener,isOnce,scope,priority),this._addBinding(binding);return binding},_addBinding:function(binding){var n=this._bindings.length;do--n;while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener){var n=this._bindings.length;while(n--)if(this._bindings[n]._listener===listener)return n;return-1},add:function(listener,scope,priority){return this._registerListener(listener,!1,scope,priority)},addOnce:function(listener,scope,priority){return this._registerListener(listener,!0,scope,priority)},remove:function(listener){if(typeof listener!="function")throw new Error("listener is a required param of remove() and should be a Function.");var i=this._indexOfListener(listener);return i!==-1&&(this._bindings[i]._destroy(),this._bindings.splice(i,1)),listener},removeAll:function(){var n=this._bindings.length;while(n--)this._bindings[n]._destroy();this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=!1},dispatch:function(params){if(!this.active)return;var paramsArr=Array.prototype.slice.call(arguments),bindings=this._bindings.slice(),n=this._bindings.length;this._shouldPropagate=!0;do n--;while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==!1)},dispose:function(){this.removeAll(),delete this._bindings},toString:function(){return"[Signal active: "+this.active+" numListeners: "+this.getNumListeners()+"]"}},global.signals=signals})(window||global||this);
define("libs/crossroads.js/dist/js-signals", function(){});

/*!!
     * Crossroads - JavaScript Routes
     * Released under the MIT license <http://www.opensource.org/licenses/mit-license.php>
     * @author Miller Medeiros
     * @version 0.4
     * @build 31 (06/07/2011 12:15 AM)
     * ----------------------------------
     *
     * !!! WARNING: Patch for getParamIds method is added. Take into account when update to new version.
     *
     * ----------------------------------
     */

define('libs/crossroads.js/dist/crossroads',["./js-signals"],function(){(function(global){function arrayIndexOf(arr,val){var n=arr.length;while(n--)if(arr[n]===val)return n;return-1}function isType(type,val){return"[object "+type+"]"===_toString.call(val)}function isRegExp(val){return isType("RegExp",val)}function isArray(val){return isType("Array",val)}function isFunction(val){return isType("Function",val)}function typecastValue(val){return val}var crossroads,Route,patternLexer,_toString=Object.prototype.toString,BOOL_REGEXP=/^(true|false)$/i;crossroads=function(){function addRoute(pattern,callback,priority){var route=new Route(pattern,callback,priority,api);return sortedInsert(route),route}function sortedInsert(route){var n=getNumRoutes();do--n;while(_routes[n]&&route._priority<=_routes[n]._priority);_routes.splice(n+1,0,route)}function getNumRoutes(){return _routes.length}function removeRoute(route){var i=getRouteIndex(route);i>=0&&_routes.splice(i,1),route._destroy()}function getRouteIndex(route){return arrayIndexOf(_routes,route)}function removeAllRoutes(){var n=getNumRoutes();while(n--)_routes[n]._destroy();_routes.length=0}function parse(request){request=request||"";var route=getMatchedRoute(request),params=route?getParamValues(request,route):null;route?(params?route.matched.dispatch.apply(route.matched,params):route.matched.dispatch(),_routed.dispatch(request,route,params)):_bypassed.dispatch(request)}function getMatchedRoute(request){var i=getNumRoutes(),route;while(route=_routes[--i])if(route.match(request))return route;return null}function getParamValues(request,route){return patternLexer.getParamValues(request,route._matchRegexp)}var _routes=[],_bypassed=new signals.Signal,_routed=new signals.Signal,api={_routes:_routes,addRoute:addRoute,removeRoute:removeRoute,removeAllRoutes:removeAllRoutes,parse:parse,bypassed:_bypassed,routed:_routed,getNumRoutes:getNumRoutes,toString:function(){return"[crossroads numRoutes:"+getNumRoutes()+"]"}};return api},Route=function(pattern,callback,priority,crossroads){var isRegexPattern=isRegExp(pattern);this._crossroads=crossroads,this._pattern=pattern,this._paramsIds=isRegexPattern?null:patternLexer.getParamIds(this._pattern),this._matchRegexp=isRegexPattern?pattern:patternLexer.compilePattern(pattern),this.matched=new signals.Signal,callback&&this.matched.add(callback,this),this._priority=priority||0},Route.prototype={rules:void 0,match:function(request){return this._matchRegexp.test(request)&&this._validateParams(request)},_validateParams:function(request){var rules=this.rules,prop;for(prop in rules)if(rules.hasOwnProperty(prop)&&!this._isValidParam(request,prop))return!1;return!0},_isValidParam:function(request,prop){var validationRule=this.rules[prop],values=this._getParamValuesObject(request),val=values[prop],isValid;return isRegExp(validationRule)?isValid=validationRule.test(val):isArray(validationRule)?isValid=arrayIndexOf(validationRule,val)!==-1:isFunction(validationRule)&&(isValid=validationRule(val,request,values)),isValid||!1},_getParamValuesObject:function(request){var ids=this._paramsIds,values=patternLexer.getParamValues(request,this._matchRegexp),o={},n=ids?ids.length:0;while(n--)o[ids[n]]=values[n];return o.request_=typecastValue(request),o},dispose:function(){this._crossroads.removeRoute(this)},_destroy:function(){this.matched.dispose(),this.matched=this._pattern=this._matchRegexp=null},toString:function(){return'[Route pattern:"'+this._pattern+'", numListeners:'+this.matched.getNumListeners()+"]"}},patternLexer=function(){function getParamIds(pattern){var ids=[],match,paramsRegExp=new RegExp(PARAMS_REGEXP);while(match=paramsRegExp.exec(pattern))ids.push(match[1]);return ids}function compilePattern(pattern){return pattern=pattern?saveParams(pattern):"",pattern=pattern.replace(/\/$/,""),pattern=escapePattern(pattern),pattern=convertSavedParams(pattern),new RegExp("^"+pattern+"/?$")}function saveParams(pattern){return pattern.replace(PARAMS_REGEXP,SAVE_PARAMS)}function convertSavedParams(pattern){return pattern.replace(SAVED_PARAM_REGEXP,SEGMENT_REGEXP.source)}function escapePattern(pattern){return pattern.replace(ESCAPE_CHARS_REGEXP,"\\$&")}function getParamValues(request,regexp){var vals=regexp.exec(request);return vals&&(vals.shift(),vals=typecastValues(vals)),vals}function typecastValues(values){var n=values.length,result=[];while(n--)result[n]=typecastValue(values[n]);return result}var ESCAPE_CHARS_REGEXP=/[\\\.\+\*\?\^\$\[\]\(\)\{\}\/\'\#]/g,SEGMENT_REGEXP=/([^\/]+)/,PARAMS_REGEXP=/\{([^\}]+)\}/g,SAVE_PARAMS="___CR_PARAM___",SAVED_PARAM_REGEXP=new RegExp(SAVE_PARAMS,"g");return{getParamIds:getParamIds,getParamValues:getParamValues,compilePattern:compilePattern}}(),global.crossroads=crossroads})(window||this)});
define('tau/utils/utils.routing',["Underscore","jQuery","tau/core/class","tau/core/event","tau/utils/utils.routing/utils.routing.store.hash","tau/utils/utils.storage","libs/crossroads.js/dist/crossroads"],function(_,$,Class,Event,UrlStore,storage){var Routing=Class.extend({init:function(options){var crossroads=window.crossroads;return this.backend=crossroads(),this.options=options,this.window=this.options.window||window,this.store=new UrlStore(this.options),this.v2=options.v2===!0,this.current={url:"",states:{},source:""},this.processed={url:"",states:{},source:""},this.referer=this.restoreReferer(),this.reset(),this},register:function(pattern,callback,options){var opt=pattern;arguments.length>1&&(opt={pattern:pattern,callback:callback});var self=this,newRoute=this.backend.addRoute(opt.pattern,function(){var args=Array.prototype.slice.call(arguments),route=this,data={};_.forEach(route._paramsIds,function(v,i){data[v]=args[i]});var state=self.processed.states;opt.callback.apply(this,_.union([data,state],args))});return this},register404:function(callback){return this.backend.bypassed.add(callback),this},_applyRouter:function(url){this.backend.parse(url)},start:function(){var self=this,execute=_.bind(this._applyRouter,this),listener=function(route){this.processed=route;if(this.processed.url!==this.current.url){this.setReferer(_.clone(this.current)),this.current=this.processed,execute(this.current.url);return}var prevStates=this.current.states,processedStates=this.processed.states,keys=_.union(_.keys(prevStates),_.keys(processedStates)),internalStates={};_.forEach(keys,function(key){prevStates[key]!=processedStates[key]&&(internalStates[key]=processedStates[key]||null)}),_.forEach(internalStates,function(value,name){self.fire("stateChanged",{name:name,value:value})}),this.current=this.processed};this.setChangeListener(_.bind(listener,this));var listenerDestroy=function(){this.setReferer(_.clone(this.current))};return this.setDestroyListener(_.bind(listenerDestroy,this)),this},redirect:function(url,options){options=options||{},options.trigger===!1?this.skipTrigger=!0:this.skipTrigger=!1,this.window.open(url,"_self")},setInternalUrl:function(url){this.setUrl({url:url,states:{}})},getUrl:function(){return this.store.getUrl()},setUrl:function(url){this.store.setUrl(url)},generateUrl:function(route){return typeof route=="undefined"&&(route=this.current),this.store.generateUrl(route,!0)},setChangeListener:function(listener){this.changeListener=function(e){this.skipTrigger?this.skipTrigger=!1:listener(e.data.url)},this.store.on("urlChanged",this.changeListener,this)},setDestroyListener:function(listener){this.destroyListener=function(e){listener(e.data.url)},this.store.on("destroyed",this.destroyListener,this)},reset:function(){return this.backend.removeAllRoutes(),this.backend.bypassed.removeAll(),this},execute:function(hash){var parsed=this.store.parseUrl(hash);return this.current=parsed,this._applyRouter(parsed.url),this},stop:function(){this.changeListener&&(this.store.removeListener("urlChanged",this.changeListener,this),delete this.changeListener),this.destroyListener&&(this.store.removeListener("destroy",this.destroyListener,this),delete this.destroyListener)},getStateParameter:function(name){return this.current.states[name]},setStateParameter:function(name,value,isFireChanged){this.current.states[name]=value,this.setUrl(this.current),isFireChanged&&this.fire("stateChanged",{name:name,value:value})},getReferer:function(){return this.referer},setReferer:function(data){this.referer=data,storage.set("utils.routing.referer",this.referer)},restoreReferer:function(){var referer=storage.get("utils.routing.referer");return referer}});return Event.implementOn(Routing.prototype),Routing});
define('tau/utils/utils.history',["Underscore","tau/core/class","tau/core/event"],function(_,Class,Event){var History=Class.extend({init:function(){this.stack=[],this.current=null},size:function(){return this.stack.length},push:function(obj){var item=obj;return item.index=this.stack.length,this.stack.push(item),this},pop:function(){var item=this.stack.pop();return item},rewindTo:function(index){var length=this.stack.length;for(var i=length-1;i>=0;i--){var item=this.stack[i];item.index>index&&this.stack.pop()}return this.fire("changed"),this},setCurrent:function(obj){this.current=obj,this.fire("setCurrent")},getCurrent:function(){return this.current},process:function(){this.current&&this.stack.push(_.clone(this.current)),this.current=null},updateCurrent:function(data){this.current&&(this.current.url=data.url||this.current.url,this.current.title=data.title||this.current.title,this.current.id=data.id||this.current.id,this.fire("setCurrent"))},exclude:function(id,fire){this.stack=_.reject(this.stack,function(item,i){return item.id&&item.id==id}),this.current&&this.current.id==id&&(this.current=null),fire!==!1&&this.fire("changed")},reset:function(){this.current=null,this.stack=[]}});return Event.implementOn(History.prototype),History});
define('tau/storage/app.state.store.seriailzer',["Underscore"],function(_){return{extractSharedState:function(settings){var r=null;return settings.acid&&(r={},r[settings.id]={acid:settings.acid}),r},serialize:function(settings){return settings.acid?settings.id+'={"acid":"'+settings.acid+'"}':null}}});
define('tau/utils/utils.urlBuilder.service',["Underscore","jQuery","tau/core/class","tau/storage/app.state.store.seriailzer","tau/services/service.hash"],function(_,$,Class,AppStateStoreSerializer,ServiceHash){return Class.extend({init:function(configurator){this.applicationPath=configurator.getApplicationPath(),this.currentAcid=configurator.getCurrentAcid(),this.configurator=configurator,this.stateManager=configurator.getStateManager(),this.stateManager.get({id:"appConfig",fields:["acid"],callback:_.bind(function(res){res.acid&&(this.currentAcid=res.acid)},this)}),this.stateManager.bind({paramId:"appConfig",fieldName:"acid",listener:this,callback:_.bind(function(res){res.value&&(this.currentAcid=res.value)},this)}),this.pages={view:"/RestUI/TpView.aspx"}},getApplicationPath:function(){return this.applicationPath},getCurrentAcid:function(){return this.currentAcid},hash:function(){var localExternal=new ServiceHash(this.configurator),w={location:{hash:"",replace:function(value){w.location.hash=value}}};return localExternal.setWindow(w),{append:function(keyVal){return _.forEach(keyVal,function(val,key){localExternal.setHashParam(key,val)}),this},build:function(){return"#"+localExternal.getHash()}}},getViewUrl:function(id){return this.getApplicationPath()+"/View.aspx?noRedirect=1&id="+id},getAddImpedimentUrl:function(entityId){return this.getApplicationPath()+"/Project/Tracking/Impediment/Edit.aspx?AssignableID="+entityId},getAddTimeUrl:function(entityId){return this.getApplicationPath()+"/Project/Tracking/Time/Edit.aspx?AssignableID="+entityId},getAddTaskForUserStoryUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/Task/Edit.aspx?UserStoryID="+entityId},getAddTaskForRequestUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/Task/Edit.aspx?RequestID="+entityId},getSplitForUserStoryUrl:function(entityId,splittedStoryId){return this.getApplicationPath()+"/Project/Planning/UserStory/Split.aspx?UserStoryID="+entityId+"&SplittedStoryID="+splittedStoryId},getAddBugForUserStoryUrl:function(entityId){return this.getApplicationPath()+"/Project/QA/Bug/Edit.aspx?UserStoryID="+entityId},getAddBugForRequestUrl:function(entityId){return this.getApplicationPath()+"/Project/QA/Bug/Edit.aspx?RequestID="+entityId},getAddTestCaseForUserStoryUrl:function(entityId){return this.getApplicationPath()+"/Project/QA/TestCase/Edit.aspx?UserStoryID="+entityId},getAssignTestCasesForTestPlanUrl:function(entityId){return this.getApplicationPath()+"/Project/QA/TestPlan/AssignTestCases.aspx?TestPlanID="+entityId},getAddTestRunForTestPlanUrl:function(entityId){return this.getApplicationPath()+"/Project/QA/TestPlanRun/Edit.aspx?TestPlanID="+entityId},getAddUserStoryForRequestUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/UserStory/Edit.aspx?RequestID="+entityId},getAddUserStoryForFeatureUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/UserStory/Edit.aspx?FeatureID="+entityId},getAddUserStoryForIterationUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/UserStory/Edit.aspx?IterationID="+entityId},getAddUserStoryForTeamIterationUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/UserStory/Edit.aspx?TeamIterationID="+entityId},getAddFeatureForRequestUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/Feature/Edit.aspx?RequestID="+entityId},getAddTestCaseForTestPlanRunUrl:function(entityId){return this.getApplicationPath()+"/Project/QA/TestPlan/AssignTestCases.aspx?TestPlanID="+entityId},getAddIterationForReleaseUrl:function(entityId){return this.getApplicationPath()+"/Project/Planning/Iteration/Edit.aspx?ReleaseID="+entityId},getBoardPageRelativePath:function(){return"restui/board.aspx"},getPrintUrl:function(entityId,entityTypeName){return this.getApplicationPath()+"/RestUI/Print.aspx?id="+entityId+"&type=Tp.BusinessObjects."+entityTypeName},getPrintUrlRelative:function(entityId,entityTypeName){return"RestUI/Print.aspx?acid="+this.getCurrentAcid()+"#"+entityTypeName.toLowerCase()+"/"+entityId+"/print"},getNewViewUrl:function(entityId,entityTypeName,acid){var url={path:this.getApplicationPath()+this.pages.view,params:{},hash:""},acidArg=acid===!0?this.getCurrentAcid():acid;return acidArg&&(url.params.acid=acidArg),url.hash=entityTypeName.toLowerCase()+"/"+entityId,this._build(url)},getEditUrl:function(entityId,entityTypeName){var editUrl=this.getApplicationPath()+"/",name=entityTypeName.toLowerCase();return name=="project"?editUrl+="EditProject.aspx?ProjectID="+entityId:(editUrl+="Project/",_.indexOf(["bug","testplan","testcase","testplanrun"],name)>-1?editUrl+="QA/":_.indexOf(["impediment"],name)>-1?editUrl+="Tracking/":_.indexOf(["request"],name)>-1?editUrl+="HelpDesk/":name==="time"?editUrl+="Tracking/":editUrl+="Planning/",editUrl+=entityTypeName+"/Edit.aspx?"+entityTypeName+"ID="+entityId),editUrl},getAvatarUrl:function(userId,size){return this.getApplicationPath()+"/Avatar.ashx?UserId="+userId+"&size="+size},getDashboardUrl:function(){return this.getApplicationPath()+"/default.aspx"},getLogoutUrl:function(){return this.getApplicationPath()+"/login.aspx?logout=true"},getUserUrl:function(id,kind){var path="/User/View.aspx?UserID=";return kind&&kind=="Requester"&&(path="/User/Requester/View.aspx?RequesterID="),[this.getApplicationPath(),path,id].join("")},getRelativeBoardUrl:function(boardId,acidData){if(_.isUndefined(acidData))acidData=this.configurator.getAppStateStore().settings;else if(_.isString(acidData)){var acidDataConf=this.configurator.getAppStateStore().settings;acidDataConf.acid=acidData,acidData=acidDataConf}var boardUrlBuilder=this.hash();boardUrlBuilder.append({page:"board/"+boardId}),boardUrlBuilder.append(AppStateStoreSerializer.extractSharedState(acidData));var href=boardUrlBuilder.build();return href},getAdminWorkflowEdit:function(processId){return this.getApplicationPath()+"/Admin/Workflow.aspx?acid="+this.getCurrentAcid()+"&ProcessID="+processId+"&rmnav=1"},_build:function(schema){var url="";url=schema.path;var params=$.param(schema.params);return params&&(url=url+"?"+params),schema.hash&&(url=url+"#"+schema.hash),url},destroy:function(){this.stateManager.unbind(this)}})});
/**
 * @license RequireJS i18n 2.0.1 Copyright (c) 2010-2012, The Dojo Foundation All Rights Reserved.
 * Available via the MIT or new BSD license.
 * see: http://github.com/requirejs/i18n for details
 */

(function(){function addPart(locale,master,needed,toLoad,prefix,suffix){master[locale]&&(needed.push(locale),(master[locale]===!0||master[locale]===1)&&toLoad.push(prefix+locale+"/"+suffix))}function addIfExists(req,locale,toLoad,prefix,suffix){var fullName=prefix+locale+"/"+suffix;require._fileExists(req.toUrl(fullName))&&toLoad.push(fullName)}function mixin(target,source,force){var prop;for(prop in source)source.hasOwnProperty(prop)&&(!target.hasOwnProperty(prop)||force)?target[prop]=source[prop]:typeof source[prop]=="object"&&mixin(target[prop],source[prop],force)}var nlsRegExp=/(^.*(^|\/)nls(\/|$))([^\/]*)\/?([^\/]*)/;define('i18n',["module"],function(module){var masterConfig=module.config();return{version:"2.0.1",load:function(name,req,onLoad,config){config=config||{},config.locale&&(masterConfig.locale=config.locale);var masterName,match=nlsRegExp.exec(name),prefix=match[1],locale=match[4],suffix=match[5],parts=locale.split("-"),toLoad=[],value={},i,part,current="";match[5]?(prefix=match[1],masterName=prefix+suffix):(masterName=name,suffix=match[4],locale=masterConfig.locale,locale||(locale=masterConfig.locale=typeof navigator=="undefined"?"root":(navigator.language||navigator.userLanguage||"root").toLowerCase()),parts=locale.split("-"));if(config.isBuild){toLoad.push(masterName),addIfExists(req,"root",toLoad,prefix,suffix);for(i=0;i<parts.length;i++)part=parts[i],current+=(current?"-":"")+part,addIfExists(req,current,toLoad,prefix,suffix);req(toLoad,function(){onLoad()})}else req([masterName],function(master){var needed=[],part;addPart("root",master,needed,toLoad,prefix,suffix);for(i=0;i<parts.length;i++)part=parts[i],current+=(current?"-":"")+part,addPart(current,master,needed,toLoad,prefix,suffix);req(toLoad,function(){var i,partBundle,part;for(i=needed.length-1;i>-1&&needed[i];i--){part=needed[i],partBundle=master[part];if(partBundle===!0||partBundle===1)partBundle=req(prefix+part+"/"+suffix);mixin(value,partBundle)}onLoad(value)})})}}})})();
define('tau/nls/tokens',{root:{TargetProcess:"TargetProcess",board:"board",list:"list","Show in menu to all users":"Show in menu to all users","Remove board":"Remove board","show more":"show more"},"ru-ru":!0});
define('tau/nls/translator',["Underscore","i18n!tau/nls/tokens"],function(_,tokens){var gettext=function(t){var r=tokens.hasOwnProperty(t)?tokens[t]:t;return r=_.isFunction(r)?r():r,r};return gettext.gettext=gettext,gettext});
define('tau/store/services/service.globalSettings',["tau/core/class"],function(Class){var globalSettingsResult=null,GlobalSettingsService=Class.extend({init:function(config){this.config=config},resetSettings:function(){globalSettingsResult=null},getGlobalSettings:function(callbackInfo){var processCallback=function(callbackInfo,r){callbackInfo.success&&callbackInfo.success.call(callbackInfo.scope,r.d)};if(globalSettingsResult){processCallback(callbackInfo,globalSettingsResult);return}this.sendRequest("GlobalSettingsService","GetGlobalSettings",null,function(r){globalSettingsResult=r,processCallback(callbackInfo,r)},function(r){callbackInfo.failure&&callbackInfo.failure.call(callbackInfo.scope,r)})},sendRequest:function(serviceName,operationName,data,fnSuccess,fnError){var url=this.config.appPath+"/PageServices/"+serviceName+".asmx/"+operationName,cfg={contentType:"application/json",type:"POST",success:fnSuccess,error:fnError};data&&(cfg.data=JSON.stringify(data)),$.ajax(url,cfg)}});return GlobalSettingsService});
define('tau/libs/store2/store2',["Underscore","jQuery","tau/core/class"],function(_,$,Class){var store2=Class.extend({init:function(configurator){this.path=configurator.getApplicationPath()+"/api/v2/",this.service=$.ajax},escapeExpressionArgument:function(arg){return encodeURIComponent(this._jsEscape(_.asString(arg)))},getTeamsProjectsAvailable:_.memoize(function(userId){var o=this,query="User?select={AvailableProjects() as projects, AvailableTeams() as teams}&where=(id == "+userId+")",targetUrl=o.path+query;return o.service({url:targetUrl}).pipe(function(r){var defaultTeamsProjects={projects:[],teams:[]};return r.items.length===1?_.defaults(r.items[0],defaultTeamsProjects):defaultTeamsProjects})}),findAll:function(query){return this.service({url:this.path+query}).pipe(function(responseData){return responseData.items})},_jsEscape:function(content){return content.replace(/(["'\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r")}});return store2.prototype.arg=store2.prototype.escapeExpressionArgument,store2});
define('tau/services/service.applicationContext',["Underscore","jQuery","tau/core/class","tau/core/event","tau/libs/store2/store2"],function(_,$,Class,EventEmitter,Store2){var Service=Class.extend({init:function(configurator){this.configurator=configurator,this.store=configurator.getStore()},refreshChoice:function(){this.fire("refreshChoice.after")},setCurrentAcid:function(acid,callbacks){this.store.save("context",{acid:acid}).done(callbacks)},getTeamsProjectsAvailable:function(userId){var store=new Store2(this.configurator);return store.getTeamsProjectsAvailable(userId)},getApplicationContext:function(config,callbacks){var self=this,query={fields:["id","acid","culture","edition","appContext",{loggedUser:["id","email","isAdministrator"]},{processes:["id","name","terms","practices","customFields"]},{selectedProjects:["id","name",{process:["id","name"]}]},{selectedTeams:["id","name"]}]};config.hasOwnProperty("acid")?query.acid=config.acid:config.hasOwnProperty("ids")&&(query.ids=config.ids);if(config.hasOwnProperty("projectIds")||config.hasOwnProperty("projectId"))query.projectIds=config.projectIds||config.projectId;if(config.hasOwnProperty("teamIds")||config.hasOwnProperty("teamId"))query.teamIds=config.teamIds||config.teamId;query.id=config.id||config.acid;var commandName=config.id||config.acid?"get":"turboGet",store=this.store;store[commandName]("context",query).done({success:function(result){var appCtx=result[0].data;_.isArray(appCtx)&&(appCtx=appCtx[0]);var editions=appCtx.edition?[appCtx.edition]:[];self.isBoardEdition&&(editions.push("board"),editions.push("hasTeams")),appCtx.edition=editions;var settings=appCtx.appContext||{};_.defaults(settings,{projectContext:{no:!1},teamContext:{no:!1}});var defProjects=settings.projectContext.no?["null"]:[],defTeams=settings.teamContext.no?["null"]:[];appCtx.selectedProjectIds=_.union(defProjects,_.pluck(appCtx.selectedProjects,"id")),appCtx.selectedTeamIds=_.union(defTeams,_.pluck(appCtx.selectedTeams,"id")),self.getTeamsProjectsAvailable(appCtx.loggedUser.id).done(function(d){var availableTeams=_(d.teams).pluck("id"),availableProjs=_(d.projects).pluck("id");appCtx.selectedTeamIdsAvailable=_.intersection(appCtx.selectedTeamIds,availableTeams),appCtx.selectedProjectIdsAvailable=_.intersection(appCtx.selectedProjectIds,availableProjs),callbacks.success.apply(null,[appCtx])})},failure:function(){callbacks.failure&&callbacks.failure.apply(null,[arguments[0][0].data.response.Message])}})}});return EventEmitter.implementOn(Service.prototype),Service});
define('tau/store/services/service.notifications',["tau/core/class"],function(Class){var NotificationsService=Class.extend({init:function(config){this.config=config},notifyComment:function(commentId,options,callbackInfo){callbackInfo=callbackInfo||{},this.sendRequest("CommentsNotificationService","Notify",{commentId:commentId,options:options},function(r){callbackInfo.success&&callbackInfo.success.call(callbackInfo.scope,r.d)},function(r){callbackInfo.failure&&callbackInfo.failure.call(callbackInfo.scope,r)})},sendRequest:function(serviceName,operationName,data,fnSuccess,fnError){var url=this.config.appPath+"/PageServices/"+serviceName+".asmx/"+operationName,cfg={contentType:"application/json",type:"POST",success:fnSuccess,error:fnError};data&&(cfg.data=JSON.stringify(data)),$.ajax(url,cfg)}});return NotificationsService});
define('tau/store/services/service.actions',["jQuery","Underscore","tau/core/class"],function($,_,Class){var ActionsService=Class.extend({init:function(config){this.config=config},getActionUrl:function(action){return this.config.appPath+"/PageServices/ActionsService.asmx/"+action},getActiveProjectForEntity:function(generalId,success,error){var data={generalId:generalId};this.sendRequest("GetActiveProjectForEntity",data,success,error)},copyGeneralToProject:function(generalId,projectId,success,error){var data={generalId:generalId,projectId:projectId};this.sendRequest("CopyGeneralToProject",data,success,error)},getProjectIds:function(success,error){var data={};this.sendRequest("GetProjectIds",data,success,error)},moveGeneralToProject:function(generalId,projectId,success,error){var data={generalId:generalId,projectId:projectId};this.sendRequest("MoveGeneralToProject",data,success,error)},attachGeneralToRequest:function(generalId,requestId,success,error){var data={generalId:generalId,requestId:requestId};this.sendRequest("AttachGeneralToRequest",data,success,error)},detachRequest:function(operationConfig){var noop=function(){},data={generalId:operationConfig.generalId,requestId:operationConfig.requestId};operationConfig=_(operationConfig).defaults({success:noop,error:noop}),this.sendRequest("DetachRequestFromGeneral",data,operationConfig.success,operationConfig.error)},getEntityTypesToConvert:function(entityId){return this.sendRequestDef("GeneralCanConvertTo",{generalId:entityId}).pipe(function(result){return _.map(result.d,function(v){return{id:v.ID,name:v.EntityTypeName}})})},convertGeneralToTask:function(generalId,userStoryId,success,error){var data={generalId:generalId,userStoryId:userStoryId};this.sendRequest("ConvertGeneralToTask",data,success,error)},convertGeneralToType:function(generalId,entityTypeId,success,error){var data={generalId:generalId,entityTypeId:entityTypeId};this.sendRequest("ConvertGeneralToType",data,success,error)},splitUserStory:function(generalId,success,error){var data={generalId:generalId};this.sendRequest("SplitUserStory",data,success,error)},sendRequest:function(actionName,data,success,error){$.ajax(this.getActionUrl(actionName),{contentType:"application/json",type:"POST",data:JSON.stringify(data),success:success,error:error})},sendRequestDef:function(actionName,data){return $.ajax({url:this.getActionUrl(actionName),contentType:"application/json",type:"POST",data:JSON.stringify(data)})}});return ActionsService});
define('tau/core/query',["jQuery","Underscore","libs/json2"],function($,_){return{find:function(list,$query){var result=[],self=this,filters=self._formWhere($query,"",function(operator,queryKey,value){return{operator:operator,key:queryKey,value:value}});return _.each(list,function(obj){var noMatch=!1;_.each(filters,function(filter){if(noMatch)return;var value=self._getObjectValue(obj,filter.key);_.isUndefined(value)&&(noMatch=!0),filter.operator.compare(value,filter.value)||(noMatch=!0)}),noMatch||result.push(obj)}),result},render:function($query,fnFormat){return this._getWhere($query,fnFormat)},_initializeDefaultRenders:function(operatorRenders){_.defaults(operatorRenders,{defaultRenderer:function(key,value){var self=this,outR=[];return _.isArray(value)||(value=[value]),_.each(value,function(v){outR.push("("+key+self.name+JSON.stringify(v)+")")}),outR},$in:function(key,value){var self=this,outR=[];_.isArray(value)||(value=[value]);var res=[];return _(value).each(function(vr){res.push(JSON.stringify(vr))}),outR.push("("+key+" "+self.name+" ["+res.join(",")+"])"),outR}})},_getObjectValue:function(obj,key){var path=key.split("."),value=obj;for(var i=0;i<path.length;i++){if(!obj.hasOwnProperty(path[i]))return undefined;value=obj[path[i]]}return value},_getQueryOperators:function(){var operatorRenders={};this._initializeDefaultRenders(operatorRenders);var operators={$in:{name:"in",compare:function(a,b){return _.any(b,function(v){return v==a})}},$ne:{name:"!=",compare:function(a,b){return a!=b}},$eq:{name:"==",compare:function(a,b){return a==b}}};return _.each(_(operators).keys(),function(op){var operator=operators[op];operator.render=operatorRenders.hasOwnProperty(op)?operatorRenders[op]:operatorRenders.defaultRenderer}),operators},_isQueryValueWithOperator:function(queryValue,operators){var keys=_(queryValue).keys();if(keys.length===0)return!1;var $operators=operators||this._getQueryOperators();return $operators.hasOwnProperty(keys[0])},_formWhere:function($query,prefix,fnForm){var filters=[];fnForm=fnForm||function(operator,queryKey,value){return operator.render(queryKey,value)};var self=this;prefix=prefix||"";var operators=self._getQueryOperators();return _.each(_($query).keys(),function(key){if(key[0]==="$")return;var value=$query[key],queryKey=prefix+key;if(_.isString(value)||_.isNumber(value)||_.isDate(value)||_.isArray(value)||_.isBoolean(value)||_.isNull(value)){var $operator=value===null?"$isNull":"$eq";filters=filters.concat(fnForm(operators[$operator],queryKey,value));return}if(self._isQueryValueWithOperator(value,operators)){_.each(_(value).keys(),function(op){filters=filters.concat(fnForm(operators[op],queryKey,value[op]))});return}var items=self._formWhere(value,key+".",fnForm);_.each(items,function(f){filters.push(f)})}),filters},_getWhere:function($query,formatFn){formatFn=formatFn||function(f){return"("+filters.join("and")+")"};var filters=this._formWhere($query);return filters.length===0?"":formatFn(filters)}}});
define('tau/storage/url.resolver',["jQuery","Underscore","app.path","tau/core/query"],function($,_,appPath,query){var path=appPath.get(),applicationUrl=path+"/storage/v1/";return{resolve:function(config){config=_.clone(config||{});var url=applicationUrl+config.$group||"common";config.$key&&(url+="/"+config.$key),url+="?";var $where=config.$where&&_.isString(config.$where)?config.$where:query.render(config.$where||{});return $where&&(url+="&where="+$where),config.$fields&&config.$fields.length&&(url+="&select=new("+config.$fields.join(",")+")"),encodeURI(url)}}});
define('tau/storage/api.nocache',["tau/core/bus","jQuery","Underscore","./url.resolver","tau/core/event"],function(Class,$,_,resolver,Event){var deconvertNode=function(node){node=node||{};var ignoreKeys=["key","ownerId","scope","id","group","data","userData","publicData"],keys=_.difference(_.keys(node),ignoreKeys);return _.each(keys,function(key){node[key]=JSON.parse(node[key])}),node.publicData&&(node.publicData=deconvertNode(node.publicData)),node.userData&&(node.userData=deconvertNode(node.userData)),node},convertNode=function(node){node=node||{};var result={};return _.each(_.keys(node),function(key){result[key]=JSON.stringify(node[key])}),result},jsonConvert=function(text){if(!text)return null;var jsonR=(text?JSON.parse(text):null)||{},items=[];return jsonR.items?(_.each(jsonR.items,function(item){items.push(deconvertNode(item))}),items):deconvertNode(jsonR)},API=Class.extend({config:null,init:function(config){this.config=config||{},_.defaults(this.config,{service:$.ajax})},getServiceDeferred:function(ajaxConfig){return this.config.service(ajaxConfig)},_makeServiceCall:function(ajaxConfig,$deferred,result){var self=this,onGetData=function(r){result.data=r,r&&(r.publicData||r.userData)&&(result.value=_.extend(_.extend({},r.publicData||{}),r.userData||{})),$deferred.resolve(result)};return self.getServiceDeferred(ajaxConfig,$deferred).done(onGetData).fail(function(err){if(err.status===0)return;try{err.responseText=JSON.parse(err.responseText)}catch(e){err.responseText={message:err.statusText}}result.data=err,$deferred.reject(result);var error=err.responseText;self.fire("error",error)}),$deferred},resolve:function($deferred){var config=$deferred.$config,url=resolver.resolve($deferred.$config),ajaxConfig={url:url,dataType:"json",$scope:config,converters:{"text json":jsonConvert}},result={ajaxConfig:ajaxConfig,config:config};if(config.$actionType==="DELETE")ajaxConfig.type="POST",ajaxConfig.contentType="application/json; charset=utf-8",ajaxConfig.beforeSend=function(xhr){xhr.setRequestHeader("X-HTTP-Method-Override","DELETE")};else if(config.$value){var $value=_.clone(config.$value);$value.userData=convertNode($value.userData),$value.publicData=convertNode($value.publicData),ajaxConfig.type="POST",ajaxConfig.contentType="application/json; charset=utf-8",ajaxConfig.data=JSON.stringify($value)}return this._makeServiceCall(ajaxConfig,$deferred,result)},select:function(group,config){return config.$group=group,this.resolveDeferred(config)},remove:function(group,config){config.$group=group,config.$actionType="DELETE",this.fire("beforeRemove",config);var query=$.Deferred();return query.$config=config,query.always(_.bind(function(){this.fire("afterRemove",config)},this,config)),this.resolve(query),query},data:function(group,key,value){if(!group)throw new Error("group is required");_.isObject(key)&&(value=key,key=null),value&&!value.hasOwnProperty("publicData")&&!value.hasOwnProperty("userData")&&(value={userData:value});var config={$group:group,$key:key,$value:value},commands={};key?commands={before:"beforeUpdate",after:"afterUpdate"}:commands={before:"beforeInser",after:"afterInsert"},this.fire(commands.before,config);var query=$.Deferred();return query.$config=config,query.always(_.bind(function(){this.fire(commands.after,config)},this,config)),this.resolve(query)},createDeferredCall:function(config){var $deferred=$.Deferred();return $deferred.$config=config,$deferred},resolveDeferred:function(config){return this.resolve(this.createDeferredCall(config))}});return Event.implementOn(API.prototype),API});
define('tau/storage/api',["./api.nocache","jQuery","Underscore"],function(Class,$,_){return Class.extend({_cache:{},_getCacheKey:function(ajaxConfig,$deferred){var self=this,cacheKey=ajaxConfig.url.toLowerCase(),$dataKey=$deferred.$config.$key||$deferred.$config.key,$dataGroup=$deferred.$config.$group||$deferred.$config.group;$dataGroup&&$dataKey&&(cacheKey=($dataGroup+"_"+$dataKey).toLowerCase()),!$dataKey&&ajaxConfig.type==="POST"&&(cacheKey=null);if(ajaxConfig.type==="POST"||ajaxConfig.type==="DELETE"){var _cache=self._cache[self.getGroupCacheKey($dataGroup)];if(_cache){var groupKeys=_.keys(_cache);_.each(groupKeys,function(key){delete self._cache[key]}),delete self._cache[self.getGroupCacheKey($dataGroup)]}}return cacheKey},_makeServiceCall:function(ajaxConfig,$deferred,result){var self=this,cacheKey=this._getCacheKey(ajaxConfig,$deferred);return(!ajaxConfig.type||ajaxConfig.type==="GET")&&self._cache.hasOwnProperty(cacheKey)?self._cache[cacheKey]:(cacheKey&&(self._cache[cacheKey]=$deferred),this._super(ajaxConfig,$deferred,result))},getGroupCacheKey:function(name){return("group_cache_"+name).toLowerCase()},getServiceDeferred:function(ajaxConfig,$deferred){var $dataGroup=$deferred.$config.$group||$deferred.$config.group,self=this;return self._super(ajaxConfig).done(function(r){if(r&&r.group&&r.key)self._cache[(r.group.name+"_"+r.key).toLowerCase()]=$deferred;else{var g=self.getGroupCacheKey($dataGroup);self._cache.hasOwnProperty(g)||(self._cache[g]={}),self._cache[g][ajaxConfig.url.toLowerCase()]={}}})}})});
define('tau/store/acid.store',["Underscore","tau/core/class"],function(_,Class){var noop=function(){},createAccumulatorCallback=function(sourceKeys,callback){var accumulator=new Array(sourceKeys.length);return function(e){var cmdId=e.uid,data=e.data;accumulator[cmdId]=data,sourceKeys=_(sourceKeys).without(cmdId),sourceKeys.length===0&&callback(accumulator)}};return Class.extend({init:function(settingsConfig,sources){var self=this;self.settings=settingsConfig,self.sources=sources,self.callbacksMap=[],self.fieldsRetrieved=[],self.commonCallback=_.bind(function(e){var bs=this,data=e.data,diff=bs.mergeChanges(data);diff!==null&&bs.applyCallback(diff)},self)},getGroupName:function(){return this.settings.groupName},applyCallback:function(diff){var keys=_(diff).keys();for(var i=0;i<this.callbacksMap.length;i++){var command=this.callbacksMap[i];this.matchCommandCallback(keys,command)&&command.callback.apply(command.listener,[diff])}},matchCommandCallback:function(keys,cmd){var intersection=_.intersection(keys,cmd.fields);return intersection.length>0},each:function(iterator,emptyCallback){if(this.sources.length)_(this.sources).each(iterator);else{var callback=emptyCallback||noop;callback()}},mergeChanges:function(dataUpdate){var self=this,settings=self.settings,fields=_(dataUpdate).keys(),diff=null;for(var i=0;i<fields.length;i++){var fieldName=fields[i];self.markFieldsRetrieved(fieldName),_.isEqual(settings[fieldName],dataUpdate[fieldName])||(diff=diff||{},diff[fieldName]=settings[fieldName]=_.cloneDeep(dataUpdate[fieldName]))}return diff},markFieldsRetrieved:function(fieldNameOrFields){fieldNameOrFields=_.isString(fieldNameOrFields)?[fieldNameOrFields]:fieldNameOrFields,this.fieldsRetrieved=_.union(this.fieldsRetrieved,fieldNameOrFields)},selectNotRetrievedFields:function(requestedFields){return _.difference(requestedFields,this.fieldsRetrieved)},get:function(cmd){var self=this;_(cmd).defaults({callback:noop});var settings=self.settings,result={},sources=self.sources,sourceKeys=_.range(sources.length),fields=self.selectNotRetrievedFields(cmd.fields),accumulatorCallback=function(responses){self.markFieldsRetrieved(fields),_(responses).each(function(r){for(var i=0;i<fields.length;i++){var fieldName=fields[i],fieldValue=r[fieldName]!==null?r[fieldName]:settings[fieldName];!_.isNaN(fieldValue)&&!_.isNull(fieldValue)&&!_.isUndefined(fieldValue)&&(result[fieldName]=fieldValue)}}),_(settings).extend(result);var clone={};$.extend(!0,clone,settings),cmd.callback(clone)};if(fields.length===0)accumulatorCallback([]);else{var commonAccumulatorCallback=createAccumulatorCallback(sourceKeys,accumulatorCallback);self.each(function(s,index){s.get({uid:index,fields:fields,callback:commonAccumulatorCallback})},function(){accumulatorCallback([])})}},set:function(cmd){var self=this;_(cmd).defaults({callback:noop});var sources=self.sources,sourceKeys=_.range(sources.length),accumulatorCallback=function(responses){},commonCallback=createAccumulatorCallback(sourceKeys,accumulatorCallback);self.each(function(s,index){s.set({uid:index,set:cmd.set,callback:commonCallback})},function(){accumulatorCallback([])}),self.commonCallback({data:cmd.set}),cmd.callback(self.settings)},registerSubscription:function(cmd){var self=this;return self.callbacksMap.push(cmd),this.commonCallback},unregisterSubscription:function(listener){var self=this;if(self.callbacksMap.length==0)return;self.callbacksMap=_.reject(self.callbacksMap,function(callback){return listener===callback.listener})},bind:function(cmd){var self=this,commonCallback=self.registerSubscription(cmd);self.each(function(s,index){s.bind({uid:index,fields:cmd.fields,listener:self,callback:commonCallback})})},unbind:function(cmd){var self=this;self.each(function(s){s.unbind({listener:self})}),self.unregisterSubscription(cmd.listener)},dispose:function(){var self=this;self.each(function(s,index){s.unbind({listener:self})}),self.callbacksMap=[]}})});
define('tau/libs/boardSettings/model.board.settings',["Underscore","jQuery","tau/core/class"],function(_,$,Class){var noop=function(){},createAccumulatorCallback=function(sourceKeys,callback){var accumulator=new Array(sourceKeys.length);return function(e){var cmdId=e.uid,data=e.data;accumulator[cmdId]=data,sourceKeys=_(sourceKeys).without(cmdId),sourceKeys.length===0&&callback(accumulator)}};return Class.extend({init:function(settingsConfig,sources){var self=this;self.settings=_.defaults(settingsConfig,{cache:!0}),self.sources=sources,self.callbacksMap=[],self.responses=[],self.fieldsRetrieved=[],self.commonCallback=_.bind(function(e,sourceIndex){var bs=this,data=e.data,cmd=e.cmd||{},diff=bs.mergeChanges(data,sourceIndex);diff!==null&&bs.applyCallback(diff,cmd.isSilent)},self)},getGroupName:function(){return this.settings.groupName},applyCallback:function(diff,isSilent){var keys=_(diff).keys(),callbacksMap=_.clone(this.callbacksMap);for(var i=0;i<callbacksMap.length;i++){var command=callbacksMap[i];this.matchCommandCallback(keys,command)&&!command.isDeleted&&(!isSilent||command.skipSilentCallsFiltering)&&command.callback.apply(command.listener,[diff])}},matchCommandCallback:function(keys,cmd){var intersection=_.intersection(keys,cmd.fields);return intersection.length>0},each:function(iterator,emptyCallback){if(this.sources.length)_(this.sources).each(iterator);else{var callback=emptyCallback||noop;callback()}},mergeChanges:function(dataUpdate,index){var self=this,settings=self.settings,fields=_(dataUpdate).keys(),diff=null;for(var i=0;i<fields.length;i++){var fieldName=fields[i];self.markFieldsRetrieved(fieldName),_.isEqual(settings[fieldName],dataUpdate[fieldName])||(diff=diff||{},_.isNumber(index)?((self.responses[index]=self.responses[index]||[])[fieldName]=_.cloneDeep(dataUpdate[fieldName]),diff[fieldName]=settings[fieldName]=self.getField(fieldName)):diff[fieldName]=settings[fieldName]=_.cloneDeep(dataUpdate[fieldName]))}return diff},getField:function(fieldName){var fieldValue;return _.each(this.responses,function(response){!_.isNull(response[fieldName])&&!_.isUndefined(response[fieldName])&&!_.isNaN(response[fieldName])&&(fieldValue=response[fieldName])}),fieldValue},markFieldsRetrieved:function(fieldNameOrFields){fieldNameOrFields=_.isString(fieldNameOrFields)?[fieldNameOrFields]:fieldNameOrFields,this.fieldsRetrieved=_.union(this.fieldsRetrieved,fieldNameOrFields)},selectNotRetrievedFields:function(requestedFields){return this.settings.cache?_.difference(requestedFields,this.fieldsRetrieved):requestedFields},get:function(cmd){var self=this;_(cmd).defaults({callback:noop});var settings=self.settings,result={},sources=self.sources,sourceKeys=_.range(sources.length),fields=self.selectNotRetrievedFields(cmd.fields),accumulatorCallback=function(responses){self.markFieldsRetrieved(fields),_(responses).each(function(r,i){self.responses[i]=_.extend(self.responses[i]||{},r);for(var i=0;i<fields.length;i++){var fieldName=fields[i],fieldValue=r[fieldName]!==null?r[fieldName]:settings[fieldName];!_.isNaN(fieldValue)&&!_.isNull(fieldValue)&&!_.isUndefined(fieldValue)&&(result[fieldName]=fieldValue)}}),_(settings).extend(result);var clone={};$.extend(!0,clone,settings),cmd.callback(clone)};if(fields.length===0)accumulatorCallback([]);else{var commonAccumulatorCallback=createAccumulatorCallback(sourceKeys,accumulatorCallback,cmd);self.each(function(s,index){s.get({uid:index,fields:fields,callback:commonAccumulatorCallback})},function(){accumulatorCallback([])})}},set:function(cmd){var self=this,cmdSet=_.cloneDeep(cmd.set);_(cmd).defaults({callback:noop});var sources=self.sources,sourceKeys=_.range(sources.length),accumulatorCallback=function(responses){},commonCallback=createAccumulatorCallback(sourceKeys,accumulatorCallback);self.each(function(s,index){s.set({uid:index,set:cmdSet,callback:function(e){commonCallback.call(this,e,index)}})},function(){accumulatorCallback([])}),self.commonCallback({data:cmdSet,cmd:cmd}),cmd.callback(self.settings)},setDef:function(cmd){var cmdSet=_.cloneDeep(cmd.set),sources=this.sources;return $.when.apply(null,_.map(sources,function(source){var $def=$.Deferred();return source.set({uid:0,set:cmdSet,callback:$def.resolve}),$def})).done(_.bind(function(){this.commonCallback({data:cmdSet,cmd:cmd})},this))},registerSubscription:function(cmd){var self=this;return self.callbacksMap.push(cmd),this.commonCallback},unregisterSubscription:function(listener){var self=this;if(self.callbacksMap.length==0)return;self.callbacksMap=_.reject(self.callbacksMap,function(callback){var rejected=listener===callback.listener;return rejected&&(callback.isDeleted=!0),rejected})},bind:function(cmd){var self=this,commonCallback=self.registerSubscription(cmd);self.each(function(s,index){s.bind({uid:index,fields:cmd.fields,listener:cmd.listener,callback:function(e){commonCallback.call(this,e,index)}})})},unbind:function(cmd){var self=this;self.each(function(s){s.unbind({listener:cmd.listener})}),self.unregisterSubscription(cmd.listener)},dispose:function(){var self=this;self.each(function(s,index){s.unbind({listener:self})}),self.callbacksMap=[]}})});
define('tau/core/async.source.adapter',["tau/core/class"],function(Class){var uniqWrapper=function(cmd,method){if(!cmd.hasOwnProperty("uid"))throw"required parameter [uid] is missed in command";var commandCallback=cmd.callback,callback=function(stateData){var e={uid:cmd.uid,data:stateData};commandCallback(e)};cmd.callback=callback,method(cmd)};return Class.extend({init:function(proxy){this.proxy=proxy},get:function(cmd){return uniqWrapper(cmd,this.proxy.onGet),this},set:function(cmd){return uniqWrapper(cmd,this.proxy.onSet),this},bind:function(cmd){return uniqWrapper(cmd,this.proxy.onBind),this},unbind:function(cmd){return this.proxy.onUnbind(cmd),this}})});
define('tau/libs/boardSettings/asyncSource.stateManager',["Underscore","tau/core/async.source.adapter"],function(_,AsyncSourceAdapter){var createStateManagerAsyncSource=function(serviceContainer,settings){var stateManager=serviceContainer.getStateManager();return new AsyncSourceAdapter({onGet:function(cmd){stateManager.get({id:settings.id,fields:cmd.fields,callback:cmd.callback})},onSet:function(cmd){stateManager.set({id:settings.id,set:cmd.set,callback:cmd.callback})},onBind:function(cmd){var callback=function(data){var result={};result[data.fieldName]=data.value,cmd.callback.call(this,result)};stateManager.bind({paramId:settings.id,fieldName:cmd.fields[0],callback:callback,listener:cmd.listener})},onUnbind:function(cmd){stateManager.unbind(cmd.listener)}})};return{create:createStateManagerAsyncSource}});
define('tau/libs/boardSettings/asyncSource.componentSpecific',["Underscore","tau/core/async.source.adapter"],function(_,AsyncSourceAdapter){var createComponentStorageAsyncSource=function(serviceContainer,settings){var storage=serviceContainer.getRestStorage();return new AsyncSourceAdapter({onGet:function(cmd){storage.data(settings.groupName,settings.id).done(function(result){var data=result.data||{};data=data.userData||{};var fields={};for(var i=0;i<cmd.fields.length;i++){var fieldName=cmd.fields[i];data.hasOwnProperty(fieldName)&&(fields[fieldName]=data[fieldName])}cmd.callback(fields)})},onSet:function(cmd){var set=cmd.set;storage.data(settings.groupName,settings.id,{scope:"Public",userData:set}).done(function(r){cmd.callback(set)})},onBind:function(cmd){},onUnbind:function(cmd){}})};return{create:createComponentStorageAsyncSource}});
define('tau/libs/boardSettings/asyncSource.boardSpecific',["Underscore","tau/core/async.source.adapter"],function(_,AsyncSourceAdapter){var applyBoardSettingsSchema=function(update,requestRef){requestRef.publicData={},requestRef.userData={};var publicFields=["x","y","cells","name","isShared","acid","limits","customSharedData","prioritization"];return _(update).each(function(v,k){var isPublic=_.indexOf(publicFields,k)!==-1,field=isPublic?"public":"user";requestRef[field+"Data"][k]=v}),requestRef},createBoardSpecificStorageAsyncSource=function(serviceContainer,settings){var storage=serviceContainer.getRestStorage();return new AsyncSourceAdapter({onGet:function(cmd){storage.data(settings.groupName,settings.id).done(function(result){var r=result.data||{},publicData=r.publicData||{},userData=r.userData||{},data=r;_.extend(data,publicData,userData);var fields={};for(var i=0;i<cmd.fields.length;i++){var fieldName=cmd.fields[i];data.hasOwnProperty(fieldName)&&(fields[fieldName]=data[fieldName])}cmd.callback(fields)})},onSet:function(cmd){var set=cmd.set;set.isDraft=!1;var requestBody={scope:"Public"};applyBoardSettingsSchema(set,requestBody),storage.data(settings.groupName,settings.id,requestBody).done(function(){cmd.callback(set)})},onBind:function(){},onUnbind:function(){}})};return{create:createBoardSpecificStorageAsyncSource}});
define('tau/libs/boardSettings/asyncSource.url',["Underscore","tau/core/async.source.adapter","libs/parseUri"],function(_,AsyncSourceAdapter,ParseUri){return{create:function(serviceContainer){return new AsyncSourceAdapter({onGet:function(cmd){var href=serviceContainer.getExternal().getHref(),parsedHref=ParseUri(href),result={};for(var i=0;i<cmd.fields.length;i++){var fieldName=cmd.fields[i];parsedHref.queryKey.hasOwnProperty(fieldName)&&(result[fieldName]=parsedHref.queryKey[fieldName])}cmd.callback(result)},onSet:function(cmd){},onBind:function(cmd){},onUnbind:function(cmd){}})}}});
define('tau/libs/boardSettings/asyncSource.acid',["Underscore","tau/core/async.source.adapter"],function(_,AsyncSourceAdapter,ParseUri){return{create:function(serviceContainer){return new AsyncSourceAdapter({onGet:function(cmd){cmd.callback({})},onSet:function(cmd){cmd.set.acid&&serviceContainer.getApplicationContextService().setCurrentAcid(cmd.set.acid)},onBind:function(cmd){},onUnbind:function(cmd){}})}}});
define('tau/libs/boardSettings/factory.board.settings',["Underscore","tau/core/class","tau/libs/boardSettings/model.board.settings","tau/libs/boardSettings/asyncSource.stateManager","tau/libs/boardSettings/asyncSource.componentSpecific","tau/libs/boardSettings/asyncSource.boardSpecific","tau/libs/boardSettings/asyncSource.url","tau/libs/boardSettings/asyncSource.acid"],function(_,Class,BoardSettings,AsyncSourceStateManager,AsyncSourceComponentSpecific,AsyncSourceBoardSpecific,AsyncSourceUrl,AsyncSourceAcid){return Class.extend({init:function(configurator){this.serviceContainer=configurator},create:function(definition){return _.isObject(definition)||(definition={id:definition}),_.defaults(definition||{},this.serviceContainer.getBoardSettingsOptions()),this.createInstance(definition)},createInstance:function(settingsConfig){var sources=[],serviceContainer=this.serviceContainer;return serviceContainer.isBoardEdition||sources.push(AsyncSourceStateManager.create(serviceContainer,settingsConfig)),sources.push(AsyncSourceBoardSpecific.create(serviceContainer,settingsConfig)),new BoardSettings(settingsConfig,sources)},createComponentSettings:function(settingsConfig){var sources=[],serviceContainer=this.serviceContainer;return _.defaults(settingsConfig,{groupName:"settings"}),sources.push(AsyncSourceComponentSpecific.create(serviceContainer,settingsConfig)),serviceContainer.isBoardEdition||sources.push(AsyncSourceStateManager.create(serviceContainer,settingsConfig)),new BoardSettings(settingsConfig,sources)},createAcidSettings:function(settings){settings=_.defaults(settings,{cache:!1});var configurator=this.serviceContainer;return new BoardSettings(settings,[AsyncSourceUrl.create(configurator,settings),AsyncSourceStateManager.create(configurator,settings),AsyncSourceAcid.create(configurator,settings)])},clear:function(){}})});
define('tau/slice/url.resolver',["jQuery","Underscore","app.path","tau/core/query"],function($,_,appPath,query){var path=appPath.get(),applicationUrl=path+"/slice/v1/",convertCell=function(node){var def={};if(!node)return null;_.isString(node)&&(node=[node]);if(_.isArray(node))def.id=node.length?node[0]:null,def.filter=null,def.ordering=null;else if(_.isObject(node)){var type=node.type||node.types;_.isArray(type)?def.id=type.length?type[0]:null:def.id=type,_.isString(node.data)&&(def.data=node.data),def.filter=node.filter||null,def.ordering=node.ordering&&node.ordering.name?node.ordering:null}return def},convertCells=function(node){var def={};return node?(_.isArray(node)?def.items=node:_.isObject(node)&&(def.items=node.items||node.types||node.type,def.filter=node.filter||null,def.ordering=node.ordering&&node.ordering.name?node.ordering:null),_.forEach(def.items,function(v,k){def.items[k]=convertCell(v)}),def):null};return{resolve:function(definition,command,options){var url=[applicationUrl,"matrix/",command.method].join(""),config=_.clone(command.config||{});_.defaults(config,{});var parameters={base64:options.base64||!1};options.clientId&&(parameters.clientId=options.clientId),parameters.take=config.$take,config.$skip&&(parameters.skip=config.$skip);if(!options.disableWhereScope){var $where=query.render(config);$where&&(parameters.where=$where);var $whereX=query.render(config.$whereX||{});$whereX&&(parameters.whereX=$whereX);var $whereY=query.render(config.$whereY||{});$whereY&&(parameters.whereY=$whereY)}config.$set&&_.forEach(config.$set,function(value,key){parameters[key]=value});var acid=definition.global?definition.global.acid:null,def={global:{acid:acid}};if(definition.hasOwnProperty("x")){var x=convertCell(_.cloneDeep(definition.x));x&&(def.x=x)}if(definition.hasOwnProperty("user")){var user=_.cloneDeep(definition.user);user.cardFilter&&(def.user=user)}if(definition.hasOwnProperty("y")){var y=convertCell(_.cloneDeep(definition.y));y&&(def.y=y)}definition.hasOwnProperty("cells")&&(def.cells=convertCells(_.cloneDeep(definition.cells))),definition.hasOwnProperty("entityId")&&definition.hasOwnProperty("entityType")&&(def.entityId=definition.entityId,def.entityType=definition.entityType),parameters.definition=def;var paramsForUrl=_.clone(parameters);return delete paramsForUrl.clientId,{serviceUrl:url,parameters:parameters,url:url+"?"+$.param(paramsForUrl)}}}});
define('tau/slice/api',["tau/core/Class","jQuery","Underscore","./url.resolver","tau/core/event"],function(Class,$,_,resolver,Event){var API=Class.extend({init:function(config){this.config=config||{},this.id=_.uniqueId("slice/"+ +(new Date)+"/"+_.UUID()),this._requests={},_.defaults(this.config,{definition:{},service:$.ajax,base64:!1,clientId:this.id,options:{}})},getSliceParams:function(){var slice=this,sliceConfig=slice.config,urlConfig=resolver.resolve(sliceConfig.definition,{method:"noop"},{base64:sliceConfig.base64,clientId:sliceConfig.clientId});return urlConfig.parameters},clone:function(){var cloneAPI=new API(_.deepClone(this.config));return cloneAPI.id=this.id,cloneAPI},_deferredResolved:function(config,result){this.fire("after."+config.command.method,{result:result.data,command:config.command}),config.$deferred.resolve(result)},_deferredRejected:function(config,result){config.$deferred.reject(result)},abort:function(){var values=_.values(this._requests);this._requests={};while(values.length>0){var ajaxCall=values.pop();ajaxCall.abort()}},getCallOptions:function(options){return options=options||{},_.defaults(options,{base64:this.config.base64}),options.sign&&(options.clientId=this.config.clientId),options},resolve:function(config,options){config=config||{};var command=config.command||{};options=this.getCallOptions(options);var urlConfig=resolver.resolve(this.config.definition,command,options),callStatistics={},ajaxConfig={type:"POST",url:urlConfig.serviceUrl,dataType:"json",data:JSON.stringify(urlConfig.parameters),contentType:"application/json; charset=utf-8",$scope:config,beforeSend:function(){callStatistics.start=(new Date).getTime()}},result={ajaxConfig:ajaxConfig,command:command},self=this,id=_.uniqueId("ajaxCall"),request=this.config.service(ajaxConfig);return self._requests[id]=request,request.done(function(r,status,responseValue){callStatistics.end=(new Date).getTime();if(!self._requests.hasOwnProperty(id))return;delete self._requests[id],result.data=r,result.isResolvedFromCache=!1,self.fire("request.completed",{time:callStatistics,command:command,response:responseValue,request:urlConfig.parameters}),self._deferredResolved(config,result)}).fail(function(r){if(!self._requests.hasOwnProperty(id))return;delete self._requests[id];try{r.responseText=$.parseJSON(r.responseText)}catch(e){}result.data=r,self._deferredRejected(config,result)}),config.$deferred},isUndefinedAxis:function(axisName){return this.getTypes(this.config.definition[axisName]).length===0},x:function(config){return this.axis("x",config)},y:function(config){return this.axis("y",config)},axis:function(axisName,config){if(this.isUndefinedAxis(axisName)){var cfg=this.createDeferredCall(axisName,config);return this._deferredResolved(cfg,{data:{items:[]}}),cfg.$deferred}return this.resolveDeferred(axisName+"axis",config)},size:function(){if(this.isUndefinedAxis("x")&&this.isUndefinedAxis("y")){var cfg=this.createDeferredCall("size",{});return this._deferredResolved(cfg,{data:{}}),cfg.$deferred}return this.resolveDeferred("size",{})},dataItemTemplate:function(config){return this.resolveDeferred("dataItemTemplate",config)},dataTemplate:function(config){return this.resolveDeferred("dataTemplate",config)},viewDataTemplate:function(config){return this.resolveDeferred("viewDataTemplate",config)},axisDataTemplate:function(config){return this.resolveDeferred("axisDataTemplate",config)},listDataTemplate:function(config){return this.resolveDeferred("listDataTemplate",config)},notifyBoardAccess:function(config){return this.resolveDeferred("notifyBoardAccess",config)},addData:function(config){return this.resolveDeferred("addData",config)},axisAddData:function(config){var commandOptions={sign:!0};return this.resolveDeferred("addAxisData",config,commandOptions)},listAddData:function(config){return this.resolveDeferred("listAddData",config)},viewAddData:function(config){return this.resolveDeferred("viewAddData",config)},cellActions:function(config){return this.resolveDeferred("cellActions",config)},cellActionsV2:function(config){return this.resolveDeferred("cellActionsV2",config)},axesActions:function(config){return this.resolveDeferred("axesActions",config)},viewActions:function(config){return this.resolveDeferred("viewActions",config)},move:function(config){return this.resolveDeferred("move",config)},listModeActionsV2:function(config){return this.resolveDeferred("listModeActionsV2",config)},cardDetails:function(config){var cells=this.config.definition.cells,types=this.getTypes(cells),items=_(types).filter(function(t){return t.data&&t.data!=="{}"});if(items.length===0||config.$set.CardsIds.length===0){var cfg=this.createDeferredCall("cardsDetails",config);return this._deferredResolved(cfg,{data:{items:[]}}),cfg.$deferred}cells.types=items;var commandOptions={disableWhereScope:!0};return this.resolveDeferred("cardsDetails",config,commandOptions)},moveAndPrioritizeBatch:function(config){var commandOptions={disableWhereScope:!0};return config.$set.items.length>this.config.options.DnDTurnOffCometWhenItemsCountExceed&&(commandOptions.sign=!0),this.resolveDeferred("moveAndPrioritizeBatch",config,commandOptions)},moveBatch:function(config){var commandOptions={disableWhereScope:!0};return config.$set.items.length>this.config.options.DnDTurnOffCometWhenItemsCountExceed&&(commandOptions.sign=!0),this.resolveDeferred("moveBatch",config,commandOptions)},prioritizeBatch:function(config){var commandOptions={};return config.$set.items.length>this.config.options.DnDTurnOffCometWhenItemsCountExceed&&(commandOptions.sign=!0),this.resolveDeferred("prioritizeBatch",config,commandOptions)},prioritize:function(config){return this.resolveDeferred("prioritize",config)},axes:function(){var axes=this.createDeferredCall("axes"),result={command:axes.command};return $.when(this.x(),this.y()).done(function(x,y){result.data={x:x.data.items,y:y.data.items},axes.$deferred.resolve(result)}).fail(function(r){result.data=r,axes.$deferred.reject(result)}),axes.$deferred},space:function(){return this.resolveDeferred("space",{})},getTypes:function(node){return node?_.isArray(node)?node:_.isString(node)?[node]:node.types?_.isArray(node.types)?node.types:_.isString(node.types)?[node.types]:[]:[]:[]},cell:function(config){if(this.getTypes(this.config.definition.cells).length===0){var cfg=this.createDeferredCall("cells",config);return this._deferredResolved(cfg,{data:{items:[]}}),cfg.$deferred}return this.resolveDeferred("cells",config)},cellCounts:function(config){return this.resolveDeferred("cellCounts",config)},axesCounts:function(config){return this.resolveDeferred("axesCounts",config)},list:function(config){if(this.getTypes(this.config.definition.cells).length===0){var cfg=this.createDeferredCall("list",config);return this._deferredResolved(cfg,{data:{items:[]}}),cfg.$deferred}return this.resolveDeferred("list",config)},createDeferredCall:function(method,config){var $deferred=$.Deferred(),cmd={config:config,method:method};return{$deferred:$deferred,command:cmd}},resolveDeferred:function(method,config,commandOptions){var self=this;return self.fire("before."+method,config),this.resolve(this.createDeferredCall(method,config),commandOptions).fail(function(err){if(err.data.status===0)return;var message="",error;err.data.readyState?(error=err.data.responseText,message=error.Message):error={message:message},self.fire("error",error),self.fire("slice.detailed.error",{message:message||"unknown issue",method:method,definition:self.config.definition})})}});return Event.implementOn(API.prototype),API});
define('tau/slice/slice.space.cached',["Underscore","tau/slice/api","./url.resolver"],function(_,Slice,resolver){var _spaceCache={};return Slice.extend({space:function(){var cmd={method:"space"},options=this.getCallOptions({}),urlConfig=resolver.resolve(this.config.definition,cmd,options),url=urlConfig.url;return _spaceCache.hasOwnProperty(url)||(_spaceCache[url]=this.resolveDeferred("space",{})),_spaceCache[url]}})});
define('tau/slice/slice.factory',["Underscore","tau/core/class","tau/slice/slice.space.cached"],function(_,Class,Slice){return Class.extend({init:function(config){this.defaults=config||{}},create:function(config){return _.defaults(config,this.defaults),new Slice(config)}})});
define('tau/utils/utils.titleManager',["Underscore","tau/core/class"],function(_,Class){var Manager=Class.extend({init:function(config){this.config=_.defaults(config||{},{window:window,delimiter:" ",source:""}),this.config.source=this.config.source||_.asString(this.config.window.document.title)},set:function(value){this.config.window.document.title=_.asString(value)},setTitle:function(title){this.set(_.asString(title)+this.config.delimiter+this.config.source)},restoreDefault:function(){this.set(this.config.source)}});return Manager});
define('tau/utils/utils.base64hashEncoder',["libs/base64/base64"],function(base64){return{encode:function(value){var v=value;return _.isObject(value)&&(v=base64.encode(JSON.stringify(value))),v},decode:function(str){var v=base64.decode(str);return v.charAt(0)==="{"&&v.charAt(v.length-1)==="}"?v=JSON.parse(v):v=str,v}}});
define('tau/services/service.componentBuilder',["Underscore","tau/core/class"],function(_,Class){var Creator=Class.extend({init:function(configurator){this.requireLoader=configurator.getRequireLoader()},create:function(schema,config){_.isString(schema)&&(schema={name:schema,path:schema});var path;if(schema.path)path=schema.path;else{if(!schema.type)throw"Configuration error: type or path is missing";path="tau/components/component."+schema.type}var def=$.Deferred();return this.requireLoader([path],function(Component){def.resolve(Component.create(_.defaults(schema,config||{})))},function(err){def.reject(err)}),def}});return Creator});
define('tau/libs/clipboard/clipboard.manager',["Underscore","tau/core/class"],function(_,Class){var ClipboardManager=Class.extend({init:function(restStorage,options){var self=this;self.restStorage=restStorage,self.options=_.defaults(options||{},{}),self._cache={}},set:function(data,cb){this._cache={},this.add(data,cb)},add:function(data,cb){var self=this,sanitized=this._sanitize(data),len=_.values(self._cache).length;_.forEach(sanitized,function(item){var key=self._createKey(item);self._cache[key]=item}),_.values(self._cache).length!=len&&this._save(self._cache,cb)},remove:function(data,cb){var self=this,len=_.values(self._cache).length,sanitized=this._sanitize(data);_.forEach(sanitized,function(item){var key=self._createKey(item);delete self._cache[key]}),_.values(self._cache).length!=len&&this._save(self._cache,cb)},removeAll:function(cb){self._cache={},this._save([],cb)},getAll:function(cb){var self=this;this._get(function(err,cards){_.forEach(cards,function(card){self._cache[self._createKey(card)]=card}),cb(err,cards)})},unbind:function(ctx){this.restStorage.unbind({listener:ctx})},bind:function(ctx,cb){this.restStorage.bind({listener:ctx,fields:["items"],callback:function(res){cb&&cb(null,res.items||[])}})},_save:function(set,cb){this.restStorage.set({set:{items:_.values(set)},callback:function(res){cb&&cb(null,res.items)}})},_get:function(cb){this.restStorage.get({fields:["items"],callback:function(res){cb&&cb(null,res.items||[])}})},_sanitize:function(item){var self=this,s=function(item){return item=_.deepClone(item||{}),item=_.pick(item,"id","data"),item._id=self._createKey(item),item.data=_.defaults(item.data||{},{id:"",type:""}),item.data.type=item.data.type.toLowerCase(),item};return _.map(_.isArray(item)?item:[item],s)},_createKey:function(item){return"_"+item.data.type+"_"+item.id+"_"}});return ClipboardManager});
define('tau/core/templates-factory',["Underscore","jQuery","tau/nls/translator"],function(_,$,T){var jqote2customFunctions={sub:function(subTemplateName,subTemplateData){var arr=_.isArray(subTemplateData)?subTemplateData:[subTemplateData],out=[];for(var i=0,len=arr.length;i<len;i++)out.push(templatesFactory.get(subTemplateName).render(null,arr[i]));return out.join("")},translate:T,T:T},templatesFactory={templates:{},initialized:{},get:function(name){var tmplConfig=this.templates[name];if(!tmplConfig)throw["Template '",name,"' was not registered."].join("");return this[tmplConfig.engine+".get"](name)},"jquery.get":function(name){var self=this;if(!$.template.hasOwnProperty(name))throw["jQuery template '",name,"' was not found."].join("");return{bind:function(cfg,bindData){var extRef={},templateConfig=self.templates[name],customTags=templateConfig.tags||[];for(var i=0;i<customTags.length;i++){var tag=customTags[i];tag.register(cfg,extRef)}var tmpl=$.template[name];return $.tmpl(tmpl,bindData,extRef)}}},"jqote2.get":function(name){var self=this,templateConfig=self.templates[name];if(!templateConfig.jqotecmpl)throw["Template '",name,"' was not compiled."].join("");return{render:function(cfg,bindData){var customFunctions=templateConfig.customFunctions||{};_(customFunctions).extend(jqote2customFunctions),_.isFunction(templateConfig.pre)&&(bindData=templateConfig.pre(bindData));var dom=templateConfig.jqotecmpl.call(bindData,0,0,[bindData],customFunctions);return _.isFunction(templateConfig.post)&&(dom=templateConfig.post(dom,bindData)),dom},bind:function(cfg,bindData){var tmpl=this.render(cfg,bindData);return $(tmpl)},bindPure:function(cfg,bindData){return this.render(cfg,bindData)}}},registerRecursively:function(name,_customTagsRef){var self=this;_customTagsRef=_customTagsRef||{tags:[]};var templateConfig=null;if(!$.template.hasOwnProperty(name)){templateConfig=this.templates[name];if(!templateConfig)throw["Template '",name,"' was not found."].join("");templateConfig.tags&&(_customTagsRef.tags=_customTagsRef.tags.concat(templateConfig.tags)),$.each(templateConfig.dependencies,function(i,templateName){self.registerRecursively(templateName,_customTagsRef)}),templateConfig.tags=_customTagsRef.tags;var markup=templateConfig.markup;$.template(name,markup)}else templateConfig=templateConfig||this.templates[name],templateConfig.tags&&(_customTagsRef.tags=_customTagsRef.tags.concat(templateConfig.tags))},"jquery.register":function(config){this.registerRecursively(config.name)},"jqote2.register":function(config){config.jqotecmpl=$.jqotec(config.markup)},register:function(config){var self=this;return config.dependencies=config.dependencies||[],config.markup=_.isArray(config.markup)?config.markup.join(""):config.markup,config.engine=config.engine||"jquery",self.templates[config.name]=config,self[config.engine+".register"](config),{name:config.name,options:config.options||{},get:function(){return self.get(config.name)}}}};return templatesFactory});
define('tau/ui/templateRenderer',["Underscore","jQuery"],function(_,$){return $.extend($.tmpl.tag,{"@":{_default:{$1:"'type'",$2:"null"},open:["var $__t = $item;","while(!$__t.$tau && $__t.parent){","$__t = $__t.parent","}","_=_.concat($__t.$tau.terms($2)[$1]);"].join("")},tauKey:{_default:{$1:"id",$2:"null"},open:['_=_.concat(new String(window._.complexKey($2["data"], $1) || "").toString());'].join("")}}),$});
define('tau/core/termProcessor',["Underscore","tau/core/class","tau/store/types.targetprocess"],function(_,Class,types){var termProcessor=Class.extend({init:function(terms){terms=terms||[],this.mapping={};for(var i=0,len=terms.length;i<len;i++){var item=terms[i];this.mapping[item.name]=this.mapping[item.name.toLowerCase()]=item.value}},resolve:function(termName,defaultValue){var result=defaultValue||termName;return termName&&this.mapping.hasOwnProperty(termName)&&(result=this.mapping[termName]),result},getTerms:function(entityType){var self=this,type=types.findByKeyword(entityType),terms=type.terms,keys=_(terms).keys(),termsKeyVal={};return _(keys).each(function(key){termsKeyVal[key]=self.resolve(terms[key].key,terms[key].val)}),termsKeyVal}});return termProcessor});
define('tau/ui/templateRenderer.extensions',["Underscore","tau/core/class","tau/core/termProcessor"],function(_,Class,TermProcessor){var TauExtension=Class.extend({init:function(config){this.termProc=new TermProcessor(config.terms)},terms:function(entityType){return this.termProc.getTerms(entityType)},text_implode:function(text){var processed=new String(text);if(_.isString(text))processed=text;else if(_.isArray(text)){var tmp=_.clone(text),last=tmp.pop();processed=_.filter([tmp.join(", "),last],function(s){return s!=0}).join(" &amp; ")}return processed},key:function(data,key){}});return TauExtension});
define('tau/ui/ui.templateFactory',["tau/core/templates-factory","tau/ui/templateRenderer","tau/ui/templateRenderer.extensions"],function(templatesFactory){return templatesFactory});
define('tau/routers/routers.base',["tau/core/class","tau/core/event"],function(Class,Event){var Router=Class.extend({navigate:function(url){this.fire("urlToNavigate.ready",url)},destroy:function(){this.removeAllListeners()}});return Event.implementOn(Router.prototype),Router});
define('tau/utils/utils.redirect',["Underscore","jQuery","tau/core/class"],function(_,$,Class){return Class.extend({init:function(_window,appPath){this.window=_window,this.appPath=appPath},_process:function(url,context){var resultUrl=null;if(url.match(/^http(s)?:\/\//i))resultUrl=url;else if(url[0]=="#")resultUrl=url;else{var root=this.appPath;url[0]!=="/"&&(url="/"+url),resultUrl=root+url}return context&&(resultUrl=$.tmpl(resultUrl,context).text()),resultUrl},_redirect:function(url,targetWindow){targetWindow.location.href=url},redirect:function(url,target,context){var targetWindow=this.window;if(target){var $doc=$(document),config={scrollbars:1,width:$doc.width()*.8,height:$doc.height()*.8,top:50},arr=[],prop=null;for(prop in config)arr.push(prop+"="+config[prop]);var str=arr.join(",");targetWindow=this.window.open(this._process(url,context),target,str);return}this._redirect(this._process(url,context),targetWindow)},back:function(){this.window.history&&this.window.history.back&&this.window.history.back()},reload:function(){if(this.window.location&&this.window.location.reload){var reload=_.bind(function(){this.window.location.reload()},this);setTimeout(reload,1)}}})});
define('libs/date.js/build/xdate',[],function(){var XDate=function(Date,Math,Array,undefined){function XDate(){return init(this instanceof XDate?this:new XDate,arguments)}function init(xdate,args){var len=args.length,utcMode;isBoolean(args[len-1])&&(utcMode=args[--len],args=slice(args,0,len));if(!len)xdate[0]=new Date;else if(len==1){var arg=args[0];arg instanceof Date||isNumber(arg)?xdate[0]=new Date(+arg):arg instanceof XDate?xdate[0]=_clone(arg):isString(arg)&&(xdate[0]=new Date(0),xdate=parse(arg,utcMode||!1,xdate))}else xdate[0]=new Date(UTC.apply(Date,args)),utcMode||(xdate[0]=coerceToLocal(xdate[0]));return isBoolean(utcMode)&&setUTCMode(xdate,utcMode),xdate}function getUTCMode(xdate){return xdate[0].toString===toUTCString}function setUTCMode(xdate,utcMode,doCoercion){return utcMode?getUTCMode(xdate)||(doCoercion&&(xdate[0]=coerceToUTC(xdate[0])),xdate[0].toString=toUTCString):getUTCMode(xdate)&&(doCoercion?xdate[0]=coerceToLocal(xdate[0]):xdate[0]=new Date(+xdate[0])),xdate}function _set(xdate,fieldIndex,value,args,useUTC){var getField=curry(_getField,xdate[0],useUTC),setField=curry(_setField,xdate[0],useUTC),month=fieldIndex==MONTH?value%12:getField(MONTH),preventOverflow=!1;args.length==2&&isBoolean(args[1])&&(preventOverflow=args[1],args=[value]),setField(fieldIndex,args),preventOverflow&&getField(MONTH)!=month&&(setField(MONTH,[getField(MONTH)-1]),setField(DATE,[getDaysInMonth(getField(FULLYEAR),getField(MONTH))]))}function _add(xdate,fieldIndex,delta,preventOverflow){delta=Number(delta);var intDelta=Math.floor(delta);xdate["set"+methodSubjects[fieldIndex]](xdate["get"+methodSubjects[fieldIndex]]()+intDelta,preventOverflow||!1),intDelta!=delta&&fieldIndex<MILLISECONDS&&_add(xdate,fieldIndex+1,(delta-intDelta)*unitsWithin[fieldIndex],preventOverflow)}function _diff(xdate1,xdate2,fieldIndex){xdate1=xdate1.clone().setUTCMode(!0,!0),xdate2=XDate(xdate2).setUTCMode(!0,!0);var v=0;if(fieldIndex==FULLYEAR||fieldIndex==MONTH){for(var i=MILLISECONDS,methodName;i>=fieldIndex;i--)v/=unitsWithin[i],v+=_getField(xdate2,!1,i)-_getField(xdate1,!1,i);fieldIndex==MONTH&&(v+=(xdate2.getFullYear()-xdate1.getFullYear())*12)}else if(fieldIndex==DATE){var clear1=xdate1.toDate().setUTCHours(0,0,0,0),clear2=xdate2.toDate().setUTCHours(0,0,0,0);v=Math.round((clear2-clear1)/DAY_MS)+(xdate2-clear2-(xdate1-clear1))/DAY_MS}else v=(xdate2-xdate1)/[36e5,6e4,1e3,1][fieldIndex-3];return v}function _getWeek(getField){return getWeek(getField(FULLYEAR),getField(MONTH),getField(DATE))}function getWeek(year,month,date){var d=new Date(UTC(year,month,date)),currentWeek1=getWeek1(year),week1=currentWeek1;if(d<currentWeek1)week1=getWeek1(year-1);else{var nextWeek1=getWeek1(year+1);d>=nextWeek1&&(week1=nextWeek1)}return Math.floor(Math.round((d-week1)/DAY_MS)/7)+1}function getWeek1(year){var d=new Date(UTC(year,0,4));return d.setUTCDate(d.getUTCDate()-(d.getUTCDay()+6)%7),d}function _setWeek(xdate,n,year,useUTC){var getField=curry(_getField,xdate,useUTC),setField=curry(_setField,xdate,useUTC),d=getWeek1(year===undefined?getField(FULLYEAR):year);useUTC||(d=coerceToLocal(d)),xdate.setTime(+d),setField(DATE,[getField(DATE)+(n-1)*7])}function parse(str,utcMode,xdate){var parsers=XDate.parsers,i=0,res;for(;i<parsers.length;i++){res=parsers[i](str,utcMode,xdate);if(res)return res}return xdate[0]=new Date(str),xdate}function parseISO(str,utcMode,xdate){var m=str.match(/^(\d{4})(-(\d{2})(-(\d{2})([T ](\d{2}):(\d{2})(:(\d{2})(\.(\d+))?)?(Z|(([-+])(\d{2})(:?(\d{2}))?))?)?)?)?$/);if(m){var d=new Date(UTC(m[1],m[3]?m[3]-1:0,m[5]||1,m[7]||0,m[8]||0,m[10]||0,m[12]?Number("0."+m[12])*1e3:0));return m[13]?m[14]&&d.setUTCMinutes(d.getUTCMinutes()+(m[15]=="-"?1:-1)*(Number(m[16])*60+(m[18]?Number(m[18]):0))):utcMode||(d=coerceToLocal(d)),xdate.setTime(+d)}}function format(xdate,formatString,settings,uniqueness,useUTC){function getSetting(name){return settings[name]||defaultLocaleSettings[name]}function getFieldAndTrace(fieldIndex){if(uniqueness){var i=(fieldIndex==DAY?DATE:fieldIndex)-1;for(;i>=0;i--)uniqueness.push(getField(i))}return getField(fieldIndex)}var locales=XDate.locales,defaultLocaleSettings=locales[XDate.defaultLocale]||{},getField=curry(_getField,xdate,useUTC);return settings=(isString(settings)?locales[settings]:settings)||{},_format(xdate,formatString,getFieldAndTrace,getSetting,useUTC)}function _format(xdate,formatString,getField,getSetting,useUTC){var m,subout,out="";while(m=formatString.match(formatStringRE))out+=formatString.substr(0,m.index),m[1]?out+=processTokenString(xdate,m[1],getField,getSetting,useUTC):m[3]?(subout=_format(xdate,m[4],getField,getSetting,useUTC),parseInt(subout.replace(/\D/g,""),10)&&(out+=subout)):out+=m[7]||"'",formatString=formatString.substr(m.index+m[0].length);return out+formatString}function processTokenString(xdate,tokenString,getField,getSetting,useUTC){var end=tokenString.length,replacement,out="";while(end>0)replacement=getTokenReplacement(xdate,tokenString.substr(0,end),getField,getSetting,useUTC),replacement!==undefined?(out+=replacement,tokenString=tokenString.substr(end),end=tokenString.length):end--;return out+tokenString}function getTokenReplacement(xdate,token,getField,getSetting,useUTC){var formatter=XDate.formatters[token];if(isString(formatter))return _format(xdate,formatter,getField,getSetting,useUTC);if(isFunction(formatter))return formatter(xdate,useUTC||!1,getSetting);switch(token){case"fff":return zeroPad(getField(MILLISECONDS),3);case"s":return getField(SECONDS);case"ss":return zeroPad(getField(SECONDS));case"m":return getField(MINUTES);case"mm":return zeroPad(getField(MINUTES));case"h":return getField(HOURS)%12||12;case"hh":return zeroPad(getField(HOURS)%12||12);case"H":return getField(HOURS);case"HH":return zeroPad(getField(HOURS));case"d":return getField(DATE);case"dd":return zeroPad(getField(DATE));case"ddd":return getSetting("dayNamesShort")[getField(DAY)]||"";case"dddd":return getSetting("dayNames")[getField(DAY)]||"";case"M":return getField(MONTH)+1;case"MM":return zeroPad(getField(MONTH)+1);case"MMM":return getSetting("monthNamesShort")[getField(MONTH)]||"";case"MMMM":return getSetting("monthNames")[getField(MONTH)]||"";case"yy":return(getField(FULLYEAR)+"").substring(2);case"yyyy":return getField(FULLYEAR);case"t":return _getDesignator(getField,getSetting).substr(0,1).toLowerCase();case"tt":return _getDesignator(getField,getSetting).toLowerCase();case"T":return _getDesignator(getField,getSetting).substr(0,1);case"TT":return _getDesignator(getField,getSetting);case"z":case"zz":case"zzz":return useUTC?"Z":_getTZString(xdate,token);case"w":return _getWeek(getField);case"ww":return zeroPad(_getWeek(getField));case"S":var d=getField(DATE);if(d>10&&d<20)return"th";return["st","nd","rd"][d%10-1]||"th"}}function _getTZString(xdate,token){var tzo=xdate.getTimezoneOffset(),sign=tzo<0?"+":"-",hours=Math.floor(Math.abs(tzo)/60),minutes=Math.abs(tzo)%60,out=hours;return token=="zz"?out=zeroPad(hours):token=="zzz"&&(out=zeroPad(hours)+":"+zeroPad(minutes)),sign+out}function _getDesignator(getField,getSetting){return getField(HOURS)<12?getSetting("amDesignator"):getSetting("pmDesignator")}function valid(xdate){return!isNaN(+xdate[0])}function _clone(xdate){var d=new Date(+xdate[0]);return getUTCMode(xdate)&&(d.toString=toUTCString),d}function _getField(d,useUTC,fieldIndex){return d["get"+(useUTC?"UTC":"")+methodSubjects[fieldIndex]]()}function _setField(d,useUTC,fieldIndex,args){d["set"+(useUTC?"UTC":"")+methodSubjects[fieldIndex]].apply(d,args)}function coerceToUTC(date){return new Date(UTC(date.getFullYear(),date.getMonth(),date.getDate(),date.getHours(),date.getMinutes(),date.getSeconds(),date.getMilliseconds()))}function coerceToLocal(date){return new Date(date.getUTCFullYear(),date.getUTCMonth(),date.getUTCDate(),date.getUTCHours(),date.getUTCMinutes(),date.getUTCSeconds(),date.getUTCMilliseconds())}function getDaysInMonth(year,month){return 32-(new Date(UTC(year,month,32))).getUTCDate()}function methodize(f){return function(){return f.apply(undefined,[this].concat(slice(arguments)))}}function curry(f){var firstArgs=slice(arguments,1);return function(){return f.apply(undefined,firstArgs.concat(slice(arguments)))}}function slice(a,start,end){return Array.prototype.slice.call(a,start||0,end===undefined?a.length:end)}function each(a,f){for(var i=0;i<a.length;i++)f(a[i],i)}function isString(arg){return typeof arg=="string"}function isNumber(arg){return typeof arg=="number"}function isBoolean(arg){return typeof arg=="boolean"}function isFunction(arg){return typeof arg=="function"}function zeroPad(n,len){len=len||2,n+="";while(n.length<len)n="0"+n;return n}var FULLYEAR=0,MONTH=1,DATE=2,HOURS=3,MINUTES=4,SECONDS=5,MILLISECONDS=6,DAY=7,YEAR=8,WEEK=9,DAY_MS=864e5,ISO_FORMAT_STRING="yyyy-MM-dd'T'HH:mm:ss(.fff)",ISO_FORMAT_STRING_TZ=ISO_FORMAT_STRING+"zzz",methodSubjects=["FullYear","Month","Date","Hours","Minutes","Seconds","Milliseconds","Day","Year"],subjectPlurals=["Years","Months","Days"],unitsWithin=[12,31,24,60,60,1e3,1],formatStringRE=new RegExp("(([a-zA-Z])\\2*)|(\\((('.*?'|\\(.*?\\)|.)*?)\\))|('(.*?)')"),UTC=Date.UTC,toUTCString=Date.prototype.toUTCString,proto=XDate.prototype;return proto.length=1,proto.splice=Array.prototype.splice,proto.getUTCMode=methodize(getUTCMode),proto.setUTCMode=methodize(setUTCMode),proto.getTimezoneOffset=function(){return getUTCMode(this)?0:this[0].getTimezoneOffset()},each(methodSubjects,function(subject,fieldIndex){proto["get"+subject]=function(){return _getField(this[0],getUTCMode(this),fieldIndex)},fieldIndex!=YEAR&&(proto["getUTC"+subject]=function(){return _getField(this[0],!0,fieldIndex)}),fieldIndex!=DAY&&(proto["set"+subject]=function(value){return _set(this,fieldIndex,value,arguments,getUTCMode(this)),this},fieldIndex!=YEAR&&(proto["setUTC"+subject]=function(value){return _set(this,fieldIndex,value,arguments,!0),this},proto["add"+(subjectPlurals[fieldIndex]||subject)]=function(delta,preventOverflow){return _add(this,fieldIndex,delta,preventOverflow),this},proto["diff"+(subjectPlurals[fieldIndex]||subject)]=function(otherDate){return _diff(this,otherDate,fieldIndex)}))}),proto.getWeek=function(){return _getWeek(curry(_getField,this,!1))},proto.getUTCWeek=function(){return _getWeek(curry(_getField,this,!0))},proto.setWeek=function(n,year){return _setWeek(this,n,year,!1),this},proto.setUTCWeek=function(n,year){return _setWeek(this,n,year,!0),this},proto.addWeeks=function(delta){return this.addDays(Number(delta)*7)},proto.diffWeeks=function(otherDate){return _diff(this,otherDate,DATE)/7},XDate.parsers=[parseISO],XDate.parse=function(str){return+XDate(""+str)},proto.toString=function(formatString,settings,uniqueness){return formatString===undefined||!valid(this)?this[0].toString():format(this,formatString,settings,uniqueness,getUTCMode(this))},proto.toUTCString=proto.toGMTString=function(formatString,settings,uniqueness){return formatString===undefined||!valid(this)?this[0].toUTCString():format(this,formatString,settings,uniqueness,!0)},proto.toISOString=function(){return this.toUTCString(ISO_FORMAT_STRING_TZ)},XDate.defaultLocale="",XDate.locales={"":{monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],amDesignator:"AM",pmDesignator:"PM"}},XDate.formatters={i:ISO_FORMAT_STRING,u:ISO_FORMAT_STRING_TZ},each(["getTime","valueOf","toDateString","toTimeString","toLocaleString","toLocaleDateString","toLocaleTimeString","toJSON"],function(methodName){proto[methodName]=function(){return this[0][methodName]()}}),proto.setTime=function(t){return this[0].setTime(t),this},proto.valid=methodize(valid),proto.clone=function(){return new XDate(this)},proto.clearTime=function(){return this.setHours(0,0,0,0)},proto.toDate=function(){return new Date(+this[0])},XDate.now=function(){return+(new Date)},XDate.today=function(){return(new XDate).clearTime()},XDate.UTC=UTC,XDate.getDaysInMonth=getDaysInMonth,typeof module!="undefined"&&module.exports&&(module.exports=XDate),XDate}(Date,Math,Array);return XDate});
/**
 * @version: 1.0 Alpha-1
 * @author: Coolite Inc. http://www.coolite.com/
 * @date: 2008-05-13
 * @copyright: Copyright (c) 2006-2008, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * @license: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/.
 * @website: http://www.datejs.com/
 */

define('libs/date.js/build/date',["./xdate"],function(Date){var KEY="www.datejs.com";return Date[KEY]?Date:(Date.CultureInfo={name:"en-US",englishName:"English (United States)",nativeName:"English (United States)",dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],abbreviatedDayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],shortestDayNames:["Su","Mo","Tu","We","Th","Fr","Sa"],firstLetterDayNames:["S","M","T","W","T","F","S"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],abbreviatedMonthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],amDesignator:"AM",pmDesignator:"PM",firstDayOfWeek:0,twoDigitYearMax:2029,dateElementOrder:"mdy",formatPatterns:{shortDate:"M/d/yyyy",longDate:"dddd, MMMM dd, yyyy",shortTime:"h:mm tt",longTime:"h:mm:ss tt",fullDateTime:"dddd, MMMM dd, yyyy h:mm:ss tt",sortableDateTime:"yyyy-MM-ddTHH:mm:ss",universalSortableDateTime:"yyyy-MM-dd HH:mm:ssZ",rfc1123:"ddd, dd MMM yyyy HH:mm:ss GMT",monthDay:"MMMM dd",yearMonth:"MMMM, yyyy"},regexPatterns:{jan:/^jan(uary)?/i,feb:/^feb(ruary)?/i,mar:/^mar(ch)?/i,apr:/^apr(il)?/i,may:/^may/i,jun:/^jun(e)?/i,jul:/^jul(y)?/i,aug:/^aug(ust)?/i,sep:/^sep(t(ember)?)?/i,oct:/^oct(ober)?/i,nov:/^nov(ember)?/i,dec:/^dec(ember)?/i,sun:/^su(n(day)?)?/i,mon:/^mo(n(day)?)?/i,tue:/^tu(e(s(day)?)?)?/i,wed:/^we(d(nesday)?)?/i,thu:/^th(u(r(s(day)?)?)?)?/i,fri:/^fr(i(day)?)?/i,sat:/^sa(t(urday)?)?/i,future:/^next/i,past:/^last|past|prev(ious)?/i,add:/^(\+|aft(er)?|from|hence)/i,subtract:/^(\-|bef(ore)?|ago)/i,yesterday:/^yes(terday)?/i,today:/^t(od(ay)?)?/i,tomorrow:/^tom(orrow)?/i,now:/^n(ow)?/i,millisecond:/^ms|milli(second)?s?/i,second:/^sec(ond)?s?/i,minute:/^mn|min(ute)?s?/i,hour:/^h(our)?s?/i,week:/^w(eek)?s?/i,month:/^m(onth)?s?/i,day:/^d(ay)?s?/i,year:/^y(ear)?s?/i,shortMeridian:/^(a|p)/i,longMeridian:/^(a\.?m?\.?|p\.?m?\.?)/i,timezone:/^((e(s|d)t|c(s|d)t|m(s|d)t|p(s|d)t)|((gmt)?\s*(\+|\-)\s*\d\d\d\d?)|gmt|utc)/i,ordinalSuffix:/^\s*(st|nd|rd|th)/i,timeContext:/^\s*(\:|a(?!u|p)|p)/i},timezones:[{name:"UTC",offset:"-000"},{name:"GMT",offset:"-000"},{name:"EST",offset:"-0500"},{name:"EDT",offset:"-0400"},{name:"CST",offset:"-0600"},{name:"CDT",offset:"-0500"},{name:"MST",offset:"-0700"},{name:"MDT",offset:"-0600"},{name:"PST",offset:"-0800"},{name:"PDT",offset:"-0700"}]},function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,p=function(s,l){return l||(l=2),("000"+s).slice(l*-1)};$P.clearTime=function(){return this.setHours(0),this.setMinutes(0),this.setSeconds(0),this.setMilliseconds(0),this},$P.setTimeToNow=function(){var n=new Date;return this.setHours(n.getHours()),this.setMinutes(n.getMinutes()),this.setSeconds(n.getSeconds()),this.setMilliseconds(n.getMilliseconds()),this},$D.today=function(){return(new Date).clearTime()},$D.compare=function(date1,date2){if(isNaN(date1)||isNaN(date2))throw new Error(date1+" - "+date2);if(date1 instanceof Date&&date2 instanceof Date)return date1<date2?-1:date1>date2?1:0;throw new TypeError(date1+" - "+date2)},$D.equals=function(date1,date2){return date1.compareTo(date2)===0},$D.getDayNumberFromName=function(name){var n=$C.dayNames,m=$C.abbreviatedDayNames,o=$C.shortestDayNames,s=name.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==s||m[i].toLowerCase()==s||o[i].toLowerCase()==s)return i;return-1},$D.getMonthNumberFromName=function(name){var n=$C.monthNames,m=$C.abbreviatedMonthNames,s=name.toLowerCase();for(var i=0;i<n.length;i++)if(n[i].toLowerCase()==s||m[i].toLowerCase()==s)return i;return-1},$D.isLeapYear=function(year){return year%4===0&&year%100!==0||year%400===0},$D.getDaysInMonth=function(year,month){return[31,$D.isLeapYear(year)?29:28,31,30,31,30,31,31,30,31,30,31][month]},$D.getTimezoneAbbreviation=function(offset){var z=$C.timezones,p;for(var i=0;i<z.length;i++)if(z[i].offset===offset)return z[i].name;return null},$D.getTimezoneOffset=function(name){var z=$C.timezones,p;for(var i=0;i<z.length;i++)if(z[i].name===name.toUpperCase())return z[i].offset;return null},$P.clone=function(){return new Date(this.getTime())},$P.compareTo=function(date){return Date.compare(this,date)},$P.equals=function(date){return Date.equals(this,date||new Date)},$P.between=function(start,end){return this.getTime()>=start.getTime()&&this.getTime()<=end.getTime()},$P.isAfter=function(date){return this.compareTo(date||new Date)===1},$P.isBefore=function(date){return this.compareTo(date||new Date)===-1},$P.isToday=function(){return this.isSameDay(new Date)},$P.isSameDay=function(date){return this.clone().clearTime().equals(date.clone().clearTime())},$P.addMilliseconds=function(value){return this.setMilliseconds(this.getMilliseconds()+value),this},$P.addSeconds=function(value){return this.addMilliseconds(value*1e3)},$P.addMinutes=function(value){return this.addMilliseconds(value*6e4)},$P.addHours=function(value){return this.addMilliseconds(value*36e5)},$P.addDays=function(value){return this.setDate(this.getDate()+value),this},$P.addWeeks=function(value){return this.addDays(value*7)},$P.addMonths=function(value){var n=this.getDate();return this.setDate(1),this.setMonth(this.getMonth()+value),this.setDate(Math.min(n,$D.getDaysInMonth(this.getFullYear(),this.getMonth()))),this},$P.addYears=function(value){return this.addMonths(value*12)},$P.add=function(config){if(typeof config=="number")return this._orient=config,this;var x=config;return x.milliseconds&&this.addMilliseconds(x.milliseconds),x.seconds&&this.addSeconds(x.seconds),x.minutes&&this.addMinutes(x.minutes),x.hours&&this.addHours(x.hours),x.weeks&&this.addWeeks(x.weeks),x.months&&this.addMonths(x.months),x.years&&this.addYears(x.years),x.days&&this.addDays(x.days),this};var $y,$m,$d;$P.getWeek=function(){var a,b,c,d,e,f,g,n,s,w;return $y=$y?$y:this.getFullYear(),$m=$m?$m:this.getMonth()+1,$d=$d?$d:this.getDate(),$m<=2?(a=$y-1,b=(a/4|0)-(a/100|0)+(a/400|0),c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0),s=b-c,e=0,f=$d-1+31*($m-1)):(a=$y,b=(a/4|0)-(a/100|0)+(a/400|0),c=((a-1)/4|0)-((a-1)/100|0)+((a-1)/400|0),s=b-c,e=s+1,f=$d+(153*($m-3)+2)/5+58+s),g=(a+b)%7,d=(f+g-e)%7,n=f+3-d|0,n<0?w=53-((g-s)/5|0):n>364+s?w=1:w=(n/7|0)+1,$y=$m=$d=null,w},$P.getISOWeek=function(){return $y=this.getUTCFullYear(),$m=this.getUTCMonth()+1,$d=this.getUTCDate(),p(this.getWeek())},$P.setWeek=function(n){return this.moveToDayOfWeek(1).addWeeks(n-this.getWeek())},$D._validate=function(n,min,max,name){if(typeof n=="undefined")return!1;if(typeof n!="number")throw new TypeError(n+" is not a Number.");if(n<min||n>max)throw new RangeError(n+" is not a valid value for "+name+".");return!0},$D.validateMillisecond=function(value){return $D._validate(value,0,999,"millisecond")},$D.validateSecond=function(value){return $D._validate(value,0,59,"second")},$D.validateMinute=function(value){return $D._validate(value,0,59,"minute")},$D.validateHour=function(value){return $D._validate(value,0,23,"hour")},$D.validateDay=function(value,year,month){return $D._validate(value,1,$D.getDaysInMonth(year,month),"day")},$D.validateMonth=function(value){return $D._validate(value,0,11,"month")},$D.validateYear=function(value){return $D._validate(value,0,9999,"year")},$P.set=function(config){return $D.validateMillisecond(config.millisecond)&&this.addMilliseconds(config.millisecond-this.getMilliseconds()),$D.validateSecond(config.second)&&this.addSeconds(config.second-this.getSeconds()),$D.validateMinute(config.minute)&&this.addMinutes(config.minute-this.getMinutes()),$D.validateHour(config.hour)&&this.addHours(config.hour-this.getHours()),$D.validateMonth(config.month)&&this.addMonths(config.month-this.getMonth()),$D.validateYear(config.year)&&this.addYears(config.year-this.getFullYear()),$D.validateDay(config.day,this.getFullYear(),this.getMonth())&&this.addDays(config.day-this.getDate()),config.timezone&&this.setTimezone(config.timezone),config.timezoneOffset&&this.setTimezoneOffset(config.timezoneOffset),config.week&&$D._validate(config.week,0,53,"week")&&this.setWeek(config.week),this},$P.moveToFirstDayOfMonth=function(){return this.set({day:1})},$P.moveToLastDayOfMonth=function(){return this.set({day:$D.getDaysInMonth(this.getFullYear(),this.getMonth())})},$P.moveToNthOccurrence=function(dayOfWeek,occurrence){var shift=0;if(occurrence>0)shift=occurrence-1;else if(occurrence===-1)return this.moveToLastDayOfMonth(),this.getDay()!==dayOfWeek&&this.moveToDayOfWeek(dayOfWeek,-1),this;return this.moveToFirstDayOfMonth().addDays(-1).moveToDayOfWeek(dayOfWeek,1).addWeeks(shift)},$P.moveToDayOfWeek=function(dayOfWeek,orient){var diff=(dayOfWeek-this.getDay()+7*(orient||1))%7;return this.addDays(diff===0?diff+=7*(orient||1):diff)},$P.moveToMonth=function(month,orient){var diff=(month-this.getMonth()+12*(orient||1))%12;return this.addMonths(diff===0?diff+=12*(orient||1):diff)},$P.getOrdinalNumber=function(){return Math.ceil((this.clone().clearTime()-new Date(this.getFullYear(),0,1))/864e5)+1},$P.getTimezone=function(){return $D.getTimezoneAbbreviation(this.getUTCOffset())},$P.setTimezoneOffset=function(offset){var here=this.getTimezoneOffset(),there=Number(offset)*-6/10;return this.addMinutes(there-here)},$P.setTimezone=function(offset){return this.setTimezoneOffset($D.getTimezoneOffset(offset))},$P.hasDaylightSavingTime=function(){return Date.today().set({month:0,day:1}).getTimezoneOffset()!==Date.today().set({month:6,day:1}).getTimezoneOffset()},$P.isDaylightSavingTime=function(){return this.hasDaylightSavingTime()&&(new Date).getTimezoneOffset()===Date.today().set({month:6,day:1}).getTimezoneOffset()},$P.getUTCOffset=function(){var n=this.getTimezoneOffset()*-10/6,r;return n<0?(r=(n-1e4).toString(),r.charAt(0)+r.substr(2)):(r=(n+1e4).toString(),"+"+r.substr(1))},$P.getElapsed=function(date){return(date||new Date)-this},$P.toISOString||($P.toISOString=function(){function f(n){return n<10?"0"+n:n}return'"'+this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+'Z"'});var nativeToString=$P.toString,dateToString=function(format){var x=this;if(format&&format.length==1){var c=$C.formatPatterns;x.t=x.toString;switch(format){case"d":return x.t(c.shortDate);case"D":return x.t(c.longDate);case"F":return x.t(c.fullDateTime);case"m":return x.t(c.monthDay);case"r":return x.t(c.rfc1123);case"s":return x.t(c.sortableDateTime);case"t":return x.t(c.shortTime);case"T":return x.t(c.longTime);case"u":return x.t(c.universalSortableDateTime);case"y":return x.t(c.yearMonth)}}var ord=function(n){switch(n*1){case 1:case 21:case 31:return"st";case 2:case 22:return"nd";case 3:case 23:return"rd";default:return"th"}};return format?format.replace(/(\\)?(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|S)/g,function(m){if(m.charAt(0)==="\\")return m.replace("\\","");x.h=x.getHours;switch(m){case"hh":return p(x.h()<13?x.h()===0?12:x.h():x.h()-12);case"h":return x.h()<13?x.h()===0?12:x.h():x.h()-12;case"HH":return p(x.h());case"H":return x.h();case"mm":return p(x.getMinutes());case"m":return x.getMinutes();case"ss":return p(x.getSeconds());case"s":return x.getSeconds();case"yyyy":return p(x.getFullYear(),4);case"yy":return p(x.getFullYear());case"dddd":return $C.dayNames[x.getDay()];case"ddd":return $C.abbreviatedDayNames[x.getDay()];case"dd":return p(x.getDate());case"d":return x.getDate();case"MMMM":return $C.monthNames[x.getMonth()];case"MMM":return $C.abbreviatedMonthNames[x.getMonth()];case"MM":return p(x.getMonth()+1);case"M":return x.getMonth()+1;case"t":return x.h()<12?$C.amDesignator.substring(0,1):$C.pmDesignator.substring(0,1);case"tt":return x.h()<12?$C.amDesignator:$C.pmDesignator;case"S":return ord(x.getDate());default:return m}}):nativeToString.apply(this,arguments)};$P.toString=dateToString}(),function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,$N=Number.prototype;$P._orient=1,$P._nth=null,$P._is=!1,$P._same=!1,$P._isSecond=!1,$N._dateElement="day",$P.next=function(){return this._orient=1,this},$D.next=function(){return $D.today().next()},$P.last=$P.prev=$P.previous=function(){return this._orient=-1,this},$D.last=$D.prev=$D.previous=function(){return $D.today().last()},$P.is=function(){return this._is=!0,this},$P.same=function(){return this._same=!0,this._isSecond=!1,this},$P.today=function(){return this.same().day()},$P.weekday=function(){return this._is?(this._is=!1,!this.is().sat()&&!this.is().sun()):!1},$P.at=function(time){return typeof time=="string"?$D.parse(this.toString("d")+" "+time):this.set(time)},$N.fromNow=$N.after=function(date){var c={};return c[this._dateElement]=this,(date?date.clone():new Date).add(c)},$N.ago=$N.before=function(date){var c={};return c[this._dateElement]=this*-1,(date?date.clone():new Date).add(c)};var dx="sunday monday tuesday wednesday thursday friday saturday".split(/\s/),mx="january february march april may june july august september october november december".split(/\s/),px="Millisecond Second Minute Hour Day Week Month Year".split(/\s/),pxf="Milliseconds Seconds Minutes Hours Date Week Month FullYear".split(/\s/),nth="final first second third fourth fifth".split(/\s/),de;$P.toObject=function(){var o={};for(var i=0;i<px.length;i++)o[px[i].toLowerCase()]=this["get"+pxf[i]]();return o},$D.fromObject=function(config){return config.week=null,Date.today().set(config)};var df=function(n){return function(){if(this._is)return this._is=!1,this.getDay()==n;if(this._nth!==null){this._isSecond&&this.addSeconds(this._orient*-1),this._isSecond=!1;var ntemp=this._nth;this._nth=null;var temp=this.clone().moveToLastDayOfMonth();this.moveToNthOccurrence(n,ntemp);if(this>temp)throw new RangeError($D.getDayName(n)+" does not occur "+ntemp+" times in the month of "+$D.getMonthName(temp.getMonth())+" "+temp.getFullYear()+".");return this}return this.moveToDayOfWeek(n,this._orient)}},sdf=function(n){return function(){var t=$D.today(),shift=n-t.getDay();return n===0&&$C.firstDayOfWeek===1&&t.getDay()!==0&&(shift+=7),t.addDays(shift)}};for(var i=0;i<dx.length;i++)$D[dx[i].toUpperCase()]=$D[dx[i].toUpperCase().substring(0,3)]=i,$D[dx[i]]=$D[dx[i].substring(0,3)]=sdf(i),$P[dx[i]]=$P[dx[i].substring(0,3)]=df(i);var mf=function(n){return function(){return this._is?(this._is=!1,this.getMonth()===n):this.moveToMonth(n,this._orient)}},smf=function(n){return function(){return $D.today().set({month:n,day:1})}};for(var j=0;j<mx.length;j++)$D[mx[j].toUpperCase()]=$D[mx[j].toUpperCase().substring(0,3)]=j,$D[mx[j]]=$D[mx[j].substring(0,3)]=smf(j),$P[mx[j]]=$P[mx[j].substring(0,3)]=mf(j);var ef=function(j){return function(){if(this._isSecond)return this._isSecond=!1,this;if(this._same){this._same=this._is=!1;var o1=this.toObject(),o2=(arguments[0]||new Date).toObject(),v="",k=j.toLowerCase();for(var m=px.length-1;m>-1;m--){v=px[m].toLowerCase();if(o1[v]!=o2[v])return!1;if(k==v)break}return!0}return j.substring(j.length-1)!="s"&&(j+="s"),this["add"+j](this._orient)}},nf=function(n){return function(){return this._dateElement=n,this}};for(var k=0;k<px.length;k++)de=px[k].toLowerCase(),$P[de]=$P[de+"s"]=ef(px[k]),$N[de]=$N[de+"s"]=nf(de);$P._ss=ef("Second");var nthfn=function(n){return function(dayOfWeek){return this._same?this._ss(arguments[0]):dayOfWeek||dayOfWeek===0?this.moveToNthOccurrence(dayOfWeek,n):(this._nth=n,n!==2||dayOfWeek!==undefined&&dayOfWeek!==null?this:(this._isSecond=!0,this.addSeconds(this._orient)))}};for(var l=0;l<nth.length;l++)$P[nth[l]]=l===0?nthfn(-1):nthfn(l)}(),function(){Date.Parsing={Exception:function(s){this.message="Parse error at '"+s.substring(0,10)+" ...'"}};var $P=Date.Parsing,_=$P.Operators={rtoken:function(r){return function(s){var mx=s.match(r);if(mx)return[mx[0],s.substring(mx[0].length)];throw new $P.Exception(s)}},token:function(s){return function(s){return _.rtoken(new RegExp("^s*"+s+"s*"))(s)}},stoken:function(s){return _.rtoken(new RegExp("^"+s))},until:function(p){return function(s){var qx=[],rx=null;while(s.length){try{rx=p.call(this,s)}catch(e){qx.push(rx[0]),s=rx[1];continue}break}return[qx,s]}},many:function(p){return function(s){var rx=[],r=null;while(s.length){try{r=p.call(this,s)}catch(e){return[rx,s]}rx.push(r[0]),s=r[1]}return[rx,s]}},optional:function(p){return function(s){var r=null;try{r=p.call(this,s)}catch(e){return[null,s]}return[r[0],r[1]]}},not:function(p){return function(s){try{p.call(this,s)}catch(e){return[null,s]}throw new $P.Exception(s)}},ignore:function(p){return p?function(s){var r=null;return r=p.call(this,s),[null,r[1]]}:null},product:function(){var px=arguments[0],qx=Array.prototype.slice.call(arguments,1),rx=[];for(var i=0;i<px.length;i++)rx.push(_.each(px[i],qx));return rx},cache:function(rule){var cache={},r=null;return function(s){try{r=cache[s]=cache[s]||rule.call(this,s)}catch(e){r=cache[s]=e}if(r instanceof $P.Exception)throw r;return r}},any:function(){var px=arguments;return function(s){var r=null;for(var i=0;i<px.length;i++){if(px[i]==null)continue;try{r=px[i].call(this,s)}catch(e){r=null}if(r)return r}throw new $P.Exception(s)}},each:function(){var px=arguments;return function(s){var rx=[],r=null;for(var i=0;i<px.length;i++){if(px[i]==null)continue;try{r=px[i].call(this,s)}catch(e){throw new $P.Exception(s)}rx.push(r[0]),s=r[1]}return[rx,s]}},all:function(){var px=arguments,_=_;return _.each(_.optional(px))},sequence:function(px,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,px.length==1?px[0]:function(s){var r=null,q=null,rx=[];for(var i=0;i<px.length;i++){try{r=px[i].call(this,s)}catch(e){break}rx.push(r[0]);try{q=d.call(this,r[1])}catch(ex){q=null;break}s=q[1]}if(!r)throw new $P.Exception(s);if(q)throw new $P.Exception(q[1]);if(c)try{r=c.call(this,r[1])}catch(ey){throw new $P.Exception(r[1])}return[rx,r?r[1]:s]}},between:function(d1,p,d2){d2=d2||d1;var _fn=_.each(_.ignore(d1),p,_.ignore(d2));return function(s){var rx=_fn.call(this,s);return[[rx[0][0],r[0][2]],rx[1]]}},list:function(p,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,p instanceof Array?_.each(_.product(p.slice(0,-1),_.ignore(d)),p.slice(-1),_.ignore(c)):_.each(_.many(_.each(p,_.ignore(d))),px,_.ignore(c))},set:function(px,d,c){return d=d||_.rtoken(/^\s*/),c=c||null,function(s){var r=null,p=null,q=null,rx=null,best=[[],s],last=!1;for(var i=0;i<px.length;i++){q=null,p=null,r=null,last=px.length==1;try{r=px[i].call(this,s)}catch(e){continue}rx=[[r[0]],r[1]];if(r[1].length>0&&!last)try{q=d.call(this,r[1])}catch(ex){last=!0}else last=!0;!last&&q[1].length===0&&(last=!0);if(!last){var qx=[];for(var j=0;j<px.length;j++)i!=j&&qx.push(px[j]);p=_.set(qx,d).call(this,q[1]),p[0].length>0&&(rx[0]=rx[0].concat(p[0]),rx[1]=p[1])}rx[1].length<best[1].length&&(best=rx);if(best[1].length===0)break}if(best[0].length===0)return best;if(c){try{q=c.call(this,best[1])}catch(ey){throw new $P.Exception(best[1])}best[1]=q[1]}return best}},forward:function(gr,fname){return function(s){return gr[fname].call(this,s)}},replace:function(rule,repl){return function(s){var r=rule.call(this,s);return[repl,r[1]]}},process:function(rule,fn){return function(s){var r=rule.call(this,s);return[fn.call(this,r[0]),r[1]]}},min:function(min,rule){return function(s){var rx=rule.call(this,s);if(rx[0].length<min)throw new $P.Exception(s);return rx}}},_generator=function(op){return function(){var args=null,rx=[];arguments.length>1?args=Array.prototype.slice.call(arguments):arguments[0]instanceof Array&&(args=arguments[0]);if(!args)return op.apply(null,arguments);for(var i=0,px=args.shift();i<px.length;i++)return args.unshift(px[i]),rx.push(op.apply(null,args)),args.shift(),rx}},gx="optional not ignore cache".split(/\s/);for(var i=0;i<gx.length;i++)_[gx[i]]=_generator(_[gx[i]]);var _vector=function(op){return function(){return arguments[0]instanceof Array?op.apply(null,arguments[0]):op.apply(null,arguments)}},vx="each any all".split(/\s/);for(var j=0;j<vx.length;j++)_[vx[j]]=_vector(_[vx[j]])}(),function(){var $D=Date,$P=$D.prototype,$C=$D.CultureInfo,flattenAndCompact=function(ax){var rx=[];for(var i=0;i<ax.length;i++)ax[i]instanceof Array?rx=rx.concat(flattenAndCompact(ax[i])):ax[i]&&rx.push(ax[i]);return rx};$D.Grammar={},$D.Translator={hour:function(s){return function(){this.hour=Number(s)}},minute:function(s){return function(){this.minute=Number(s)}},second:function(s){return function(){this.second=Number(s)}},meridian:function(s){return function(){this.meridian=s.slice(0,1).toLowerCase()}},timezone:function(s){return function(){var n=s.replace(/[^\d\+\-]/g,"");n.length?this.timezoneOffset=Number(n):this.timezone=s.toLowerCase()}},day:function(x){var s=x[0];return function(){this.day=Number(s.match(/\d+/)[0])}},month:function(s){return function(){this.month=s.length==3?"jan feb mar apr may jun jul aug sep oct nov dec".indexOf(s)/4:Number(s)-1}},year:function(s){return function(){var n=Number(s);this.year=s.length>2?n:n+(n+2e3<$C.twoDigitYearMax?2e3:1900)}},rday:function(s){return function(){switch(s){case"yesterday":this.days=-1;break;case"tomorrow":this.days=1;break;case"today":this.days=0;break;case"now":this.days=0,this.now=!0}}},finishExact:function(x){x=x instanceof Array?x:[x];for(var i=0;i<x.length;i++)x[i]&&x[i].call(this);var now=new Date;(this.hour||this.minute)&&!this.month&&!this.year&&!this.day&&(this.day=now.getDate()),this.year||(this.year=now.getFullYear()),!this.month&&this.month!==0&&(this.month=now.getMonth()),this.day||(this.day=1),this.hour||(this.hour=0),this.minute||(this.minute=0),this.second||(this.second=0),this.meridian&&this.hour&&(this.meridian=="p"&&this.hour<12?this.hour=this.hour+12:this.meridian=="a"&&this.hour==12&&(this.hour=0));if(this.day>$D.getDaysInMonth(this.year,this.month))throw new RangeError(this.day+" is not a valid value for days.");var r=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second);return this.timezone?r.set({timezone:this.timezone}):this.timezoneOffset&&r.set({timezoneOffset:this.timezoneOffset}),r},finish:function(x){x=x instanceof Array?flattenAndCompact(x):[x];if(x.length===0)return null;for(var i=0;i<x.length;i++)typeof x[i]=="function"&&x[i].call(this);var today=$D.today();if(this.now&&!this.unit&&!this.operator)return new Date;this.now&&(today=new Date);var expression=!!(this.days&&this.days!==null||this.orient||this.operator),gap,mod,orient;orient=this.orient=="past"||this.operator=="subtract"?-1:1,!this.now&&"hour minute second".indexOf(this.unit)!=-1&&today.setTimeToNow(),(this.month||this.month===0)&&"year day hour minute second".indexOf(this.unit)!=-1&&(this.value=this.month+1,this.month=null,expression=!0);if(!expression&&this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate(),this.month||(this.month=temp.getMonth()),this.year=temp.getFullYear()}expression&&this.weekday&&this.unit!="month"&&(this.unit="day",gap=$D.getDayNumberFromName(this.weekday)-today.getDay(),mod=7,this.days=gap?(gap+orient*mod)%mod:orient*mod),this.month&&this.unit=="day"&&this.operator&&(this.value=this.month+1,this.month=null),this.value!=null&&this.month!=null&&this.year!=null&&(this.day=this.value*1),this.month&&!this.day&&this.value&&(today.set({day:this.value*1}),expression||(this.day=this.value*1)),!this.month&&this.value&&this.unit=="month"&&!this.now&&(this.month=this.value,expression=!0),expression&&(this.month||this.month===0)&&this.unit!="year"&&(this.unit="month",gap=this.month-today.getMonth(),mod=12,this.months=gap?(gap+orient*mod)%mod:orient*mod,this.month=null),this.unit||(this.unit="day");if(!this.value&&this.operator&&this.operator!==null&&this[this.unit+"s"]&&this[this.unit+"s"]!==null)this[this.unit+"s"]=this[this.unit+"s"]+(this.operator=="add"?1:-1)+(this.value||0)*orient;else if(this[this.unit+"s"]==null||this.operator!=null)this.value||(this.value=1),this[this.unit+"s"]=this.value*orient;this.meridian&&this.hour&&(this.meridian=="p"&&this.hour<12?this.hour=this.hour+12:this.meridian=="a"&&this.hour==12&&(this.hour=0));if(this.weekday&&!this.day&&!this.days){var temp=Date[this.weekday]();this.day=temp.getDate(),temp.getMonth()!==today.getMonth()&&(this.month=temp.getMonth())}return(this.month||this.month===0)&&!this.day&&(this.day=1),!this.orient&&!this.operator&&this.unit=="week"&&this.value&&!this.day&&!this.month?Date.today().setWeek(this.value):(expression&&this.timezone&&this.day&&this.days&&(this.day=this.days),expression?today.add(this):today.set(this))}};var _=$D.Parsing.Operators,g=$D.Grammar,t=$D.Translator,_fn;g.datePartDelimiter=_.rtoken(/^([\s\-\.\,\/\x27]+)/),g.timePartDelimiter=_.stoken(":"),g.whiteSpace=_.rtoken(/^\s*/),g.generalDelimiter=_.rtoken(/^(([\s\,]|at|@|on)+)/);var _C={};g.ctoken=function(keys){var fn=_C[keys];if(!fn){var c=$C.regexPatterns,kx=keys.split(/\s+/),px=[];for(var i=0;i<kx.length;i++)px.push(_.replace(_.rtoken(c[kx[i]]),kx[i]));fn=_C[keys]=_.any.apply(null,px)}return fn},g.ctoken2=function(key){return _.rtoken($C.regexPatterns[key])},g.h=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2]|[1-9])/),t.hour)),g.hh=_.cache(_.process(_.rtoken(/^(0[0-9]|1[0-2])/),t.hour)),g.H=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3]|[0-9])/),t.hour)),g.HH=_.cache(_.process(_.rtoken(/^([0-1][0-9]|2[0-3])/),t.hour)),g.m=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.minute)),g.mm=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.minute)),g.s=_.cache(_.process(_.rtoken(/^([0-5][0-9]|[0-9])/),t.second)),g.ss=_.cache(_.process(_.rtoken(/^[0-5][0-9]/),t.second)),g.hms=_.cache(_.sequence([g.H,g.m,g.s],g.timePartDelimiter)),g.t=_.cache(_.process(g.ctoken2("shortMeridian"),t.meridian)),g.tt=_.cache(_.process(g.ctoken2("longMeridian"),t.meridian)),g.z=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone)),g.zz=_.cache(_.process(_.rtoken(/^((\+|\-)\s*\d\d\d\d)|((\+|\-)\d\d\:?\d\d)/),t.timezone)),g.zzz=_.cache(_.process(g.ctoken2("timezone"),t.timezone)),g.timeSuffix=_.each(_.ignore(g.whiteSpace),_.set([g.tt,g.zzz])),g.time=_.each(_.optional(_.ignore(_.stoken("T"))),g.hms,g.timeSuffix),g.d=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1]|\d)/),_.optional(g.ctoken2("ordinalSuffix"))),t.day)),g.dd=_.cache(_.process(_.each(_.rtoken(/^([0-2]\d|3[0-1])/),_.optional(g.ctoken2("ordinalSuffix"))),t.day)),g.ddd=g.dddd=_.cache(_.process(g.ctoken("sun mon tue wed thu fri sat"),function(s){return function(){this.weekday=s}})),g.M=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d|\d)/),t.month)),g.MM=_.cache(_.process(_.rtoken(/^(1[0-2]|0\d)/),t.month)),g.MMM=g.MMMM=_.cache(_.process(g.ctoken("jan feb mar apr may jun jul aug sep oct nov dec"),t.month)),g.y=_.cache(_.process(_.rtoken(/^(\d\d?)/),t.year)),g.yy=_.cache(_.process(_.rtoken(/^(\d\d)/),t.year)),g.yyy=_.cache(_.process(_.rtoken(/^(\d\d?\d?\d?)/),t.year)),g.yyyy=_.cache(_.process(_.rtoken(/^(\d\d\d\d)/),t.year)),_fn=function(){return _.each(_.any.apply(null,arguments),_.not(g.ctoken2("timeContext")))},g.day=_fn(g.d,g.dd),g.month=_fn(g.M,g.MMM),g.year=_fn(g.yyyy,g.yy),g.orientation=_.process(g.ctoken("past future"),function(s){return function(){this.orient=s}}),g.operator=_.process(g.ctoken("add subtract"),function(s){return function(){this.operator=s}}),g.rday=_.process(g.ctoken("yesterday tomorrow today now"),t.rday),g.unit=_.process(g.ctoken("second minute hour day week month year"),function(s){return function(){this.unit=s}}),g.value=_.process(_.rtoken(/^\d\d?(st|nd|rd|th)?/),function(s){return function(){this.value=s.replace(/\D/g,"")}}),g.expression=_.set([g.rday,g.operator,g.value,g.unit,g.orientation,g.ddd,g.MMM]),_fn=function(){return _.set(arguments,g.datePartDelimiter)},g.mdy=_fn(g.ddd,g.month,g.day,g.year),g.ymd=_fn(g.ddd,g.year,g.month,g.day),g.dmy=_fn(g.ddd,g.day,g.month,g.year),g.date=function(s){return(g[$C.dateElementOrder]||g.mdy).call(this,s)},g.format=_.process(_.many(_.any(_.process(_.rtoken(/^(dd?d?d?|MM?M?M?|yy?y?y?|hh?|HH?|mm?|ss?|tt?|zz?z?)/),function(fmt){if(g[fmt])return g[fmt];throw $D.Parsing.Exception(fmt)}),_.process(_.rtoken(/^[^dMyhHmstz]+/),function(s){return _.ignore(_.stoken(s))}))),function(rules){return _.process(_.each.apply(null,rules),t.finishExact)});var _F={},_get=function(f){return _F[f]=_F[f]||g.format(f)[0]};g.formats=function(fx){if(fx instanceof Array){var rx=[];for(var i=0;i<fx.length;i++)rx.push(_get(fx[i]));return _.any.apply(null,rx)}return _get(fx)},g._formats=g.formats(['"yyyy-MM-ddTHH:mm:ssZ"',"yyyy-MM-ddTHH:mm:ssZ","yyyy-MM-ddTHH:mm:ssz","yyyy-MM-ddTHH:mm:ss","yyyy-MM-ddTHH:mmZ","yyyy-MM-ddTHH:mmz","yyyy-MM-ddTHH:mm","ddd, MMM dd, yyyy H:mm:ss tt","ddd MMM d yyyy HH:mm:ss zzz","MMddyyyy","ddMMyyyy","Mddyyyy","ddMyyyy","Mdyyyy","dMyyyy","yyyy","Mdyy","dMyy","d"]),g._start=_.process(_.set([g.date,g.time,g.expression],g.generalDelimiter,g.whiteSpace),t.finish),g.start=function(s){try{var r=g._formats.call({},s);if(r[1].length===0)return r}catch(e){}return g._start.call({},s)},$D._parse=$D.parse,$D.parse=function(s){var r=null;if(!s)return null;if(s instanceof Date)return s;if(s instanceof window.Date)return new Date(s);try{r=$D.Grammar.start.call({},s.replace(/^\s*(\S*(\s+\S+)*)\s*$/,"$1"))}catch(e){return null}var c=r[1].length===0?r[0]:null;return c&&(c=new Date(c)),c},$D.getParseFunction=function(fx){var fn=$D.Grammar.formats(fx);return function(s){var r=null;try{r=fn.call({},s)}catch(e){return null}return r[1].length===0?r[0]:null}},$D.parseExact=function(s,fx){return $D.getParseFunction(fx)(s)}}(),Date[KEY]=!0,Date)});
define('tau/utils/utils.date/utils.date.wrapper',["libs/date.js/build/date"],function(Date){return Date.prototype.getDaysInMonth=function(){return Date.getDaysInMonth(this.getDate(),this.getMonth())},Date});
define('tau/utils/utils.constants',["jQuery"],function(){return function(){var constants={},ownProp=Object.prototype.hasOwnProperty,allowed={string:1,number:1,"boolean":1,regexp:1};return constants.emailRegexp=/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/i,{define:function(name,value){return this.defined(name)?!1:ownProp.call(allowed,$.type(value))?(constants[name]=value,!0):!1},defined:function(name){return ownProp.call(constants,name)},get:function(name){return this.defined(name)?constants[name]:null}}}()});
define('tau/services/service.avatar',["tau/core/class","tau/core/tau"],function(Class,tau){var Service=Class.extend({init:function(appPath){this.appPath=appPath,this.service=$.ajax},getCropRect:function(userId){return this.service({url:this.appPath+"/avatar.ashx?userid="+userId+"&operation=CropRect&"+(new Date).getTime()+tau.getTokenParameterFromQueryString("&")}).pipe(function(data){return JSON.parse(data).CropRect},function(jqXHR){return JSON.parse(jqXHR.responseText)})},crop:function(url){return this.service({url:url}).pipe(function(data){return JSON.parse(data)},function(jqXHR){return JSON.parse(jqXHR.responseText)})},remove:function(url){return this.service({url:url}).pipe(function(data){return JSON.parse(data)},function(jqXHR){return JSON.parse(jqXHR.responseText)})}});return Service});
define('tau/services/service.features',["tau/core/class"],function(Class){var Service=Class.extend({init:function(storage){this.feature={"entity.quickAdd":!0},storage&&_.forEach(storage,_.bind(function(val,name){this.feature[name]=!!val},this))},isEnabled:function(name){return this.feature[name]?!0:!1},setEnabled:function(name){return this.feature[name]=!0,!0},setDisabled:function(name){return this.feature[name]=!1,!1}});return Service});
define('tau/comet/comet.subscriber',["tau/core/Class","jQuery","Underscore"],function(Class,$,_){var ClassSubscriber=Class.extend({init:function(resourceName,NotificationProxy){this.subscriptionIds=[],this.resourceProxy=NotificationProxy.get(resourceName)},subscribe:function(sliceConfigArr,callback){var self=this,ids=self.resourceProxy.subscribe(sliceConfigArr,callback);self.subscriptionIds=_.union(self.subscriptionIds,ids)},unsubscribe:function(callback){this.resourceProxy.unsubscribe(this.subscriptionIds,callback)}});return ClassSubscriber});
define('tau/comet/comet.connection',["jQuery","tau/comet/comet.subscriber"],function($,CometSubscriber){$(document).ready(function(){$(this).keypress(function(e){if(e.keyCode==27)return!1})});var $asyncProxyStarted=$.Deferred(),$asyncCommandStop=$.Deferred(),$asyncCommandStopCompleted=$.Deferred(),lockOpenForInitialization=!0,ConnectionSingleton={startAsync:function(cometProxyCallback){cometProxyCallback=cometProxyCallback||$.noop,$asyncProxyStarted.done(cometProxyCallback),lockOpenForInitialization&&(lockOpenForInitialization=!1,require(["tp/serverNotifications"],function(connection){if(!connection)return;$asyncCommandStop.done(function(){connection.stop(function(){lockOpenForInitialization=!0,$asyncProxyStarted=$.Deferred(),$asyncCommandStopCompleted.resolve(),$asyncCommandStopCompleted=$.Deferred()})}),connection.start(function(){var ProxySubscriptionFactory={createSubscriber:function(resourceName){return new CometSubscriber(resourceName,connection)}};$asyncProxyStarted.resolve(ProxySubscriptionFactory)})}))},stopAsync:function(stoppedProxyCallback){$asyncCommandStopCompleted.done(stoppedProxyCallback||$.noop),$asyncCommandStop.resolve()}};return $(window).unload(function(){ConnectionSingleton.stopAsync()}),ConnectionSingleton});
define('tau/comet/comet.api',["Underscore","jQuery","tau/comet/comet.connection"],function(_,$,CometConnection){return{disposeAsync:function(callback){CometConnection.stopAsync(callback)},listen:function(type,params){_.isArray(params)||(params=[params]);var $cmdStart=$.Deferred(),$cmdStarted=$.Deferred(),$cmdStop=$.Deferred(),$cmdStopped=$.Deferred(),hash={},dispatcherCallback=function(r){var $dAlways=hash["*"];$dAlways&&$dAlways.notify(r)},$cmdNotify=$.Deferred();$cmdNotify.progress(dispatcherCallback),_.each(params,function(pi){pi.callback=$cmdNotify.notify,pi.clientId=pi.parameters.clientId});var r={start:function(callback){return $cmdStarted.done(callback),$cmdStart.resolve(params),this},stop:function(callback){$cmdStopped.done(callback),$cmdStop.resolve()},on:function(args){var e=(args.eventName||"*").toLowerCase(),c=args.callback||$.noop;!hash.hasOwnProperty(e)&&(hash[e]=$.Deferred());var $d=hash[e];return $d.progress(c),this}};return CometConnection.startAsync(function(ProxySubscriptionFactory){var s=ProxySubscriptionFactory.createSubscriber(type);$cmdStop.done(function(){s.unsubscribe($cmdStopped.resolve)}),$cmdStart.done(function(p){s.subscribe(p,$cmdStarted.resolve)})}),r}}});
define('tau/service.container',["tau/core/Class","tau/core/bus.reg","tau/core/global.bus","tau/store/factory","tau/services/keyboard.manager","tau/services/state.manager","tau/services/service.routing","tau/services/service.hash","tau/utils/utils.routing","tau/utils/utils.history","tau/utils/utils.urlBuilder.service","libs/parseUri","tau/nls/translator","tau/store/services/service.globalSettings","tau/services/service.applicationContext","tau/store/services/service.notifications","tau/store/services/service.actions","tau/storage/api","tau/store/acid.store","tau/libs/boardSettings/factory.board.settings","tau/slice/slice.factory","tau/utils/utils.titleManager","tau/utils/utils.base64hashEncoder","tau/services/service.componentBuilder","tau/core/bus.collection","tau/libs/clipboard/clipboard.manager","tau/ui/ui.templateFactory","tau/routers/routers.base","tau/utils/utils.redirect","tau/utils/utils.date/utils.date.wrapper","tau/utils/utils.constants","tau/services/service.avatar","tau/services/service.features","tau/comet/comet.api"],function(Class,busRegistry,globalBus,StoreFactory,KeyboardManger,StateManager,StateAccessService,HashService,Routing,History,UrlBuilder,parseUri,Translator,GlobalSettingsService,ApplicationContextService,NotificationsService,ActionsService,RestStorage,AcidStore,BoardSettingsFactory,SliceFactory,TitleManager,base64hashEncoder,ComponentBuilder,BusCollection,ClipboardManager,templateFactory,Router,Redirect,Date,constObject,AvatarService,FeaturesService,CometApi){var ServiceContainer=Class.extend({_config:{},isBoardEdition:!1,init:function(){this.registeredServices={hashEncoder:base64hashEncoder}},getUrlBuilder:function(){return this.urlBuilder=this.urlBuilder||new UrlBuilder(this),this.urlBuilder},setLoggedUser:function(loggedUser){this.loggedUser=loggedUser},getLoggedUser:function(){return this.loggedUser},setRequireLoader:function(loader){this.require=loader},getRequireLoader:function(){return this.require||window.require},getComponentBuilder:function(){return this.componentBuilder=this.componentBuilder||new ComponentBuilder(this),this.componentBuilder},require:function(dependencies,callback){var r=this.require||require;r(dependencies,callback)},setRestStorage:function(storage){this.restStorage=storage},getRestStorage:function(){return this.restStorage||(this.restStorage=new RestStorage({service:this.getRestStorageService()})),this.restStorage},setRestStorageService:function(service){this.restStorageService=service},getRestStorageService:function(){return this.restStorageService||(this.restStorageService=$.ajax),this.restStorageService},setBoardSettingsOptions:function(options){this.boardSettingsOptions=options},getBoardSettingsOptions:function(){return this.boardSettingsOptions},getBoardSettingsFactory:function(){return this.boardSettingsFactory||(this.boardSettingsFactory=new BoardSettingsFactory(this)),this.boardSettingsFactory},getStoreFactory:function(){return this.storeFactory||(this.storeFactory=new StoreFactory),this.storeFactory},setStoreFactory:function(storeFactory){this.storeFactory=storeFactory},setSliceFactoryOptions:function(options){this.sliceFactoryOptions=options||{}},getSliceFactoryOptions:function(options){return _.defaults(this.sliceFactoryOptions||{},{base64:!0,options:{DnDTurnOffCometWhenItemsCountExceed:50}})},getSliceFactory:function(){if(!this.sliceFactory){var options=this.getSliceFactoryOptions(),sliceCfg=_.extend({service:this.getSliceService()},options);this.sliceFactory=new SliceFactory(sliceCfg)}return this.sliceFactory},setSliceService:function(service){this.sliceService=service},getSliceService:function(){return this.sliceService||(this.sliceService=$.ajax),this.sliceService},getKeyBoardManager:function(){if(!this.keyboardManager){this.keyboardManager=new KeyboardManger;var keyBoardHandler={handleKeyDown:function(event){event.keyCode==$.ui.keyCode.ESCAPE&&(event.preventDefault(),event.stopPropagation())}};this.keyboardManager.pushHandler(keyBoardHandler)}return this.keyboardManager},setGlobalSettingsService:function(instance){this.globalSettingsService=instance},getGlobalSettingsService:function(){if(!this.globalSettingsService){var config={appPath:this.getApplicationPath()};this.globalSettingsService=new GlobalSettingsService(config)}return this.globalSettingsService},setApplicationContextService:function(instance){this.applicationContextService=instance},getApplicationContextService:function(){return this.applicationContextService||(this.applicationContextService=new ApplicationContextService(this),this.applicationContextService.isBoardEdition=this.isBoardEdition),this.applicationContextService},setNotificationService:function(instance){this.notificationService=instance},getNotificationService:function(){if(!this.notificationService){var config={appPath:this.getApplicationPath()};this.notificationService=new NotificationsService(config)}return this.notificationService},setActionsService:function(instance){this.actionsService=instance},getActionsService:function(){if(!this.actionsService){var config={appPath:this.getApplicationPath()};this.actionsService=new ActionsService(config)}return this.actionsService},clearSingles:function(){this.getStoreFactory().clearSingles()},clear:function(){this.clearSingles(),delete this.currentDate,delete this.external,delete this.window,delete this.routing,delete this.stateManager,this.getStoreFactory().clear(),this.getBoardSettingsFactory().clear(),this.getBusRegistry().clear()},getAppStateStore:function(){return this.acidStore=this.acidStore||this.getBoardSettingsFactory().createAcidSettings({id:"appConfig"}),this.acidStore},getCurrentAcid:function(){var acid="",window=this.getWindow();if(window.location&&window.location.href){var string=window.location.href;acid=parseUri(string).queryKey.acid||acid}return acid},setWindow:function(window){this.window=window},getWindow:function(){return this.window||window},getHistory:function(){return this.history||(this.history=new History),this.history},createRouting:function(safeRouteParameter){var parameters={window:this.getWindow()};safeRouteParameter&&(parameters.safe=!0,parameters.v2=!0,parameters.safeParameterName=safeRouteParameter,parameters.configurator=this);var routing=new Routing(parameters);return routing},getRouting:function(safeRouteParameter){return this.routing||(this.routing=this.createRouting(safeRouteParameter)),this.routing},getTitleManager:function(){return this.titleManager||(this.titleManager=new TitleManager({window:this.getWindow()})),this.titleManager},getTranslator:function(){return Translator},setCurrentDate:function(date){this.currentDate=new Date(date)},getCurrentDate:function(){return this.currentDate?this.currentDate:new Date},getGlobalBus:function(){return globalBus.get()},getBusRegistry:function(){return busRegistry},getComponentBusRegistry:function(){return this.componentBusRegistry||(this.componentBusRegistry=new BusCollection),this.componentBusRegistry},setApplicationPath:function(appPath){this.getStoreFactory().setApplicationPath(appPath)},getApplicationPath:function(){return this.getStoreFactory().getApplicationPath()},getCkPath:function(){return this.ckPath||(this.ckPath=this.getApplicationPath()+"/Ckeditor"),this.ckPath},setCkPath:function(path){this.ckPath=path},setInitialData:function(data){this.getStoreFactory().setInitialData(data)},setService:function(service){this.getStoreFactory().setService(service)},getService:function(){return this.getStoreFactory().getService()},getRestPath:function(){return this.getStoreFactory().getRestPath()},setProxy:function(proxy){this.getStoreFactory().setProxy(proxy)},getProxy:function(){return this.getStoreFactory().getProxy()},disableRules:function(){this.getStoreFactory().disableRules()},enableRules:function(){this.getStoreFactory().enableRules()},initRules:function(){this.getStoreFactory().initRules()},getStore:function(config){return config=config||{},_.defaults(config,{services:this}),this.getStoreFactory().getStore(config)},setConfig:function(name,value){this._config[name]=value},getConfig:function(name,defaultValue){var val=defaultValue;return this._config.hasOwnProperty(name)&&(val=this._config[name]),val},setHashEncoder:function(hashEncoder){return this.registerService("hashEncoder",hashEncoder)},getHashEncoder:function(){return this.service("hashEncoder")},getStateManager:function(){var self=this;if(!self.stateManager){var external=self.getExternal(),service=new StateAccessService({external:external});self.stateManager=new StateManager({service:service,state:external.hashParams()});var stateManagerComet=function(ext){var hash=external.hashParams();self.stateManager?self.stateManager.update(hash):external.unbindHashChange(stateManagerComet)};external.onHashChange(stateManagerComet)}return self.stateManager},getSettingsManager:function(){return this.settingsManager=this.settingsManager||this.getBoardSettingsFactory().createComponentSettings({id:"board"}),this.settingsManager},setClipboardManagerOptions:function(options){this.clipboardManagerOptions=options},getClipboardManagerOptions:function(options){return _.defaults(this.clipboardManagerOptions||{},{id:"clipboard"})},getClipboardManager:function(){return this.clipboardManager||(this.clipboardManager=new ClipboardManager(this.getBoardSettingsFactory().createComponentSettings(this.getClipboardManagerOptions()))),this.clipboardManager},setRouter:function(router){this.router=router},getRouter:function(){return this.router||(this.router=new Router),this.router},setRedirect:function(redirect){this.redirect=redirect},getRedirect:function(){return this.redirect||(this.redirect=new Redirect(this.getWindow(),this.getApplicationPath())),this.redirect},getTemplateFactory:function(){return templateFactory},getConstObject:function(){return constObject},getAvatarService:function(){return this.avatarService||(this.avatarService=new AvatarService(this.getApplicationPath())),this.avatarService},setAvatarService:function(avatarService){this.avatarService=avatarService},createChild:function(){var child=new ServiceContainer;return child.getStoreFactory().setStore(this.getStoreFactory().getStore()),child.featuresService=this.getFeaturesService(),child.acidStore=this.getAppStateStore(),child.applicationContextService=this.getApplicationContextService(),child.loggedUser=this.getLoggedUser(),child.getUrlBuilder().currentAcid=child.getUrlBuilder().getCurrentAcid(),child},getFeaturesService:function(storage){return this.featuresService||(this.featuresService=new FeaturesService(storage)),this.featuresService},setFeaturesService:function(storage){return this.featuresService=new FeaturesService(storage)},getComet:function(){return CometApi.logging=this.getFeaturesService().isEnabled("comet.collect-server-statistics"),CometApi},registerService:function(id,service){!this.registeredServices.hasOwnProperty(id),this.registeredServices[id]=service},service:function(id){if(!this.registeredServices.hasOwnProperty(id))throw new Error("Service ["+id+"] is not registered");return this.registeredServices[id]},setHashService:function(service){this.registerService("hash",service)},getHashService:function(){return this.registeredServices.hasOwnProperty("hash")||this.registerService("hash",new HashService(this)),this.service("hash")},createExternal:function(externalWindow){var hashService=this.getHashService();return hashService.setWindow(externalWindow),hashService},setExternal:function(externalWindow){this.setHashService(this.createExternal(externalWindow))},getExternal:function(){return this.getHashService()},setExternalService:function(service){return this.setHashService(service)}});return ServiceContainer});
define('tau/store/factory.instance',["tau/store/factory"],function(Factory){return new Factory});
define('tau/configurator',["Underscore","tau/service.container","tau/store/factory.instance"],function(_,ServiceContainer,factoryInstance){var configurator=new ServiceContainer;return configurator.setStoreFactory(factoryInstance),configurator._id=_.uniqueId("global_"),configurator});
define('tau/core/component-base',["Underscore","tau/core/class","tau/core/bus","tau/configurator"],function(_,Class,Bus,configurator){return Class.extend({init:function(config){return this.config=_.extend({},config),this.config.context=this.config.context||{},_.defaults(this.config.context,{configurator:configurator}),this.bus=new Bus({name:this.config.name,globalBus:this.config.context.configurator.getGlobalBus(),"queue.bus":this.config["queue.bus"]||this.config.queuedBus}),_.defaults(this.config,{bus:this.bus}),this},attach:function(ExtensionClass,attachmentConfig){attachmentConfig=attachmentConfig||{};var excludes=this.config.disabledExtensionCategories;if(excludes){var category=ExtensionClass.prototype.category;if(category&&_.indexOf(excludes,category)>=0)return this}var config=_.clone(this.config);attachmentConfig.hasOwnProperty("onCreate")||(config=_.extend(config,attachmentConfig));var a=new ExtensionClass(config);return attachmentConfig.onCreate&&attachmentConfig.onCreate(a),this}})});
define('tau/core/event.emitter',["tau/core/class","tau/core/event"],function(Class,event){var fnNoop=function(){},EventEmitter=Class.extend({init:function(config){this.bus=config.bus,event.subscribeOn(this)},"bus refresh":function(evt){this.lifeCycleCleanUp()},lifeCycleCleanUp:fnNoop,on:function(){this.bus.on.apply(this.bus,arguments)},fire:function(){return this.bus.fire.apply(this.bus,arguments)},"bus destroy":function(){this.on=fnNoop,this.fire=fnNoop,this.destroy()},resetSubscriptions:function(){event.unSubscribe(this),event.subscribeOn(this)},destroy:function(){var gb=this.bus.getGlobalBus();gb&&gb.removeAllListeners(this),event.unSubscribe(this),delete this.bus,this.bus={fire:fnNoop,on:fnNoop,removeListener:fnNoop}}});return EventEmitter});
define('tracking/extensions/extension.tracking.base',["tau/core/event.emitter","app.path","Underscore"],function(Emitter,path,_){return Emitter.extend({init:function(config){this.global=config.bus.getGlobalBus(),this._super(config)},getPath:function(){return path.get()},getHost:function(){return path.get().toLowerCase().replace("http://","").replace("https://","")},makePlainCleanObject:function(node,value,path,ignoreKeys){node=node||{};var self=this;if(_.isUndefined(value)||_.isNull(value)||_.isEmpty(value))return;var isArray=_.isArray(value);if(!_.isObject(value)&&!isArray){node[path]=value;return}if(isArray)return node[path]=[],_.each(value,function(v){if(!v)return;node[path].push(self.makePlainCleanObject({},v,"",ignoreKeys))}),node;var keys=_.keys(value),prefix=path?path+"_":"";for(var i=0;i<keys.length;i++){var key=keys[i];if(_.indexOf(ignoreKeys,key)>=0)continue;self.makePlainCleanObject(node,value[key],prefix+key,ignoreKeys)}return node},getInfoFromTypes:function(value){if(!value)return"empty";var str=[];return value.types&&(value=value.types),_.isArray(value)&&_.each(value,function(v){_.isString(v)?str.push(v):str.push(v.type)}),str.length===0?"empty":str.join(",")},getFilter:function(node){return node?node.filter?node.filter:"":""},getBoardContext:function(definition){if(!definition)return{};var cellTypes=this.getInfoFromTypes(definition.cells).split(",");cellTypes.length===1&&cellTypes[0]=="empty"&&(cellTypes=[]),cellTypes=_.sortBy(cellTypes);var user=definition.user||{};return{x:{type:this.getInfoFromTypes(definition.x),filter:this.getFilter(definition.x)},y:{type:this.getInfoFromTypes(definition.y),filter:this.getFilter(definition.y)},mode:definition.viewMode||null,zoomLevel:definition.zoomLevel||null,user_cardFilter:user.cardFilter||"",cards:{types:cellTypes,filter:this.getFilter(definition.cells)}}}})});
define('tracking/extensions/extension.tracking.board.statistics',["./extension.tracking.base","Underscore"],function(Extension,_){return Extension.extend({"global application.navigate.entity + application.entity.loaded":function(evtHash,entity){var startEvent=evtHash["application.navigate.entity"],endEvent=evtHash["application.entity.loaded"];if(startEvent.caller.id!=endEvent.caller.id||!entity)return;var loadTime=endEvent.date-startEvent.date,entityType=entity.type||entity.entity,data={statistics_view:{loadTime:loadTime,entity:{id:entity.id,type:(entityType||"unknown").toLowerCase()}}};this.fire("track.node",data)},"global start.lifecycle + overview.board.ready + board.paging.settings + model.cells.content.loaded":function(evtHash){var startEvent=evtHash["start.lifecycle"],endEvent=evtHash["overview.board.ready"],paging=evtHash["board.paging.settings"].data,cells=evtHash["model.cells.content.loaded"].data;if(startEvent.caller.id!=endEvent.caller.id)return;var loadTime=endEvent.date-startEvent.date,cardsCount=0;_.each(cells.data.items,function(item){cardsCount+=item.dynamic.items.length});var ignoreKeys=["viewMode","x","y","cells","global","boardId"],board=this.makePlainCleanObject(this.getBoardContext(paging.definition),paging.definition,null,ignoreKeys),data={loadTime:loadTime,page:{current:_.extend({},paging.page),size:{x:paging.x.onPage,y:paging.y.onPage},total:{x:paging.x.totalPages,y:paging.y.totalPages}},cardsCount:cardsCount,board:board};this.fire("track.statistics",data)}})});
define('tracking/extensions/extension.tracking.context.board',["Underscore","./extension.tracking.base"],function(_,Extension){return Extension.extend({"global board.configurator.initialized > board.definition.ready":function(evtHash,initData,definition){var host=this.getHost(),configurator=initData.configurator,bs=configurator.boardSettingsOptions||{},user=configurator.getLoggedUser()||{id:0,role:"N/A"},context={name:"board",user:{id:host+"/user/"+user.id,tau_ref:"user"},host:{id:host,tau_ref:"host"},_id:host+"/board/"+(bs.id||0)+"/"+user.id+"/"+(new Date).getTime()};_.extend(context,this.getBoardContext(definition)),this.fire("track.context.ready",context)}})});
define('tracking/extensions/extension.tracking.application.context',["Underscore","./extension.tracking.base"],function(_,Extension){return Extension.extend({"global application.context.data":function(evtHash,data){var teams=data.selectedTeamsCount>0?_.compact(_.pluck(data.selectedTeams,"id")):[],projects=data.selectedProjectsCount>0?_.compact(_.pluck(data.selectedProjects,"id")):[],host=this.getHost(),eventData={_id:host+"/"+data.acid,teams:_.filter(teams,function(i){return i>0}),projects:_.filter(projects,function(i){return i>0}),host:{id:host,tau_ref:"host"}};this.fire("track.application.context.ready",eventData)},"global application.context.data.changed":function(evtHash,data){var eventData={action:"change context",name:"change context to "+data.teams.length+" team(s) and "+data.projects.length+" project(s)",teams:data.teams,projects:data.projects,tags:["selected teams/projects"]};this.fire("track.action",eventData)}})});
define('tracking/extensions/extension.tracking.board.actions',["Underscore","./extension.tracking.base","libs/json2"],function(_,Extension){return Extension.extend({bs_id:0,"global boardSettings.ready":function(evtHash,data){var bs=data.boardSettings;if(this.bs_id===bs.__objectId)return;this.bs_id=bs.__objectId,this.fire("reset.tracking.board.settings",bs),this.fire("tracking.current.board.settings",bs)},"global add.board":function(evtHash,data){this.fire("track.action",_.extend({name:"add board"},data))},"global remove.board":function(evtHash,data){this.fire("track.action",_.extend({name:"remove board"},data))},"global application.navigate.entity":function(evt,card){if(!card)return;var entity=card.type||card.entity;this.fire("track.action",{action:"view entity",name:"view "+entity+" #"+card.id,tags:["view entity"],type:entity,id:card.id})},"global quick.add.popup.rendered":function(evt){this.fire("track.action",{name:"show quick add popup",tags:["board","quick add"]})},"global paging.cell.show.more":function(evt){this.fire("track.action",{name:"show more cards",tags:["board","show more"]})},"global board.configurator.initialized > board.configuration.ready > board.definition.ready":function(evtHash,initData,config,definition){var event={contextBoard:config.acid&&config.acid.length>0?!0:!1};_.extend(event,config);var boardContext=this.getBoardContext(definition);_.extend(event,boardContext),event.boardName=event.name||"Unknown board",event.tags=["board","open board"],delete event.cards;var cards=boardContext.cards.types.join(",");cards||(cards="no cards"),event.name='open board "'+event.boardName+'" ['+boardContext.x.type+"/"+boardContext.y.type+" with cards "+cards+"]",event.action="open board",this.fire("track.action",event)},"global model.data.item.did.add":function(evt,data){if(!data.message)return;if(!data.message.dataItem)return;if(!data.message.dataItem.type)return;if(!data.message.dataItem.data)return;var type=data.message.dataItem.type.toLowerCase();this.fire("track.action",{action:"entity added",name:type+" #"+data.message.dataItem.data.id+" added using quick add",type:type,tags:["add "+type,"add card","board"]})},"global model.data.item.did.fail.add":function(evt,data){if(!data.Message)return;this.fire("track.error",{name:"quick add error",message:data.Message}),this.fire("track.action",{name:"quick add error",tags:["error","board","quick add"],message:data.Message})},"global view.card.batch.move.completed":function(evt,data){var cards=[],types={};_.each(data,function($card){if(!$card.data)return;var type=$card.data("entity-type");cards.push({type:type,id:$card.data("entity-id")}),types[type]||(types[type]=0),types[type]++}),this.fire("track.action",{action:"move cards",name:cards.length+" card(s) moved "+JSON.stringify(types),cards:cards,tags:["board","business action","move cards"]})},"global board.template.selected":function(evt,data){data=data||{name:"not defined"},this.fire("track.action",{action:"apply template",name:"apply template ["+data.name+"]",template:data,tags:["board","templates","customize","settings"]})},"bus tracking.current.board.settings > reset.tracking.board.settings":function(evt,settings){settings.unbind({listener:this})},"bus tracking.current.board.settings":function(evt,settings){var self=this;settings.unbind({listener:self}),settings.bind({listener:self,fields:["viewMode","isShared","selectedMarks","focus","user","acid","zoomLevel","page","name","collapse","columnSizes","x","y","edit","cells"],callback:function(r){if(!r)return;var names=[],data={};_.each(_.keys(r),function(key){var name=key;if(name.toLowerCase()==="isdraft")return;var valueOfChange=r[key];key==="user"?name="user filter":key==="edit"?name="switch "+(valueOfChange?"on":"off")+" board edit mode":name=key=="name"?"boardName":key,data[name]=valueOfChange,names.push(name)});if(names.length>0){var eventData={action:"customize board",name:"change board settings ["+names.join(",")+"]",tags:["customize","board"].concat(names),changes:data};self.fire("track.action",eventData)}}})}})});
define('tracking/extensions/extension.tracking.clicks',["./extension.tracking.base","Underscore","jQuery"],function(Extension,_,$){return Extension.extend({track:function(selector,data,event){selector||(selector="body"),event=event||"click",data=data||{},_.defaults(data,{tags:[]});var addTag=function(tag){data.tags.indexOf(tag.toLowerCase())<0&&data.tags.push(tag)};addTag("board"),addTag(event),data.area&&addTag(data.area);var mapped={selector:selector,data:data,event:event};return this.clickMap[selector]=mapped,{name:function(name){return data.name=name,addTag(name),this},nameSelector:function(name){return mapped.nameSelector=name,this},nameTemplate:function(name){return mapped.nameTemplate=name,this},tag:function(){return _.each(arguments,function(tag){addTag(tag)}),this},event:function(event){return mapped.event=event,addTag(event),this},area:function(area){return data.area=area,addTag(area),this}}},trackArea:function(selector,area){var self=this;return function(subSelector){var css=selector+(subSelector?" "+subSelector:"");return self.track(css,{area:area})}},trackMainMenu:function(){var mainMenu=this.trackArea(".tau-app-header","page header");mainMenu().tag("page header item"),this.track(".tau-user-submenu .tau-menu-item").area("page header menu").tag("context menu");var context=this.trackArea(".tau-teams-projects-manager","project/team selection");context("button")},trackGettingStarted:function(){this.track(".tau-getting-started .rhino-btn,.tau-getting-started .rhino-bullet").area("getting started popup").tag("getting started")},trackQuickAdd:function(){var area=this.trackArea(".tau-quick-add-dialog","quick add popup");area("button").tag("quick add popup")},trackBoard:function(){this.track(".tau-board-settings-header.i-role-tabheaders").area("board settings").tag("select setting tab").nameTemplate("select [<%= name%>] tab"),this.track(".tau-cellholder .tau-add").area("board").tag("quick add").name("quick add in cell")},trackSidebar:function(){this.track(".tau-pane-collapser").area("sidebar").name("boards menu collapse (expand)"),this.track(".tau-boardselector__headermenu__item").nameTemplate("customisize board menu -> <%= name%>").area("sidebar").tag("boards menu header")},startTracking:function(){var self=this,formatName=function(value){return value?value:null},getNameFromElement=function($element){var value=formatName($element.text())||formatName($element.attr("title"))||formatName($element.data("title"))||formatName($element.data("label"))||formatName($element.attr("role"))||"";return value.toLowerCase()},grabName=function(mapped,$element){if(mapped.nameSelector){var text=$(mapped.nameSelector,this).text();return text&&mapped.data.name&&(text=mapped.data.name+" "+text),text}return mapped.data.name||getNameFromElement($element)||getNameFromElement($(this))},process=function(evt){try{var $element=$(evt.target),mapped=evt.data,name=grabName.call(this,mapped,$element);if(!name)return;mapped.nameTemplate&&(name=_.template(mapped.nameTemplate)({name:name}));var event=_.defaults({name:name,event:mapped.event},mapped.data);self.fire("track.action",event)}catch(e){}},$body=$("body");_.each(this.clickMap,function(mapped){$body.on(mapped.event,mapped.selector,mapped,process)})},init:function(config){var self=this;self._super(config),config=config||{};if(config.disableClicksTracking===!0)return;_.defaults(config,{clickMap:{}}),self.clickMap=config.clickMap,self.trackSidebar(),self.trackMainMenu(),self.trackGettingStarted(),self.trackBoard(),self.trackQuickAdd(),self.startTracking()}})});
/**
     * session.js 0.4.1
     * (c) 2012 Iain, CodeJoust
     * session.js is freely distributable under the MIT license.
     * Portions of session.js are inspired or borrowed from Underscore.js, and quirksmode.org demo javascript.
     * This version uses google's jsapi library for location services.
     * For details, see: https://github.com/codejoust/session.js
     */

define('tracking/extensions/session',["jQuery"],function($){var deferred=$.Deferred();window.session={options:{use_html5_location:!1,session_timeout:1},start:function(data){deferred.resolve(data)}};var session_fetch=function(win,doc,nav){var API_VERSION=.4,options={use_html5_location:!1,ipinfodb_key:!1,gapi_location:!0,location_cookie:"location",location_cookie_timeout:5,session_timeout:32,session_cookie:"first_session"},SessionRunner=function(){win.session=win.session||{},win.session.contains=function(other_str){if(typeof other_str=="string")return this.indexOf(other_str)!==-1;for(var i=0;i<other_str.length;i++)if(this.indexOf(other_str[i])!==-1)return!0;return!1};if(win.session&&win.session.options)for(option in win.session.options)options[option]=win.session.options[option];var unloaded_modules={api_version:API_VERSION,locale:modules.locale(),current_session:modules.session(),original_session:modules.session(options.session_cookie,options.session_timeout*24*60*60*1e3),browser:modules.browser(),plugins:modules.plugins(),time:modules.time(),device:modules.device()};options.use_html5_location?unloaded_modules.location=modules.html5_location():options.ipinfodb_key?unloaded_modules.location=modules.ipinfodb_location(options.ipinfodb_key):options.gapi_location&&(unloaded_modules.location=modules.gapi_location());if(win.session&&win.session.start)var start=win.session.start;var asynchs=0,module,result,check_asynch=function(deinc){deinc&&asynchs--,asynchs===0&&start&&start(win.session)};win.session={};for(var name in unloaded_modules){module=unloaded_modules[name];if(typeof module=="function")try{module(function(data){win.session[name]=data,check_asynch(!0)}),asynchs++}catch(err){win.console&&typeof console.log=="function"&&(console.log(err),check_asynch(!0))}else win.session[name]=module}check_asynch()},browser={detect:function(){return{browser:this.search(this.data.browser),version:this.search(nav.userAgent)||this.search(nav.appVersion),os:this.search(this.data.os)}},search:function(data){if(typeof data!="object"){var index=data.indexOf(this.version_string);if(index==-1)return;return parseFloat(data.substr(index+this.version_string.length+1))}for(var i=0;i<data.length;i++){var dataString=data[i].string,dataProp=data[i].prop;this.version_string=data[i].versionSearch||data[i].identity;if(dataString){if(dataString.indexOf(data[i].subString)!=-1)return data[i].identity}else if(dataProp)return data[i].identity}},data:{browser:[{string:nav.userAgent,subString:"Chrome",identity:"Chrome"},{string:nav.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:nav.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:win.opera,identity:"Opera",versionSearch:"Version"},{string:nav.vendor,subString:"iCab",identity:"iCab"},{string:nav.vendor,subString:"KDE",identity:"Konqueror"},{string:nav.userAgent,subString:"Firefox",identity:"Firefox"},{string:nav.vendor,subString:"Camino",identity:"Camino"},{string:nav.userAgent,subString:"Netscape",identity:"Netscape"},{string:nav.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:nav.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:nav.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:nav.platform,subString:"Win",identity:"Windows"},{string:nav.platform,subString:"Mac",identity:"Mac"},{string:nav.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:nav.userAgent,subString:"iPad",identity:"iPad"},{string:nav.userAgent,subString:"Android",identity:"Android"},{string:nav.platform,subString:"Linux",identity:"Linux"}]}},modules={browser:function(){return browser.detect()},time:function(){var d1=new Date,d2=new Date;return d1.setMonth(0),d1.setDate(1),d2.setMonth(6),d2.setDate(1),{tz_offset:-(new Date).getTimezoneOffset()/60,observes_dst:d1.getTimezoneOffset()!==d2.getTimezoneOffset()}},locale:function(){var lang=(nav.language||nav.browserLanguage||nav.systemLanguage||nav.userLanguage||"").split("-");return lang.length==2?{country:lang[1].toLowerCase(),lang:lang[0].toLowerCase()}:lang?{lang:lang[0].toLowerCase(),country:null}:{lang:null,country:null}},device:function(){var device={screen:{width:win.screen.width,height:win.screen.height}};return device.viewport={width:win.innerWidth||doc.documentElement.clientWidth||doc.body.clientWidth,height:win.innerHeight||doc.documentElement.clientHeight||doc.body.clientHeight},device.is_tablet=!!nav.userAgent.match(/(iPad|SCH-I800|xoom|kindle)/i),device.is_phone=!device.is_tablet&&!!nav.userAgent.match(/(iPhone|iPod|blackberry|android 0.5|htc|lg|midp|mmp|mobile|nokia|opera mini|palm|pocket|psp|sgh|smartphone|symbian|treo mini|Playstation Portable|SonyEricsson|Samsung|MobileExplorer|PalmSource|Benq|Windows Phone|Windows Mobile|IEMobile|Windows CE|Nintendo Wii)/i),device.is_mobile=device.is_tablet||device.is_phone,device},plugins:function(){var check_plugin=function(name){if(nav.plugins){var plugin,i=0,length=nav.plugins.length;for(;i<length;i++){plugin=nav.plugins[i];if(plugin&&plugin.name&&plugin.name.toLowerCase().indexOf(name)!==-1)return!0}return!1}return!1};return{flash:check_plugin("flash"),silverlight:check_plugin("silverlight"),java:check_plugin("java"),quicktime:check_plugin("quicktime")}},session:function(cookie,expires){var session=util.get_obj(cookie);if(session==null){session={visits:1,start:(new Date).getTime(),last_visit:(new Date).getTime(),url:win.location.href,path:win.location.pathname,referrer:doc.referrer,referrer_info:util.parse_url(doc.referrer),search:{engine:null,query:null}};var search_engines=[{name:"Google",host:"google",query:"q"},{name:"Bing",host:"bing.com",query:"q"},{name:"Yahoo",host:"search.yahoo",query:"p"},{name:"AOL",host:"search.aol",query:"q"},{name:"Ask",host:"ask.com",query:"q"},{name:"Baidu",host:"baidu.com",query:"wd"}],length=search_engines.length,engine,match,i=0,fallbacks="q query term p wd query text".split(" ");for(i=0;i<length;i++){engine=search_engines[i];if(session.referrer_info.host.indexOf(engine.host)!==-1){session.search.engine=engine.name,session.search.query=session.referrer_info.query[engine.query],session.search.terms=session.search.query?session.search.query.split(" "):null;break}}if(session.search.engine===null&&session.referrer_info.search.length>1)for(i=0;i<fallbacks.length;i++){var terms=session.referrer_info.query[fallbacks[i]];if(terms){session.search.engine="Unknown",session.search.query=terms,session.search.terms=terms.split(" ");break}}}else session.prev_visit=session.last_visit,session.last_visit=(new Date).getTime(),session.visits++,session.time_since_last_visit=session.last_visit-session.prev_visit;return util.set_cookie(cookie,util.package_obj(session),expires),session},html5_location:function(){return function(callback){nav.geolocation.getCurrentPosition(function(pos){pos.source="html5",callback(pos)},function(err){options.gapi_location?modules.gapi_location()(callback):callback({error:!0,source:"html5"})})}},gapi_location:function(){return function(callback){var location=util.get_obj(options.location_cookie);!location||location.source!=="google"?(win.gloader_ready=function(){"google"in win&&(win.google.loader.ClientLocation?(win.google.loader.ClientLocation.source="google",callback(win.google.loader.ClientLocation)):callback({error:!0,source:"google"}),util.set_cookie(options.location_cookie,util.package_obj(win.google.loader.ClientLocation),options.location_cookie_timeout*60*60*1e3))},util.embed_script("https://www.google.com/jsapi?callback=gloader_ready")):callback(location)}},ipinfodb_location:function(api_key){return function(callback){var location_cookie=util.get_obj(options.location_cookie);location_cookie&&location_cookie.source==="ipinfodb"&&callback(location_cookie),win.ipinfocb=function(data){if(data.statusCode==="OK")data.source="ipinfodb",util.set_cookie(options.location_cookie,util.package_obj(data),options.location_cookie*60*60*1e3),callback(data);else{if(options.gapi_location)return modules.gapi_location()(callback);callback({error:!0,source:"ipinfodb",message:data.statusMessage})}},util.embed_script("http://api.ipinfodb.com/v3/ip-city/?key="+api_key+"&format=json&callback=ipinfocb")}}},util={parse_url:function(url_str){var a=doc.createElement("a"),query={};a.href=url_str,query_str=a.search.substr(1);if(query_str!=""){var pairs=query_str.split("&"),i=0,length=pairs.length,parts;for(;i<length;i++)parts=pairs[i].split("="),parts.length===2&&(query[parts[0]]=decodeURI(parts[1]))}return{host:a.host,path:a.pathname,protocol:a.protocol,port:a.port===""?80:a.port,search:a.search,query:query}},set_cookie:function(cname,value,expires,options){if(!cname)return null;if(!options)var options={};if(value===null||value===undefined)expires=-1;return expires&&(options.expires=(new Date).getTime()+expires),doc.cookie=[encodeURIComponent(cname),"=",encodeURIComponent(String(value)),options.expires?"; expires="+(new Date(options.expires)).toUTCString():"","; path="+(options.path?options.path:"/"),options.domain?"; domain="+options.domain:"",win.location&&win.location.protocol==="https:"?"; secure":""].join("")},get_cookie:function(cookie_name,result){return(result=(new RegExp("(?:^|; )"+encodeURIComponent(cookie_name)+"=([^;]*)")).exec(doc.cookie))?decodeURIComponent(result[1]):null},embed_script:function(url){var element=doc.createElement("script");element.type="text/javascript",element.src=url,doc.getElementsByTagName("body")[0].appendChild(element)},package_obj:function(obj){if(obj){obj.version=API_VERSION;var ret=JSON.stringify(obj);return delete obj.version,ret}},get_obj:function(cookie_name){var obj;try{obj=JSON.parse(util.get_cookie(cookie_name))}catch(e){}if(obj&&obj.version==API_VERSION)return delete obj.version,obj}},JSON={parse:win.JSON&&win.JSON.parse||function(data){return typeof data!="string"||!data?null:(new Function("return "+data))()},stringify:win.JSON&&win.JSON.stringify||function(object){var type=typeof object;if(type==="object"&&object!==null){var k,v,json=[],isArray=object&&object.constructor===Array;for(k in object)v=object[k],type=typeof v,type==="string"?v='"'+v+'"':type==="object"&&v!==null&&(v=this.stringify(v)),json.push((isArray?"":'"'+k+'":')+v);return(isArray?"[":"{")+json.join(",")+(isArray?"]":"}")}if(type==="string")return'"'+object+'"'}};SessionRunner()};return typeof window.exports=="undefined"?session_fetch(window,document,navigator):window.exports.session=session_fetch,deferred});
define('tracking/extensions/extension.tracking.user.host',["jQuery","app.path","Underscore","./extension.tracking.base","tau/configurator","./session"],function($,path,_,Extension,configurator,session){var trackSingle={};return Extension.extend({"global application.context.data":function(evtHash,initData){var trackDate=new Date,trackKey=trackDate.getDate()+"_"+(trackDate.getMonth()+1)+"_"+trackDate.getFullYear();if(trackSingle[trackKey])return;trackSingle[trackKey]=!0;var self=this,host=self.getHost(),user=window.loggedUser||configurator.getLoggedUser()||initData.loggedUser||{id:0,role:"N/A"};user=_.deepClone(user),user._id=host+"/user/"+user.id,user.host={id:host,tau_ref:"host"},user.tau_keep_date=!0,delete user.id,delete user.name,delete user.email,session.then(function(data){var location=data.location||{address:{}},date=new Date,session_id=user._id+"/"+date.getDate()+"_"+(date.getMonth()+1)+"_"+date.getFullYear();delete location.latitude,delete location.longitude,delete location.source,user.location=location;var evtData={user:user,host:{_id:host},visit:{_id:session_id,user:{id:user._id,tau_ref:"user"},host:{id:host,tau_ref:"host"},browser:data.browser,device:data.device,locale:data.locale,location:location}},$hostInfo=$.ajax({url:path.get()+"/info.ashx",dataType:"json"});$hostInfo.done(function(data){var dateParts=data.createdOn.split("/");data.createdOn=new Date(parseInt(dateParts[2]),parseInt(dateParts[0])-1,parseInt(dateParts[1])),_.extend(evtData.host,data),_.extend(evtData.visit.host,data),_.extend(evtData.user.host,data),self.fire("data.track",evtData)})})}})});
define('tracking/extensions/extension.tracking.slice.errors',["Underscore","./extension.tracking.base"],function(_,Extension){return Extension.extend({"global slice.error":function(evt,data){data=_.cloneDeep(data),data.place="slice",data.board=this.getBoardContext(data.definition),delete data.definition,this.fire("track.error",data),data.name=data.message||"error",data.tags=["error","slice"],this.fire("track.action",data)}})});
define('tracking/stores/store.mixpanel',["tau/core/class","Underscore"],function(Class,_){return Class.extend({init:function(config){this.config=config||{},function(c,a){window.mixpanel=a;var b,d,h,e;b=c.createElement("script"),b.type="text/javascript",b.async=!0,b.src=("https:"===c.location.protocol?"https:":"http:")+"//cdn.mxpnl.com/libs/mixpanel-2.1.min.js",d=c.getElementsByTagName("script")[0],d.parentNode.insertBefore(b,d),a._i=[],a.init=function(b,c,f){function d(a,b){var c=b.split(".");2==c.length&&(a=a[c[0]],b=c[1]),a[b]=function(){a.push([b].concat(Array.prototype.slice.call(arguments,0)))}}var g=a;"undefined"!=typeof f?g=a[f]=[]:f="mixpanel",g.people=g.people||[],h="disable track track_pageview track_links track_forms register register_once unregister identify name_tag set_config people.identify people.set people.increment".split(" ");for(e=0;e<h.length;e++)d(g,h[e]);a._i.push([b,c,f])},a.__SV=1.1}(document,window.mixpanel||[]),mixpanel.init(this.config.token||"9358df1d76f74e41257a47b79af1681f")},toPlainObject:function(node,value,path){var self=this;_.isUndefined(value)&&(value=null);var isArray=_.isArray(value);if(_.isString(value)||_.isNumber(value)||_.isDate(value)||isArray||_.isBoolean(value)||_.isNull(value)){node[path]=value,isArray&&value&&(node[path+"-not-empty"]=value.length>0,node[path+"-empty"]=value.length===0,node[path+"-length"]=value.length);return}var keys=_.keys(value);for(var i=0;i<keys.length;i++){var key=keys[i];self.toPlainObject(node,value[key],path+"-"+key)}},post:function(data){var mixpanel=window.mixpanel,isContext=data.type==="context";if(isContext&&data.user&&!this._userRegistered){this._userRegistered=!0;var id=data.user.role+" ["+data.user.host+"/"+data.user.id+"]";mixpanel.name_tag(id),mixpanel.people.identify(id);var content={name:id,role:data.user.role,id:data.user.id,host:data.user.host};mixpanel.people.set(content)}var dataToPost={};this.toPlainObject(dataToPost,data,"tp"),isContext&&(dataToPost["tp-user-name"]=data.user.role),mixpanel.track(data.type,dataToPost)}})});
define('tracking/stores/store.console',["tau/core/class","Underscore"],function(Class,_){return Class.extend({init:function(config){this.config=config||{},_.defaults(this.config,{method:"log"})},post:function(data){console[this.config.method](data)}})});
define('tracking/stores/store.tauspy',["jQuery","Underscore","app.path","libs/json2"],function($,_,appPath){var isCanBePostUsed=!1,timeoutId=0;"withCredentials"in new XMLHttpRequest&&(isCanBePostUsed=!0);var queue=[],track=function(config){this.config=_.defaults(config||{},{local:"taus"}),this.usePost=isCanBePostUsed,this.config.local&&(this.localUrl=appPath.get()+"/"+config.local,this.usePost=!0)};return track.prototype={encode:function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data)return data;do o1=data.charCodeAt(i++),o2=data.charCodeAt(i++),o3=data.charCodeAt(i++),bits=o1<<16|o2<<8|o3,h1=bits>>18&63,h2=bits>>12&63,h3=bits>>6&63,h4=bits&63,tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4);while(i<data.length);enc=tmp_arr.join("");var r=data.length%3;return(r?enc.slice(0,r-3):enc)+"===".slice(r||3)},postViaImage:function(data){try{if(!data)return!1;var isSSL="https:"===document.location.protocol;if(isSSL&&!this.config.urlSSL)return!1;var d=this.encode(encodeURIComponent(JSON.stringify(data)));if(Image){var url=isSSL?this.config.urlSSL:this.config.url;(new Image).src=url+"?f=b&d="+d}}catch(e){}return!0},queueItem:function(data){var self=this;_.isArray(data)?queue=queue.concat(data):queue.push(data),clearTimeout(timeoutId);var processQueue=function(){if(queue.length===0)return;var post=queue.concat([]);queue=[],self.usePost?self.postForm(post):self.postViaImage(post)};queue.length>(self.usePost?20:3)?processQueue():timeoutId=setTimeout(processQueue,1e3)},postForm:function(data){try{if(!data)return!1;var url=this.localUrl;if(!url){url=isSSL?this.config.urlSSL:this.config.url;var isSSL="https:"===document.location.protocol;if(isSSL&&!this.config.urlSSL)return!1}$.ajax({type:"POST",url:url,dataType:"json",processData:!1,data:JSON.stringify(data),contentType:"application/json; charset=utf-8"})}catch(e){}return!0},post:function(data){this.queueItem(data)}},track});
define('tracking/extensions/extension.tracking.store',["Underscore","./extension.tracking.base","tracking/stores/store.mixpanel","tracking/stores/store.console","tracking/stores/store.tauspy"],function(_,Extension,MixPanel,Console,TauSpy){var storesTypeHash={mixpanel:MixPanel,console:Console,tauspy:TauSpy},emptyFn=function(){},storeApi={init:emptyFn,post:emptyFn},sid=(new Date).getTime();return Extension.extend({init:function(config){var self=this;self._super(config);var cfg=config.store||{empty:{api:storeApi,config:{}}};self.stores=[],_.each(_.keys(cfg),function(key){var store=cfg[key];if(!store.api&&storesTypeHash.hasOwnProperty(key))try{store.api=new storesTypeHash[key](store),self.stores.push(store)}catch(e){}else if(store.api)try{store.api.init(store.config),self.stores.push(store)}catch(e){}})},postData:function(data){if(!_.isObject(data))return;var self=this;for(var i=0;i<self.stores.length;i++){var store=self.stores[i];try{store.api.post(data,self.bus)}catch(e){}}},"bus track.application.context.ready":function(evt,data){this.postData({appContext:data})},"bus track.application.context.ready:last + track.context.ready":function(evt,appData,data){_.extend(data,{appContext:{id:appData._id,tau_ref:"appContext"}}),this.postData({context:data}),this.fire("context.ready",{context:{id:data._id,tau_ref:"context"},appContext:{id:appData._id,tau_ref:"appContext"},user:data.user,host:data.host})},"bus data.track":function(evt,data){this.postData(data)},"bus context.ready:last + track.node":function(evt,context,data){_.each(_.values(data),function(node){_.isArray(node)||(node=[node]),_.each(node,function(n){_.extend(n,context),n.tick=(new Date).getTime(),n.sid=sid})}),this.postData(data)},"bus context.ready:last + track.action":function(evt,context,data){_.extend(data,context),data.action=data.action||data.name,data.tick=(new Date).getTime(),data.sid=sid,this.postData({action:data})},"bus context.ready:last + track.action.id.sid":function(evt,context,data){_.extend(data,context),data.tick=(new Date).getTime(),data.sid=sid,data._id&&(data._id+="/"+sid),this.postData({action:data})},"bus context.ready:last + track.error":function(evt,context,data){_.extend(data,context),data.tick=(new Date).getTime(),this.postData({error:data})},"bus context.ready:last + track.statistics":function(evt,context,data){_.extend(data,context),data.tick=(new Date).getTime(),this.postData({statistics:data})}})});
define('tracking/extensions/extension.tracking.slice',["Underscore","./extension.tracking.base","libs/json2"],function(_,Extension){return Extension.extend({slice:null,"global slice.ready":function(evtHash,data){var slice=data.slice,self=this;if(self.slice===slice)return;self.slice&&self.slice.removeAllListeners(self),self.slice=slice,self.slice.on("request.completed",function(evt,data){var time=data.time;if(!data.command||!data.response||!time||!time.start||!time.end)return;try{var serverTime=parseInt(data.response.getResponseHeader("X-Stopwatch")),contentLength=(data.response.responseText||"").length,totalTime=time.end-time.start,evtData={method:(data.command||{}).method,totalTime:totalTime,netTime:totalTime-serverTime,serverTime:serverTime,contentSize:contentLength};this.makePlainCleanObject(evtData,data.request.definition,"",["global","data"]),self.fire("track.node",{slice:evtData})}catch(e){}},self)}})});
define('tracking/extensions/extension.tracking.rest',["Underscore","./extension.tracking.base","tau/configurator"],function(_,Extension,configurator){return Extension.extend({"global store.command.executed":function(evt,data){if(!data||!data.command||!data.command.config||data.command.name!="save"&&data.command.name!="remove")return;var id=data.command.config.id,idString=id?" #"+id:"",type=data.command.type.toLowerCase();if(data.command.name=="remove"){this.fire("track.action",{action:"delete entity",name:"delete "+type+idString,area:"entity",tags:["delete "+type,"delete entity","entity"],type:type,id:id});return}if(data.command.name=="save"&&data.command.config.$set){var actionName=id?"update ":"add ",changes=_.keys(data.command.config.$set);if(changes.length===0)return;var keys=changes.join(","),user=window.loggedUser||configurator.getLoggedUser()||{id:0,role:"N/A"};this.fire("track.action.id.sid",{action:actionName+"entity",_id:this.getHost()+"/"+evt.caller.id+"/"+user.id+"/"+changes.join("_"),name:actionName+type+idString+" ["+keys.toLowerCase()+"]",area:"entity",tags:[actionName+type,actionName+"entity","entity","add|update"],type:type,changes:changes,id:id})}},"global store.command.failed":function(ev){var message="something is wrong";try{if(ev.data&&ev.data.data){ev.data.data.Message&&(message=ev.data.data.Message);var response=ev.data.data.response;if(response){response.Message&&(message=response.Message);if(_.isArray(response)){var parts=[response[1]];_.isArray(response[4])&&response[4].length>0&&response[4][0]!=parts[0]&&parts.push(response[4][0]),message=parts.join(":&nbsp;")}response.Error&&response.Error.Message&&(message=response.Error.Message)}}}catch(e){}var error={name:message,tags:["error","rest"]};this.fire("track.error",error),this.fire("track.action",error)}})});
define('tracking/component.tracking',["Underscore","tau/core/component-base","./extensions/extension.tracking.board.statistics","./extensions/extension.tracking.context.board","./extensions/extension.tracking.application.context","./extensions/extension.tracking.board.actions","./extensions/extension.tracking.clicks","./extensions/extension.tracking.user.host","./extensions/extension.tracking.slice.errors","./extensions/extension.tracking.store","./extensions/extension.tracking.slice","./extensions/extension.tracking.rest"],function(_,Component,BoardTracking,ContextTracking,AppContext,BoardActions,Clicks,UserAndHost,SliceErrors,Store,Slice,Rest){return{create:function(config){var extensions=[{type:BoardTracking},{type:ContextTracking},{type:Clicks},{type:UserAndHost},{type:SliceErrors},{type:AppContext},{type:BoardActions},{type:Store},{type:Slice},{type:Rest}],defaultConfig={name:"tracking component","queue.bus":!0},component=new Component(_.extend(defaultConfig,config||{}));return _.each(extensions,function(ext){component.attach(ext.type,ext.config)}),component.bus}}});
define('tracking/spy.event',["jQuery"],function($){return $.Deferred()});
define('tracking/tauspy',["./component.tracking","./spy.event"],function(tracking,spyEvent){var single=null,api={start:function(config){return single||(config=config||{},single=tracking.create(config)),single}};return spyEvent.done(function(config){api.start(config)}),api});
define('tau/core/view-base',["Underscore","jQuery","tau/core/event.emitter","tau/ui/templateRenderer.extensions","tau/core/templates-factory","tau/ui/templateRenderer"],function(_,$,Class,TauExtension,templates){var view=Class.extend({name:"view-base",init:function(config){this._super(config),this.config=config||{}},destroy:function(){this._super(),this.element&&this.element.remove(),delete this.element,delete this.config},merge:function(newElement,selector){var self=this;if(selector&&self.element){$.isArray(selector)||(selector=[selector]);var innerSelectors=_(selector).isArray()?selector:[selector],currentElement=this.element;_(innerSelectors).each(function(sel){var elementsToReplace=currentElement.find(sel),elementsToInsert=newElement.find(sel);elementsToReplace.each(function(i){$(this).replaceWith(elementsToInsert.eq(i))})})}},bindTemplate:function(data){var tmplName=this.config.template.name,newElement=templates.get(tmplName).bind(this.config,data);return newElement},prepareElement:function(newElement){return newElement},updateElement:function(newElement,refreshSelector){var self=this;self.element&&refreshSelector?self.merge(newElement,refreshSelector):(self.element&&(newElement.length?self.element.replaceWith(newElement):self.element.remove()),self.element=newElement)},doRender:function(data,refreshSelector){var newElement=this.bindTemplate(data);newElement=this.prepareElement(newElement),this.updateElement(newElement,refreshSelector),!this.config.visible&&this.hide()},fireAfterInit:function(refreshSelector){this.fire("afterInit",{config:this.config,refreshSelector:refreshSelector})},initialize:function(refreshSelector){var self=this;this.fireAfterInit(refreshSelector)},setDefaultConfig:function(){var self=this;_.defaults(self.config,{visible:!0})},"bus refreshData":function(args){this.doRender(args.data),this.fire("elementRefreshedWithData",{element:this.element})},"bus refresh":function(evt){this._super();var data=evt.data||{},refreshSelector=data.refreshSelector;this.startLifeCycle(evt,refreshSelector)},"bus initialize":function(evt){this.startLifeCycle(evt)},startLifeCycle:function(evt,refreshSelector){var self=this;self.setDefaultConfig(),_.extend(self.config,evt.data),self.fire("beforeInit",{config:self.config}),this.initialize(refreshSelector)},"bus show":function(){this.show()},"bus hide":function(){},"bus show+afterRender:last":function(evt){var $el=evt.afterRender.data.element;this.showElement($el,!0)},"bus hide+afterRender:last":function(evt){var $el=evt.afterRender.data.element;this.hideElement($el),this.config.visible=!1},show:function(){this.showElement(this.element),this.config.visible=!0},showElement:function($el){this.toggle($el,!0)},hide:function(){this.hideElement(this.element),this.config.visible=!1},hideElement:function($el){this.toggle($el,!1)},toggle:function($el,flag){this.config.visibilityClassName?$el.toggleClass(this.config.visibilityClassName,flag):$el.toggle(flag)},"bus applyTo":function(evt){this.element=evt.data.element},"bus afterInit+dataBind":function(evts){this.render(evts.dataBind.data,evts.afterInit.data)},render:function(data,settings){this.fireBeforeRender({data:data}),this.doRender(data,settings.refreshSelector),this.fireAfterRender({data:data})},fireBeforeRender:function(config){config=config||{},this.fire("beforeRender",{data:config.data,view:this,element:this.element})},fireAfterRender:function(config){config=config||{},this.fire("afterRender",{data:config.data,view:this,element:this.element})}});return view});
define('tau/core/extension.base',["Underscore","tau/core/event.emitter"],function(_,Class){var Extension=Class.extend({lifeCycleCleanUp:function(){this.resetLifecycle&&this.resetSubscriptions()},_extractOptions:function(initConfig,defaults){var options={};return _.isObject(initConfig)&&(initConfig.hasOwnProperty("options")?options=_.deepClone(initConfig.options||{}):!initConfig.hasOwnProperty("type")&&!initConfig.hasOwnProperty("name")&&!initConfig.hasOwnProperty("component")&&!initConfig.hasOwnProperty("context")&&(options=_.deepClone(initConfig))),options=_.deepMerge(defaults,options),options}});return Extension});
define('tau/core/extension.base.stateful',["Underscore","tau/core/extension.base"],function(_,Class){var emptyFn=function(){},isNotABusOrFunctionIterator=function(key){return key!=="bus"&&!_.isFunction(this[key])},destroyPropertyIterator=function(key){delete this[key]},Extension=Class.extend({init:function(config){this._super(config),this.config=config;if(config.context&&config.context.configurator){var configurator=config.context.configurator;this.config.store=configurator.getStore()}this.store=this.config.store},"bus    beforeInit":function(evtArgs,initConfig){initConfig=initConfig||{};var configurator=null;this.config.context&&(configurator=this.config.context.configurator),initConfig.config&&(this.config=_.extend(this.config,initConfig.config)),this.config.context&&(configurator=this.config.context.configurator?this.config.context.configurator:configurator,this.config.context.configurator=configurator),configurator&&(this.store=configurator.getStore(),this.config.store=this.store),this.onInit(this.config)},onInit:function(){},destroy:function(){this._super();var context=(this.config||{}).context;delete this.config,this.config={context:context},this.store.unbind(this),delete this.store,this.store={on:emptyFn,remove:emptyFn,get:emptyFn,find:emptyFn};var propNames=_.keys(this);_(propNames).chain().select(isNotABusOrFunctionIterator,this).each(destroyPropertyIterator,this).value()}});return Extension});
define('tau/components/extensions/component.extension.base',["Underscore","tau/core/extension.base.stateful"],function(_,Class){var Extension=Class.extend({"bus afterRender":function(evtArgs){this.element=evtArgs.data.element},createComponents:function(componentsConfig,callback){var creator={bus:this.bus,config:componentsConfig,create:function(){this.bus.on("componentsCreated",this.onComponentCreated,this),this.bus.fire("createComponents",this.config,this)},onComponentCreated:function(evtArgs){if(evtArgs.caller!==this)return;evtArgs.removeListener(),callback(evtArgs.data)}};creator.create()},isEntityInContext:function(evt){var currentEntityId=this.config.context.entity.id,entityFromContext=currentEntityId==(evt.data.entity||evt.data.assignable).id;return entityFromContext}});return Extension});
define('tau/ui/extensions/ui.extension.domOperationsBase',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({name:"ui.extension.domOperationsBase","bus markElementToBeDeleted":function(evt){var data=evt.data,$el=data.element;$el.addClass("deleting")},"bus deleteElement":function(evt){var $element=evt.data.element,callback=evt.data.callback;$element.fadeOut(750,callback)},"bus markElementToBeUpdated":function(evt){var data=evt.data,$el=data.element;$el.addClass("updating")},"bus cancelUpdateElement":function(evt){var $element=evt.data.element;this._highlightElement($element,"#EE5757",1500)},"bus updateElement":function(evt){var self=this,$element=evt.data.element;$element.each(function(){var $node=$(this);self._highlightElement($node,evt.data.color||"#FFFFD3",evt.data.duration||1500)})},_highlightElement:function($element,startColor,delay){$element.stop(!0,!0),$element.removeClass("updating"),$element.addClass("before-animate");var color=this._getElementBgColor($element),lastColor=$element.css("backgroundColor"),callback=function(){$element.css("backgroundColor","")};$element.removeClass("before-animate"),$element.css({backgroundColor:startColor}).animate({backgroundColor:color},delay,callback)},_getElementBgColor:function($el){var color="transparent";while($el.length>0&&$el.parent()&&((color=$el.css("backgroundColor"))=="transparent"||color==undefined||color=="rgba(0, 0, 0, 0)"||color.length==0)){$el=$el.parent();if($el.is("body"))break}if(color=="transparent"||color.length==0)color="#ffffff";return color}})});
define('tau/components/component.creator',["Underscore","tau/core/component-base","tau/core/view-base","tau/ui/extensions/ui.extension.domOperationsBase","tau/ui/ui.templateFactory"],function(_,ComponentBase,ViewBase,domOperationsBase,templateFactory){return{create:function(configCreator,componentConfig){var config=componentConfig||{};configCreator=configCreator||{},_.defaults(config,{name:configCreator.name}),configCreator.template&&(config.template=configCreator.template),config.template&&config.template.markup&&(config.template=templateFactory.register(config.template));var component=new ComponentBase(config);config=component.config;var configurator=config.context.configurator;_.defaults(config,{store:configurator.getStore()});var viewType=configCreator.ViewType||ViewBase;component.attach(viewType),configCreator.ModelType&&component.attach(configCreator.ModelType);var domOperationsExtension=configCreator.domOperations||domOperationsBase;component.attach(domOperationsExtension);if(configCreator.extensions&&configCreator.extensions.constructor==Array)for(var i=0;i<configCreator.extensions.length;i++){var extension=configCreator.extensions[i];if(!extension)throw new Error("Extension ["+i+"] for component "+config.name+" is not defined");extension.hasOwnProperty("type")&&extension.hasOwnProperty("config")?component.attach(extension.type,extension.config):component.attach(extension)}var componentBus=component.bus;return configurator.getComponentBusRegistry().register(componentBus),componentBus.on("destroy",function(){configurator.getComponentBusRegistry().unregister(this)}),componentBus}}});
define('tau/core/event-dispatcher',["Underscore","tau/core/class"],function(_,Class){var EventDispatcher=Class.extend({init:function(components){this.components=components,this.eventArgsQueue={},this.dictionaryQueue={}},listen:function(evtName,callback){var self=this;self.dictionaryQueue.hasOwnProperty(evtName)||(self.dictionaryQueue[evtName]=_(self.components).clone(),self.eventArgsQueue[evtName]=[]);var listener=function(evt){var sender=evt.sender;evt.removeListener();var index=_(self.components).indexOf(sender);self.eventArgsQueue[evt.name][index]=evt.data,self.dictionaryQueue[evt.name]=_(self.dictionaryQueue[evt.name]).without(sender);if(_.isEmpty(self.dictionaryQueue[evt.name])){var data={eventName:evt.name,argsArr:self.eventArgsQueue[evt.name]};callback(data)}};_(self.components).each(function(component){component.on(evtName,listener,null,{},1e3)})}});return EventDispatcher});
define('tau/ui/templates/container/ui.template.container.list',["tau/core/templates-factory"],function(templates){var config={name:"container.list",markup:['<div class="tau-container ${cssClass}">',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/container/ui.template.container.table',["tau/core/templates-factory"],function(templates){var config={name:"container.table",markup:['<table class="${cssClass} container-table">',"   <tr></tr>","</table>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/container/ui.template.container.replaceable',["tau/core/templates-factory"],function(templates){var config={name:"container.replaceable",engine:"jqote2",markup:["<div>","</div>"]};return templates.register(config)});
define('tau/views/view.container',["Underscore","jQuery","tau/core/view-base","tau/core/event-dispatcher","tau/ui/templates/container/ui.template.container.list","tau/ui/templates/container/ui.template.container.table","tau/ui/templates/container/ui.template.container.replaceable"],function(_,$,viewBase,EventDispatcher){var containerView=viewBase.extend({init:function(config){this._loaded=!1,this._super(config)},completeInitializationWithoutChildren:function(){var self=this;self.fire("afterInit"),self._fireChildrenRendered({children:[],childrenEvtArgs:[]})},setDefaultConfig:function(){var self=this;self._super(),_.defaults(self.config,{template:{name:"container."+(self.config.layout||"list")}})},"bus componentCreated":function(evtArgs){var component=evtArgs.data.component;this.fire("childComponentCreated",component),this.children.push(component)},_fireChildrenRendered:function(children){this.fire("internalChildrenRendered",children)},"bus afterInit+internalChildrenRendered":function(evts){var data=this._getRenderConfig();this.fireBeforeRender({data:data}),this.doRender(data);var children=evts.internalChildrenRendered.data;_.extend(children,{config:this.config}),this.fire("childrenRendered",children),this.fireAfterRender({data:data})},initializeComponents:function(evtArgs){var self=this;self.dispatcher=new EventDispatcher(self.children);var events=["afterInit"],reaction=function(data){self.fire(data.eventName)};_(events).each(function(evtName){self.dispatcher.listen(evtName,reaction)}),self.dispatcher.listen("afterRender",function(evt){var childrenEvtArgs=evt.argsArr,data={children:self.children,childrenEvtArgs:childrenEvtArgs};self._fireChildrenRendered(data)});var childrenConfigs=_(evtArgs.data).pluck("config");_(self.children).each(function(c,index){c.fire("initialize",childrenConfigs[index])})},"bus componentsCreated:last+sendEventToComponents":function(evt){var components=evt.componentsCreated.data,eventConfig=evt.sendEventToComponents.data;_.each(components,function(config){config.component.fire(eventConfig.name,eventConfig.data)})},"bus componentsCreated":function(evtArgs){this.fire("beforeComponentsInitialize",evtArgs.data),this.initializeComponents(evtArgs),this.fire("afterComponentsInitialize",evtArgs.data)},lifeCycleCleanUp:function(){this.destroyChildren()},"bus refresh":function(evt){this.startLifeCycle(evt)},startLifeCycle:function(evt){var self=this;self.setDefaultConfig(),_.extend(self.config,(evt||{}).data),self.fire("beforeInit",{config:self.config});var children=self.config.children;self.children=[];var loadDependencies=_.isArray(children)&&_.size(children)>0&&self.config.visible;if(loadDependencies){var components=self.config.children,context=self.config.context||{};this.fire("createComponents",{components:components,context:context})}else self.completeInitializationWithoutChildren()},"bus initialize":function(evt){this.startLifeCycle(evt)},toggle:function($el,flag){var useAnimation=this.config.useAnimation!==!1&&!$.fx.off&&$el.parents(".tau-bubble:first").length==0;useAnimation?flag?$el.slideDown(200):this._loaded?$el.slideUp(200):this._super($el,flag):this._super($el,flag)},"bus show":function(){this._super(),this._loaded?this.fire("show.completed",this):this.fire("initialize",{})},"bus show + internalChildrenRendered":function(){this.fire("show.completed")},_getRenderConfig:function(){var cfg=this.config;return cfg.visible&&(this._loaded=!0),cfg},destroyChildren:function(){var item=null;if(this.children&&this.children.length)while(item=this.children.pop())item.destroy();this.children=null},destroy:function(){this.dispatcher=null,this.destroyChildren(),this._super()}});return containerView});
define('tau/components/extensions/additionalInfo/extension.additionalInfo.editable',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({category:"edit",editableIndexes:null,init:function(){this._super.apply(this,arguments),this.onRowClickProxy=$.proxy(this.onRowClick,this)},"bus beforeComponentsInitialize":function(evtData){this.editableIndexes=[],this.createComponentList(evtData.data),this.attachListeners()},"bus afterRender":function(evtArgs){this.$el=evtArgs.data.element,this.addEditableBehaviour()},"bus refresh":function(){this.clearComponent()},createComponentList:function(data){this.components=[];for(var i=1;i<data.length;i+=2)this.components.push(data[i].component)},addEditableBehaviour:function(){for(var i=0;i<this.editableIndexes.length;i++)this.doEditableRow(this.editableIndexes[i])},attachListeners:function(){var components=this.components;if(components)for(var i=0;i<components.length;i++)components[i].on("permissionsReady",this.onPermissionsReady,this,{index:i})},removeListeners:function(){var components=this.components;if(components)for(var i=0;i<components.length;i++)components[i].removeListener("permissionsReady",this.onPermissionsReady,this)},onRowClick:function(ev){var $target=$(ev.target);if($target.is("a")==1||$target.parent().is("a")==1)return!0;ev.stopPropagation(),ev.data.component.fire("edit")},doEditableRow:function(index){var $row=this.$el.find(" > tbody > tr").eq(index),proxy=this.onRowClickProxy;$row.unbind("click",proxy),$row.bind("click",{component:this.components[index]},proxy),$row.addClass("ui-additionalinfo_editable_true")},onPermissionsReady:function(evtArgs){if(evtArgs.data.editable){var index=evtArgs.listenerData.index;this.$el?this.doEditableRow(index):this.editableIndexes.push(index)}},clearComponent:function(){this.removeListeners(),delete this.components,delete this.editableIndexes,delete this.$el},destroy:function(){this.clearComponent(),this._super()}})});
define('tau/components/extensions/additionalInfo/extension.additionalInfo.updateAnimation',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({category:"edit",init:function(){this._super.apply(this,arguments)},"bus beforeComponentsInitialize":function(evtData){var componentsList=this.createComponentList(evtData.data);this.fire("componentsList.ready",componentsList)},"bus afterRender + componentsList.ready":function(e){var $parentElement=e.afterRender.data.element,componentsList=e["componentsList.ready"].data;this.attachListeners(componentsList,$parentElement)},createComponentList:function(data){var componentsList=[];for(var i=1;i<data.length;i+=2)componentsList.push(data[i].component);return componentsList},attachListeners:function(components,$parentElement){if(components)for(var i=0;i<components.length;i++){var ci=components[i];ci.on("beforeChangeProperty",this.createOnBeforeChangePropertyHandler({$el:$parentElement}),this,{index:i}),ci.on("propertyChanged",this.createOnPropertyChangedHandler({$el:$parentElement}),this,{index:i,component:components[i]},1)}},createOnPropertyChangedHandler:function(params){var self=this;return function(evtArgs){var index=evtArgs.listenerData.index,component=evtArgs.listenerData.component;component.on("afterRender",function(e){e.removeListener();var $row=params.$el.find(" > tbody > tr").eq(index).find(">td");self.fire("updateElement",{element:$row})},component)}},createOnBeforeChangePropertyHandler:function(params){var self=this;return function(evtArgs){var index=evtArgs.listenerData.index,$row=params.$el.find(" > tbody > tr").eq(index).find(">td");self.fire("markElementToBeUpdated",{element:$row})}}})});
define('tau/components/extensions/component.creator.extension',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){var Creator=ExtensionBase.extend({getDependencies:function(children){var dependencies=[];return _(children).each(function(config){if(config.path)dependencies.push(config.path);else{if(!config.type)throw"Configuration error: type or path is missing";var path="tau/components/component."+config.type;dependencies.push(path)}}),dependencies},childrenLoadedCallback:function(childrenConfigs,listenerData){var self=this,result=[];_(childrenConfigs).each(function(config){config.name||(config.name="",config.type&&(config.name=config.type),config.id&&(config.name+=":"+config.id));var component;try{var component=config.component.create(config);self.fire("componentCreated",{component:component}),result.push({config:config,component:component})}catch(e){console.error(e)}}),self.fire("componentsCreated",result,listenerData)},createDependenciesLoadedCallback:function(data,listenerData){var self=this,childrenConfigs=data.components,parentContext=data.context;return function(){var components=arguments;_(childrenConfigs).each(function(config,index){config.component=components[index],config.context=parentContext}),self.childrenLoadedCallback(childrenConfigs,listenerData)}},"bus createComponents":function(evtArgs){var config=evtArgs.data,listenerData=evtArgs.caller,components=config.components;components=config.components=_.isArray(components)?components:[components];var dependencies=this.getDependencies(components);require(dependencies,this.createDependenciesLoadedCallback(config,listenerData))}});return Creator});
define('tau/ui/extensions/layout/ui.extension.layout',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus childrenRendered+afterRender":function(evt){var self=this;self.element=evt.afterRender.data.element;var childrenArgs=evt.childrenRendered.data.childrenEvtArgs;self.config.layout=self.config.layout||"list";var options=self.config,methodName=["_add",options.layout,"item"].join(" ");options.childrenContainerSelector=options.childrenContainerSelector||(options.layout==="list"?null:"> tbody > tr"),_.each(childrenArgs,function(data){var $child=data.element,args={element:$child,data:data};self.fire("append.child.element",args),self[methodName](args.element,data.view?data.view.config:{})}),self.element&&(evt.afterRender.data.element=self.element)},"_add list item":function(data){var element=data.jquery?data:data.element,$target=this.config.childrenContainerSelector?this.element.find(this.config.childrenContainerSelector):this.element;$target.append(element)},getTableItemContainer:function(){var self=this,options=self.config,row=self.element.find(options.childrenContainerSelector+":last");if(options.hasOwnProperty("columnCount")){var itemsCount=row.children("td").size();itemsCount>=options.columnCount&&(row=$("<tr></tr>"),self.element.children("tbody").append(row))}return row},"_add table item":function(data){var self=this,element=data.jquery?data:data.element,options=self.config,row=this.getTableItemContainer(),index=row.children("td").length,cssClass=options.cellsCssClass&&options.cellsCssClass[index]||"";$("<td></td>").addClass(cssClass).append(element).appendTo(row)},"_add selectable item":function(componentEl,componentConfig){var $source=componentEl,$el=this.element,selector=componentConfig.selector||"[role=main]",$target=$el.filter(selector);$target.length==0&&($target=$el.find(selector)),$target.length==0?(console.log($el),console.error('No element for selector "'+selector+'"')):$target.eq(0).append($source)},"_add replaceable item":function(data){var $childElement=data.jquery?data:data.element,$containerElement=this.element;$containerElement.parent().length?$containerElement.replaceWith($childElement):this.element=$childElement}})});
define('tau/ui/extensions/spinner/ui.extension.spinner',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({options:{spinnerClass:"ui-spinner"},"bus beforeInit":function(evtArgs){var self=this;this.config.spinner!==!1&&self.element&&self.element.addClass(self.options.spinnerClass)},"bus afterRender":function(evt){var self=this;self.element=evt.data.element,this.config.spinner!==!1&&self.element.removeClass(self.options.spinnerClass)}})});
define('tau/components/component.additionalInfo',["Underscore","tau/components/component.creator","tau/views/view.container","tau/components/extensions/additionalInfo/extension.additionalInfo.editable","tau/components/extensions/additionalInfo/extension.additionalInfo.updateAnimation","tau/components/extensions/component.creator.extension","tau/ui/templates/container/ui.template.container.table","tau/ui/extensions/layout/ui.extension.layout","tau/ui/extensions/spinner/ui.extension.spinner"],function(_,creator,ViewType,EditableExtension,AnimationExtension,ComponentCreatorExtension,Template,LayoutExtension,SpinnerExtension){return{create:function(config){config=config||{};var realChildren=[];_.forEach(config.children,function(item){item.label&&item.field?(item.label.disabledExtensionCategories=config.disabledExtensionCategories,realChildren.push(item.label),item.field.disabledExtensionCategories=config.disabledExtensionCategories,realChildren.push(item.field)):(item.disabledExtensionCategories=config.disabledExtensionCategories,realChildren.push(item))}),config.children=realChildren,_.defaults(config,{template:Template,cssClass:"additional-info-table",columnCount:2,cellsCssClass:["ui-additionalinfo__label","ui-additionalinfo__value"],layout:"table"});var creatorConfig={extensions:[ComponentCreatorExtension,LayoutExtension,AnimationExtension,SpinnerExtension,EditableExtension],ViewType:ViewType};return creator.create(creatorConfig,config)}}});
define('tau/models/application/model.application.main',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus initialize":function(evt,initConfig){var options=this._extractOptions(initConfig,{applicationId:_.uniqueId("app"),turnOffLoadingIndicator:!1,integration:{showInPopup:!1,keepAlive:!1,appendTo:null},routing:{silent:!1,executeOnStart:!0},comet:{enabled:!1}}),configurator=initConfig.context.configurator;this.fire("configurator.ready",configurator),this.fire("options.ready",options)},"bus afterInit":function(evt){this.fire("dataBind",{})}})});
define('tau/ui/extensions/application.generic/ui.extension.application.generic.routing',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready + beforeInit":function(evt,configurator,initConfig){var routesConfig=initConfig.config.routes,routes=_.map(routesConfig,_.bind(function(route){return this.processRoute(route,configurator)},this));this.currentValue=!0,this.fire("routes.ready",routes)},"bus configurator.ready + options.ready + routes.ready + afterRender":function(evt,configurator,options,routes){this.bindToRoutes(configurator,options,routes),options.routing.executeOnStart&&configurator.getHashService().triggerChange(),this.fire("routes.bound",routes)},"bus configurator.ready + destroy":function(evt,configurator){this.currentValue=null,configurator.getHashService().removeAllListeners(this)},"bus application.exit":function(){this.currentValue=null},bindToRoutes:function(configurator,options,routes){var applicationId=options.applicationId,hashService=configurator.getHashService(),onHashChangeHandler=_.bind(function(){var value=applicationId?hashService.getHashParam(applicationId):hashService.getHash().split("&")[0];if(this.currentValue===value)return;this.currentValue=value;var matched=_.find(routes,function(route){return route.pattern.test(value)});if(matched){var args=matched.pattern.exec(value).slice(1);matched.callback.apply(null,args),configurator.getRouting().setReferer(configurator.service("navigator").getCurrent())}else this.fire("error","URL is not found")},this);hashService.on("changed",_.bind(onHashChangeHandler,this),this)},processRoute:function(routeConfig,configurator){return{pattern:_.isString(routeConfig.pattern)?new RegExp(routeConfig.pattern):routeConfig.pattern,callback:this.createPatternCallback(routeConfig,configurator)}},createPatternCallback:function(routeConfig,configurator){var fnResolve=_.bind(function(requestArgs){this.fire("application.navigate",{host:routeConfig.host,type:routeConfig.type,requestArgs:requestArgs})},this),fire=_.bind(this.fire,this);return function(){routeConfig.adapter?routeConfig.adapter.apply({fire:fire,configurator:configurator,resolve:fnResolve},arguments):fnResolve()}}})});
define('tau/ui/behaviour/common/ui.behaviour.progressIndicator',["Underscore","jQuery"],function(_,$){return{get:function($placeholder){var $r=$placeholder.tauProgressIndicator();return{show:_.bind(function(options){var $ph=this;options=options||{};var result=$r;if(options.delay>0){var timeoutDescriptor=setTimeout(function(){$ph.tauProgressIndicator("show",options)},options.delay);$placeholder.data("tauProgressIndicator-timeoutDescriptor",timeoutDescriptor)}else result=$ph.tauProgressIndicator("show",options);return result},$placeholder),hide:_.bind(function(){var $ph=this,timeoutDescriptor=$ph.data("tauProgressIndicator-timeoutDescriptor");return timeoutDescriptor&&clearTimeout(timeoutDescriptor),$ph.tauProgressIndicator("hide")},$placeholder)}}}});
define('tau/ui/extensions/application.generic/ui.extension.application.generic.controller',["Underscore","jQuery","tau/core/extension.base","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/core/event-dispatcher"],function(_,$,ExtensionBase,ProgressIndicator,EventDispatcher){return ExtensionBase.extend({"bus beforeInit":function(){this.fire("controller.hostType",null),this.fire("controller.app.host.prev",null),this.fire("controller.app.page.prev",null)},"bus controller.app.host.prev > controller.app.host":function(e){var next=e["controller.app.host"].data,prev=e["controller.app.host.prev"].data;prev&&prev.destroy(),this.fire("controller.app.host.prev",next)},"bus controller.app.page.prev > controller.app.page":function(e){var next=e["controller.app.page"].data,prev=e["controller.app.page.prev"].data;prev&&prev.destroy(),this.fire("controller.app.page.prev",next)},"bus controller.hostType:last + application.navigate":function(e,currentHostData,navigateData){var args=navigateData.requestArgs||{},entity=args.entity,action=args.action,entityType=_.isObject(entity)?entity.type:_.asString(entity);if(entityType&&action||entity=="reports")navigateData.applicationClassName="tau-page-entity";var newHostData=navigateData.host,isMasterTypeChanged=!currentHostData||newHostData.name!==currentHostData.name;isMasterTypeChanged&&this.fire("controller.hostType",newHostData);var postfix=isMasterTypeChanged?"full":"partial";this.fire("controller.load."+postfix,navigateData)},"bus options.ready:last + configurator.ready:last + controller.load.full":function(e,options,configurator,d){var componentBuilder=configurator.getComponentBuilder(),initConfig=_.defaults({context:{configurator:configurator}},d.requestArgs);initConfig.turnOffLoadingIndicator=options.turnOffLoadingIndicator||!1,initConfig.comet=options.comet||{},$.when(componentBuilder.create(d.host,initConfig),componentBuilder.create(d.type,initConfig)).done(_.bind(function(hostBus,pageBus){this.fire("controller.preExecute",{}),this.fire("controller.app.host",hostBus),this.fire("controller.app.page",pageBus),this.addListeners(hostBus,"Host"),this.addListeners(pageBus,"Page");var eventDispatcher=new EventDispatcher([hostBus,pageBus]);eventDispatcher.listen("afterRender",_.bind(function(e){var $host=e.argsArr[0].element,$page=e.argsArr[1].element;this.fire("innerContentRendered",{element:$host,$host:$host,$page:$page,applicationClassName:d.applicationClassName}),pageBus.on("afterRender",_.bind(function(e,pageRenderData){this.fire("innerContentRendered",{element:this.$host,$host:this.$host,$page:pageRenderData.element,applicationClassName:d.applicationClassName})},this),this)},this)),hostBus.initialize(initConfig),pageBus.initialize(initConfig),this.fire("controller.postExecute",{})},this))},"bus options.ready:last + configurator.ready:last + controller.load.partial":function(e,options,configurator,d){var componentBuilder=configurator.getComponentBuilder(),initConfig=_.defaults({context:{configurator:configurator}},d.requestArgs);initConfig.turnOffLoadingIndicator=options.turnOffLoadingIndicator||!1,initConfig.comet=options.comet||{},$.when(componentBuilder.create(d.type,initConfig)).done(_.bind(function(pageBus){this.fire("controller.preExecute",{}),this.fire("controller.app.page",pageBus),this.addListeners(pageBus,"Page"),pageBus.on("afterRender",_.bind(function(e,pageRenderData){this.fire("innerContentRendered",{element:this.$host,$host:this.$host,$page:pageRenderData.element,applicationClassName:d.applicationClassName})},this),this),pageBus.initialize(initConfig),this.fire("controller.postExecute",{})},this))},"bus afterRender:last + innerContentRendered":function(e,renderData,controllersRenderData){var $el=renderData.element,$host=controllersRenderData.$host,$page=controllersRenderData.$page;if($host.is(this.$host)&&$page.is(this.$page))return;$host.is(this.$host)||(this._appendHost($el,$host),this.$host=$host,this._appendPage($el,$host,$page),this.$page=$page),$page.is(this.$page)||(this._appendPage($el,this.$host,$page),this.$page=$page);var $p=$el.parents(".ui-popup:first");$p.length?$p=$el.add($p):$p=$el,controllersRenderData.applicationClassName?$el.data("classname")!=controllersRenderData.applicationClassName&&($p.removeClass($p.data("classname")||""),$p.addClass(controllersRenderData.applicationClassName),$p.data("classname",controllersRenderData.applicationClassName)):($p.removeClass($p.data("classname")||""),$p.data("classname","")),this.fire("controller.appContent.rendered",$el),this.fire("contentRendered",{element:$el})},"bus controller.load.partial > controller.host.rendered":function(e,$1,$host){var $el=$host.element.find("[role=main]"),integration=this.config.integration||{};!0!==integration.disableProgressIndicator&&ProgressIndicator.get($el).show()},"bus controller.load.partial > controller.host.rendered > innerPageRendered":function(e,$1,$host){var $el=$host.element.find("[role=main]"),integration=this.config.integration||{};!0!==integration.disableProgressIndicator&&ProgressIndicator.get($el).hide()},"bus configurator.ready:last + controller.app.page":function(e,configurator,pageBus){pageBus.on("beforeDelete",_.bind(function(e){this.fire("initProgress")},this),this),pageBus.on("deleted",_.bind(function(e){configurator.service("navigator").back()},this),this),pageBus.on("error",_.bind(function(e){this.fire("application.error",e.data)},this),this)},"bus view.dom.ready:last + controller.app.host:last + innerHostRendered + controller.appContent.rendered":function(e,dom,hostBus){hostBus.fire("view.dom.ready",dom)},"bus view.dom.ready:last + controller.app.page:last + innerPageRendered + controller.appContent.rendered":function(e,dom,pageBus){pageBus.fire("view.dom.ready",dom)},"bus controller.app.host:last > destroy":function(e,hostBus){hostBus.fire("destroy")},"bus controller.app.page:last > destroy":function(e,pageBus){pageBus.fire("destroy")},"bus controller.app.page:last > application.exit":function(e,pageBus){pageBus.fire("destroy")},_appendHost:function($el,$host){$el.empty().append($host)},_appendPage:function($el,$host,$page){$host.find("[role=main]").append($page)},addListeners:function(bus,alias){return bus.on("afterRender",_.bind(function(e){this.fire("inner"+alias+"Rendered",e.data)},this),this),bus}})});
define('tau/ui/extensions/application.generic/ui.extension.application.generic.navigation',["Underscore","jQuery","tau/core/class","tau/core/extension.base","libs/parseUri"],function(_,$,Class,ExtensionBase,parseUri){return ExtensionBase.extend({"bus initialize":function(){this._id=_.uniqueId("navigator")},"bus options.ready:last + view.dom.ready:last + configurator.ready:last + afterRender":function(e,options,domData,configurator,renderData){if(!options.routing.silent)return;var $el=renderData.element;$el.parent().off("click."+this._id,"a"),$el.parent().on("click."+this._id,"a",_.bind(function(configurator,e){if(e.ctrlKey||e.metaKey)return;var $a=$(e.currentTarget),href=_.asString($a.attr("href"));if(href==="#")return;var hash="";href.charAt(0)==="#"?hash=href.substr(1):$a.data("target")||(hash=parseUri(href).anchor),hash&&(e.preventDefault(),e.stopPropagation(),configurator.service("navigator").to(hash))},this,configurator))},"bus configurator.ready:last + routes.bound:last + application.navigate.entity":function(evt,configurator,routes,data){var url=_.compact([data.entity||data.type,data.id,data.action]).join("/");configurator.service("navigator").to(url)},"bus configurator.ready":function(e,configurator){configurator.service("navigator").on("back",_.bind(function(){var history=configurator.getHistory(),item=history.pop();item?(history.setCurrent(null),configurator.service("navigator").to(parseUri(item.url).anchor)):this.fire("application.exit"),_.delay(_.bind(this.fire,this,"clearError"),100)},this),this)},"bus configurator.ready:last + destroy":function(e,configurator){configurator.service("navigator").removeAllListeners(this)},"bus contentRendered + destroy":function(evt,renderData){var $el=renderData.element;$el.parent().off("click."+this._id,"a")}})});
define('tau/ui/extensions/application.generic/ui.extension.application.generic.history',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(evt,configurator){this.setHandler(configurator)},"bus configurator.ready:last + application.exit + application.navigate.entity":function(evt,configurator){this.setHandler(configurator)},"bus configurator.ready:last + history.reset":function(e,configurator){configurator.getHistory().reset()},"bus configurator.ready:last + controller.preExecute":function(e,configurator){configurator.getHistory().process()},"bus configurator.ready:last + application.exit":function(evt,configurator){this.clear(configurator)},"bus configurator.ready:last + destroy":function(evt,configurator){this.clear(configurator)},setHandler:function(configurator){var _handler=_.bind(function(e){var current=configurator.getHistory().getCurrent();current&&current.title&&configurator.getTitleManager().set(current.title)},this);configurator.getHistory().on("setCurrent",_handler,this)},clear:function(configurator){configurator.getTitleManager().restoreDefault();var history=configurator.getHistory();history.reset(),history.removeAllListeners(this)}})});
define('tau/ui/extensions/application.generic/ui.extension.application.generic.integration',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus beforeInit + configurator.ready":function(evt,initConfig,configurator){var reloadEvt=_.bind(function(evt){var evtData=evt.data,changes={project:{id:evtData.project.id}},data={id:evtData.entity.id,changes:changes,cmd:{config:{$set:changes}}};this.fire("integration.react",data)},this),duplicateBugReloadEvt=_.bind(function(evt){var evtData=evt.data,changes={},data={id:evtData.bugId,changes:changes,cmd:{config:{$set:changes}}};this.fire("integration.react",data)},this),gb=configurator.getGlobalBus();gb.removeAllListeners(this),gb.on("bugWasMarkedAsDuplicate",duplicateBugReloadEvt,this),gb.on("entityWasMovedToProject",reloadEvt,this);var store=configurator.getStore();store.unbind(this);var reloadCallback=_.bind(function(e){this.fire("integration.react",e.data)},this),types=["general","assignment","roleEffort"];_.each(types,_.bind(function(type){store.on({type:type,eventName:"afterSave",listener:this},reloadCallback),store.on({type:type,eventName:"afterRemove",listener:this},reloadCallback)},this))},"bus options.ready + beforeInit":function(e,options){$("body").delegate("a[href=#]","click",function(e){e.preventDefault()});var reloadCallback=options.integration.reloadCallback,progress=options.integration.progress;progress&&this.fire("progress.ready",progress),reloadCallback&&this.fire("reloadCallback.ready",reloadCallback)},"bus progress.ready:last + initProgress":function(e,progress){progress.show("Reloading...")},"bus progress.ready:last + application.error":function(e,progress){progress.hide()},"bus reloadCallback.ready:last + integration.react":function(e,reloadCallback,integrationData){reloadCallback({data:integrationData})},"bus configurator.ready > destroy":function(evt,configurator){configurator.getStore().unbind(this),configurator.getGlobalBus().removeAllListeners(this)}})});
define('tau/components/extensions/error/extension.errorBar',["jQuery","Underscore","tau/core/extension.base"],function($,_,ComponentExtensionBase){var notificationError=ComponentExtensionBase.extend({"bus initialize":function(evtArgs){if(document.documentMode==7){var msg={message:"TargetProcess does not support Compatibility View for Internet Explorer 7. Please, turn it off."};throw this.fire("error",msg),msg}},"bus clearError":function(){$("body").notifyBar("remove")},"bus error":function(evtArgs){var e=evtArgs.data;this.notify({type:"error",message:_.isString(e)?e:e.message,details:e.details,$node:e.$node,delay:e.delay,disableAutoClose:e.disableAutoClose===!0})},"bus notification":function(evtArgs){var e=evtArgs.data;this.notify({type:"success",message:e.message,$node:e.$node,delay:e.delay,disableAutoClose:e.disableAutoClose===!0})},notify:function(obj){var html=_.asString(obj.message);obj.details&&(html+="<div class='error-details'>"+obj.details+"</div>"),$("body").notifyBar({className:obj.type,$node:obj.$node,html:html,delay:obj.delay||1e5,disableAutoClose:obj.disableAutoClose})}});return notificationError});
define('tau/ui/extensions/application.generic/ui.extension.application.generic.popup',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus options.ready + beforeInit":function(e,options){var $popup=$("<div></div>");$popup.tauPopup(),options.integration.cssClass&&$popup.tauPopup("widget").addClass(options.integration.cssClass),$popup.on("taupopuphide",_.bind(function(){options.integration.keepAlive?this.fire("application.exit"):this.fire("destroy")},this)),this.fire("$popup.ready",$popup)},"bus $popup.ready > contentRendered":function(evt,$popup,data){this.fire("popup.open",data)},"bus popup.close > contentRendered":function(evt,d,data){this.fire("popup.open",data)},"bus configurator.ready:last + $popup.ready:last + popup.open":function(e,configurator,$popup,contentData){var $el=contentData.element;$el.addClass("ui-popup-content"),$popup.tauPopup("show"),configurator.getKeyBoardManager().pushHandler({handleKeyDown:function(e){e.keyCode==$.ui.keyCode.ESCAPE&&$popup.tauPopup("hide")}}),$el.hasClass("tau-page-entity")&&$popup.tauPopup("widget").addClass("tau-page-entity"),$popup.tauPopup("widget").append($el),this.fire("view.dom.ready",$("body"))},"bus application.exit":function(){this.fire("popup.close")},"bus configurator.ready:last + $popup.ready:last + popup.close":function(e,configurator,$popup){$popup.tauPopup("widget").is(":visible")&&($popup.tauPopup("hide"),configurator.getKeyBoardManager().popHandler())},"bus $popup.ready > destroy":function(e,$popup){$popup.tauPopup("destroy")}})});
define('tau/ui/templates/application/ui.template.application.generic',["tau/core/templates-factory"],function(templates){var config={name:"application.generic",engine:"jqote2",markup:['<div role="application" class="tau-app i-role-application','<% if (navigator.userAgent.indexOf("Windows") > 0) { %> i-useragent_os_win<% } %>',"<% if ($.browser.webkit) { %> i-browser_engine_webkit<% } %>","<% else if ($.browser.mozilla) { %> i-browser_engine_mozilla<% } %>","<% else if ($.browser.msie) { %> i-browser_engine_ie<% } %>",'">',"</div>"]};return templates.register(config)});
define('tau/components/component.application.generic',["Underscore","tau/service.container","tau/core/component-base","tau/models/application/model.application.main","tau/core/view-base","tau/ui/extensions/application.generic/ui.extension.application.generic.routing","tau/ui/extensions/application.generic/ui.extension.application.generic.controller","tau/ui/extensions/application.generic/ui.extension.application.generic.navigation","tau/ui/extensions/application.generic/ui.extension.application.generic.history","tau/ui/extensions/application.generic/ui.extension.application.generic.integration","tau/components/extensions/error/extension.errorBar","tau/ui/extensions/application.generic/ui.extension.application.generic.popup","tau/ui/templates/application/ui.template.application.generic"],function(_,ServiceContainer,Component,Model,ViewExtension,RouterExtension,ControllerExtension,NavigationExtension,HistoryExtension,IntegrationExtension,ErrorExtension,PopupExtension,Template){return{create:function(config){config=config||{onCreate:function(){}};var configurator=config.context.configurator||new ServiceContainer,component=new Component({name:config.name,queuedBus:!0,context:{configurator:configurator},template:Template}),extensions=[Model,ViewExtension,RouterExtension,ControllerExtension,NavigationExtension,HistoryExtension,IntegrationExtension,ErrorExtension],integrationOpt=config.integration||config.options&&config.options.integration||{};return integrationOpt.showInPopup===!0&&extensions.push(PopupExtension),extensions=extensions.concat(config.extensions||[]),_.forEach(extensions,function(extension){component.attach(extension,config)}),component.bus}}});
define('tau/services/service.navigator',["Underscore","jQuery","tau/core/class","tau/core/event"],function(_,$,Class,Event){var Service=Class.extend({init:function(configurator,options){this.hashService=configurator.getHashService(),this.options=_.defaults(options||{},{parameterName:null})},to:function(url){this.options.parameterName?this.hashService.setHashParam(this.options.parameterName,url):this.hashService.setHash(url)},back:function(){this.fire("back")},getCurrent:function(){return this.options.parameterName?this.hashService.getHashParam(this.options.parameterName):this.hashService.getHash()}});return Event.implementOn(Service.prototype),Service});
define('tau/core/model-base',["Underscore","tau/core/extension.base.stateful"],function(_,Class){var Model=Class.extend({isCommandForEntityInContext:function(command){var e=command.data,id=e.cmd?e.cmd.config.id:e.obj?e.obj.id:null;return id===this.config.context.entity.id},isPropertyChanged:function(propertyList,data){var changes=data.changes,$set=data.cmd&&data.cmd.config.$set||{};return _.any(propertyList,function(property){return changes&&changes.hasOwnProperty(property)||$set.hasOwnProperty(property)})},attachToChangePropertiesOfCurrentEntity:function(propertyField){var propertyList=_.isArray(propertyField)?propertyField:[propertyField],entityId=this.config.context.entity.id,self=this,afterSaveHandler=function(evtArgs){var data=evtArgs.data;self.isPropertyChanged(propertyList,data)&&self.fire("propertyChanged",data)},beforeSaveHandler=function(evtArgs){var data=evtArgs.data;self.isPropertyChanged(propertyList,data)&&self.fire("beforeChangeProperty",data)};self.store.unbind(self);var typeName=this.config.context.entity.entityType.name||"general";self.store.on({type:typeName,eventName:"afterSave",filter:{id:entityId},listener:self},afterSaveHandler),self.store.on({type:typeName,eventName:"beforeSave",filter:{id:entityId},listener:self},beforeSaveHandler),self.store.on({eventName:"failure",listener:self},function(res){var data=res.data;data.cmd.config.id==entityId&&self.isPropertyChanged(propertyList,data)&&self.fire("propertyChanged",data)}),propertyField[this.propertyName]=[this.displayField,this.valueField]},"bus evictData":function(){var ctxEntity=this.config.entity||this.config.context.entity,currentEntityId=ctxEntity.id;this.store.config.proxy.evictPersistedObject(currentEntityId,"context"),this.store.config.proxy.evictPersistedObject(currentEntityId,ctxEntity.type||ctxEntity.entityType.name)}});return Model});
define('tau/models/model.extension',["tau/core/model-base"],function(ModelBase){var ModelExtension=ModelBase.extend({onInit:function(){this.fire("registerStoreRequest"),this.fire("commitTransaction")}});return ModelExtension});
define('tau/models/extension.model.base',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"extension model base",floatToString:function(flt){return flt||(flt=0),flt.toFixed(2).replace(".00","")},destroy:function(){this._super(),this.destroy=function(){}}})});
define('tau/models/baseInfoList/extension.model.entityIdRetriever',["tau/models/extension.model.base"],function(ModelBase){var ModelListBase=ModelBase.extend({"bus registerStoreRequest":function(evt){var entity=this.config.context.entity||evt.data.entity||{entityType:{}},properties={};properties[this.config.propertyName]=["id"];var fields=[properties];this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:fields},callback:{success:this.onEntityRetrieved,scope:this}})},onEntityRetrieved:function(evtArgs){if(!this.config)return;var entities=evtArgs.data[this.config.propertyName];this.fire("entityIdsRetrieved",entities)}});return ModelListBase});
define('tau/models/baseInfoList/extension.model.additionalInfoEntityRetriever',["Underscore","tau/models/extension.model.base"],function(_,ModelBase){var ModelListBase=ModelBase.extend({"bus entityIdsRetrieved":function(evtArgs){var entities=evtArgs.data,requestCount=entities.length;for(var i=0;i<requestCount;i++){var query={id:entities[i].id,fields:["id","name",{entityState:["name"]}]};this.fire("extendGetEntityQuery",query),this.fire("get",{type:this.config.typeName,query:query})}this.fire("commitTransaction",{scope:this,success:this.onEntitiesRetrieved})},convertServerDataModelData:function(serverData){serverData=serverData;var urlBuilder=this.config.context.configurator.getUrlBuilder();return{__type:serverData.__type,id:serverData.id,name:serverData.name,state:{name:serverData.entityState.name},url:urlBuilder.getNewViewUrl(serverData.id,serverData.__type,!0)}},onEntitiesRetrieved:function(result){var data={entities:_.pluck(result,"data")};this.fire("filterEntities",data),result=data.entities;var entities=_.map(result,this.convertServerDataModelData,this);entities=_.compact(entities),this.fire("entitiesRetrieved",entities)}});return ModelListBase});
define('tau/models/model.list.baseInfo',["tau/core/model-base","tau/models/baseInfoList/extension.model.entityIdRetriever","tau/models/baseInfoList/extension.model.additionalInfoEntityRetriever"],function(ModelBase,EntityIdRetriever,EntityRetriever){var ModelListBase=ModelBase.extend({init:function(config){this._super.apply(this,arguments),this.propertyName=config.propertyName,this.typeName=config.typeName,new EntityIdRetriever(config),new EntityRetriever(config)},onInit:function(){if(this.config.disableModel)return;this.fire("registerStoreRequest",{entity:this.config.context.entity}),this.fire("commitTransaction",{entity:this.config.context.entity})},"bus entitiesRetrieved":function(evtArgs){var initData={items:evtArgs.data};this.bus.fire("dataBind",initData)},"bus evictProperty":function(){var assignable=this.config.context.entity;this.store.evictProperties(assignable.id,assignable.entityType.name,[this.propertyName])}});return ModelListBase});
define('tau/models/baseInfoList/extension.model.additionalInfoImpedimentFilter',["Underscore","tau/models/extension.model.base"],function(_,ModelBase){var ModelListBase=ModelBase.extend({"bus extendGetEntityQuery":function(evtArgs){var fields=evtArgs.data.fields,generalUser=["id"];fields=evtArgs.data.fields=_.uniq(_.union(fields,[{owner:generalUser},{responsible:generalUser},"isPrivate"])),_.each(fields,function(field){field.hasOwnProperty("entityState")&&(field.entityState=_.uniq(_.union(field.entityState,["isFinal"])))})},"bus filterEntities":function(evtArgs){var data=evtArgs.data;data.entities=_.select(data.entities,function(entity){if(entity.entityState.isFinal)return!1;if(!entity.isPrivate)return!0;var loggedUserId=this.config.context.getLoggedUser().id;return(entity.owner||{}).id==loggedUserId||(entity.responsible||{}).id==loggedUserId},this)}});return ModelListBase});
define('tau/models/model.impedimentsCountCalculator',["tau/models/model.list.baseInfo","tau/models/baseInfoList/extension.model.additionalInfoImpedimentFilter"],function(ModelBase,Filter){var ImpedimentCountCalculator=ModelBase.extend({init:function(config){config.propertyName="impediments",config.typeName="impediment",this._super.apply(this,arguments),new Filter(config)},"bus entitiesRetrieved":function(evtArgs){this.fire("impedimentsCountRetrieved",{count:evtArgs.data.length}),this.fire("impedimentsRetrieved",{items:evtArgs.data})},onGetEntity:function(result){var entity=result.data,impedimentsCount=entity["impediments-count"];this.fire("impedimentsCountRetrieved",{count:impedimentsCount})}});return ImpedimentCountCalculator});
define('tau/models/model.duplicateBugList',["Underscore","tau/core/model-base"],function(_,ModelBase){var entityListModel=ModelBase.extend({_retrieveEntity:function(){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,cmdSettings={id:entityId,fields:["id"]};this.store.get(entityTypeName,cmdSettings,{scope:this,success:this.onEntityRetrieved}).done()},convertServerDataModelData:function(serverData){return{__type:serverData.__type,id:serverData.id,name:serverData.name,state:{name:serverData.entityState.name},url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(serverData.id,serverData.__type,!0)}},onEntityRetrieved:function(entity){this.fire("registerStoreRequest"),this.fire("commitTransaction")},"bus duplicateBugRetrieved":function(evtArgs){var result=evtArgs.data.items,entities=_.map(result,this.convertServerDataModelData,this);entities=_.compact(entities);var initData={items:entities};this.bus.fire("dataBind",initData)},onInit:function(){if(this.config.disableModel)return;this._retrieveEntity()}});return entityListModel});
define('tau/models/model.duplicateBugCountCalculator',["tau/models/model.duplicateBugList"],function(ModelBase){var ImpedimentCountCalculator=ModelBase.extend({"bus duplicateBugRetrieved":function(evtArgs){var result=evtArgs.data.items;this.fire("duplicateBugCountRetrieved",{count:result.length})}});return ImpedimentCountCalculator});
define('tau/models/model.duplicateBugRetriever',["Underscore","tau/core/model-base"],function(_,ModelBase){var entityListModel=ModelBase.extend({init:function(){this._super.apply(this,arguments)},convertServerDataModelData:function(serverData){return{__type:serverData.__type,id:serverData.id,name:serverData.name,state:{name:serverData.entityState.name}}},"bus registerStoreRequest":function(){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,cmdSettings={fields:["id","name",{entityState:["name"]}],$query:{tags:{$contains:"duplicateOf#"+entityId}}};this.fire("find",{type:entityTypeName,query:cmdSettings,callback:{scope:this,success:this.onDuplicateBugsRetrieved}})},onDuplicateBugsRetrieved:function(result){var items=_.sortBy(result.data,function(item){return item.id}),initData={items:items};this.fire("duplicateBugRetrieved",initData)}});return entityListModel});
define('tau/components/extensions/impedimentList/extension.impedimentList.visibilityController',["jQuery","tau/components/extensions/component.extension.base"],function(jQuery,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evtArgs){evtArgs.data.element.hide()},"bus componentsCreated+impedimentsCountRetrieved":function(evt){var count=evt.impedimentsCountRetrieved.data.count,components=evt.componentsCreated.data,component=components[0].component;component.fire("sendEventToComponents",{name:"setBadgeText",data:{text:count}})},"bus componentsCreated+impedimentsRetrieved":function(evt){var items=evt.impedimentsRetrieved.data.items,components=evt.componentsCreated.data,component=components[1].component;if(component.name=="impedimentListPanel inner")return;component.fire("dataBind",{items:items})},"bus afterRender+impedimentsCountRetrieved":function(evtArgs){if(evtArgs.impedimentsCountRetrieved.data.count>0){var element=evtArgs.afterRender.data.element;this.config.disableAnimation?element.show():element.slideDown("slow")}}})});
define('tau/components/extensions/duplicateBugList/extension.duplicateBugList.visibilityController',["jQuery","tau/components/extensions/component.extension.base"],function(jQuery,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evtArgs){evtArgs.data.element.hide()},"bus componentsCreated+duplicateBugCountRetrieved":function(evt){var count=evt.duplicateBugCountRetrieved.data.count,components=evt.componentsCreated.data,component=components[0].component;component.fire("sendEventToComponents",{name:"setBadgeText",data:{text:count}})},"bus componentsCreated+duplicateBugRetrieved":function(evt){var items=evt.duplicateBugRetrieved.data.items,components=evt.componentsCreated.data,component=components[1].component;if(component.name=="duplicateBugListPanel inner")return;component.fire("duplicateBugRetrieved",{items:items})},"bus afterRender+duplicateBugCountRetrieved":function(evtArgs){if(evtArgs.duplicateBugCountRetrieved.data.count>0){var element=evtArgs.afterRender.data.element;this.config.disableAnimation?element.show():element.slideDown("slow")}}})});
define('tau/models/assignmentsList/extension.model.store.operations',["Underscore","tau/core/model-base","tau/core/event"],function(_,ModelBase){var baseModel=ModelBase.extend({category:"store operations","bus commitTransaction":function(evtArgs){var transaction=this.transaction||this.store;delete this.transaction,transaction.done(evtArgs.data)},"bus get":function(evtArgs){var transaction=this.transaction=this.transaction||this.store,data=evtArgs.data||{};this.transaction=transaction.get(data.type,data.query,data.callback)},"bus find":function(evtArgs){var transaction=this.transaction=this.transaction||this.store,data=evtArgs.data||{};this.transaction=transaction.find(data.type,data.query,data.callback)},destroy:function(){this._super.apply(this,arguments),this.destroy=function(){}}});return baseModel});
define('tau/configurations/converters/converter.print',["Underscore","tau/models/model.extension","tau/models/model.impedimentsCountCalculator","tau/models/model.duplicateBugCountCalculator","tau/models/model.duplicateBugRetriever","tau/components/extensions/impedimentList/extension.impedimentList.visibilityController","tau/components/extensions/duplicateBugList/extension.duplicateBugList.visibilityController","tau/models/assignmentsList/extension.model.store.operations","tau/core/termProcessor"],function(_,ModelBase,ImpedimentsCountCalculator,DuplicateBugCountCalculator,DuplicateBugRetriever,VisibilityController,DuplicateBugVisibilityController,StoreOperations,TermProcessor){var actions={impedimentListPanel:function(item,context){var tp=new TermProcessor(context.getTerms());return _.extend(item,{compId:"impediments",type:"container",layout:"list",cssClass:"b-section",disableAnimation:!0,children:[{type:"label",text:tp.getTerms("Impediment").names,hideCounter:!0},{type:"impedimentList",disableModel:!0}],extensions:[VisibilityController,ImpedimentsCountCalculator,StoreOperations]}),item},duplicateBugListPanel:function(item,context){var tp=new TermProcessor(context.getTerms());return _.extend(item,{compId:"duplicateBugs",type:"container",layout:"list",cssClass:"b-section",disableAnimation:!0,children:[{type:"label",text:"Duplicate "+tp.getTerms("Bug").names,hideCounter:!0},{type:"duplicateBugList",disableModel:!0}],extensions:[DuplicateBugVisibilityController,DuplicateBugRetriever,DuplicateBugCountCalculator,StoreOperations]}),item},tabs:function(item){item=_.extend(item,{type:"container",children:[],cssClass:"b-tabs"});var children=[];return _.forEach(item.tabs,function(tab,key){var isSource=!1;tab=_.extend(tab,{type:"container",children:tab.items,cssClass:"b-tab"}),isSource=!_.isUndefined(tab.children)&&tab.children.length&&tab.children[0].type==="revisionList";if(isSource)return;!_.isUndefined(tab.header)&&tab.header.length&&tab.children.unshift({type:"label",text:tab.header[0].text}),item.children.push(tab)}),item},collapsible:function(item){return item=_.extend(item,{type:"container",children:[],cssClass:"b-section"}),item.children=item.items,!_.isUndefined(item.header)&&item.header.length&&item.children.unshift({type:"label",text:item.header[0].text}),item}},liveEach=function(target,iterator){var fnCut=null;if(_.isArray(target)){var i=0;fnCut=function(key){target.splice(key,1),i--};for(i=0;i<target.length;i++)iterator(target[i],i,fnCut)}else{fnCut=function(key){delete target[key]};var targetKeys=_(target).keys(),iterationKey=null;while(iterationKey=targetKeys.pop())iterator(target[iterationKey],iterationKey,fnCut)}},convertConfig=function(config,context){return liveEach(config,function(item,key,fnCut){if(item.type){if(item.printable===!1){fnCut(key);return}_.isFunction(actions[item.type])&&(config[key]=actions[item.type](item,context)),item.children&&(config[key].children=convertConfig(item.children,context)),item.items&&(config[key].items=convertConfig(item.items,context)),config[key].disabledExtensionCategories=["edit"]}else key=="children"&&(config[key]=convertConfig(item,context))}),config};return{convert:function(config){return config=convertConfig(config,config.context),config.children&&config.children.length&&(config.children[0].cssClass="main-container main-container-print i-print"),config}}});
define('tau/ui/extensions/page/ui.extension.page.print',["tau/core/extension.base","tau/configurations/converters/converter.print"],function(ExtensionBase,converter){return ExtensionBase.extend({"bus onConfigContainerCreated":function(evt){var config=evt.data;converter.convert(config),config.children.push({type:"print"})},"bus afterRender":function(e){var $el=e.data.element,$links=$el.find("a");$links.removeAttr("href"),$el.find("[role=attachment]").removeAttr("role"),$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!0),$("body").addClass("print-mode")}})});
define('tau/components/component.application',["tau/components/component.application.generic","tau/services/service.navigator","tau/ui/extensions/page/ui.extension.page.print"],function(ApplicationComponent,ServiceNavigator,ExtensionPrint){return{create:function(componentConfig){var configurator=componentConfig.context.configurator;return configurator.registerService("navigator",new ServiceNavigator(configurator,{parameterName:componentConfig.options.applicationId||null})),componentConfig.routes=[{pattern:/^$/,adapter:function(){var url=this.configurator.getRouting().getReferer();url?this.configurator.service("navigator").to(url):this.fire("application.exit")},host:{name:"empty_host",type:"master.empty"},type:{name:"entity_page",type:"page.entity"}},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,adapter:function(entityType,entityId){this.resolve({entity:{id:parseInt(entityId,10),type:entityType},action:"show"})},host:{name:"empty_host",type:"master.empty"},type:{name:"entity_page",type:"page.entity"}},{pattern:/(\w+)\/([0-9]+)\/print/,adapter:function(entityType,entityId,action){this.resolve({entity:{id:parseInt(entityId,10),type:entityType},action:"print"})},host:{name:"empty_host",type:"master.empty"},type:{name:"entity_page",type:"page.entity",hostClassName:"tau-page-entity",extensions:[ExtensionPrint]}},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,adapter:function(entityType,entityId,action){this.resolve({entity:{id:parseInt(entityId,10),type:entityType},action:action})},host:{name:"empty_host",type:"master.empty"},type:{name:"entity_page",type:"page.entity",hostClassName:"tau-page-entity"}}],ApplicationComponent.create(componentConfig)}}});
define('tau/components/extensions/application/extension.history',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(evt,configurator){this.setHandler(configurator)},"bus configurator.ready:last + application.exit + application.navigate.entity":function(evt,configurator){this.setHandler(configurator)},"bus configurator.ready:last + history.reset":function(e,configurator){configurator.getHistory().reset()},"bus configurator.ready:last + controller.preExecute":function(e,configurator){configurator.getHistory().process()},"bus configurator.ready:last + application.exit":function(evt,configurator){this.clear(configurator)},"bus configurator.ready:last + destroy":function(evt,configurator){this.clear(configurator)},setHandler:function(configurator){var _handler=_.bind(function(e){var current=configurator.getHistory().getCurrent();current&&current.title&&configurator.getTitleManager().set(current.title)},this);configurator.getHistory().on("setCurrent",_handler,this)},clear:function(configurator){configurator.getTitleManager().restoreDefault();var history=configurator.getHistory();history.reset(),history.removeAllListeners(this)}})});
define('tau/components/extensions/application/extension.routing',["Underscore","jQuery","tau/core/event.emitter"],function(_,$,EventEmitter){return EventEmitter.extend({init:function(config){var self=this;this._super(config),this.config=config,this.routingPatterns=[],this.routingPattern404={callback:$.noop};var configurator=this.config.context.configurator,external=configurator.getExternal();this.defaultHash=external.getHash(),self.config.startUrl&&external.setHash(self.config.startUrl)},normalizeUrl:function(){var self=this,appId=self.config.applicationId,pageType=self.config.pageType,pageId=self.config.pageId;if(appId&&pageType&&pageId){var external=self.config.context.configurator.getExternal(),appValue=pageType+"/"+pageId;external.setHashParam(appId,appValue),self.onCleanAppId=function(){var appValue=external.getHashParam(appId,null);appValue||self.fire("destroy")},external.onHashChange(self.onCleanAppId)}},matchPatterns:function(patterns,notFound){var self=this,appId=self.config.applicationId,configurator=self.config.context.configurator,external=configurator.getExternal(),currentValue=null,onHashChangeHandler=function(r){var hashValue=null;appId?hashValue=external.getHashParam(appId):hashValue=external.getHash().split("&")[0];if(currentValue===hashValue)return;currentValue=hashValue;var index=-1,matchedRegexp=null;_(patterns).find(function(p,i){matchedRegexp=_.isString(p.pattern)?new RegExp(p.pattern):p.pattern;var pass=matchedRegexp.test(hashValue);return pass&&(index=i),pass});if(index!==-1){var item=patterns[index],r=matchedRegexp.exec(hashValue),args=r.slice(1);item.callback.apply(self,args)}else notFound.callback.call(self)};this.config.options.routing.silent||external.onHashChange(onHashChangeHandler);var disposer=function(){external.unbindHashChange(onHashChangeHandler)};return disposer},"bus registerRoute":function(evt){this.routingPatterns.push(evt.data)},"bus registerRouteNotFound":function(evt){this.routingPattern404=evt.data},"bus afterInit":function(){this.normalizeUrl(),this.fire("routing.registered",{})},"bus options.ready:last+controller.ready":function(evt,options){var self=this,patterns=self.routingPatterns,pattern404=self.routingPattern404;self.matchDispose=self.matchPatterns(patterns,pattern404),options.routing.executeOnStart&&self.config.context.configurator.getExternal().triggerHashChange()},destroy:function(){this._super(),this.matchDispose(),delete this.matchDispose;var cfg=this.config;if(cfg.applicationId){var external=cfg.context.configurator.getExternal();external.unbindHashChange(this.onCleanAppId),delete this.onCleanAppId,external.setHashParam(cfg.applicationId,null)}!cfg.applicationId&&cfg.integration&&cfg.integration.showInPopup&&cfg.context.configurator.getExternal().setHash(this.defaultHash),delete this.config,delete this.defaultHash}})});
define('tau/components/extensions/application/extension.routing.patterns',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){var fnNoop=function(){};return ExtensionBase.extend({init:function(config){this._super(config),this.config=config},registerPatterns:function(patterns){var self=this;_.each(patterns,function(p){self.fire("registerRoute",p)})},registerNotFoundPattern:function(pattern404){this.fire("registerRouteNotFound",pattern404)},"bus routing.registered":function(eventData){var self=this,configurator=self.config.context.configurator,execute=_.bind(self.execute,self);self.registerPatterns([{pattern:/board\/current/,callback:function(){execute("board",{id:null,entity:"board",action:"current"})}},{pattern:/board\/([\w|0-9]+)/,callback:function(boardId){execute("board",{id:boardId,entity:"board"})}},{pattern:/^$/,callback:function(req){execute("entity",{})}},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,callback:function(entityType,entityId,tail){execute("entity",{entity:entityType,id:parseInt(entityId),action:"show"})}},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,callback:function(entityType,entityId,action){execute("entity",{entity:entityType,id:parseInt(entityId),action:action})}}]),self.registerNotFoundPattern({callback:function(){self.fire("error",{message:"URL is not found"})}}),self.fire("dataBind",{})},execute:function(moduleType,params){var self=this,configurator=self.config.context.configurator;if(!params.id&&!params.entity){var routing=configurator.getRouting(),referrer=routing.getReferer(),url=referrer?referrer.url:null;url&&url!=="#"?routing.redirect("#"+url):self.fire("application.exit");return}var currentCash=configurator.getExternal().getHash();configurator.getRouting().setReferer({url:currentCash}),self.fire("application.navigate."+moduleType,params)},destroyOnCriticalError:function(){this.fire("destroy")},"bus application.error":function(e){this.config.destroyOnError===!0&&this.destroyOnCriticalError()},"bus afterRender":function(e){this.fire("controller.ready")},"bus contentRendered":function(e){this.destroyOnCriticalError=fnNoop},destroy:function(){var self=this;delete self.config,this._super()}})});
define('tau/components/extensions/application/extension.integration',["Underscore","jQuery","tau/core/extension.base","tau/configurator"],function(_,$,Class,configurator){return Class.extend({init:function(config){this.config=config,this.config.integration=this.config.integration||{},this.bus=config.bus,this.globalBus=this.bus.getGlobalBus(),this.criticalChanged=!1,this.window=configurator.getWindow(),this.redirect=configurator.getRedirect()},"bus afterRender":function(){$("body").delegate("a[href=#]","click",function(e){e.preventDefault()});var reloadCallback=this.config.integration.reloadCallback,isPopup=!!reloadCallback;isPopup?$("html").addClass("tau-html_integration_popup"):$("html").addClass("tau-html_integration_main")},"bus initProgress":function(e){this.config.integration.progress&&this.config.integration.progress.show("Reloading...")},"bus application.error":function(e){this.config.integration.progress&&this.config.integration.progress.hide()},"globalBus showProgress":function(e){this.config.integration.progress&&this.config.integration.progress.show(e.data.text)},"globalBus hideProgress":function(e){this.config.integration.progress&&this.config.integration.progress.hide()},"bus destroy":function(){configurator.getGlobalBus().removeAllListeners(this),this.window._criticalTauChanges&&(this.bus.fire("initProgress"),this.redirect.reload()),$("body .jquery-notify-bar").remove()},"bus integration.react":function(e){var reloadCallback=this.config.integration.reloadCallback;if(!!reloadCallback==0)return;reloadCallback(e)}})});
define('tau/components/extensions/application/extension.navigation',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(evt,configurator){var self=this;configurator.getRouter().on("urlToNavigate.ready",function(evt,url){self.fire("urlToNavigate.ready",url)})},"bus options.ready + afterRender + view.dom.ready":function(e,options,renderData){if(!options.routing.silent)return;var self=this,$el=renderData.element;$el.parent().delegate("a","click",function(e){if(e.ctrlKey||e.metaKey)return;var href=$(e.currentTarget).attr("href")||"";if(href==="#")return;href.charAt(0)==="#"&&(e.preventDefault(),e.stopPropagation(),self.fire("urlToNavigate.ready",href))})},"bus options.ready:last + configurator.ready:last + urlToNavigate.ready":function(evt,options,configurator,url){var router=configurator.getRouter(),external=configurator.getExternal();url.charAt(0)==="#"&&(url=url.substring(1));if(options.routing.silent){var nv=url.split("/"),entityParams={id:nv[1],entity:nv[0],action:nv[2]};router.fire("changed",entityParams),this.fire("application.navigate.entity",entityParams)}else external.setHash(url)}})});
define('tau/configurations/converters/converter.context',["Underscore"],function(_){var isMatch=function(itemData,configData){var excluded=[],included=[];_.forEach(itemData,function(conf){conf[0]=="~"?excluded.push(conf.slice(1)):included.push(conf)});var hasIncluded=!0;included.length&&(hasIncluded=_.intersect(configData,included).length>0);var hasExcluded=!1;return excluded.length&&(hasExcluded=_.intersect(configData,excluded).length>0),hasIncluded&&!hasExcluded},convertConfig=function(config,practices,editions){return _.forEach(config,function(item,key){if(item.type=="tabs")_.forEach(item.tabs,function(tab,tabKey){tab.header=convertConfig(tab.header,practices,editions),item.tabs[tabKey].items=convertConfig(tab.items,practices,editions),item.tabs[tabKey].items.length==0&&(item.tabs[tabKey]=!1)}),item.tabs=_.filter(item.tabs,function(item,key){return item!==!1}),item.additionalHeaders=convertConfig(item.additionalHeaders,practices,editions),item.tabs.length==0&&(config[key]=!1);else if(item.type=="additionalInfo")item.children=convertConfig(item.children,practices,editions),item.children.length==0&&(config[key]=!1);else if(item.type=="label"&&_.isArray(item.text))item.text=convertConfig(item.text,practices,editions),item.text.length==0?config[key]=!1:config[key]=item;else if(item.practices||item.editions){var matchPractices=item.practices&&item.practices.length&&!isMatch(item.practices,practices),matchEditions=item.editions&&item.editions.length&&!isMatch(item.editions,editions);if(matchPractices||matchEditions)config[key]=!1}else if(item.children)config[key].children=convertConfig(item.children,practices,editions);else if(typeof item.items!="undefined")config[key].items=convertConfig(item.items,practices,editions),item.items.length==0&&(config[key]=!1);else if(key=="children"||key=="items")config[key]=convertConfig(item,practices,editions)}),config=_.filter(config,function(item,key){return item!==!1}),config};return{convert:function(config,practices,editions){return config=convertConfig(config,practices,editions),config}}});
define('tau/ui/extensions/page/ui.extension.page.configConvertor',["Underscore","tau/core/extension.base","tau/configurations/converters/converter.context"],function(_,ExtensionBase,converter){return ExtensionBase.extend({"bus before_onConfigContainerCreated":function(evt){var practices=[],editions=[];if(evt.data.context){var context=evt.data.context,self=this;_.each(context.getPractices(),function(el){practices.push(el.name)}),editions=context.getEdition()}var config=evt.data;config=converter.convert(config,practices,editions)}})});
define('tau/components/extensions/storeFreeze.extension',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus onConfigContainerCreated":function(evt){this.config&&this.config.store&&(this.promise=this.config.store.freeze())},"bus afterInit":function(evt){if(!this.promise)return;this.promise.unfreeze(),delete this.promise}})});
define('tau/components/extensions/extension.storeErrorEmiter',["Underscore","tau/components/extensions/component.extension.base"],function(_,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var store=this.config.store,self=this;store.unbind(this),store.on({eventName:"failure",listener:self},function(evt){if(evt.data.cmd.config.failureGlobal!==!1){if(initConfig&&initConfig.config&&initConfig.config.context.entity){var entity=initConfig.config.context.entity;store.evictPersistedObject(entity.id,entity.type)}self.onFailure.apply(self,arguments)}})},onFailure:function(ev){var message="Looks like application is not available. Please check your connection or server availability";if(ev.data&&ev.data.data){ev.data.data.Message&&(message=ev.data.data.Message);var response=ev.data.data.response;if(response){response.Message&&(message=response.Message);if(_.isArray(response)){var parts=[response[1]];_.isArray(response[4])&&response[4].length>0&&response[4][0]!=parts[0]&&parts.push(response[4][0]),message=parts.join(":&nbsp;")}response.Error&&response.Error.Message&&(message=response.Error.Message)}}var status=0;ev.data&&ev.data.data&&(status=ev.data.data.status||0),status===500&&window.appIsInDebugMode===!1&&(message="Looks like application is not available. Please check your connection or server availability"),this.fire("error",{message:message}),(status>=400||status===0)&&this.fire("globalFailure");if(ev.data&&ev.data.cmd){var commandName=ev.data.cmd.name;!_.include(["get","find"],commandName)||status===0&&this.fire("destroy")}},destroy:function(){this.config.store.unbind(this),this._super()}})});
define('tau/ui/extensions/ui.extension.loading',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({init:function(config){this._super(config)},"bus beforeInit":function(){var $body=$("body");$body.tauProgressIndicator(),this.fire("$progressIndicator.ready",$body),this.fire("showLoading","reaction on beforeInit")},"bus $progressIndicator.ready:last + showLoading":function(evt,$indicator){$indicator.tauProgressIndicator("show")},"bus $progressIndicator.ready:last + hideLoading":function(evt,$indicator){$indicator.tauProgressIndicator("hide")},"bus beforeInit+afterRender+showLoading":function(evt){this.fire("hideLoading","hide on after render")},"bus globalFailure":function(){this.fire("hideLoading","hide on global failure")},"bus afterRender+globalFailure":function(evt){var $element=evt.afterRender.data.element;$element.show()},"bus $progressIndicator.ready:last + destroy":function(evt,$indicator){$indicator.tauProgressIndicator("hide")}})});
define('tau/components/component.page.base',["Underscore","tau/components/component.creator","tau/ui/extensions/page/ui.extension.page.configConvertor","tau/components/extensions/storeFreeze.extension","tau/components/extensions/extension.storeErrorEmiter","tau/components/extensions/error/extension.errorBar","tau/ui/extensions/ui.extension.loading"],function(_,creator,ExtensionConfigConvertor,StoreFreezeExtension,StoreErrorExtension,ErrorBarExtension,LoadingExtension){return{create:function(componentConfig,ctx){var extensions=[StoreFreezeExtension,ExtensionConfigConvertor,ErrorBarExtension];componentConfig.turnOffLoadingIndicator!==!0&&extensions.push(LoadingExtension),componentConfig.turnOffErrorEmiter!==!0&&extensions.push(StoreErrorExtension),extensions=_.union(extensions,componentConfig.extensions);var creatorConfig={name:componentConfig.name,ModelType:componentConfig.ModelType,ViewType:componentConfig.ViewType,extensions:extensions,queuedBus:componentConfig.queuedBus};return ctx.queuedBus=creatorConfig.queuedBus,creator.create(creatorConfig,ctx)}}});
define('tau/components/component.container',["Underscore","tau/components/component.creator","tau/views/view.container","tau/components/extensions/component.creator.extension","tau/ui/extensions/layout/ui.extension.layout","tau/ui/extensions/spinner/ui.extension.spinner"],function(_,Creator,ViewType,ComponentCreatorExtension,LayoutExtension,SpinnerExtension){return{create:function(config){var creatorConfig={extensions:_.concat([config.extensions,ComponentCreatorExtension,LayoutExtension,SpinnerExtension]),ViewType:config.ViewType||ViewType};return Creator.create(creatorConfig,config)}}});
define('tau/models/model.extensions',["Underscore"],function(_){var _calculateCounts=function(fields,callbackInfo){var self=this,ctx=self.config.context,type=ctx.entity.entityType.name,copyFields=[];for(var i=0;i<fields.length;i++)copyFields.push(fields[i]);var cmdSettings={id:ctx.entity.id,fields:fields},proc={innerCallback:function(evtData){var data=evtData.data,totalCount=0;for(var i=0;i<copyFields.length;i++)totalCount+=data[copyFields[i]];callbackInfo.callback.call(callbackInfo.scope,{count:totalCount})}};self.store.get(type,cmdSettings,{success:proc.innerCallback,scope:proc}).done()};return{calculateTagsCount:function(callbackInfo){_calculateCounts.call(this,["tags-count"],callbackInfo)},calculateBugsAndTasksCount:function(callbackInfo){var fields=[];this.config.context.isPracticeAvailable("Planning")&&fields.push("tasks-count"),this.config.context.isPracticeAvailable("Bug Tracking")&&fields.push("bugs-count"),_calculateCounts.call(this,fields,callbackInfo)},calculateTasksCount:function(callbackInfo){_calculateCounts.call(this,["tasks-count"],callbackInfo)},calculateBugsCount:function(callbackInfo){_calculateCounts.call(this,["bugs-count"],callbackInfo)},calculateUserStoriesAndBugsCount:function(callbackInfo){var fields=[];fields.push("userStories-count"),this.config.context.isPracticeAvailable("Bug Tracking")&&fields.push("bugs-count"),_calculateCounts.call(this,fields,callbackInfo)},calculateIterationsCount:function(callbackInfo){_calculateCounts.call(this,["iterations-count"],callbackInfo)},calculateReleasesCount:function(callbackInfo){_calculateCounts.call(this,["releases-count"],callbackInfo)},calculateFeaturesCount:function(callbackInfo){_calculateCounts.call(this,["features-count"],callbackInfo)},calculateRequestsCount:function(callbackInfo){_calculateCounts.call(this,["requests-count"],callbackInfo)},calculateImpedimentsCount:function(callbackInfo){_calculateCounts.call(this,["impediments-count"],callbackInfo)},calculateTimesCount:function(callbackInfo){_calculateCounts.call(this,["times-count"],callbackInfo)},calculateAttachmentsCount:function(callbackInfo){_calculateCounts.call(this,["attachments-count"],callbackInfo)},calculateCommentsCount:function(callbackInfo){_calculateCounts.call(this,["comments-count"],callbackInfo)},calculateTesCasesCount:function(callbackInfo){_calculateCounts.call(this,["testCases-count"],callbackInfo)},calculateTestPlanRunsCount:function(callbackInfo){_calculateCounts.call(this,["testPlanRuns-count"],callbackInfo)},calculateUserStoriesCount:function(callbackInfo){_calculateCounts.call(this,["userStories-count"],callbackInfo)},calculateTestCaseRunsCount:function(callbackInfo){_calculateCounts.call(this,["testCaseRuns-count"],callbackInfo)},calculateRelatedEntitiesCount:function(callbackInfo){_calculateCounts.call(this,["relatedEntities-count"],callbackInfo)},calculateRequestersCount:function(callbackInfo){_calculateCounts.call(this,["requesters-count"],callbackInfo)}}});
define('tau/components/extensions/comments/extensions.comments.refresher',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({init:function(){this._super.apply(this,arguments),this.bus.getGlobalBus().on("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this)},destroy:function(){this.bus.getGlobalBus().removeListener("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this),this._super.apply(this,arguments)},refresh:function(){var assignable=this.config.context.entity;this.config.store.evictProperties(assignable.id,assignable.entityType.name,["comments"]),this.fire("refresh")},onBugWasMarkedAsDuplicate:function(evt){var entityId=this.config.context.entity.id;(entityId===evt.data.bugId||entityId===evt.data.duplicateBugId)&&this.refresh()}})});
define('tau/configurations/base.container.config',["Underscore","tau/core/class","tau/core/termProcessor","tau/components/extensions/comments/extensions.comments.refresher"],function(_,Class,TermProcessor,CommentRefresher){var Config=Class.extend({init:function(appConfig){var terms=appConfig.context.getTerms();this.termProcessor=new TermProcessor(terms),this.configurator=appConfig.context.configurator;var urlBuilder=this.configurator.getUrlBuilder();this.collections={};var entity=appConfig.context.entity;this.registerAction("Old View",{label:"Old View",url:urlBuilder.getViewUrl(entity.id)}),this.registerAction("Old Edit",{label:"Old Edit",url:urlBuilder.getEditUrl(entity.id,entity.entityType.name)}),this.registerAction("Print",{label:"Print View",command:function(menuComponent){menuComponent.redirectTo(urlBuilder.getPrintUrlRelative(entity.id,entity.entityType.name),"_blank")}}),this.registerAction("-----","-----"),this.registerAction("Delete",{label:"Delete",confirmation:"Are you sure?",command:function(menuComponent){menuComponent.removeEntity()},className:"ui-menu__item-action-delete ui-menu__item-dont-close"}),this.registerAction("Move or Copy",{label:"Move or Copy",command:function(menuComponent){menuComponent.moveOrCopy()},editions:["~board"]}),this.registerAction("Convert",{label:"Convert to&hellip;",roleAction:"convert",className:"ui-menu__item__parent",editions:["~innerList"]}),this.registerAction("Attach to Request",{label:"Attach To "+this.getTermName("Request"),command:function(menuComponent){menuComponent.attachToRequest()},editions:["Pro","~board"]}),this.registerAction("Add Impediment",{label:"Add "+this.getTermName("Impediment"),url:urlBuilder.getAddImpedimentUrl(entity.id)}),this.registerAdditionalInfoItem("Owner",{label:{type:"label",text:"Owner"},field:{type:"property.owner"}}),this.registerAdditionalInfoItem("Assigned Effort",{label:{type:"label",text:"Assigned Effort"},field:{type:"assignedEffort"}}),this.registerAdditionalInfoItem("Release Assigned Effort",{label:{type:"label",text:"Assigned Effort"},field:{type:"release.assignedEffort"}}),this.registerAdditionalInfoItem("Velocity",{label:{type:"label",text:"Velocity"},field:{type:"property.velocity"}}),this.registerAdditionalInfoItem("CycleTime",{label:{type:"label",text:"Cycle Time"},field:{type:"property.timeInterval",timeField:"cycleTime"}}),this.registerAdditionalInfoItem("LeadTime",{label:{type:"label",text:"Lead Time"},field:{type:"property.timeInterval",timeField:"leadTime"}}),this.registerAdditionalInfoItem("State",{label:{type:"label",text:"State"},field:{type:"property.entityState"}}),this.registerAdditionalInfoItem("Test Plan",{label:{type:"label",text:this.getTermName("TestPlan")},field:{type:"property.testPlan"}}),this.registerAdditionalInfoItem("Responsible",{label:{type:"label",text:"Responsible"},field:{type:"property.responsible"}}),this.registerAdditionalInfoItem("IsPrivate",{label:{type:"label",text:"Private?"},field:{type:"property.isPrivate"}}),this.registerAdditionalInfoItem("LastFailureComment",{label:{type:"label",text:"Last Failure Comment"},field:{type:"property.lastFailureComment"}}),appConfig.context.getProject()&&(this.registerAdditionalInfoItem("Release",{label:{type:"label",text:this.getTermName("Release")},field:{type:"property.release"},practices:["Planning"]}),this.registerAdditionalInfoItem("Iteration",{label:{type:"label",text:this.getTermName("Iteration")},field:{type:"property.iteration"},practices:["Iterations"]}),this.registerAdditionalInfoItem("Build",{label:{type:"label",text:this.getTermName("build")},field:{type:"property.build"}})),this.registerAdditionalInfoItem("ImpedimentDate",{label:{type:"label",text:"Creation Date"},field:{type:"property.impedimentDate"}}),this.registerAdditionalInfoItem("CreationDate",{label:{type:"label",text:"Creation Date"},field:{type:"property.createDate"}}),this.registerAdditionalInfoItem("FinishDate",{label:{type:"label",text:"Finish  Date"},field:{type:"property.completeDate",editable:!0}}),this.registerAdditionalInfoItem("StartDate",{label:{type:"label",text:"Start Date"},field:{type:"property.startDate",editable:!0}}),this.registerAdditionalInfoItem("ResolvedOn",{label:{type:"label",text:"Resolved On"},field:{type:"property.completeDate"}}),this.registerAdditionalInfoItem("CompletionDate",{label:{type:"label",text:"Completion  Date"},field:{type:"property.completeDate"}}),this.registerAdditionalInfoItem("Project",{label:{type:"label",text:this.getTermName("Project")},field:{type:"property.project"}}),this.registerAdditionalInfoItem("Priority",{label:{type:"label",text:this.getTermName("Priority")},field:{type:"property.priority"},practices:["Planning"]}),this.registerAdditionalInfoItem("Business Value",{label:{type:"label",text:"Business Value"},field:{type:"property.priority"},practices:["Planning"]}),this.registerAdditionalInfoItem("Initial Estimate",{label:{type:"label",text:"Initial Estimate"},field:{type:"property.initialEstimate"},practices:["Planning"]}),this.registerAdditionalInfoItem("Feature",{label:{type:"label",text:this.getTermName("Feature")},field:{type:"property.feature"},practices:["Requirements"]}),this.registerAdditionalInfoItem("Team",{label:{type:"label",text:"Team"},field:{type:"property.team"},editions:["hasTeams"]}),this.registerAdditionalInfoItem("Team Iteration",{label:{type:"label",text:"Team Iteration"},field:{type:"property.teamIteration"},editions:["hasTeams"]}),this.registerAdditionalInfoItem("User Story",{label:{type:"label",text:this.getTermName("userStory")},field:{type:"property.userStory"}}),this.registerAdditionalInfoItem("Assignable",{label:{type:"label",text:this.getTermName("Assignable")},field:{type:"property.assignable"}}),this.registerAdditionalInfoItem("Last Status",{label:{type:"label",text:"Last Status"},field:{type:"property.lastStatus"}}),this.registerAdditionalInfoItem("Last Run Date",{label:{type:"label",text:"Last Run Date"},field:{type:"property.lastRunDate"}}),this.registerAdditionalInfoItem("User Story For Task",{label:{type:"label",text:this.getTermName("userStory")},field:{type:"property.userStory",resetDisabled:!0}}),this.registerAdditionalInfoItem("Severity",{label:{type:"label",text:this.getTermName("Severity")},field:{type:"property.severity"},practices:["Planning"]}),this.registerTab("Description",{selected:!0,label:"description",header:[{type:"label",text:"Description"}],items:[{type:"tagsEditor",layout:"selectable",children:[{type:"tags",selector:".i-role-tagslistcontainer"},{type:"container",name:"tagsCloud.container",selector:".i-role-tagscloudcontainer",visible:!1,children:[{type:"tagsCloud"}]}]},{type:"container",name:"description container",cssClass:"ui-sub-control",children:[{type:"description"}]},this._buildRichTextCustomFieldsSummary(appConfig),{type:"attachments"},{type:"label",text:"Comments",cssClass:"ui-ctrl-title"},{type:"container",name:"comments container",cssClass:"ui-sub-control",children:[{type:"comments",extensions:[CommentRefresher]}]}]}),this.registerTab("Track",{label:"track",header:[{type:"label",text:"Track"}],items:[{type:"auditHistory",stateName:"audit",editions:["~board"]}],printable:!1}),this.registerTab("Flow",{label:"implementationHistory",printable:!1,header:[{type:"label",text:"Flow"}],items:[{type:"implementationHistory"}]}),this.registerTab("Relations",{label:"relations",printable:!1,header:[{type:"label",text:"Relations",countFieldNames:["masterRelations","slaveRelations"]}],items:[{name:"relations container",type:"relations.container"}]}),this.registerPanel("Additional Info",{type:"collapsible",name:"additional info container",collapsed:!1,stateName:"additionalInfo",header:[{type:"label",text:"Info"}],items:[{type:"additionalInfo",children:this.getAdditionalInfoItems(appConfig)}]}),this.registerPanel("Lead Cycle Time",{type:"collapsible",name:"Lead Cycle Time",stateName:"leadTime",collapsed:!1,header:[{type:"label",text:"Lead Cycle Time"}],items:[{type:"leadCycleTime"}]});var cf=this._buildCustomFieldsSummary(appConfig);cf.length&&this.registerPanel("Custom Fields",{type:"collapsible",name:"custom fields collapsible",collapsed:!1,stateName:"customFields",header:[{type:"label",text:"Custom Fields"}],items:cf}),window.appIsInDebugMode===!0&&this.registerPanel("Diagnostic",{type:"collapsible",name:"diagnostics container",printable:!1,collapsed:!0,header:[{type:"diagnostics"}],items:[{type:"collapsible",collapsed:!0,header:[{type:"label",text:"Global Bus Listeners"}],items:[{type:"diagnostics.globalListeners"}]},{type:"collapsible",collapsed:!0,header:[{type:"label",text:"Store Listeners"}],items:[{type:"diagnostics.store"}]}]}),this.registerPanel("Look Switcher",{type:"lookswitcher",printable:!1,editions:["~board"]})},getCollection:function(name){var collection={};return name in this.collections||(this.collections[name]={}),collection=this.collections[name],collection},addToCollection:function(collName,key,value){var coll=this.getCollection(collName);return coll[key]=value,this},registerAction:function(alias,config){config.alias=alias,config.className=config.className||"",this.addToCollection("actions",alias,config)},getActions:function(appConfig){var config=_.compact(this.getActionsAliases()),collection=this.getCollection("actions"),actions=[];return _.forEach(config,function(alias){alias in collection?actions.push(collection[alias]):actions.push({label:"--"+alias,command:function(){alert("Still working on it")}})}),actions},getActionsAliases:function(){return["Old View","Old Edit","Print","-----","Delete"]},registerAdditionalInfoItem:function(alias,config){config.field&&_.defaults(config.field,{name:alias+" "+config.field.type}),config.label&&_.defaults(config.label,{name:alias+" "+config.label.type}),this.addToCollection("additionalInfo",alias,config)},getAdditionalInfoItems:function(appConfig){var config=this.getAdditionalInfoAliases(),collection=this.getCollection("additionalInfo"),actions=[];return _.forEach(config,function(alias){alias in collection&&actions.push(collection[alias])}),actions},getAdditionalInfoAliases:function(){return[]},registerTab:function(alias,config){this.addToCollection("tabs",alias,config)},getTabs:function(appConfig){var config=this.getTabsAliases(),collection=this.getCollection("tabs"),actions=[];return _.forEach(config,function(alias){alias in collection&&actions.push(collection[alias])}),actions},getTabsAliases:function(){return["Description","Relations"]},registerPanel:function(alias,config){this.addToCollection("panels",alias,config)},getPanels:function(appConfig){var config=this.getPanelsAliases(),collection=this.getCollection("panels"),actions=[],self=this;return _.forEach(config,function(alias){alias in collection&&(alias=="Additional Info"&&(collection[alias].items[0].children=self.getAdditionalInfoItems(appConfig)),actions.push(collection[alias]))}),actions},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Additional Info","Custom Fields"]},_buildCustomFieldsSummary:function(appConfig){var ctx=appConfig.context,fields=ctx.getCustomFields(),entityType=ctx.entity.entityType.name.toLowerCase(),filteredFields=_(fields).select(function(cf){return entityType===cf.entityKind.toLowerCase()&&cf.type.toLowerCase()!=="richtext"&&cf.type.toLowerCase()!=="multipleentities"}),items=[];for(var i=0;i<filteredFields.length;i++){var cf=filteredFields[i],typeCf=cf.type.toLowerCase();typeCf==="multipleselectionlist"&&(typeCf="multiselect"),items.push({type:"customField."+typeCf,customField:cf})}return items},_buildRichTextCustomFieldsSummary:function(appConfig){var ctx=appConfig.context,fields=ctx.getCustomFields(),entityType=ctx.entity.entityType.name.toLowerCase(),filteredFields=_(fields).select(function(cf){return entityType===cf.entityKind.toLowerCase()&&cf.type.toLowerCase()==="richtext"}),result={type:"container",name:"custom fields container",visible:filteredFields.length>0,children:[]};for(var i=0;i<filteredFields.length;i++){var cf=filteredFields[i];result.children.push({type:"label",text:cf.name,cssClass:"ui-ctrl-title"}),result.children.push({type:"container",name:"custom field container for "+cf.type.toLowerCase(),cssClass:"ui-sub-control",children:[{type:"customField."+cf.type.toLowerCase(),customField:cf}]})}return result},getNames:function(entityType){return this.termProcessor.getTerms(entityType).names},getTermName:function(entityType){return this.termProcessor.getTerms(entityType).name},getEntityQuickAddOptions:function(){return{}},getConfig:function(appConfig){var terms=appConfig.context.getTerms();this.termProcessor=new TermProcessor(terms);var features=this.configurator.getFeaturesService(),generalInfoId=_.uniqueId("entitygeneralinfo"),additionalInfoId=_.uniqueId("entityadditionalinfo");return{children:[{type:"container",name:"main entity container",layout:"selectable",template:{name:"main.entity.container",engine:"jqote2",markup:["<div class=\"main-container <%= this.cssClass || '' %>\">",'<div id="'+generalInfoId+'" class="general-info"></div>','<div id="'+additionalInfoId+'"  class="additional-info"></div>',"</div>"]},children:[{type:"container",name:"general info column container",layout:"list",selector:"#"+generalInfoId,children:[{type:"breadcrumbs"},{type:"title"},{type:"tabs",cssClass:"tau-tabs",stateName:"generalTab",tabs:this.getTabs(appConfig),additionalHeaders:[{type:"container",cssClass:"inner",children:_.compact([{name:"entity general info menu actions",type:"menu.actions",items:this.getActions(appConfig)},features.isEnabled("entity.quickAdd")?{type:"entity.quickAddTrigger",options:this.getEntityQuickAddOptions(),className:"tau-tab-item-quick-add"}:null])}]}]},{type:"container",name:"additional info column container",layout:"list",selector:"#"+additionalInfoId,children:this.getPanels(appConfig)}]}]}},isIE9:function(){return $.browser.msie&&$.browser.version=="9.0"}});return Config});
define('tau/ui/extensions/assignmentsList/ui.extension.assignmentsList.overlay',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){this.element=evt.data.element;var fn=this.action||function(){};fn.call(this),this.action=function(){}},getWidget:function(){return this.element.parents(".ui-placeholder:first")},showOverlay:function(){this.getWidget().tauOverlay()},hideOverlay:function(){this.getWidget().tauOverlay("hide")},"bus markElementToBeUpdated":function(evtArgs){this.showOverlay()},"bus updateElement":function(evtArgs){this.action=function(){this.hideOverlay()}},"bus markElementToBeDeleted":function(evtArgs){this.showOverlay()},"bus afterAssignmentRemoved":function(evtArgs){this.hideOverlay()},"bus beforeSaveAssignment":function(evtArgs){this.showOverlay()},"bus beforeAddAssignment":function(evtArgs){this.showOverlay()}})});
define('tau/configurations/baseAssignable.container.config',["Underscore","tau/configurations/base.container.config","tau/models/model.extensions","tau/ui/extensions/assignmentsList/ui.extension.assignmentsList.overlay"],function(_,BaseConfig,modelExtensions,ExtensionOverlay){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity,urlBuilder=appConfig.context.configurator.getUrlBuilder();this.registerAction("Add Time",{label:"Add "+this.getTermName("Time"),url:urlBuilder.getAddTimeUrl(entity.id),practices:["Time Tracking"]}),this.registerAction("Move to User Story",{label:"Move to Another User Story",command:function(){this.moveOrCopy()},editions:["~board"]}),this.registerAction("Find Duplicate",{label:"Find Duplicate",command:function(){this.markAsDuplicate()},editions:["~board"]}),this.registerAction("Split",{label:"Split",command:function(){this.split()}}),this.registerAction("Add Test Case",{label:"Add "+this.getTermName("testCase"),url:urlBuilder.getAddTestCaseForUserStoryUrl(entity.id),practices:["Test Cases"]}),this.registerAction("Add Bug",{label:"Add "+this.getTermName("bug"),url:urlBuilder.getAddBugForUserStoryUrl(entity.id),practices:["Bug Tracking"]}),this.registerAction("Create Bug",{label:"Create "+this.getTermName("bug"),url:urlBuilder.getAddBugForRequestUrl(entity.id),practices:["Bug Tracking"]}),this.registerAction("Add Task",{label:"Add "+this.getTermName("task"),url:urlBuilder.getAddTaskForUserStoryUrl(entity.id)}),this.registerAction("Create Task",{label:"Create "+this.getTermName("task"),url:urlBuilder.getAddTaskForRequestUrl(entity.id)}),this.registerAction("Create User Story",{label:"Create "+this.getTermName("userStory"),url:urlBuilder.getAddUserStoryForRequestUrl(entity.id)}),this.registerAction("Create Feature",{label:"Create "+this.getTermName("feature"),url:urlBuilder.getAddFeatureForRequestUrl(entity.id),practices:["Requirements"]}),this.registerTab("Track",{label:"track",header:[{type:"label",text:"Track"}],items:[{type:"collapsible",printable:!1,name:"audit history collapsible",stateName:"audit",collapsed:!0,header:[{type:"label",text:"Audit history"}],items:[{type:"auditHistory"}],editions:["~board"]},{type:"collapsible",name:"time list collapsible",stateName:"times",collapsed:!1,header:[{type:"label",text:"Time records"}],items:[{type:"timeList"}],practices:["Time Tracking"]}]}),this.registerTab("Source",{label:"source",header:[{type:"label",text:"Source",practices:["Source Control"]}],items:[{type:"revisionList",practices:["Source Control"]}]}),this.registerPanel("Progress Bar",{type:"progressBar"}),this.registerPanel("Impediments",{type:"impedimentListPanel",stateName:"impediments"}),this.registerPanel("Assignments",{type:"collapsible",stateName:"assignments",collapsed:!1,header:[{type:"label",text:"Assignments"}],items:[{type:"assignmentsList",extensions:[ExtensionOverlay]}]})},getActionsAliases:function(){return["Add Time","-----","Old View","Old Edit","Print","-----","Delete"]},getAdditionalInfoAliases:function(){return["Release","Iteration"]},getTabsAliases:function(){return["Description","Track","Source","Flow","Relations"]},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Impediments","Assignments","Additional Info","Custom Fields"]}});return Config});
define('tau/configurations/baseContainable.container.config',["tau/configurations/base.container.config"],function(BaseConfig){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var urlBuilder=appConfig.context.configurator.getUrlBuilder(),entity=appConfig.context.entity;this.registerAction("Add Iteration",{label:"Add "+this.getTermName("Iteration"),url:urlBuilder.getAddIterationForReleaseUrl(entity.id),practices:["Iterations"]})}});return Config});
define('tau/components/extensions/extension.labelRefresher.base',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({eventName:null,propertyListForEvict:[],init:function(){var self=this;self._super.apply(self,arguments),_.isArray(self.eventName)||(self.eventName=[self.eventName]);var globalBus=self.bus.getGlobalBus();_(self.eventName).each(function(evtName){globalBus.on(evtName,self.eventHandler,self)}),globalBus.on("bugWasMarkedAsDuplicate",self.onBugWasMarkedAsDuplicate,self)},destroy:function(){var self=this,globalBus=self.bus.getGlobalBus();_(self.eventName).each(function(evtName){globalBus.removeListener(evtName,self.eventHandler,self)}),globalBus.removeListener("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this),this._super.apply(this,arguments)},refresh:function(){var assignable=this.config.context.entity;this.config.store.evictProperties(assignable.id,assignable.entityType.name,this.propertyListForEvict),this.fire("refresh")},onBugWasMarkedAsDuplicate:function(evt){var entityId=this.config?this.config.context.entity.id:null;entityId===evt.data.bugId&&this.refresh()},eventHandler:function(evt){this.isEntityInContext(evt)&&this.refresh()}})});
define('tau/components/extensions/requestsList/extensions.requestList.labelRefresher',["tau/components/extensions/extension.labelRefresher.base"],function(ExtensionBase){return ExtensionBase.extend({eventName:["requestWasAttachedToEntity","requestIsDetachedFromEntity"],propertyListForEvict:["requests-count"]})});
define('tau/components/extensions/testCaseList/extensions.testCaseList.labelRefresher',["tau/components/extensions/extension.labelRefresher.base"],function(ExtensionBase){return ExtensionBase.extend({eventName:"testCase.items.added",propertyListForEvict:["testCases-count"]})});
define('tau/components/extensions/entity/extension.requestList.remover',["Underscore","tau/core/model-base","tau/models/model.extensions"],function(_,ExtensionBase,ExtensionModel){return ExtensionBase.extend({init:function(config){this._super.apply(this,arguments),this.hideElementIfHelpDeskPracticeIsOff(this.config.context)},hideElementIfHelpDeskPracticeIsOff:function(context){this.store=this.config.context.configurator.getStore(),context.isPracticeAvailable("Help Desk")<0&&(this.bus.getGlobalBus().on("requestWasAttachedToEntity",this._updateRefresh,this),this.bus.getGlobalBus().on("bugWasMarkedAsDuplicate",this._updateRefresh,this),this.bus.on("afterRender",this._update,this))},_updateRefresh:function(){var context=this.config.context;this.config.store.evictProperties(context.entity.id,context.entity.entityType.name,["requests-count"]),this._update()},_update:function(){ExtensionModel.calculateRequestsCount.call(this,{callback:function(data){var count=data.count,$el=this.$el;count>0?$el.show():$el.hide()},scope:this})},destroy:function(){this.bus.getGlobalBus().removeListener("requestWasAttachedToEntity",this._updateRefresh,this),this._super()},"bus afterRender":function(e){this.$el=e.data.element}})});
define('tau/models/dataprocessor/model.processor.assignments',["Underscore"],function(_){var assignmentsConverter={getAssignmentsForRole:function(role,serverData){var assignments=_(serverData.assignments).select(function(assignment){return assignment.role.id==role.id});return assignments},getAssignments:function(serverData){var assignments={groups:[]},roleEfforts=serverData.roleEfforts;for(var i=0;i<roleEfforts.length;i++){var role=roleEfforts[i].role,group={role:{id:role.id,name:role.name.substring(0,3)},users:[]},assignmentsForRole=this.getAssignmentsForRole(role,serverData);for(var assignmentsNumber=0;assignmentsNumber<assignmentsForRole.length;assignmentsNumber++){var user=assignmentsForRole[assignmentsNumber].generalUser,name=[];user.firstName?(name.push(user.firstName),user.lastName&&name.push(_.asString(user.lastName).substring(0,1)+".")):user.lastName?name.push(user.lastName):name.push(user.email),group.users.push({id:user.id,name:_.trim(name.join(" ")),assignmentId:assignmentsForRole[assignmentsNumber].id,avatarUri:user.avatarUri})}assignments.groups.push(group)}return assignments}};return assignmentsConverter});
define('tau/models/dataprocessor/model.processor.importance',["Underscore","tau/core/class"],function(_,Class){var ImportanceConverter=Class.extend({init:function(minValue,maxValue){this.min=minValue,this.max=maxValue},getKind:function(importance){var result="medium";return importance==this.min?result="high":importance==this.max&&(result="low"),result}});return ImportanceConverter});
define('tau/models/dataProviders/model.provider.items.base',["Underscore","jQuery","tau/core/class","tau/models/dataprocessor/model.processor.assignments","tau/models/dataprocessor/model.processor.importance"],function(_,$,Class,assignmentsConverter,ImportanceProcessor){return Class.extend({init:function(config){this.config=config,this.fields={generalUser:["id","firstName","lastName","avatarUri","email"],entityState:["id","name","isInitial","isFinal","numericPriority",{role:["id","name"]}],entityStateWithComment:["id","name","isInitial","isFinal","numericPriority","isCommentRequired",{nextStates:["id"]},{role:["id","name"]}]}},_chainResponse:function(callback){var $d=$.Deferred();return $d.done(callback),$d.resolve},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityState},{roleEfforts:["id",{role:["id","name"]}]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]}],detailCommand},_createQuery:function(collectionType){return{}},_processAssignments:function(data){var assignments=assignmentsConverter.getAssignments(data),urlBuilder=this.config.context.configurator.getUrlBuilder();return _.forEach(assignments.groups,function(group){_.forEach(group.users,function(user){user.avatarUrl=user.avatarUri+"24"})}),assignments},_processTags:function(data){return data.tags?_.isArray(data.tags)?data.tags:data.tags.toString().split(", "):[]},_calculateEffortToMaximum:function(data){if(data.length==0)return data;var maxItem=_.max(data,function(item){return item.effort.total}),max=maxItem.effort.total;return _.forEach(data,function(item){item.effort.percentFromCount=data.length,item.effort.percentFromMaximum=max==0?0:Math.round(item.effort.total/max*100)}),data},_convertData:function(data){var items=data,result=[],self=this;return _.forEach(items,function(item){var itemType=item.__type.toLowerCase(),itemEntityType=item.entityType?item.entityType.name.toLowerCase():"";itemType!=="solution"&&itemEntityType!=="solution"&&result.push(self._convertItem(item))}),result},_convertItem:function(data){var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data)};return item.severity={id:data.severity.id,name:data.severity.name},item},_getEffortData:function(serverDataItem){var data={};return data.estimated=serverDataItem.effort,data.spent=serverDataItem.effortCompleted,data.remain=serverDataItem.effortToDo,data.total=data.spent+data.remain,data.percentComplete=data.total===0?0:Math.round(data.spent/data.total*100),data.percentFromMaximum=0,data.timeSpent=Math.round(serverDataItem.timeSpent*100)/100,data.timeRemain=Math.round(serverDataItem.timeRemain*100)/100,data.unit=this.config.context.getEffortPoint(serverDataItem.__type),data},_getAssignedEffort:function(serverDataItem){var data={},effortToDo=0,effortCompleted=0,sumFunction=function(entity){effortToDo+=entity.effortToDo,effortCompleted+=entity.effortCompleted};return _.each(serverDataItem.userStories,sumFunction),_.each(serverDataItem.bugs,sumFunction),data.value=Math.round((effortToDo+effortCompleted)*100)/100,data.unit=this.config.context.getEffortPoint(serverDataItem.__type),data},_getVelocityData:function(serverDataItem){var data={};return data.value=serverDataItem.velocity,data.unit=this.config.context.getEffortPoint(serverDataItem.__type),data},_fetch:function(collectionName,typeName,importanceTypeName,fnCallback){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,practices=ctx.applicationContext.processes[0].practices,practicesArr=_.pluck(practices,"name"),storeChain=this.config.store,cmd=this._createDetailCommand(collectionName),query=this._createQuery(collectionName),command={id:entityId,nested:!0,fields:[cmd],$query:query},self=this,_success=function(details){var data=details[0].data[collectionName];_.map(data,function(item){item.__type=typeName});var result=self._convertData(data);fnCallback(result)};importanceTypeName&&(storeChain=storeChain.get(importanceTypeName,{fields:["id","importance"]}),_success=function(details){var importanceList=_(details[0].data).pluck("importance"),min=_.min(importanceList),max=_.max(importanceList);self.importanceProcessor=new ImportanceProcessor(min,max);var data=details[1].data[collectionName];_.map(data,function(item){item.__type=typeName});var result=self._convertData(data);fnCallback(result)}),storeChain=storeChain.get(entityTypeName,command),storeChain.done({success:self._chainResponse(_success),scope:self})},_sortByPriority:function(items){var maxPriority=_.max(items,function(item){return item.numericPriority||0});return maxPriority=maxPriority?maxPriority.numericPriority:0,_.sortBy(items,function(item){var priority=item.numericPriority||0;return item.entityState.isFinal===!0&&(priority+=maxPriority+1),priority})},changePriority:function(item,itemBefore,itemAfter,callback){var store=this.config.store;store.evictProperties(item.id,item.__type,["numericPriority"]);var actions=[];actions.push(function(next){store.save("prioritizer",{id:item.id,$set:{beforeId:itemAfter.id,afterId:itemBefore.id}}).done({success:function(){next(null,arguments)}})}),actions.push(function(next){store.get(item.__type,{id:item.id,fields:["id","numericPriority"]}).done({success:function(result){next(null,result[0].data)}})}),_.series(actions,function(err,result){_.isFunction(callback)&&callback.call(null,{changed:result[1]})})}})});
define('tau/models/dataProviders/model.provider.items.bugs',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("bugs","bug","severity",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{severity:["id","name","importance"]}];var projectField={project:["id"]};return this.config.multiprojects&&projectField.project.push("abbreviation"),detailCommand[collectionType].push(projectField),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&detailCommand[collectionType].push({iteration:["id","name"]}),detailCommand},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),severity:{id:data.severity.id,name:data.severity.name,kind:self.importanceProcessor.getKind(data.severity.importance)},projectId:data.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return this.config.multiprojects&&(item.project={id:data.project.id,abbreviation:data.project.abbreviation}),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&(item.iteration={id:data.iteration?data.iteration.id:null,name:data.iteration?data.iteration.name:null}),item}})});
define('tau/models/dataProviders/model.provider.items.tasks',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("tasks","task","priority",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{userStory:["id"]},{entityState:this.fields.entityState},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{priority:["id","name","importance"]},{project:["id"]}],detailCommand},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),priority:null,projectId:data.project.id,entitiesCount:0};return item}})});
define('tau/models/dataProviders/model.provider.items.tasks_bugs',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/models/dataProviders/model.provider.items.bugs","tau/models/dataProviders/model.provider.items.tasks"],function(_,BaseProvider,BugsProvider,TasksProvider){return BaseProvider.extend({init:function(config){this.config=config,this.providers=[new TasksProvider(config)],this.config.context.isPracticeAvailable("Bug Tracking")&&this.providers.push(new BugsProvider(config))},_convertData:function(data){return data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},fetch:function(fnCallback){var self=this,_success=function(data){var result=self._convertData(data);fnCallback(result)},funcs=[];_.forEach(self.providers,function(provider){funcs.push(function(next){provider.fetch(function(items){next(null,items)})})}),_.parallel(funcs,function(err,results){var result=_.flatten(results);_success(result)})}})});
define('tau/models/dataProviders/model.provider.groups.base',["Underscore","tau/core/class"],function(_,Class){return Class.extend({init:function(config){this.config=config},_mergeGroups:function(groups){var mergedGroup=null;return groups.length&&(mergedGroup={key:[],items:[],title:[],isInitial:!1,isPlanned:!1,isFinal:!1,realGroups:[]},_.forEach(groups,function(group){mergedGroup.key.push(group.key),mergedGroup.title.push(group.title?group.title:group.key),mergedGroup.isInitial=!!group.isInitial,mergedGroup.isPlanned=!!group.isPlanned,mergedGroup.isFinal=!!group.isFinal,mergedGroup.realGroups=mergedGroup.realGroups.concat(group.realGroups)})),mergedGroup},_fetchState:function(key,criteria,fnCallback){var self=this,fnFilter=_(criteria).isFunction()?criteria:function(item){var currentProcess=self.config.context.getProcess(),entityTypeName=item.entityType.name.toLowerCase();return item.process.id===currentProcess.id&&_.indexOf(criteria,entityTypeName)>-1},storeChain=this.config.store,fields=["id","name","isFinal","isInitial","isPlanned","isCommentRequired","numericPriority",{entityType:["id","name"]},{process:["id"]},{nextStates:["id"]}],command={list:!0,fields:fields};storeChain=storeChain.get("entityStates",command),storeChain.done({success:function(data){var states=data[0].data;states=_(states).filter(fnFilter);var groups=_.groupByComplex(states,function(state){return state.name});groups=this._sortByState(groups),_.forEach(groups,function(group){group.collapsed=!!group.items[0].isFinal,group.isFinal=!!group.items[0].isFinal,group.isInitial=!!group.items[0].isInitial,group.isPlanned=!!group.items[0].isPlanned,group.realGroups=_.clone(group.items),group.items=[],delete group.stateWeight});var initialGroups=_.select(groups,function(group){return group.isInitial}),plannedGroups=_.select(groups,function(group){return!group.isInitial&&group.isPlanned}),simpleGroups=_.select(groups,function(group){return!group.isInitial&&!group.isFinal&&!group.isPlanned}),finalGroups=_.select(groups,function(group){return!group.isInitial&&group.isFinal&&!group.isPlanned});groups=[];var mergedGroup=null;initialGroups.length&&(mergedGroup=self._mergeGroups(initialGroups),groups.push(mergedGroup)),plannedGroups.length&&(mergedGroup=self._mergeGroups(plannedGroups),groups.push(mergedGroup)),groups=groups.concat(simpleGroups),finalGroups.length&&(mergedGroup=self._mergeGroups(finalGroups),groups.push(mergedGroup)),_.forEach(groups,function(group){group.collapsed=!!group.isFinal,group.title&&_.isArray(group.title)&&(group.title=group.title.join(", ")),_.isArray(group.key)&&group.key.length==1&&(group.key=group.key.pop()),delete group.isFinal,delete group.isInitial,delete group.isPlanned}),fnCallback(groups)},scope:this})},_sortByState:function(data){return _.forEach(data,function(item){var priorities=[];_.forEach(item.items,function(entityState){priorities.push(entityState.numericPriority)});var sum=_.reduce(priorities,function(memo,num){return memo+num},0),averagePriority=sum?sum/priorities.length:0;item.stateWeight=averagePriority}),data=_.sortBy(data,function(item){return item.stateWeight}),data},moveToGroup:function(item,group,prevGroup,callback){},_moveToGroupByState:function(item,group,prevGroup,callback){var store=this.config.store,realPrevGroup=_.find(prevGroup.realGroups,function(group){return group.id==item.entityState.id}),realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realPrevGroup.process.id});if(!realGroup||realGroup.id==realPrevGroup.id){callback.call(null);return}var actions=[];actions.push(function(next){store.save(item.__type,{id:item.id,$set:{entityState:{id:realGroup.id}},fields:["id",{entityState:["id","name","isFinal"]}]}).done({success:function(){next(null,arguments)}})}),actions.push(function(next){store.get(item.__type,{id:item.id,fields:["id",{entityState:["id","name","isFinal"]}]}).done({success:function(result){next(null,result[0].data)}})}),_.series(actions,function(err,result){_.isFunction(callback)&&callback.call(null,{changed:result[1]})})},isAvailableForItem:function(item,group){return!0},getCommentRequirements:function(item,groups){return[]}})});
define('tau/models/dataProviders/model.provider.groups.tasks_bugs',["Underscore","tau/models/dataProviders/model.provider.groups.base"],function(_,Class){return Class.extend({fetch:function(key,items,fnCallback){var projectIds={tasks:[],bugs:[]},taskProjectIds=[],bugsProjectIds=[],tasks=_(items).select(function(el){return el.__type==="task"}),bugs=_(items).select(function(el){return el.__type==="bug"});projectIds.tasks=_(tasks).chain().pluck("projectId").uniq().value(),this.config.context.isPracticeAvailable("Bug Tracking")&&(projectIds.bugs=_(bugs).chain().pluck("projectId").uniq().value());var store=this.config.store,self=this;store.get("projects",{fields:[{process:["id"]}],list:!0}).done({success:function(res){var projects=res[0].data,processIds={tasks:[],bugs:[]};_.forEach(projectIds,function(ids,entityType){processIds[entityType]=_(projects).chain().select(function(project){return _(ids).include(project.id)}).map(function(project){return project.process.id}).uniq().value()});var fetchFilter=function(state){var typeName=(state.entityType.name||"").toLowerCase(),processId=state.process.id;return typeName==="task"&&_(processIds.tasks).include(processId)||typeName==="bug"&&_(processIds.bugs).include(processId)};return self._fetchState(key,fetchFilter,fnCallback)}})},moveToGroup:function(item,group,prevGroup,callback){return this._moveToGroupByState(item,group,prevGroup,callback)},isAvailableForItem:function(item,group,currentGroup){var realCurrentGroup=_.find(currentGroup.realGroups,function(group){return group.id==item.entityState.id}),realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realCurrentGroup.process.id}),availableIds=_.pluck(realCurrentGroup.nextStates,"id");return availableIds.push(realCurrentGroup.id),realGroup&&_.include(availableIds,realGroup.id)},getCommentRequirements:function(item,groups,currentGroup){var realCurrentGroup=_.find(currentGroup.realGroups,function(group){return group.id==item.entityState.id}),config=[];return _.forEach(groups,function(group){var realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realCurrentGroup.process.id});config.push({isCommentRequired:realGroup?realGroup.isCommentRequired:!1})}),config}})});
define('tau/ui/extensions/list/extension.list.refresher',["tau/components/extensions/component.extension.base"],function(ExtensionBase,listTemplate){return ExtensionBase.extend({"bus afterInit":function(){if(this.signedUp)return;this.signedUp=!0;var entity=this.config.context.entity,typeName=entity.entityType.name,store=this.config.store,self=this;this._refresher||(this._refresher=function(){store.evictProperties(entity.id,typeName,["tasks","bugs"]),self.fire("refresh")},store.unbind(this),store.on({eventName:"afterSave",type:"userStory",listener:this,filter:{id:entity.id},hasChanges:["entityState"]},this._refresher))},"bus destroy":function(){this.config.store.unbind(this),delete this._refresher,this._super.apply(this,arguments)}})});
define('tau/utils/utils.date/utils.date.formats',[],function(){var formats={};return formats={date:{"short":"d-MMM-yyyy"},time:{"short":"HH:mm"},datetime:{"short":"d-MMM-yyyy HH:mm"}},formats});
define('tau/utils/utils.translation',["Underscore"],function(_){var Translation={pluralize:function(source,count){var sourceArr=_.isArray(source)?source:source.split("|"),rule=function(count){return count===1?0:1},key=rule(count);return sourceArr[key]?sourceArr[key]:sourceArr[0]}};return Translation});
/**
 * Version: 1.0 Alpha-1
 * Build Date: 12-Nov-2007
 * Copyright (c) 2006-2007, Coolite Inc. (http://www.coolite.com/). All rights reserved.
 * License: Licensed under The MIT License. See license.txt and http://www.datejs.com/license/.
 * Website: http://www.datejs.com/ or http://www.coolite.com/datejs/
 */

define('libs/date.js/build/time.special',[],function(){TimeSpan=function(time,compareFunc){this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0;var orient=time<0?-1:1;return this.milliseconds=Math.abs(time),compareFunc=compareFunc||Math.floor,this.days=compareFunc(this.milliseconds/864e5)*orient,this.milliseconds=this.milliseconds%864e5,this.hours=compareFunc(this.milliseconds/36e5)*orient,this.milliseconds=this.milliseconds%36e5,this.minutes=compareFunc(this.milliseconds/6e4)*orient,this.milliseconds=this.milliseconds%6e4,this.seconds=compareFunc(this.milliseconds/1e3)*orient,this.milliseconds=this.milliseconds%1e3,this.milliseconds=this.milliseconds*orient,this},TimeSpan.prototype.compare=function(timeSpan){var t1=new Date(1970,1,1,this.hours(),this.minutes(),this.seconds()),t2;return timeSpan===null?t2=new Date(1970,1,1,0,0,0):t2=new Date(1970,1,1,timeSpan.hours(),timeSpan.minutes(),timeSpan.seconds()),t1>t2?1:t1<t2?-1:0},TimeSpan.prototype.add=function(timeSpan){return timeSpan===null?this:this.addSeconds(timeSpan.getTotalMilliseconds()/1e3)},TimeSpan.prototype.subtract=function(timeSpan){return timeSpan===null?this:this.addSeconds(-timeSpan.getTotalMilliseconds()/1e3)},TimeSpan.prototype.addDays=function(n){return new TimeSpan(this.getTotalMilliseconds()+n*24*60*60*1e3)},TimeSpan.prototype.addHours=function(n){return new TimeSpan(this.getTotalMilliseconds()+n*60*60*1e3)},TimeSpan.prototype.addMinutes=function(n){return new TimeSpan(this.getTotalMilliseconds()+n*60*1e3)},TimeSpan.prototype.addSeconds=function(n){return new TimeSpan(this.getTotalMilliseconds()+n*1e3)},TimeSpan.prototype.addMilliseconds=function(n){return new TimeSpan(this.getTotalMilliseconds()+n)},TimeSpan.prototype.getTotalMilliseconds=function(){return this.days()*864e5+this.hours()*36e5+this.minutes()*6e4+this.seconds()*1e3},TimeSpan.prototype.get12HourHour=function(){return(h=this.hours()%12)?h:12},TimeSpan.prototype.getDesignator=function(){return this.hours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator},TimeSpan.prototype.toString=function(format){function _toString(){return this.days()!==null&&this.days()>0?this.days()+"."+this.hours()+":"+p(this.minutes())+":"+p(this.seconds()):this.hours()+":"+p(this.minutes())+":"+p(this.seconds())}function p(s){return s.toString().length<2?"0"+s:s}var self=this;return format?format.replace(/d|dd|HH|H|hh|h|mm|m|ss|s|tt|t/g,function(format){switch(format){case"d":return self.days();case"dd":return p(self.days());case"H":return self.hours();case"HH":return p(self.hours());case"h":return self.get12HourHour();case"hh":return p(self.get12HourHour());case"m":return self.minutes();case"mm":return p(self.minutes());case"s":return self.seconds();case"ss":return p(self.seconds());case"t":return(this.hours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator).substring(0,1);case"tt":return this.hours()<12?Date.CultureInfo.amDesignator:Date.CultureInfo.pmDesignator}}):this._toString()};var TimePeriod=function(from,to,compareFunc){this.years=0,this.months=0,this.days=0,this.hours=0,this.minutes=0,this.seconds=0,this.milliseconds=0;var date1=from.clone(),date2=to.clone(),temp=date1.clone(),orient=date1>date2?-1:1;this.years=date2.getFullYear()-date1.getFullYear(),temp.addYears(this.years),orient==+1?temp>date2&&this.years!==0&&this.years--:temp<date2&&this.years!==0&&this.years++,date1.addYears(this.years);if(orient==+1)while(date1<date2&&date1.clone().addDays(date1.getDaysInMonth())<=date2)date1.addMonths(1),this.months++;else while(date1>date2&&date1.clone().addDays(-date1.getDaysInMonth())>=date2)date1.addMonths(-1),this.months--;var diff=date2-date1;if(diff!==0){var ts=new TimeSpan(diff,compareFunc);this.days=ts.days,this.hours=ts.hours,this.minutes=ts.minutes,this.seconds=ts.seconds,this.milliseconds=ts.milliseconds}return this.months>=1&&this.months<11&&this.days>14&&(this.months+=1),this.years>=1&&this.months>5&&(this.years+=1),this};return{TimePeriod:TimePeriod,TimeSpan:TimeSpan}});
define('tau/utils/utils.date',["Underscore","tau/configurator","tau/utils/utils.date/utils.date.wrapper","tau/utils/utils.date/utils.date.formats","tau/utils/utils.translation","libs/date.js/build/time.special"],function(_,configurator,Date,formatData,Translation,TimeSpecial){var util={},datePrefix="/Date",dateRegExp=/^\/Date\((-?\d+)(([+-])(\d{2})(\d{2}))\)\//,f=function(format){return function(date){var parsed=util.parse(date);return parsed?util._format(parsed,format):""}};return util={serverTimezoneOffset:-1*(new Date).getTimezoneOffset(),Date:Date,format:{date:{"short":f(formatData.date.short)},time:{"short":f(formatData.time.short)},datetime:{"short":f(formatData.datetime.short)}},_format:function(date,format){return date.toString(format)||""},formatAs:function(date,format){return date instanceof Date||(date=new Date(date)),this._format(date,format)},parse:function(dateString){if(_.isString(dateString)&&dateString.indexOf(datePrefix)==0){var res=dateString.match(dateRegExp),serverTime=parseInt(res[1]),serverOffsetMinutes=(parseInt(res[4])*60+parseInt(res[5]))*parseInt(res[3]+"1");dateString=new Date(serverTime),dateString.sourceOffset=serverOffsetMinutes,util.serverTimezoneOffset=serverOffsetMinutes}return Date.parse(dateString)},convertToTimezone:function(date,offset){date=util.parse(date);if(!date)return date;offset||(offset=date.sourceOffset||null);if(!offset)return date;var localOffset=(new Date).getTimezoneOffset(),totalOffset=offset+localOffset;return date=new Date(date.getTime()+totalOffset*60*1e3),date},getFormatData:function(){return formatData},getAge:function(from,to){to=to||configurator.getCurrentDate(),from=Date.parse(from);var result={isZero:!0,value:0,unit:"sec",direction:"ago",toString:function(){var val;return this.isZero?val="now":val=this.value+" "+this.unit+" "+this.direction,val}};result.direction=to>from?"ago":"after";var period=new TimeSpecial.TimePeriod(from,to,function(val){return val===1?1:val<1?0:Math.round(val)}),choice=[{func:"years",units:"year|years"},{func:"months",units:"month|months"},{func:"days",units:"day|days"},{func:"hours",units:"hour|hours"},{func:"minutes",units:"min"},{func:"seconds",units:"sec"}],item=_.detect(choice,function(item,i){var val=period[item.func];if(val!==0)return item.value=Math.abs(val),item.unit=Translation.pluralize(item.units,val),!0});return item&&(result.isZero=!1,result.value=item.value,result.unit=item.unit),result}},util});
define('tau/models/dataProviders/userstory/userstory.model.provider.testcases.items',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/utils/utils.date"],function(_,Class,dateUtils){return Class.extend({fetch:function(fnCallback){this._fetch("testCases","testCase","priority",fnCallback)},_convertData:function(data){return data=this._super(data),_.sortBy(data,function(item){var priority=item.numericPriority||0;return priority})},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","tags","lastStatus","lastRunDate","steps","success","numericPriority"],detailCommand},_convertItem:function(data){var self=this,item={id:data.id,__type:data.__type,name:data.name,tags:[],lastStatus:data.lastStatus?"passed":"failed",lastRunDate:dateUtils.format.datetime.short(dateUtils.convertToTimezone(data.lastRunDate)),steps:data.steps,success:data.success,numericPriority:data.numericPriority,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item}})});
define('tau/ui/extensions/list/testcases/extension.list.testcases.actions',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({_toggle:function($items,show){var $editors=$items.find(".ui-richeditor:visible");$editors.length&&$editors.prev().richeditor("hideEditor"),_.isBoolean(show)?($items.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open",show).toggleClass("tau-list__itemexpander_state_closed",!show),$items.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open",show).toggleClass("tau-list__table-additional_state_closed",!show)):($items.find(".tau-list__itemexpander").toggleClass("tau-list__itemexpander_state_open").toggleClass("tau-list__itemexpander_state_closed"),$items.find(".tau-list__table-additional").toggleClass("tau-list__table-additional_state_open").toggleClass("tau-list__table-additional_state_closed"))},"bus prioritize.start":function(){var $editors=this.$el.find(".ui-richeditor:visible");$editors.length&&$editors.prev().richeditor("hideEditor")},"bus preDataBind":function(evt){var data=evt.data;data.labelAdd=this.config.labelAdd||"Add"},"bus testCaseWasAdded":function(){this.fire("evictTestCases")},"bus evictTestCases":function(){var assignable=this.config.context.entity;this.config.context.configurator.getStore().evictProperties(assignable.id,assignable.entityType.name,["testCases","testCases-count"]),this.fire("refresh")},"bus afterRender":function(evt){var $el=evt.data.element;this.$el=$el;var $items=$el.find("[role=item]"),self=this;$el.delegate("[role=item-expander-all]","click",function(){self._toggle($items,!0)}),$el.delegate("[role=item-collapser-all]","click",function(){self._toggle($items,!1)});var store=this.config.context.configurator.getStore(),changeState=function(itemData,lastStatus){store.save("testcase",{id:itemData.id,$set:{lastStatus:lastStatus,lastFailureComment:null},fields:["id","lastStatus","lastRunDate"]}).done({success:function(){}})},_handler=_.bind(this.addTestCaseClickHandler,this);$el.delegate("[role=action-add]","click",function(e){e.preventDefault(),e.stopPropagation(),_handler(e)}),$el.delegate("[role=item-expander]","click",function(e){var $exp=$(this),$item=$exp.parents("[role=item]:first");self._toggle($item)}),$el.delegate("[role=action-pass]","click",function(e){e.preventDefault(),e.stopPropagation();var $item=$(this).parents("[role=item]:first"),itemData=$item.data("tmplItem").data;changeState(itemData,!0),self._toggle($item,!1);var $next=$item.next("[role=item]");$next.length&&self._toggle($next,!0)}),$el.delegate("[role=action-fail]","click",function(e){e.preventDefault(),e.stopPropagation();var $item=$(this).parents("[role=item]:first"),itemData=$item.data("tmplItem").data,lastStatus=!1;changeState(itemData,lastStatus),self._toggle($item,!1);var $next=$item.next("[role=item]");$next.length&&self._toggle($next,!0)})},addTestCaseClickHandler:function(evt){this.bus.fire("action.add",{originalEvent:evt,entity:this.config.context.entity})}})});
define('tau/models/dataprocessor/model.processor.context',[],function(){function fnContextProcessor(ctxRef){return _.isUndefined(ctxRef)||_.isNull(ctxRef)?null:(ctxRef.checkPractice=innerCheckPractice,ctxRef.isPracticeAvailable=innerCheckPractice,ctxRef.getTimeTrackingPolicies=innerGetTimeTrackingPolicies,ctxRef.getEffortPoint=innerGetEffortPoint,ctxRef.getTerms=innerGetTerms,ctxRef.getCustomFields=innerGetCustomFields,ctxRef.getPractices=innerGetPractices,ctxRef.getEdition=innerGetEdition,ctxRef.hasEdition=hasEdition,ctxRef.getTeam=innerGetTeam,ctxRef.getTeamId=innerGetTeamId,ctxRef.getProject=innerGetProject,ctxRef.getProjectId=innerGetProjectId,ctxRef.getProcess=innerGetProcess,ctxRef.getLoggedUser=innerGetUser,ctxRef.getProcessId=innerGetProcessId,ctxRef)}var _getPracticeByName=function(appCtx,practiceName){var practice=null,practices=appCtx.processes[0].practices;for(var i=0;i<practices.length;i++)practices[i].name.toLowerCase()===practiceName.toLowerCase()&&(practice=practices[i]);return practice},innerGetTimeTrackingPolicies=function(){var timeTrackingPractice=_getPracticeByName(this.applicationContext,"Time Tracking"),disableSpentRemain=!timeTrackingPractice;return{disableSpentRemain:disableSpentRemain}},innerGetEffortPoint=function(entityType){var planningPractice=_getPracticeByName(this.applicationContext,"Planning")||{},effortPointsName=planningPractice.effortPoints;entityType=entityType||this.entity.entityType.name.toLowerCase();if(entityType==="task"||entityType==="request")effortPointsName="Hour";var shortName=effortPointsName.toLowerCase()==="point"?"pt":"h";return{name:effortPointsName,shortName:shortName}},innerGetTerms=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.processes&&appCtx.processes.length>0?appCtx.processes[0].terms:[]},innerGetCustomFields=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.processes&&appCtx.processes.length>0?appCtx.processes[0].customFields:[]},innerGetPractices=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.processes&&appCtx.processes.length>0?appCtx.processes[0].practices:[]},innerGetProject=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.selectedProjects&&appCtx.selectedProjects.length>0?appCtx.selectedProjects[0]:null},innerGetTeam=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.selectedTeams&&appCtx.selectedTeams.length>0?appCtx.selectedTeams[0]:null},innerGetEdition=function(){var appCtx=this.applicationContext,edition=appCtx&&appCtx.edition?appCtx.edition:[],result=_.isArray(edition)?edition:[edition];return result},hasEdition=function(edition){return _.indexOf(this.getEdition(),edition)>=0},innerGetProcess=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.processes&&appCtx.processes.length>0?appCtx.processes[0]:null},innerGetUser=function(){var appCtx=this.applicationContext;return appCtx&&appCtx.loggedUser?appCtx.loggedUser:null},innerGetProcessId=function(){var appCtx=this.applicationContext,p=this.getProcess();return p?p.id:null},innerGetProjectId=function(){var appCtx=this.applicationContext,project=this.getProject();return project?project.id:null},innerGetTeamId=function(){var team=this.getTeam();return team?team.id:null},innerCheckPractice=function(practiceName){return null!==_getPracticeByName(this.applicationContext,practiceName)};return fnContextProcessor});
define('tau/models/page.entity/model.page.entity.context',["Underscore","tau/core/extension.base","tau/models/dataprocessor/model.processor.context"],function(_,ModelBase,contextWrapper){return ModelBase.extend({name:"Entity","bus initialize":function(evt,config){config&&config.context.configurator.getStore().evictData()},"bus beforeInit":function(evt,initData){var entityData=_.isObject(initData.config.entity)?initData.config.entity:{id:initData.config.id,type:initData.config.entity},configurator=initData.config.context.configurator,self=this,funcs=[];funcs.push(function(next){var globSettingsService=configurator.getGlobalSettingsService();globSettingsService.getGlobalSettings({success:function(result){next(!1,result)}})}),funcs.push(function(next){var appContextService=configurator.getApplicationContextService();appContextService.getApplicationContext({id:entityData.type!="user"?entityData.id:""},{success:function(result){next(!1,result)}})}),funcs.push(function(next){var entity={id:entityData.id,entityType:{name:entityData.type}};next(!1,entity)}),funcs.push(function(next){var componentSettings=configurator.getBoardSettingsFactory().createComponentSettings({id:entityData.type});next(!1,componentSettings)}),funcs.push(function(next){var hasTeams=configurator.getConfig("hasTeams");_.isUndefined(hasTeams)?configurator.getStore().get("team",{fields:["id"]}).done(function(res){var hasTeams=res[0].data.length>0;configurator.setConfig("hasTeams",hasTeams),next(!1,{hasTeams:hasTeams})}):next(!1,{hasTeams:hasTeams})}),_.parallel(funcs,function(err,result){self.prepareContext({globalSettings:result[0],applicationContext:result[1],entity:result[2],componentSettings:result[3],applicationContextAdditions:result[4],configurator:configurator})})},prepareContext:function(data){var context={};data.applicationContext.globalSettings=data.globalSettings,_.extend(context,{entity:data.entity,applicationContext:data.applicationContext,componentSettings:data.componentSettings,configurator:data.configurator}),this.fire("entity.ready",context.entity),this.fire("configurator.ready",context.configurator);var contextWrapped=contextWrapper(context);data.applicationContextAdditions.hasTeams&&(contextWrapped.applicationContext.edition=["hasTeams"].concat(contextWrapped.applicationContext.edition)),this.fire("contextRetrieved",{context:contextWrapped})}})});
define('tau/ui/templates/title/ui.template.title.clean',["tau/core/templates-factory"],function(templates){var config={name:"title.clean",engine:"jqote2",markup:['<table class="ui-title ui-title_type_simple">',"<tbody>","<tr>","<td>",'<div class="ui-title__title i-role-title">',"<%! this.name %>","</div>","</td>","</tr>","</tbody>","</table>"]};return templates.register(config)});
define('tau/ui/extensions/list/testcases/extension.list.testcases.actions.add.userStory',["Underscore","tau/components/extensions/component.extension.base","tau/components/component.container","tau/models/page.entity/model.page.entity.context","tau/core/component-base","tau/ui/templates/title/ui.template.title.clean"],function(_,ExtensionBase,containerComponent,modelEntity,omponentBase,templateTitle){return ExtensionBase.extend({"bus testCase.bubble.show":function(evt){var context=this.config.context,self=this,configurator=this.config.context.configurator,store=configurator.getStore();store.save("TestCase",{fields:["id","name",{userStory:["id"]},{project:["id"]}],$set:{name:"My test case",steps:"empty",success:"empty",userStory:{id:context.entity.id}}},{success:function(r){self.fire("testCase.draft.saved",{id:r.data.id})}}).done()},showTestCaseEditor:function(data){var self=this,$addLink=$(data.originalEvent.target).tauBubble({onPositionConfig:function(c){return c.offset="-20 0",c}});$addLink.bind("show",function(e,data){var $content=data.popup.find(".tau-bubble__inner");$content.html('<div class="test-case-wait-message">Adding test case. Please wait...</div>'),setTimeout(function(){self.fire("testCase.bubble.show",{$link:$addLink,data:data})},1);var keyBoardHandler={handleKeyDown:function(){}};self.config.context.configurator.getKeyBoardManager().pushHandler(keyBoardHandler)}),$addLink.bind("close",function(e,data){self.config.context.configurator.getKeyBoardManager().popHandler(),setTimeout(function(){self.fire("testCase.bubble.close",{$link:$addLink,data:data})},1)}),$addLink.tauBubble("show")},getTestCaseConfig:function(){return{layout:"list",cssClass:"test-case-quick-add-container",children:[{type:"title",template:templateTitle},{type:"container",layout:"table",cssClass:"test-case-description",cellsCssClass:["steps","success"],children:[{type:"container",children:[{type:"label",text:"Steps"},{type:"steps",richEditorHeight:100}]},{type:"container",children:[{type:"label",text:"Success"},{type:"success",richEditorHeight:100}]}]}]}},"bus testCase.quickAdd.container.ready + testCase.bubble.close":function(evt,container){container.fire("destroy");var context=this.config.context,userStoryId=context.entity.id;this.fire("testCaseWasAdded",{assignable:{id:userStoryId}})},"bus testCase.draft.context.ready + testCase.bubble.show":function(evt,config,bubble){var self=this,container=containerComponent.create({name:"quick add test case container",context:config.context});container.on("afterRender",function(evt){var $testCaseElement=evt.data.element,$content=bubble.data.popup.find(".tau-bubble__inner");$content.html('<div class="ui-quick-add-stats">Modify content for added test case</div>'),$content.append($testCaseElement),setTimeout(function(){$(".entity-title.editableText",$content).click().html(""),self.fire("testCase.quickAdd.container.ready",container)},0)}),container.fire("initialize",this.getTestCaseConfig())},"bus testCase.draft.saved":function(evt){var self=this,c=(newomponentBase({name:"context retriever","queue.bus":!0,entity:{id:evt.data.id,type:"testCase"},context:{configurator:this.config.context.configurator}})).attach(modelEntity),contextBus=c.bus;contextBus.on("contextRetrieved",function(e){self.fire("testCase.draft.context.ready",e.data),contextBus.fire("destroy")}),contextBus.fire("beforeInit")},"bus action.add":function(evt){this.showTestCaseEditor(evt.data)}})});
define('tau/ui/tags/ui.tag.term',["Underscore","jQuery","tau/core/termProcessor"],function(_,$,TermProcessor){return $.extend($.tmpl.tag,{term:{_default:{$1:"'type'",$2:"null"},open:["var $__t = $item;","while($__t.parent && !$__t.$tau){","$__t = $__t.parent","}","_=_.concat($__t.$tau.terms($2)[$1]);"].join("")}}),{register:function(cfg,templateOptionsRef){var terms=cfg.context?cfg.context.getTerms():[];templateOptionsRef.$tau=templateOptionsRef.$tau||{};var termProc=new TermProcessor(terms);templateOptionsRef.$tau.terms=function(entityType){return termProc.getTerms(entityType)}}}});
define('tau/ui/templates/list_/grid.entity/ui.template.cell.progress',["tau/core/templates-factory"],function(templates){var titleTmpl=["{{if !$item.parent.parent.data.config.currentView.timeTrackingPolicies.disableSpentRemain}}","Time spent: ${timeSpent}{{if timeSpent}}h{{/if}}  ","Time remain: {{if !timeRemain && timeRemain !== 0}}N/A{{else}}${timeRemain}{{if timeRemain}}h{{/if}}{{/if}}  ","{{/if}}","Percent complete: ${percentComplete}%"].join(""),config={name:"cell-progress",markup:['<div{{if percentFromMaximum == 0}} class="tau-extension-tooltip" title="'+titleTmpl+'"{{/if}}>',"{{if percentFromMaximum > 0}}",'    <div class="ui-progress-bar-progress ui-progressbar__progress tau-extension-tooltip" style="width:${percentFromMaximum}%;" title="'+titleTmpl+'">','        <span class="ui-progress-progress ui-progressbar__progress__indicator" style="width:${percentComplete}%;{{if percentComplete == 0}}display:none;{{/if}}"></span>',"    </div>","{{/if}}","</div>"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/ui.template.cell.assignments',["tau/core/templates-factory"],function(templates){var config={name:"cell-assignments",markup:['<span class="ui-assignment__group">','   <span class="ui-assignment__group__title">${role.name}</span><span class="tau-assignment__group__dot">.</span>',"   {{if users.length}}",'   <span class="ui-assignment__group__users">',"   {{each users}}",'       <span class="ui-assignment__user">','           <img style="width:24px; height:24px;" src="${avatarUrl}" alt="${name}" title="${name}" />',"       </span>","   {{/each}}","   </span>","   {{else}}",'   <span class="ui-assignment__group__unassigned">Unassigned</span>',"   {{/if}}","</span>"]};return templates.register(config)});
define('tau/ui/templates/title/ui.template.title.simple',["tau/core/templates-factory"],function(templates){var config={name:"title.simple",engine:"jqote2",markup:['<div class="ui-title ui-title_type_simple">','<div class="ui-title__title i-role-title"><%! this.name %></div>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/ui.template.cell.name',["tau/core/templates-factory","tau/ui/templates/title/ui.template.title.simple"],function(templates){var config={name:"cell-name",markup:['<span class="tau-title-container">','<div class="tau-title tau-list-field-slot" title="${name}" runas="title" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-template:name="title.simple">${name}</div>',"</span>",'{{if typeof tags !== "undefined" && tags && tags.length}}','   <span class="tau-tags">${tags[0]}</span>','   {{if tags.length > 1}}<span class="tau-tags">&#133;</span>{{/if}}',"{{/if}}"]};return templates.register(config)});
define('tau/ui/tags/ui.tag.abbr',["Underscore","jQuery"],function(_,$){return{register:function(cfg,templateOptionsRef){templateOptionsRef.$tau=templateOptionsRef.$tau||{},templateOptionsRef.$tau.abbr=function(text,length){var processed=text||"",abbreviation=processed.substr(0,length);return $.trim(abbreviation)}}}});
define('tau/ui/templates/common/ui.template.userIcon',["tau/core/templates-factory"],function(templates){return templates.register({name:"ui.template.userIcon",markup:["{{if $item.showUser}}",'<span class="ui-assignment__user user tau-avatar_${id}"  userId="${id}">','   <img src="${avatar}" style="width:24px; height:24px;" alt="${name}" title="${name}" class="user-name" />',"</span>","{{/if}}","{{if $item.showEllipsis}}",'   <span class="ui-assignment__user ui-assignment__user_count">+${$item.count}</span>',"{{/if}}"].join(""),dependencies:[]})});
define('tau/ui/templates/assignmentsList/ui.template.assignmentsList.addBtn',["tau/core/templates-factory"],function(templates){var config={name:"assignments-add-btn",markup:['<button class="add-btn',"{{if allowAdd == false}}"," disabled","{{/if}}",'" type="button"><div>AddAssignment</div></button>'].join(""),dependencies:[]};return templates.register(config)});
define('tau/ui/templates/assignmentsList/ui.template.assignmentsList.userList.mini',["tau/core/templates-factory","tau/ui/tags/ui.tag.abbr","tau/ui/templates/common/ui.template.userIcon","tau/ui/templates/assignmentsList/ui.template.assignmentsList.addBtn"],function(templates,abbrTag){var config={name:"ui.template.assignmentsList.userList.mini",tags:[abbrTag],markup:['<div class="ui-assignment__group group" roleId="${role.id}">','   <span class="ui-assignment__group__title">',"       <span>${$item.parent.$tau.abbr(role.name, 3)}</span>","   </span>","   {{if users.length}}",'   <span class="ui-assignment__group__users">',"{{each users}}   ","{{if $index < 2}}",'{{tmpl($value,{showUser:true}) "ui.template.userIcon"}}',"{{/if}}","{{if $index == 2}}",,'{{tmpl($value,{showEllipsis:true,count:users.length-2}) "ui.template.userIcon"}}',"{{/if}}","{{/each}}","   {{/if}}","   </span>","   {{if allowAdd}}",'   <span class="ui-assignment__group__unassigned">{{tmpl "assignments-add-btn"}}</span>',"   {{/if}}","</div>"].join(""),dependencies:["assignments-add-btn","ui.template.userIcon"]};return templates.register(config)});
define('tau/ui/templates/assignmentsList/ui.template.assignments.mini',["tau/core/templates-factory","tau/ui/templates/assignmentsList/ui.template.assignmentsList.userList.mini"],function(templates){var config={name:"ui.template.assignments.mini",markup:['<div class="assignments-table-readonly">','<div class="user-list">{{tmpl(assignments.groups) "ui.template.assignmentsList.userList.mini"}}</div>',"</div>"].join(""),dependencies:["ui.template.assignmentsList.userList.mini"]};return templates.register(config)});
define('tau/ui/templates/property.effort/ui.template.property.effort.content',["tau/core/templates-factory"],function(templates){var estimatedEffortTitleTmpl="Estimated effort: ${effort}{{if effort}}${unit.shortName}{{/if}}",config={name:"ui.template.property.effort.content",markup:[' <div class="tau-extension-tooltip" title="'+estimatedEffortTitleTmpl+'">','   <div class="entity-effort">${effort}<span class="entity-effort-info">${unit.shortName}</span></div>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.row',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__row",markup:["",'<li class="tau-list__list__item" role="item">','<table class="tau-list__table">',"   <tbody>",'       <tr class="i-item-${id} tau-list__table__row {{if $item.data.entityState && $item.data.entityState.isFinal}} tau-list__table__row_isfinalstate_true{{/if}}">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-id">','   <a href="${url}"><em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">${id}</em></a>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-name">','   {{tmpl($item.data) "cell-name"}}',"</td>","{{if $item.parent.data.config.currentView.multiprojects}}","   {{if project}}",'   <td class="tau-list__table__cell tau-list__table__cell-project">${project.abbreviation}</td>',"   {{else}}",'   <td class="tau-list__table__cell  tau-list__table__cell-project">&nbsp;</td>',"   {{/if}}","{{/if}}","{{if visibleEntityState}}",'   <td class="tau-list__table__cell tau-list__table__cell-state">','       <div runas="property.entityState" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">${visibleEntityState.name}</div>',"   </td>","{{/if}}","{{if severity}}",'   <td class="tau-list__table__cell tau-list__table__cell-severity">','       <span runas="property.severity" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" class="tau-list-severity-${severity.kind}">${severity.name}</span>',"   </td>","{{else priority}}",'   <td class="tau-list__table__cell tau-list__table__cell-priority">','       <span class="tau-list-priority-${priority.kind}" runas="property.priority" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">${priority.name}</span>',"   </td>","{{/if}}","{{if effortMock}}",'   <td class="tau-list__table__cell tau-list__table__cell-effort">',"   </td>",'   <td class="tau-list__table__cell tau-list__table__cell-progress" >',"   </td>","{{/if}}","{{if effort}}",'   <td class="tau-list__table__cell tau-list__table__cell-effort">','      <div class="tau-list-field-slot" runas="property.effort" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-entities-count="${entitiesCount}">','        {{tmpl({effort: effort.estimated, unit: effort.unit}) "ui.template.property.effort.content"}}',"      </div>","   </td>",'   <td class="tau-list__table__cell tau-list__table__cell-progress" >','       <div runas="progressBar.small" data-items-count="${effort.percentFromCount}" data-max-width-percents="${effort.percentFromMaximum}" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">','           {{tmpl(effort) "cell-progress"}}',"       </div>","   </td>","{{/if}}","{{if responsible}}",'   <td class="tau-list__table__cell tau-list__table__cell-responsible">','       <div class="tau-responsible"> <span class="tau-label">Res.</span><span class="tau-responsible-component"><span class="tau-list-responsible" runas="property.responsible" data-hidename="true" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">${responsible.firstName}</span></span></div>',"   </td>","{{/if}}","{{if assignments}}",'<td class="tau-list__table__cell tau-list__table__cell-assignments" >','   <div class="tau-list-field-slot" runas="assignmentsList" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-template:name="ui.template.assignments.mini">{{tmpl(assignments.groups) "cell-assignments"}}</div>',"</td>","{{/if}}","{{if velocity}}",'   <td class="tau-list__table__cell tau-list__table__cell-velocity" >',"       ${velocity.value}&nbsp;${velocity.unit.shortName} ","   </td>","{{/if}}","{{if assignedEffort}}",'   <td class="tau-list__table__cell tau-list__table__cell-assignedEffort" >','   <div class="tau-extension-tooltip" title="Assigned Effort: ${assignedEffort.value}&nbsp;${assignedEffort.unit.shortName}">',"       <div>${assignedEffort.value}&nbsp;${assignedEffort.unit.shortName}</div>","   </div>","   </td>","{{/if}}","{{if startDate}}",'   <td class="tau-list__table__cell tau-list__table__cell-date" >',"       ${startDate}","   </td>","{{/if}}","{{if endDate}}",'   <td class="tau-list__table__cell tau-list__table__cell-date" >',"       ${endDate}","   </td>","{{/if}}",'   <td class="tau-list__table__cell tau-list__table__cell-actions" >','       <div class="tau-list-field-slot" runas="entity.actions" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}"></div>',"   </td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/testplan/ui.template.list.grid.entity.row.testplanrun',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates,termTags){var config={name:"list-grid-entity__rowtestplanrun",tags:[termTags],markup:["",'<li class="tau-list__list__item" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="i-item-${id} tau-list__table__row {{if $item.data.entityState && $item.data.entityState.isFinal}} tau-list__table__row_isfinalstate_true{{/if}}">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-id">','   <a class="tau-entitylink" href="${url}" title="${name}"><em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">${id}</em></a>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-stat">','<div class="tau-testCasesRunResults">','<div class="tau-testCasesRunResults-container">','<span title="Passed" class="tau-testCasesRunResults-item tau-testCasesRunResults-passed">${passedCount}</span>','<span title="Failed" class="tau-testCasesRunResults-item tau-testCasesRunResults-failed">${failedCount}</span>','<span title="Not Run" class="tau-testCasesRunResults-item tau-testCasesRunResults-notRun">${notRunCount}</span>',"</div>","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-release">','<div runas="property.release" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-show-url="false" data-placeholder-text="assign to {{term("release") "name"}}">',"{{if release}}","${release.name}","{{/if}}","</div>","</td>","{{if isAvailableIteration}}",'<td class="tau-list__table__cell tau-list__table__cell-iteration">','<div runas="property.iteration" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-show-url="false"  data-placeholder-text="assign to {{term("iteration") "name"}}">',"{{if iteration}}","${iteration.name}","{{/if}}","</div>","</td>","{{/if}}",'<td class="tau-list__table__cell tau-list__table__cell-build">','<div runas="property.build.testPlanRun" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-show-url="false"  data-placeholder-text="assign to {{term("build") "name"}}">',"{{if build}}","${build.name}","{{/if}}","</div>","</td>","{{if assignments}}",'<td class="tau-list__table__cell tau-list__table__cell-assignments" >','   <div runas="assignmentsList" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}" data-template:name="ui.template.assignments.mini">{{tmpl(assignments.groups) "cell-assignments"}}</div>',"</td>","{{/if}}",'<td class="tau-list__table__cell tau-list__table__cell-additionalactions" >','<div runas="menu.testPlanRun" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}"></div>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-actions" >','<div runas="entity.actions" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}"></div>',"</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/testplanrun/ui.template.list.grid.entity.row.testcaserun',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__rowtestcaserun",markup:["",'<li class="tau-list__list__item tau-list__list__item-testcaserun" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="i-item-${testcase.id} tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-id">','   <a class="tau-entitylink" href="${testcase.url}" title="${testcase.name}"><em class="ui-type-icon ui-type-icon-testcase">${testcase.id}</em></a>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-name">','{{tmpl($item.data.testcase) "cell-name"}}',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-priority">','<span class="tau-list-priority-${testcase.priority.kind}" runas="property.priority" data-context:general:id="${testcase.id}" data-context:general:entity-type:name="${testcase.__type}">',"${testcase.priority.name}","</span>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-laststatus">',"<div>",'<div class="ui-status {{if passed === true}}ui-status_type_passed green{{/if}}{{if passed === false}}ui-status_type_failed red{{/if}}{{if passed === null}}ui-status_type_na grey{{/if}}">',"{{if runDate !== null}}","{{if passed === true}}","Passed","{{/if}}","{{if passed === false}}","Failed","{{/if}}","{{if passed === null}}","Skipped","{{/if}}","{{/if}}","</div>","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-actions" >','<div runas="entity.actions" data-context:general:id="${testcase.id}" data-context:general:entity-type:name="testcase"></div>',"</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.group',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.row","tau/ui/templates/list_/grid.entity/testplan/ui.template.list.grid.entity.row.testplanrun","tau/ui/templates/list_/grid.entity/testplanrun/ui.template.list.grid.entity.row.testcaserun"],function(templates){var config={name:"list-grid-entity__group",markup:['<div class="tau-list__group {{if collapsed}} tau-list__group_collapsed_true{{/if}}" role="group">','   <div class="tau-list__group__header tau-list__group__collapse" role="expander">',"       {{if realGroup}}","           {{if realGroup.url}}",'           <a class="tau-list__group__id" href="${realGroup.url}"><em class="ui-type-icon ui-type-icon-${realGroup.__type}">${realGroup.id}</em></a>',"           {{/if}}","       {{/if}}",'       <span class="tau-list__group__title" role="title">${title}</span>','       {{if subtitle}}<span class="tau-list__group__subtitle" >${subtitle}</span>{{/if}}','       <span class="tau-list__group__counter{{if items.length == 0}} tau-list__group__counter__empty{{/if}}" role="counter">${items.length}</span>',"   </div>",'${$item.data.config=$item.parent.data.config,""}','   <ul class="tau-list__list" role="list">',"      {{tmpl(items) $item.parent.data.config.currentView.rowTemplateName }}","   </ul>","</div>"],dependencies:["list-grid-entity__row","list-grid-entity__rowtestplanrun"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/userstory/ui.template.list.grid.entity.row.testcase',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates,termTags){var config={tags:[termTags],name:"list-grid-entity__rowtestcase",markup:["",'<li class="tau-list__list__item" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="i-item-${id} tau-list__table__row {{if $item.data.entityState && $item.data.entityState.isFinal}} tau-list__table__row_isfinalstate_true{{/if}}">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-expander tau-list__itemexpander tau-list__itemexpander_state_closed"  role="item-expander" ><div class="tau-list__itemexpander__indicator "></div></td>','<td class="tau-list__table__cell tau-list__table__cell-id">','   <a class="tau-entitylink" href="${url}" title="${name}"><em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">${id}</em></a>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-name">','   {{tmpl($item.data) "cell-name"}}',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-lastrundate">','<div runas="property.lastRunDate.list" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${lastRunDate}","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-laststatus">','<div runas="property.lastStatus" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${lastStatus}","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-testcaseactions">','<div class="button-group">','<button class="button success" role="action-pass">Pass</button>','<button class="button danger" role="action-fail">Fail</button>',"</div>","</td>","</tr>","</tbody>","</table>",'<table class="tau-list__table tau-list__table-additional tau-list__table-additional_state_closed">',"<tbody>","<tr>",'<td class="tau-list__table__cell tau-list__table__cell-dragdrop"></td>','<td class="tau-list__table__cell tau-list__table__cell-expander-additional"></td>','<td class="tau-list__table__cell tau-list__table__cell-steps">','<div class="tau-steps">','<h4 class="tau-steps__header">Steps</h4>','<div class="tau-steps__content">','<div runas="steps" data-rich-editor-height="100" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${steps}","</div>","</div>","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-success">','<div class="tau-success">','<h4 class="tau-success__header">Success</h4>','<div class="tau-success__content">','<div runas="success" data-rich-editor-height="100" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${success}","</div>","</div>","</div>","</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/ui.template.list.comment',["tau/core/templates-factory"],function(templates){var config={name:"list-grid__comment",markup:['<div class="ui-entity-state-comment" role="comment-form" style="display:none;">','<div class="ui-state-comment-header">Please, provide comment</div>','<div class="ui-state-comment-field-container">','<textarea rows="5" class="ui-state-comment-field"></textarea>',"</div>",'<div class="button-group">','<button type="button" class="save button">Save</button>','<button type="button" class="save button">Cancel</button>',"</div>","</div>"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity.testcase/ui.template.list.grid.entity.testcase',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.group","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.row","tau/ui/templates/list_/grid.entity/testplan/ui.template.list.grid.entity.row.testplanrun","tau/ui/templates/list_/grid.entity/testplanrun/ui.template.list.grid.entity.row.testcaserun","tau/ui/templates/list_/grid.entity/userstory/ui.template.list.grid.entity.row.testcase","tau/ui/templates/list_/ui.template.list.comment"],function(templates,termTags){var config={tags:[termTags],name:"list-grid-entity-testcase",markup:['<div class="tau-list tau-list-testcases">',"   {{if isEmpty === true}}",'<table class="tau-list__table tau-list__table-header">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-header">',"</td>","</tr>","</tbody>","</table>",'      <div class="tau-list__empty-message">${config.currentView.emptyMessage}</div>',"   {{else}}",'     <div class="tau-list__content">',"       {{if groups && groups.length}}",'          {{tmpl(groups) "list-grid-entity__group"}}',"       {{/if}}","       {{if items && items.length}}",'           <div class="tau-list__group tau-list__group_flat_true"  role="group">','<table class="tau-list__table tau-list__table-header">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"></td>','<td class="tau-list__table__cell tau-list__table__cell-expander tau-list__table__cell-header-expander" >','<div class="tau-list__itemexpander tau-list__itemexpander_state_closed"  role="item-expander-all">','<div class="tau-list__itemexpander__indicator "></div>',"</div>",'<div class="tau-list__itemexpander tau-list__itemexpander_state_open"  role="item-collapser-all">','<div class="tau-list__itemexpander__indicator "></div>',"</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-header">',"</td>","</tr>","</tbody>","</table>",'               <ul class="tau-list__list"  role="list">',"                   {{tmpl(items) $item.data.config.currentView.rowTemplateName }}","               </ul>","           </div>","       {{/if}}","     </div>","   {{/if}}",'   <div class="tau-list__comment-holder">','          {{tmpl({}) "list-grid__comment"}}',"   </div>","</div>"],dependencies:["list-grid-entity__group","list-grid-entity__row","list-grid-entity__rowtestplanrun","list-grid-entity__rowtestcaserun","list-grid-entity__rowtestcase","list-grid__comment"]};return templates.register(config)});
define('tau/models/dataProviders/userstory/userstory.model.provider.tasks.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("tasks","task","priority",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{userStory:["id"]},{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{priority:["id","name","importance"]},{project:["id"]}],detailCommand},_convertData:function(data){return data=this._super(data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),priority:null,projectId:data.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,item}})});
define('tau/models/dataProviders/userstory/userstory.model.provider.bugs.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("bugs","bug","severity",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{severity:["id","name","importance"]}];var projectField={project:["id"]};return this.config.multiprojects&&projectField.project.push("abbreviation"),detailCommand[collectionType].push(projectField),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&detailCommand[collectionType].push({iteration:["id","name"]}),detailCommand},_convertData:function(data){return data=this._super(data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),severity:{id:data.severity.id,name:data.severity.name,kind:self.importanceProcessor.getKind(data.severity.importance)},projectId:data.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,this.config.multiprojects&&(item.project={id:data.project.id,abbreviation:data.project.abbreviation}),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&(item.iteration={id:data.iteration?data.iteration.id:null,name:data.iteration?data.iteration.name:null}),item}})});
define('tau/ui/extensions/list/request/extension.list.entityState',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({destroy:function(){this.config.store.unbind(this)},"bus afterInit+dataBind+afterRender":function(evt){var store=evt.afterInit.data.config.store,items=evt.dataBind.data.items,$el=evt.afterRender.data.element,ids=_.pluck(items,"id");store.on({eventName:"afterSave",type:"general",listener:this,hasChanges:["entityState"]},function(evt){var id=evt.data.id;if(_.indexOf(ids,id)==-1)return;store.get(evt.data.cmd.type,{id:id,fields:["id",{entityState:["id","isFinal"]}]}).done({success:function(result){var isFinal=result[0].data.entityState.isFinal;$el.find(".i-item-"+id).toggleClass("tau-list__table__row_isfinalstate_true",isFinal)}})})}})});
define('tau/configurations/userStory.container.config',["Underscore","tau/configurations/baseAssignable.container.config","tau/models/model.extensions","tau/components/extensions/requestsList/extensions.requestList.labelRefresher","tau/components/extensions/testCaseList/extensions.testCaseList.labelRefresher","tau/components/extensions/entity/extension.requestList.remover","tau/models/dataProviders/model.provider.items.tasks_bugs","tau/models/dataProviders/model.provider.groups.tasks_bugs","tau/ui/extensions/list/extension.list.refresher","tau/models/dataProviders/userstory/userstory.model.provider.testcases.items","tau/ui/extensions/list/testcases/extension.list.testcases.actions","tau/ui/extensions/list/testcases/extension.list.testcases.actions.add.userStory","tau/ui/templates/list_/grid.entity.testcase/ui.template.list.grid.entity.testcase","tau/models/dataProviders/userstory/userstory.model.provider.tasks.items","tau/models/dataProviders/userstory/userstory.model.provider.bugs.items","tau/ui/extensions/list/request/extension.list.entityState"],function(_,BaseConfig,modelExtensions,RequestRefresher,TestCaseCountLabelRefresher,RequestListRemoverExtension,BugsTasksItemsDataProvider,BugsTasksGroupsDataProvider,BugsTasksListRefresher,TestcasesItemsDataProvider,TestcasesActionsExtension,TestcasesActionsAddExtension,TestcasesTemplate,TasksItemsDataProvider,BugsItemsDataProvider,EntityStateListExtension){var Config=BaseConfig.extend({init:function(appConfig){this._super(appConfig);var self=this;this.registerTab("Tasks",{label:"tasks",header:[{type:"label",text:self.getNames("task"),countFieldNames:["tasks"]}],items:[{type:"quick.add",printable:!1,property:"userStory",entityType:"task",evictProperties:["tasks","tasks-count"],label:"Add "+self.getNames("task")},{type:"list.editable",extensions:[BugsTasksListRefresher,EntityStateListExtension],externalRefreshEvents:["task.items.added"],itemsDataProvider:TasksItemsDataProvider,multiprojects:!0,views:[{type:"grid.entity"}]}]}),this.registerTab("Bugs",{label:"bugs",practices:["Bug Tracking"],header:[{type:"label",text:self.getNames("bug"),countFieldNames:["bugs"]}],items:[{practices:["Bug Tracking"],type:"quick.add",printable:!1,property:"userStory",entityType:"bug",evictProperties:["bugs","bugs-count"],label:"Add "+self.getNames("bug")},{type:"list.editable",extensions:[BugsTasksListRefresher,EntityStateListExtension],practices:["Bug Tracking"],externalRefreshEvents:["bug.items.added"],itemsDataProvider:BugsItemsDataProvider,multiprojects:!0,views:[{type:"grid.entity"}]}]}),this.registerTab("Test Cases",{label:"testcases",header:[{type:"label",text:self.getNames("testCase"),countFieldNames:["testCases"],extensions:[TestCaseCountLabelRefresher]}],items:[{practices:["Test Cases"],type:"quick.add",printable:!1,property:"userStory",additionalFieldsSet:{steps:"&nbsp;",success:"&nbsp;"},entityType:"testCase",evictProperties:["testCases","testCases-count"],label:"Add "+self.getNames("testcase")},{type:"list.editable",itemsDataProvider:TestcasesItemsDataProvider,multiprojects:!0,practices:["Test Cases"],externalRefreshEvents:["testCase.items.added"],views:[{type:"grid.entity.testcase",rowTemplateName:"list-grid-entity__rowtestcase",emptyMessage:"No test cases found"}],template:TestcasesTemplate,extensions:[TestcasesActionsExtension,TestcasesActionsAddExtension]}],practices:["Test Cases"]})},getTabsAliases:function(){return["Description","Tasks","Bugs","Test Cases","Source","Track","Flow","Relations"]},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Requests","Impediments","Assignments","Additional Info",!$.browser.msie||this.isIE9()?["Lead Cycle Time"]:[],"Custom Fields"]},getActionsAliases:function(){var entityQuickAdd=this.configurator.getFeaturesService().isEnabled("entity.quickAdd");return["Split",entityQuickAdd?null:"Add Task","Add Time",entityQuickAdd?null:"Add Bug",entityQuickAdd?null:"Add Test Case",entityQuickAdd?null:"Add Impediment","Attach to Request","Move or Copy","Convert","-----","Old View","Old Edit","Print","-----","Delete"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"task",relationName:"tasks"},{entityType:"bug",relationName:"bugs",practices:["Bug Tracking"]},{entityType:"testcase",relationName:"testcases",practices:["Test Cases"]},{entityType:"impediment",relationName:"impediments"}]}},getAdditionalInfoAliases:function(){return _.union(["Project","Team","Owner","Business Value","Release","Iteration","Team Iteration","Feature"],!!$.browser.msie&&!this.isIE9()?["CycleTime","LeadTime","CreationDate","CompletionDate"]:[])}});return Config});
define('tau/configurations/task.container.config',["tau/configurations/baseAssignable.container.config"],function(BaseConfig){var Config=BaseConfig.extend({getAdditionalInfoAliases:function(){return["Project","Team","Owner","User Story For Task","CreationDate","CompletionDate"]},getActionsAliases:function(){var entityQuickAdd=this.configurator.getFeaturesService().isEnabled("entity.quickAdd");return["Add Time",entityQuickAdd?null:"Add Impediment","Attach to Request","Convert","-----","Old View","Old Edit","Print","-----","Delete"]},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Requests","Impediments","Assignments","Additional Info","Custom Fields"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"impediment",relationName:"impediments"}]}}});return Config});
define('tau/configurations/bug.container.config',["Underscore","tau/configurations/baseAssignable.container.config"],function(_,BaseConfig){var Config=BaseConfig.extend({init:function(appConfig){this._super(appConfig),this.registerPanel("Duplicated Bugs",{type:"duplicateBugListPanel"})},getAdditionalInfoAliases:function(){return _.union(["Project","Team","Owner","Business Value","Severity","Release","Iteration","Team Iteration","User Story","Build"],!!$.browser.msie&&!this.isIE9()?["CycleTime","LeadTime","CreationDate","CompletionDate"]:[])},getEntityQuickAddOptions:function(){return{items:[{entityType:"impediment",relationName:"impediments"}]}},getActionsAliases:function(){var entityQuickAdd=this.configurator.getFeaturesService().isEnabled("entity.quickAdd");return["Add Time",entityQuickAdd?null:"Add Impediment","Attach to Request","Move or Copy","Convert","Find Duplicate","-----","Old View","Old Edit","Print","-----","Delete"]},getPanelsAliases:function(){return _.union(["Look Switcher","Diagnostic","Progress Bar","Requests","Duplicated Bugs","Impediments","Assignments","Additional Info"],!$.browser.msie||this.isIE9()?["Lead Cycle Time"]:[],["Custom Fields"])}});return Config});
define('tau/ui/extensions/list/request/extension.related_entities.action.detach',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,store=this.config.store,entity=this.config.context.entity,bus=this.bus;$el.delegate("[role=action-detach]","click",function(e){var $item=$(e.target).parents("[role=item]:first"),relatedData=$item.data("tmplItem").data;store.removeFromList(relatedData.__type,{id:relatedData.id,$set:{relatedRequests:{id:entity.id}}}).done({success:function(){store.save("request",{id:entity.id,$set:{relatedEntities:[]}}).done(),store.evictProperties(entity.id,entity.entityType.name,["relatedEntities","relatedEntities-count"]),bus.fire("refresh")}})})}})});
define('tau/models/dataProviders/request/request.model.provider.requesters.items',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/utils/utils.date"],function(_,BaseProvider,dateUtils){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("requesters","user",null,fnCallback)},_convertData:function(data){return data=this._super(data),_.reject(data,function(item){return item.deleteDate!=null})},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","firstName","lastName","deleteDate","email","login","kind"],detailCommand},_convertItem:function(data){var self=this,urlBuilder=this.config.context.configurator.getUrlBuilder(),item={id:data.id,firstName:data.firstName,lastName:data.lastName,deleteDate:data.deleteDate,login:data.login,email:data.email,endDate:dateUtils.format.date.short(data.endDate),avatar:urlBuilder.getAvatarUrl(data.id,32),url:urlBuilder.getUserUrl(data.id,data.kind)};return item}})});
define('tau/ui/extensions/list/testplan/extension.list.editableCells',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender+component.ready":function(evt){var $el=evt.afterRender.data.element;$el.find(".tau-list__table__cell:has(.tau-property_editable_true)").addClass("tau-list__table__cell_editable_true"),$el.delegate(".tau-list__table__cell:has(.tau-property_editable_true)","click",function(e){$(e.currentTarget).hasClass("tau-property__value")==0&&(e.stopPropagation(),$(this).find(".tau-property__value").click())})}})});
define('tau/ui/extensions/list/request/extension.requesters.tabs',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=this.$el=evt.data.element;setTimeout(function(){$el.find(":input[data-autofocus]:visible").focus()},10)},"bus tabs.switched":function(){var self=this;setTimeout(function(){self.$el.find(":input[data-autofocus]:visible").focus()},10)}})});
define('tau/ui/extensions/list/request/extension.requesters.action.add',["tau/components/extensions/component.extension.base","tau/ui/extensions/list/request/extension.requesters.tabs"],function(ExtensionBase,ExtensionTabs){return ExtensionBase.extend({"bus afterInit":function(evt){var store=evt.data.config.store,entity=evt.data.config.context.entity,self=this;store.unbind(this),store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,filter:{id:entity.id},hasChanges:["requesters"]},function(){store.evictProperties(entity.id,entity.entityType.name,["requesters"]),self.fire("refresh")})},"bus afterRender":function(evt){var $action=evt.data.element.find("[role=action-add]"),bubbleConfig={actionOnBlur:"destroy",target:$action,alignTo:$action,componentsConfig:{components:[{type:"tabs",cssClass:"tau-tabs-small",extensions:[ExtensionTabs],tabs:[{label:"select",header:[{type:"label",text:"Select requester"}],items:[{type:"finder.requesters"}],selected:!0},{label:"add",header:[{type:"label",text:"Add new"}],items:[{type:"editor.requester"}]}]}]}};this.fire("initBubble",bubbleConfig);var _empty=function(){$action.tauBubble("empty"),$action.data("bubbleLoaded",!1)};$action.bind("externalClose",_empty),$action.bind("close",_empty),$action.on("show",function(){var $popup=$action.tauBubble("widget");$popup.delegate("[role=action-cancel]","click",_empty)})}})});
define('tau/components/extensions/bubble/extension.bubble.creator',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({category:"edit",init:function(config){this._super(config),this.containers=[]},"bus initBubble":function(evt,bubbleConfig){var context=this.config.context;this.initBubble(bubbleConfig,context)},"bus $target.ready:last+toggleBubble":function(evt,$target){$target.tauBubble("toggle")},initBubble:function(config,context){var self=this;self.destroyContainers();var $target=$(config.target);self.fire("$target.ready",$target);var $alignTo=config.alignTo?$(config.alignTo):$target;config.applyBubbleClasses!==!1&&($target.addClass("tau-bubble-target"),$alignTo.addClass("ui-link")),$target.tauBubble({className:config.className,stackName:config.stackName,alignTo:$alignTo,showOnCreation:config.showOnCreation,showCloseButton:config.showCloseButton,onPositionConfig:config.onPositionConfig||$.noop,onArrowPositionConfig:config.onArrowPositionConfig||$.noop,appendTo:config.appendTo,showEvent:config.showEvent,hideEvent:config.hideEvent,hideOnScroll:_.has(config,"hideOnScroll")?config.hideOnScroll:!0,content:config.html,onHide:function(){config.cleanupOnHide&&$target.data("bubbleLoaded",!1),config.onHide&&config.onHide()},zIndex:config.zIndex,dontCloseSelectors:config.dontCloseSelectors||[],onBeforeShow:config.onBeforeShow||$.noop,onShow:_.bind(function(context,componentsConfig,$target,$bubble){config.onShow&&config.onShow(),this.initializeContainer($target,$bubble,componentsConfig,context)},this,context,config.componentsConfig,$target)})},initializeContainer:function($target,$bubble,config,context){var self=this,isLoaded=$target.data("bubbleLoaded");if(isLoaded===!0||!config)return;this.destroyContainers(),$bubble.find("[role=content]").html('<div class="ui-loading-message">Loading...</div>'),self.createContainer($target,$bubble,config,context)},createContainer:function($target,$bubble,config,context){var self=this;config.store=this.config.store,config.context=context,self.createComponents(config,function(data){var containerBus=data[0].component,componentConfig=data[0].config;self.fire("childComponentCreated",containerBus),self.addContainer(containerBus),self.processContainer($target,$bubble,containerBus),componentConfig.context=config.context,componentConfig.store=config.store,containerBus.initialize(componentConfig)})},processContainer:function($target,$bubble,componentBus){componentBus.on("afterRender",function(evt,renderData){evt.removeListener();var $html=renderData.element;$target.data("bubbleLoaded",!0),$html.css("visibility","hidden"),$bubble.find("[role=content]").html($html),componentBus.fire("popupResize",$target),$target.tauBubble("adjustPosition"),$html.css("visibility","visible"),$target.trigger("taububbleloadcontent")}),componentBus.on("listOptionsReady",function(){$target.tauBubble("adjustPosition")}),componentBus.on("dataRendered",function(){componentBus.fire("popupResize",$target),$target.tauBubble("adjustPosition")}),componentBus.on("afterRender",function(){setTimeout(function(){$target.tauBubble("adjustPosition")},10),setTimeout(function(){componentBus.fire("focus",{})},500)}),$target.bind("close",function(){componentBus.fire("blur",{})}),$target.bind("externalClose",function(){componentBus.fire("blur",{})}),$target.bind("show.before",function(){componentBus.fire("focus.before",{})}),$target.bind("show",function(){componentBus.fire("popupResize",$target),$(this).tauBubble("adjustPosition"),componentBus.fire("focus",{})});var closeBubble=function(evt){$target.data("bubbleLoaded",!1),evt.data&&evt.data.animated?$target.tauBubble("widget").fadeOut(function(){$target.tauBubble("empty")}):$target.tauBubble("empty")},destroyBubble=function(){$target.tauBubble("destroy"),componentBus.destroy()},adjustPosition=function(){$target.tauBubble("adjustPosition")};componentBus.on("beforeSave",closeBubble),componentBus.on("beforeRemove",closeBubble),componentBus.on("reset",destroyBubble),componentBus.on("afterSave",destroyBubble),componentBus.on("afterRemove",destroyBubble),componentBus.on("close",closeBubble),componentBus.on("adjustPosition",adjustPosition)},destroy:function(){this.destroyContainers(),this._super()},addContainer:function(container){this.containers.push(container)},destroyContainers:function(){var containers=this.containers;_.each(containers,function(container){container.destroy()}),this.containers=[]}})});
define('tau/ui/extensions/list/request/extension.requesters.action.detach',["tau/components/extensions/component.extension.base","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension"],function(ExtensionBase,ExtensionBubble,ExtensionCreator){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,store=this.config.store,entity=this.config.context.entity,bus=this.bus;$el.delegate("[role=action-detach]","click",function(e){var $item=$(e.target).parents("[role=item]:first"),requesterData=$item.data("tmplItem").data;store.removeFromList("request",{id:entity.id,$set:{requesters:{id:requesterData.id}}}).done({success:function(){bus.fire("refresh")}})})}})});
define('tau/configurations/request.container.config',["tau/configurations/baseAssignable.container.config","tau/models/model.extensions","tau/ui/extensions/list/request/extension.related_entities.action.detach","tau/models/dataProviders/request/request.model.provider.requesters.items","tau/ui/extensions/list/testplan/extension.list.editableCells","tau/ui/extensions/list/request/extension.list.entityState","tau/ui/extensions/list/request/extension.requesters.action.add","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/list/request/extension.requesters.action.detach"],function(BaseConfig,modelExtensions,RelatedEntitiesActionDetachExtension,RequestersDataItemsProvider,CellsListExtension,EntityStateListExtension,RequestersActionAddExtension,RequestersActionAddCreatorExtension,RequestersActionAddBubbleExtension,RequestersActionDetachExtension){var Config=BaseConfig.extend({init:function(appConfig){this._super(appConfig),this.registerAdditionalInfoItem("Owner",{label:{type:"label",text:"Owner"},field:{type:"property.owner.request"}}),this.registerAdditionalInfoItem("RequestType",{label:{type:"label",text:this.getTermName("RequestType")},field:{type:"property.requestType"}}),this.registerAdditionalInfoItem("Source",{label:{type:"label",text:"Source"},field:{type:"property.requestSource"}}),this.registerTab("Requesters",{label:"requesters",header:[{type:"label",text:"Requesters",countFieldNames:["requesters"]}],items:[{type:"list",sortable:!1,itemsDataProvider:RequestersDataItemsProvider,extensions:[RequestersActionAddExtension,RequestersActionAddCreatorExtension,RequestersActionAddBubbleExtension,RequestersActionDetachExtension],views:[{rowTemplateName:"list-grid-entity__row_requester",type:"grid.entity.requesters"}]}]})},getTabsAliases:function(){return["Description","Requesters","Track","Flow","Relations"]},getAdditionalInfoAliases:function(){return["Project","Team","Owner","Business Value","IsPrivate","RequestType","Source","CreationDate","CompletionDate"]},getActionsAliases:function(){return["Add Time","Create Bug","Create User Story","Create Task","Create Feature","Move or Copy","Convert","-----","Old View","Old Edit","Print","-----","Delete"]}});return Config});
define('tau/models/dataProviders/testplanrun/testplanrun.model.provider.testcaseruns.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,Class){return Class.extend({fetch:function(fnCallback){this._fetch("testCaseRuns","testCaseRun","priority",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","passed","executed","runDate",{testCases:["id","name","tags","numericPriority",{priority:["id","name","importance"]}]}],detailCommand},_convertData:function(data){return data=this._super(data),data=_.compact(data),_.sortBy(data,function(item){var priority=item.testcase.numericPriority||0;return priority})},_convertItem:function(data){var self=this;if(data.testCases.length==0)return null;var testcase=data.testCases[0];testcase.priority.kind=this.importanceProcessor.getKind(testcase.priority.importance);var item={id:data.id,__type:data.__type,name:testcase.name,testcase:{id:testcase.id,__type:testcase.__type,name:testcase.name,tags:this._processTags(testcase),priority:testcase.priority,numericPriority:testcase.numericPriority,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(testcase.id,testcase.__type,!0)},passed:data.passed,runDate:data.runDate,executed:data.executed,status:data.passed===!0?"Passed":data.passed===!1?"Failed":"Skipped"};return item}})});
define('tau/configurations/testplanrun.container.config',["Underscore","tau/configurations/baseAssignable.container.config","tau/models/model.extensions","tau/models/dataProviders/testplanrun/testplanrun.model.provider.testcaseruns.items"],function(_,BaseConfig,modelExtensions,TestCaseRunsItemsDataProvider){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig),this.registerAdditionalInfoItem("Build",{label:{type:"label",text:this.getTermName("build")},field:{type:"property.build.testPlanRun"}}),this.registerPanel("Last Run",{type:"collapsible",stateName:"lastRun",collapsed:!1,header:[{type:"label",text:"Last Run"}],items:[{type:"testCasesRunResults"}]}),this.registerTab("Test Case Runs",{label:"testcaseruns",header:[{type:"label",text:this.getNames("testCaseRun"),countFieldNames:["testCaseRuns"]}],items:[{type:"list",itemsDataProvider:TestCaseRunsItemsDataProvider,sortable:!1,views:[{rowTemplateName:"list-grid-entity__rowtestcaserun",type:"grid.entity",emptyMessage:"No items found"}]}],practices:["Test Cases"]})},getAdditionalInfoAliases:function(){return["Project","Test Plan","Build","Release","Iteration","CreationDate","CompletionDate"]},getActionsAliases:function(){return["Add Time","-----","Old View","Old Edit","Print","-----","Delete"]},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Last Run","Impediments","Assignments","Additional Info","Custom Fields"]},getTabsAliases:function(){return["Description","Test Case Runs","Track","Flow","Relations"]},getConfig:function(appConfig){var config=this._super(appConfig),menuConfig=_.jsonSelect(config,".additionalHeaders");return menuConfig[0][0].children[0].type="menu.actions.testplanrun",config}});return Config});
define('tau/models/dataProviders/testcase/testcase.model.provider.testcaseruns.items',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/utils/utils.date"],function(_,Class,dateUtils){return Class.extend({fetch:function(fnCallback){this._fetch("testCaseRuns","testCaseRun","priority",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","passed","executed","comment","runDate",{testPlanRun:["id","name","tags","numericPriority",{testPlan:["id","name"]},{priority:["id","name","importance"]},{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}]}],detailCommand},_convertData:function(data){return data=this._super(data),data=_.compact(data),_.sortBy(data,function(item){return item.runDateReal}).reverse()},_convertItem:function(data){var self=this;if(data.runDate==null)return null;if(data.passed===null)return null;var testplanrun=data.testPlanRun,testplan=testplanrun.testPlan,item={id:data.id,__type:data.__type,name:testplan.name,testplan:testplan,comment:data.comment,testplanrun:{id:testplanrun.id,__type:testplanrun.__type,name:testplanrun.name,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(testplanrun.id,testplanrun.__type,!0)},release:testplanrun.release,iteration:testplanrun.iteration,build:testplanrun.build,passed:data.passed,runDate:dateUtils.format.datetime.short(dateUtils.convertToTimezone(data.runDate)),runDateReal:data.runDate,executed:data.executed,status:data.passed===!0?"Passed":data.passed===!1?"Failed":"Skipped"};return item}})});
define('tau/configurations/testcase.container.config',["tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/models/dataProviders/testcase/testcase.model.provider.testcaseruns.items"],function(BaseConfig,modelExtensions,TestCaseRunsItemsDataProvider){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig),this.registerTab("Test Case Runs",{label:"testcaseruns",header:[{type:"label",text:"Runs"}],items:[{type:"list",itemsDataProvider:TestCaseRunsItemsDataProvider,sortable:!1,views:[{rowTemplateName:"list-grid-entity__rowtestcaserun_testcase",type:"grid.entity",emptyMessage:"No items found"}]}],practices:["Test Cases"]})},getTabs:function(){var tabs=this._super.apply(this,arguments);return tabs[0].items[1].children=[{type:"container",layout:"table",cssClass:"test-case-description",cellsCssClass:["steps","success"],children:[{type:"container",children:[{type:"label",text:"Steps"},{type:"steps"}]},{type:"container",children:[{type:"label",text:"Success"},{type:"success"}]}]}],tabs},getTabsAliases:function(){return["Description","Test Case Runs","Track","Relations"]},getActionsAliases:function(){return["Move or Copy","-----","Old View","Old Edit","Print","-----","Delete"]},getAdditionalInfoAliases:function(){return["Project","Business Value","User Story","Owner","CreationDate","Last Status","LastFailureComment","Last Run Date"]}});return Config});
define('tau/components/extensions/testCaseList/extension.testPlanRun.testCaseList.edit.addTestCase',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/core/termProcessor"],function(_,$,ExtensionBase,TermProcessor){return ExtensionBase.extend({"bus afterRender+permissionsReady+dataBind":function(evtArgs){if(evtArgs.permissionsReady.data.editable){var data=evtArgs.dataBind.data,$el=evtArgs.afterRender.data.element,terms=this.config.context.getTerms(),termProcessor=new TermProcessor(terms),$button=$el.find(".tau-add-testCase"),$anchor=$('<a class="tau-add-testCase">Add '+termProcessor.getTerms("TestCase").names+"</a>");$anchor.attr("href",this.config.context.configurator.getUrlBuilder().getAddTestCaseForTestPlanRunUrl(this.config.context.entity.id)),$anchor.text($button.text()),$button.replaceWith($anchor)}}})});
define('tau/models/dataProviders/testplan/testplan.model.provider.testplanruns.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,Class){return Class.extend({fetch:function(fnCallback){this._fetch("testPlanRuns","testPlanRun","severity",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain","passedCount","failedCount","notRunCount","testCaseRuns-count",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{release:["id","name"]},{iteration:["id","name"]},{build:["id","name"]}];var projectField={project:["id"]};return this.config.multiprojects&&projectField.project.push("abbreviation"),detailCommand[collectionType].push(projectField),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&detailCommand[collectionType].push({iteration:["id","name"]}),detailCommand},_convertData:function(data){return data=this._super(data),_.sortBy(data,function(item){var priority=item.numericPriority||0;return priority})},_convertItem:function(data){var self=this,isAvailableIteration=!0;this.config.context.isPracticeAvailable("Iterations")||(isAvailableIteration=!1),data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},assignments:this._processAssignments(data),projectId:data.project.id,entitiesCount:0,release:data.release,iteration:data.iteration,build:data.build,passedCount:_.toNumber(data.passedCount)||0,failedCount:_.toNumber(data.failedCount)||0,notRunCount:_.toNumber(data.notRunCount)||0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0),isAvailableIteration:isAvailableIteration,additionalActions:{}};return this.config.multiprojects&&(item.project={id:data.project.id,abbreviation:data.project.abbreviation}),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&(item.iteration={id:data.iteration?data.iteration.id:null,name:data.iteration?data.iteration.name:null}),item}})});
define('tau/models/dataProviders/strategies/model.provider.groups.strategy.base',["Underscore","tau/core/class"],function(_,Class){return Class.extend({fetch:function(key,items,fnCallback){},moveToGroup:function(item,group,prevGroup,callback){},isAvailableForItem:function(item,group){},getCommentRequirements:function(item,groups){}})});
define('tau/models/dataProviders/strategies/model.provider.groups.strategy.states',["Underscore","tau/models/dataProviders/strategies/model.provider.groups.strategy.base"],function(_,BaseStrategy){return BaseStrategy.extend({fetch:function(key,items,fnCallback){},moveToGroup:function(store,item,group,prevGroup,callback){var realPrevGroup=_.find(prevGroup.realGroups,function(group){return group.id==item.entityState.id}),realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realPrevGroup.process.id});if(!realGroup||realGroup.id==realPrevGroup.id){callback.call(null);return}var actions=[];actions.push(function(next){store.save(item.__type,{id:item.id,$set:{entityState:{id:realGroup.id}},fields:["id",{entityState:["id","name","isFinal"]}]}).done({success:function(){next(null,arguments)}})}),actions.push(function(next){store.get(item.__type,{id:item.id,fields:["id",{entityState:["id","name","isFinal"]}]}).done({success:function(result){next(null,result[0].data)}})}),_.series(actions,function(err,result){_.isFunction(callback)&&callback.call(null,{changed:result[1]})})},isAvailableForItem:function(item,group,currentGroup){var realCurrentGroup=_.find(currentGroup.realGroups,function(group){return group.id==item.entityState.id}),realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realCurrentGroup.process.id}),availableIds=_.pluck(realCurrentGroup.nextStates,"id");return availableIds.push(realCurrentGroup.id),realGroup&&_.include(availableIds,realGroup.id)},getCommentRequirements:function(item,groups,currentGroup){var realCurrentGroup=_.find(currentGroup.realGroups,function(group){return group.id==item.entityState.id}),config=[];return _.forEach(groups,function(group){var realGroup=_.find(group.realGroups,function(group){return group.entityType.name.toLowerCase()==item.__type.toLowerCase()&&group.process.id==realCurrentGroup.process.id});config.push({isCommentRequired:realGroup?realGroup.isCommentRequired:!1})}),config}})});
define('tau/models/dataProviders/testplan/testplan.model.provider.testplanruns.groups',["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/models/dataProviders/strategies/model.provider.groups.strategy.states"],function(_,BaseProvider,Strategy){return BaseProvider.extend({init:function(config){this._super(config),this.strategy=new Strategy},fetch:function(key,items,fnCallback){var projectIds=_(items).pluck("projectId"),store=this.config.store,projConfig={fields:[{process:["id"]}],list:!0};store.get("projects",projConfig,{scope:this,success:this.onProjects(projectIds,key,fnCallback)}).done()},onProjects:function(criteriaProjects,key,fnCallback){return function(r){var processIds=_(r.data).chain().select(function(proj){return _(criteriaProjects).include(proj.id)}).map(function(proj){return proj.process.id}).uniq().value(),fnFilter=function(state){var typeName=(state.entityType.name||"").toLowerCase();return typeName==="testplanrun"&&_(processIds).include(state.process.id)};return this._fetchState(key,fnFilter,fnCallback)}},moveToGroup:function(item,group,prevGroup,callback){var store=this.config.store;return this.strategy.moveToGroup(store,item,group,prevGroup,callback)},isAvailableForItem:function(item,group,currentGroup){return this.strategy.isAvailableForItem(item,group,currentGroup)},getCommentRequirements:function(item,groups,currentGroup){return this.strategy.getCommentRequirements(item,groups,currentGroup)}})});
define('tau/models/dataProviders/testplan/testplan.model.provider.testcases.items',["Underscore","tau/models/dataProviders/userstory/userstory.model.provider.testcases.items"],function(_,Class){return Class.extend({})});
define('tau/ui/extensions/list/testcases/extension.list.testcases.actions.add.testPlan',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus action.add":function(evt){var entity=evt.data.entity,configurator=this.config.context.configurator;configurator.getRouting().redirect(configurator.getUrlBuilder().getAddTestCaseForTestPlanRunUrl(entity.id))}})});
define('tau/ui/extensions/list/external.refresh.extension',["tau/core/extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var self=this,callback=function(){this.fire("refresh")},globalBus=initConfig.config.context.configurator.getGlobalBus();globalBus.removeAllListeners(this),_.each(initConfig.config.externalRefreshEvents,function(evtName){globalBus.on(evtName,callback,self)}),this.fire("globalBus.ready",globalBus)},"bus globalBus.ready:last + destroy":function(evt,globalBus){globalBus.removeAllListeners(this)}})});
define('tau/configurations/testplan.container.config',["tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/components/extensions/testCaseList/extension.testPlanRun.testCaseList.edit.addTestCase","tau/components/extensions/testCaseList/extensions.testCaseList.labelRefresher","tau/ui/extensions/list/testplan/extension.list.editableCells","tau/models/dataProviders/testplan/testplan.model.provider.testplanruns.items","tau/models/dataProviders/testplan/testplan.model.provider.testplanruns.groups","tau/models/dataProviders/testplan/testplan.model.provider.testcases.items","tau/ui/extensions/list/testcases/extension.list.testcases.actions","tau/ui/extensions/list/testcases/extension.list.testcases.actions.add.testPlan","tau/ui/templates/list_/grid.entity.testcase/ui.template.list.grid.entity.testcase","tau/ui/extensions/list/external.refresh.extension"],function(BaseConfig,modelExtensions,ExtensionAddTestCase,TestCaseCountLabelRefresher,CellsListExtension,TestPlanRunsItemsDataProvider,TestPlanRunsGroupsDataProvider,TestcasesItemsDataProvider,TestcasesActionsExtension,TestcasesActionsAddExtension,TestcasesTemplate,ExtRefresh){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity,urlBuilder=appConfig.context.configurator.getUrlBuilder();this.registerAction("Add Test Plan Run",{label:"Add "+this.getTermName("TestPlanRun"),url:urlBuilder.getAddTestRunForTestPlanUrl(entity.id),practices:["Test Cases"]}),this.registerAction("Assign Test Cases",{label:"Assign "+this.getTermName("TestCase"),url:urlBuilder.getAssignTestCasesForTestPlanUrl(entity.id),practices:["Test Cases"]}),this.registerTab("Test Cases",{label:"testcases",header:[{type:"label",text:this.getNames("testCase"),countFieldNames:["testCases"],extensions:[TestCaseCountLabelRefresher]}],items:[{practices:["Test Cases"],type:"quick.add",printable:!1,property:"testPlan",additionalFieldsSet:{steps:"&nbsp;",success:"&nbsp;"},onBeforeAdd:function(cmd){var $set=cmd.$set;cmd.fields=["id","name",{testPlans:["id","testCases-count"]}];var testPlan=$set.testPlan;delete $set.testPlan,$set.testPlans=[testPlan]},entityType:"testCase",evictProperties:["testCases","testCases-count"],label:"Add "+this.getNames("testcase")},{type:"list.editable",itemsDataProvider:TestcasesItemsDataProvider,multiprojects:!0,practices:["Test Cases"],views:[{type:"grid.entity.testcase",rowTemplateName:"list-grid-entity__rowtestcase",emptyMessage:"No test cases found"}],template:TestcasesTemplate,externalRefreshEvents:["testCase.items.added"],extensions:[TestcasesActionsExtension,TestcasesActionsAddExtension],labelAdd:"Assign"}],practices:["Test Cases"]}),this.registerTab("Test Plan Runs",{label:"testplanruns",header:[{type:"label",text:this.getNames("testPlanRun"),countFieldNames:["testPlanRuns"]}],items:[{type:"quick.add",printable:!1,property:"testPlan",entityType:"testPlanRun",evictProperties:["testPlanRuns-count"],label:"Add "+this.getNames("TestPlanRun")},{type:"list.editable",itemsDataProvider:TestPlanRunsItemsDataProvider,externalRefreshEvents:["testPlanRun.items.added"],groupsDataProvider:TestPlanRunsGroupsDataProvider,groupBy:"entityState.name",multiprojects:!0,views:[{rowTemplateName:"list-grid-entity__rowtestplanrun",type:"grid.entity",group:{dataIndex:"name"}}],extensions:[CellsListExtension]}],practices:["Test Cases"]})},getTabsAliases:function(){return["Description","Test Cases","Test Plan Runs","Track","Relations"]},getAdditionalInfoAliases:function(){return["Project","Initial Estimate","Owner","CreationDate"]},getActionsAliases:function(){return["Add Test Plan Run","Assign Test Cases","-----","Old View","Old Edit","Print","-----","Delete"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"testplanrun",relationName:"testplanruns",practices:["Test Cases"]},{entityType:"testcase",relationName:"testcases",practices:["Test Cases"]}]}}});return Config});
define('tau/models/dataProviders/model.provider.items.user_stories',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("userStories","userStory","priority",fnCallback)},fetchForGroup:function(group,fnCallback){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,practices=ctx.applicationContext.processes[0].practices,practicesArr=_.pluck(practices,"name"),storeChain=this.config.store,collectionName="userStories",typeName="userStory",cmd=this._createDetailCommand(collectionName),command={id:entityId,nested:!0,fields:[cmd]};storeChain=storeChain.get(entityTypeName,command);var self=this,_success=function(details){var data=_(details).pluck("data")[0][collectionName];_.map(data,function(item){item.__type=typeName}),data=_.filter(data,function(item){return item.entityState.name==group.key});var result=self._convertData(data);fnCallback(result)};storeChain.done({success:_success,scope:self})},_createDetailCommand:function(collectionType){var detailCommand={};detailCommand[collectionType]=["id","name","numericPriority","tags",{priority:["id","name","importance"]},"effort","effortCompleted","effortToDo","timeSpent","timeRemain","tasks-count","tasks-effort-sum","tasks-effortToDo-sum",{feature:["id"]},{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]}];var projectField={project:["id"]};return this.config.multiprojects&&projectField.project.push("abbreviation"),detailCommand[collectionType].push(projectField),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&detailCommand[collectionType].push({iteration:["id","name"]}),detailCommand},_convertData:function(data){return data=BaseProvider.prototype._convertData.call(this,data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,__type:data.__type,numericPriority:data.numericPriority,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),priority:{id:data.priority.id,name:data.priority.name,kind:self.importanceProcessor.getKind(data.priority.importance)},effort:this._getEffortData(data),assignments:this._processAssignments(data),projectId:data.project.id,entitiesCount:data["tasks-count"],url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return this.config.multiprojects&&(item.project={id:data.project.id,abbreviation:data.project.abbreviation}),this.config.additionalFields&&_.indexOf(this.config.additionalFields,"iteration")>-1&&(item.iteration={id:data.iteration?data.iteration.id:null,name:data.iteration?data.iteration.name:null}),item}})});
define('tau/models/dataProviders/iteration/iteration.model.provider.user_stories_bugs.items',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.items.bugs"],function(_,Class,UserStoriesProvider,BugsProvider){return Class.extend({init:function(config){this.config=config,this.providers=[new UserStoriesProvider(config)],this.config.context.isPracticeAvailable("Bug Tracking")&&this.providers.push(new BugsProvider(config))},_convertData:function(data){return data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},fetch:function(fnCallback){var self=this,_success=function(data){var result=self._convertData(data);fnCallback(result)},funcs=[];_.forEach(self.providers,function(provider){funcs.push(function(next){provider.fetch(function(items){next(null,items)})})}),_.parallel(funcs,function(err,results){var result=_.flatten(results);_success(result)})}})});
define('tau/models/dataProviders/iteration/iteration.model.provider.user_stories_bugs.groups',["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/models/dataProviders/strategies/model.provider.groups.strategy.states","tau/utils/utils.date"],function(_,BaseProvider,Strategy,dateUtils){return BaseProvider.extend({init:function(config){this._super(config),this.strategy=new Strategy},fetch:function(key,items,fnCallback){var types=["userstory"];return this.config.context.isPracticeAvailable("Bug Tracking")&&types.push("bug"),this._fetchState(key,types,fnCallback)},moveToGroup:function(item,group,prevGroup,callback){var store=this.config.store;return this.strategy.moveToGroup(store,item,group,prevGroup,callback)},isAvailableForItem:function(item,group,currentGroup){return this.strategy.isAvailableForItem(item,group,currentGroup)},getCommentRequirements:function(item,groups,currentGroup){return this.strategy.getCommentRequirements(item,groups,currentGroup)}})});
define('tau/models/dataProviders/release/release.model.provider.bugs.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("bugs","bug","severity",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{severity:["id","name","importance"]},{project:["id"]}],detailCommand},_convertData:function(data){return data=this._super(data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),severity:{id:data.severity.id,name:data.severity.name,kind:self.importanceProcessor.getKind(data.severity.importance)},projectId:data.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,item}})});
define('tau/models/dataProviders/release/release.model.provider.user_stories.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("userStories","userStory","priority",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags",{priority:["id","name","importance"]},"effort","effortCompleted","effortToDo","timeSpent","timeRemain","tasks-count","tasks-effort-sum","tasks-effortToDo-sum",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{project:["id"]}],detailCommand},_convertData:function(data){return data=BaseProvider.prototype._convertData.call(this,data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,__type:data.__type,numericPriority:data.numericPriority,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),priority:{id:data.priority.id,name:data.priority.name,kind:self.importanceProcessor.getKind(data.priority.importance)},effort:this._getEffortData(data),assignments:this._processAssignments(data),projectId:data.project.id,entitiesCount:data["tasks-count"],url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,item}})});
define('tau/configurations/iteration.container.config',["tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/models/dataProviders/iteration/iteration.model.provider.user_stories_bugs.items","tau/models/dataProviders/iteration/iteration.model.provider.user_stories_bugs.groups","tau/ui/extensions/list/external.refresh.extension","tau/models/dataProviders/release/release.model.provider.bugs.items","tau/models/dataProviders/release/release.model.provider.user_stories.items","tau/ui/extensions/list/request/extension.list.entityState"],function(BaseConfig,modelExtensions,UserStoriesBugsItemsDataProvider,UserStoriesBugsGroupsDataProvider,ExtRefresh,BugsItemsDataProvider,UserStoriesItemsDataProvider,EntityStateListExtension){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity,urlBuilder=appConfig.context.configurator.getUrlBuilder();this.registerAction("Add User Story",{label:"Add "+this.getTermName("userStory"),url:urlBuilder.getAddUserStoryForIterationUrl(entity.id)}),this.registerPanel("Progress Bar",{type:"iteration.progressBar"});var self=this;this.registerTab("User Stories",{label:"userStories",header:[{type:"label",text:self.getNames("userStory"),countFieldNames:["userStories"]}],items:[{type:"quick.add",printable:!1,property:"iteration",entityType:"userStory",evictProperties:["userStories","userStories-count"],label:"Add "+self.getNames("UserStory")},{type:"list.editable",externalRefreshEvents:["userStory.items.added"],itemsDataProvider:UserStoriesItemsDataProvider,views:[{type:"grid.entity"}],extensions:[EntityStateListExtension]}]}),this.registerTab("Bugs",{practices:["Bug Tracking"],label:"bugs",header:[{type:"label",text:self.getNames("bug"),countFieldNames:["bugs"]}],items:[{type:"quick.add",printable:!1,property:"iteration",entityType:"bug",practices:["Bug Tracking"],evictProperties:["bugs","bugs-count"],label:"Add "+self.getNames("Bug")},{type:"list.editable",practices:["Bug Tracking"],itemsDataProvider:BugsItemsDataProvider,views:[{type:"grid.entity"}],externalRefreshEvents:["bug.items.added"],extensions:[EntityStateListExtension]}]})},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Additional Info","Custom Fields"]},getActionsAliases:function(){var entityQuickAdd=this.configurator.getFeaturesService().isEnabled("entity.quickAdd");return[entityQuickAdd?null:"Add User Story",entityQuickAdd?null:"-----","Old View","Old Edit","Print","-----","Delete"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"userstory",relationName:"userstories"},{entityType:"bug",relationName:"bugs",practices:["Bug Tracking"]}]}},getTabsAliases:function(){return["Description","User Stories","Bugs","Track","Relations"]},getAdditionalInfoAliases:function(){return["Project","StartDate","FinishDate","Release","Velocity","Assigned Effort"]}});return Config});
define('tau/configurations/teamiteration.container.config',["tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/models/dataProviders/iteration/iteration.model.provider.user_stories_bugs.items","tau/models/dataProviders/iteration/iteration.model.provider.user_stories_bugs.groups","tau/ui/extensions/list/external.refresh.extension","tau/models/dataProviders/release/release.model.provider.bugs.items","tau/models/dataProviders/release/release.model.provider.user_stories.items","tau/ui/extensions/list/request/extension.list.entityState"],function(BaseConfig,modelExtensions,UserStoriesBugsItemsDataProvider,UserStoriesBugsGroupsDataProvider,ExtRefresh,BugsItemsDataProvider,UserStoriesItemsDataProvider,EntityStateListExtension){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity,urlBuilder=appConfig.context.configurator.getUrlBuilder();this.registerPanel("Progress Bar",{type:"teamiteration.progressBar"});var self=this;this.registerTab("User Stories",{label:"userStories",header:[{type:"label",text:self.getNames("userStory"),countFieldNames:["userStories"]}],items:[{type:"quick.add",printable:!1,property:"teamiteration",entityType:"userStory",evictProperties:["userStories","userStories-count"],label:"Add "+self.getNames("UserStory")},{type:"list.editable",externalRefreshEvents:["userStory.items.added"],itemsDataProvider:UserStoriesItemsDataProvider,views:[{type:"grid.entity"}],extensions:[EntityStateListExtension]}]}),this.registerTab("Bugs",{practices:["Bug Tracking"],label:"bugs",header:[{type:"label",text:self.getNames("bug"),countFieldNames:["bugs"]}],items:[{type:"quick.add",printable:!1,property:"teamiteration",entityType:"bug",practices:["Bug Tracking"],evictProperties:["bugs","bugs-count"],label:"Add "+self.getNames("Bug")},{type:"list.editable",practices:["Bug Tracking"],itemsDataProvider:BugsItemsDataProvider,views:[{type:"grid.entity"}],externalRefreshEvents:["bug.items.added"],extensions:[EntityStateListExtension]}]})},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Additional Info"]},getActionsAliases:function(){return["Print","-----","Delete"]},getTabsAliases:function(){return["Description","User Stories","Bugs","Relations"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"userstory",relationName:"userstories"},{entityType:"bug",relationName:"bugs",practices:["Bug Tracking"]}]}},getAdditionalInfoAliases:function(){return["Team","StartDate","FinishDate","Velocity","Assigned Effort"]}});return Config});
define('tau/models/dataProviders/feature/feature.model.provider.user_stories.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("userStories","userStory","priority",fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags",{priority:["id","name","importance"]},"effort","effortCompleted","effortToDo","timeSpent","timeRemain","tasks-count","tasks-effort-sum","tasks-effortToDo-sum",{project:["abbreviation"]},{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{project:["id"]}],detailCommand},_convertData:function(data){return data=BaseProvider.prototype._convertData.call(this,data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,__type:data.__type,numericPriority:data.numericPriority,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),priority:{id:data.priority.id,name:data.priority.name,kind:self.importanceProcessor.getKind(data.priority.importance)},effort:this._getEffortData(data),assignments:this._processAssignments(data),projectId:data.project.id,project:{abbreviation:data.project.abbreviation},entitiesCount:data["tasks-count"],url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,item}})});
define('tau/models/dataProviders/model.provider.groups.user_stories',["Underscore","tau/models/dataProviders/model.provider.groups.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(key,items,fnCallback){var projectIds=_(items).pluck("projectId"),store=this.config.store,projConfig={fields:[{process:["id"]}],list:!0};store.get("projects",projConfig,{scope:this,success:this.onProjects(projectIds,key,fnCallback)}).done()},onProjects:function(criteriaProjects,key,fnCallback){return function(r){var processIds=_(r.data).chain().select(function(proj){return _(criteriaProjects).include(proj.id)}).map(function(proj){return proj.process.id}).uniq().value(),fnFilter=function(state){var typeName=(state.entityType.name||"").toLowerCase();return typeName==="userstory"&&_(processIds).include(state.process.id)};return this._fetchState(key,fnFilter,fnCallback)}},fetchForGroup:function(group,callback){},moveToGroup:function(item,group,prevGroup,callback){return this._moveToGroupByState(item,group,prevGroup,callback)}})});
define('tau/models/dataProviders/feature/feature.model.provider.user_stories.groups',["Underscore","tau/models/dataProviders/model.provider.groups.user_stories","tau/models/dataProviders/strategies/model.provider.groups.strategy.states","tau/utils/utils.date"],function(_,BaseProvider,Strategy,dateUtils){return BaseProvider.extend({init:function(config){this._super(config),this.strategy=new Strategy},moveToGroup:function(item,group,prevGroup,callback){var store=this.config.store;return this.strategy.moveToGroup(store,item,group,prevGroup,callback)},isAvailableForItem:function(item,group,currentGroup){return this.strategy.isAvailableForItem(item,group,currentGroup)},getCommentRequirements:function(item,groups,currentGroup){return this.strategy.getCommentRequirements(item,groups,currentGroup)}})});
define('tau/configurations/feature.container.config',["jQuery","tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/components/extensions/requestsList/extensions.requestList.labelRefresher","tau/components/extensions/entity/extension.requestList.remover","tau/models/dataProviders/feature/feature.model.provider.user_stories.items","tau/models/dataProviders/feature/feature.model.provider.user_stories.groups","tau/ui/extensions/list/external.refresh.extension","tau/ui/extensions/list/request/extension.list.entityState"],function($,BaseConfig,modelExtensions,RequestRefresher,RequestListRemover,UserStoriesItemsDataProvider,UserStoriesGroupsDataProvider,ExtRefresh,EntityStateListExtension){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity,urlBuilder=appConfig.context.configurator.getUrlBuilder();this.registerAction("Add User Story",{label:"Add "+this.getTermName("userStory"),url:urlBuilder.getAddUserStoryForFeatureUrl(entity.id)}),this.registerPanel("Progress Bar",{type:"progressBar"}),this.registerPanel("Impediments",{type:"impedimentListPanel"}),this.registerPanel("Total Effort",{type:"feature.totalEffort"}),this.registerPanel("Assignments",{type:"collapsible",collapsed:!1,stateName:"assignments",header:[{type:"label",text:"Assignments"}],items:[{type:"feature.assignmentList"}]});var self=this;this.registerTab("User Stories",{label:"userStories",header:[{type:"label",text:self.getNames("userStory"),countFieldNames:["userStories"]}],items:[{type:"quick.add",printable:!1,property:"feature",entityType:"userStory",evictProperties:["userStories","userStories-count"],label:"Add "+this.getNames("UserStory")},{type:"list.editable",externalRefreshEvents:["userStory.items.added"],multiprojects:!0,itemsDataProvider:UserStoriesItemsDataProvider,views:[{type:"grid.entity"}],extensions:[EntityStateListExtension]}]})},getTabsAliases:function(){return["Description","User Stories","Track","Flow","Relations"]},getActionsAliases:function(){var entityQuickAdd=this.configurator.getFeaturesService().isEnabled("entity.quickAdd");return[entityQuickAdd?null:"Add User Story",entityQuickAdd?null:"Add Impediment","Attach to Request","Move or Copy","Convert","-----","Old View","Old Edit","Print","-----","Delete"]},getPanelsAliases:function(){return _.union(["Look Switcher","Diagnostic","Progress Bar","Requests","Impediments","Total Effort","Assignments"],["Additional Info"],!$.browser.msie||this.isIE9()?["Lead Cycle Time"]:[],["Custom Fields"])},getEntityQuickAddOptions:function(){return{items:[{entityType:"userstory",relationName:"userStories"},{entityType:"impediment",relationName:"impediments"}]}},getAdditionalInfoAliases:function(){return _.union(["Project","Team","Owner","Initial Estimate","Business Value","Release"],!!$.browser.msie&&!this.isIE9()?["CycleTime","LeadTime","CreationDate","CompletionDate"]:[])}});return Config});
define('tau/models/dataProviders/model.provider.items.user_stories_bugs',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.items.bugs"],function(_,Class,UserStoriesProvider,BugsProvider){return Class.extend({init:function(config){this.config=config,this.providers=[new UserStoriesProvider(config)],this.config.context.isPracticeAvailable("Bug Tracking")&&this.providers.push(new BugsProvider(config))},_convertData:function(data){return data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},fetch:function(fnCallback){var self=this,_success=function(data){var result=self._convertData(data);fnCallback(result)},funcs=[];_.forEach(self.providers,function(provider){funcs.push(function(next){provider.fetch(function(items){next(null,items)})})}),_.parallel(funcs,function(err,results){var result=_.flatten(results);_success(result)})}})});
define('tau/models/dataProviders/release/release.model.provider.iterations.items',["Underscore","tau/models/dataProviders/model.provider.items.user_stories_bugs","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.items.bugs"],function(_,BaseProvider,UserStoriesProvider,BugsProvider){return BaseProvider.extend({init:function(config){this.config=config,config.additionalFields=["iteration"],this.providers=[new UserStoriesProvider(config)],this.config.context.isPracticeAvailable("Bug Tracking")&&this.providers.push(new BugsProvider(config))},_convertData:function(data){return data=BaseProvider.prototype._convertData.call(this,data),_.forEach(data,function(item){item.visibleEntityState=item.entityState}),this._sortByPriority(data)}})});
define('tau/models/dataProviders/release/release.model.provider.iterations.groups',["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(_,BaseProvider,dateUtils){return BaseProvider.extend({fetch:function(key,items,fnCallback){var types=["userstory"];return this.config.context.isPracticeAvailable("Bug Tracking")&&types.push("bug"),this._fetchIterations(key,types,fnCallback)},_fetchIterations:function(key,entityTypes,fnCallback){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,storeChain=this.config.store,command={id:entityId,nested:!0,fields:[{iterations:["id","name","startDate","endDate"]}]},dateFormat="d MMM",urlBuilder=this.config.context.configurator.getUrlBuilder();storeChain=storeChain.get("release",command),storeChain.done({success:function(data){var iterations=_(data).pluck("data")[0].iterations,groups=[];iterations=_.sortBy(iterations,function(item){return-1*dateUtils.parse(item.startDate)}),_.forEach(iterations,function(item){var startDate=dateUtils.parse(item.startDate).clearTime(),endDate=dateUtils.parse(item.endDate).clearTime(),collapsed=!0,isCurrent=!1;dateUtils.Date.today().between(startDate,endDate)&&(collapsed=!1,isCurrent=!0);var title=startDate.toString(dateFormat)+" / "+endDate.toString(dateFormat);title=title+" ("+Math.floor((endDate.getTime()-startDate.getTime())/1e3/60/60/24+1)+" days)",isCurrent&&(title+=" (current)"),item.url=urlBuilder.getNewViewUrl(item.id,item.__type,!0),item.releaseId=entityId,groups.push({key:item.id,title:item.name,subtitle:title,collapsed:collapsed,realGroup:item})}),groups.unshift({key:null,title:"Backlog",collapsed:!0,realGroup:{id:null,releaseId:entityId}}),_.forEach(groups,function(group){group.items=[]}),fnCallback(groups)},scope:this})},moveToGroup:function(item,group,prevGroup,callback){return this._moveToGroupByIteration(item,group,prevGroup,callback)},_moveToGroupByIteration:function(item,group,prevGroup,callback){var store=this.config.store,realGroup=group.realGroup;if(!realGroup||item.iteration&&realGroup.id==item.iteration.id){callback.call(null);return}var actions=[],$set={release:{id:realGroup.releaseId}};realGroup.id?$set.iteration={id:realGroup.id}:$set.iteration=null,actions.push(function(next){store.save(item.__type,{id:item.id,$set:$set,fields:["id",{iteration:["id"]}]}).done({success:function(){next(null,arguments)}})}),actions.push(function(next){store.get(item.__type,{id:item.id,fields:["id",{iteration:["id"]}]}).done({success:function(result){next(null,result[0].data)}})}),_.series(actions,function(err,result){_.isFunction(callback)&&callback.call(null,{changed:result[1]})})}})});
define('tau/ui/extensions/list/iterations/extension.list.release_iterations',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus preDataBind":function(evt){var data=evt.data;data.groups.length<=1?data.isEmpty=!0:data.isEmpty=!1}})});
define('tau/models/dataProviders/release/release.model.provider.user_stories_bugs.items',["Underscore","tau/models/dataProviders/model.provider.items.user_stories_bugs","tau/models/dataProviders/model.provider.items.user_stories","tau/models/dataProviders/model.provider.items.bugs"],function(_,BaseProvider,UserStoriesProvider,BugsProvider){return BaseProvider.extend({init:function(config){this.config=config,config.additionalFields=["iteration"],this.providers=[new UserStoriesProvider(config)],this.config.context.isPracticeAvailable("Bug Tracking")&&this.providers.push(new BugsProvider(config))},_convertData:function(data){var result=BaseProvider.prototype._convertData.call(this,data);return this._sortByPriority(result)}})});
define('tau/models/dataProviders/release/release.model.provider.user_stories_bugs.groups',["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/models/dataProviders/strategies/model.provider.groups.strategy.states","tau/utils/utils.date"],function(_,BaseProvider,Strategy,dateUtils){return BaseProvider.extend({init:function(config){this._super(config),this.strategy=new Strategy},fetch:function(key,items,fnCallback){var types=["userstory"];return this.config.context.isPracticeAvailable("Bug Tracking")&&types.push("bug"),this._fetchState(key,types,fnCallback)},moveToGroup:function(item,group,prevGroup,callback){var store=this.config.store;return this.strategy.moveToGroup(store,item,group,prevGroup,callback)},isAvailableForItem:function(item,group,currentGroup){return this.strategy.isAvailableForItem(item,group,currentGroup)},getCommentRequirements:function(item,groups,currentGroup){return this.strategy.getCommentRequirements(item,groups,currentGroup)}})});
define('tau/models/dataProviders/release/release.model.provider.features.items',["Underscore","jQuery","tau/models/dataProviders/model.provider.items.base"],function(_,$,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("features","feature","severity",fnCallback)},_chainResponse:function(callback){var self=this,storeChain=self.config.store,$d=$.Deferred();return $d.pipe(function(r){var processIds=_(r[1].data.features).chain().map(function(item){var proj=item.project||{process:{id:null}};return proj.process.id}).uniq().without(null).value();if(processIds.length>0){var params={fields:["id",{entityStates:["id",{role:["id","name","hasEffort","isPair"]},{entityType:["id","name"]}]}],$query:{id:{$in:processIds}},list:!0};storeChain.get("process",params).done(function(p){callback(r)})}else callback(r)}),$d.resolve},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{owner:["id","firstName","lastName"]},{assignments:["id",{role:["id"]},{generalUser:this.fields.generalUser}]},{priority:["id","name","importance"]},{project:["id",{process:["id"]}]}],detailCommand},_convertData:function(data){return data=this._super(data),data=this._calculateEffortToMaximum(data),this._sortByPriority(data)},_convertItem:function(data){var self=this;data.project=data.project||{};var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.__type,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),effort:this._getEffortData(data),assignments:this._processAssignments(data),priority:{id:data.priority.id,name:data.priority.name,kind:self.importanceProcessor.getKind(data.priority.importance)},projectId:data.project.id,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item.visibleEntityState=item.entityState,item}})});
define('tau/configurations/release.container.config',["tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/models/dataProviders/release/release.model.provider.iterations.items","tau/models/dataProviders/release/release.model.provider.iterations.groups","tau/ui/extensions/list/iterations/extension.list.release_iterations","tau/models/dataProviders/release/release.model.provider.user_stories_bugs.items","tau/models/dataProviders/release/release.model.provider.user_stories_bugs.groups","tau/models/dataProviders/release/release.model.provider.features.items","tau/models/dataProviders/release/release.model.provider.bugs.items","tau/models/dataProviders/release/release.model.provider.user_stories.items","tau/ui/extensions/list/request/extension.list.entityState","tau/ui/extensions/list/external.refresh.extension"],function(BaseConfig,modelExtensions,IterationsItemsDataProvider,IterationsGroupsDataProvider,IterationsEmptyExtension,UserStoriesBugsItemsDataProvider,UserStoriesBugsGroupsDataProvider,FeaturesItemsDataProvider,BugsItemsDataProvider,UserStoriesItemsDataProvider,EntityStateListExtension,ExtRefresh){var Config=BaseConfig.extend({init:function(appConfig){this._super(appConfig),this.registerPanel("Progress Bar",{type:"release.progressBar"}),this.registerTab("Iterations",{practices:["Iterations"],label:"iterations",header:[{type:"label",text:this.getNames("iteration"),countFieldNames:["iterations"]}],items:[{practices:["Iterations"],type:"list",itemsDataProvider:IterationsItemsDataProvider,groupsDataProvider:IterationsGroupsDataProvider,groupBy:"iteration.id",extensions:[IterationsEmptyExtension],externalRefreshEvents:["iteration.items.added"],views:[{type:"grid.entity",group:{dataIndex:"id"}}]}]});var self=this;this.registerTab("User Stories",{label:"userStories",header:[{type:"label",text:self.getNames("userStory"),countFieldNames:["userStories"]}],items:[{type:"quick.add",printable:!1,property:"release",entityType:"userStory",evictProperties:["userStories","userStories-count"],label:"Add "+self.getNames("UserStory")},{type:"list.editable",externalRefreshEvents:["userStory.items.added"],itemsDataProvider:UserStoriesItemsDataProvider,views:[{type:"grid.entity"}],extensions:[EntityStateListExtension]}]}),this.registerTab("Bugs",{practices:["Bug Tracking"],label:"bugs",header:[{type:"label",text:self.getNames("bug"),countFieldNames:["bugs"]}],items:[{type:"quick.add",printable:!1,property:"release",entityType:"bug",evictProperties:["bugs","bugs-count"],label:"Add "+self.getNames("Bug"),practices:["Bug Tracking"]},{type:"list.editable",itemsDataProvider:BugsItemsDataProvider,externalRefreshEvents:["bug.items.added"],views:[{type:"grid.entity"}],practices:["Bug Tracking"],extensions:[EntityStateListExtension]}]}),this.registerTab("Features",{practices:["Requirements"],label:"features",header:[{type:"label",text:self.getNames("feature"),countFieldNames:["features"]}],items:[{type:"quick.add",printable:!1,property:"release",entityType:"feature",evictProperties:["features","features-count"],label:"Add "+self.getNames("Feature"),practices:["Requirements"]},{practices:["Requirements"],type:"list.editable",externalRefreshEvents:["feature.items.added"],itemsDataProvider:FeaturesItemsDataProvider,views:[{type:"grid.entity"}]}]}),this.registerTab("Release Notes",{label:"notes",header:[{type:"label",text:"Notes"}],items:[{type:"releaseNotes"}]})},getAdditionalInfoAliases:function(){return["Project","StartDate","FinishDate","Release Assigned Effort"]},getPanelsAliases:function(){return["Look Switcher","Diagnostic","Progress Bar","Additional Info","Custom Fields"]},getActionsAliases:function(){var entityQuickAdd=this.configurator.getFeaturesService().isEnabled("entity.quickAdd");return[entityQuickAdd?null:"Add Iteration",entityQuickAdd?null:"-----","Old View","Old Edit","Print","-----","Delete"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"iteration",relationName:"iterations",practices:["Iterations"]},{entityType:"feature",relationName:"features",practices:["Requirements"]},{entityType:"userstory",relationName:"userstories"},{entityType:"bug",relationName:"bugs",practices:["Bug Tracking"]}]}},getTabsAliases:function(){return["Description","Iterations","User Stories","Bugs","Features","Release Notes","Track","Relations"]}});return Config});
define('tau/configurations/build.container.config',["tau/configurations/baseContainable.container.config"],function(BaseConfig){var Config=BaseConfig.extend({init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity;this.registerAdditionalInfoItem("BuildDate",{label:{type:"label",text:"Build Date"},field:{type:"property.buildDate",editable:!0}})},getTabsAliases:function(){return["Description","Track","Relations"]},getActionsAliases:function(){return["Old View","Old Edit","Print","-----","Delete"]},getAdditionalInfoAliases:function(){return["Project","Owner","BuildDate","Release","Iteration"]}});return Config});
define('tau/configurations/impediment.container.config',["tau/configurations/baseContainable.container.config"],function(BaseConfig){var Config=BaseConfig.extend({getActionsAliases:function(){return["Old View","Old Edit","Print","-----","Delete"]},getTabsAliases:function(){return["Description","Track","Relations"]},getAdditionalInfoAliases:function(){return["Project","State","ImpedimentDate","ResolvedOn","Business Value","Assignable","Owner","Responsible","IsPrivate"]}});return Config});
define('tau/models/dataProviders/project/project.model.provider.releases.items',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/utils/utils.date"],function(_,BaseProvider,dateUtils){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("iterations","iteration",!1,fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","tags","startDate","endDate",{release:["id","name"]},"bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum"],detailCommand},_getAssignedEffort:function(serverDataItem){var data={},effortToDo=0,effortCompleted=0;return effortToDo+=serverDataItem["bugs-effortToDo-sum"],effortToDo+=serverDataItem["userStories-effortToDo-sum"],effortCompleted+=serverDataItem["bugs-effortCompleted-sum"],effortCompleted+=serverDataItem["userStories-effortCompleted-sum"],data.value=Math.round((effortToDo+effortCompleted)*100)/100,data.unit=this.config.context.getEffortPoint(serverDataItem.__type),data},_convertItem:function(data){var item={id:data.id,name:data.name,__type:data.__type,tags:this._processTags(data),release:data.release,assignedEffort:this._getAssignedEffort(data),startDate:dateUtils.format.date.short(dateUtils.convertToTimezone(data.startDate)),endDate:dateUtils.format.date.short(dateUtils.convertToTimezone(data.endDate)),url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item},_convertData:function(data){return data=this._super(data),this._sortByStartDate(data)},_sortByStartDate:function(items){return _.sortBy(items,function(item){return-1*item.startDate})}})});
define('tau/models/dataProviders/project/project.model.provider.releases.groups',["Underscore","tau/models/dataProviders/model.provider.groups.base","tau/utils/utils.date"],function(_,Class,dateUtils){return Class.extend({fetch:function(key,items,fnCallback){return this._fetchReleases(key,items,fnCallback)},_fetchReleases:function(key,entityTypes,fnCallback){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,store=this.config.store,self=this,command={id:entityId,nested:!0,fields:[{releases:["id","name","startDate","endDate"]}]};store.get("project",command).done({success:function(data){var releases=_(data).pluck("data")[0].releases;releases=_.sortBy(releases,function(item){return-1*dateUtils.parse(item.startDate)});var groups=[];_.forEach(releases,function(item){groups.push(self._processRelease(item))}),_.forEach(groups,function(group){group.items=[]}),fnCallback(groups)}})},_processRelease:function(item){var startDate=dateUtils.parse(item.startDate).clearTime(),endDate=dateUtils.parse(item.endDate).clearTime(),collapsed=!0,isCurrent=!1;dateUtils.Date.today().between(startDate,endDate)&&(collapsed=!1,isCurrent=!0);var dateFormat="d MMM",title=dateUtils.formatAs(dateUtils.convertToTimezone(startDate),dateFormat)+" / "+dateUtils.formatAs(dateUtils.convertToTimezone(endDate),dateFormat);title=title+" ("+Math.floor((endDate.getTime()-startDate.getTime())/1e3/60/60/24+1)+" days)",isCurrent&&(title+=" (current)"),item.url=this.config.context.configurator.getUrlBuilder().getNewViewUrl(item.id,item.__type,!0);var release={key:item.id,title:item.name,subtitle:title,collapsed:collapsed,realGroup:item};return release}})});
define('tau/models/dataProviders/project/project.model.provider.teams.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({sparklineLength:16,fetch:function(fnCallback){this._fetch("teamProjects","teamProject",!1,fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id",{team:["id","name","icon",{teamMembers:[{user:["id","firstName","lastName","avatarUri"]}]}]}],detailCommand},_fetch:function(collectionName,typeName,importanceTypeName,fnCallback){var self=this,entity=this.config.context.entity,configurator=this.config.context.configurator;$.ajax({url:configurator.getApplicationPath()+"/api/v2/TeamProject?select={"+["id",'"TeamProject" as __type',"new("+["Team.id","Team.name","Team.icon","Team.TeamMembers.Select({User.id, User.firstName, User.lastName, User.avatarUri}) AS members",'Team.Assignables.Count(entityType.Name == "Bug" and entityState.IsFinal != true) as openBugsCount','Team.Assignables.Count(entityType.Name == "Bug" and entityState.IsFinal == true) as closedBugsCount','Team.Assignables.Count(entityType.Name == "UserStory" and entityState.IsFinal != true) as openUsCount','Team.Assignables.Count(entityType.Name == "UserStory" and entityState.IsFinal == true) as closedUsCount','Team.Assignables.Where(entityType.Name == "UserStory" and Project.id = '+entity.id+").Sparkline("+this.sparklineLength+") as userStoriesSparkline",'Team.Assignables.Where(entityType.Name == "Bug" and Project.id = '+entity.id+").Sparkline("+this.sparklineLength+") as bugsSparkline"].join(",")+") as team"].join(",")+"}&where=(Project.id=="+entity.id+")"}).done(function(data){fnCallback(self._convertData(data.items))}).fail(function(){fnCallback(self._convertData([]))})},_convertData:function(data){return data=this._super(data),this._sortByPriority(data)},_sortByPriority:function(items){return _.sortBy(items,function(item){return item.id*-1})},_convertItem:function(data){var members=data.team.members,membersCount=members.length,currentUser=this.config.context.configurator.getLoggedUser(),currentMember=_.find(members,function(v){return v.id==currentUser.id});currentMember&&(members=_.reject(members,function(v){return v.id==currentUser.id}),members.unshift(currentMember));var limit=7,membersMore=!1;members.length>limit&&(membersMore=!0,members=members.slice(0,limit)),members=_.map(members,function(v){return v.name=_.trim(v.firstName+" "+v.lastName),v.uri="#user/"+v.id,v});var usp=data.team.userStoriesSparkline,bsp=data.team.bugsSparkline,uri=this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.team.id,"team",!0),item={id:data.id,__type:"teamProject",team:data.team,members:members,membersMore:membersMore,membersCount:membersCount,uri:uri,membersUri:uri+"/members",appPath:this.config.context.configurator.getApplicationPath(),userStoriesSparkline:usp,bugsSparkline:bsp};return item}})});
define('tau/ui/extensions/list/project/ui.extension.list.project.teams.action.detach',["tau/core/extension.base.stateful"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,store=this.config.context.configurator.getStore(),entity=this.config.context.entity,bus=this.bus,self=this;$el.delegate("[role=action-detach]","click",function(e){var $button=$(e.target);if(!confirm($button.data("confirmMessage")))return;var $item=$button.parents("[role=item]:first"),relatedData=$item.data();store.removeFromList("project",{id:entity.id,$set:{teamProjects:{id:relatedData.entityId}}}).done({success:function(){store.evictProperties(entity.id,"project",["teamProjects"]),self.fire("team.detached")}})})},"bus beforeInit:last + team.detached":function(evt,initConfig){var configurator=initConfig.config.context.configurator,entity=this.config.context.entity,store=configurator.getStore();store.get("project",{id:entity.id,fields:["id",{teamProjects:["id"]}]}).done({success:function(){},failure:function(){alert("You don't have access to this project now"),configurator.getHistory().exclude(entity.id),configurator.service("navigator").back()}})}})});
define('tau/ui/extensions/list/project/ui.extension.list.project.teams.refresher',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,store=configurator.getStore(),self=this;store.unbind(this),store.on({eventName:"afterSave",type:"project",listener:this,hasChanges:["teamProjects"]},function(data){self.fire("refresh")})}})});
define('tau/libs/sparklines/sparklines',["tau/core/class"],function(Class){return Array.prototype.map&&require(["libs/d3/d3"],function(draw){}),Class.extend({init:function(config){this.config=_.defaults(config,{width:100,height:50,letterWidth:7.5,letterHeight:8,emptyStart:8}),this.config.padding=this.config.padding||this.config.letterHeight+1,this.config.percent=Math.ceil(this.config.height/100)},createDrawData:function(data){var len=data.len||15,currentWeek=data.currentWeek,opened=data.opened,closed=data.closed,drawData=[];for(var week=currentWeek-len;week<=currentWeek;week++){var item={open:0,closed:0},openedItem=_.find(opened,function(item){return week==item.key});item.open=openedItem?openedItem.count:0;var closedItem=_.find(closed,function(item){return week==item.key});item.closed=closedItem?closedItem.count:0,drawData.push(item)}return drawData},draw:function(data,el){var isBugs=!1;if(data===null){var source=$(el).data("source");data=this.createDrawData(source),isBugs=$(el).is(".tau-sparkline-bugs")}var c=this.config,svg=d3.select(el||$("<svg />")[0]).attr("width",c.width).attr("height",c.height),dto=_.pluck(data,"open"),dtc=_.pluck(data,"closed"),maxOpen=Math.max.apply(null,dto),maxClose=Math.max.apply(null,dtc),max=Math.max.apply(null,[maxOpen,maxClose]),legendLength=2;data.length&&(legendLength=Math.max.apply(null,[(""+_.last(dtc)).length,(""+_.last(dto)).length,2]));var legendSpace=legendLength*c.letterWidth,dtcHasEmptyStart=_.all(dtc.slice(0,this.config.emptyStart),function(v){return v==0}),dtoHasEmptyStart=_.all(dto.slice(0,this.config.emptyStart),function(v){return v==0}),hasEmptyStart=dtcHasEmptyStart&&dtoHasEmptyStart;return this.drawTop(svg,{items:dtc,max:max,legendSpace:legendSpace,height:c.height,width:c.width,padding:c.padding,percent:c.percent,emptyStartLabel:hasEmptyStart?isBugs?"fixed":"done":!1}),this.drawBottom(svg,{items:dto,max:max,legendSpace:legendSpace,height:c.height,width:c.width,padding:c.padding,percent:c.percent,emptyStartLabel:hasEmptyStart?"added":!1}),svg[0]},drawTop:function(msvg,config){var dt=config.items,legendSpace=config.legendSpace,max=config.max,height=config.height,width=config.width,padding=config.padding,percent=config.percent,svg=msvg.append("g").attr("transform","translate(0,"+padding+")"),maxData=null,currentValue=null,diffData=null;dt.length&&(maxData=_.reduce(dt,function(memo,v,index){return v>memo.value?{index:index,value:v}:memo},{index:0,value:dt[0]}),maxData.index==dt.length-1&&(maxData=null),currentValue=_.last(dt),diffData=_.reduce(dt,function(memo,v,index){return memo?memo.concat({diff:v-_.last(memo).to,to:v,from:_.last(memo).to}):[{diff:v,to:v,from:0}]},null));var hasEmptyStart=_.all(dt.slice(0,this.config.emptyStart),function(v){return v==0}),scaleX=d3.scale.ordinal().domain(_.keys(dt)).rangeRoundBands([0,width-legendSpace]),scaleWidth=scaleX.rangeBand(),scaleY=d3.scale.linear().domain([0,max]).range([height/2-padding,0]),scaleHeight=d3.scale.linear().domain([0,max]).range([0,height/2-padding]);if(dt.length==0){this.drawAxis(svg,_.extend(config,{scaleY:scaleY}));return}svg.selectAll(".tau-sparkline__openbar").data(dt).enter().append("rect").attr("class","tau-sparkline__openbar").attr("x",function(data,i){return scaleX(i)}).attr("y",scaleY).attr("height",scaleHeight).attr("width",scaleWidth),this.drawAxis(svg,_.extend(config,{scaleY:scaleY})),svg.selectAll(".tau-sparkline__openmark").data(dt).enter().append("rect").attr("class","tau-sparkline__openmark").attr("x",function(data,i){return scaleX(i)}).attr("y",scaleY).attr("height",function(data,i){return data==0?0:percent}).attr("width",scaleWidth),svg.selectAll(".tau-sparkline__diffmark-open").data(diffData).enter().append("rect").attr("class","tau-sparkline__diffmark-open").attr("x",function(data,i){return scaleX(i)-1}).attr("y",function(data){return scaleY(Math.max(data.from,data.to))+(data.diff>0?0:1)}).attr("height",function(data){return scaleHeight(Math.abs(data.diff))}).attr("width",1),maxData&&svg.selectAll("text").data([maxData]).enter().append("text").text(function(d){return d.value||""}).attr("x",function(data,i){return scaleX(data.index)+(data.index?scaleWidth/2:0)}).attr("y",function(data,i){return scaleY(data.value)}).attr("text-anchor",function(data,i){return data.index?data.index==dt.length-1?"right":"middle":"left"}).attr("dy",-2),svg.selectAll("text.legend").data([currentValue]).enter().append("text").attr("class","legend").text(function(d){return d}).attr("x",function(data,i){return width-legendSpace}).attr("y",function(data){return scaleY(data)+padding/2>scaleY(0)?scaleY(0)-padding/2:scaleY(data)}).attr("text-anchor","right").attr("dx",percent).attr("dy",(padding-1)/2),hasEmptyStart&&config.emptyStartLabel&&svg.selectAll("text.tau-sparkline__emptylegend").data([config.emptyStartLabel]).enter().append("text").attr("class","tau-sparkline__emptylegend").text(function(d){return d||""}).attr("x",function(data,i){return scaleX(0)}).attr("y",function(data){return scaleY(0)-padding/2-3}).attr("text-anchor","left").attr("dx",percent).attr("dy",(padding-1)/2)},drawBottom:function(msvg,config){var dt=config.items,legendSpace=config.legendSpace,max=config.max,height=config.height,width=config.width,padding=config.padding,percent=config.percent;if(dt.length==0)return;var svg=msvg.append("g").attr("transform","translate(0,"+height/2+")"),maxData=_.reduce(dt,function(memo,v,index){return v>memo.value?{index:index,value:v}:memo},{index:0,value:dt[0]}),currentValue=_.last(dt);maxData.index==dt.length-1&&(maxData=null);var hasEmptyStart=_.all(dt.slice(0,this.config.emptyStart),function(v){return v==0}),diffData=_.reduce(dt,function(memo,v,index){return memo?memo.concat({diff:v-_.last(memo).to,to:v,from:_.last(memo).to}):[{diff:v,to:v,from:0}]},null),scaleX=d3.scale.ordinal().domain(_.keys(dt)).rangeRoundBands([0,width-legendSpace]),scaleWidth=scaleX.rangeBand(),scaleY=d3.scale.linear().domain([0,max]).range([0,height/2-padding]),scaleHeight=d3.scale.linear().domain([0,max]).range([0,height/2-padding]);svg.selectAll(".tau-sparkline__closedmark").data(dt).enter().append("rect").attr("class","tau-sparkline__closedmark").attr("x",function(data,i){return scaleX(i)}).attr("y",scaleY).attr("height",function(data,i){return data==0?0:percent}).attr("width",scaleWidth),svg.selectAll(".tau-sparkline__diffmark-closed").data(diffData).enter().append("rect").attr("class","tau-sparkline__diffmark-closed").attr("x",function(data,i){return scaleX(i)-1}).attr("y",function(data){return scaleY(Math.min(data.from,data.to))+(data.diff>0?1:0)}).attr("height",function(data){return scaleHeight(Math.abs(data.diff))}).attr("width",1),maxData&&svg.selectAll("text").data([maxData]).enter().append("text").text(function(d){return d.value||""}).attr("x",function(data,i){return scaleX(data.index)+(data.index?scaleWidth/2:0)}).attr("y",function(data,i){return scaleY(data.value)+padding}).attr("text-anchor",function(data,i){return data.index?data.index==dt.length-1?"right":"middle":"left"}),svg.selectAll("text.legend").data([currentValue]).enter().append("text").attr("class","legend").text(function(d){return d}).attr("x",function(data,i){return width-legendSpace}).attr("y",function(data){return scaleY(data)-padding/2<scaleY(0)?padding/2:scaleY(data)}).attr("text-anchor","right").attr("dx",percent).attr("dy",(padding-percent)/2),hasEmptyStart&&config.emptyStartLabel&&svg.selectAll("text.tau-sparkline__emptylegend").data([config.emptyStartLabel]).enter().append("text").attr("class","tau-sparkline__emptylegend").text(function(d){return d||""}).attr("x",function(data,i){return scaleX(0)}).attr("y",function(data){return scaleY(0)+padding/2+2}).attr("text-anchor","left").attr("dx",percent).attr("dy",(padding-percent)/2)},drawAxis:function(svg,config){svg.append("rect").attr("class","tau-sparkline__axis").attr("y",config.scaleY(0)).attr("x",0).attr("width",config.width-config.legendSpace).attr("height",config.percent)}})});
define('tau/ui/extensions/list/project/ui.extension.list.project.teams.sparklines',["tau/core/extension.base","tau/libs/sparklines/sparklines"],function(ExtensionBase,Sparklines){return ExtensionBase.extend({"bus dataBind + afterRender":function(evt,data,renderData){var $el=renderData.element,$sp=$el.find(".i-role-sparkline"),conf={width:100,height:50,letterWidth:9,letterHeight:9};$sp.each(function(){var sparklines=new Sparklines(conf);sparklines.draw(null,this)})}})});
define('tau/ui/templates/list_/project/ui.template.list.project.teams',["tau/core/templates-factory"],function(templates){var config={name:"list.project.teams",engine:"jqote2",markup:['<div class="tau-team-control">',"<% if (this.items.length){ %>",'<table class="tau-team-info">',"<colgroup>",'<col class="tau-team">','<col class="tau-us-progress">','<col class="tau-us-total">','<col class="tau-bug-progress">','<col class="tau-bug-total">','<col class="tau-actions tau-nonprintable">',"</colgroup>","<thead>","<tr>","<th>Team</th>",'<th><i class="tau-entity-icon tau-userstory">U</i>User&nbsp;Stories</th>',"<th>Done / Open</th>",'<th><i class="tau-entity-icon tau-bug">B</i>Bugs</th>',"<th>Done / Open</th>",'<th class="tau-nonprintable"></th>',"</tr>","</thead>","<tbody>","<% _.forEach(this.items, function(item){ %>",'<tr class="i-role-item" role="item" data-entity-id="<%= item.id %>">',"<td>",'<div class="tau-team">',"<h3>",'<a href="<%= item.uri %>">','<i class="tau-icon tau-icon_type_svg tau-icon_name_<%= item.team.icon || ""  %>"></i>',"<%! item.team.name %>","</a>","</h3>",'<span class="tau-team-count"><%= item.membersCount %></span>','<div class="tau-team-members">',"<div>",'<a href="<%= item.membersUri %>" title="Go to team members">',"<% _.forEach(item.members, function(user){ %>",'<img src="<%= user.avatarUri %>20">',"<% }); %>","</a>","</div>","<% if (item.membersMore) { %>",'<a class="tau-more" href="<%= item.membersUri %>"  title="Go to team members">','<img src="<%= item.appPath %>/JavaScript/tau/css/images/more-members.gif" class="tau-more">',"</a>","<% } %>","</div>","</div>","</td>",'<td  title="User Stories sparkline provides an overview of progress over the last 16 weeks. The numbers shown are: a maximum of user stories done/added at any given week out of those 16, and done/added in the current calendar week (on the right).">',"<svg class=\"tau-sparkline i-role-sparkline\" data-source='<%= JSON.stringify(item.userStoriesSparkline) %>'></svg>","</td>","<td>",'<div class="tau-fraction tau-userstory">','<span title="done"><%= item.team.closedUsCount %></span><br>','<b title="open"><%= item.team.openUsCount %></b>',"</div>","</td>",'<td title="Bugs sparkline provides an overview of progress over the last 16 weeks. The numbers shown are: a maximum of bugs fixed/added at any given week out of those 16, and fixed/added in the current calendar week (on the right).">',"<svg class=\"tau-sparkline tau-sparkline-bugs i-role-sparkline\" data-source='<%= JSON.stringify(item.bugsSparkline) %>'></svg>","</td>","<td>",'<div class="tau-fraction tau-bug">','<span title="done"><%= item.team.closedBugsCount %></span><br>','<b title="open"><%= item.team.openBugsCount %></b>',"</div>","</td>",'<td class="tau-nonprintable">','<button class="tau-btn tau-attention" role="action-detach" type="button" ',"data-confirm-message=\"Are you sure you want to remove team '<%! item.team.name %>' from this project?\">Unassign</button>","</td>","</tr>","<% }); %>","</tbody>","</table>","<% }else{ %>",'<div class="tau-message">This project has no teams</div>',"<% }  %>","</div>"]};return templates.register(config)});
define('tau/ui/extensions/list/extension.list.checkEmpty',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus preDataBind":function(evt){var data=evt.data;data.groups.length==0?data.isEmpty=!0:data.isEmpty=!1}})});
define('tau/models/dataProviders/project/project.model.provider.releases_flat.items',["Underscore","tau/models/dataProviders/model.provider.items.base","tau/utils/utils.date"],function(_,BaseProvider,dateUtils){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("releases","release",!1,fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id","name","tags","startDate","endDate"],detailCommand},_convertItem:function(data){var startDate=dateUtils.parse(data.startDate),endDate=dateUtils.parse(data.endDate),isCurrent=!1;dateUtils.Date.today().between(startDate,endDate)&&(isCurrent=!0);var item={id:data.id,name:data.name+(isCurrent?" (current)":""),__type:data.__type,tags:this._processTags(data),startDate:dateUtils.format.date.short(data.startDate),endDate:dateUtils.format.date.short(data.endDate),url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.__type,!0)};return item},_convertData:function(data){return data=this._super(data),this._sortByStartDate(data)},_sortByStartDate:function(items){return _.sortBy(items,function(item){return-1*item.startDate})}})});
define('tau/models/dataProviders/model.provider.members.items',["Underscore","jQuery","tau/models/dataProviders/model.provider.items.base"],function(_,$,BaseProvider){return BaseProvider.extend({sparklineLength:16,fetchStrategy:{project:{collectionName:"projectMembers",typeName:"projectMember"},team:{collectionName:"teamMembers",typeName:"teamMember"}},fetch:function(fnCallback){var entityType=(this.config.context.entity.entityType.name||"").toLowerCase(),fetchStrategy=this.fetchStrategy[entityType];if(!fetchStrategy)throw new Error("Unknown fetch strategy");this._fetch(fetchStrategy.collectionName,fetchStrategy.typeName,null,fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id",{user:["id","firstName","lastName","email","avatarUri","IsAdministrator","isActive","bug-count","userStorie-count"]},{role:["id","name"]}],detailCommand},_fetch:function(collectionName,typeName,importanceTypeName,fnCallback){var self=this,entity=this.config.context.entity,entityType=entity.entityType.name,configurator=this.config.context.configurator;$.ajax({url:configurator.getApplicationPath()+"/api/v2/"+typeName+"?select={"+["id",'"'+typeName+'" as __type',"new("+["User.id","User.firstName","User.lastName","User.email","User.avatarUri","User.isActive","User.isAdministrator",'User.Assignables.Count(entityType.Name == "Bug" AND entityState.IsFinal != true AND '+entityType+".id = "+entity.id+") as bugsCount",'User.Assignables.Count(entityType.Name == "Task" AND entityState.IsFinal != true AND '+entityType+".id = "+entity.id+") as tasksCount",'User.Assignables.Count(entityType.Name == "UserStory" AND entityState.IsFinal != true AND '+entityType+".id = "+entity.id+") as userStoriesCount","User.Assignables.Where("+entityType+".id = "+entity.id+").Sparkline("+this.sparklineLength+") as allSparkline"].join(",")+") as user","new("+["Role.id","Role.name"].join(",")+") as role "].join(",")+"}&where=("+entityType+".id=="+entity.id+")&take=1000"}).done(function(data){fnCallback(self._convertData(data.items))}).fail(function(){fnCallback(self._convertData([]))})},_convertItem:function(data){data.user.name=_.trim(_.asString(data.user.firstName)+" "+_.asString(data.user.lastName))||"",data.user.url="#user/"+data.user.id;var configurator=this.config.context.configurator,r={id:data.id,__type:data.__type,user:data.user,role:data.role,appPath:configurator.getApplicationPath(),doneSparkline:data.user.doneSparkline,allSparkline:data.user.allSparkline};return configurator.getStore().register(r),r}})});
define('tau/ui/extensions/list/members/extension.list.members.action.detach',["tau/core/extension.base.stateful"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,store=this.config.context.configurator.getStore(),entity=this.config.context.entity,entityType=entity.entityType.name,entityMembers=entityType+"Members";$el.delegate("[role=action-detach]","click",function(e){var $button=$(e.target),$item=$button.parents("[role=item]:first"),setData={};setData[entityMembers]={id:$item.data("entityId")},store.removeFromList(entityType,{id:entity.id,$set:setData}).done({success:function(){store.evictProperties(entity.id,entityType,[entityMembers])}})})}})});
define('tau/ui/extensions/list/members/extension.list.members.refresher',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus beforeInit":function(evt,initConfig){var context=initConfig.config.context,configurator=context.configurator,entity=context.entity,entityType=entity.entityType.name,entityMembers=entityType+"Members",self=this,store=configurator.getStore();store.unbind(this),store.on({eventName:"afterSave",type:entityType,listener:this,hasChanges:[entityMembers]},function(){self.fire("refresh")})}})});
define('tau/libs/sparklines/sparklines.user',["tau/libs/sparklines/sparklines"],function(Class){return Class.extend({drawBottom:function(msvg,config){var dt=config.items,legendSpace=config.legendSpace,max=config.max,height=config.height,width=config.width,padding=config.padding,percent=config.percent;if(dt.length==0)return;var svg=msvg.append("g").attr("transform","translate(0,"+height/2+")"),maxData=_.reduce(dt,function(memo,v,index){return v>memo.value?{index:index,value:v}:memo},{index:0,value:dt[0]}),currentValue=_.last(dt);maxData.index==dt.length-1&&(maxData=null);var hasEmptyStart=_.all(dt.slice(0,this.config.emptyStart),function(v){return v==0}),diffData=_.reduce(dt,function(memo,v,index){return memo?memo.concat({diff:v-_.last(memo).to,to:v,from:_.last(memo).to}):[{diff:v,to:v,from:0}]},null),scaleX=d3.scale.ordinal().domain(_.keys(dt)).rangeRoundBands([0,width-legendSpace]),scaleWidth=scaleX.rangeBand(),scaleY=d3.scale.linear().domain([0,max]).range([0,height/2-padding]),scaleHeight=d3.scale.linear().domain([0,max]).range([0,height/2-padding]);svg.selectAll(".tau-sparkline__closedbar").data(dt).enter().append("rect").attr("class","tau-sparkline__closedbar").attr("x",function(data,i){return scaleX(i)+scaleWidth/2-.5}).attr("y",scaleY(0)).attr("height",scaleHeight).attr("width",1),maxData&&svg.selectAll("text").data([maxData]).enter().append("text").text(function(d){return d.value||""}).attr("x",function(data,i){return scaleX(data.index)+(data.index?scaleWidth/2:0)}).attr("y",function(data,i){return scaleY(data.value)+padding}).attr("text-anchor",function(data,i){return data.index?data.index==dt.length-1?"right":"middle":"left"}),svg.selectAll("text.legend").data([currentValue]).enter().append("text").attr("class","legend").text(function(d){return d}).attr("x",function(data,i){return width-legendSpace}).attr("y",function(data){return scaleY(data)-padding/2<scaleY(0)?padding/2:scaleY(data)}).attr("text-anchor","right").attr("dx",percent).attr("dy",(padding-percent)/2),hasEmptyStart&&config.emptyStartLabel&&svg.selectAll("text.tau-sparkline__emptylegend").data([config.emptyStartLabel]).enter().append("text").attr("class","tau-sparkline__emptylegend").text(function(d){return d||""}).attr("x",function(data,i){return scaleX(0)}).attr("y",function(data){return scaleY(0)+padding/2+2}).attr("text-anchor","left").attr("dx",percent).attr("dy",(padding-percent)/2)}})});
define('tau/ui/extensions/list/members/extension.list.members.sparklines',["tau/core/extension.base","tau/libs/sparklines/sparklines.user"],function(ExtensionBase,Sparklines){return ExtensionBase.extend({"bus dataBind + afterRender":function(evt,data,renderData){var $el=renderData.element,$sp=$el.find(".i-role-sparkline"),conf={width:100,height:50,letterWidth:9,letterHeight:9};$sp.each(function(){var sparklines=new Sparklines(conf);sparklines.draw(null,this)})}})});
define('tau/ui/templates/list_/ui.template.list.members',["tau/core/templates-factory"],function(templates){var config={name:"list.members",engine:"jqote2",markup:['<div class="tau-teamView">','<% var name = this.config&&this.config.currentView.name||"team"; %>',"<% if (this.items.length){ %>",'<table class="tau-table">',"<colgroup>",'<col class="tau-teamView-people">','<col class="tau-teamView-role">','<col class="tau-teamView-activity">','<col class="tau-teamView-assignments">','<col class="tau-teamView-actions tau-nonprintable">',"</colgroup>","<thead>","<tr>","<th>People</th>","<th>Role</th>","<th>Activity</th>","<th>Assignments</th>",'<th class="tau-nonprintable"></th>',"</tr>","</thead>","<tbody>","<% _.forEach(this.items, function(item){ %>",'<tr class="<% if (!item.user.isActive){ %>tau-inactive-tr<% } %> i-role-item" role="item" data-entity-id="<%= item.id %>">',"<td>",'<div class="tau-user-info">','<a href="<%= item.user.url %>">','<img width="20" height="20" alt="" class="tau-avatar" src="<%= item.user.avatarUri %>20">',"</a>",'<div class="tau-user-personal-data">','<div class="tau-name"><a href="<%= item.user.url %>"><%! item.user.name %></a></div>','<div class="tau-email"><a href="<%= item.user.url %>"><%! item.user.email %></a></div>',"</div>","</div>","</td>","<td>","<div>",'<span runas="property.role.modern" data-context:general:id="<%= item.id %>" data-context:general:entity-type:name="<%=name%>Member">',"<%! item.role.name %>","</span>","</div>","<% if (item.user.isAdministrator){ %>",'<span class="tau-user-system-role">admin</span>',"<% } %>","<% if (!item.user.isActive){ %>",'<span class="tau-user-system-role tau-user-system-role-inactive">inactive</span>',"<% } %>","</td>",'<td title="Activity sparkline provides an overview of progress over the last 16 weeks. The numbers shown are: a maximum of assignments done/added at any given week out of those 16, and done/added in the current calendar week (on the right).">',"<svg class=\"tau-sparkline tau-sparkline-user i-role-sparkline\" data-source='<%= JSON.stringify(item.allSparkline) %>'></svg>","</td>","<td>",'<div class="tau-user-assignments">','<span title="open tasks"><i class="tau-entity-icon tau-task">T</i><b><%= item.user.tasksCount %></b></span>','<span title="open bugs"><i class="tau-entity-icon tau-bug">B</i><b><%= item.user.bugsCount %></b></span>','<span title="open user stories"><i class="tau-entity-icon tau-userstory">U</i><b><%= item.user.userStoriesCount %></b></span>',"</div>","</td>",'<td class="tau-nonprintable"><button type="button" class="tau-btn tau-attention" role="action-detach">Remove from <%=name%></button></td>',"</tr>","<% },this); %>","</tbody>","</table>","<% }else{ %>",'<div class="tau-message">There are no people in this <%=name%></div>',"<% }  %>","</div>"]};return templates.register(config)});
define('tau/configurations/project.container.config',["tau/configurations/baseContainable.container.config","tau/models/model.extensions","tau/models/dataProviders/project/project.model.provider.releases.items","tau/models/dataProviders/project/project.model.provider.releases.groups","tau/models/dataProviders/project/project.model.provider.teams.items","tau/ui/extensions/list/project/ui.extension.list.project.teams.action.detach","tau/ui/extensions/list/project/ui.extension.list.project.teams.refresher","tau/ui/extensions/list/project/ui.extension.list.project.teams.sparklines","tau/ui/templates/list_/project/ui.template.list.project.teams","tau/ui/extensions/list/extension.list.checkEmpty","tau/models/dataProviders/project/project.model.provider.releases_flat.items","tau/models/dataProviders/model.provider.members.items","tau/ui/extensions/list/members/extension.list.members.action.detach","tau/ui/extensions/list/members/extension.list.members.refresher","tau/ui/extensions/list/members/extension.list.members.sparklines","tau/ui/templates/list_/ui.template.list.members"],function(BaseConfig,modelExtensions,ReleasesItemsDataProvider,ReleasesGroupsDataProvider,TeamsItemsDataProvider,TeamsDetachExtension,TeamsRefreshExtension,TeamsSparklinesExtension,TeamsTemplate,ReleasesEmptyExtension,ReleasesFlatItemsDataProvider,MembersItemsDataProvider,MembersDetachExtension,MembersRefreshExtension,MembersSparklinesExtension,MembersTemplate){var Config=BaseConfig.extend({colors:["#f9d9d1","#fbe9d6","#fdfadb","#e2eece","#d2ecea","#ceeefa","#d2e0ef","#dddceb","#f5d2e2","#e0e0e0"],init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig);var entity=appConfig.context.entity;appConfig.context.configurator.getUrlBuilder(),this.registerAdditionalInfoItem("Owner",{label:{type:"label",text:"Owner"},field:{type:"property.owner.project"}}),this.registerAdditionalInfoItem("Abbreviation",{label:{type:"label",text:"Abbreviation"},field:{type:"property.abbreviation",cssClass:"abbr",editable:!0}}),this.registerAdditionalInfoItem("Color",{label:{type:"label",text:"Color"},field:{type:"property.color",values:this.colors}}),this.registerAdditionalInfoItem("Reply Email",{label:{type:"label",text:"Reply Email"},field:{type:"property.email",editable:!0}}),this.registerAdditionalInfoItem("IsActive",{label:{type:"label",text:"Active?"},field:{type:"property.isActive",editable:!0}}),this.registerAdditionalInfoItem("IsProduct",{label:{type:"label",text:"Product?"},field:{type:"property.IsProduct",editable:!0}}),this.registerAdditionalInfoItem("Company",{label:{type:"label",text:"Company"},field:{type:"property.company",editable:!0}}),this.registerAdditionalInfoItem("Program",{label:{type:"label",text:"Program"},field:{type:"property.program",editable:!0}}),this.registerAdditionalInfoItem("Process",{label:{type:"label",text:"Process"},field:{type:"property.process",editable:!0}}),this.registerAdditionalInfoItem("StartDate",{label:{type:"label",text:"Start Date"},field:{type:"property.startDate.project",editable:!0}}),this.registerAdditionalInfoItem("EndDate",{label:{type:"label",text:"End Date"},field:{type:"property.endDate.project",editable:!0}});var self=this,e=["board","hasTeams"];this.registerTab("Teams",{cssClass:"tau-teamsProjects-tab",label:"teams",editions:e,header:[{type:"label",text:self.getNames("team"),countFieldNames:["teamProjects"],editions:e}],items:[{type:"container",editions:e,layout:"selectable",template:{name:"user.team.tab",markup:['<div class="tau-teamsProjects-tab" role="center"></div>']},children:[{type:"finder.team.byProject",selector:"[role=center]",printable:!1},{type:"list",selector:"[role=center]",itemsDataProvider:TeamsItemsDataProvider,sortable:!1,extensions:[TeamsDetachExtension,TeamsRefreshExtension,TeamsSparklinesExtension],template:TeamsTemplate,views:[{type:"grid.entity",emptyMessage:"No teams have been assigned",rowTemplateName:"list-grid-entity__rowteam_project"}]}]}]}),this.registerTab("People",{label:"people",header:[{type:"label",text:"People",countFieldNames:["projectMembers"]}],items:[{type:"container",layout:"selectable",template:{name:"user.project.tab",markup:['<div class="tau-teamsProjects-tab" role="center"></div>']},children:[{type:"inviter",selector:"[role=center]"},{type:"list.editable",selector:"[role=center]",itemsDataProvider:MembersItemsDataProvider,sortable:!1,extensions:[MembersDetachExtension,MembersRefreshExtension,MembersSparklinesExtension],template:MembersTemplate,views:[{type:"grid.entity",name:"project",emptyMessage:"No teams have been assigned",rowTemplateName:"list-grid-entity__rowteam_project"}]}]}]}),this.registerTab("Releases",{practices:["Iterations"],label:"releases",header:[{type:"label",text:self.getNames("release"),countFieldNames:["releases"]}],items:[{practices:["Iterations"],type:"list.editable",itemsDataProvider:ReleasesItemsDataProvider,groupsDataProvider:ReleasesGroupsDataProvider,extensions:[ReleasesEmptyExtension],externalRefreshEvents:["release.items.added"],groupBy:"release.id",sortable:!1,views:[{type:"grid.entity",group:{dataIndex:"id"}}]}]}),this.registerTab("Releases (flat)",{practices:["~Iterations"],label:"releases-flat",header:[{type:"label",text:self.getNames("release"),countFieldNames:["releases"]}],items:[{practices:["~Iterations"],type:"list.editable",itemsDataProvider:ReleasesFlatItemsDataProvider,sortable:!1,externalRefreshEvents:["release.items.added"],views:[{type:"grid.entity"}]}]})},getAdditionalInfoAliases:function(){return["Abbreviation","Color","Owner","IsActive","IsProduct","Program","Company","Process","StartDate","EndDate","Reply Email"]},getActionsAliases:function(){return["Old View","Old Edit","Print","-----","Delete"]},getEntityQuickAddOptions:function(){return{items:[{entityType:"release",relationName:"releases"}]}},getTabsAliases:function(){return["Description","Teams","People","Releases","Releases (flat)","Relations"]}});return Config});
define('tau/models/extensions/container/container.save.freezer',["Underscore","tau/core/event.emitter"],function(_,EventEmitter){return EventEmitter.extend({init:function(config){this._super.apply(this,arguments),this.setQueueBusForComponents(config.children),this.suspendedEvents=[]},setQueueBusForComponents:function(children){for(var i=0;i<children.length;i++){var child=children[i];child["queue.bus"]=!0,this.setQueueBusForComponents(child.children||[])}},handleChildComponentCreated:function(evt){evt.data.on("before_save",this.onBeforeSave,this),evt.data.on("childComponentCreated",this.handleChildComponentCreated,this)},"bus childComponentCreated":function(evt){this.handleChildComponentCreated(evt)},onBeforeSave:function(evt){evt.suspendMain(),this.fire("event.suspended",evt),this.suspendedEvents=_.reject(this.suspendedEvents,function(suspendedEvent){return suspendedEvent.sender===evt.sender}),this.suspendedEvents.push(evt)},"bus resumeSave":function(){_.each(this.suspendedEvents,function(evt){evt.resumeMain()})}})});
define('tau/components/extensions/user.view/user.view',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"edit","bus componentsCreated":function(e){var btnUpdateComponent=_.find(e.data,function(componentInfo){return componentInfo.component.name=="btnUpdateSettings"});this.fire("update.button.found",btnUpdateComponent.component)},"bus update.button.found":function(evt){evt.data.on("view.button.click",this.onButtonClickHandler,this)},"bus update.button.found:last+event.suspended":function(evt){evt["update.button.found"].data.fire("enable")},"bus update.button.found:last+before_resumeSave":function(evt){evt["update.button.found"].data.fire("disable")},onButtonClickHandler:function(){this.fire("resumeSave")}})});
define('tau/models/dataProviders/user/user.model.provider.assignments.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){var userId=this.config.context.entity.id,storeChain=this.config.store,self=this,impedimentFields=["id",{entityType:["id","name"]},"name","numericPriority","tags","isPrivate",{entityState:this.fields.entityStateWithComment},{owner:["id","firstName","lastName","avatarUri"]},{responsible:["id","firstName","lastName","avatarUri"]},{project:["id","abbreviation"]}],userFilter={id:userId},assignmentsCmd={fields:[{assignable:["id",{entityType:["id","name"]},"name","numericPriority","tags","effort","effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:this.fields.entityStateWithComment},{roleEfforts:["id","effort","effortToDo",{role:["id","name","isPair","hasEffort"]}]},{assignments:["id",{role:["id"]},{generalUser:self.fields.generalUser}]},{project:["id","abbreviation"]}]}],$query:{assignable:{entityState:{isFinal:0},project:{isActive:1}},generalUser:userFilter}},actions=[function(next){storeChain.find("assignment",assignmentsCmd).done(function(result){var data=_.pluck(result[0].data,"assignable");_.map(data,function(item){item.__type="assignable"}),next(!1,data)})},function(next){storeChain.find("impediment",{fields:impedimentFields,$query:{entityState:{isFinal:0},responsible:userFilter}}).done(function(result){next(!1,result[0].data)})}];_.series(actions,function(err,result){var assignments=[];_.each(result,function(item){assignments=assignments.concat(item)});var result=self._convertData(assignments);fnCallback(result)})},_convertData:function(data){return data=this._super(data),this._calculateEffortToMaximum(_.filter(data,function(item){return item.__type=="assignable"})),data=this._removeDuplicates(data),this._sortByPriority(data)},_removeDuplicates:function(data){var ids={},filteredData=_.filter(data,function(item){var wasAdded=ids.hasOwnProperty(item.id);return ids[item.id]=!0,0==wasAdded});return filteredData},_convertItem:function(data){var item={id:data.id,name:data.name,numericPriority:data.numericPriority,__type:data.entityType.name,entityState:{id:data.entityState.id,name:data.entityState.name,isInitial:data.entityState.isInitial,isFinal:data.entityState.isFinal,numericPriority:data.entityState.numericPriority},tags:this._processTags(data),projectId:data.project?data.project.id:undefined,project:data.project,entitiesCount:0,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.id,data.entityType.name,!0)};return data.__type=="assignable"?_.extend(item,{assignments:this._processAssignments(data),effort:this._getEffortData(data)}):data.__type=="impediment"&&_.extend(item,{responsible:data.responsible,effortMock:{}}),item.visibleEntityState=item.entityState,item}})});
define('tau/models/model.list.open.assignments',["Underscore","tau/core/model-base"],function(_,ModelBase){var entityListModel,itemsAssignmentsCount=0;return entityListModel=ModelBase.extend({name:"model.list.open.assignments",createSubscription:function(type,fnDetect){var self=this,loggedUser=this.config.context.applicationContext.loggedUser,userCardId=this.config.context.entity.id;self.store.on({eventName:"afterSave",type:type,listener:self},function(evt){var entityId=evt.data.id;evt.data&&evt.data.cmd&&evt.data.cmd.type=="assignment"&&fnDetect(entityId)&&self.store.get(type,{id:entityId,fields:[{assignments:[{generalUser:["id"]}]}]}).done(function(result){var assignments=result[0].data.assignments,userAssignment=_.find(assignments,function(assigment){return assigment.generalUser.id===userCardId});if(assignments.length===0||userAssignment===undefined)itemsAssignmentsCount--,itemsAssignmentsCount===0&&self.fire("refresh"),self.fire("model.assignment.did.removed",{id:entityId})})}),self.store.on({eventName:"beforeSave",type:type,listener:self},function(evt){var removedEntityId=evt.data.id;if(fnDetect(removedEntityId)&&evt.data.changes.entityState){var cmd=evt.data.cmd,include=cmd.config.$include=cmd.config.$include||[];include.push({entityState:["id","isFinal"]})}}),self.store.on({eventName:"afterSave",type:type,listener:self},function(evt){var entityId=evt.data.id;if(fnDetect(entityId)){var entityState=evt.data.changes.entityState;if(entityState)self.store.get("entityState",{id:entityState.id,fields:["isFinal"]}).done(function(r){var stateData=r[0].data;stateData.isFinal&&(itemsAssignmentsCount--,itemsAssignmentsCount===0&&self.fire("refresh"),self.fire("model.assignment.did.removed",{id:entityId}))});else{var responsible=evt.data.changes.responsible;responsible&&(itemsAssignmentsCount--,itemsAssignmentsCount===0&&self.fire("refresh"),self.fire("model.assignment.did.removed",{id:entityId}))}}})},"bus afterItemsProvided":function(e){var self=this,items=e.data.data;itemsAssignmentsCount=items.length;if(items&&items.length){var isItemDetected=function(entityId){return _(items).detect(function(item){return item.id==entityId})};_(items).chain().map(function(item){return item.__type}).unique().each(function(type){self.createSubscription(type,isItemDetected)})}}}),entityListModel});
define('tau/ui/extensions/list/open.assignments/extension.list.open.assignments',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({getRowElement:function($el,entityId){var $row=$el.find(".i-item-"+entityId).parents(".tau-list__list__item");return $row},"bus afterRender:last+model.assignment.did.removed":function(evt,afterRender,changeStateData){var element=afterRender.element,$row=this.getRowElement(element,changeStateData.id);this.fire("markElementToBeDeleted",{element:$row}),$row.slideUp("slow"),this.fire("deleteElement",{element:$row,callback:$.noop})}})});
define('tau/ui/extensions/ui.extension.add.css',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({category:"edit","bus afterRender":function(evt){this.config.hasOwnProperty("cssClass")&&evt.data.element.addClass(this.config.cssClass)}})});
define('tau/models/dataProviders/user/user.model.provider.teams.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("teamMembers","teamMember",null,fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id",{team:["id","name","icon"]},{role:["id","name"]}],detailCommand},_convertData:function(data){var result=this._super(data);return _.sortBy(result,function(v){return v.team.name.toLowerCase()})},_convertItem:function(data){var item={id:data.id,__type:"teamMember",team:data.team,role:data.role,uri:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.team.id,"team",!0)};return item}})});
define('tau/ui/extensions/list/user/ui.extension.list.user.teams.refresh',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,entity=initConfig.config.context.entity,store=configurator.getStore(),self=this;configurator.getGlobalBus().unbind(this),configurator.getGlobalBus().on("teamsAndUsers.connected",function(){store.evictProperties(entity.id,entity.entityType.name,["teamMembers"]),self.fire("refresh")},this),store.unbind(this);var after=function(){};store.on({eventName:"afterSave",type:"team",listener:this},after)},"bus beforeInit:last + destroy":function(evt,initConfig){var configurator=initConfig.config.context.configurator;configurator.getGlobalBus().unbind(this),configurator.getStore().unbind(this)}})});
define('tau/ui/extensions/list/user/ui.extension.list.user.action.detach',["tau/core/extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterInit + afterRender":function(evt,initConfig,renderData){var $el=renderData.element,store=initConfig.config.context.configurator.getStore(),entity=initConfig.config.context.entity;$el.delegate("[role=action-detach]","click",function(e){var $button=$(e.target);if($button.data("confirmMessage")&&!confirm($button.data("confirmMessage")))return;var $item=$button.parents("[role=item]:first"),relatedData=$item.data(),set={};set[relatedData.entityType+"s"]={id:relatedData.entityId};var relatedMainName=relatedData.entityType.toLowerCase()=="projectmember"?"project":"team";store.removeFromList(relatedMainName,{id:relatedData[relatedMainName+"Id"],$set:set}).done({success:function(){$item.remove(),store.evictProperties(entity.id,entity.entityType.name,[relatedMainName=="project"?"projectMembers":"teamMembers"])}})})}})});
define('tau/ui/templates/list_/user/ui.template.list.user.teams',["tau/core/templates-factory"],function(templates){var config={name:"list.user.teams",engine:"jqote2",markup:["<div>","<% if (this.items.length == 0){ %>",'<div class="tau-message">User doesn\'t belong to any team</div>',"<% } else { %>",'<div class="tau-user-team-list">','<table class="tau-table">',"<colgroup>",'<col class="tau-team-name-col">','<col class="tau-role">','<col class="tau-remove-person">',"</colgroup>","<thead>","<tr>","<th>Team</th>","<th>Role</th>","<th></th>","</tr>","</thead>","<tbody>","<% _.forEach(this.items, function(item){ %>",'<tr class="i-role-item" role="item" data-entity-id="<%= item.id %>" data-entity-type="<%= item.__type.toLowerCase() %>"  data-team-id="<%= item.team.id %>">',"<td>",'<div class="tau-team-name">','<a href="<%= item.uri %>"><i class="tau-icon tau-icon_type_svg <% if (item.team.icon){ %>tau-icon_name_<%= item.team.icon  %><% } %>"></i><span><%! item.team.name %></span></a>',"</div>","</td>","<td>",'<div class="tau-team-user-role" runas="property.role.modern" data-context:general:id="<%= item.id %>" data-context:general:entity-type:name="<%= item.__type %>">',"<%! item.role.name %>","</div>","</td>","<td>",'<button class="tau-btn tau-attention" role="action-detach" type="button">Remove from team</button>',"</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","<% }  %>","</div>"]};return templates.register(config)});
define('tau/models/dataProviders/user/user.model.provider.projects.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){this._fetch("projectMembers","projectMember",null,fnCallback)},_createDetailCommand:function(collectionType){var detailCommand={};return detailCommand[collectionType]=["id",{project:["id","name","color"]},{role:["id","name"]}],detailCommand},_createQuery:function(collectionType){return{project:{isActive:1}}},_convertData:function(data){var result=this._super(data);return result=_.filter(result,function(v){return v.project}),_.sortBy(result,function(v){return v.project.name.toLowerCase()})},_convertItem:function(data){var item={id:data.id,__type:"projectMember",project:data.project,role:data.role,uri:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.project.id,data.project.__type,!0)};return item}})});
define('tau/ui/extensions/list/user/ui.extension.list.user.projects.refresh',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,entity=initConfig.config.context.entity,store=configurator.getStore(),self=this;configurator.getGlobalBus().unbind(this),configurator.getGlobalBus().on("projectsAndUsers.connected",function(data){store.evictProperties(entity.id,entity.entityType.name,["projectMembers"]),self.fire("refresh")},this),store.unbind(this);var after=function(){};store.on({eventName:"afterSave",type:"project",listener:this},after)},"bus beforeInit:last + destroy":function(evt,initConfig){var configurator=initConfig.config.context.configurator;configurator.getGlobalBus().unbind(this),configurator.getStore().unbind(this)}})});
define('tau/ui/templates/list_/user/ui.template.list.user.projects',["tau/core/templates-factory"],function(templates){var config={name:"list.user.projects",engine:"jqote2",markup:["<% if (this.items.length == 0){ %>",'<div class="tau-message">User doesn\'t belong to any project</div>',"<% } else { %>",'<div class="tau-user-project-list">','<table class="tau-table">',"<colgroup>",'<col class="tau-project-name">','<col class="tau-role">','<col class="tau-remove-person">',"</colgroup>","<thead>","<tr>","<th>Project</th>","<th>Role</th>","<th></th>","</tr>","</thead>","<tbody>","<% _.forEach(this.items, function(item){ %>",'<tr class="i-role-item" role="item" data-entity-id="<%= item.id %>" data-entity-type="<%= item.__type.toLowerCase() %>" data-project-id="<%= item.project.id %>">',"<td>",'<div class="tau-project-name">','<a href="<%= item.uri %>"><i  <% if (item.project.color){ %> style="background-color: <%= item.project.color %>; "<% } %> class="tau-icon tau-icon_type_color"></i><span><%! item.project.name %></span></a>',"</div>","</td>","<td>",'<div class="tau-team-user-role" runas="property.role.modern" data-context:general:id="<%= item.id %>" data-context:general:entity-type:name="<%= item.__type %>">',"<%! item.role.name %>","</div>","</td>","<td>",'<button class="tau-btn tau-attention" role="action-detach" type="button">Remove from project</button>',"</td>","</tr>","<% }); %>","</tbody>","</table>","</div>","<% }  %>","</div>"]};return templates.register(config)});
define('tau/ui/templates/property/ui.template.property.title',["tau/core/templates-factory"],function(templates){var config={name:"property.title",engine:"jqote2",markup:['<div class="user-title property-text user-title-<%! this.name %>" data-placeholder="<%! this.placeholderText %>">',"<%! _.asString(this.output) %>","</div>"]};return templates.register(config)});
define('tau/configurations/user.container.config',["tau/configurations/base.container.config","tau/models/extensions/container/container.save.freezer","tau/components/extensions/user.view/user.view","tau/models/dataProviders/user/user.model.provider.assignments.items","tau/models/model.list.open.assignments","tau/ui/extensions/list/open.assignments/extension.list.open.assignments","tau/ui/extensions/list/request/extension.list.entityState","tau/ui/extensions/ui.extension.add.css","tau/core/termProcessor","tau/models/dataProviders/user/user.model.provider.teams.items","tau/ui/extensions/list/user/ui.extension.list.user.teams.refresh","tau/ui/extensions/list/user/ui.extension.list.user.action.detach","tau/ui/templates/list_/user/ui.template.list.user.teams","tau/models/dataProviders/user/user.model.provider.projects.items","tau/ui/extensions/list/user/ui.extension.list.user.projects.refresh","tau/ui/extensions/list/user/ui.extension.list.user.action.detach","tau/ui/templates/list_/user/ui.template.list.user.projects","tau/ui/templates/property/ui.template.property.title"],function(BaseContainerConfig,ContainerSaveFreezerExtension,UserViewExtension,AssignmentsItemsDataProvider,ModelOpenAssignments,ExtensionOpenAssignments,EntityStateListExtension,ExtensionAddClass,TermProcessor,TeamsItemsDataProvider,TeamsRefreshExtension,TeamsDetachExtension,TeamsTemplate,ProjectsItemsDataProvider,ProjectsRefreshExtension,ProjectsDetachExtension,ProjectsTemplate,PropertyTitleTemplate){var UserContainerConfig=BaseContainerConfig.extend({init:function(appConfig){this._super(appConfig),this.registerTab("Assignments",{selected:!0,label:"assignments",header:[{type:"label",text:"Open Assignments"}],items:[{type:"list.editable",itemsDataProvider:AssignmentsItemsDataProvider,extensions:[ModelOpenAssignments,ExtensionOpenAssignments],multiprojects:!0,views:[{type:"grid.entity"}]}]}),this.registerTab("Account Settings",{label:"accountSettings",header:[{type:"label",text:"Account Settings"}],items:[{type:"user.settings"}]}),this.registerTab("Teams and Projects",{label:"teams-projects",header:[{type:"label",text:[this.getNames("team"),this.getNames("project")]}],items:[{type:"container",layout:"selectable",template:{name:"user.teamprojects.tab",markup:['<div class="tau-teamsProjects-tab">','<div class="tau-half-col" role="left"></div>','<div class="tau-half-col tau-right"  role="right"></div>',"</div>"].join("")},children:[{type:"finder.team.byUser",selector:"[role=left]"},{selector:"[role=left]",type:"list.editable",itemsDataProvider:TeamsItemsDataProvider,sortable:!1,extensions:[TeamsRefreshExtension,TeamsDetachExtension],template:TeamsTemplate},{type:"finder.project.byUser",selector:"[role=right]"},{selector:"[role=right]",type:"list.editable",itemsDataProvider:ProjectsItemsDataProvider,sortable:!1,extensions:[ProjectsRefreshExtension,ProjectsDetachExtension],template:ProjectsTemplate}]}]})},getTabsAliases:function(){return["Assignments","Account Settings","Teams and Projects"]},getPanelsAliases:function(){return[]},getAdditionalInfoAliases:function(){return[]},getConfig:function(appConfig){var terms=appConfig.context.getTerms(),configurator=appConfig.context,entityId=configurator.entity.id,userLogged=configurator.getLoggedUser(),isAllowedEdit=entityId===userLogged.id||userLogged.isAdministrator;return this.termProcessor=new TermProcessor(terms),{children:[{type:"container",name:"main entity container",layout:"list",cssClass:"main-container tau-user-view",cellsCssClass:["general-info","additional-info"],children:[{type:"breadcrumbs",fields:["firstName","lastName"]},{type:"container",layout:"table",children:[{type:"avatar",isEdit:isAllowedEdit},{type:"container",name:"main entity container",layout:"list",children:[{type:"container",layout:"table",children:[{type:"property.text",propertyName:"firstName",restoreText:!0,editable:isAllowedEdit,placeholderText:"first name",template:PropertyTitleTemplate},{type:"property.text",propertyName:"lastName",restoreText:!0,editable:isAllowedEdit,placeholderText:"last name",template:PropertyTitleTemplate}]},{type:"property.role",propertyName:"lastName",cssClass:"tau-role",extensions:[ExtensionAddClass],editable:!0}]}]},{type:"container",name:"general info column container",children:[{type:"tabs",cssClass:"tau-tabs",stateName:"generalTab",tabs:this.getTabs(appConfig)}]}]}]}}});return UserContainerConfig});
define('tau/models/dataProviders/team/team.model.provider.projects.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({sparklineLength:16,fetch:function(fnCallback){this._fetch("teamProjects","teamProject",!1,fnCallback)},_fetch:function(collectionName,typeName,importanceTypeName,fnCallback){var self=this,entity=this.config.context.entity,configurator=this.config.context.configurator;$.ajax({url:configurator.getApplicationPath()+"/api/v2/TeamProject?select={"+["id",'"TeamProject" as __type',"new("+["Project.id","Project.name","Project.color","Project.Bugs.Count(entityState.IsFinal != true AND Team.id = "+entity.id+") as openBugsCount","Project.Bugs.Count(entityState.IsFinal == true AND Team.id = "+entity.id+") as closedBugsCount","Project.UserStories.Count(entityState.IsFinal != true AND Team.id = "+entity.id+") as openUsCount","Project.UserStories.Count(entityState.IsFinal == true AND Team.id = "+entity.id+") as closedUsCount","Project.UserStories.Where(Team.id = "+entity.id+").Sparkline("+this.sparklineLength+") as userStoriesSparkline","Project.Bugs.Where(Team.id = "+entity.id+").Sparkline("+this.sparklineLength+") as bugsSparkline"].join(",")+") as project"].join(",")+"}&where=(Team.id=="+entity.id+")"}).done(function(data){fnCallback(self._convertData(data.items))}).fail(function(){fnCallback(self._convertData([]))})},_convertData:function(data){return data=this._super(data),this._sortByPriority(data)},_sortByPriority:function(items){return _.sortBy(items,function(item){return item.id*-1})},_convertItem:function(data){var usp=data.project.userStoriesSparkline,bsp=data.project.bugsSparkline,item={id:data.id,__type:"teamProject",project:data.project,uri:this.config.context.configurator.getUrlBuilder().getNewViewUrl(data.project.id,"project",!0),appPath:this.config.context.configurator.getApplicationPath(),userStoriesSparkline:usp,bugsSparkline:bsp};return item}})});
define('tau/ui/extensions/list/team/projects/ui.extension.list.team.projects.action.detach',["tau/core/extension.base.stateful"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,store=this.config.context.configurator.getStore(),entity=this.config.context.entity,bus=this.bus,self=this;$el.delegate("[role=action-detach]","click",function(e){var $button=$(e.target);if(!confirm($button.data("confirmMessage")))return;var $item=$button.parents("[role=item]:first"),relatedData=$item.data();store.removeFromList("team",{id:entity.id,$set:{teamProjects:{id:relatedData.entityId}}}).done({success:function(){store.evictProperties(entity.id,"team",["teamProjects"]),self.fire("project.detached")}})})},"bus beforeInit:last + project.detached":function(evt,initConfig){var configurator=initConfig.config.context.configurator,entity=this.config.context.entity,store=configurator.getStore();store.get("team",{id:entity.id,fields:["id",{teamProjects:["id"]}]}).done({success:function(){},failure:function(){alert("You don't have access to this team now"),configurator.getHistory().exclude(entity.id),configurator.service("navigator").back()}})}})});
define('tau/ui/extensions/list/team/projects/ui.extension.list.team.projects.refresher',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,store=configurator.getStore(),self=this;store.unbind(this),store.on({eventName:"afterSave",type:"team",listener:this,hasChanges:["teamProjects"]},function(){self.fire("refresh")})}})});
define('tau/ui/extensions/list/team/projects/ui.extension.list.team.projects.sparklines',["tau/core/extension.base","tau/libs/sparklines/sparklines"],function(ExtensionBase,Sparklines){return ExtensionBase.extend({"bus dataBind + afterRender":function(evt,data,renderData){var $el=renderData.element,$sp=$el.find(".i-role-sparkline"),conf={width:100,height:50,letterWidth:9,letterHeight:9};$sp.each(function(){var sparklines=new Sparklines(conf);sparklines.draw(null,this)})}})});
define('tau/ui/templates/list_/team/ui.template.list.team.projects',["tau/core/templates-factory"],function(templates){var config={name:"list.team.projects",engine:"jqote2",markup:['<div class="tau-team-control">',"<% if (this.items.length){ %>",'<table class="tau-team-info">',"<colgroup>",'<col class="tau-team">','<col class="tau-us-progress">','<col class="tau-us-total">','<col class="tau-bug-progress">','<col class="tau-bug-total">','<col class="tau-actions tau-nonprintable">',"</colgroup>","<thead>","<tr>","<th>Project</th>",'<th><i class="tau-entity-icon tau-userstory">U</i>User&nbsp;Stories</th>',"<th>Done / Open</th>",'<th><i class="tau-entity-icon tau-bug">B</i>Bugs</th>',"<th>Done / Open</th>",'<th class="tau-nonprintable"></th>',"</tr>","</thead>","<tbody>","<% _.forEach(this.items, function(item){ %>",'<tr class="i-role-item" role="item" data-entity-id="<%= item.id %>">',"<td>",'<div class="tau-project-name">',"<h3>",'<a href="<%= item.uri %>">','<i <% if (item.project.color) { %>style="background-color: <%= item.project.color %>;"<% } %> class="tau-icon tau-icon_type_color"></i>',"<%! item.project.name %>","</a>","</h3>","</div>","</td>",'<td  title="User Stories sparkline provides an overview of progress over the last 16 weeks. The numbers shown are: a maximum of user stories done/added at any given week out of those 16, and done/added in the current calendar week (on the right).">',"<svg class=\"tau-sparkline i-role-sparkline\" data-source='<%= JSON.stringify(item.userStoriesSparkline) %>'></svg>","</td>","<td>",'<div class="tau-fraction tau-userstory">','<span title="done"><%= item.project.closedUsCount %></span><br>','<b  title="open"><%= item.project.openUsCount %></b>',"</div>","</td>",'<td title="Bugs sparkline provides an overview of progress over the last 16 weeks. The numbers shown are: a maximum of bugs fixed/added at any given week out of those 16, and fixed/added in the current calendar week (on the right).">',"<svg class=\"tau-sparkline tau-sparkline-bugs i-role-sparkline\" data-source='<%= JSON.stringify(item.bugsSparkline) %>'></svg>","</td>","<td>",'<div class="tau-fraction tau-bug" >','<span title="done"><%= item.project.closedBugsCount %></span><br>','<b title="open"><%= item.project.openBugsCount %></b>',"</div>","</td>",'<td class="tau-nonprintable">','<button class="tau-btn tau-attention" role="action-detach" type="button" ',"data-confirm-message=\"Are you sure you want to remove project '<%! item.project.name %>' from this team?\">Unassign</button>","</td>","</tr>","<% }); %>","</tbody>","</table>","<% }else{ %>",'<div class="tau-message">This team has no projects</div>',"<% }  %>","</div>"]};return templates.register(config)});
define('tau/configurations/team.container.config',["tau/configurations/baseContainable.container.config","tau/models/dataProviders/team/team.model.provider.projects.items","tau/ui/extensions/list/team/projects/ui.extension.list.team.projects.action.detach","tau/ui/extensions/list/team/projects/ui.extension.list.team.projects.refresher","tau/ui/extensions/list/team/projects/ui.extension.list.team.projects.sparklines","tau/ui/templates/list_/team/ui.template.list.team.projects","tau/models/dataProviders/model.provider.members.items","tau/ui/extensions/list/members/extension.list.members.action.detach","tau/ui/extensions/list/members/extension.list.members.refresher","tau/ui/extensions/list/members/extension.list.members.sparklines","tau/ui/templates/list_/ui.template.list.members"],function(BaseConfig,ProjectsItemsDataProvider,ProjectsDetachExtension,ProjectsRefreshExtension,ProjectsSparklinesExtension,ProjectsTemplate,MembersItemsDataProvider,MembersDetachExtension,MembersRefreshExtension,MembersSparklinesExtension,MembersTemplate){var Config=BaseConfig.extend({icons:["apple","windows","linux","chrome","firefox","internet_explorer","apache","wrench","binoculars","camcorder","camera","money","gamepad","traveler","finish","achievement","help","call_center","stethoscope","wand","horn","bug","skype","phone","pulse","thermometer","book","food","ball","gun","rabbit","airplane","truck","helicopter","spades","laugh","sunglasses","angry","skull","doctor","shamrock","sun","umbrella","knight","fish","ufo","smile","batman","superman","captain_america","flash","shield","star"],init:function(appConfig){BaseConfig.prototype.init.call(this,appConfig),this.registerAdditionalInfoItem("Icon",{label:{type:"label",text:"Icon"},field:{type:"property.icon",values:this.icons}}),this.registerAdditionalInfoItem("Abbreviation",{label:{type:"label",text:"Abbreviation"},field:{type:"property.abbreviation",cssClass:"abbr",editable:!0}}),this.registerTab("Projects",{label:"projects",header:[{type:"label",text:this.getNames("project"),countFieldNames:["teamProjects"]}],items:[{type:"container",layout:"selectable",template:{name:"team.projects.tab",markup:['<div class="tau-teamsProjects-tab" role="center"></div>']},children:[{type:"finder.project.byTeam",selector:"[role=center]",printable:!1},{type:"list",itemsDataProvider:ProjectsItemsDataProvider,selector:"[role=center]",sortable:!1,extensions:[ProjectsDetachExtension,ProjectsRefreshExtension,ProjectsSparklinesExtension],template:ProjectsTemplate,views:[{type:"grid.entity",emptyMessage:"No projects have been assigned",rowTemplateName:"list-grid-entity__rowproject_team"}]}]}]}),this.registerTab("People",{label:"people",header:[{type:"label",text:"People",countFieldNames:["teamMembers"]}],items:[{type:"container",layout:"selectable",template:{name:"user.team.tab",markup:['<div class="tau-teamsProjects-tab" role="center"></div>']},children:[{type:"inviter",selector:"[role=center]",printable:!1},{type:"list.editable",selector:"[role=center]",itemsDataProvider:MembersItemsDataProvider,sortable:!1,extensions:[MembersDetachExtension,MembersRefreshExtension,MembersSparklinesExtension],template:MembersTemplate}]}]})},getAdditionalInfoAliases:function(){return["Abbreviation","Icon"]},getActionsAliases:function(){return["Print","-----","Delete"]},getTabsAliases:function(){return["Description","Projects","People","Relations"]}});return Config});
define('tau/ui/templates/board.page/ui.template.board.page.container',["tau/core/templates-factory"],function(templates){var config={name:"container.boardPlus",engine:"jqote2",markup:['<header role="header" class="tau-app-header">',"</header>",'<div role="app-body" class="tau-app-body">','<div role="main" class="tau-app-main-pane tau-layout tau-layout-board"></div>','<aside role="aside" class="tau-app-secondary-pane"></aside>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.container',["Underscore","tau/core/templates-factory"],function(_,templates){var config={name:"boardplus.container",engine:"jqote2",markup:['<div class="tau-board tau-board_animate_false">',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/extensions/board.page/ui.extension.board.page.collapser',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({configFieldName:"collapser_aside_collapsed","bus afterInit+afterRender":function(evt){var configurator=_.values(evt)[1].data.data.context.configurator,settingsManager=configurator.getSettingsManager(),$element=_.values(evt)[1].data.element,configFieldName=this.configFieldName,self=this,$appBody=$element.filter("[role=app-body]:first");self.fire("$appBody.ready",$appBody),self.fire("configurator.ready",configurator),settingsManager.get({fields:[configFieldName],callback:function(result){self.fire("isCollapsed.ready",!!result[configFieldName])}}),settingsManager.unbind({listener:this}),settingsManager.bind({fields:[configFieldName],listener:this,callback:function(result){self.fire("isCollapsed.ready",!!result[configFieldName])}})},"bus $appBody.ready:last+configurator.ready:last+isCollapsed.ready":function(e){var evt=_.pluck(_.values(e),"data"),$appBody=evt[0],configurator=evt[1],isCollapsed=evt[2],currentCollapsed=$appBody.hasClass("tau-sp-collapsed");currentCollapsed!=isCollapsed&&($appBody.toggleClass("tau-sp-collapsed",isCollapsed),$(configurator.getWindow()).trigger("resize"))},"bus configurator.ready+destroy":function(evt){var settingsManager=_.values(evt)[0].data.getSettingsManager();settingsManager.unbind({listener:this})}})});
define('tau/ui/extensions/board.container/ui.extension.board.container.events',["tau/components/extensions/component.extension.base"],function(BaseExtension){return BaseExtension.extend({"bus boardSettings.ready > refresh":function(e,boardSettings){this.fire("boardSettings.ready",boardSettings)},"bus boardSettings.ready > initialize":function(e,boardSettings){this.fire("boardSettings.ready",boardSettings)},"bus componentsCreated:last + boardSettings.ready":function(e,components,boardSettings){for(var i=0,len=components.length;i<len;i++){var c=components[i].component;c.fire("boardSettings.ready",boardSettings)}},"bus view.dom.ready > refresh":function(e,domReady){this.fire("view.dom.ready",domReady)},"bus componentsCreated:last + view.dom.ready":function(e,components,domReady){for(var i=0,len=components.length;i<len;i++){var c=components[i].component;c.on("afterRender",function(){this.fire("view.dom.ready",domReady)},c),c.fire("view.dom.ready",domReady)}}})});
define('tau/ui/extensions/board.tooltip/ui.extension.board.tooltip',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({initTooltip:function($el){$el.find(".tau-extension-board-tooltip").each(function(){var $curr=$(this),onPositionConfig=function(config){return config.at="center bottom",config.my="center top",config.offset="0 -1",config},onArrowPositionConfig=function(config){return config.at="center bottom",config.my="center top",config.offset="0 -1",config};$curr.tauBubble({content:"<span>"+$curr.data("title")+"</span>",zIndex:999,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join(""),className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mouseleave mousedown",mode:"tooltip",delay:500,onPositionConfig:onPositionConfig,onArrowPositionConfig:onArrowPositionConfig,onBeforeShow:function(config){var title=$curr.data("title"),collapsedSelector=$curr.data("collapsed-selector");collapsedSelector||(collapsedSelector=".tau-collapsed");if($curr.is(collapsedSelector)){var collapsedTitle=$curr.data("title-collapsed");collapsedTitle&&(title=collapsedTitle)}var expandedSelector=$curr.data("expanded-selector");expandedSelector||(expandedSelector=".tau-expanded");if($curr.is(expandedSelector)){var expandedTitle=$curr.data("title-expanded");expandedTitle&&(title=expandedTitle)}if(!title)return!1;this.option("content","<span>"+title+"</span>")},onShow:function(config){this.adjustPosition()},stackName:"tooltip"})})},"bus boardSettings.ready:last+afterRender":function(evt,bs,renderData){this.initTooltip(renderData.element)},"bus boardSettings.ready:last+$groups.ready":function(evt,bs,$groups){this.initTooltip($groups)}})});
define('tau/ui/extensions/board.container/ui.extension.board.container.editMode',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus boardSettings.ready:last + afterRender":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element,user=this.config.context.configurator.getLoggedUser();boardSettings.get({fields:["edit","isDraft","ownerId"],callback:function(result){var isSwitchSettings=!1;result.edit&&(isSwitchSettings=!0),result.isDraft&&!user.isAdministrator&&user.id!=result.ownerId&&(isSwitchSettings=!1,boardSettings.set({set:{edit:!1}})),$el.toggleClass("tau-settings-active",isSwitchSettings)}}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["edit","editMore"],listener:this,callback:function(result){$el.toggleClass("tau-settings-active",result.edit||!1)}})}})});
define('tau/ui/extensions/board.container/ui.extension.board.container.viewMode',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterInit+boardSettings.ready":function(evt,initConfig,bs){var boardSettings=bs.boardSettings,self=this;boardSettings.unbind({listener:this}),boardSettings.bind({fields:["viewMode"],listener:this,callback:function(result){self.fire("refresh")}})}})});
define('tau/ui/templates/board.tools.container/ui.template.board.tools',["tau/core/templates-factory"],function(templates){var config={name:"board.tools",engine:"jqote2",markup:['<div class="tau-boardtools">',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/configurations/board.container.config',["Underscore","tau/core/class","tau/ui/templates/board.page/ui.template.board.page.container","tau/ui/templates/board.plus/ui.template.boardplus.container","tau/ui/extensions/board.page/ui.extension.board.page.collapser","tau/ui/extensions/board.container/ui.extension.board.container.events","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/ui/extensions/board.container/ui.extension.board.container.editMode","tau/ui/extensions/board.container/ui.extension.board.container.viewMode","tau/ui/templates/board.tools.container/ui.template.board.tools"],function(_,BaseClass,MainLayoutTemplate,BoardLayoutTemplate,ExtensionPageCollapser,ExtensionContainerEvents,ExtensionsTooltips,ExtensionEditMode,ExtensionViewMode,BoardToolsTemplate){return BaseClass.extend({init:function(configurator){this.configurator=configurator},getMasterConfig:function(){return{layout:"selectable",template:MainLayoutTemplate,extensions:[ExtensionPageCollapser],children:[{type:"board.main.menu",selector:"[role=header]"},{type:"board.header",selector:"[role=header]",children:[{type:"board.context.filter",name:"board.context.filter"}]},{type:"board.collapser.aside",selector:"[role=aside]"},{type:"board.general.quick.add",selector:"[role=aside]"},{type:"board.selector",selector:"[role=aside]"},{type:"board.add",selector:"[role=aside]"},{type:"board.clipboard",selector:"[role=main]",options:{refreshTimeout:300}},{type:"board.entityViewer",selector:"[role=main]"}]}},getPageBoardConfig:function(){var features=this.configurator.getFeaturesService(),user=this.configurator.getLoggedUser();return{type:"board.container",selector:"[role=main]",layout:"list",template:BoardLayoutTemplate,extensions:[ExtensionEditMode],children:[{type:"board.toolbar",min:1,max:6,defaultValue:3,extensions:[ExtensionViewMode]},{type:"board.editor.container",layout:"selectable",visible:!1,spinner:!1,useAnimation:!1,children:_.compact([{type:"board.owner",selector:"[role=toolbar]"},{type:"board.clone",selector:"[role=toolbar]"},features.isEnabled("boardTemplates")&&user.isAdministrator?{type:"board.templates.editor",selector:"[role=toolbar]"}:!1,{type:"board.editor.remember.context",selector:"[role=toolbar]"},{type:"board.editor.access",visible:!1,layout:"replaceable",label:"access",selector:"[role=access]"},features.isEnabled("boardTemplates")?{name:"board_editor_tab_templates",type:"board.container",layout:"replaceable",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=templates]",label:"templates",children:[{name:"board_templates",type:"board.templates.selector"}]}:!1,{name:"board_editor_tab_editor",type:"board.container",layout:"replaceable",visible:!0,spinner:!1,useAnimation:!1,selector:"[role=editor]",label:"setup",children:[{name:"board_editor",type:"board.editor"}]},{name:"board_editor_tab_limits",type:"board.container",layout:"replaceable",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=limits]",label:"limits",children:[{name:"board_limits",type:"board.limits"}]},{name:"board_editor_tab_prioritization",type:"board.container",layout:"replaceable",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=prioritization]",label:"prioritization",children:[{name:"board_editor_prioritization",type:"board.editor.prioritization"}]},{name:"board_editor_tab_customize",type:"board.container",layout:"replaceable",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=customize]",label:"customize",children:[{name:"board_editor_customize",type:"board.editor.customize"}]},{name:"board_editor_tab_encoding",type:"board.container",layout:"replaceable",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=encoding]",label:"encoding",children:[{name:"board_editor_encoding",type:"board.editor.encoding"}]}])},{type:"board.container",spinner:!1,extensions:[ExtensionViewMode],template:{engine:"jqote2",name:"board.plus.wrapper",markup:'<div class="tau-board-body-wrapper"></div>'},children:[{name:"board_plus",type:"board.plus",min:1,max:6,defaultValue:3,options:{dragndrop:{containmentRefreshTimeout:400}}}]},{type:"board.tools.container",name:"board_tools_container",selector:"[role=aside]",layout:"selectable",children:_.compact([features.isEnabled("flowHelp")?{name:"board_tools_tab_flowHelp",type:"bubble.container",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=flowHelp]",label:"flowHelp",children:[{name:"board_flowHelp",type:"board.flowHelp"}]}:!1,{name:"board_tools_tab_overviews",type:"bubble.container",visible:!1,spinner:!1,useAnimation:!1,className:"tau-boardtools__holder",selector:"[role=overviews]",label:"overviews",children:[{name:"board_paging",type:"board.paging",boardName:"board_plus"},{name:"board_overview",type:"board.overview",boardName:"board_plus"}]},{name:"board_tools_tab_legend",type:"bubble.container",visible:!1,spinner:!1,useAnimation:!1,selector:"[role=legend]",label:"legend",children:[{type:"label",text:"",template:{name:"board.legend",engine:"jqote2",markup:'<div class="tau-card-legend" />'}}]}])}]}}})});
define('tau/configurations/factory.container.config',["Underscore","tau/core/class","tau/core/termProcessor","tau/models/model.extensions","tau/configurations/base.container.config","tau/configurations/baseAssignable.container.config","tau/configurations/baseContainable.container.config","tau/configurations/userStory.container.config","tau/configurations/task.container.config","tau/configurations/bug.container.config","tau/configurations/request.container.config","tau/configurations/testplanrun.container.config","tau/configurations/testcase.container.config","tau/configurations/testplan.container.config","tau/configurations/iteration.container.config","tau/configurations/teamiteration.container.config","tau/configurations/feature.container.config","tau/configurations/release.container.config","tau/configurations/build.container.config","tau/configurations/impediment.container.config","tau/configurations/project.container.config","tau/configurations/user.container.config","tau/configurations/team.container.config","tau/configurations/board.container.config","tau/configurations/converters/converter.context"],function(_,Class,TermProcessor,modelExtensions,baseConfig,assignableConfig,containableConfig,storyConfig,taskConfig,bugConfig,requestConfig,testplanrunConfig,testcaseConfig,testplanConfig,iterationConfig,teamiterationConfig,featureConfig,releaseConfig,buildConfig,impedimentConfig,projectConfig,userConfig,teamConfig,boardConfig,contextConverter){var ContextBasedConfigObjectWrapper=Class.extend({init:function(originalConfigObject,appConfig){this.originalConfigObject=originalConfigObject,this.appConfig=appConfig,this.practices=[],this.editions=[];var context=this.appConfig.context;context&&(this.practices=_(context.getPractices()).pluck("name")),context&&(this.editions=context.getEdition())},getConfig:function(){var config=this.originalConfigObject.getConfig(this.appConfig);return contextConverter.convert(config,this.practices,this.editions)},getActions:function(){var actions=this.originalConfigObject.getActions(this.appConfig.context.applicationContext);return contextConverter.convert(actions,this.practices,this.editions)}}),Factory=Class.extend({init:function(){this.configs={base:baseConfig,userstory:storyConfig,task:taskConfig,bug:bugConfig,request:requestConfig,testplanrun:testplanrunConfig,testcase:testcaseConfig,testplan:testplanConfig,iteration:iterationConfig,teamiteration:teamiterationConfig,feature:featureConfig,release:releaseConfig,build:buildConfig,impediment:impedimentConfig,project:projectConfig,user:userConfig,team:teamConfig,board:boardConfig}},getConfig:function(appConfig){var entityType=appConfig.context.entity.entityType.name.toLowerCase(),entityConfig=this.configs[entityType]?this.configs[entityType]:this.configs.base,configObj=new entityConfig(appConfig),config=configObj.getConfig(appConfig);return config},getContextBasedConfigObject:function(appConfig){var entityType=appConfig.context.entity.entityType.name.toLowerCase(),entityConfig=this.configs[entityType]?this.configs[entityType]:this.configs.base,entityConfigObject=new entityConfig(appConfig);return new ContextBasedConfigObjectWrapper(entityConfigObject,appConfig)},getConfigByType:function(entityType){var type=entityType.toLowerCase(),ConfigClass=this.configs[type];if(!ConfigClass)throw new Error('No config for type "'+type+'"');return ConfigClass}});return new Factory});
define('tau/components/extensions/customField/extension.customField.multipleEntities.count.label.setter',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus afterInit":function(eventArgs,init){var store=init.config.context.configurator.getStore(),entity=init.config.context.entity,customField=init.config.customField;this._calculateCount(store,entity,customField),this._subscribeToStore(store,entity,customField)},_calculateCount:function(store,entity,customField){if(!customField||customField.type!=="MultipleEntities"){this._publishCount(0);return}var cmd={id:entity.id,fields:["customFields"]};store.get(entity.entityType.name,cmd,{success:function(e){this._getActualEntitiesAndPublishCount(store,this._findOwnCustomField(e.data.customFields,customField))},scope:this}).done()},_subscribeToStore:function(store,entity,customField){store.unbind(this);var self=this,filter={type:entity.entityType.name,eventName:"afterSave",hasChanges:["customFields"],filter:{id:entity.id},listener:this};store.on(filter,function(eventArgs){self._getActualEntitiesAndPublishCount(store,self._findOwnCustomField(eventArgs.data.changes.customFields,customField))})},_publishCount:function(count){this.fire("setBadgeText",{text:count})},_getActualEntitiesAndPublishCount:function(store,customField){if(!customField.value){this._publishCount(0);return}var self=this,ids=_.map(customField.value.split(","),function(i){return i.split(" ")[0]});store.find("general",{fields:["id"],$query:{id:{$in:ids}}}).done({success:function(r){self._publishCount(r[0].data.length)}})},_findOwnCustomField:function(customFields,fieldConfig){return _.chain(customFields).select(function(i){return i.name==fieldConfig.name}).first().value()}})});
define('tau/views/view.page.entity',["Underscore","tau/core/view-base","tau/components/component.container","tau/configurations/factory.container.config","tau/components/extensions/customField/extension.customField.multipleEntities.count.label.setter"],function(_,ViewBase,containerComponent,factoryConfig,MultipleEntitiesCountExtension){return ViewBase.extend({init:function(config){this._super(config),this.config.placeholder&&this.config.placeholder.addClass("ui-entity-view")},"container afterInit":function(evt){this.fireAfterInit()},initialize:function(){},"container afterRender":function(evt){this.fireBeforeRender(),this.element=evt.data.element,this.config.placeholder&&this.config.placeholder.append(this.element),this.config.placeholder&&this.config.placeholder.addClass("tau-entity-loaded"),this.fireAfterRender()},initializeContainer:function(config){this.container&&this.container.initialize(config)},getStateFields:function(config){var states={};config.hasOwnProperty("stateName")&&(states[config.stateName]=config);var self=this,children=[];if(_.isArray(config.children))children=config.children;else if(_.isArray(config.tabs)){var items=_.pluck(config.tabs,"items");children=_.flatten(items)}return _.each(children,function(children){_.extend(states,self.getStateFields(children))}),states},"bus contextRetrieved":function(evt){var self=this,config=evt.data;_.extend(config,self.config.containerConfig||factoryConfig.getConfig(config));var entityType=config.context.entity.entityType.name.toLowerCase(),specialFields=_.filter(config.context.getCustomFields(),function(v){return v.type.toLowerCase()=="multipleentities"&&v.entityKind.toLowerCase()==entityType});config=this._addTabsBySpecialFields(specialFields,config),this.container=containerComponent.create({name:"entity container",store:this.config.store,context:self.config.context}),this.container.on("afterInit",this["container afterInit"],this),this.container.on("afterRender",this["container afterRender"],this),self.fire("onConfigContainerCreated",config),self.fire("initializeContainer",config)},"bus onConfigContainerCreated+initializeContainer":function(evt){var self=this,config=evt.onConfigContainerCreated.data,stateFields=self.getStateFields(config),configurator=self.config.context.configurator;if(!_.isEmpty(stateFields)){var stateFieldNames=_.pluck(stateFields,"stateName");config.context.componentSettings.get({fields:stateFieldNames,callback:function(state){_.each(stateFields,function(val,key){state.hasOwnProperty(key)&&(stateFields[key][key]=state[key])}),config.context.configurator=configurator,self.initializeContainer(config)}})}else config.context.configurator=configurator,self.initializeContainer(config)},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.destroyContainer(),this.container=null,this._super()},_addTabsBySpecialFields:function(fields,config){var children;return config.children&&config.children.length&&config.children[0].children&&config.children[0].children.length&&config.children[0].children[0].children&&config.children[0].children[0].children.length&&(children=config.children[0].children[0].children),children?(_.forEach(fields,function(v,i){children[2].tabs.push({label:"MultipleEntitiesCustomFieldEditor"+i,header:[{type:"label",text:v.name,extensions:[MultipleEntitiesCountExtension],customField:{name:v.name,type:v.type}}],items:[{type:"customField.multipleEntities",customField:{name:v.name,type:v.type,value:v.value}}]})}),config):config}})});
define('tau/models/page.entity/model.page.entity.entityRefresher.change',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus entity.ready + configurator.ready":function(evt,entity,configurator){var entityType=entity.entityType.name,store=configurator.getStore(),fire=_.bind(this.fire,this);store.unbind(this);var fired=!1;_.forEach(["project","team","userStory"],_.bind(function(changeField){store.on({eventName:"afterSave",type:entityType,listener:this,filter:{id:entity.id},hasChanges:[changeField]},function(cmd){if(fired)return;fired=!0,store.unbind(this);var d=cmd.data;fire("entity.toEvict",entity);var update=_.extend({},d.obj,d.changes,{__type:d.obj.type});store.register(update),fire("refresh")})},this)),entityType=="project"&&store.on({eventName:"afterSave",type:entityType,listener:this,filter:{id:entity.id},hasChanges:["process"]},function(){fire("entity.toEvict",entity),fire("refresh")})},"bus configurator.ready > destroy":function(evt,configurator){configurator.getStore().unbind(this)}})});
define('tau/models/page.entity/model.page.entity.entityRefresher.remove',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus entity.ready + configurator.ready":function(evt,entity,configurator){var store=configurator.getStore(),fire=_.bind(this.fire,this);store.unbind(this),store.on({eventName:"beforeRemove",type:entity.entityType.name,listener:this},function(evtArgs){var deletedEntityId=evtArgs.data.cmd.config.id;entity.id==deletedEntityId&&fire("beforeDelete")}),store.on({eventName:"afterRemove",type:entity.entityType.name,listener:this},function(evtArgs){var e=evtArgs.data,deletedEntityId=e.cmd?e.cmd.config.id:e.obj?e.obj.id:e.id;entity.id==deletedEntityId&&fire("deleted",evtArgs.data)})},"bus configurator.ready > destroy":function(evt,configurator){configurator.getStore().unbind(this)}})});
define('tau/models/page.entity/model.page.entity.globalRefresher',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus entity.ready + configurator.ready":function(evt,entity,configurator){var gb=configurator.getGlobalBus();gb.removeAllListeners(this),gb.on("entityWasMovedToProject",_.bind(this.onEntityWasMovedToProject,this,entity),this),gb.on("refreshMainEntity",_.bind(this.refresh,this,entity),this)},"bus configurator.ready > destroy":function(evt,configurator){var gb=configurator.getGlobalBus();gb.removeAllListeners(this)},onEntityWasMovedToProject:function(entity,evt){entity.id==evt.data.entity.id&&this.refresh(entity)},refresh:function(entity){this.fire("entity.toEvict",entity),this.fire("refresh")},"bus configurator.ready > entity.toEvict":function(evt,configurator,entity){var store=configurator.getStore();store.evictPersistedObject(entity.id,"context"),store.evictPersistedObject(entity.id,entity.entityType.name)}})});
define('tau/models/page.entity/model.page.entity.comet',["Underscore","tau/core/extension.base"],function(_,BaseExtension){return BaseExtension.extend({"bus configurator.ready:last + entity.ready":function(e,configurator,entity){configurator.getAppStateStore().get({fields:["acid"],callback:this._subscribeComet(configurator,entity)})},_subscribeComet:function(configurator,entity){return _.bind(function(r){var acid=r.acid,resourcesToListen=[];resourcesToListen.push({acid:acid,resourceType:entity.entityType.name,filter:"? Id is "+entity.id}),resourcesToListen.push({acid:acid,resourceType:"assignment",filter:"? assignable.Id is "+entity.id}),resourcesToListen.push({acid:acid,resourceType:"roleEffort",filter:"? assignable.Id is "+entity.id}),this.subscription&&this.subscription.stop(),this.lastChanges={},this.subscription=configurator.getComet().listen("resource",_.map(resourcesToListen,function(v){return{parameters:v}})).on({callback:_.bind(function(response){window.appIsInDebugMode&&console.log("resource comet: ",response);var data=response.data,timestamp=response.timestamp,key=data.type+data.id,cometChanges=_.map(data.reason,_.toCamelCase);_.has(this.lastChanges,key)||(this.lastChanges[key]={});var changes=this.lastChanges[key],actualChanges=_.filter(cometChanges,function(changeName){var changedByTime=timestamp>(changes[changeName]||0);return changedByTime&&(changes[changeName]=timestamp),changedByTime}),modification=data.modification.toLowerCase();data.reason=actualChanges,this.handle(modification,data,configurator)},this)}).start()},this)},"bus destroy":function(){delete this.lastChanges,this.subscription&&this.subscription.stop()},handle:function(type,data,configurator){var r=data;switch(type){case"updated":var reason=r.reason;reason.push("id"),r.data.assignable&&reason.push("assignable");var data=_.pick(r.data,reason);data.__type=r.type,configurator.getStore().registerWithEvents(data);break;case"removed":var data=r.data,type=r.type;configurator.getStore().removeWithEvents(data,type);break;case"added":var reason=r.reason;reason.push("id"),r.data.assignable&&reason.push("assignable");var data=r.data;data.__type=r.type,configurator.getStore().registerWithEvents(data)}}})});
define('tp/ui/mashupsForViews',["tp/mashups","user/mashups","tau/core/global.bus","Underscore","tau/core/bus.reg","tau/core/event"],function(Mashups,um,gb,_,busRegistry,EventClass){var mashups=new Mashups,isSignedUp=!1,fnCriterionForViewMashups=function(mashup){for(var i=0;i<mashup.libs.length;i++){var lib=mashup.libs[i],libPath=lib.toLowerCase();if(libPath.indexOf("/view")>0||libPath.indexOf("iew")>0)return!0}return!1},api={init:function(){startViewIntegration()},onInit:function(callback){mashups.onMashupsLoaded(fnCriterionForViewMashups).done(callback)}},getMarkup=function(controlToAdd){return{header:[{name:controlToAdd.id,type:"label",text:controlToAdd.name}],items:[{name:controlToAdd.id,type:"container"}]}},appendTab=function(controlToAdd,tabsConfig){var tabItem={label:controlToAdd.name,name:"parent:"+controlToAdd.id};tabsConfig.tabs.push(_.extend(tabItem,getMarkup(controlToAdd)))},appendBlock=function(controlToAdd,config){var item={type:"collapsible",name:"parent:"+controlToAdd.id,collapsed:!0,stateName:controlToAdd.name.toLowerCase().replace(" ","")};config.children.push(_.extend(item,getMarkup(controlToAdd)))},getTabsConfig=function(evt){var tabsConfig=_.jsonSelect(evt.data.children,':has(:root>.type:val("tabs"))');return tabsConfig.length===0&&(tabsConfig={tabs:[]}),tabsConfig=tabsConfig[0],tabsConfig},getInfoColumnConfig=function(evt){var config=_.jsonSelect(evt.data.children,':has(:root>.name:val("additional info column container"))');return config.length===0&&(config={children:[]}),config=config[0],config},startViewIntegration=function(){if(isSignedUp)return;isSignedUp=!0,busRegistry.getByName("entity component",function(bus){var listener={bus:bus,"bus before_contextRetrieved":function(evt){evt.suspendMain(),api.onInit(function(){evt.resumeMain()})}};EventClass.subscribeOn(listener)});var bus=gb.get();bus.on("afterRender",function(evt){var controlsToAdd=mashups.controls.view,name=evt.caller.name,data=evt.data||{element:{addClass:function(){}},data:{view:{config:{context:{entity:{}}}}}};if(controlsToAdd.hasOwnProperty(name)){var contextEntity=data.view.config.context,entityId=contextEntity.entity.id,ctrl=controlsToAdd[name],context={entity:{id:entityId,type:ctrl.type}},isHeader=data.view.config.type==="label",fnCreate=isHeader?"onCreateHeader":"onCreateContent";isHeader||data.element.addClass("ui-custom-control-content"),ctrl[fnCreate](data.element,context)}if(name==="entity component"){var entity=data.view.config.entity,element=data.element,subscriptions=mashups.subscriptions.view,type=entity.type.toLowerCase();if(subscriptions.hasOwnProperty(type))for(var i=0;i<subscriptions[type].length;i++)subscriptions[type][i](element,{context:entity})}}),bus.on("onConfigContainerCreated",function(evt){var controlsToAdd=mashups.controls.view,values=_.values(controlsToAdd),tabsConfig=null,blocksConfig=null;for(var i=0;i<values.length;i++){var controlToAdd=values[i],entity=evt.data.context.entity;if(controlToAdd.type.toLowerCase()!==entity.entityType.name.toLowerCase())continue;if(controlToAdd.control==="tab"){tabsConfig||(tabsConfig=getTabsConfig(evt)),appendTab(controlToAdd,tabsConfig);continue}controlToAdd.control==="block"&&(blocksConfig||(blocksConfig=getInfoColumnConfig(evt)),appendBlock(controlToAdd,blocksConfig))}})};return api});
define('tau/components/component.page.entity',["Underscore","tau/components/component.page.base","tau/views/view.page.entity","tau/models/page.entity/model.page.entity.context","tau/models/page.entity/model.page.entity.entityRefresher.change","tau/models/page.entity/model.page.entity.entityRefresher.remove","tau/models/page.entity/model.page.entity.globalRefresher","tau/models/page.entity/model.page.entity.comet","tp/ui/mashupsForViews"],function(_,Component,View,ModelContext,ModelChangeRefresher,ModelRemoveRefresher,ModelGlobalRefresher,ModelComet,Mashups){return{create:function(context){Mashups.init();var config={name:"entity component",turnOffLoadingIndicator:context.turnOffLoadingIndicator,queuedBus:!0,ViewType:View,extensions:_.compact([ModelContext,ModelChangeRefresher,ModelRemoveRefresher,ModelGlobalRefresher,context.comet&&context.comet.enabled?ModelComet:null].concat(context.extensions||[]))};return Component.create(config,context)}}});
define('tau/components/extensions/print.convert.extension',["tau/components/extensions/component.extension.base","tau/configurations/converters/converter.print"],function(ExtensionBase,converter){return ExtensionBase.extend({"bus onConfigContainerCreated":function(evt){var config=evt.data;converter.convert(config),config.children.push({type:"print"})},"bus afterRender":function(e){var $el=e.data.element,$links=$el.find("a");$links.removeAttr("href"),$el.find("[role=attachment]").removeAttr("role")}})});
define('tau/components/extensions/application/extension.controller.entity',["Underscore","jQuery","tau/core/extension.base.stateful","tau/components/component.page.entity","tau/components/extensions/print.convert.extension"],function(_,$,ExtensionBase,PageComponent,PrintExtension){return ExtensionBase.extend({"bus beforeInit + configurator.ready":function(evt,initConfig,configurator){var reloadEvt=_.bind(function(evt){var evtData=evt.data,changes={project:{id:evtData.project.id}},data={id:evtData.entity.id,changes:changes,cmd:{config:{$set:changes}}};this.fire("integration.react",data)},this),duplicateBugReloadEvt=_.bind(function(evt){var evtData=evt.data,changes={},data={id:evtData.bugId,changes:changes,cmd:{config:{$set:changes}}};this.fire("integration.react",data)},this),gb=configurator.getGlobalBus();gb.removeAllListeners(this),gb.on("bugWasMarkedAsDuplicate",duplicateBugReloadEvt,this),gb.on("entityWasMovedToProject",reloadEvt,this),gb.on("redirectBack",_.bind(this._redirectBack,this,configurator),this);var store=configurator.getStore();store.unbind(this);var reloadCallback=_.bind(function(e){this.fire("integration.react",e.data)},this),types=["general","assignment","roleEffort"];_.each(types,_.bind(function(type){store.on({type:type,eventName:"afterSave",listener:this},reloadCallback),store.on({type:type,eventName:"afterRemove",listener:this},reloadCallback)},this))},"bus afterRender:last + innerContentRendered":function(e,renderData,childRenderData){var $element=renderData.element,$content=childRenderData.element;$element.empty().append($content),this.fire("contentRendered",{element:$element})},_getItemConfig:function(id,type,configurator){var config={entity:{id:id,type:type}};return configurator&&(config.context={configurator:configurator}),config},castEntityParams:function(params){return{id:params.id?parseInt(params.id,10):null,entity:params.entity||params.type}},_closeCurrent:function(configurator){this.current&&(this.current.removeAllListeners(this),this.current.destroy(),configurator.getStore().evictData())},"bus configurator.ready + application.exit":function(evt,configurator){$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!1),this._closeCurrent(configurator)},"bus application.navigate.entity":function(evt,args){var self=this,action=(args.action||"").toLocaleLowerCase(),actionName="action"+(action&&action!="demoview"&&action!="tpview"?action:"show");if(args.entity=="team"&&action=="members"){var configurator=self.config.context.configurator,settingsManager=configurator.getBoardSettingsFactory().createComponentSettings({id:"team"});settingsManager.set({set:{generalTab:"people"},callback:function(){self.fire("application.navigate.entity",{id:args.id,entity:"team"})}})}else{!self[actionName]&&(actionName="actionshow");var params=self.castEntityParams(args);self.fire("controller.preExecute",{action:actionName,parameters:params}),self[actionName].call(self,params.id,params.entity),self.fire("controller.postExecute")}},actionshow:function(id,entity){this._action(id,entity),$("html").toggleClass("tau-html_action_view",!0).toggleClass("tau-html_action_print",!1)},actionprint:function(id,entity){this._action(id,entity,{extensions:[PrintExtension]}),$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!0),$("body").addClass("print-mode")},_action:function(id,entity,componentConfig){var configurator=this.config.context.configurator;$("html").toggleClass("tau-html_action_view",!1).toggleClass("tau-html_action_print",!1),this._closeCurrent(configurator);var componentConfig=componentConfig||{};componentConfig.turnOffLoadingIndicator=this.config.options.turnOffLoadingIndicator;var entityCfg=this._getItemConfig(id,entity,configurator),pageBus=PageComponent.create(entityCfg,componentConfig);pageBus.on("beforeDelete",_.bind(function(e){this.fire("initProgress")},this),this),pageBus.on("deleted",_.bind(this._redirectBack,this,configurator),this),pageBus.on("error",_.bind(function(e){this.fire("application.error",e.data)},this),this),pageBus.on("afterRender",_.bind(function(e){this.fire("application.entity.loaded",{id:id,entity:entity}),this.fire("innerContentRendered",{element:e.data.element})},this),this),this.current=pageBus,pageBus.initialize()},_redirectBack:function(configurator){var history=configurator.getHistory(),item=history.pop();item?(history.setCurrent(null),this.fire("urlToNavigate.ready",item.url)):this.fire("application.exit"),_.delay(_.bind(this.fire,this,"clearError"),100)},"bus configurator.ready > destroy":function(evt,configurator){configurator.getStore().unbind(this),configurator.getGlobalBus().removeAllListeners(this),this._closeCurrent(configurator),delete this.current,delete this.$element,delete this.config}})});
define('tau/ui/templates/application/ui.template.application',["tau/core/templates-factory"],function(templates){var config={name:"application",markup:['<div class="ui-application-viewport i-role-application" role="application">',"</div>"]};return templates.register(config)});
define('tau/components/component.application.old',["tau/core/component-base","tau/core/view-base","tau/models/application/model.application.main","tau/components/extensions/application/extension.history","tau/components/extensions/application/extension.routing","tau/components/extensions/application/extension.routing.patterns","tau/components/extensions/application/extension.integration","tau/components/extensions/application/extension.navigation","tau/components/extensions/application/extension.controller.entity","tau/components/extensions/error/extension.errorBar","tau/ui/templates/application/ui.template.application"],function(Component,View,Model,HistoryExtension,RoutingExtension,RoutingPatternsExtension,IntegrationExtension,NavigationExtension,ControllerExtensionEntity,ErrorExtension,PopupExtension,template){return{create:function(componentConfig){componentConfig=componentConfig||{onCreate:function(){}};var additionalExtensions=componentConfig.extensions||[],config={name:"application component",template:template},component=new Component(config);component.attach(Model,componentConfig).attach(RoutingExtension,componentConfig).attach(RoutingPatternsExtension,componentConfig).attach(HistoryExtension,componentConfig).attach(IntegrationExtension,componentConfig).attach(NavigationExtension,componentConfig).attach(ControllerExtensionEntity,componentConfig).attach(ErrorExtension,componentConfig).attach(View);var opts=componentConfig.options||{};opts.integration&&opts.integration.showInPopup===!0&&component.attach(PopupExtension,componentConfig);for(var i=0,len=additionalExtensions.length;i<len;i++)component.attach(additionalExtensions[i],componentConfig);return component.bus}}});
define('tau/models/model.iteration.progressBar',["Underscore","tau/core/model-base"],function(_,ModelBase){var IterationProgressBarModel=ModelBase.extend({name:"Iteration Progress Bar",afterSaveRoleEffort:function(command){var self=this;self.fire("roleEffortChanged")},onDataUpdate:function(evt){var self=this;self.fire("refresh")},floatToString:function(flt){return flt.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onInit:function(){var self=this,ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,fields=["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum"];self.store.unbind(self),self.store.on({eventName:"afterSave",type:"roleEffort",listener:self,filter:{assignable:{id:entityId}}},_.bind(self.afterSaveRoleEffort,self)),self.store.on({eventName:"afterSave",type:entityTypeName,listener:self,filter:{id:entityId},hasChanges:[fields.join("|")]},_.bind(self.onDataUpdate,self)),self.store.get(entityTypeName,{id:entityId,fields:fields},{success:self.onEntityRetrieved,scope:self}).done({success:self.done,scope:self})},onEntityRetrieved:function(result){var src=result.data,effortToDo=src["bugs-effortToDo-sum"]+src["userStories-effortToDo-sum"],effortCompleted=src["bugs-effortCompleted-sum"]+src["userStories-effortCompleted-sum"],total=Math.round(100*parseFloat(effortToDo)+100*parseFloat(effortCompleted))/100,percentCompleted=Math.round(1e4*(effortCompleted/total))/100;percentCompleted=isNaN(percentCompleted)?0:percentCompleted,percentCompleted=percentCompleted>100?100:percentCompleted,this.effortToDo=effortToDo,this.effortCompleted=effortCompleted,this.percentCompleted=percentCompleted},done:function(){this.fire("dataBind",{effortToDo:this.floatToString(this.effortToDo),effortCompleted:this.floatToString(this.effortCompleted),percentCompleted:this.percentCompleted,totalEffort:this.floatToString(this.effortToDo+this.effortCompleted),point:this._getEffortPoints()})}});return IterationProgressBarModel});
define('tau/ui/templates/label/ui.template.assignmentEffort.label',["tau/core/templates-factory"],function(templates){var config={name:"assignment-effort-label",markup:['<div><span class="property"><span class="effort">${totalEffort}&nbsp;${point}</span></span>']};return templates.register(config)});
define('tau/components/component.assignedEffort',["tau/components/component.creator","tau/models/model.iteration.progressBar","tau/ui/templates/label/ui.template.assignmentEffort.label"],function(creator,ModelIterationProgressBar,template){return{create:function(config){var creatorConfig={extensions:[ModelIterationProgressBar],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/assignmentsList/extension.model.effortRetriever',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model effort retriver","bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}};this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:["effort","effortToDo"]},callback:{scope:this,success:this.onEffortRetrieved}})},"bus extendDataToBind":function(evtArgs){var data=evtArgs.data||{},entity=this.entity||{};data.totalEffort={effort:this.floatToString(entity.effort),remain:this.floatToString(entity.effortToDo)}},onEffortRetrieved:function(evtArgs){this.entity=evtArgs.data},destroy:function(){delete this.entity,this._super()}})});
define('tau/models/assignmentsList/extension.model.effortPointsRetriever',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model effort points extension",_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},"bus extendDataToBind":function(evtArgs){var data=evtArgs.data||{};data.effortPoints=this._getEffortPoints()}})});
define('tau/models/assignmentsList/extension.model.assignmentsRetriever',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model extension assignments retriever","bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}},userType={generalUser:["id","firstName","lastName","avatarUri","email"]};this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:[{assignments:["id",{role:["id","name"]},userType],list:!0}]},callback:{scope:this,success:this.onAssignmentsRetrieved}})},onAssignmentsRetrieved:function(evtArgs){var assignments=evtArgs.data.assignments;this.fire("assignmentsReady",assignments)}})});
define('tau/models/assignmentsList/extension.model.entityRolesRetriever',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model entity roles retriever extension","bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}},roleType={role:["id","name","isPair","hasEffort"]};this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:[{roleEfforts:["id","effort","effortToDo",roleType,{assignable:["id"]}],list:!0},{entityState:[{role:["id"]}]}]},callback:{scope:this,success:this.onRoleEffortsRetrieved}})},"bus userGroupWasCreated":function(evtArgs){var group=evtArgs.data||{},role=group.role||{};if(role.hasEffort){var roleEfforts=this.entity.roleEfforts;_.each(roleEfforts,function(roleEffort){if(roleEffort.role.id==role.id)return group.roleEffort={effort:this.floatToString(roleEffort.effort),remain:this.floatToString(roleEffort.effortToDo),id:roleEffort.id},!0},this),this.fire("roleEffortsReady",roleEfforts)}else group.roleEffort=null},getRoles:function(){var roleEfforts=this.entity.roleEfforts,idRoleIsResponsible=this.entity.entityState.role&&this.entity.entityState.role.id,roles=[],roleEffortsCount=roleEfforts.length;for(var i=0;i<roleEffortsCount;i++){var role=roleEfforts[i].role;role.isResponsible=!1,role.id==idRoleIsResponsible&&(role.isResponsible=!0),roles.push(roleEfforts[i].role)}return roles},"bus entityRoleRetriever":function(evtArgs){this.entity=evtArgs.data.data;var roles=this.getRoles();this.fire("rolesReady",roles)},onRoleEffortsRetrieved:function(evtArgs){this.fire("entityRoleRetriever",evtArgs)},"bus extendDataToBind":function(evtArgs){var data=evtArgs.data||{}}})});
define('tau/models/assignmentsList/extension.model.featureRolesRetriever',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model feature roles retriever extension","bus registerStoreRequest":function(){var processId=this.config.context.getProcessId();this.fire("get",{type:"process",query:{id:processId,nested:!0,fields:[{entityStates:["id",{role:["id","name","hasEffort","isPair"]},{entityType:["id","name"]}],list:!0}]},callback:{scope:this,success:this.onEntityStatesRetrieved}})},onEntityStatesRetrieved:function(evtArgs){if(!this.config)return;var entityStates=evtArgs.data.entityStates,roles=this.roles=[],roleIds={},entityTypeName=this.config.context.entity.entityType.name.toLocaleLowerCase();_.each(entityStates,function(entityState){var role=entityState.role;role&&entityState.entityType.name.toLowerCase()===entityTypeName&&(roleIds.hasOwnProperty(role.id)||(roleIds[role.id]=!0,roles.push(role)))}),this.fire("rolesReady",roles)}})});
define('tau/models/assignmentsList/extension.model.assignmentToRolesMapper',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model assignment to role mapper","bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}},userType={generalUser:["id","firstName","lastName"]};this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:[{assignments:["id",{role:["id","name"]},userType],list:!0}]},callback:{scope:this,success:this.onAssignmentsRetrieved}})},"bus assignmentsReady+rolesReady+extendDataToBind":function(evtArgs){var assignments=(evtArgs.assignmentsReady||{}).data,rolesForEntity=(evtArgs.rolesReady||{}).data,dataToBind=(evtArgs.extendDataToBind||{}).data,groups=[];for(var i=0;i<rolesForEntity.length;i++){var role=rolesForEntity[i],group={};group.role=role,group.users=this.getUsersInRole(assignments,role),group.allowAdd=!0,this.fire("userGroupWasCreated",group),groups.push(group)}dataToBind.assignments={groups:groups}},_convertUserDataToViewData:function(user){var avatar=user.avatarUri+"32";return{id:user.id,name:_.trim([user.firstName,user.lastName].join(" "))||user.email,avatar:avatar}},getUsersInRole:function(assignments,role){var users=[];assignments=_.sortBy(assignments,function(assignment){return assignment.id});var assignmentsCount=assignments.length;for(var i=0;i<assignmentsCount;i++){var assignment=assignments[i];if(assignment.role.id==role.id){var userData=this._convertUserDataToViewData(assignment.generalUser);userData.assignmentId=assignment.id,userData.roleId=role.id,users.push(userData)}}return users}})});
define('tau/models/assignmentsList/extension.model.taskEffortRetriever',["Underscore","tau/models/extension.model.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"model task EffortRetriever","bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}};this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:["tasks-count","tasks-effort-sum","tasks-effortToDo-sum"]},callback:{scope:this,success:this.onTaskEffortRetrieved}})},"bus extendDataToBind":function(evtArgs){var data=evtArgs.data||{},entity=this.entity||{};entity["tasks-count"]>0&&(data.tasksEffort={effort:this.floatToString(entity["tasks-effort-sum"]),remain:this.floatToString(entity["tasks-effortToDo-sum"])})},onTaskEffortRetrieved:function(evtArgs){this.entity=evtArgs.data},destroy:function(){delete this.entity,this._super()}})});
define('tau/models/model.assignmentsList',["Underscore","tau/store/types","tau/core/model-base","tau/models/assignmentsList/extension.model.effortRetriever","tau/models/assignmentsList/extension.model.store.operations","tau/models/assignmentsList/extension.model.effortPointsRetriever","tau/models/assignmentsList/extension.model.assignmentsRetriever","tau/models/assignmentsList/extension.model.entityRolesRetriever","tau/models/assignmentsList/extension.model.featureRolesRetriever","tau/models/assignmentsList/extension.model.assignmentToRolesMapper","tau/models/assignmentsList/extension.model.taskEffortRetriever"],function(_,types,ModelBase,EffortRetriever,StoreOperations,EffortPointsRetriever,AssignmentsRetriever,EntityRolesRetriever,FeatureRolesRetriever,AssignmentToRolesMapper,TaskEffortRetriever){var AssignmentsListModel=ModelBase.extend({"bus assignmentsReady":function(evtArgs){this.assignments=evtArgs.data},"bus assignmentsReady:last+userAvatarChanged":function(evtArgs,assignments,userData){var assignmentUser=_.find(assignments,function(item){return item.generalUser.id==userData.id});assignmentUser!==undefined&&this.fire("avatarChanged",userData)},"bus roleEffortsReady":function(evtArgs){this.roleEfforts=evtArgs.data},destroyExtensions:function(){var extensions=this.extensions||[];if(extensions.length>0){var entityId=this.config.context.entity.id,bus=this.bus;_.each(extensions,function(extension){extension.destroy("destroy")})}delete this.extensions},initExtensions:function(){this.destroyExtensions();var type=types.findByKeyword(this.config.context.entity.entityType.name),rolesRetrieved=new(type.name!="feature"?EntityRolesRetriever:FeatureRolesRetriever)(this.config);this.extensions=[new EffortRetriever(this.config),new StoreOperations(this.config),new EffortPointsRetriever(this.config),new AssignmentsRetriever(this.config),rolesRetrieved,new AssignmentToRolesMapper(this.config)],type.name.toLowerCase()=="userstory"&&this.extensions.push(new TaskEffortRetriever(this.config))},onInit:function(){this.clearData();var self=this;self.store.unbind(self),self.initExtensions(),self.fire("registerStoreRequest"),self.fire("commitTransaction",{success:self.done,scope:self}),this.bindStoreListeners()},done:function(){var initialData={};this.bus.fire("extendDataToBind",initialData),this.bus.fire("dataBind",initialData),this.destroyExtensions()},bindStoreListeners:function(){var self=this;self.store.on({eventName:"afterSave",type:"assignment",listener:self},function(){self.afterAssignmentSaved.apply(self,arguments)}),self.store.on({eventName:"afterSave",type:"user",hasChanges:["avatarUri"],listener:self},function(){self.afterUserSaved.apply(self,arguments)}),self.store.on({eventName:"beforeSave",type:"assignment",listener:self},function(){self.beforeSaveAssignment.apply(self,arguments)}),self.store.on({eventName:"beforeSave",type:"roleEffort",listener:self},function(){self.beforeSaveRoleEffort.apply(self,arguments)}),self.store.on({eventName:"afterSave",type:"roleEffort",listener:self},function(){self.afterSaveRoleEffort.apply(self,arguments)}),self.store.on({eventName:"beforeRemove",type:"assignment",listener:self},function(){self.beforeRemoveAssignment.apply(self,arguments)}),self.store.on({eventName:"afterRemove",type:"assignment",listener:self},function(){self.afterAssignmentRemoved.apply(self,arguments)});var entityId=this.config.context.entity.id,entityTypeName=this.config.context.entity.entityType.name,filter={id:entityId};self.store.on({eventName:"beforeRemove",type:entityTypeName,listener:self,filter:filter},function(){self.store.unbind(self)}),self.store.on({eventName:"beforeSave",type:entityTypeName,listener:self,filter:filter,hasChanges:["entityState"]},_.bind(self.beforeEntityEntityStateChanged,self)),self.store.on({eventName:"afterSave",type:entityTypeName,listener:self,filter:filter,hasChanges:["entityState"]},_.bind(self.afterEntityEntityStateChanged,self)),self.store.on({eventName:"afterSave",type:entityTypeName,listener:self,filter:filter,hasChanges:["effort|effortToDo|effortCompleted|tasks-count|tasks-effort-sum|tasks-effortToDo-sum"]},_.bind(self.onDataUpdate,self))},beforeEntityEntityStateChanged:function(evtArgs){this.fire("beforeStateChanged")},afterEntityEntityStateChanged:function(evtArgs){this.fire("afterStateChanged")},onDataUpdate:function(evtArgs){this.fire("dataDidUpdated")},beforeSaveRoleEffort:function(command){var roleEffortId=command.data.id;if(_.isNumber(roleEffortId)&&this.isRoleEffortOfCurrentEntity(roleEffortId)){var cmd=command.data.cmd;cmd.config.fields=cmd.config.fields||[],cmd.config.fields.push("effortToDo"),this.fire("beforeSaveRoleEffort",{roleEffortId:roleEffortId})}},afterSaveRoleEffort:function(command){var roleEffortId=command.data.id;_.isNumber(roleEffortId)&&this.isRoleEffortOfCurrentEntity(roleEffortId)&&this.fire("afterSaveRoleEffort",{roleEffortId:roleEffortId})},beforeRemoveAssignment:function(command){this.fireEventIfAssignmentFromCurrentEntity(command,"beforeRemoveAssignment")},afterAssignmentRemoved:function(command){this.fireEventIfAssignmentFromCurrentEntity(command,"afterAssignmentRemoved")},beforeSaveAssignment:function(command){_.isNumber(command.data.id)?this.fireEventIfAssignmentFromCurrentEntity(command,"beforeSaveAssignment"):this.fireEventIfAssignmentFromCurrentEntity(command,"beforeAddAssignment")},afterAssignmentSaved:function(command){var e=command.data,id=e.cmd?e.cmd.config.id:e.obj?e.obj.id:null;_.isNumber(id)?this.fireEventIfAssignmentFromCurrentEntity(command,"afterAssignmentSaved"):this.fireEventIfAssignmentFromCurrentEntity(command,"afterAssignmentAdded")},afterUserSaved:function(command){this.fire("userAvatarChanged",command.data)},fireEventIfAssignmentFromCurrentEntity:function(command,eventName){var assignmentId=command.data.id,dataChanges=command.data.changes||command.data.obj;if(this.isAssignmentOfCurrentEntity(assignmentId)||((dataChanges||{}).assignable||{}).id===this.config.context.entity.id){var data=_.extend({assignmentId:assignmentId},dataChanges);this.fire(eventName,data)}},isRoleEffortOfCurrentEntity:function(roleEffortId){return _.any(this.roleEfforts,function(roleEffort){return roleEffort.id===roleEffortId})},isAssignmentOfCurrentEntity:function(assignmentId){return _.any(this.assignments,function(assignment){return assignment.id===assignmentId})},clearData:function(){delete this.assignments,delete this.roleEfforts},destroy:function(){this.clearData(),this._super.apply(this,arguments)}});return AssignmentsListModel});
define('tau/core/model.editable.base',["tau/core/model-base"],function(ModelBase){var EditableModelBase=ModelBase.extend({"bus save":function(evt){var self=this,entity=self.config.context?self.config.context.entity:{},data=evt.data||{},$set=data.$set||data,$include=data.$include,id=data.hasOwnProperty("id")?data.id:entity.id,typeName=data.typeName||entity.entityType.name,cmdConfig={$set:$set,fields:$include};id&&(cmdConfig.id=id);var args={type:typeName,cmd:cmdConfig,validation:{isValid:!0,isError:function(){return!1}}};self.fire("validate",args),self.fire("afterValidate",args);if(args.validation.isValid===!1||args.validation.isError&&args.validation.isError()==1){self.fire("validationFailed",args);return}self.fire("beforeSave",args),self.store.save(typeName,cmdConfig,{success:function(evtArgs){self.fire("afterSave",{type:evtArgs.command.type,cmd:cmdConfig})},failure:function(evtArgs){self.fire("saveFailed",{type:evtArgs.command.type,cmd:cmdConfig})}}).done()},"bus remove":function(evt){var self=this,entity=self.config.context.entity,data=evt.data||{},typeName=data.typeName||entity.entityType.name;self.fire("beforeRemove",data),self.store.remove(typeName,{id:data.id},{success:function(evtArgs){self.fire("afterRemove",evtArgs.data)},failure:function(){}}).done()}});return EditableModelBase});
define('tau/models/model.assignmentsList.editable',["tau/core/model.editable.base"],function(ModelEditableBase){var AssignmentsListEditableModel=ModelEditableBase.extend({"bus dataBind":function(evtArgs){this.fire("permissionsReady",{editable:!0})}});return AssignmentsListEditableModel});
define('tau/models/userList/extension.model.unassignAction',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({name:"Model Extension Unassign Action","bus extendDataToBind":function(evtArgs){var data=evtArgs.data;data.headerActions.push({id:"unassign",title:"Unassign"})}})});
define('tau/models/userList/extension.model.showMore',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({name:"Model Extension Unassign Action","bus extendDataToBind":function(evtArgs){var data=evtArgs.data;data.moreAvailable=this.isMoreAvailable()},filterIsEmpty:function(){return!this.filterIsNotEmpty()},isMoreAvailable:function(){var data=this.config.data;return this.filterIsEmpty()&&data.showMore!==!0&&(data.hasOwnProperty("roleId")||data.hasOwnProperty("role"))},filterIsNotEmpty:function(){return this.config.data.filter&&this.config.data.filter.length}})});
define('tau/components/extensions/assignmentsList/extension.assignmentsList.editable',["Underscore","jQuery","tau/core/model-base"],function(_,$,ModelEdiableBase){return ModelEdiableBase.extend({category:"edit",init:function(){var self=this;self._super.apply(self,arguments),self.animations=[]},"bus dataBind":function(evtArgs){this.bindedData=evtArgs.data},"bus afterRender":function(evtArgs){this.refresh=this._innerRefresh,this.$el=evtArgs.data.element,this.startAnimations()},"bus permissionsReady+afterRender":function(evtArgs){var permissions=evtArgs.permissionsReady.data;if(permissions.editable){var self=this;self.$el.removeClass("assignments-table-readonly"),self.$el.find(".group .effort").editableText({mask:/^\d*\.?\d*$/,restoreText:!0,onSave:function(text){var data=this.$element.parents(".group").tmplItem().data,currEffort=self.normalizeEffort(data.roleEffort.effort),newEffort=self.normalizeEffort(text);if(currEffort===newEffort)return this.restoreInitialText(),!1;var saveCmd={typeName:"roleEffort",$include:["id"],id:data.roleEffort.id,$set:{effort:newEffort}};self.bus.fire("save",saveCmd)},onEditStart:function(){this.$element.data("points",this.$element.find("span").detach())},onEditEnd:function(){this.$element.append(this.$element.data("points"))}})}},"bus beforeSaveAssignment":function(evtArgs){var self=this,assignmentId=evtArgs.data.assignmentId,selector,$user;assignmentId&&(selector=this.getAssignmentSelector(assignmentId),$user=this.$el.find(selector),$user&&(this.fire("markElementToBeUpdated",{element:$user}),this.addAnimation(function(){self.fire("updateElement",{element:self.$el.find(selector)})})))},"bus beforeStateChanged":function(evtArgs){var self=this;self.fire("markElementToBeUpdated",{element:this.$el}),self.addAnimation(function(){self.fire("updateElement",{element:self.$el})})},"bus dataDidUpdated":function(){this.refresh()},"bus avatarChanged":function(){this.refresh()},"bus afterSaveRoleEffort":function(evtArgs){var roleEffortId=evtArgs.data.roleEffortId,self=this;self.addAnimation(function(){var $roleEffort=self.findRoleEffortElementByRoleEffortId(roleEffortId);self.fire("updateElement",{element:$roleEffort}),self.fire("updateElement",{element:self.$el.find(".total-row .effort-cell span")})}),this.refresh()},"bus afterAssignmentSaved":function(){this.refresh()},"bus afterAssignmentRemoved":function(){this.refresh()},"bus afterStateChanged":function(evtArgs){this.refresh()},"bus afterAssignmentAdded":function(evtArgs){this.refresh()},"bus beforeAddAssignment":function(evtArgs){var data=evtArgs.data,self=this,assignmentId=self.generateAssignmentIdForNewAssignment(data),dataToBind={name:"",role:{},assignmentId:assignmentId};$.tmpl("user",dataToBind).appendTo(self.$el.find(".group[roleId="+data.role.id+"]"));var userSelector=self.getUserSelector({roleId:data.role.id,id:data.generalUser.id});self.addAnimation(function(){self.fire("updateElement",{element:self.$el.find(userSelector)})})},"bus beforeRemoveAssignment":function(evtArgs){var assignmentId=evtArgs.assignmentId,$user=this.$el.find(this.getAssignmentSelector(assignmentId));this.fire("markElementToBeDeleted",{element:$user})},"bus beforeSaveRoleEffort":function(command){var cmd=command.data,roleEffortId=cmd.roleEffortId,$roleEffort=this.findRoleEffortElementByRoleEffortId(roleEffortId);this.fire("markElementToBeUpdated",{element:$roleEffort})},getUserSelector:function(userData){return".group[roleId="+userData.roleId+"] .user[userId="+userData.id+"]"},getAssignmentSelector:function(assignmentId){var self=this,selector=".user",$users=self.$el.find(selector),$user;return $users.each(function(i){var $us=$users.eq(i);if($us.tmplItem().data.assignmentId==assignmentId)return $user=$us,selector+=":eq("+i+")",!1}),selector},generateAssignmentIdForNewAssignment:function(assignment){return[this.config.context.entity.id,assignment.role.id,assignment.generalUser.id].join(",")},findRoleEffortElementByRoleEffortId:function(roleEffortId){var $efforts=this.$el.find(".role-effort .effort"),$element=$();return $efforts.each(function(){var $el=$(this),$group=$el.parents(".group"),data=$group.tmplItem().data;data.roleEffort=data.roleEffort||{};if(data.roleEffort.id===roleEffortId)return $element=$el,!1}),$element},addAnimation:function(animationFunc){this.animations.push(animationFunc)},startAnimations:function(){_.each(this.animations,function(func){func()}),this.animations=[]},_innerRefresh:function(){this.refresh=function(){},this.fire("refresh")},refresh:function(){},normalizeEffort:function(effortVal){return Math.abs(Math.round(parseFloat(effortVal)*100)/100)||0},destroy:function(){delete this.$el,delete this.bindedData,delete this.animations,this._super()}})});
define('tau/components/extensions/bubble/extension.bubble.creator.direct',["Underscore","jQuery","tau/components/extensions/bubble/extension.bubble.creator"],function(_,$,BaseExtension){return BaseExtension.extend({category:"edit","bus afterInit":function(){this.onEditActivated()},"bus afterRender+applyPopups":function(evt,renderData,configs){var $el=renderData.element,self=this;_.forEach(configs,function(config){var $t=$el.find(config.target),$alignTo=$el.find(config.alignTo);$t.each(function(i){var $realTarget=$(this);$realTarget.addClass("tau-bubble-target");var realConfig=_.deepClone(config);realConfig.targetCssClass&&$realTarget.addClass(realConfig.targetCssClass),realConfig.target=$realTarget,realConfig.alignTo=$realTarget.find(realConfig.alignTo),realConfig.alignTo=realConfig.alignTo.length?realConfig.alignTo:$alignTo.eq(i),realConfig.componentsConfig.components[0].data=_.deepClone($realTarget.tmplItem().data),self.fire("initBubble",realConfig)})})},onEditActivated:function(config){var self=this,configs=self.config.popupEditorContainer;self.fire("applyPopups",configs)}})});
define('tau/models/assignment/model.property.assignUser.editable.base',["Underscore","tau/core/model.editable.base"],function(_,EditableBase){return EditableBase.extend({"bus assignToLoggedUser":function(){this.assignTo(this.getLoggedUser().id)},"bus changeAssignment":function(evtArgs){var userId=evtArgs.data.user.id;this.assignTo(userId)},getLoggedUser:function(){return this.config.context.getLoggedUser()},assignTo:function(userId){},destroy:function(){this.project=null,this.entity=null,this._super()}})});
define('tau/models/assignment/model.assignment.editable',["Underscore","tau/models/assignment/model.property.assignUser.editable.base"],function(_,EditableBase){return EditableBase.extend({"bus removeAssignment":function(){var cmd={id:this.config.data.assignmentId,typeName:"assignment"};this.fire("remove",cmd)},assignTo:function(userId){var cmd={typeName:"assignment",$include:[{generalUser:["id","firstName","lastName"]},{role:["id","name"]},{assignable:["id"]}]};this.config.data.hasOwnProperty("assignmentId")&&_.extend(cmd,{id:this.config.data.assignmentId,$set:{generalUser:{id:userId}}}),this.fire("save",cmd)},destroy:function(){this.project=null,this.entity=null,this._super()}})});
define('tau/models/assignment/model.add.assignment.editable',["Underscore","tau/models/assignment/model.property.assignUser.editable.base"],function(_,EditableBase){return EditableBase.extend({assignTo:function(userId){var cmd={typeName:"assignment",$include:[{generalUser:["id","firstName","lastName"]},{role:["id","name"]},{assignable:["id"]}]};this.config.data.role&&_.extend(cmd,{id:null,$set:{generalUser:{id:userId},assignable:{id:parseInt(this.config.context.entity.id)},role:{id:this.config.data.role.id}}}),this.fire("save",cmd)},destroy:function(){this.project=null,this.entity=null,this._super()}})});
define('tau/ui/templates/common/ui.template.userName',["tau/core/templates-factory"],function(templates){return templates.register({name:"user-name",markup:"<span {{if name}} class='user-name'{{/if}} role='username'>${name}</span><br/>"})});
define('tau/ui/templates/common/ui.template.user',["tau/core/templates-factory","tau/ui/templates/common/ui.template.userName"],function(templates){return templates.register({name:"user",markup:["<table class='user' role='user' userId='${id}'><tr>","<td class='user-avatar-container'>","{{if avatar}}<img src='${avatar}' class='user-avatar'/>{{/if}}","</td>","<td class='user-info'>","   {{tmpl 'user-name'}}","{{if role}}","<span class='user-role'>${role.name}</span>","{{/if}}","</td>","</tr></table>"].join(""),dependencies:["user-name"]})});
define('tau/ui/templates/assignmentsList/ui.template.assignmentsList.userList',["tau/core/templates-factory","tau/ui/templates/common/ui.template.user","tau/ui/templates/assignmentsList/ui.template.assignmentsList.addBtn"],function(templates){var config={name:"assignments-user-list",markup:['<div class="group {{if role.isResponsible}}assignments-responsible{{/if}}" roleId="${role.id}">','<table class="role-header">',"   <tr>",'   <td class="role-title">','   {{tmpl "assignments-add-btn"}}',"&nbsp;${role.name}","   </td>",'   <td class="role-effort">',"{{if roleEffort}}",'       <div class="effort">${roleEffort.effort}<span class="point">${$item.effortPoints}</span></div>',"{{/if}}","   </td>",'   <td class="role-effort">',"{{if roleEffort}}",'       <div class="remain">${roleEffort.remain}<span class="point">${$item.effortPoints}</span></div>',"{{/if}}","   </td>","</tr>","</table>",'{{tmpl(users) "user"}}',"</div>"].join(""),dependencies:["user","assignments-add-btn"]};return templates.register(config)});
define('tau/ui/templates/assignmentsList/ui.template.assignmentsList',["tau/core/templates-factory","tau/ui/templates/assignmentsList/ui.template.assignmentsList.userList","tau/ui/templates/common/ui.template.user"],function(templates){var config={name:"assignments-list",markup:['<table class="box assignments-table-readonly assignments-table">','   <tr class="title">','       <td class="assignments-title"></td>','       <td class="effort title-cell">Effort</td>','       <td class="effort title-cell">Remain</td>',"    </tr>",'    <tr class="title-row">','       <td class="user-list" colspan="3">','               {{tmpl(assignments.groups, {effortPoints: effortPoints}) "assignments-user-list"}}',"       </td>","   </tr>",'   <tr class="head-row">',"       <td></td>","       <td></td>","       <td></td>","   </tr>","{{if tasksEffort}}",'   <tr class="tasks-row">','       <td class="task-title">Tasks</td>','       <td class="effort-cell">${tasksEffort.effort} h</td>','       <td class="effort-cell">${tasksEffort.remain} h</td>',"   </tr>","{{/if}}",'   <tr class="total-row">','       <td class="total-title">Total</td>','       <td class="effort-cell"><span>${totalEffort.effort} ${effortPoints}</span></td>','       <td class="effort-cell"><span>${totalEffort.remain} ${effortPoints}</span></td>',"   </tr>",'   <tr class="title-row" style="display: none;">','       <td class="owner title-cell">Owner</td>',"       <td></td>","   </tr>","</table>"].join(""),dependencies:["assignments-user-list","user"]};return templates.register(config)});
define('tau/components/component.assignmentsList',["Underscore","tau/components/component.creator","tau/models/model.assignmentsList","tau/models/model.assignmentsList.editable","tau/models/userList/extension.model.unassignAction","tau/models/userList/extension.model.showMore","tau/components/extensions/assignmentsList/extension.assignmentsList.editable","tau/components/extensions/component.creator.extension","tau/components/extensions/bubble/extension.bubble.creator.direct","tau/models/assignment/model.assignment.editable","tau/models/assignment/model.add.assignment.editable","tau/ui/templates/assignmentsList/ui.template.assignmentsList"],function(_,creator,ModelType,ModelEditableType,ModelUnassignAction,ModelShowMore,ExtinsionAssignmentsListEditable,ComponentCreatorExtension,PopupCreatorExtension,ModelUserListEditable,ModelAddAssignmentEditable,template){return{create:function(config){var creatorConfig={extensions:_.concat([ModelType,ComponentCreatorExtension,ModelEditableType,ExtinsionAssignmentsListEditable,{type:PopupCreatorExtension,config:{popupEditorContainer:[{target:".user-list .user",alignTo:".user-name",componentsConfig:{components:[{type:"userList",extensions:[ModelUserListEditable,ModelUnassignAction,ModelShowMore]}]}},{target:".owner-cell .user-name",componentsConfig:{components:[{type:"userList",extensions:[ModelShowMore]}]}},{target:".add-btn:not(.disabled)",targetCssClass:"ui-link",componentsConfig:{components:[{type:"userList",extensions:[ModelAddAssignmentEditable,ModelShowMore]}]}}]}},config.extensions]),template:config.template||template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.attachments',["tau/core/model-base","tau/utils/utils.date"],function(ModelBase,dateUtils){function initialDataProcessor(model,filterCallback){this.model=model,this.filterCallback=filterCallback||defaultFilter}var defaultFilter=function(){return!0};initialDataProcessor.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},onAssignableRetrieved:function(result){this.assignable=result.data;var initialData={items:this.getAttachments()},selected=this.getSelected();selected&&(initialData.selected=selected),this.model.data=initialData,this.model.bus.fire("dataBind",initialData)},each:function(callback){var attachmentsData=this.assignable.attachments,attachmentsCount=attachmentsData.length;for(var i=0;i<attachmentsCount;i++){var attachment=attachmentsData[i];this.filterCallback(attachment)&&callback(attachment)}},getAttachments:function(){var self=this,attachments=[];if(!self.model.config)return;var selected=self.model.config.selected,callback=function(attachment){var attachmentModelData=self.attachmentDTOToModelAttachment(attachment);attachments.push(attachmentModelData),selected&&attachment.id==selected.id&&(self.selected=attachmentModelData,attachmentModelData.selected=!0)};return this.each(callback),attachments},attachmentDTOToModelAttachment:function(attachmentDTO){var date=dateUtils.parse(dateUtils.convertToTimezone(attachmentDTO.date));return{id:attachmentDTO.id,name:attachmentDTO.name,mimeType:attachmentDTO.mimeType,ownerName:[attachmentDTO.owner.firstName," ",attachmentDTO.owner.lastName].join(""),date:dateUtils.format.date.short(date),thumbnailUri:attachmentDTO.thumbnailUri,uri:attachmentDTO.uri}},getSelected:function(){return this.selected}};var modelAttachments=ModelBase.extend({init:function(store,context,filter){this.name="Attachment Model",this._super.apply(this,arguments),this.filter=this.config.filter||filter},_getFields:function(){var fields=[{attachments:["id","date","name","mimeType","uri","thumbnailUri",{owner:["id","firstName","lastName"]}]}];return fields},onInit:function(){var entity=this.config.context.entity,dataProcessor=new initialDataProcessor(this,this.filter),fields=this._getFields();this.store.get(entity.entityType.name,{id:entity.id,fields:fields},dataProcessor.getAssignableRetrievedCallback()).done()},setSelected:function(attachment){if(this.config.selected.id!=attachment.id){var attachments=this.data.items,foundedAttachment=null;for(var i=0;i<attachments.length;i++)if(attachments[i].id==attachment.id){foundedAttachment=attachments[i];break}foundedAttachment&&(this.config.selected=foundedAttachment,this.fire("selectedChanged",{attachment:attachment}))}},next:function(){var attachments=this.data.items,foundedAttachment=null,attachment=this.config.selected;for(var i=0;i<attachments.length;i++)if(attachments[i].id==attachment.id){foundedAttachment=attachments[i];break}foundedAttachment&&(i==attachments.length-1&&(i=-1),this.setSelected(attachments[i+1]))},prev:function(){var attachments=this.data.items,foundedAttachment=null,attachment=this.config.selected;for(var i=0;i<attachments.length;i++)if(attachments[i].id==attachment.id){foundedAttachment=attachments[i];break}foundedAttachment&&(i==0&&(i=attachments.length),this.setSelected(attachments[i-1]))},close:function(){this.fire("close")},"bus attachmentUploaded":function(evt){var self=this,fields=[{general:["id"]}].concat(self._getFields()[0].attachments);self.store.save("attachment",{id:evt.data.data.id,$set:{},fields:fields}).done({success:function(){self.bus.fire("attachmentUploadCompleted",{element:evt.data.element})}})}});return modelAttachments});
define('tau/models/model.attachments.editable',["Underscore","tau/core/model.editable.base"],function(_,EditableModelBase){return EditableModelBase.extend({category:"edit",name:"Editable attachment","bus dataBind":function(evt){this.bus.fire("permissionsReady",{editable:!0,deletable:!0}),this._attachments||(this._attachments=evt.data.items)},"bus attachmentUploaded":function(evt){this._addAttachment(evt.data.data)},onInit:function(){var self=this;this.store.on({eventName:"afterRemove",listener:self,type:"attachment"},function(evt){var id=parseInt(evt.data.cmd.config.id);self._isValidAttachmentId(id)&&(self._removeAttachment(id),self.bus.fire("afterAttachmentRemove",{id:id}))})},_addAttachment:function(attachment){this._attachments.push(attachment)},_removeAttachment:function(attachmentId){this._attachments=_.reject(this._attachments,function(attachment){return attachmentId===attachment.id})},_isValidAttachmentId:function(id){return _.any(this._attachments,function(attachment){return attachment.id===id})}})});
/*
 * jQuery Iframe Transport Plugin 1.3
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

(function(factory){typeof define=="function"&&define.amd?define('libs/jquery/jquery.iframe-transport',["jQuery"],factory):factory(window.jQuery)})(function($){var counter=0;$.ajaxTransport("iframe",function(options){if(options.async&&(options.type==="POST"||options.type==="GET")){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>'),iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+(counter+=1)+'"></iframe>').bind("load",function(){var fileInputClones;iframe.unbind("load").bind("load",function(){var response;try{response=iframe.contents();if(!response.length||!response[0].firstChild)throw new Error}catch(e){response=undefined}completeCallback(200,"success",{iframe:response}),$('<iframe src="javascript:false;"></iframe>').appendTo(form),form.remove()}),form.prop("target",iframe.prop("name")).prop("action",options.url).prop("method",options.type),options.formData&&$.each(options.formData,function(index,field){$('<input type="hidden"/>').prop("name",field.name).val(field.value).appendTo(form)}),options.fileInput&&options.fileInput.length&&options.type==="POST"&&(fileInputClones=options.fileInput.clone(),options.fileInput.after(function(index){return fileInputClones[index]}),options.paramName&&options.fileInput.each(function(){$(this).prop("name",options.paramName)}),form.append(options.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),form.submit(),fileInputClones&&fileInputClones.length&&options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).prop("name",clone.prop("name")),clone.replaceWith(input)})}),form.append(iframe).appendTo(document.body)},abort:function(){iframe&&iframe.unbind("load").prop("src","javascript".concat(":false;")),form&&form.remove()}}}}),$.ajaxSetup({converters:{"iframe text":function(iframe){return $(iframe[0].body).text()},"iframe json":function(iframe){return $.parseJSON($(iframe[0].body).text())},"iframe html":function(iframe){return $(iframe[0].body).html()},"iframe script":function(iframe){return $.globalEval($(iframe[0].body).text())}}})});
/*
 * jQuery File Upload Plugin 5.6
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */

(function(factory){typeof define=="function"&&define.amd?define('libs/jquery/jquery.fileupload',["jQuery","./jquery.iframe-transport"],factory):factory(window.jQuery)})(function($){$.widget("blueimp.fileupload",{options:{namespace:undefined,dropZone:$(document),fileInput:undefined,replaceFileInput:!0,paramName:undefined,singleFileUploads:!0,limitMultiFileUploads:undefined,sequentialUploads:!1,limitConcurrentUploads:undefined,forceIframeTransport:!1,postMessage:undefined,multipart:!0,maxChunkSize:undefined,uploadedBytes:undefined,recalculateProgress:!0,formData:function(form){return form.serializeArray()},add:function(e,data){data.submit()},processData:!1,contentType:!1,cache:!1},_refreshOptionsList:["namespace","dropZone","fileInput"],_isXHRUpload:function(options){var undef="undefined";return!options.forceIframeTransport&&typeof XMLHttpRequestUpload!==undef&&typeof File!==undef&&(!options.multipart||typeof FormData!==undef)},_getFormData:function(options){var formData;return typeof options.formData=="function"?options.formData(options.form):$.isArray(options.formData)?options.formData:options.formData?(formData=[],$.each(options.formData,function(name,value){formData.push({name:name,value:value})}),formData):[]},_getTotal:function(files){var total=0;return $.each(files,function(index,file){total+=file.size||1}),total},_onProgress:function(e,data){if(e.lengthComputable){var total=data.total||this._getTotal(data.files),loaded=parseInt(e.loaded/e.total*(data.chunkSize||total),10)+(data.uploadedBytes||0);this._loaded+=loaded-(data.loaded||data.uploadedBytes||0),data.lengthComputable=!0,data.loaded=loaded,data.total=total,this._trigger("progress",e,data),this._trigger("progressall",e,{lengthComputable:!0,loaded:this._loaded,total:this._total})}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();xhr.upload&&($(xhr.upload).bind("progress",function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable,e.loaded=oe.loaded,e.total=oe.total,that._onProgress(e,options)}),options.xhr=function(){return xhr})},_initXHRData:function(options){var formData,file=options.files[0];if(!options.multipart||options.blob)options.headers=$.extend(options.headers,{"X-File-Name":file.name,"X-File-Type":file.type,"X-File-Size":file.size}),options.blob?options.multipart||(options.contentType="application/octet-stream",options.data=options.blob):(options.contentType=file.type,options.data=file);options.multipart&&typeof FormData!="undefined"&&(options.postMessage?(formData=this._getFormData(options),options.blob?formData.push({name:options.paramName,value:options.blob}):$.each(options.files,function(index,file){formData.push({name:options.paramName,value:file})})):(options.formData instanceof FormData?formData=options.formData:(formData=new FormData,$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value)})),options.blob?formData.append(options.paramName,options.blob):$.each(options.files,function(index,file){file instanceof Blob&&formData.append(options.paramName,file)})),options.data=formData),options.blob=null},_initIframeSettings:function(options){options.dataType="iframe "+(options.dataType||""),options.formData=this._getFormData(options)},_initDataSettings:function(options){this._isXHRUpload(options)?(this._chunkedUpload(options,!0)||(options.data||this._initXHRData(options),this._initProgressListener(options)),options.postMessage&&(options.dataType="postmessage "+(options.dataType||""))):this._initIframeSettings(options,"iframe")},_initFormSettings:function(options){if(!options.form||!options.form.length)options.form=$(options.fileInput.prop("form"));options.paramName||(options.paramName=options.fileInput.prop("name")||"files[]"),options.url||(options.url=options.form.prop("action")||location.href),options.type=(options.type||options.form.prop("method")||"").toUpperCase(),options.type!=="POST"&&options.type!=="PUT"&&(options.type="POST")},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);return this._initFormSettings(options),this._initDataSettings(options),options},_enhancePromise:function(promise){return promise.success=promise.done,promise.error=promise.fail,promise.complete=promise.always,promise},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();return context=context||this.options.context||promise,resolveOrReject===!0?dfd.resolveWith(context,args):resolveOrReject===!1&&dfd.rejectWith(context,args),promise.abort=dfd.promise,this._enhancePromise(promise)},_chunkedUpload:function(options,testOnly){var that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes=options.uploadedBytes||0,mcs=options.maxChunkSize||fs,slice=file.webkitSlice||file.mozSlice||file.slice,upload,n,jqXHR,pipe;return!(this._isXHRUpload(options)&&slice&&(ub||mcs<fs))||options.data?!1:testOnly?!0:ub>=fs?(file.error="uploadedBytes",this._getXHRPromise(!1,options.context,[null,"error",file.error])):(n=Math.ceil((fs-ub)/mcs),upload=function(i){return i?upload(i-=1).pipe(function(){var o=$.extend({},options);return o.blob=slice.call(file,ub+i*mcs,ub+(i+1)*mcs),o.chunkSize=o.blob.size,that._initXHRData(o),that._initProgressListener(o),jqXHR=($.ajax(o)||that._getXHRPromise(!1,o.context)).done(function(){o.loaded||that._onProgress($.Event("progress",{lengthComputable:!0,loaded:o.chunkSize,total:o.chunkSize}),o),options.uploadedBytes=o.uploadedBytes+=o.chunkSize}),jqXHR}):that._getXHRPromise(!0,options.context)},pipe=upload(n),pipe.abort=function(){return jqXHR.abort()},this._enhancePromise(pipe))},_beforeSend:function(e,data){this._active===0&&this._trigger("start"),this._active+=1,this._loaded+=data.uploadedBytes||0,this._total+=this._getTotal(data.files)},_onDone:function(result,textStatus,jqXHR,options){this._isXHRUpload(options)||this._onProgress($.Event("progress",{lengthComputable:!0,loaded:1,total:1}),options),options.result=result,options.textStatus=textStatus,options.jqXHR=jqXHR,this._trigger("done",null,options)},_onFail:function(jqXHR,textStatus,errorThrown,options){options.jqXHR=jqXHR,options.textStatus=textStatus,options.errorThrown=errorThrown,this._trigger("fail",null,options),options.recalculateProgress&&(this._loaded-=options.loaded||options.uploadedBytes||0,this._total-=options.total||this._getTotal(options.files))},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._active-=1,options.textStatus=textStatus,jqXHRorError&&jqXHRorError.always?(options.jqXHR=jqXHRorError,options.result=jqXHRorResult):(options.jqXHR=jqXHRorResult,options.errorThrown=jqXHRorError),this._trigger("always",null,options),this._active===0&&(this._trigger("stop"),this._loaded=this._total=0)},_onSend:function(e,data){var that=this,jqXHR,slot,pipe,options=that._getAJAXSettings(data),send=function(resolve,args){return that._sending+=1,jqXHR=jqXHR||(resolve!==!1&&that._trigger("send",e,options)!==!1&&(that._chunkedUpload(options)||$.ajax(options))||that._getXHRPromise(!1,options.context,args)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options)}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options)}).always(function(jqXHRorResult,textStatus,jqXHRorError){that._sending-=1,that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options);if(options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending){var nextSlot=that._slots.shift();while(nextSlot){if(!nextSlot.isRejected()){nextSlot.resolve();break}nextSlot=that._slots.shift()}}}),jqXHR};return this._beforeSend(e,options),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(slot=$.Deferred(),this._slots.push(slot),pipe=slot.pipe(send)):pipe=this._sequence=this._sequence.pipe(send,send),pipe.abort=function(){var args=[undefined,"abort","abort"];return jqXHR?jqXHR.abort():(slot&&slot.rejectWith(args),send(!1,args))},this._enhancePromise(pipe)):send()},_onAdd:function(e,data){var that=this,result=!0,options=$.extend({},this.options,data),limit=options.limitMultiFileUploads,fileSet,i;if(!options.singleFileUploads&&!limit||!this._isXHRUpload(options))fileSet=[data.files];else if(!options.singleFileUploads&&limit){fileSet=[];for(i=0;i<data.files.length;i+=limit)fileSet.push(data.files.slice(i,i+limit))}return data.originalFiles=data.files,$.each(fileSet||data.files,function(index,element){var files=fileSet?element:[element],newData=$.extend({},data,{files:files});return newData.submit=function(){return newData.jqXHR=this.jqXHR=that._trigger("submit",e,this)!==!1&&that._onSend(e,this),this.jqXHR},result=that._trigger("add",e,newData)}),result},_normalizeFile:function(index,file){file.name===undefined&&file.size===undefined&&(file.name=file.fileName,file.size=file.fileSize)},_replaceFileInput:function(input){var inputClone=input.clone(!0);$("<form></form>").append(inputClone)[0].reset(),input.after(inputClone).detach(),$.cleanData(input.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(i,el){return el===input[0]?inputClone[0]:el}),input[0]===this.element[0]&&(this.element=inputClone)},_onChange:function(e){var that=e.data.fileupload,data={files:$.each($.makeArray(e.target.files),that._normalizeFile),fileInput:$(e.target),form:$(e.target.form)};data.files.length||(data.files=[{name:e.target.value.replace(/^.*\\/,"")}]),that.options.replaceFileInput&&that._replaceFileInput(data.fileInput);if(that._trigger("change",e,data)===!1||that._onAdd(e,data)===!1)return!1},_onPaste:function(e){var that=e.data.fileupload,cbd=e.originalEvent.clipboardData,items=cbd&&cbd.items||[],data={files:[]};$.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();file&&data.files.push(file)});if(that._trigger("paste",e,data)===!1||that._onAdd(e,data)===!1)return!1},_onDrop:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer,data={files:$.each($.makeArray(dataTransfer&&dataTransfer.files),that._normalizeFile)};if(that._trigger("drop",e,data)===!1||that._onAdd(e,data)===!1)return!1;e.preventDefault()},_onDragOver:function(e){var that=e.data.fileupload,dataTransfer=e.dataTransfer=e.originalEvent.dataTransfer;if(that._trigger("dragover",e)===!1)return!1;dataTransfer&&(dataTransfer.dropEffect=dataTransfer.effectAllowed="copy"),e.preventDefault()},_initEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.bind("dragover."+ns,{fileupload:this},this._onDragOver).bind("drop."+ns,{fileupload:this},this._onDrop).bind("paste."+ns,{fileupload:this},this._onPaste),this.options.fileInput.bind("change."+ns,{fileupload:this},this._onChange)},_destroyEventHandlers:function(){var ns=this.options.namespace;this.options.dropZone.unbind("dragover."+ns,this._onDragOver).unbind("drop."+ns,this._onDrop).unbind("paste."+ns,this._onPaste),this.options.fileInput.unbind("change."+ns,this._onChange)},_beforeSetOption:function(key,value){this._destroyEventHandlers()},_afterSetOption:function(key,value){var options=this.options;options.fileInput||(options.fileInput=$()),options.dropZone||(options.dropZone=$()),this._initEventHandlers()},_setOption:function(key,value){var refresh=$.inArray(key,this._refreshOptionsList)!==-1;refresh&&this._beforeSetOption(key,value),$.Widget.prototype._setOption.call(this,key,value),refresh&&this._afterSetOption(key,value)},_create:function(){var options=this.options;options.namespace=options.namespace||this.widgetName,options.fileInput===undefined?options.fileInput=this.element.is("input:file")?this.element:this.element.find("input:file"):options.fileInput||(options.fileInput=$()),options.dropZone||(options.dropZone=$()),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=this._loaded=this._total=0,this._initEventHandlers()},destroy:function(){this._destroyEventHandlers(),$.Widget.prototype.destroy.call(this)},enable:function(){$.Widget.prototype.enable.call(this),this._initEventHandlers()},disable:function(){this._destroyEventHandlers(),$.Widget.prototype.disable.call(this)},add:function(data){if(!data||this.options.disabled)return;data.files=$.each($.makeArray(data.files),this._normalizeFile),this._onAdd(null,data)},send:function(data){if(data&&!this.options.disabled){data.files=$.each($.makeArray(data.files),this._normalizeFile);if(data.files.length)return this._onSend(null,data)}return this._getXHRPromise(!1,data&&data.context)}})});
define('tau/components/extensions/attachments/component.attachments.uploader',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","libs/jquery/jquery.fileupload","libs/jquery/jquery.iframe-transport"],function(_,$,ComponentExtensionBase,dateUtils,fileUploader,transport){var errorRegExp=/<title\b[^>]*>(.*?)<\/title>/;return ComponentExtensionBase.extend({"bus permissionsReady+afterRender":function(evt){if(!this._initialized){this._initialized=!0,this.element=evt.afterRender.data.element;var permissions=evt.permissionsReady.data;permissions.editable&&permissions.deletable&&this._initUploader()}},_initUploader:function(){this._createToolbar(),this._bindUploader()},_createToolbar:function(){var $toolbar=$('<div class="uploader-toolbar"></div>'),$fileBrowser=this._createFileBrowser();$toolbar.append($fileBrowser).prependTo(this.element),this._$fileInput=$fileBrowser.find("input"),/\bapple\b/i.test(navigator.vendor)&&this._$fileInput.removeAttr("multiple")},_bindUploader:function(){this._$fileInput.fileupload({url:this._getUploadUrl(),formData:this._getFormData(),add:$.proxy(this,"_onFileAdd")})},_createFileBrowser:function(){return $('<span class="fileBrowser"><i>Attach files</i></span>').append($('<input type="file" multiple/>'))},_getUploadUrl:function(){return this.config.context.configurator.getApplicationPath()+"/UploadFile.ashx"},_getFormData:function(){return[{name:"generalId",value:this._getGeneralId()}]},_getGeneralId:function(){return this.config.context.entity.id},_getGeneralType:function(){return this.config.context.entity.entityType.name},_onFileAdd:function(event,data){var self=this;if(!data.files||data.files.length==0)return;var $newAttachment=this._createAttachmentDummy(data.files[0].name);$newAttachment.appendTo(this._getAttachmentsPlaceholder()),data.submit().success(function(result){var responseText=self._getResponseText(result);try{var attachmentData=self._parseResponse(responseText)}catch(e){self._onAttachmentUploadFail($newAttachment);return}self.bus.fire("attachmentUploaded",{element:self._updateAttachmentElement($newAttachment,attachmentData),data:attachmentData})}).error(function(jqXHR,textStatus,errorThrown){var matches=jqXHR.responseText.match(errorRegExp),error="Looks like application is not available. Please check your connection or server availability";matches&&matches.length>0&&(error=matches[1]),self._onAttachmentUploadFail($newAttachment,error)})},_updateAttachmentElement:function($attachmentElement,attachmentData){var $updatedAttachmentElement=this._createAttachmentElement(attachmentData);return $attachmentElement.replaceWith($updatedAttachmentElement),$updatedAttachmentElement},_onAttachmentUploadFail:function($attachmentElement,error){this._deleteFailedAttachmentElement($attachmentElement,error)},_getResponseText:function(result){var responseText="";return typeof result=="string"?responseText=result:result.jquery&&(responseText=result.text()),responseText},_createAttachmentDummy:function(name){var $attachmentDummy=this._createAttachmentElement({name:name});return $attachmentDummy.addClass("uploading").find(".toolbar").remove(),$attachmentDummy},_deleteFailedAttachmentElement:function($attachmentElement,error){error=error||"Upload failed",this.fire("error",{message:error}),$attachmentElement.addClass("failed");var $errorLabel=$('<p class="error"></p>').insertAfter($attachmentElement.find(".name"));$errorLabel.text("Upload failed"),$attachmentElement.fadeOut(1500,function(){$attachmentElement.remove()})},_getAttachmentsPlaceholder:function(){return this.element.find(".ui-attachments-content")},_createAttachmentElement:function(data){return $.tmpl("attachments-attachment",data)},_parseResponse:function(responseText){var xArray;try{xArray=JSON.parse(responseText),xArray=xArray.items||xArray,xArray=xArray.pop()}catch(e){}var date=dateUtils.parse(dateUtils.convertToTimezone(xArray[1])),result={id:xArray[0],uri:xArray[4],thumbnailUri:xArray[5],mimeType:xArray[3],name:xArray[2],ownerName:xArray[6][1]+" "+xArray[6][2],date:dateUtils.format.date.short(date)};return result}})});
define('tau/components/extensions/attachments/component.attachments.selectable',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){var $attachmentsContainer=evt.data.element;$attachmentsContainer.delegate("[role=attachment]","click",$.proxy(this,"_onAttachmentClick"))},_onAttachmentClick:function(evt){var $target=$(evt.target),isTargetElementInsideToolbarElement=$target.closest(".toolbar").size()!=0;if(!isTargetElementInsideToolbarElement){evt.preventDefault();var $attachment=$target.closest(".ui-attach");this.bus.fire("attachmentSelected",{attachment:$attachment.data().tmplItem.data,index:$attachment.index()})}}})});
define('tau/components/extensions/attachments/component.attachments.showPreview',["Underscore","tau/components/extensions/component.creator.extension"],function(_,ComponentCreatorExtension){var attachmentsExtension=ComponentCreatorExtension.extend({"bus initialize":function(evtArgs){var context=evtArgs.data.context,assignable=context.entity;this.contextForPreview={applicationContext:context.applicationContext};var generalEntity={entityType:assignable.entityType,id:assignable.id};_(this.contextForPreview).extend({entity:generalEntity,configurator:context.configurator})},"bus attachmentSelected":function(evtArgs){var attachment=evtArgs.data.attachment;attachment.mimeType=attachment.mimeType||"";if(attachment.mimeType.indexOf("image/")==0){var componentsConfig={components:[{type:"attachmentsPreview",selected:{id:attachment.id}}],context:this.contextForPreview};this.createComponents(componentsConfig,function(data){var item=data[0],attachmentPreviewComponent=item.component;attachmentPreviewComponent.on("afterRender",function(evtArgs){evtArgs.removeListener(),evtArgs.data.element.appendTo($("body"))}),attachmentPreviewComponent.fire("initialize")})}else window.open(attachment.uri,"_blank")}});return attachmentsExtension});
define('tau/components/extensions/attachments/component.attachments.thumbProxy',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){var $thumbnails=evt.data.element.find(".ui-attach .preview img");$thumbnails.each(function(){var $thumb=$(this);if(!$thumb.prop("complete")){var $thumbContainer=$thumb.parent();$thumbContainer.addClass("loading"),$thumb.load(function(){$thumbContainer.removeClass("loading")})}})}})});
define('tau/components/extensions/attachments/component.attachments.deletable',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus permissionsReady+afterRender":function(evt){this.$element=evt.afterRender.data.element;var permissions=evt.permissionsReady.data;permissions.deletable&&this._createDeleteTriggers()},"bus attachmentUploaded":function(evt){this._createDeleteTriggers()},"bus afterAttachmentRemove":function(evt){var self=this,attachmentId=evt.data.id,$attachmentElement=this.$element.find("#attach-"+attachmentId);$attachmentElement.animate({opacity:0},{complete:function(){$attachmentElement.remove()}})},_getDeleteTriggerProto:function(){return this._deleteTriggerProto||(this._deleteTriggerProto=$('<button class="delete" type="button">delete</button>').click($.proxy(this,"_onAttachmentDelete"))),this._deleteTriggerProto},_createDeleteTriggers:function(){var self=this;this.$element.find(".ui-attach:not(.deletable)").each(function(index,attachElement){$(attachElement).addClass("deletable").find(".toolbar").append(self._getDeleteTriggerProto().clone(!0))})},_onAttachmentDelete:function(evt){var $confirmationPlaceholder=this._findUpConfirmationPlaceholder($(evt.target));$confirmationPlaceholder.data("confirmation")||this._createConfirmation($confirmationPlaceholder),this._showConfirmation($confirmationPlaceholder)},_findUpConfirmationPlaceholder:function($trigger){return $trigger.closest(".ui-attach").children(".inner")},_findUpAttachElement:function($trigger){return $trigger.closest(".ui-attach")},_createConfirmation:function($placeholder){$placeholder.confirmation({message:"Delete attachment?",ok:$.proxy(this,"_deleteAttachment"),cancel:$.proxy(this,"_cancelAttachmentDelete")})},_showConfirmation:function($placeholder){$placeholder.confirmation("show")},_hideConfirmation:function($placeholder){$placeholder.confirmation("hide")},_deleteAttachment:function(evt){var $target=$(evt.target);this._hideConfirmation(this._findUpConfirmationPlaceholder($target));var $attachElement=this._findUpAttachElement($target);this.bus.fire("markElementToBeDeleted",{element:$attachElement}),this.bus.fire("remove",{id:$attachElement.attr("id").replace(/[^\d]/g,""),typeName:"attachment"})},_cancelAttachmentDelete:function(evt){this._hideConfirmation(this._findUpConfirmationPlaceholder($(evt.target)))}})});
define('tau/ui/templates/attachments/ui.template.attachments.attachment',["tau/core/tau","tau/core/templates-factory"],function(tau,templates){var config={name:"attachments-attachment",markup:tau.concat('<div id="attach-${id}" class="ui-attach">','<div class="inner" role="attachment">','<a class="preview" href="${uri}" target="_blank">','<img src="${thumbnailUri}" />',"</a>",'<p class="name">${name}</p>','<p class="owner">by ${ownerName}</p>','<p class="date">on ${date}</p>','<p class="toolbar">','<a class="download" href="${uri}" target="_blank">download</a>',"</p>","</div>","</div>")};return templates.register(config)});
define('tau/ui/templates/attachments/ui.template.attachments',["tau/core/templates-factory","tau/ui/templates/attachments/ui.template.attachments.attachment"],function(templates){var config={name:"attachments",options:{contentSelector:".ui-attachments-content"},dependencies:["attachments-attachment"],markup:['<div class="box ui-attachments-control">','   <div class="ui-attachments-content">','       {{tmpl(items) "attachments-attachment"}}',"   </div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.attachments',["tau/components/component.creator","tau/models/model.attachments","tau/models/model.attachments.editable","tau/components/extensions/attachments/component.attachments.uploader","tau/components/extensions/attachments/component.attachments.selectable","tau/components/extensions/attachments/component.attachments.showPreview","tau/components/extensions/attachments/component.attachments.thumbProxy","tau/components/extensions/attachments/component.attachments.deletable","tau/components/extensions/error/extension.errorBar","tau/ui/templates/attachments/ui.template.attachments"],function(creator,ModelType,EditableModelType,uploader,selectable,showPreview,thumbProxy,deletable,ErrorConsole,template){return{create:function(config){var _config=config||{},creatorConfig={extensions:[ModelType,EditableModelType,uploader,selectable,showPreview,thumbProxy,deletable,ErrorConsole],template:template};return creator.create(creatorConfig,_config)}}});
define('tau/models/model.attachmentsPreview',["tau/core/extension.base"],function(ModelBase){var Model=ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,store=configurator.getStore(),entity=initConfig.config.context.entity,selected=initConfig.config.selected;store.get(entity.entityType.name,{id:entity.id,fields:[{attachments:["id","date","name","mimeType","uri","thumbnailUri"]}]}).done({success:_.bind(function(res){var attachments=_(res[0].data.attachments).chain().filter(function(v){return v.mimeType===null||(v.mimeType||"").match(/^image\//)}).map(function(v){return v.selected=v.id==selected.id,v}).value(),selectedAttachment=_.find(attachments,function(v){return v.id==selected.id});this.fire("dataBind",{selected:selectedAttachment,items:attachments})},this)})}});return Model});
define('tau/ui/extensions/attachmentsPreview/ui.extension.attachmentsPreview',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var self=this;self.element=evt.data.element,self.element.find(".thumbnail-nav").click(_.bind(self._onAttachmentThumbnailsContainerClick,self)),self.element.find(".toolbar .prev, .toolbar .next").click($.proxy(self,"_onAttachmentsNavigationClick")),self.element.click($.proxy(self,"_onClose")),this.config.context.configurator.getKeyBoardManager().pushHandler({handleKeyDown:function(){self._onKeyDown.apply(self,arguments)}})},"bus destroy":function(){this.destroy()},"bus changeSelected":function(evtArgs){var attachment=evtArgs.data.attachment;this._changeSelectedAttachment(attachment)},_getSelectedAttachmentSelector:function(){return".thumbnail-nav > li > img.selected"},_getAttachmentsCount:function(){return this.element.find(".thumbnail-nav > li").length},_getCurrentSelectedAttachment:function(){return this.element.find(this._getSelectedAttachmentSelector()).parent().data().tmplItem.data},_getAttachmentData:function(index){return this.element.find(".thumbnail-nav > li").eq(index).data().tmplItem.data},_getCurrentSelectedAttachmentIndex:function(){return this.element.find(this._getSelectedAttachmentSelector()).parent().index()},_changeSelectedAttachment:function(attachment){if(this._getCurrentSelectedAttachment().id==attachment.id)return;var element=this.element;element.find(".thumbnail-nav > li > img.selected").removeClass("selected");var $thumbnails=element.find(".thumbnail-nav > li > img"),self=this;$thumbnails.each(function(){if($(this).parent("li").data().tmplItem.data.id==attachment.id){$(this).addClass("selected");var $img=element.find(".ui-attachment-view-image");return self.bus.fire("beforeChangeImage",attachment.uri)&&($img.attr("src",attachment.uri),self.bus.fire("afterChangeImage")),!1}})},_onKeyDown:function(evt){evt.keyCode==$.ui.keyCode.ESCAPE&&this._close()},_close:function(){this.element.remove(),this.bus.fire("closed"),this.fire("destroy")},_next:function(){var index=this._getCurrentSelectedAttachmentIndex()+1;index>=this._getAttachmentsCount()&&(index=0),this._setSelectedAttachmentIndex(index)},_prev:function(){var index=this._getCurrentSelectedAttachmentIndex()-1;index<0&&(index=this._getAttachmentsCount()-1),this._setSelectedAttachmentIndex(index)},_setSelectedAttachmentIndex:function(index){this._changeSelectedAttachment(this._getAttachmentData(index))},_closeButtonClick:function(evtArgs){evtArgs.stopPropagation(),this._close()},_onAttachmentsNavigationClick:function(evt){evt.stopPropagation();var $element=$(evt.target);$element.hasClass("prev")?this._prev():$element.hasClass("next")&&this._next()},_onAttachmentThumbnailsContainerClick:function(event){event.stopPropagation();var $target=$(event.target);if($target.is(".ui-attach-thumbnail")){var data=$target.parent("li").data(),attachment=data.tmplItem.data;this._changeSelectedAttachment(attachment)}},_onClose:function(evt){/^img$/i.test(evt.target.tagName)||this._close()},destroy:function(){this.config.context.configurator.getKeyBoardManager().popHandler(),this.element.find(".ui-attachments-control > .display-table").unbind("click")}})});
define('tau/ui/extensions/attachmentsPreview/ui.extension.attachmentsPreview.animations',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({"bus afterRender":function(evt){var self=this;self.element=evt.data.element,$(window).bind("resize",function(){self._resizeImage()});var $wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image");$image.hide(),$wait.show(),this.element.find(".ui-attachment-view-image").bind("load",function(){self._onImageLoad()});var onThumbnailLoad=function(){$(this).parent().removeClass("ui-thumbnail-loading"),$(this).unbind("load",onThumbnailLoad),$(this).fadeIn("slow")};this.element.find(".thumbnail-nav li").addClass("ui-thumbnail-loading"),this.element.find(".thumbnail-nav li > img").each(function(){this.complete?onThumbnailLoad.call(this):$(this).bind("load",onThumbnailLoad).hide()})},_onImageLoad:function(){var self=this,$wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image");self._resizeImage(),$image.fadeIn("slow",function(){$wait.hide()})},_resizeImage:function(){var self=this,$element=self.element;if(!$element)return;var $wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image"),$swapView=$element.find(".image-view");$image.width(""),$image.height("");var width=$swapView.width(),height=$swapView.height(),imageWidth=$image.width(),imageHeight=$image.height();if(imageWidth>width||imageHeight>height){var destWidth=height/imageHeight*imageWidth,destHeight=width/imageWidth*imageHeight;destWidth<width?($image.width(destWidth),$image.height(height)):($image.width(width),$image.height(destHeight))}return{$wait:$wait,$image:$image}},"bus beforeChangeImage":function(evtArgs){var self=this,$wait=self.element.find(".ui-attachment-wait"),$image=self.element.find(".ui-attachment-view-image");$wait.show();var imgUrl=evtArgs.data;$image.fadeOut("slow",function(){$image.attr("src",imgUrl)}),evtArgs.data=!1}})});
define('tau/ui/templates/attachmentsPreview/ui.template.attachmentsPreview.attachmentThumbnail',["tau/core/templates-factory"],function(templates){var config={name:"attachments-preview-attachment-thumbnail",markup:["<li>",'   <img class="ui-attach-thumbnail{{if selected}} selected{{/if}}" src="${thumbnailUri}"   />',"</li>"].join("")};return templates.register(config)});
define('tau/ui/templates/attachmentsPreview/ui.template.attachmentsPreview',["tau/core/templates-factory","tau/ui/templates/attachmentsPreview/ui.template.attachmentsPreview.attachmentThumbnail"],function(templates){var config={name:"attachments-preview",markup:['<div class="ui-attachments-preview-control">','<div class="toolbar">','<button class="close" type="button">X</button>','<button class="prev" type="button">&larr;</button>','<button class="next" type="button">&rarr;</button>',"</div>",'<div class="swap-view">','<div class="image-view">','<div class="ui-attachment-wait"></div>','<img class="ui-attachment-view-image" src="${selected.uri}">',"</div>","</div>",'<ul class="thumbnail-nav">','{{tmpl(items) "attachments-preview-attachment-thumbnail"}}',"</ul>","</div>"],dependencies:["attachments-preview-attachment-thumbnail"]};return templates.register(config)});
define('tau/components/component.attachmentsPreview',["tau/components/component.creator","tau/models/model.attachmentsPreview","tau/ui/extensions/attachmentsPreview/ui.extension.attachmentsPreview","tau/ui/extensions/attachmentsPreview/ui.extension.attachmentsPreview.animations","tau/ui/templates/attachmentsPreview/ui.template.attachmentsPreview"],function(creator,ModelType,ExtensionMain,ExtensionAnimation,template){return{create:function(config){var imageFilterFunction=function(attachment){return},creatorConfig={ModelType:ModelType,extensions:[ExtensionMain,ExtensionAnimation],template:template};return config.filter=config.filter||imageFilterFunction,creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/auditHistory/ui.extension.auditHistory',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({getColumns:function(){return[{Id:"RowID",Title:null,Type:"string",IsSynthetic:!0,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"Entity",Title:null,Type:"string",IsSynthetic:!0,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"ID",Title:null,Type:"string",IsSynthetic:!0,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"Modification",Title:null,Type:"int",IsSynthetic:!0,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"ProjectID",Title:null,Type:"int",IsSynthetic:!0,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"InnerEntity",Title:null,Type:"string",IsSynthetic:!0,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"Date",Title:"Date Time",Type:"date",IsSynthetic:!1,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}},{Id:"Description",Title:"Action",Type:"HTMLText",IsSynthetic:!1,IsUpdateable:!1,IsRequired:!1,Width:300,Facet:{}},{Id:"Modifier",Title:"Modified By",Type:"HTMLText",IsSynthetic:!1,IsUpdateable:!1,IsRequired:!1,Width:null,Facet:{}}]},getDataRequest:function(){var entity=this.config.context.entity;return{GridID:null,GroupBy:null,OrderBy:"Date",OrderDir:!1,Start:0,Limit:10,Cnt:{ID:entity.id,Type:entity.entityType.name}}},"bus extJsHistoryPanel":function(args){var panel=args.data.panel;this.config.store.on({type:"general",eventName:"afterSave",filter:{id:this.config.context.entity.id},listener:this},function(args){setTimeout(function(){panel&&panel.store&&panel.getStore().reload()},500)})},destroy:function(){this.config.store.unbind(this),this._super()},"bus extJsHistoryPanel+destroy":function(args){var panel=args.extJsHistoryPanel.data.panel;panel.destroy()},"bus initialize":function(){var self=this,pathToService=this.config.context.configurator.getApplicationPath()+"/PageServices/AuditHistoryListService.asmx/js?d=1";require([pathToService],function(){self.fire("serviceLoaded")})},"bus beforeInit":function(){this.fire("dataBind",{})},"bus afterRender+serviceLoaded":function(evtArgs){var $element=evtArgs.afterRender.data.element,element=$element[0],self=this;self.config.store.unbind(this),gridPanelType="Ext.grid.GridPanel",configurationFactory="Tp.controls.grid.AuditHistoryConfigurationFactory",editorFieldFactory="Tp.controls.grid.AuditHistoryFieldFactory",gridProxy="Ext.Tp.GridServiceProxy({ webServiceProxy: Tp.Web.Extensions.ExtJs.AuditHistoryListService, webServiceProxyMethod: Tp.Web.Extensions.ExtJs.AuditHistoryListService.GetData })";var config={id:"super_grid",canEdit:!1,canDelete:!1,isOwner:!1,gridHeader:{Title:"History",Columns:self.getColumns()},gridDataRequest:self.getDataRequest(),pluginTypes:"Tp.controls.grid.plugins.HidePagingConstraint",innerGridConfig:[]};Ext.onReady(function(){var $tempEl=$('<div class="ext-holder"/>').appendTo("body"),factory=Tp.controls.grid.Factory.getInstance();config=factory.getConfigurationFactory(config).createConfig(),config.applyTo=$tempEl[0];var panel=new Ext.grid.GridPanel(config);$tempEl.appendTo($element),panel.on("viewready",function(){var t=setInterval(function(){$element.parents("body").length&&(panel.setWidth($element.width()-45),panel.syncSize(),clearInterval(t))},500)}),self.fire("extJsHistoryPanel",{panel:panel}),$(".ui-empty-data-msg",$element).hide()})}})});
define('tau/ui/templates/auditHistory/ui.template.auditHistory',["tau/core/templates-factory"],function(templates){var config={name:"auditHistory",engine:"jqote2",markup:['<div class="tau-audit-history-placeholder">','<span class="ui-empty-data-msg">loading history...</span>',"</div>"]};return templates.register(config)});
define('tau/components/component.auditHistory',["tau/components/component.creator","tau/ui/extensions/auditHistory/ui.extension.auditHistory","tau/ui/templates/auditHistory/ui.template.auditHistory"],function(creator,ExtensionMain,Template){return{create:function(config){var creatorConfig={name:"auditHistory",extensions:[ExtensionMain],template:Template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.avatar',["jQuery","tau/core/model.editable.base","app.path","tau/core/tau"],function($,ModelBase,AppPath,tau){return ModelBase.extend({onInit:function(){var self=this,entity=this.config.context.entity;this.config.store.get("user",{id:entity.id,fields:["avatarUri"]}).done(function(){self.onUserDataRetrieved.apply(self,arguments)});var avatarService=this.config.context.configurator.getAvatarService();avatarService.getCropRect(entity.id).done(function(cropRect){self.fire("model.crop.ready",cropRect)}),this.config.store.unbind(this),this.config.store.on({eventName:"afterSave",type:"user",hasChanges:["avatarUri"],listener:self},function(){self.fire("avatarChanged")})},onUserDataRetrieved:function(result){var entity=result[0].data,sizeAvatar=this.config.context.avatarSize||64;this.fire("dataBind",{url:entity.avatarUri+sizeAvatar+tau.getTokenParameterFromQueryString("&"),id:entity.id})}})});
/**
 * jquery.Jcrop.js v0.9.10
 * jQuery Image Cropping Plugin - released under MIT License
 * Author: Kelly Hallman <khallman@gmail.com>
 * http://github.com/tapmodo/Jcrop
 * Copyright (c) 2008-2012 Tapmodo Interactive LLC {{{
 *
 * Permission is hereby granted, free of charge, to any person
 * obtaining a copy of this software and associated documentation
 * files (the "Software"), to deal in the Software without
 * restriction, including without limitation the rights to use,
 * copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the
 * Software is furnished to do so, subject to the following
 * conditions:
 *
 * The above copyright notice and this permission notice shall be
 * included in all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
 * EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
 * OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
 * NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
 * HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
 * FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
 * OTHER DEALINGS IN THE SOFTWARE.
 *
 * }}}
 */

define('libs/jquery/jquery.Jcrop',["libs/jquery/jquery.ui"],function(jQuery){(function($){$.Jcrop=function(obj,opt){function px(n){return n+"px"}function cssClass(cl){return options.baseClass+"-"+cl}function supportsColorFade(){return $.fx.step.hasOwnProperty("backgroundColor")}function getPos(obj){var pos=$(obj).offset();return[pos.left,pos.top]}function mouseAbs(e){return[e.pageX-docOffset[0],e.pageY-docOffset[1]]}function setOptions(opt){typeof opt!="object"&&(opt={}),options=$.extend(options,opt),$.each(["onChange","onSelect","onRelease","onDblClick"],function(i,e){typeof options[e]!="function"&&(options[e]=function(){})})}function startDragMode(mode,pos){docOffset=getPos($img),Tracker.setCursor(mode==="move"?mode:mode+"-resize");if(mode==="move")return Tracker.activateHandlers(createMover(pos),doneSelect);var fc=Coords.getFixed(),opp=oppLockCorner(mode),opc=Coords.getCorner(oppLockCorner(opp));Coords.setPressed(Coords.getCorner(opp)),Coords.setCurrent(opc),Tracker.activateHandlers(dragmodeHandler(mode,fc),doneSelect)}function dragmodeHandler(mode,f){return function(pos){if(!options.aspectRatio)switch(mode){case"e":pos[1]=f.y2;break;case"w":pos[1]=f.y2;break;case"n":pos[0]=f.x2;break;case"s":pos[0]=f.x2}else switch(mode){case"e":pos[1]=f.y+1;break;case"w":pos[1]=f.y+1;break;case"n":pos[0]=f.x+1;break;case"s":pos[0]=f.x+1}Coords.setCurrent(pos),Selection.update()}}function createMover(pos){var lloc=pos;return KeyManager.watchKeys(),function(pos){Coords.moveOffset([pos[0]-lloc[0],pos[1]-lloc[1]]),lloc=pos,Selection.update()}}function oppLockCorner(ord){switch(ord){case"n":return"sw";case"s":return"nw";case"e":return"nw";case"w":return"ne";case"ne":return"sw";case"nw":return"se";case"se":return"nw";case"sw":return"ne"}}function createDragger(ord){return function(e){return options.disabled?!1:ord==="move"&&!options.allowMove?!1:(docOffset=getPos($img),btndown=!0,startDragMode(ord,mouseAbs(e)),e.stopPropagation(),e.preventDefault(),!1)}}function presize($obj,w,h){var nw=$obj.width(),nh=$obj.height();nw>w&&w>0&&(nw=w,nh=w/$obj.width()*$obj.height()),nh>h&&h>0&&(nh=h,nw=h/$obj.height()*$obj.width()),xscale=$obj.width()/nw,yscale=$obj.height()/nh,$obj.width(nw).height(nh)}function unscale(c){return{x:c.x*xscale,y:c.y*yscale,x2:c.x2*xscale,y2:c.y2*yscale,w:c.w*xscale,h:c.h*yscale}}function doneSelect(pos){var c=Coords.getFixed();c.w>options.minSelect[0]&&c.h>options.minSelect[1]?(Selection.enableHandles(),Selection.done()):Selection.release(),Tracker.setCursor(options.allowSelect?"crosshair":"default")}function newSelection(e){if(options.disabled)return!1;if(!options.allowSelect)return!1;btndown=!0,docOffset=getPos($img),Selection.disableHandles(),Tracker.setCursor("crosshair");var pos=mouseAbs(e);return Coords.setPressed(pos),Selection.update(),Tracker.activateHandlers(selectDrag,doneSelect),KeyManager.watchKeys(),e.stopPropagation(),e.preventDefault(),!1}function selectDrag(pos){Coords.setCurrent(pos),Selection.update()}function newTracker(){var trk=$("<div></div>").addClass(cssClass("tracker"));return $.browser.msie&&trk.css({opacity:0,backgroundColor:"white"}),trk}function setClass(cname){$div.removeClass().addClass(cssClass("holder")).addClass(cname)}function animateTo(a,callback){function queueAnimator(){window.setTimeout(animator,interv)}var x1=a[0]/xscale,y1=a[1]/yscale,x2=a[2]/xscale,y2=a[3]/yscale;if(animating)return;var animto=Coords.flipCoords(x1,y1,x2,y2),c=Coords.getFixed(),initcr=[c.x,c.y,c.x2,c.y2],animat=initcr,interv=options.animationDelay,ix1=animto[0]-initcr[0],iy1=animto[1]-initcr[1],ix2=animto[2]-initcr[2],iy2=animto[3]-initcr[3],pcent=0,velocity=options.swingSpeed;x=animat[0],y=animat[1],x2=animat[2],y2=animat[3],Selection.animMode(!0);var anim_timer,animator=function(){return function(){pcent+=(100-pcent)/velocity,animat[0]=x+pcent/100*ix1,animat[1]=y+pcent/100*iy1,animat[2]=x2+pcent/100*ix2,animat[3]=y2+pcent/100*iy2,pcent>=99.8&&(pcent=100),pcent<100?(setSelectRaw(animat),queueAnimator()):(Selection.done(),typeof callback=="function"&&callback.call(api))}}();queueAnimator()}function setSelect(rect){setSelectRaw([rect[0]/xscale,rect[1]/yscale,rect[2]/xscale,rect[3]/yscale]),options.onSelect.call(api,unscale(Coords.getFixed())),Selection.enableHandles()}function setSelectRaw(l){Coords.setPressed([l[0],l[1]]),Coords.setCurrent([l[2],l[3]]),Selection.update()}function tellSelect(){return unscale(Coords.getFixed())}function tellScaled(){return Coords.getFixed()}function setOptionsNew(opt){setOptions(opt),interfaceUpdate()}function disableCrop(){options.disabled=!0,Selection.disableHandles(),Selection.setCursor("default"),Tracker.setCursor("default")}function enableCrop(){options.disabled=!1,interfaceUpdate()}function cancelCrop(){Selection.done(),Tracker.activateHandlers(null,null)}function destroy(){$div.remove(),$origimg.show(),$origimg.css("visibility",""),$(obj).removeData("Jcrop")}function setImage(src,callback){Selection.release(),disableCrop();var img=new Image;img.onload=function(){var iw=img.width,ih=img.height,bw=options.boxWidth,bh=options.boxHeight;$img.width(iw).height(ih),$img.attr("src",src),$img2.attr("src",src),presize($img,bw,bh),boundx=$img.width(),boundy=$img.height(),$img2.width(boundx).height(boundy),$trk.width(boundx+bound*2).height(boundy+bound*2),$div.width(boundx).height(boundy),Shade.resize(boundx,boundy),enableCrop(),typeof callback=="function"&&callback.call(api)},img.src=src}function colorChangeMacro($obj,color,now){var mycolor=color||options.bgColor;options.bgFade&&supportsColorFade()&&options.fadeTime&&!now?$obj.animate({backgroundColor:mycolor},{queue:!1,duration:options.fadeTime}):$obj.css("backgroundColor",mycolor)}function interfaceUpdate(alt){options.allowResize?alt?Selection.enableOnly():Selection.enableHandles():Selection.disableHandles(),Tracker.setCursor(options.allowSelect?"crosshair":"default"),Selection.setCursor(options.allowMove?"move":"default"),options.hasOwnProperty("trueSize")&&(xscale=options.trueSize[0]/boundx,yscale=options.trueSize[1]/boundy),options.hasOwnProperty("setSelect")&&(setSelect(options.setSelect),Selection.done(),delete options.setSelect),Shade.refresh(),options.bgColor!=bgcolor&&(colorChangeMacro(options.shade?Shade.getShades():$div,options.shade?options.shadeColor||options.bgColor:options.bgColor),bgcolor=options.bgColor),bgopacity!=options.bgOpacity&&(bgopacity=options.bgOpacity,options.shade?Shade.refresh():Selection.setBgOpacity(bgopacity)),xlimit=options.maxSize[0]||0,ylimit=options.maxSize[1]||0,xmin=options.minSize[0]||0,ymin=options.minSize[1]||0,options.hasOwnProperty("outerImage")&&($img.attr("src",options.outerImage),delete options.outerImage),Selection.refresh()}var options=$.extend({},$.Jcrop.defaults),docOffset,lastcurs,ie6mode=!1;$.browser.msie&&$.browser.version.split(".")[0]==="6"&&(ie6mode=!0),typeof obj!="object"&&(obj=$(obj)[0]),typeof opt!="object"&&(opt={}),setOptions(opt);var img_css={border:"none",visibility:"visible",margin:0,padding:0,position:"absolute",top:0,left:0},$origimg=$(obj),img_mode=!0;if(obj.tagName=="IMG"){if($origimg[0].width!=0&&$origimg[0].height!=0)$origimg.width($origimg[0].width),$origimg.height($origimg[0].height);else{var tempImage=new Image;tempImage.src=$origimg[0].src,$origimg.width(tempImage.width),$origimg.height(tempImage.height)}var $img=$origimg.clone().removeAttr("id").css(img_css).show();$img.width($origimg.width()),$img.height($origimg.height()),$origimg.after($img).hide()}else $img=$origimg.css(img_css).show(),img_mode=!1,options.shade===null&&(options.shade=!0);presize($img,options.boxWidth,options.boxHeight);var boundx=$img.width(),boundy=$img.height(),$div=$("<div />").width(boundx).height(boundy).addClass(cssClass("holder")).css({position:"relative",backgroundColor:options.bgColor}).insertAfter($origimg).append($img);options.addClass&&$div.addClass(options.addClass);var $img2=$("<div />"),$img_holder=$("<div />").width("100%").height("100%").css({zIndex:310,position:"absolute",overflow:"hidden"}),$hdl_holder=$("<div />").width("100%").height("100%").css("zIndex",320),$sel=$("<div />").css({position:"absolute",zIndex:600}).dblclick(function(){var c=Coords.getFixed();options.onDblClick.call(api,c)}).insertBefore($img).append($img_holder,$hdl_holder);img_mode&&($img2=$("<img />").attr("src",$img.attr("src")).css(img_css).width(boundx).height(boundy),$img_holder.append($img2)),ie6mode&&$sel.css({overflowY:"hidden"});var bound=options.boundary,$trk=newTracker().width(boundx+bound*2).height(boundy+bound*2).css({position:"absolute",top:px(-bound),left:px(-bound),zIndex:290}).mousedown(newSelection),bgcolor=options.bgColor,bgopacity=options.bgOpacity,xlimit,ylimit,xmin,ymin,xscale,yscale,enabled=!0,btndown,animating,shift_down;docOffset=getPos($img);var Touch=function(){function hasTouchSupport(){var support={},events=["touchstart","touchmove","touchend"],el=document.createElement("div"),i;try{for(i=0;i<events.length;i++){var eventName=events[i];eventName="on"+eventName;var isSupported=eventName in el;isSupported||(el.setAttribute(eventName,"return;"),isSupported=typeof el[eventName]=="function"),support[events[i]]=isSupported}return support.touchstart&&support.touchend&&support.touchmove}catch(err){return!1}}function detectSupport(){return options.touchSupport===!0||options.touchSupport===!1?options.touchSupport:hasTouchSupport()}return{createDragger:function(ord){return function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,options.disabled?!1:ord==="move"&&!options.allowMove?!1:(btndown=!0,startDragMode(ord,mouseAbs(e)),e.stopPropagation(),e.preventDefault(),!1)}},newSelection:function(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,newSelection(e)},isSupported:hasTouchSupport,support:detectSupport()}}(),Coords=function(){function setPressed(pos){pos=rebound(pos),x2=x1=pos[0],y2=y1=pos[1]}function setCurrent(pos){pos=rebound(pos),ox=pos[0]-x2,oy=pos[1]-y2,x2=pos[0],y2=pos[1]}function getOffset(){return[ox,oy]}function moveOffset(offset){var ox=offset[0],oy=offset[1];0>x1+ox&&(ox-=ox+x1),0>y1+oy&&(oy-=oy+y1),boundy<y2+oy&&(oy+=boundy-(y2+oy)),boundx<x2+ox&&(ox+=boundx-(x2+ox)),x1+=ox,x2+=ox,y1+=oy,y2+=oy}function getCorner(ord){var c=getFixed();switch(ord){case"ne":return[c.x2,c.y];case"nw":return[c.x,c.y];case"se":return[c.x2,c.y2];case"sw":return[c.x,c.y2]}}function getFixed(){if(!options.aspectRatio)return getRect();var aspect=options.aspectRatio,min_x=options.minSize[0]/xscale,max_x=options.maxSize[0]/xscale,max_y=options.maxSize[1]/yscale,rw=x2-x1,rh=y2-y1,rwa=Math.abs(rw),rha=Math.abs(rh),real_ratio=rwa/rha,xx,yy,w,h;return max_x===0&&(max_x=boundx*10),max_y===0&&(max_y=boundy*10),real_ratio<aspect?(yy=y2,w=rha*aspect,xx=rw<0?x1-w:w+x1,xx<0?(xx=0,h=Math.abs((xx-x1)/aspect),yy=rh<0?y1-h:h+y1):xx>boundx&&(xx=boundx,h=Math.abs((xx-x1)/aspect),yy=rh<0?y1-h:h+y1)):(xx=x2,h=rwa/aspect,yy=rh<0?y1-h:y1+h,yy<0?(yy=0,w=Math.abs((yy-y1)*aspect),xx=rw<0?x1-w:w+x1):yy>boundy&&(yy=boundy,w=Math.abs(yy-y1)*aspect,xx=rw<0?x1-w:w+x1)),xx>x1?(xx-x1<min_x?xx=x1+min_x:xx-x1>max_x&&(xx=x1+max_x),yy>y1?yy=y1+(xx-x1)/aspect:yy=y1-(xx-x1)/aspect):xx<x1&&(x1-xx<min_x?xx=x1-min_x:x1-xx>max_x&&(xx=x1-max_x),yy>y1?yy=y1+(x1-xx)/aspect:yy=y1-(x1-xx)/aspect),xx<0?(x1-=xx,xx=0):xx>boundx&&(x1-=xx-boundx,xx=boundx),yy<0?(y1-=yy,yy=0):yy>boundy&&(y1-=yy-boundy,yy=boundy),makeObj(flipCoords(x1,y1,xx,yy))}function rebound(p){return p[0]<0&&(p[0]=0),p[1]<0&&(p[1]=0),p[0]>boundx&&(p[0]=boundx),p[1]>boundy&&(p[1]=boundy),[p[0],p[1]]}function flipCoords(x1,y1,x2,y2){var xa=x1,xb=x2,ya=y1,yb=y2;return x2<x1&&(xa=x2,xb=x1),y2<y1&&(ya=y2,yb=y1),[xa,ya,xb,yb]}function getRect(){var xsize=x2-x1,ysize=y2-y1,delta;return xlimit&&Math.abs(xsize)>xlimit&&(x2=xsize>0?x1+xlimit:x1-xlimit),ylimit&&Math.abs(ysize)>ylimit&&(y2=ysize>0?y1+ylimit:y1-ylimit),ymin/yscale&&Math.abs(ysize)<ymin/yscale&&(y2=ysize>0?y1+ymin/yscale:y1-ymin/yscale),xmin/xscale&&Math.abs(xsize)<xmin/xscale&&(x2=xsize>0?x1+xmin/xscale:x1-xmin/xscale),x1<0&&(x2-=x1,x1-=x1),y1<0&&(y2-=y1,y1-=y1),x2<0&&(x1-=x2,x2-=x2),y2<0&&(y1-=y2,y2-=y2),x2>boundx&&(delta=x2-boundx,x1-=delta,x2-=delta),y2>boundy&&(delta=y2-boundy,y1-=delta,y2-=delta),x1>boundx&&(delta=x1-boundy,y2-=delta,y1-=delta),y1>boundy&&(delta=y1-boundy,y2-=delta,y1-=delta),makeObj(flipCoords(x1,y1,x2,y2))}function makeObj(a){return{x:a[0],y:a[1],x2:a[2],y2:a[3],w:a[2]-a[0],h:a[3]-a[1]}}var x1=0,y1=0,x2=0,y2=0,ox,oy;return{flipCoords:flipCoords,setPressed:setPressed,setCurrent:setCurrent,getOffset:getOffset,moveOffset:moveOffset,getCorner:getCorner,getFixed:getFixed}}(),Shade=function(){function resizeShades(w,h){shades.left.css({height:px(h)}),shades.right.css({height:px(h)})}function updateAuto(){return updateShade(Coords.getFixed())}function updateShade(c){shades.top.css({left:px(c.x),width:px(c.w),height:px(c.y)}),shades.bottom.css({top:px(c.y2),left:px(c.x),width:px(c.w),height:px(boundy-c.y2)}),shades.right.css({left:px(c.x2),width:px(boundx-c.x2)}),shades.left.css({width:px(c.x)})}function createShade(){return $("<div />").css({position:"absolute",backgroundColor:options.shadeColor||options.bgColor}).appendTo(holder)}function enableShade(){enabled||(enabled=!0,holder.insertBefore($img),updateAuto(),Selection.setBgOpacity(1,0,1),$img2.hide(),setBgColor(options.shadeColor||options.bgColor,1),Selection.isAwake()?setOpacity(options.bgOpacity,1):setOpacity(1,1))}function setBgColor(color,now){colorChangeMacro(getShades(),color,now)}function disableShade(){enabled&&(holder.remove(),$img2.show(),enabled=!1,Selection.isAwake()?Selection.setBgOpacity(options.bgOpacity,1,1):(Selection.setBgOpacity(1,1,1),Selection.disableHandles()),colorChangeMacro($div,0,1))}function setOpacity(opacity,now){enabled&&(options.bgFade&&!now?holder.animate({opacity:1-opacity},{queue:!1,duration:options.fadeTime}):holder.css({opacity:1-opacity}))}function refreshAll(){options.shade?enableShade():disableShade(),Selection.isAwake()&&setOpacity(options.bgOpacity)}function getShades(){return holder.children()}var enabled=!1,holder=$("<div />").css({position:"absolute",zIndex:240,opacity:0}),shades={top:createShade(),left:createShade().height(boundy),right:createShade().height(boundy),bottom:createShade()};return{update:updateAuto,updateRaw:updateShade,getShades:getShades,setBgColor:setBgColor,enable:enableShade,disable:disableShade,resize:resizeShades,refresh:refreshAll,opacity:setOpacity}}(),Selection=function(){function insertBorder(type){var jq=$("<div />").css({position:"absolute",opacity:options.borderOpacity}).addClass(cssClass(type));return $img_holder.append(jq),jq}function dragDiv(ord,zi){var jq=$("<div />").mousedown(createDragger(ord)).css({cursor:ord+"-resize",position:"absolute",zIndex:zi}).addClass("ord-"+ord);return Touch.support&&jq.bind("touchstart.jcrop",Touch.createDragger(ord)),$hdl_holder.append(jq),jq}function insertHandle(ord){var hs=options.handleSize;return dragDiv(ord,hdep++).css({opacity:options.handleOpacity}).width(hs).height(hs).addClass(cssClass("handle"))}function insertDragbar(ord){return dragDiv(ord,hdep++).addClass("jcrop-dragbar")}function createDragbars(li){var i;for(i=0;i<li.length;i++)dragbar[li[i]]=insertDragbar(li[i])}function createBorders(li){var cl,i;for(i=0;i<li.length;i++){switch(li[i]){case"n":cl="hline";break;case"s":cl="hline bottom";break;case"e":cl="vline right";break;case"w":cl="vline"}borders[li[i]]=insertBorder(cl)}}function createHandles(li){var i;for(i=0;i<li.length;i++)handle[li[i]]=insertHandle(li[i])}function moveto(x,y){options.shade||$img2.css({top:px(-y),left:px(-x)}),$sel.css({top:px(y),left:px(x)})}function resize(w,h){$sel.width(w).height(h)}function refresh(){var c=Coords.getFixed();Coords.setPressed([c.x,c.y]),Coords.setCurrent([c.x2,c.y2]),updateVisible()}function updateVisible(select){if(awake)return update(select)}function update(select){var c=Coords.getFixed();resize(c.w,c.h),moveto(c.x,c.y),options.shade&&Shade.updateRaw(c),awake||show(),select?options.onSelect.call(api,unscale(c)):options.onChange.call(api,unscale(c))}function setBgOpacity(opacity,force,now){if(!awake&&!force)return;options.bgFade&&!now?$img.animate({opacity:opacity},{queue:!1,duration:options.fadeTime}):$img.css("opacity",opacity)}function show(){$sel.show(),options.shade?Shade.opacity(bgopacity):setBgOpacity(bgopacity,!0),awake=!0}function release(){disableHandles(),$sel.hide(),options.shade?Shade.opacity(1):setBgOpacity(1),awake=!1,options.onRelease.call(api)}function showHandles(){seehandles&&$hdl_holder.show()}function enableHandles(){seehandles=!0;if(options.allowResize)return $hdl_holder.show(),!0}function disableHandles(){seehandles=!1,$hdl_holder.hide()}function animMode(v){animating===v?disableHandles():enableHandles()}function done(){animMode(!1),refresh()}var awake,hdep=370,borders={},handle={},dragbar={},seehandles=!1;options.dragEdges&&$.isArray(options.createDragbars)&&createDragbars(options.createDragbars),$.isArray(options.createHandles)&&createHandles(options.createHandles),options.drawBorders&&$.isArray(options.createBorders)&&createBorders(options.createBorders),$(document).bind("touchstart.jcrop-ios",function(e){$(e.currentTarget).hasClass("jcrop-tracker")&&e.stopPropagation()});var $track=newTracker().mousedown(createDragger("move")).css({cursor:"move",position:"absolute",zIndex:360});return Touch.support&&$track.bind("touchstart.jcrop",Touch.createDragger("move")),$img_holder.append($track),disableHandles(),{updateVisible:updateVisible,update:update,release:release,refresh:refresh,isAwake:function(){return awake},setCursor:function(cursor){$track.css("cursor",cursor)},enableHandles:enableHandles,enableOnly:function(){seehandles=!0},showHandles:showHandles,disableHandles:disableHandles,animMode:animMode,setBgOpacity:setBgOpacity,done:done}}(),Tracker=function(){function toFront(){$trk.css({zIndex:450}),Touch.support&&$(document).bind("touchmove.jcrop",trackTouchMove).bind("touchend.jcrop",trackTouchEnd),trackDoc&&$(document).bind("mousemove.jcrop",trackMove).bind("mouseup.jcrop",trackUp)}function toBack(){$trk.css({zIndex:290}),$(document).unbind(".jcrop")}function trackMove(e){return onMove(mouseAbs(e)),!1}function trackUp(e){return e.preventDefault(),e.stopPropagation(),btndown&&(btndown=!1,onDone(mouseAbs(e)),Selection.isAwake()&&options.onSelect.call(api,unscale(Coords.getFixed())),toBack(),onMove=function(){},onDone=function(){}),!1}function activateHandlers(move,done){return btndown=!0,onMove=move,onDone=done,toFront(),!1}function trackTouchMove(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,trackMove(e)}function trackTouchEnd(e){return e.pageX=e.originalEvent.changedTouches[0].pageX,e.pageY=e.originalEvent.changedTouches[0].pageY,trackUp(e)}function setCursor(t){$trk.css("cursor",t)}var onMove=function(){},onDone=function(){},trackDoc=options.trackDocument;return trackDoc||$trk.mousemove(trackMove).mouseup(trackUp).mouseout(trackUp),$img.before($trk),{activateHandlers:activateHandlers,setCursor:setCursor}}(),KeyManager=function(){function watchKeys(){options.keySupport&&($keymgr.show(),$keymgr.focus())}function onBlur(e){$keymgr.hide()}function doNudge(e,x,y){options.allowMove&&(Coords.moveOffset([x,y]),Selection.updateVisible(!0)),e.preventDefault(),e.stopPropagation()}function parseKey(e){if(e.ctrlKey||e.metaKey)return!0;shift_down=e.shiftKey?!0:!1;var nudge=shift_down?10:1;switch(e.keyCode){case 37:doNudge(e,-nudge,0);break;case 39:doNudge(e,nudge,0);break;case 38:doNudge(e,0,-nudge);break;case 40:doNudge(e,0,nudge);break;case 27:options.allowSelect&&Selection.release();break;case 9:return!0}return!1}var $keymgr=$('<input type="radio" />').css({position:"fixed",left:"-120px",width:"12px"}),$keywrap=$("<div />").css({position:"absolute",overflow:"hidden"}).append($keymgr);return options.keySupport&&($keymgr.keydown(parseKey).blur(onBlur),ie6mode||!options.fixedSupport?($keymgr.css({position:"absolute",left:"-20px"}),$keywrap.append($keymgr).insertBefore($img)):$keymgr.insertBefore($img)),{watchKeys:watchKeys}}();Touch.support&&$trk.bind("touchstart.jcrop",Touch.newSelection),$hdl_holder.hide(),interfaceUpdate(!0);var api={setImage:setImage,animateTo:animateTo,setSelect:setSelect,setOptions:setOptionsNew,tellSelect:tellSelect,tellScaled:tellScaled,setClass:setClass,disable:disableCrop,enable:enableCrop,cancel:cancelCrop,release:Selection.release,destroy:destroy,focus:KeyManager.watchKeys,getBounds:function(){return[boundx*xscale,boundy*yscale]},getWidgetSize:function(){return[boundx,boundy]},getScaleFactor:function(){return[xscale,yscale]},getOptions:function(){return options},ui:{holder:$div,selection:$sel}};return $.browser.msie&&$div.bind("selectstart",function(){return!1}),$origimg.data("Jcrop",api),api},$.fn.Jcrop=function(options,callback){var api;return this.each(function(){if($(this).data("Jcrop")){if(options==="api")return $(this).data("Jcrop");$(this).data("Jcrop").setOptions(options)}else this.tagName=="IMG"?$.Jcrop.Loader(this,function(){$(this).css({display:"block",visibility:"hidden"}),api=$.Jcrop(this,options),$.isFunction(callback)&&callback.call(api)}):($(this).css({display:"block",visibility:"hidden"}),api=$.Jcrop(this,options),$.isFunction(callback)&&callback.call(api))}),this},$.Jcrop.Loader=function(imgobj,success,error){function completeCheck(){img.complete?($img.unbind(".jcloader"),$.isFunction(success)&&success.call(img)):window.setTimeout(completeCheck,50)}var $img=$(imgobj),img=$img[0];$img.bind("load.jcloader",completeCheck).bind("error.jcloader",function(e){$img.unbind(".jcloader"),$.isFunction(error)&&error.call(img)}),img.complete&&$.isFunction(success)&&($img.unbind(".jcloader"),success.call(img))},$.Jcrop.defaults={allowSelect:!0,allowMove:!0,allowResize:!0,trackDocument:!0,baseClass:"jcrop",addClass:null,bgColor:"black",bgOpacity:.6,bgFade:!1,borderOpacity:.4,handleOpacity:.5,handleSize:7,aspectRatio:0,keySupport:!0,createHandles:["n","s","e","w","nw","ne","se","sw"],createDragbars:["n","s","e","w"],createBorders:["n","s","e","w"],drawBorders:!0,dragEdges:!0,fixedSupport:!0,touchSupport:null,shade:null,boxWidth:0,boxHeight:0,boundary:2,fadeTime:400,animationDelay:20,swingSpeed:3,minSelect:[0,0],maxSize:[0,0],minSize:[0,0],onChange:function(){},onSelect:function(){},onDblClick:function(){},onRelease:function(){}}})(jQuery)});
define('tau/ui/behaviour/overlay/ui.behaviour.overlay',["Underscore","jQuery"],function(_,$){$.widget("ui.tauOverlay",{options:{showOnCreation:!0},_create:function(){this.$target=this.element,this.options.showOnCreation&&this.show()},showLarge:function(){this._show("ui-spinner-centered")},show:function(){this._show("ui-overlay")},_show:function(overlayClass){var self=this;self.$overlay=self.overlay||$(['<div class="',overlayClass,'"></div>'].join("")),self.$overlay.detach(),self.$target.addClass("ui-overlay-container");var $to=$("body");self.$target.css("position")==="relative"?$to=self.$target:$to=self.$target.offsetParent(),$to.append(self.$overlay)},hide:function(){var self=this;self.destroy()},destroy:function(){var self=this;self.$target.removeClass("ui-overlay-container"),self.$overlay&&self.$overlay.remove(),$.Widget.prototype.destroy.apply(this,arguments)}})});
define('tau/ui/extensions/avatar/ui.extension.avatar.editor',["app.path","Underscore","jQuery","tau/components/extensions/component.extension.base","tau/core/tau","libs/jquery/jquery.fileupload","libs/jquery/jquery.iframe-transport","libs/jquery/jquery.Jcrop","tau/ui/behaviour/overlay/ui.behaviour.overlay"],function(AppPath,_,$,ExtensionBase,tau){return ExtensionBase.extend({"bus afterRender":function(evt){evt.data.element.find(".file-input").fileupload({url:this._getUploadUrl(),formData:this._getFormData(),add:_.bind(this._onFileAdd,this)}),this.avatarService=this.config.context.configurator.getAvatarService(),evt.data.element.find(".crop-avatar").click(_.bind(this.onCropClick,this)),evt.data.element.find(".remove-avatar").click(_.bind(this.onRemoveClick,this)),evt.data.element.find(".tau-save-crop").click(_.bind(this.onSaveClick,this)),evt.data.element.find(".tau-cancel-crop").click(_.bind(this.onCancelClick,this));var avatarContainer=evt.data.element.find(".tau-avatar-crop-container"),maxWidth=avatarContainer.css("max-width");this.fire("view.max.width.calculated",maxWidth)},onCancelClick:function(){this.fire("view.save.cancel")},onSaveClick:function(){this.fire("view.save.crop")},onRemoveClick:function(){this.fire("view.lock"),this.fire("view.remove.avatar")},onCropClick:function(){this.fire("view.initialize.crop")},"bus model.crop.ready:last+view.initialize.crop":function(evt,cropRect){this.fire("view.lock"),this.fire("view.edit.avatar.with.url",{url:this.getOriginAvatarUrl(this._getGeneralId()),cropRect:cropRect})},"bus view.edit.avatar.with.url:last+view.crop.selected:last+afterRender:last+view.save.crop":function(evt,baseUrl,selectedRect,afterRender){var $img=afterRender.element.find(".tau-avatar-crop-container .tau-img:visible"),horizontalScale=$img[0].naturalWidth/$img.width(),verticalScale=$img[0].naturalHeight/$img.height(),cropUrl=this.getCropAvatarUrl(baseUrl.url,{x:parseInt(selectedRect.x*horizontalScale),y:parseInt(selectedRect.y*verticalScale),w:parseInt(selectedRect.w*verticalScale),h:parseInt(selectedRect.h*verticalScale)}),scale=$img.width()/$img[0].naturalWidth;this.fire("view.image.will.crop"),this.avatarService.crop(cropUrl).done($.proxy(function(data){this.fire("view.image.did.cropped",data),this.fire("model.crop.ready",{x:cropUrl.x,y:cropUrl.y,width:cropUrl.w,height:cropUrl.h})},this)).fail($.proxy(function(error){this.fire("error",{message:error.Message,disableAutoClose:!0}),this.fire("view.hide.avatar.editor"),this.fire("view.unlock")},this))},"bus afterRender:last+view.hide.avatar.editor":function(evt,afterRender,hideAvatarEditorData){var self=this;afterRender.element.find(".tau-avatar-crop-container").slideUp(function(){hideAvatarEditorData&&1==hideAvatarEditorData.close&&self.fire("close",{animated:!0})}),afterRender.element.find(".drop-down-list__inner").show()},"bus afterRender:last+view.show.avatar.editor":function(evt,afterRender){afterRender.element.find(".tau-avatar-crop-container").slideDown(),afterRender.element.find(".drop-down-list__inner").hide()},"bus afterRender:last+view.lock":function(evt,afterRender){afterRender.element.tauOverlay()},"bus afterRender:last+view.unlock":function(evt,afterRender){afterRender.element.tauOverlay("hide")},"bus afterRender:last+view.save.cancel":function(evt,afterRender){this.fire("view.hide.avatar.editor")},"bus jcrop.api.ready+view.image.will.crop":function(evt,jcropApi){jcropApi.destroy(),this.fire("view.lock")},"bus avatar.did.removed":function(evt,data){this.store.registerWithEvents([{id:data.Id,__type:"user",avatarUri:data.AvatarUri}]),this.fire("view.unlock")},"bus view.image.did.cropped":function(evt){var data=evt.data;this.store.registerWithEvents([{id:data.Id,__type:"user",avatarUri:data.AvatarUri}]),this.fire("view.hide.avatar.editor",{close:!0}),this.fire("view.unlock")},"bus view.remove.avatar":function(){this.fire("view.lock");var removeAvatarUrl=this.getRemoveAvatarUrl(this._getGeneralId());this.avatarService.remove(removeAvatarUrl).done($.proxy(function(data){this.fire("avatar.did.removed",data)},this)).fail($.proxy(function(error){this.fire("error",{message:error.Message,disableAutoClose:!0}),this.fire("view.unlock")},this))},"bus view.files.selected":function(evt,filesData){function failUploadFile(jqXHR){var error=JSON.parse(jqXHR.responseText);self.fire("error",{message:error.Message,disableAutoClose:!0}),self.fire("view.unlock")}var self=this;self.fire("view.lock"),filesData.submit().done(function(result,status,jqXHR){try{result=JSON.parse(result)}catch(e){result=result.find("body").text(),jqXHR.responseText=result,result=JSON.parse(result)}result.Success===!0?self.fire("view.file.did.upload"):failUploadFile(jqXHR)}).fail(failUploadFile)},"bus afterRender:last+view.crop.selected":function(evt,afterRender){afterRender.element.find(".tau-save-crop").attr("disabled",!1)},"bus jcrop.api.ready>before_view.file.did.upload":function(evt,jcropApi){jcropApi.destroy()},"bus afterRender:last+view.crop.released":function(evt,afterRender){afterRender.element.find(".tau-save-crop").attr("disabled",!0)},getTempAvatarUrl:function(userId){var url=AppPath.get()+"/Avatar.ashx?UserID="+userId+"&source=temp&"+(new Date).getTime();return this._appendToken(url)},getRemoveAvatarUrl:function(userId){var url=AppPath.get()+"/Avatar.ashx?operation=remove&UserID="+userId;return this._appendToken(url)},getOriginAvatarUrl:function(userId){var url=AppPath.get()+"/Avatar.ashx?UserID="+userId+"&source=original&"+(new Date).getTime();return this._appendToken(url)},getCropAvatarUrl:function(baseUrl,rect){var url=baseUrl+"&operation=crop&"+["x="+rect.x,"y="+rect.y,"width="+rect.w,"height="+rect.h].join("&");return this._appendToken(url)},_appendToken:function(url){var result=url;return url.indexOf("?token=")<0&&url.indexOf("&token=")<0&&(result+=tau.getTokenParameterFromQueryString("&")),result},"bus afterRender:last+view.file.did.upload":function(evt,afterRender){var userId=this._getGeneralId(),avatarSrc=this.getTempAvatarUrl(userId);this.fire("view.hide.avatar.editor"),this.fire("view.edit.avatar.with.url",{url:avatarSrc})},"bus jcrop.api.ready>before_view.edit.avatar.with.url":function(evt,api,avatarSrc){api.destroy()},"bus afterRender:last+view.max.width.calculated:last+view.edit.avatar.with.url":function(evt,afterRender,defaultMaxWidth,editData){var self=this,imageContainer=afterRender.element.find(".tau-avatar-crop-container");imageContainer.css("max-width",defaultMaxWidth);var $img=afterRender.element.find(".tau-avatar-crop-container .tau-img:first-child");$img.css("width","").css("height","").prop("src",editData.url);var originalCrop=editData.cropRect,onImageLoad=function(){if(0==afterRender.element.is(":visible")){self.fire("view.unlock");return}self.fire("view.show.avatar.editor"),afterRender.element.find(".tau-save-crop").attr("disabled",!0);var width=$img.width(),height=$img.height(),minSize=48,left=(width-minSize)/2,top=(height-minSize)/2,element=afterRender.element,offset=element.offset(),maxScreenHeight=$(window).height()-50-offset.top;if(maxScreenHeight<height){var maxWidth=maxScreenHeight*width/height;imageContainer.css("max-width",maxWidth),width=$img.width(),height=$img.height()}var scale=$img.width()/$img[0].naturalWidth,selectRect=null;originalCrop&&(selectRect=[originalCrop.x*scale,originalCrop.y*scale,originalCrop.width*scale,originalCrop.height*scale],selectRect[2]+=selectRect[0],selectRect[3]+=selectRect[1]),$img.Jcrop({aspectRatio:1,minSize:[minSize,minSize],setSelect:selectRect?selectRect:[0,0,width,height],onSelect:function(c){self.fire("view.crop.selected",c)},onChange:function(c){self.fire("view.crop.selected",c)},onRelease:function(){self.fire("view.crop.released")}},function(){self.fire("view.unlock"),self.fire("jcrop.api.ready",this)})};$img.on("load",onImageLoad)},_getUploadUrl:function(){return AppPath.get()+"/Avatar.ashx?UserID="+this._getGeneralId()+tau.getTokenParameterFromQueryString("&")},_getFormData:function(){return[]},_getGeneralId:function(){return this.config.context.entity.id},_onFileAdd:function(event,data){if(!data.files||data.files.length==0)return;this.fire("view.files.selected",data)}})});
define('tau/ui/templates/avatar/ui.template.avatar.editor',["tau/core/templates-factory"],function(templates){var config={name:"user.avatar.editor",markup:['<div class="ui-menu-actions tau-avatar-editor">','<div class="drop-down-list drop-down-list__inner i-inner">','<div class="ui-menu__item drop-down-option upload-photo" role="option">',"<span>Upload Image",'<input type="file" class="file-input" accept="image/*">',"</span>","</div>",'<div class="ui-menu__item drop-down-option crop-avatar">Edit Avatar</div>','<div class="ui-menu__item drop-down-option remove-avatar" role="option">Remove</div>',"</div>",'<div class="tau-avatar-crop-container" style="display: none; max-width: 600px;">','<img class="tau-img"  width="100%;" />','<div class="tau-avatar-button-panel">','<button type="button" class="tau-btn tau-save-crop tau-primary">Update Avatar</button> ','<button type="button" class="tau-btn tau-cancel-crop">Cancel</button> ',"</div>","</div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.avatar.editor',["tau/components/component.creator","tau/models/model.avatar","tau/ui/extensions/avatar/ui.extension.avatar.editor","tau/components/extensions/error/extension.errorBar","tau/ui/templates/avatar/ui.template.avatar.editor"],function(creator,ModelAvatar,ExtensionAvatarEditor,ErrorExtension,template){return{create:function(config){var creatorConfig={name:"avatar.editor",extensions:[ModelAvatar,ExtensionAvatarEditor,ErrorExtension],template:template};return config["queue.bus"]=!0,creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/avatar/ui.extension.avatar',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,onPositionConfig=function(config){return config.at="center bottom",config.my="center top",config.offset="0 -10",config},onArrowPositionConfig=function(config){return config.at="center bottom",config.my="center top",config.offset="0 -10",config},bubbleConfig={target:$element,onPositionConfig:onPositionConfig,showEvent:this.config.editorConfig.showEvent||"mouseenter",hideEvent:"click",showCloseButton:!1,delay:100,onShow:function(){var widget=this.target.tauBubble("widget");widget.find(".tau-bubble__inner").attr("tabindex",-1).css("outline","none").focus(),widget.on("keydown",function(e){e.keyCode==$.ui.keyCode.ESCAPE&&(widget.hide(),widget.off("keydown"),e.stopPropagation())})},onArrowPositionConfig:onArrowPositionConfig,componentsConfig:{components:[{type:"avatar.editor"}],context:this.config.context},stackName:"avatar"};this.fire("initBubble",bubbleConfig)},"bus avatarChanged":function(){this.fire("refresh")}})});
define('tau/ui/templates/avatar/ui.template.avatar',["tau/core/templates-factory"],function(templates){var config={name:"user.avatar",markup:['<div class="box ui-avatar tau-avatar_${id}">','<img src="${url}" /> ',"</div>"].join("")};return templates.register(config)});
define('tau/components/component.avatar',["tau/components/component.creator","tau/models/model.avatar","tau/ui/extensions/avatar/ui.extension.avatar","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/avatar/ui.template.avatar"],function(creator,ModelAvatar,ExtensionAvatar,ExtensionBubbleCreator,ExtensionComponentCreator,template){return{create:function(config){config.isEdit&&(config.extensions=(config.extensions||[]).concat(ExtensionBubbleCreator||[])),config.editorConfig=_.extend({},config.editorConfig);var creatorConfig={name:"avatar",extensions:[ModelAvatar,ExtensionComponentCreator,ExtensionAvatar].concat(config.extensions||[]),template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.board.add',["Underscore","tau/core/model-base"],function(_,BaseModel){return BaseModel.extend({"bus afterInit":function(evt){this.fire("dataBind",{});var configurator=evt.data.config.context.configurator;this.fire("configurator.ready",configurator)},"bus configurator.ready:last + add.executed":function(evt,configurator){configurator.getBoardDefinitionFactory().createBoard().done(_.bind(function(definition){this.fire("add.board",{board:{id:definition.id}}),this.fire("definition.saved",definition)},this))},"bus configurator.ready:last + definition.saved":function(evt,configurator,definition){var hash=configurator.getUrlBuilder().getRelativeBoardUrl(definition.id);configurator.setConfig("tmpBoardIsJustAdded",!0),configurator.getRouting().redirect(hash)}})});
define('tau/ui/templates/board.add/ui.template.board.add',["tau/core/templates-factory","tau/nls/translator"],function(templates,T){var config={name:"board.add",engine:"jqote2",markup:['<div class="tau-add-board-btn">','<div role="action-add"',' data-collapsed-selector=".tau-sp-collapsed .tau-extension-board-tooltip"',' data-title-collapsed="'+T("Create&nbsp;new&nbsp;board")+'"',' class="tau-extension-board-tooltip"',">","<i><!-- --></i>","<span>"+T("Create Board")+"</span>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/extensions/board.add/ui.extension.board.add',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,$trigger=$el.is("[role=action-add]")?$el:$el.find("[role=action-add]"),self=this;$trigger.click(function(){self.fire("add.executed")})}})});
define('tau/components/component.board.add',["Underscore","tau/components/component.creator","tau/models/model.board.add","tau/ui/templates/board.add/ui.template.board.add","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/ui/extensions/board.add/ui.extension.board.add"],function(_,ComponentCreator,Model,Template,ExtensionTooltip,ExtensionBehavior){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionTooltip,ExtensionBehavior],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.cell.quick.add/model.board.cell.quick.add',["Underscore","jQuery","tau/core/model-base"],function(_,$,BaseModel){return BaseModel.extend({handleGetDataItemTemplate:function(coordinate,entityType,slice,loadedDataItemsTemplates,types,counters,viewMode){var coordinateAndType={$set:_.extend(_.clone(coordinate),{dataItemType:entityType.name})},self=this,action;switch(viewMode){case"board":action="dataTemplate";break;case"list":action="listDataTemplate";break;case"axis":action="axisDataTemplate";break;default:action="dataTemplate"}slice[action](coordinateAndType).done(function(result){var templateData=result.data;loadedDataItemsTemplates[entityType.name]={template:templateData,entityType:entityType},counters.push(entityType),counters.length==types.length&&(self.fire("model.dataItems.template.ready",{types:loadedDataItemsTemplates}),self.fire("dataBind",{types:loadedDataItemsTemplates,entityTypes:types}))})},onInit:function(conf){var deferred=$.Deferred();if(this.config.options&&this.config.options.slice&&this.config.options.addAction&&this.config.options.addAction.data.types&&this.config.options.action)deferred.resolve({slice:this.config.options.slice,types:this.config.options.addAction.data.types,action:this.config.options.action,viewMode:this.config.options.viewMode});else{var acidDeferred=$.Deferred();conf.context.configurator.getAppStateStore().get({fields:["acid"],callback:function(data){acidDeferred.resolve(data.acid)}}),acidDeferred.done(function(acid){var definition={};definition.global={acid:acid},definition.cells={types:["feature","userstory","task","bug","request","testcase","impediment","release","iteration","teamiteration"]};var slice=conf.context.configurator.getSliceFactory().create({definition:definition});slice.listModeActionsV2().done(function(response){var showAddButtonData={};return showAddButtonData.action=response.data.items[0],_.isEmpty(showAddButtonData.action)?(deferred.reject(),!1):(_.each(showAddButtonData,function(action){var addAction=_.find(action.fixed.items,function(item){return item.type=="AddAction"});addAction&&(showAddButtonData.addAction=addAction)}),deferred.resolve({slice:slice,types:showAddButtonData.addAction.data.types,action:showAddButtonData.action,viewMode:"list"}),!0)})})}deferred.done(_.bind(function(data){this.prepareTemplateData(data,conf),this.fire("settings.ready",data)},this)).fail(_.bind(function(){this.fire("dataBind",{isEmpty:!0})},this))},prepareTemplateData:function(data,conf){var slice=data.slice,types=data.types,loadedDataItemsTemplates={},counters=[],action=data.action,coordinate,viewMode=data.viewMode;viewMode==="axis"?coordinate={location:action.location}:coordinate={x:action.x||undefined,y:action.y||undefined};for(var i=0;i<types.length;i++){var entityType=types[i];this.handleGetDataItemTemplate(coordinate,entityType,slice,loadedDataItemsTemplates,types,counters,viewMode)}var getContext=_.bind(function(event){this.fire("culture.ready",event.culture)},this);conf.context.configurator.applicationContextService.getApplicationContext({acid:slice.config.definition.global.acid},{success:getContext})},"bus dataBind:last + model.add.item + settings.ready:last":function(evt,dataItems,addItemData,settings){var action=settings.action,slice=settings.slice,actionSlice,viewMode=settings.viewMode;switch(viewMode){case"board":actionSlice="addData";break;case"list":actionSlice="listAddData";break;case"axis":actionSlice="axisAddData";break;default:actionSlice="addData"}var nameType=_.find(dataItems.entityTypes,function(item){return item.name==addItemData.type}),oldAcid=slice.config.definition.global.acid,typeName=addItemData.type.toLowerCase();if(typeName=="project"||typeName=="team")slice.config.definition.global.acid=null;var params={type:addItemData.type,values:addItemData.fields};viewMode==="axis"?params.location=action.location:(params.x=action.x,params.y=action.y);var differed=slice[actionSlice]({$set:params}),configurator=this.config.context.configurator;differed.always(_.bind(function(acid){acid&&!slice.config.definition.global.acid&&(configurator.getStore().evictCollection(typeName),configurator.getApplicationContextService().refreshChoice(),slice.config.definition.global.acid=acid)},this,oldAcid)).done(_.bind(function(result){this.fire("model.data.item.did.add",{message:result.data[0],nameType:nameType})},this)).fail(_.bind(function(result){return this.fire("model.data.item.did.fail.add",result.data.responseText),!1},this))}})});
define('libs/jquery/jquery.placeholder',["libs/jquery/jquery"],function(jQuery){(function($){function refresh(){return isInputSupported&&isTextareaSupported?this:($(this).each(function(){togglePlaceholder.call(this)}),this)}var isInputSupported="placeholder"in document.createElement("input"),isTextareaSupported="placeholder"in document.createElement("textarea"),togglePlaceholder=function(){var placeholder=$(this).nextAll(".placeholder");$(this).val()?placeholder.removeClass("show").addClass("hide"):placeholder.addClass("show").removeClass("hide")};$.fn.placeholder=function(options){if(options=="refresh")return refresh.call(this),this;options=$.extend({style:"placeholder",template:"<label></label>"},options);var interval=null,placeholder=$(options.template).addClass(options.style),delayPlaceholder=function(){var self=this;clearTimeout(interval),interval=setTimeout(function(){togglePlaceholder.call(self)},0)};return isInputSupported&&isTextareaSupported?this:($(this).each(function(){var input=$(this),placeholder=$(options.template).addClass(options.style).addClass("placeholder").attr("for",this.id);placeholder.appendTo(input.parent()),placeholder.text(input.attr("placeholder")),placeholder.click($.proxy(function(){$(this).focus()},this)),togglePlaceholder.call(this)}),$(this).on("keydown.placeholder keypress.placeholder input paste focus change",delayPlaceholder),this)}})(jQuery)});
define('libs/jquery/jquery.inputMaskEditor',["libs/jquery/jquery.ui"],function(jq){return function($,pluginName){if(pluginName in $)throw new Error('jQuery already has the "'+pluginName+'" property.');var getSelection=function(el){var start=0,end=0,normalizedValue,range,textInputRange,len,endRange,statusSelection=!1;return typeof el.selectionStart=="number"&&typeof el.selectionEnd=="number"?(start=el.selectionStart,end=el.selectionEnd):(range=document.selection.createRange(),range&&range.parentElement()==el&&(len=el.value.length,normalizedValue=el.value.replace(/\r\n/g,"\n"),textInputRange=el.createTextRange(),textInputRange.moveToBookmark(range.getBookmark()),endRange=el.createTextRange(),endRange.collapse(!1),textInputRange.compareEndPoints("StartToEnd",endRange)>-1?start=end=len:(start=-textInputRange.moveStart("character",-len),start+=normalizedValue.slice(0,start).split("\n").length-1,textInputRange.compareEndPoints("EndToEnd",endRange)>-1?end=len:(end=-textInputRange.moveEnd("character",-len),end+=normalizedValue.slice(0,end).split("\n").length-1)))),start-end!=0&&(statusSelection=!0),{start:start,end:end,statusSelection:statusSelection}},bindNamespacedEvents=function($element,eventMap){for(var eventType in eventMap)$element.bind(eventType+"."+pluginName,eventMap[eventType])},unbindNamespacedEvents=function($element,eventMap){for(var eventType in eventMap)$element.unbind(eventType+"."+pluginName,eventMap[eventType])},InputMaskEditor=function($element,options){this.setOptions(options),this.initElement($element),this.bindEvents(options)};InputMaskEditor.prototype={constructor:InputMaskEditor,initElement:function($element){this.$element=$element.addClass(this.className)},setOptions:function(options){var _options=options||{};this.onSave=$.isFunction(_options.onSave)?_options.onSave:$.noop,this.onEditStart=$.isFunction(_options.onEditStart)?_options.onEditStart:$.noop,this.onEditEnd=$.isFunction(_options.onEditEnd)?_options.onEditEnd:$.noop,this.maxLength=_options.maxLength||255,this.mask=_options.mask?new RegExp(_options.mask):!1,this.restoreText=typeof _options.restoreText=="undefined"?!0:_options.restoreText,this.enabled=options.enabled||!0,this.className=options.className||"editableText",this.classNameActive=options.className||"active"},bindEvents:function(options){options=options||{};var self=this;options.resetOnBlur&&(self.onBlur=function(){this._cancelEdit()}),bindNamespacedEvents(self.$element,{blur:$.proxy(self,"onBlur"),keydown:$.proxy(self,"mapKeys"),keypress:$.proxy(self,"mapKeys"),click:$.proxy(self,"onFocus")}),$.browser.msie||$(window).blur(function(){self.$element.blur()})},unbindEvents:function(options){options=options||{};var self=this;options.resetOnBlur&&(self.onBlur=function(){this._cancelEdit()}),unbindNamespacedEvents(self.$element,{blur:$.proxy(self,"onBlur"),keydown:$.proxy(self,"mapKeys"),keypress:$.proxy(self,"mapKeys"),click:$.proxy(self,"onFocus")})},onKeyDefault:function(event){var k=event.which;if(event.ctrlKey||event.altKey||event.metaKey||k<32)return!0;var charValue=String.fromCharCode(k),value=event.target.value,selectionParam=getSelection(event.target);selectionParam.statusSelection?value=value.substring(0,selectionParam.start)+charValue+value.substring(selectionParam.end):value+=charValue;if(!this.mask.test(value))return event.preventDefault()},trimText:function(text){return _.trim(text)},normalizeText:function(text){var normalizedText=this.trimText(text);return normalizedText.length==0&&this.restoreText===!0&&(normalizedText=this.getInitialText()),normalizedText},mapKeys:function(event){switch(event.which){case 13:break;case 27:break;default:event.type=="keypress"&&this.mask&&this.onKeyDefault(event)}}},$.fn[pluginName]=function(options){return this.each(function(index,element){var $element=$(element);$element.data(pluginName,new InputMaskEditor($element,options))})},$[pluginName]=function(element,options){return $(element)[pluginName](options)}}(jq,"inputMaskEditor"),jq.fn.inputMaskEditor});
// Set caret position easily in jQuery
// Written by and Copyright of Luke Morton, 2011
// Licensed under MIT

define('libs/jquery/jquery.caret',["libs/jquery/jquery"],function(jQuery){(function($){$.caretTo=function(el,index){if(!$(el).is(":visible"))return;if(el.createTextRange){var range=el.createTextRange();range.move("character",index),range.select()}else el.selectionStart!=null&&(el.focus(),el.setSelectionRange(index,index))},$.caretPos=function(el){if("selection"in document){var range=el.createTextRange();try{range.setEndPoint("EndToStart",document.selection.createRange())}catch(e){return 0}return range.text.length}if(el.selectionStart!=null)return el.selectionStart},$.fn.caret=function(index,offset){return typeof index=="undefined"?$.caretPos(this.get(0)):this.queue(function(next){if(isNaN(index)){var i=$(this).val().indexOf(index);offset===!0?i+=index.length:typeof offset!="undefined"&&(i+=offset),$.caretTo(this,i)}else $.caretTo(this,index);next()})},$.fn.caretToStart=function(){return this.caret(0)},$.fn.caretToEnd=function(){return this.queue(function(next){$.caretTo(this,$(this).val().length),next()})}})(jQuery)});
define('tau/ui/extensions/board.cell.quick.add/ui.extension.board.cell.quick.add',["Underscore","jQuery","tau/core/extension.base","tau/utils/utils.date","libs/jquery/jquery.placeholder","libs/jquery/jquery.inputMaskEditor","libs/jquery/jquery.caret"],function(_,$,ExtensionBase,dateUtils){return ExtensionBase.extend({init:function(data){this._super.apply(this,arguments),this.onSubmitProxy=_.bind(this.onSubmit,this),this.onTypeSelectorClickProxy=_.bind(this.onTypeSelectorClick,this);var callback=_.bind(function(viewerBus){this.fire("viewerBus.ready",viewerBus)},this);data.context.configurator.getComponentBusRegistry().getByName("board.entityViewer").done(callback),data.context.configurator.getTemplateFactory().register({name:"board.cell.quick.add.success",engine:"jqote2",markup:["<span>","Success! <%! this.type %> ",'<a class="ui-quick-add-notification-link i-role-card-view" href="<%= this.url %>">',"<%! this.name %>","</a> has been added. ",'<a class="ui-quick-add-notification-link i-role-card-view" href="<%= this.url %>">View.</a>',"</span>"]})},"bus afterRender":function(evt,afterRender){var $element=afterRender.element,$editors=$element.find(".tau-required-field-editor,.tau-add-item");$element.find("form").on("submit.quickAdd",this.onSubmitProxy),$element.on("click.quickAdd",".i-role-entity-selector",this.onTypeSelectorClickProxy),$element.find(".i-role-show_more").on("click",function(){$(this).addClass("quick-add__entity-items-more_hide"),$element.find(".i-role-entity-additional").addClass("quick-add__entity-items-additional_show")}),window.setTimeout(function(){$element.parent().addClass("tau-bubble__inner_without_scroll"),$element.find(".tau-entity-controls .tau-active input").eq(0).focus()},0);var project=$editors.filter(".project"),process=$editors.filter(".process").add(project);process.length==0&&$element.find(".cf-wrap").addClass("show").removeClass("hide");var toggleCf=_.bind(function(e,$element){$element?$element=$($element):$element=$(e.target);var data=$element.find(":selected").data("option"),processId=data.processId||data.id,cf=$element.closest("form").find(".cf-wrap").addClass("hide").removeClass("show");cf.find(".cf-input").addClass("hide").removeClass("show"),cf.filter(".cf-process_"+processId).addClass("show").removeClass("hide").find(".cf-input").addClass("show").removeClass("hide"),this.fire("adjustPosition")},this);process.change(toggleCf),process.each(toggleCf),this.fire("view.indicator.ready",$element.tauProgressIndicator()),this.fire("view.editors.ready",$editors),this.fire("quick.add.popup.rendered",$editors)},setHtmlForMessage:function(elementComponent,$html){var $pool=elementComponent.find(".tau-message-pool");$pool.children().remove(),$pool.width("").width($pool.width()),$pool.append($html)},"bus afterRender:last + model.data.item.did.add":function(evt,afterRender){var $inputs=afterRender.element.find(".tau-control-set.tau-active .tau-required-field-editor");this.prepareFields.clear($inputs),$inputs.filter(".tau-in-text").placeholder("refresh"),window.setTimeout(function(){$inputs.filter(":visible").eq(0).focus()},100)},"bus beforeInit:last + viewerBus.ready:last + afterRender:last + model.data.item.did.add":function(ev,initConfig,viewerBus,afterRender,dataCard){var savedEntity=dataCard.message.dataItem.data,url=initConfig.config.context.configurator.getUrlBuilder().getNewViewUrl(savedEntity.id,savedEntity.type,!0),$nodeMessage=initConfig.config.context.configurator.getTemplateFactory().get("board.cell.quick.add.success").bind({},{type:dataCard.nameType.title,name:dataCard.message.dataItem.data.name,url:url});dataCard.message.location!=="x"&&dataCard.message.location!=="y"&&this.fire("notification",{$node:$nodeMessage}),viewerBus&&$nodeMessage.on("click",".i-role-card-view",_.bind(function(e){e.preventDefault(),viewerBus.fire("cardDataToShow.ready",{entityId:savedEntity.id,entityType:savedEntity.type.toLowerCase()}),this.fire("close")},this));var messageSuccess=$('<div class="tau-message tau-success" />');this.setHtmlForMessage(afterRender.element,messageSuccess.append($nodeMessage.clone(!0))),this.fire("adjustPosition")},"bus afterRender:last+model.data.item.did.fail.add":function(evt,afterRender,errorData){var message="Error: "+errorData.Message,$html=$('<div class="tau-message tau-danger">'+message+"</div>");this.setHtmlForMessage(afterRender.element,$html),this.fire("adjustPosition")},"bus afterRender:last+view.submit":function(evt,afterRender,addData){var selectedType=addData.type,$editors=afterRender.element.find(".tau-control-set."+selectedType+" .tau-required-field-editor").filter(":not(.placeholder)").filter(":not(.hide)"),$editorsCustom=$editors.filter(".cf-input"),prepareFields=this.prepareFields;if(prepareFields.validate($editors)){var fields=_.reduce($editors,function(memo,item){var value=$(item).val(),name=$(item).data("fieldname");return $(item).data("iscf")||memo.push({id:name,value:value}),memo},[]);if($editorsCustom.length){var cfData=_.reduce($editorsCustom,function(memo,item){var value={},data=$(item).data(),type=data.fieldtype;value.name=data.fieldname,value.type=type;switch(type){case"DropDown":case"TemplatedURL":case"Number":case"Date":case"Text":value.value=$(item).val();break;case"MultipleSelectionList":value.value=$(item).val()&&$(item).val().join(",")||"";break;case"CheckBox":value.value=$(item).prop("checked");break;case"Entity":value.value={id:data.value.id,kind:data.value.entityType.name,name:data.value.name};break;case"URL":var wrap=$(item).parent(),url=wrap.find(".cf-input-url_value").val(),description=wrap.find(".cf-input-url_description").val();value.value={url:url,label:description};break;default:value=null}return value&&memo.push(value),memo},[]);fields.push({id:"CustomFields",value:JSON.stringify(cfData)})}this.fire("model.add.item",{fields:fields,type:selectedType}),$editors.off(".validator")}else $editors.off(".validator").on("input.validator change.validator",function(){prepareFields.validate($editors)})},prepareFields:{config:{},hasErrors:!1,validate:function(data){var hasError=!1;return _.each(data,function(item){var $element=$(item),validateData=$element.data("validate");_.any(validateData.rules,function(rule){var validateResult=this.typesValidate[rule].validate($element.val()),result=!1;return validateResult.result?this.typesValidate[rule].hideError?this.typesValidate[rule].hideError($element):this.hideError($element):(this.typesValidate[rule].showError?this.typesValidate[rule].showError($element,validateResult.message):this.showError($element,validateResult.message),hasError=!0,result=!0),result},this)},this),this.hasErrors=hasError,!hasError},typesValidate:{required:{validate:function(value){return{result:!_.isEmpty(value),message:"This is a required field."}}},text:{validate:function(value){return{result:_.trim(value)!="",message:"This is a required field."}}},email:{validate:function(value){return{result:/^[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?$/gi.test(_.trim(value)),message:"Invalid email address."}}},number:{validate:function(value){value=(value+"").replace(",",".");var result=!0,message;return isNaN(value)?(result=!1,message="the value can only be a valid number, e.g. 1, 3.14 or 2010"):value>_.MAX_INT?(result=!1,message="Please, enter a reasonable number."):value<0&&(result=!1,message="Number must be greater than 0"),{result:result,message:message}}},integer:{validate:function(value){var result=!0,message;return isNaN(value)?(result=!1,message="the value can only be a integer, e.g. 1, 2, 14"):/^\d+$/.test(value)?value>_.MAX_INT?(result=!1,message="Please, enter a reasonable number."):value<=0&&(result=!1,message="Number must be greater than 0"):(result=!1,message="the value can only be a integer, e.g. 1, 2, 14"),{result:result,message:message}}},date:{validate:function(value){var date=dateUtils.parse(value),result=!0,message;return date==null?(message="Incorrect date format",result=!1):date<new Date("01/01/1900")&&(message="Date must be greater then 01-01-1900",result=!1),{result:result,message:message}}},userStorySelector:{validate:function(value){return{result:value!=""}},showError:function($element){$element.closest(".tau-userStorySelector").addClass("tau-error").attr("title","This is a required field.")},hideError:function($element){$element.closest(".tau-userStorySelector").removeClass("tau-error").removeAttr("title")}},checkbox:{validate:function(){return{result:!0}}},url:{validate:function(value){return{result:/\b((?:https?|ftp|file):\/\/(?:[\-A-Z0-9.]+)(?::\d+)?(?:\/[\-A-Z0-9+&@#\/%=~_|!:,.;]*)?(?:\?[A-Z0-9+&@#\/%=~_|!:,.; ]*)?)/i.test(value),message:"Invalid url address."}}}},showError:function($element,message){$element.addClass("tau-error").attr("title",message).nextAll(".placeholder").addClass("tau-error")},hideError:function($element){$element.removeClass("tau-error").removeAttr("title").nextAll(".placeholder").removeClass("tau-error")},setBehavior:function($elements){_.each($elements,function(item){var $element=$(item),type=($element.data("fieldtype")+"").toLowerCase();this.typesBehavior[type]&&this.typesBehavior[type].call(this,$element)},this)},typesBehavior:{date:function($element){$.datepicker.parseDate=function(format,value){return dateUtils.parse(value)},$.datepicker.formatDate=function(format,date){return dateUtils.formatAs(date,format)};var dateFormat=dateUtils.getFormatData().date.short;$element.datepicker({dateFormat:dateFormat})},text:$.noop(),number:function($element){var digitMask="^[0-9]*(["+this.config.culture.decimalSeparator+"][0-9]{0,2})?$";$element.inputMaskEditor({mask:digitMask})},integer:function($element){var digitMask="^[0-9]*?$";$element.inputMaskEditor({mask:digitMask})},userstoryselector:function($element){var clearField=this.typesClear.entity,entityUniqueName=$element.data("entityuniquename"),project=$element.closest("form").find(".project");this.entityBehavior($element),project.change($.proxy(function(e){clearField($element),this.childBus[entityUniqueName].fire("refresh",{filter:{project:$(e.target).val()}})},this.config.self))},releaseselector:function($element){var clearField=this.typesClear.entity,entityUniqueName=$element.data("entityuniquename"),project=$element.closest("form").find(".project");this.entityBehavior($element),project.change($.proxy(function(e){clearField($element),this.childBus[entityUniqueName].fire("refresh",{filter:{project:$(e.target).val()}})},this.config.self))},entity:function($element){this.entityBehavior($element)}},clear:function($elements){_.each($elements,function(item){var $element=$(item),type=($element.data("fieldtype")+"").toLowerCase();this.typesClear[type]?this.typesClear[type].call(this,$element):this.typesClear["default"].call(this,$element)},this)},typesClear:{"default":function($element){$element.val("")},dropdown:function($element){$element.find("option").eq(0).prop("selected",!0)},entity:function($element){$element.val("");var $entitySelector=$element.parent();$entitySelector.find(".tau-linkentity__inner").text($element.attr("placeholder")).addClass("tau-linkentity__inner_placeholder"),$entitySelector.find(".tau-linkentity__icon").hide()},checkbox:function($element){$element.prop("checked",!1)},userstoryselector:$.noop,releaseselector:$.noop,ddl:$.noop,url:$.noop},entityBehavior:function($element){var $entityField=$element.closest(".tau-field"),$entitySelector=$entityField.find(".tau-userStorySelector"),entityUniqueName=$element.data("entityuniquename"),$entitySelectorControl=$entityField.find(".tau-userStorySelector__control"),intervalID=null,self=this.config.self,position={of:$entitySelectorControl,my:"left top",at:"left bottom",collision:"flip flip",offset:"0 2"};$entitySelector.on("click keydown focus",function(e){var keyCode=$.ui.keyCode;if(!$(this).hasClass("focus")&&e.type=="focus"||e.type=="click"||e.type=="keydown"&&(e.keyCode==keyCode.DOWN||e.keyCode==keyCode.UP)){$entitySelector.hide();var userStoryList=$entitySelectorControl.show(),list=userStoryList.find(".tau-finder__result_user-stories");list.outerWidth(userStoryList.outerWidth()),userStoryList.find(".tau-finder__table_quick-add").on("menuentityrefresh",function(){userStoryList.find(".tau-finder__result_user-stories").position().top<0&&userStoryList.is(":visible")&&(position={of:$entitySelectorControl,my:"left bottom",at:"left top",collision:"flip flip",offset:"0 0"}),userStoryList.find(".tau-finder__result_user-stories").position(position)}),userStoryList.find(".tau-finder__result_user-stories").position(position),userStoryList.find("input").focus()}}),$entitySelector.focusout(function(){$(this).removeClass("focus")}),$entitySelectorControl.focusout(function(){clearTimeout(intervalID),intervalID=setTimeout(function(){$entitySelectorControl.hide(),$entitySelector.show()},0)}),$entitySelectorControl.keydown(function(event){event.keyCode==$.ui.keyCode.ESCAPE&&($entitySelectorControl.hide(),$entitySelector.show().addClass("focus").focus(),event.stopImmediatePropagation())}),$entitySelectorControl.focusin(function(){clearTimeout(intervalID)}),self.on(entityUniqueName+".entitySelected",function(evt,data){var entity=data.entity;$element.data("value",data.entity),$element.val(entity.id).change();var $entityTypeIcon=$entitySelector.find(".tau-linkentity__icon"),classes=$entityTypeIcon.attr("class").replace(/ui-type-icon-\S+/ig,"ui-type-icon-"+entity.entityType.name.toLowerCase());$entityTypeIcon.attr("class",classes),$entityTypeIcon.text(entity.id).show(),$entitySelector.find(".tau-linkentity__inner").text(entity.name).removeClass("tau-linkentity__inner_placeholder"),$entitySelectorControl.hide(),$entitySelector.show().addClass("focus").focus()})}},"bus view.editors.ready + culture.ready":function(evt,editors,culture){editors.filter(".tau-in-text").placeholder(),this.prepareFields.config={culture:culture,self:this},this.prepareFields.setBehavior(editors)},"bus childComponentCreated":function(evt,child){this.childBus[child.name]=child},childBus:{},"bus view.editors.ready:last+view.indicator.ready:last+before_model.add.item":function(evt,editorElements,indicator){editorElements.filter(":not(.disabled)").prop("disabled",!0),indicator.tauProgressIndicator("show"),this.fire("adjustPosition")},"bus view.editors.ready:last+view.indicator.ready:last+model.data.item.did.add":function(evt,editorElements,indicator){editorElements.filter(":not(.disabled)").prop("disabled",!1),indicator.tauProgressIndicator("hide"),this.fire("adjustPosition")},"bus view.editors.ready:last+view.indicator.ready:last+model.data.item.did.fail.add":function(evt,editorElements,indicator){editorElements.filter(":not(.disabled)").prop("disabled",!1),indicator.tauProgressIndicator("hide"),this.fire("adjustPosition")},"bus afterRender:last+view.select.entity.editor":function(evt,afterRender,editorData){var $previousFieldEditors=afterRender.element.find(".tau-control-set.tau-active .tau-required-field-editor").not(".placeholder");afterRender.element.find(".tau-active").removeClass("tau-active tau-checked"),afterRender.element.find(".i-role-entity-selector.tau-"+editorData.type.toLowerCase()).addClass("tau-checked").addClass("tau-active");var elementForActivateSelector=".tau-entity-controls .tau-control-set."+editorData.type;afterRender.element.find(elementForActivateSelector).addClass("tau-active"),window.setTimeout(function(){afterRender.element.find(".tau-entity-controls .tau-active input").eq(0).focus().caretToEnd()},0),$previousFieldEditors.each(function(){var data=$(this).data();if(data.iscf)return;var typeName=data.fieldname,editorSelector=".tau-control-set.tau-active .tau-required-field-editor."+typeName,input=afterRender.element.find(editorSelector);switch(data.fieldtype){case"Text":input.filter(":not(.placeholder)").val($(this).val()),$(this).val()&&input.show().filter(".placeholder").remove();break;case"DDL":input.val()!=$(this).val()&&($(this).hasClass("disabled")||input.find('[value="'+$(this).val()+'"]').prop("selected",!0).length&&input.change());break;default:input.val($(this).val())}}),this.fire("adjustPosition")},onTypeSelectorClick:function(evt){evt.preventDefault();if($(evt.target).hasClass("tau-active"))return;var type=$(evt.target).data().type;this.fire("view.select.entity.editor",{type:type})},onSubmit:function(evt){return this.fire("view.submit",{type:$(evt.target).data().type}),!1}})});
define('tau/ui/extensions/container/ui.extension.container.childrenEvents',["tau/core/extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus childComponentCreated":function(evt){var childBus=evt.data,bus=this.bus,originalFire=childBus.fire,childName=childBus.name;childBus.fire=function(eventName,data){var params=_.toArray(arguments);originalFire.apply(childBus,params),bus.fire(childName+"."+eventName,data)}}})});
define('tau/views/view.compositeControl',["Underscore","jQuery","tau/core/view-base","tau/core/event-dispatcher","tau/models/dataprocessor/model.processor.context"],function(_,$,ViewBase,EventDispatcher,modelProcessorContext){var getComponentPaths=function(componentTypes){return _(componentTypes).map(function(type){return"tau/components/component."+type})},processDataProperties=function(obj){var jsonResult={},keys=_(obj).keys();return _(keys).each(function(key){var tokens=key.split(":"),propName=null,i=-1,len=tokens.length,pathPointer=jsonResult;while(++i<len-1)propName=tokens[i],pathPointer.hasOwnProperty(propName)||(pathPointer[propName]={}),pathPointer=pathPointer[propName];var tagPropertyName=tokens[i];pathPointer[tagPropertyName]=obj[key]}),jsonResult};return ViewBase.extend({name:"view.compositeControl",init:function(config){this._loaded=!1,this._super(config),this.timeoutDescriptor=null},initialize:function(){var self=this;self._super.apply(self,arguments);var componentTypeNames=self.config.dependencies,loadDependencies=_.isArray(componentTypeNames)&&_.size(componentTypeNames)>0&&self.config.visible;if(loadDependencies){var componentPaths=getComponentPaths(componentTypeNames);require(componentPaths,self.createComponentTypesCallback(componentTypeNames))}else self.fireDependenciesAreReady({})},createComponentTypesCallback:function(componentTypeNames){var self=this;return self.dependenciesHash={},function(){var componentTypes=arguments;_(componentTypeNames).each(function(ctrlType,i){self.dependenciesHash[ctrlType]=componentTypes[i]}),self.fireDependenciesAreReady(self.dependenciesHash)}},fireDependenciesAreReady:function(dependenciesHash){this.fire("dependenciesAreReady",{controlTypes:dependenciesHash})},"bus afterInit+dataBind":function(){},"bus afterInit+dataBind+dependenciesAreReady":function(evts){var self=this,afterInitEvtData=evts.afterInit.data,dataBindEvtData=evts.dataBind.data,dependencies=evts.dependenciesAreReady.data;self.config.visible&&(self._loaded=!0),self.fireBeforeRender({data:dataBindEvtData}),self.doRender(dataBindEvtData,afterInitEvtData.refreshSelector);var childrenComponents=self.instantiateChildrenComponents(self.element.find("[runas]"),dependencies.controlTypes);self.initializeChildrenComponents(childrenComponents,dataBindEvtData)},createOnAfterRenderCallback:function(elementPlaceHolder){return function(e){e.removeListener(),elementPlaceHolder.replaceWith(e.data.element)}},onDestroyCallback:function(e){var self=this,componentBus=e.sender;delete self.children[componentBus.uniqueId]},instantiateChildrenComponents:function(placeholders,componentTypesRegistry){var self=this,childrenComponents=[];self.children={};var staticDestroyCallback=_.bind(self.onDestroyCallback,self);return placeholders.each(function(){var $el=$(this),componentTypeName=$el.attr("runas"),isItemDetected=componentTypesRegistry.hasOwnProperty(componentTypeName);if(!isItemDetected)throw"The component type ["+componentTypeName+"] not found";var typeFactory=componentTypesRegistry[componentTypeName],data=processDataProperties($el.data()),ctrlInstance=typeFactory.create({disabledExtensionCategories:self.config.disabledExtensionCategories,context:self.config.context,allData:data});ctrlInstance.uniqueId=ctrlInstance.uniqueId||_.uniqueId(),ctrlInstance.on("afterRender",self.createOnAfterRenderCallback($el)),ctrlInstance.on("destroy",staticDestroyCallback);var item={instance:ctrlInstance,config:data};self.children[ctrlInstance.uniqueId]=ctrlInstance,childrenComponents.push(item)}),childrenComponents},initializeChildrenComponents:function(childrenComponents,dataBindEvtData){var self=this,MAX_TIME=50,batchSize=10,createComponentContextHandler=function(){var len=childrenComponents.length;if(len){var tick0=+(new Date),batchComponents=childrenComponents.splice(0,batchSize),batchLength=batchComponents.length;for(var i=0;i<batchLength;i++){var ctrlItem=batchComponents[i];self.fire("createComponentContext",ctrlItem)}var tick1=+(new Date),delta=tick1-tick0,r=delta/MAX_TIME;if(Math.abs(1-r)>.3){var newBatchSize=Math.floor((batchSize+batchSize/r)/2);batchSize=newBatchSize||1}self.timeoutDescriptor=setTimeout(createComponentContextHandler,1)}else self.fire("component.ready")};createComponentContextHandler(),self.fireAfterRender({data:dataBindEvtData})},"bus createComponentContext":function(e){var self=this,ctrlItem=e.data,personalConfig=ctrlItem.config,entityData=personalConfig.context.general;personalConfig.context.entity=entityData,personalConfig.context.applicationContext=self.config.context.applicationContext,personalConfig.context.configurator=this.config.context.configurator,modelProcessorContext(personalConfig.context),self.fire("componentContextCreated",ctrlItem)},"bus componentContextCreated":function(e){var ctrlItem=e.data;this.fire("childComponentCreated",ctrlItem.instance),ctrlItem.instance.fire("initialize",ctrlItem.config)},"bus show":function(){this._super(),this._loaded||this.fire("initialize",{})},destroyChildren:function(){var self=this;clearTimeout(self.timeoutDescriptor),self.dispatcher=null,_(self.children||{}).chain().keys().each(function(componentKey){self.children[componentKey].destroy()}),self.children={}},lifeCycleCleanUp:function(){this.destroyChildren(),this._super()},destroy:function(){this.destroyChildren(),this._super()}})});
define('tau/ui/templates/board.add/ui.template.board.quick.add',["tau/core/templates-factory"],function(templates){var config={name:"board.cell.item.quick.add",engine:"jqote2",markup:['<div class="tau-quick-add-dialog">',"   <%if(this.isEmpty){%>",'        <div class="tau-quick-add_empty">You can\'t add anything.</div>',"    <%} else {%>",'    <div class="tau-entity-selector">','        <div class="quick-add__entity-items">',"            <% for(var i=0,length=this.entityTypes.length;i<length;i++){%>","                <%if(i==6) {%>",'                    <div><span class="quick-add__entity-items-more i-role-show_more">show more</span></div>','                    <div class="quick-add__entity-items-additional i-role-entity-additional">',"                <%}%>","                <button data-index=\"<%=i%>\"  data-type=\"<%= this.entityTypes[i].name%>\" class=\"i-role-entity-selector tau-btn tau-<%=this.entityTypes[i].name.toLowerCase()%> <%= ((i==0? 'tau-active tau-checked':'') + ' ' + this.entityTypes[i].name)%>\">","<%= this.entityTypes[i].title %>","</button>"," ","                <% if(i==(length-1)&& length>6) {%>","                    </div>","                <%}%>","            <%}%>","        </div>","    </div>","    <div>",'    <div class="tau-entity-controls">',"        <% for(var i=0,length=this.entityTypes.length;i<length;i++){","        var type  = this.types[this.entityTypes[i].name];","        var items = type.template.items; %>",'        <div class="tau-entity-fields">',"        <form class=\"tau-control-set tau-fieldset <%= ((i==0? 'tau-active':'') + ' ' + type.entityType.name )%>\" data-type=\"<%=type.entityType.name%>\">","                <% for( var j=0;j<items.length;j++){","                    var field =items[j];"," ",'                    if (field.type == "Text") {'," ","                %>",'                    <div class="tau-field">','                        <input tabindex="0" autocomplete="off" type="text" name="<%= field.id%>" data-validate=\'{"caption":"<%= field.caption%>","rules":["required","<%= field.id.toLowerCase() == "email"?"email":"text"%>"]}\' class="tau-in-text tau-required-field-editor <%= field.id%>" placeholder="<%= field.caption%>" data-fieldname="<%=field.id%>" data-fieldtype="<%=field.type%>">',"                    </div>","                    <%}",'            <% if (field.type == "Password") {%>','            <div class="tau-field">','                <input type="password" tabindex="0" name="<%= field.id%>" class="tau-in-text tau-required-field-editor <%= field.id%>" data-validate=\'{"caption":"<%= field.caption%>","rules":["text"]}\' placeholder="<%= field.caption%>" data-fieldname="<%=field.id%>" data-fieldtype="<%=field.type%>">',"            </div>","            <%}",'           <% if (field.type == "Number") {%>','            <div class="tau-field">','                <input type="text" tabindex="0" name="<%= field.id%>" class="tau-in-text tau-required-field-editor <%= field.id%>" data-validate=\'{"caption":"<%= field.caption%>","rules":["text","integer"]}\' placeholder="<%= field.caption%>" data-fieldname="<%=field.id%>" data-fieldtype="integer">',"            </div>","            <%}",'            <% if (field.type == "Date") {%>','            <div class="tau-field">','                <input type="text" tabindex="0" name="<%= field.id%>" class="tau-in-text tau-required-field-editor <%= field.id%>" data-validate=\'{"caption":"<%= field.caption%>","rules":["text","date"]}\' placeholder="<%= field.caption%>" data-fieldname="<%=field.id%>" data-fieldtype="<%=field.type%>">',"            </div>","            <%}",'                   if (field.type== "DDL"){',"                    var options = field.options.values;","                    var lengthOptions = options.length;","            %>",'                    <div class="tau-field">','                        <select data-validate=\'{"caption":"<%= field.caption%>","rules":["required"]}\' tabindex="0" <%if(lengthOptions == 1){%>disabled="disabled"<%}%> class="tau-select  <%if(lengthOptions == 1){%>disabled<%}%> tau-required-field-editor <%= field.id.toLowerCase()%> chzn-select" name="<%= field.id%>"  data-fieldname="<%=field.id%>"  data-fieldtype="<%=field.type%>">',"                            <% for (var k=0; k < lengthOptions; k++){ %>",'<option data-option="<%! JSON.stringify(options[k]) %>"','<% if (field.options.selectedValue == options[k].id){ %> selected="selected" <% } %> ','value="<%= options[k].id %>','">',"<%! options[k].title %>","</option>","                            <% } %>","                        </select>","                    </div>","                   <%}%>",'                   <%if(field.type == "UserStorySelector"){',"                   %>",'                    <div class="tau-field tau-field_entity">','                        <div tabindex="0" class="tau-userStorySelector">','                            <input type="hidden" data-entityuniquename=\'userstories\' data-validate=\'{"caption":"<%= field.caption%>","rules":["userStorySelector"]}\'  name="<%= field.id%>" class="tau-required-field-editor <%= field.id%>" placeholder="<%= field.caption%>"  data-fieldname="<%=field.id%>" data-filter=\'<%= JSON.stringify(field.options.filter)%>\' data-fieldtype="<%=field.type%>">','                            <span class="userStorySelector ui-link"><em class="ui-type-icon ui-type-icon-userstory tau-linkentity__icon" style="display: none;"></em><span class="tau-linkentity__inner tau-linkentity__inner_placeholder">User Story</span></span>',"","                        </div>",'                        <div tabindex="0" class="tau-userStorySelector__control">',"                            <span  runas=\"finder.entity\"  data-context:general='' data-name='userstories' data-filterenabled='true' data-entitytype='userstories' data-filter='<%= JSON.stringify(field.options.filter)%>'></span>","                        </div>","                    </div>","                    <%}%>",'                    <%if(field.type == "ReleaseSelector"){',"                    %>",'                    <div class="tau-field tau-field_entity">','                        <div tabindex="0" class="tau-userStorySelector">','                            <input type="hidden" data-entityuniquename=\'releaseselector\' data-validate=\'{"caption":"<%= field.caption%>","rules":["userStorySelector"]}\'  name="<%= field.id%>" class="tau-required-field-editor <%= field.id%>" placeholder="<%= field.caption%>"  data-fieldname="<%=field.id%>" data-filter=\'<%= JSON.stringify(field.options.filter)%>\' data-fieldtype="<%=field.type%>">','                            <span class="userStorySelector ui-link"><em class="ui-type-icon ui-type-icon-userstory tau-linkentity__icon" style="display: none;"></em><span class="tau-linkentity__inner tau-linkentity__inner_placeholder">Release</span></span>',"                        </div>",'                        <div tabindex="0" class="tau-userStorySelector__control">',"                            <span  runas=\"finder.entity\"  data-context:general='' data-name='releaseselector' data-filterenabled='true' data-entitytype='releases' data-filter='<%= JSON.stringify(field.options.filter)%>'></span>","                        </div>","                    </div>","                    <%}%>",'                        <%if (field.type=="CustomField"){','                                if(field.fieldType=="Text" || field.fieldType=="Number" || field.fieldType=="Date" || field.fieldType=="TemplatedURL") {',"                                var additionalRules = '';",'                                field.fieldType=="Number"&&(additionalRules = additionalRules + \',"number"\');','                                field.fieldType=="Text"&&(additionalRules = additionalRules + \',"text"\');','                                field.fieldType=="Date"&&(additionalRules = additionalRules + \',"date"\');',"                                %>","",'                                <div class="cf-wrap tau-field tau-custom cf-process_<%=field.processId%>">','                                <input tabindex="0" autocomplete="off" type="text"  data-validate=\'{"caption":"<%= field.caption%>","rules":["required"<%=additionalRules%>]}\' class="tau-in-text <%=field.fieldType==\'Date\'?\'cf-input_date\':\'\'%> <%=field.fieldType==\'Number\'?\'cf-input_number\':\'\'%> cf-input tau-required-field-editor " placeholder="<%= field.caption%>" data-iscf="true" data-fieldname="<%=field.caption%>" data-fieldtype="<%=field.fieldType%>">',"                                </div>","                                <%","                                }",'                                if(field.fieldType=="CheckBox") {%>','                                    <div class="cf-wrap tau-field tau-custom cf-process_<%=field.processId%>">','                                        <label class="tau-checkbox "><input tabindex="0" autocomplete="off" type="checkbox"  data-validate=\'{"caption":"<%= field.caption%>","rules":["checkbox"]}\' class="tau-is-active cf-input tau-required-field-editor "  data-iscf="true" data-fieldname="<%=field.caption%>" data-fieldtype="<%=field.fieldType%>"  ><i></i><span><%=field.caption%></span></label>',"                                    </div>","                                <%}",'                                if(field.fieldType=="URL") {%>','                                <div class="cf-wrap tau-field tau-custom cf-process_<%=field.processId%> ">','                                    <input tabindex="0" autocomplete="off" type="hidden"  value=\'fake\'  data-validate=\'{"caption":"<%= field.caption%>","rules":["required"]}\' class="tau-is-active cf-input tau-required-field-editor "  data-iscf="true" data-fieldname="<%=field.caption%>" data-fieldtype="<%=field.fieldType%>"  >',"                                    <h4><%= field.caption%></h4>",'                                    <p class="cf-wrap-url_value">','                                        <input class="tau-in-text tau-is-active cf-input  cf-input-url_value tau-required-field-editor" data-iscf=\'true\' data-validate=\'{"caption":"<%= field.caption%>","rules":["required","url"]}\' type="" placeholder="URL">',"                                    </p>",'                                    <p class="cf-wrap-url_description">','                                        <input class="tau-in-text tau-is-active cf-input cf-input-url_description tau-required-field-editor" data-iscf=\'true\' data-validate=\'{"caption":"<%= field.caption%>","rules":["required"]}\' type="" placeholder="URL description">',"                                    </p>","                                </div>","                                <%}",'                                 if(field.fieldType=="DropDown" || field.fieldType=="MultipleSelectionList") {','                                    var options = field.options.value&&[]&&field.options.value.split("\\r\\n")||[];',"                                    %>",'                                    <div class="cf-wrap tau-field tau-custom cf-process_<%=field.processId%>">','                                        <%if(field.fieldType=="MultipleSelectionList"){%>',"                                        <h4><%= field.caption%></h4>","                                        <%}%>",'                                        <select data-validate=\'{"caption":"<%= field.caption%>","rules":["required"]}\' <%=field.fieldType=="MultipleSelectionList"?\'multiple="multiple"\':\'\'%>  tabindex="0"  data-iscf=\'true\' class="tau-select  cf-input tau-required-field-editor  " name="<%= field.caption%>"  data-fieldname="<%=field.caption%>"  data-fieldtype="<%=field.fieldType%>">','                                        <%if(field.fieldType!="MultipleSelectionList"){%>','                                        <option value=""><%=field.caption%></option>',"                                        <%}%>","                                        <%","                                        for(var k=0;k<options.length;k++){%>",'                                        <option value="<%!options[k]%>"><%!options[k]%></option>',"                                        <%}%>","                                        </select>","                                    </div>","                                <%}",'                                if(field.fieldType == "Entity"){',"                                %>",'                                <div class="cf-wrap tau-field_entity tau-field tau-custom cf-process_<%=field.processId%> ">','                                    <div tabindex="0" class="tau-userStorySelector">','                                        <input type="hidden" data-iscf="true" data-entityuniquename=\'entity_<%=type.entityType.name%>_<%=j%>\'  data-validate=\'{"caption":"<%= field.caption%>","rules":["userStorySelector"]}\'  name="<%= field.id%>" class="cf-input tau-required-field-editor <%= field.id%>" placeholder="<%= field.caption%>"  data-fieldname="<%=field.caption%>" data-filter=\'<%= JSON.stringify(field.options.filter)%>\' data-fieldtype="<%=field.fieldType%>">','                                        <span class="userStorySelector ui-link"><em class="ui-type-icon ui-type-icon-userstory tau-linkentity__icon" style="display: none;"></em><span class="tau-linkentity__inner tau-linkentity__inner_placeholder"><%=field.caption%></span></span>',"","                                    </div>",'                                    <div tabindex="0" class="tau-userStorySelector__control">',"                                        <span  runas=\"finder.entity\" data-name='entity_<%=type.entityType.name%>_<%=j%>' data-context:general='' data-filterenabled='true' data-filter='<%= JSON.stringify(field.options.filter||{})%>'></span>","                                    </div>","                                </div>","                               <%}","                        }%>","            <%}%>","",'            <div class="tau-field">','                <button tabindex="0" type="submit" class="tau-btn tau-add-item tau-success">Add</button>',"            </div>","        </form>","        </div>","        <%}%>","    </div>","    </div>","    <%}%>",'    <div class="tau-message-pool"></div>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.cell.quick.add',["tau/components/component.creator","tau/models/board.cell.quick.add/model.board.cell.quick.add","tau/ui/extensions/board.cell.quick.add/ui.extension.board.cell.quick.add","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/container/ui.extension.container.childrenEvents","tau/components/extensions/error/extension.errorBar","tau/views/view.compositeControl","tau/ui/templates/board.add/ui.template.board.quick.add"],function(Creator,Model,ExtensionMain,BubbleExtension,CreatorExtension,ChildrenEventsExtension,ErrorExtension,ViewExtension,Template){return{create:function(config){var extensions=[Model,ExtensionMain,ChildrenEventsExtension,ErrorExtension],creatorConfig={ViewType:ViewExtension,name:"board.quick.add",extensions:extensions,template:Template};return config["queue.bus"]=!0,config.dependencies=["finder.entity"],Creator.create(creatorConfig,config)}}});
define('tau/models/board.clipboard/model.board.clipboard.main',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){var Model=ExtensionBase.extend({"bus initialize":function(ev,cf){var self=this,initConfig=cf,options=this._extractOptions(initConfig,{refreshTimeout:null,settingsFieldName:"board_clipboard_collapse_state"}),context=initConfig.context,configurator=context.configurator;self.fire("options.ready",options),self.fire("configurator.ready",configurator)},"bus boardSettings.ready":function(ev,bs){var boardSettings=bs.boardSettings,self=this;boardSettings.get({fields:["viewMode"],callback:function(r){self.fire("viewMode.ready",r.viewMode),self.fire("viewMode.ready.fromInit",r.viewMode)}}),boardSettings.unbind({listener:this}),boardSettings.bind({listener:this,fields:["viewMode"],callback:function(r){self.fire("viewMode.ready",r.viewMode),self.fire("viewMode.ready.fromBind",r.viewMode)}})},"bus afterRender":function(ev,renderData){this.fire("$el.ready",renderData.element),this.fire("$holder.ready",renderData.element.find("[role=holder]"))},"bus options.ready+configurator.ready":function(evt,options,configurator){var settingsManager=configurator.getSettingsManager(),fieldName=options.settingsFieldName;settingsManager.get({fields:[fieldName],callback:_.bind(function(r){this.fire("collapseState.updated",r[fieldName])},this)}),settingsManager.unbind({listener:this}),settingsManager.bind({fields:[fieldName],listener:this,callback:_.bind(function(r){this.fire("collapseState.updated",r[fieldName])},this)})},"bus options.ready:last+configurator.ready:last+collapseState.set":function(evt,options,configurator,toExpand){var settingsManager=configurator.getSettingsManager(),fieldName=options.settingsFieldName,set={};set[fieldName]=toExpand?"expanded":"collapsed",settingsManager.set({set:set,callback:function(){}})}});return Model});
define('tau/models/board.clipboard/model.board.clipboard.data',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){var Model=ExtensionBase.extend({"bus configurator.ready:last+options.ready:last+afterInit":function(ev,configurator,o){var clipboardManager=configurator.getClipboardManager();clipboardManager.getAll(_.bind(function(err,cards){this.fire("cards.get",cards)},this)),configurator.getSliceFactory().create({}).space().done(function(result){this.fire("dataSpace",result.data)}.bind(this)),clipboardManager.unbind(this);var handler=_.bind(function(err,cards){this.fire("cards.ready",cards)},this);o.refreshTimeout&&(handler=_.debounce(handler,o.refreshTimeout)),clipboardManager.bind(this,handler)},"bus configurator.ready:last+cards.get":function(ev,configurator,clipboardCards){var self=this,store=configurator.getStore(),realCardsCount=clipboardCards.length;self._loadCardsData(clipboardCards,store,function(err,cards){self._buildUrl(configurator,cards,function(err,cards){realCardsCount!=cards.length&&configurator.getClipboardManager().set(cards),self.fire("cards.ready",cards),self.fire("dataBind",{cards:cards})})})},"bus configurator.ready:last+cards.readyToClear":function(ev,configurator,cardsToRemove){var clipboardManager=configurator.getClipboardManager(),cardsData=[];_.forEach(cardsToRemove,function(item){cardsData.push({id:item.id,data:{id:item.entityId,type:item.entityType}})}),clipboardManager.remove(cardsData,function(){})},"bus configurator.ready:last+cards.readyToRemove":function(ev,configurator,cardsToRemove){var clipboardManager=configurator.getClipboardManager(),store=configurator.getStore(),self=this,f=[];_.forEach(cardsToRemove,function(item){f.push(_.bind(function(item,next){store.remove(item.entityType,{id:item.entityId}).done({success:function(){next(!1,{item:item,error:!1})},failure:function(res){var r=res[0].data,error=r.status===404?!1:r.response?r.response.Message:"error";next(!1,{item:item,error:error})}})},self,item))}),_.parallel(f,function(err,results){var success=[],failure=[],toRemove=[];_.forEach(results,function(res){if(!res.error){var item=res.item;success.push(res.item),toRemove.push({id:item.id,data:{id:item.entityId,type:item.entityType}})}else failure.push(res.item),self.fire("error",{message:res.error})}),clipboardManager.remove(toRemove,function(){}),self.fire("cards.readyToRemove.after",{success:success,failure:failure})})},_loadCardsData:function(cards,store,next){var self=this;_.forEach(cards,function(card){card.data.name=null});var groups=_.chain(cards).groupByComplex(function(item){return item.data.type.toLowerCase()}).value(),indexedCards={};_.forEach(cards,function(card){indexedCards[card._id]=card});var funcs=[];_.forEach(groups,function(group){funcs.push(function(next){group.key=="user"?self._loadUserData(group,store,next):group.key=="team"?self._loadTeamData(group,store,next):group.key=="project"?self._loadProjectData(group,store,next):self._loadAssignableData(group,store,next)})}),_.parallel(funcs,function(err,groups){_.forEach(groups,function(group){_.forEach(group.items,function(item){item.data.name===null&&delete indexedCards[item._id]})}),next(null,_.values(indexedCards))})},_loadAssignableData:function(group,store,next){var ids=_.pluck(_.pluck(group.items,"data"),"id");store.find(group.key,{fields:["id","name"],$query:{id:{$in:ids}}},{success:function(res){var items=res.data,result={};_.forEach(items,function(item){result[item.id]=item.name}),_.forEach(group.items,function(card){card.data.name=result[card.data.id]||null}),next(null,group)},failure:function(){next(null,group)}}).done()},_loadUserData:function(group,store,next){var ids=_.pluck(_.pluck(group.items,"data"),"id");store.find(group.key,{fields:["id","avatarUri","firstName","lastName","email","login"],$query:{id:{$in:ids}}},{success:function(res){var items=res.data,result={};_.forEach(items,function(item){result[item.id]={name:_.trim(_.asString(item.firstName)+" "+_.asString(item.lastName))||item.login,avatarUri:item.avatarUri}}),_.forEach(group.items,function(card){card.data.name=null,result[card.data.id]&&(card.data.name=result[card.data.id].name||null,card.data.avatarUri=result[card.data.id].avatarUri||null)}),next(null,group)},failure:function(){next(null,group)}}).done()},_loadTeamData:function(group,store,next){var ids=_.pluck(_.pluck(group.items,"data"),"id");store.find(group.key,{fields:["id","name","icon"],$query:{id:{$in:ids}}},{success:function(res){var items=res.data,result={};_.forEach(items,function(item){result[item.id]=item}),_.forEach(group.items,function(card){card.data.name=null,result[card.data.id]&&(card.data.name=result[card.data.id].name||null,card.data.icon=result[card.data.id].icon||null)}),next(null,group)},failure:function(){next(null,group)}}).done()},_loadProjectData:function(group,store,next){var ids=_.pluck(_.pluck(group.items,"data"),"id");store.find(group.key,{fields:["id","name","color"],$query:{id:{$in:ids}}},{success:function(res){var items=res.data,result={};_.forEach(items,function(item){result[item.id]=item}),_.forEach(group.items,function(card){card.data.name=null,result[card.data.id]&&(card.data.name=result[card.data.id].name||null,card.data.color=result[card.data.id].color||null)}),next(null,group)},failure:function(){next(null,group)}}).done()},_buildUrl:function(configurator,cards,next){var self=this,builder=configurator.getUrlBuilder();configurator.getAppStateStore().get({fields:["acid"],callback:function(result){self._buildUrlForCards(builder,result.acid,cards),next(null,cards)}})},_buildUrlForCards:function(builder,acid,cards){_.forEach(cards,function(card){var data=card.data;card.data.entityRef=builder.getNewViewUrl(_.asString(data.id),_.asString(data.type),acid)})}});return Model});
define('tau/ui/extensions/board.plus/ui.board.plus.utils',["Underscore"],function(_){var cache={},esc=function(str){return _.trim(str)},cardsIds={};return{esc:esc,getDomNodeByIdFast:function($parent,domId){return window.document.getElementById(domId)},generateId:function(dataItem){var idParts=[];return dataItem.hasOwnProperty("x")&&(idParts.push("x"),idParts.push(dataItem.x),idParts.push("-")),dataItem.hasOwnProperty("y")&&(idParts.push("y"),idParts.push(dataItem.y),idParts.push("-")),esc(idParts.join(""))},generateElementData:function(src){var result=[];return _.forEach(src,function(val,key){_.isUndefined(val)||result.push("data-"+key+'="'+val+'"')}),result.join(" ")},getCardIds:function(item){return cardsIds[item.id]||[]},getCardId:function(item){return cardsIds[item.id]||[]},getLatestCardId:function(itemId){var ids=cardsIds[itemId];return ids[ids.length-1]},resetCardIds:function(){cardsIds={}},getCardSeed:function(item){return item.type.toLowerCase()+"-"+item.id},generateCardId:function(item){var cardIdCollection=cardsIds[item.id]=cardsIds[item.id]||[],id=this.getCardSeed(item)+"-"+cardIdCollection.length;return cardIdCollection.push(id),id},dimension:function($grid,$headerCell){var gId=$grid.attr("id");cache[gId]={};var gridCache=cache[gId],data={x:$headerCell.attr("data-x"),y:$headerCell.attr("data-y")},role=$headerCell.attr("role");gridCache.all||(gridCache.all=$grid.find("td.i-role-"+role));var s=function(){return!1};data.x&&(s=function(){return this.getAttribute("data-x")==data.x}),data.y&&(s=function(){return this.getAttribute("data-y")==data.y});var id=$headerCell.attr("id");return gridCache[id]||(gridCache[id]=gridCache.all.filter(s)),gridCache[id]},isHidden:function($cell){return $cell.attr("data-is-hidden")||!1},isSupportedCardForView:function(cardData){var notSupportedTypes=["role","requesttype","severity","tag","process"];return!_.include(notSupportedTypes,cardData.entityType)},convertCellAxisData:function(dataDynamicItems){var item=dataDynamicItems.dynamic&&dataDynamicItems.dynamic.items&&dataDynamicItems.dynamic.items.length?dataDynamicItems.dynamic.items[0]:null,id=null,name="",isEntity=!1,entity={id:null,type:null},isSupportView=!1,itemData={};if(item){itemData=item.data,name=item.name||"";if(itemData)if(itemData.name)name=itemData.name;else if(_.isArray(itemData.names))name=itemData.names.join(", ");else if(itemData.type.toLowerCase()=="user"||itemData.hasOwnProperty("firstName")&&itemData.hasOwnProperty("lastName"))name=_.trim(_.asString(itemData.firstName)+" "+_.asString(itemData.lastName))||_.asString(itemData.email);id=item.id,entity={id:itemData.id?itemData.id:null,type:item.type?item.type.toLowerCase():null},isEntity=!!entity.id&&!!entity.type,isEntity&&(isSupportView=this.isSupportedCardForView({entityType:entity.type})),item.type.toLowerCase()=="team"&&(itemData.users=itemData.users||[],itemData.users=_.map(itemData.users,function(user){return _.extend(user,{name:_.trim(_.asString(user.firstName)+" "+_.asString(user.lastName))||_.asString(user.email),avatarUri:user.avatarUri})}))}return _.extend(dataDynamicItems,{id:id,name:name,itemData:itemData,isEntity:isEntity,isSupportView:isSupportView,entity:entity})}}});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.id',["tau/core/templates-factory"],function(templates){var config={name:"boardplus.card.id",engine:"jqote2",customFunctions:{generateCardRef:function(data){return data.entityRef||["tpview.aspx#",data.type.toLowerCase(),"/",data.id].join("")}},markup:['<span class="tau-id-text">',"<%= this.id %>","</span>",'<a class="tau-id" href="<%= fn.generateCardRef(this) %>">',"<%= this.id %>","</a>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.assignments',["tau/core/templates-factory","app.path"],function(templates,AppPath){var config={name:"boardplus.card.assignments",engine:"jqote2",customFunctions:{getAppPath:function(){return AppPath.get()}},markup:[['<span class="tau-avatar tau-avatar_<%= this.id %>"><img  alt="<%! this.generalUser.firstName + \' \' + this.generalUser.lastName %>" title="<%! this.generalUser.firstName + \' \' + this.generalUser.lastName %>"  src="<%= this.avatarUri %>24" /></span>'].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.assignedUsers',["tau/core/templates-factory"],function(templates){var config={name:"boardplus.card.assignedUsers",engine:"jqote2",customFunctions:{name:function(user){return _.trim(_.asString(user.firstName)+" "+_.asString(user.lastName))||_.asString(user.email)}},markup:["<%_.forEach(this.items,function(item){%>",'<span class="tau-avatar tau-avatar_<%= item.id %> <%if(this.viewTrigger){%>i-role-cellaxis-viewtrigger<%}%>" data-entity-id="<%= item.id %>" data-entity-type="user">',"<% var name = fn.name(item); %>",'<img  alt="<%! name %>" title="<%! name %>" src="<%= item.avatarUri%>24" />',"</span>","<%},this);%>","<%if(this.count>0) { %>",'<span class="count-users">+<%=this.count%></span>',"<%}%>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.requesters',["tau/core/templates-factory","app.path"],function(templates,AppPath){var config={name:"boardplus.card.requesters",engine:"jqote2",customFunctions:{getAppPath:function(){return AppPath.get()}},markup:[['<span class="tau-avatar tau-avatar_<%= this.id %>"><img  alt="<%! this.firstName + \' \' + this.lastName %>" title="<%! this.firstName + \' \' + this.lastName %>"  src="<%= this.avatarUri %>24" /></span>'].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.customFields',["Underscore","tau/core/templates-factory","tau/utils/utils.date"],function(_,templates,UtilsDate){var config={name:"boardplus.card.customFields",engine:"jqote2",customFunctions:{formatDate:function(date){var date=UtilsDate.parse(date);return date.toString("MMM yyyy")},isDate:function(value){return _.isDate(UtilsDate.parse(value))}},markup:[['<span class="tau-customField"><%=this.name%>: ','<%if (this.type === "Date"){ %>',"<%=fn.formatDate(this.value)%>","<%}%>","<% else {%>","<%= this.value%>","<%}%>","</span>"].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.user',["tau/core/templates-factory","app.path"],function(templates,AppPath){var config={name:"boardplus.card.user",engine:"jqote2",customFunctions:{getAppPath:function(){return AppPath.get()}},markup:[['<span class="tau-avatar tau-avatar_<%= this.id %>"><img  alt="<%! this.firstName + \' \' + this.lastName %>" title="<%! this.firstName + \' \' + this.lastName %>"  src="<%= this.avatarURI%>24" /></span>'].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.lastComment',["tau/core/templates-factory","app.path"],function(templates,AppPath){var config={name:"boardplus.card.lastComment",engine:"jqote2",customFunctions:{getAppPath:function(){return AppPath.get()}},markup:[["<% if (this.commentsCount > 0) { %>","<% var owner = this.lastCommentedUser; %>",'<% owner = owner.firstName || owner.lastName ? owner:{firstName:"Somebody",lastName:""}; %>','<div class="tau-last-comment-container">','<span class="tau-comments-count"><%=this.commentsCount%>&nbsp;Comment<%=this.commentsCount>1?"s":""%>,</span> ','<span class="tau-last-comment">Last by <span class="tau-comment-owner"><%= (owner.firstName || "") + " " + (owner.lastName || "")%></span></span>',"</div>","<%}%>"].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.avatar',["tau/core/templates-factory","app.path"],function(templates,AppPath){var config={name:"boardplus.card.avatar",engine:"jqote2",customFunctions:{getAppPath:function(){return AppPath.get()}},markup:[['<span class="tau-avatar tau-avatar_<%= this.id %>">','<img  alt="<%! this.name %>" ','src="<%= this.avatarUri %>48" />',"</span>"].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.connectedItems',["Underscore","tau/core/templates-factory"],function(_,templates){var config={name:"boardplus.card.connectedItems",engine:"jqote2",customFunctions:{_:_,createGroups:function(type,list,limit){var conf={team:{criteria:"icon"},project:{criteria:"color"},user:{criteria:"avatarUri"}}[type],show=_.chain(list).filter(function(v){return v.criteria=_.asString(v[conf.criteria]).trim(),!!v.criteria}).value().slice(0,limit);return show.length==0&&(show=list.slice(0,1)),{type:type,show:show,restLength:list.length-show.length}}},markup:["<% var groups = fn.createGroups(this.type, this.items, 5); %>","<% if (groups.show.length){ %>",'<ul <% if (groups.restLength > 0) { %>class="tau-more"<% } %> >',"<% _.forEach(groups.show, function(item){ %>","<li>","<% if (item.criteria) { %>",'<% if (groups.type == "team") { %>','<i class="tau-icon tau-icon_type_svg tau-icon_name_<%! _.asString(item.criteria).trim() %> " title="<%! item.name %>"></i>','<% } else if (groups.type == "project") { %>','<i class="tau-icon tau-icon_type_color" stype="background-color: <%! item.criteria %>" title="<%! item.name %>"></i>','<% } else if (groups.type == "user") { %>','<span class="tau-avatar">','<img title="<%! item.name %>" src="<%! item.criteria %>20" />',"</span>","<% } %>","<% } %>",'<% if (groups.show.length == 1 && groups.type != "user" && groups.restLength == 0) { %>',"<span><%! item.name %></span>","<% } %>","</li>","<% }); %>","</ul>","<% } %>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.relations',["Underscore","tau/core/templates-factory"],function(_,templates){var config={name:"boardplus.card.relations",engine:"jqote2",customFunctions:{_:_,getTotalMasters:function(item){var totalMasters=item.hasOwnProperty("activeMasterCount")?item.activeMasterCount.openAssignables+item.activeMasterCount.openImpediments+item.activeMasterCount.others:0;return totalMasters},getTotalSlaves:function(item){var totalSlaves=item.hasOwnProperty("activeSlaveCount")?item.activeSlaveCount.openAssignables+item.activeSlaveCount.openImpediments+item.activeSlaveCount.others:0;return totalSlaves}},markup:["<% var item = this.relations || {}; %>","<% var totalMasters = fn.getTotalMasters(item); %>","<% var totalSlaves = fn.getTotalSlaves(item); %>","<% var enabled = (totalMasters > 0 || totalSlaves > 0); %>",'<div class="tau-relations i-role-card-content-relations" style="<% if (!enabled) { %>display: none;<% } %>">',"<% if (enabled) { %>",'   <span class="<% if (item.activeMasterCount.openImpediments > 0) { %>tau-relations-impediment<% } %>"><%=totalMasters%></span>','   <span class="tau-relations-icon"></span>','   <span class="<% if (item.activeSlaveCount.openImpediments > 0) { %>tau-relations-impediment<% } %>"><%=totalSlaves%></span>',"<% } %>","</div>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.sparklines',["Underscore","tau/core/templates-factory"],function(_,templates){var config={name:"boardplus.card.sparklines",engine:"jqote2",customFunctions:{transform:function(jsonObj){return JSON.stringify(jsonObj)}},markup:["<% var sl = this.sparklines || {}; %>",'<% var enabled = sl.hasOwnProperty("userStories") || sl.hasOwnProperty("bugs"); %>','<ul class="tau-sparklines i-role-card-content-sparklines" style="<% if (!enabled) { %>display: none;<% } %>">','<% if (sl.hasOwnProperty("userStories")) { %>','<li title="User Stories sparkline provides an overview of progress over the last 16 weeks. Top: done user stories per week. Bottom: added user stories per week.">',"<svg class=\"tau-sparkline i-role-sparkline\" data-source='<%= fn.transform(sl.userStories) %>' />","</li>","<% } %>",'<% if (sl.hasOwnProperty("bugs")) { %>','<li title="Bugs sparkline provides an overview of progress over the last 16 weeks. Top: closed bugs per week. Bottom: added bugs per week.">',"<svg class=\"tau-sparkline tau-sparkline-bugs i-role-sparkline\" data-source='<%= fn.transform(sl.bugs) %>' />","</li>","<% } %>","</ul>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.content',["Underscore","tau/utils/utils.date","tau/utils/utils.translation","tau/core/templates-factory","app.path","tau/ui/templates/board.plus/ui.template.boardplus.card.assignments","tau/ui/templates/board.plus/ui.template.boardplus.card.assignedUsers","tau/ui/templates/board.plus/ui.template.boardplus.card.requesters","tau/ui/templates/board.plus/ui.template.boardplus.card.customFields","tau/ui/templates/board.plus/ui.template.boardplus.card.user","tau/ui/templates/board.plus/ui.template.boardplus.card.lastComment","tau/ui/templates/board.plus/ui.template.boardplus.card.id","tau/ui/templates/board.plus/ui.template.boardplus.card.avatar","tau/ui/templates/board.plus/ui.template.boardplus.card.connectedItems","tau/ui/templates/board.plus/ui.template.boardplus.card.relations","tau/ui/templates/board.plus/ui.template.boardplus.card.sparklines"],function(_,UtilsDate,Translation,templates,appPath){var config={name:"boardplus.card.content",engine:"jqote2",customFunctions:{_:_,dateUtils:UtilsDate,cutList:function(list,limit){return{show:list.slice(0,limit),restLength:list.slice(limit).length}},processTags:function(tags){return _.compact(_.asString(tags).split(","))},processSparklines:function(){return[appPath.get()+"/JavaScript/tau/css.board/images/project_sparkline_a.png",appPath.get()+"/JavaScript/tau/css.board/images/project_sparkline_b.png"]},dateToString:function(dateStr){return UtilsDate.format.date.short(UtilsDate.convertToTimezone(dateStr))},pluralize:Translation.pluralize},markup:['<div class="tau-card-header-container">','<%= fn.sub("boardplus.card.id", this) %>','<% if (this.type.toLowerCase() === "user") {%>','<%= fn.sub("boardplus.card.avatar", this) %>',"<%} %>",'<% if (this.hasOwnProperty("tags")) { %>',"<% var tags = fn.processTags(this.tags); %>","<% for( var i=0;i<tags.length;i++){%>",'<span class="tau-tag"><%! tags[i] %></span>',"<% } %>","<% } %>","</div>",'<div class="tau-card-title-container">','<div class="tau-name i-role-name">','<% if (this.type.toLowerCase() === "project"){ %>','<span <% if (this.color) { %>class="i-role-color" data-color="<%= this.color %>" style="background-color:<%= this.color %>; border-color:<%= this.color %>;"<% } else {%>class="i-role-nocolor"<%}%> >',"<%! this.name %>","</span>",'<% } else if (this.type.toLowerCase() === "team"){ %>',"<% if (_.asString(this.icon).trim()) { %>",'<i class="tau-icon tau-icon_type_svg tau-icon_name_<%! _.asString(this.icon).trim() %> " data-icon="<%! _.asString(this.icon).trim() %>"></i>',"<% } %>","<span>","<%! this.name %>","</span>",'<% } else if (this.type.toLowerCase() === "user"){ %>',"<%! (_.trim(this.name) || _.trim(this.login)) %>","<% } else { %>","<%! _.trim(this.name) %>","<% } %>","</div>",'<% if (this.hasOwnProperty("roleName")) {%>','<div class="tau-role">',"<%= this.roleName %>","</div>","<% } %>","</div>",'<div class="tau-card-main-container">','<% if (this.hasOwnProperty("assignedUsers") || this.hasOwnProperty("responsible")) {%>','<div class="tau-people">','<% if (this.hasOwnProperty("assignedUsers")) {%>','<%= fn.sub("boardplus.card.assignedUsers", {items:fn.cutList(this.assignedUsers, 3).show,count:this.assignedUsers.length-3}) %>',"<% } %>",'<% if (this.hasOwnProperty("responsible")) {%>','<%= fn.sub("boardplus.card.user", this.responsible) %>',"<% } %>","</div>","<% } %>","<% if (this.team && this.team.icon) {%>",'<i class="tau-team tau-icon tau-icon_type_svg <% if (this.team.icon){ %> tau-icon_name_<%! this.team.icon %><% } %>"></i>',"<% } %>","<% if (this.openImpedimentsCount > 0) {%>",'<span class="tau-impediments"><%=this.openImpedimentsCount%></span>',"<% } %>",'<% if (this.hasOwnProperty("effort")) {%>','<div class="tau-effort"><%=this.effort%>','<%=this.units||"pt"%>',"</div>","<% } %>","<% if (this.project && this.project.abbreviation) {%>",'<div <% if (this.project.color){ %> style="background-color: <%=this.project.color %>;"<% } %> class="tau-project">',"<%=this.project.abbreviation %>","</div>","<% } %>",'<% if (this.hasOwnProperty("lastRunDate") && this.hasOwnProperty("lastStatus") && this.lastStatus != null ) {%>','<span class="tau-testcase-state tau-testcase-<%= (this.lastStatus?"success":"failed")%>" title="<%=fn.dateToString(this.lastRunDate)%>"></span>',"<%} %>",'<%= fn.sub("boardplus.card.relations", this) %>','<% if (this.hasOwnProperty("openTasks") && this.hasOwnProperty("allTasks") && this.allTasks > 0) {%>','<div class="tau-related-tasks"><span class="i-task">t</span>',"<%=this.openTasks%>/<%=this.allTasks%>","</div>","<% } %>",'<% if (this.hasOwnProperty("openBugs") && this.hasOwnProperty("allBugs") && this.allBugs > 0) {%>','<div class="tau-related-bugs"><span class="i-bug">b</span>',"<%=this.openBugs%>/<%=this.allBugs%>","</div>","<% } %>",'<% if (this.hasOwnProperty("userStoriesCount") && this.userStoriesCount > 0) {%>','<div class="tau-related-userstories"><span class="i-story">u</span>',"<%=this.openUserStoriesCount%>/<%=this.userStoriesCount%>","</div>","<% } %>","<% if (this.relatedEntitiesCount > 0) {%>",'<div class="tau-related-entities-info">','<span class="tau-related-entities-count"><%=this.relatedEntitiesCount%></span>',"</div>","<% } %>",'<% if (this.hasOwnProperty("requesters") && this.requesters.length > 0) {%>','<div class="tau-request-vote"><%=this.requesters.length%></div>',"<% } %>",'<% if (this.hasOwnProperty("votes") && this.votes > 0) {%>','<div class="tau-request-vote"><%=this.votes%></div>',"<% } %>",'<% if (this.hasOwnProperty("createDate")) {%>',"<%var date = this.createDate; %>",'<div class="tau-date"><%=fn.dateToString(date)%>&nbsp;</div>',"<%} %>",'<% if (this.hasOwnProperty("currentAllocation")) {%>','<div class="tau-allocation"><%=this.currentAllocation %>%</div>',"<%} %>",'<% if (this.hasOwnProperty("teamCount") && this.teamCount > 0 ) {%>','<div class="tau-team-count"><%=this.teamCount %></div>',"<%} %>",'<% if (this.hasOwnProperty("teamProjectsCount") && this.teamProjectsCount > 0){ %>','<div class="tau-team-list">','<div class="tau-teams-counter"><%=this.teamProjectsCount %> <%=fn.pluralize("team|teams", this.teamProjectsCount) %></div>','<%= fn.sub("boardplus.card.connectedItems", {items: this.teams, type: "team"}) %>',"</div>","<% } %>",'<% if (this.hasOwnProperty("teamMembersCount") && this.teamMembersCount > 0){ %>','<div class="tau-people-list">','<div class="tau-people-counter"><%=this.teamMembersCount %>  <%=fn.pluralize("person|people", this.teamMembersCount) %></div>','<%= fn.sub("boardplus.card.connectedItems", {items: this.members, type: "user"}) %>',"</div>","<% } %>","</div>",'<%= fn.sub("boardplus.card.sparklines", this) %>','<% if (this.hasOwnProperty("customFields") ||                 this.hasOwnProperty("priorityName") ||                 this.hasOwnProperty("severityName") ||                 this.hasOwnProperty("lastCommentedUser")){%>','<div class="tau-card-footer-container">','<% if (this.hasOwnProperty("severityName") && this.severityName) {%>','<div class="tau-severity">Severity: <%=this.severityName%></div>',"<%} %>",'<% if (this.hasOwnProperty("priorityName") && this.priorityName.length >0 ){ %>','<div class="tau-priority">Priority: <%=this.priorityName%></div>',"<%} %>",'<% if (this.hasOwnProperty("customFields")){ %>','<%= fn.sub("boardplus.card.customFields", this.customFields) %>',"<% } %>",'<% if (this.hasOwnProperty("lastCommentedUser")){ %>','<%= fn.sub("boardplus.card.lastComment", this) %>',"<% } %>","</div>","<% } %>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.card.skeleton',["Underscore","tau/core/templates-factory","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/ui/templates/board.plus/ui.template.boardplus.card.id",,"tau/ui/templates/board.plus/ui.template.boardplus.card.content"],function(_,templates,BoardPlusUtils){var config={name:"boardplus.card.skeleton",engine:"jqote2",customFunctions:{generateCardData:BoardPlusUtils.generateElementData,generateCardId:_.bind(BoardPlusUtils.generateCardId,BoardPlusUtils)},markup:["<%  var data = this.data; %>",'<div role="card" class="tau-card i-role-card tau-<%= data.type.toLowerCase()%><% if (data.isFinalState) { %> tau-card_final-state<% } %>" ','id="<%= fn.generateCardId(data) %>" ','<%= fn.generateCardData({ id: this.id, "entity-type": data.type.toLowerCase(), "entity-id": data.id, "_id": this._id, "ordering-value": this.orderingValue }) %>',">",'<%= fn.sub("boardplus.card.content", data) %>',"</div>"]};return templates.register(config)});
define('tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.output',["Underscore","jQuery","tau/core/extension.base","tau/ui/templates/board.plus/ui.template.boardplus.card.skeleton"],function(_,$,ExtensionBase,cardTemplate){return ExtensionBase.extend({"bus $el.ready:last+viewMode.ready":function(ev,$el,viewMode){$el.toggleClass("tau-boardclipboard_enable_true",viewMode!="list"),this.fire("$el.readyToLayout",$el)},"bus    $el.ready:last          +                $selectable.ready:last  +                $holder.ready:last      +                configurator.ready:last +                cards.ready":function(ev,$el,$selectable,$holder,configurator,cards){var $cards=$holder.find(".i-role-card"),$real=$(),extLength=$cards.length;cards.length==0?$cards.detach():(_.forEach(cards,function(card){var $ext=$cards.filter("[data-_id="+card._id+"]");$ext.length?$cards=$cards.not($ext.eq(0)):($ext=configurator.getTemplateFactory().get("boardplus.card.skeleton").bind({},card),$ext.attr("id",_.uniqueId("clipboardcard_"))),$ext.length&&($real=$real.add($ext.eq(0)))}),$cards.detach(),$real.appendTo($holder)),$el.find("[role=counter]").text($real.length),cards.length>extLength&&$selectable.tauSelectable("reset"),this.fire("count.updated",$real.length)},"bus $el.ready:last + count.updated:last + collapseState.updated:last":function(evt,$el,count,state){$el.toggleClass("tau-boardclipboard_empty_true",count==0||state=="collapsed"),this.fire("$el.readyToLayout",$el)},"bus view.dom.ready":function(evt,dom){var $layout=dom.element.find(".tau-app-main-pane");this.fire("$layout.ready",$layout)},"bus $layout.ready:last+$el.readyToLayout":function(evt,$layout,$el){var isEnabled=$el.hasClass("tau-boardclipboard_enable_true"),isEmpty=$el.hasClass("tau-boardclipboard_empty_true");$layout.toggleClass("tau-layout-board_south-visible_true",isEnabled),$layout.toggleClass("tau-layout-board_south-visible_false",!isEnabled),$layout.toggleClass("tau-layout-board_south-expanded_false",isEmpty),$layout.toggleClass("tau-layout-board_south-expanded_true",!isEmpty)}})});
define('tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.actions',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var $clearAction=$el.find("[role=action_clear]");this.fire("$clearAction.ready",$clearAction);var $collapseAction=$el.find(".i-role-collapser");this.fire("$collapseAction.ready",$collapseAction);var $removeAction=$el.find("[role=action_remove]");this.fire("$removeAction.ready",$removeAction)},"bus $clearAction.ready + $selectable.ready":function(evt,$clearAction,$selectable){var self=this,handler=_.bind(function($selectable,$action){var $selected=$selectable.tauSelectable("getSelected");$action.toggleClass("tau-boardclipboard__action-clear-selected",$selected.length>0)},this,$selectable,$clearAction);$selectable.bind("tauselectablechanged",_.debounce(handler,400)),$clearAction.on("click",function(){var $selected=$selectable.tauSelectable("getSelected");$selected.length==0&&($selected=$selectable.find(".i-role-card"));var cards=[];$selected.each(function(){cards.push($(this).data())}),self.fire("cards.readyToClear",cards)})},"bus $clearAction.ready:last + $selectable.ready:last + cards.ready":function(evt,$clearAction,$selectable){var $selected=$selectable.tauSelectable("getSelected");$clearAction.toggleClass("tau-boardclipboard__action-clear-selected",$selected.length>0)},"bus $removeAction.ready + $selectable.ready + dataSpace:last":function(evt,$action,$selectable,dataSpace){var handler=_.bind(function($selectable,$action){var $selected=$selectable.tauSelectable("getSelected");$action.toggleClass("tau-boardclipboard__action-remove-selected",$selected.length>0)},this,$selectable,$action),success=_.bind(function(cards){this.fire("cards.readyToRemove",cards)},this);$action.tauConfirm({onShow:function(){var $selected=$selectable.tauSelectable("getSelected");$selected.length==0&&($selected=$selectable.find(".i-role-card"));var cards=[];$selected.each(function(){cards.push($(this).data())});var plural=function(word,count){return count>1&&(word=word.replace(/y$/,"ie")+"s"),word},messages=[],groupCards=_.groupBy(cards,function(item){return item.entityType});_.forEach(groupCards,function(value,key){var entityName=_.find(dataSpace.cells.items,function(item){return item.id==key}).name;messages.push(value.length+" "+plural(entityName,value.length))});var confirmMessage="<h3>Are you sure you want to delete "+messages.join(", ")+"?</h3>";$action.tauConfirm("option",{content:confirmMessage,callbacks:{success:function(){success(cards)}}})},zIndex:130}),$selectable.bind("tauselectablechanged",_.debounce(handler,400))},"bus $el.ready:last + $selectable.ready:last + cards.readyToRemove.after":function(evt,$el,$selectable,cards){var self=this,cardsToSelect=cards.failure,$cards=$el.find(".i-role-card"),$failed=$();_.forEach(cardsToSelect,function(card){$failed=$failed.add($cards.filter("[data-_id="+card._id+"]"))}),self._animateWithClass($failed,"tau-card_failed")},"bus $removeAction.ready:last+$selectable.ready:last+cards.ready":function(evt,$clearAction,$selectable){var $selected=$selectable.tauSelectable("getSelected");$clearAction.toggleClass("tau-boardclipboard__action-remove-selected",$selected.length>0)},"bus $collapseAction.ready":function(evt,$action){$action.on("click",_.bind(function($action){this.fire("collapseState.set",$action.hasClass("tau-collapsed"))},this,$action))},"bus $collapseAction.ready:last+collapseState.updated":function(evt,$action,state){$action.toggleClass("tau-collapsed",state=="collapsed")},_animateWithClass:function($el,className){$el.removeClass(className),$el.addClass(className);var timeout=parseFloat($el.css("MozAnimationDuration")||$el.css("WebkitAnimationDuration")||1,10)*parseFloat($el.css("MozAnimationIterationCount")||$el.css("WebkitAnimationIterationCount")||1,10)*1e3;_.delay(_.bind(function(){this.removeClass(className)},$el),timeout)}})});
define('tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.selection',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(ev,$el){$el.tauSelectable({items:".i-role-card",className:"tau-boardclipboard__item_selected_true",ctrl:!0});var self=this;self.fire("$selectable.ready",$el)}})});
define('tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.dragndrop',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready + $sortable.ready":function(evt,configurator,$sortable){configurator.getGlobalBus().on("isPrioritizable.ready",function(e,isPrioritizable){$sortable.tauSortable("option","moveInGroup",isPrioritizable)})},"bus $el.ready+$selectable.ready+view.dom.ready":function(ev,$el,$selectable,dom){var self=this,$sortable=$el,$containment=$el.parents("[role=main]:first");$sortable.tauSortable({groups:".tau-boardclipboard__holder, .i-role-grid .i-role-cellholder",items:".i-role-card",appendTo:$sortable,containment:$containment,addClasses:!1,useSelectable:$selectable,connectedSortable:".i-role-grid",processToGroup:function($item,$fromGroup,$toGroup){var $targetPlace=$toGroup;$toGroup.is(".i-role-cellholder")&&($targetPlace=$toGroup.children(".i-role-cell")),$targetPlace.data("isempty",!0),$item.appendTo($targetPlace);var countChildren=$targetPlace.children().size();countChildren-=1,countChildren&&$targetPlace.data("isempty",!1)}}),$sortable.bind("tausortablestart",function(event,ui){ui.helper&&ui.helper.find(".i-role-card").removeClass("i-role-card"),ui.items.removeClass("i-role-card"),self.fire("sort.started",[event,ui])}),$sortable.bind("tausortablegroupentered",function(event,ui){self.fire("sort.groupentered",[event,ui])}),$sortable.bind("tausortablegroupleft",function(event,ui){self.fire("sort.groupleft",[event,ui])}),$sortable.bind("tausortablestop",function(event,ui){ui.items.addClass("i-role-card"),self.fire("sort.stopped",[event,ui])}),self.fire("$sortable.ready",$sortable)},"bus $selectable.ready:last+$holder.ready:last+sort.stopped":function(ev,$selectable,$holder,sortData){var event=sortData[0],ui=sortData[1],$group=$(ui.group),self=this;if($group.is($holder))return;var $all=$(ui.items);self.fire("$cards.drag.stop",$all)},"bus $sortable.ready:last+sort.groupentered":function(ev,$sortable,sortData){var ui=sortData[1],$group=ui.group,$helper=ui.helper,$parent=$sortable;$group.parents(".i-role-grid").length&&($parent=$group.parents(".i-role-grid")),$(ui.item).data("draggable").scrollParent=$parent,$(ui.item).data("draggable").overflowOffset=$parent.offset()}})});
define('tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.viewer',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(ev,configurator){var self=this;configurator.getComponentBusRegistry().getByName("board.entityViewer").done(function(viewerBus){self.fire("viewerBus.ready",viewerBus)})},"bus viewerBus.ready + $el.ready":function(ev,viewerBus,$el){$el.delegate(".i-role-card","dblclick",function(e){var cardData=$(e.currentTarget).data();viewerBus.fire("cardDataToShow.ready",cardData)}),$el.delegate(".tau-id","mousedown",function(e){e.stopPropagation()})}})});
define('tau/ui/templates/board.clipboard/ui.template.board.clipboard',["tau/ui/templates/board.plus/ui.template.boardplus.card.skeleton"],function(){var config={name:"board.clipboard",engine:"jqote2",dependencies:["boardplus.card.skeleton"],markup:['<div class="tau-boardclipboard',"<% if (this.cards.length == 0){ %> tau-boardclipboard_empty_true<% } %>"," zoom-level-3 i-view_grid",'">','<div class="tau-boardclipboard__toolbar">','<h3 class="tau-boardclipboard__title"><span role="counter" class="tau-boardclipboard__quantity">',"<%= this.cards.length %>","</span>Selected items</h3>",'<div class="tau-boardclipboard__buttonsgroup tau-boardclipboard__buttonsgroup-third tau-inline-group">','<button class="i-role-collapser tau-v-collapser tau-boardclipboard__collapser" role="collapser"></button>',"</div>",'<div class="tau-boardclipboard__buttonsgroup tau-boardclipboard__buttonsgroup-second tau-inline-group">','<button class="tau-btn tau-boardclipboard__action-clear" role="action_clear" data-label-clearall="Clear All" data-label-clearselected="Clear Selected"></button>',"</div>",'<div class="tau-boardclipboard__buttonsgroup tau-boardclipboard__buttonsgroup-first tau-inline-group">','<button class="tau-btn tau-boardclipboard__action-remove" role="action_remove" data-label-removeall="Delete All" data-label-removeselected="Delete Selected" data-confirmation="Are you sure?" ></button>',"</div>","</div>",'<div role="holder" class="tau-boardclipboard__holder" id="clipboard_holder_<%= _.uniqueId() %>" >',"<% _.forEach(this.cards, function(data){ %>",'<%= fn.sub("boardplus.card.skeleton", data) %>',"<% }); %>","</div>","</div>"]};return config});
define('tau/components/component.board.clipboard',["Underscore","tau/components/component.creator","tau/models/board.clipboard/model.board.clipboard.main","tau/models/board.clipboard/model.board.clipboard.data","tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.output","tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.actions","tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.selection","tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.dragndrop","tau/ui/extensions/board.clipboard/ui.extension.board.clipboard.viewer","tau/components/extensions/error/extension.errorBar","tau/ui/templates/board.clipboard/ui.template.board.clipboard"],function(_,ComponentCreator,Model,ModelData,ExtensionOutput,ExtensionActions,ExtensionSelection,ExtensionDragndrop,ExtensionViewer,ExtensionErrorNotifier,Template){return{create:function(config){var creatorConfig={extensions:[Model,ModelData,ExtensionOutput,ExtensionActions,ExtensionSelection,ExtensionDragndrop,ExtensionViewer,ExtensionErrorNotifier],template:Template};config["queue.bus"]=!0;var componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/ui/extensions/board.editor/ui.extension.board.clone',["Underscore","tau/core/extension.base.stateful"],function(_,ExtensionBase){return ExtensionBase.extend({"bus boardSettings.ready:last + command.clone":function(e,bsDependency){var self=this,configurator=this.config.context.configurator,bs=bsDependency.boardSettings;bs.get({callback:function(r){var cloned=configurator.getBoardDefinitionFactory().cloneDefinition(r),storage=configurator.getRestStorage();storage.data(cloned.groupName,cloned.id,{scope:"Public",publicData:cloned,userData:{menuIsVisible:1}}).done(function(res){cloned.id=res.data.key,self.navigateToCloned(configurator,cloned)})}})},"bus afterRender":function(e){this.createTooltip(e.data.element.find(".i-role-clone-trigger"),"Clone this board with all settings")},createTooltip:function(button,content){button.tauBubble({content:content,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),zIndex:999,className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mouseleave",mode:"tooltip",onPositionConfig:function(config){return config.at="center top",config.my="center bottom",config.offset="0 0",config},onShow:function(){this.adjustPosition()}})},navigateToCloned:function(configurator,clonedDefinition){var hash=configurator.getUrlBuilder().getRelativeBoardUrl(clonedDefinition.id);configurator.getRouting().redirect(hash)}})});
define('tau/components/component.board.clone',["Underscore","tau/components/component.creator","tau/ui/extensions/board.editor/ui.extension.board.clone"],function(_,ComponentCreator,Extension){return{create:function(config){var creatorConfig={extensions:[Extension],template:{engine:"jqote2",markup:['<span class="tau-inline-group tau-board-clone">','<button class="tau-btn tau-clone i-role-clone-trigger">Clone</button>',"</span>"]}};config["queue.bus"]=!0;var componentBus=ComponentCreator.create(creatorConfig,config);return componentBus.on("afterInit",function(e){e.sender.fire("dataBind",{})}),componentBus.on("afterRender",function(e){var $node=e.data.element;$node.on("click",".i-role-clone-trigger",function(){e.sender.fire("command.clone")})}),componentBus}}});
define('tau/models/model.board.collapser.aside',["Underscore","tau/core/model-base"],function(_,BaseModel){var Model=BaseModel.extend({configFieldName:"collapser_aside_collapsed","bus afterInit":function(evt){var configurator=evt.data.config.context.configurator,settingsManager=configurator.getSettingsManager(),configFieldName=this.configFieldName,self=this;settingsManager.get({fields:[configFieldName],callback:function(result){self.fire("dataBind",{isCollapsed:!!result[configFieldName]})}})},"bus afterInit:last+collapser.switched":function(evt){var settingsManager=_.values(evt)[0].data.config.context.configurator.getSettingsManager(),configFieldName=this.configFieldName,self=this;settingsManager.get({fields:[configFieldName],callback:function(result){var set={};set[configFieldName]=!result[configFieldName],settingsManager.set({set:set,callback:function(result){}})}})}});return Model});
define('tau/ui/extensions/board.collapser.aside/ui.extension.board.collapser.aside',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,self=this;$element.delegate("[role=collapser]","click",function(){$(this).toggleClass("tau-collapsed"),self.fire("collapser.switched",{})})}})});
define('tau/ui/templates/board.collapser.aside/ui.template.board.collapser.aside',["tau/core/templates-factory","tau/nls/translator"],function(templates,T){var config={name:"board.collapser.aside",engine:"jqote2",markup:['<div class="tau-pane-collapser">','<button type="button" role="collapser" data-title="'+T("Hide&nbsp;menu")+'" data-title-collapsed="'+T("Show&nbsp;menu")+'" class="tau-extension-board-tooltip tau-h-collapser<% if (this.isCollapsed){ %> tau-collapsed<% } %>">',"</button>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.collapser.aside',["Underscore","tau/components/component.creator","tau/models/model.board.collapser.aside","tau/ui/extensions/board.collapser.aside/ui.extension.board.collapser.aside","tau/ui/templates/board.collapser.aside/ui.template.board.collapser.aside","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip"],function(_,ComponentCreator,ExtensionCollapse,Model,Template,ExtensionTooltip){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionCollapse,ExtensionTooltip],template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/views/view.board.container',["Underscore","jQuery","tau/views/view.container"],function(_,$,ViewBase){return ViewBase.extend({"bus initialize":function(evt){},"bus initialize+boardSettings.ready":function(evt){this.startLifeCycle(_.values(evt)[0],_.values(evt)[1].data.boardSettings)},"bus append.child.element":function(evt){},"bus refresh":function(){this.destroyChildren(),this.startLifeCycle()},startLifeCycle:function(evt,boardSettings){boardSettings=boardSettings||this.boardSettings;var self=this;self.setDefaultConfig(),_.extend(self.config,(evt||{}).data),self.boardSettings=boardSettings;var children=self.config.children;self.children=[],boardSettings.get({fields:["viewMode"],callback:function(r){var viewMode=r.viewMode,strategy={board:{componentType:"board.plus"},list:{componentType:"board.plus.list"},newlist:{componentType:"board.plus.newlist"},timeline:{componentType:"board.plus.timeline"}};_.forEach(self.config.children,function(v,k){v.name=="board_plus"&&(self.config.children[k].type=strategy[viewMode].componentType)}),self.fire("beforeInit",{config:self.config});var loadDependencies=_.isArray(children)&&_.size(children)>0&&self.config.visible;if(loadDependencies){var components=self.config.children,context=self.config.context||{};self.fire("createComponents",{components:components,context:context})}else self.completeInitializationWithoutChildren()}})}})});
define('tau/components/component.board.container',["Underscore","tau/components/component.container","tau/ui/extensions/board.container/ui.extension.board.container.events","tau/views/view.board.container"],function(_,ComponentContainer,BoardContainerExtension,View){return{create:function(config){var creatorConfig={extensions:[BoardContainerExtension].concat(config.extensions||[]),ViewType:config.ViewType||View};return ComponentContainer.create(_.extend(config,creatorConfig))}}});
define('tau/models/board.context.filter/model.board.context.filter.data',["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,BaseModel,configFactory){var list={};return BaseModel.extend({"bus beforeInit":function(evt){var configurator=evt.data.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("acidStore.ready",configurator.getAppStateStore()),this.fire("store.ready",configurator.getStore()),this.fire("contextStore.ready",configurator.getApplicationContextService()),this.fire("fire.ready",_.bind(this.fire,this))},"bus configurator.ready:last + acid.ready":function(evt,configurator,acid){configurator.getStateManager().unbind(list);var self=this;configurator.getStateManager().bind({paramId:"appConfig",fieldName:"acid",listener:list,callback:function(res){var newAcid=res.value;acid!=newAcid&&self.fire("refresh")}})},"bus fire.ready:last + acidStore.ready":function(evt,fire,acidStore){acidStore.get({fields:["acid"],callback:function(result){fire("acid.ready",result.acid)}}),acidStore.unbind({listener:this}),acidStore.bind({fields:["acid"],listener:this,callback:function(result){fire("refresh")}})},"bus fire.ready:last + store.ready":function(evt,fire,store){store.get("project",{fields:["id","name","color","isActive"]}).done(function(result){var projects=_.filter(result[0].data,function(v){return v.isActive});fire("projects.ready",projects)}),store.get("team",{fields:["id","name","icon"]}).done(function(result){var teams=result[0].data;fire("teams.ready",teams)}),store.get("process",{fields:["id","name","isDefault"]}).done(function(result){fire("processes.ready",_.sortBy(result[0].data,function(v){return v.name.toLowerCase()}))})},"bus fire.ready:last + contextStore.ready":function(evt,fire,contextStore){contextStore.removeAllListeners(this),contextStore.on("refreshChoice.after",function(){fire("refresh")},this)},"bus fire.ready:last + contextStore.ready:last + acid.ready":function(evt,fire,contextStore,acid){contextStore.getApplicationContext({acid:acid},{success:function(context){fire("context.ready",context)},failure:function(){fire("context.ready",{appContext:{teamContext:{},projectContext:{}}})}})},"bus fire.ready:last + contextStore.ready:last + model.setFilter":function(evt,fire,contextStore,state){var selectedProjectsIds=state.selectedProjectsIds,selectedTeamsIds=state.selectedTeamsIds;if(this._selectedCache&&_.isEqual(this._selectedCache.teams,selectedTeamsIds)&&_.isEqual(this._selectedCache.projects,selectedProjectsIds))return;var config={projectIds:selectedProjectsIds.length?_.map(selectedProjectsIds,function(id){return id==-1?"null":id}):"*",teamIds:selectedTeamsIds.length?_.map(selectedTeamsIds,function(id){return id==-1?"null":id}):"*"};contextStore.getApplicationContext(config,{success:function(context){fire("context.changed",context),fire("application.context.data.changed",{teams:selectedTeamsIds,projects:selectedProjectsIds})}})},"bus acidStore.ready:last + context.changed":function(evt,acidStore,context){acidStore.set({set:{acid:context.acid}})},"bus fire.ready:last + processes.ready + teams.ready + projects.ready + context.ready":function(evt,fire,processes,teams,projects,context){var teamContext=context.appContext.teamContext;teamContext.items=context.selectedTeams;var processedTeams=this._process(teams,teamContext,"No team","Any Team"),projectContext=context.appContext.projectContext;projectContext.items=context.selectedProjects;var processedProjects=this._process(projects,projectContext,"No project","Any Project"),data={acid:context.acid,teams:processedTeams.list,selectedTeams:processedTeams.selection,selectedTeamsCount:processedTeams.selectionLength,projects:processedProjects.list,selectedProjects:processedProjects.selection,selectedProjectsCount:processedProjects.selectionLength,icons:configFactory.getConfigByType("team").prototype.icons,colors:configFactory.getConfigByType("project").prototype.colors,processes:processes};this._selectedCache={projects:_.pluck(processedProjects.selection,"id"),teams:_.pluck(processedTeams.selection,"id")},fire("dataBind",data),fire("application.context.data",data)},_process:function(items,data,noItemLabel,anyItemLabel){var sortBySelectionAndName=function(item){return(item.id==-1?"0":"1")+(item.selected?"0_":"1_")+item.name.toUpperCase()},noItem={id:-1,name:noItemLabel||"No item"},anyItem={id:-2,name:anyItemLabel||"Any item"},list=items;list.unshift(noItem);var selected=data.items||[];data.no&&selected.unshift(noItem);var selection=[],hasAny=!1;if(selected.length==0)selection=[anyItem],hasAny=!0;else if(selected.length==list.length&&list.length==1)selection=[noItem];else if(selected.length>=list.length)selection=[anyItem],hasAny=!0;else{var intersection=_.filter(list,function(item){return _.indexOf(_.pluck(selected,"id"),item.id)>=0});intersection.length==0?selection=[noItem]:selection=intersection}selection=_.sortBy(selection,sortBySelectionAndName);var selectionIds=_.pluck(selection,"id");list=_.chain(list).map(function(item){return{id:item.id,name:item.name,icon:item.icon,color:item.color,selected:!hasAny&&_.indexOf(selectionIds,item.id)>=0,isSupportView:item.id>0}}).sortBy(sortBySelectionAndName).value();var selectionLength=selection.length,selectionShow=selection.slice(0,2);return{list:list,selection:selection,selectionLength:selectionLength,selectionShow:selectionShow}}})});
define('tau/libs/inviter/inviter',["Underscore","tau/core/class"],function(_,Class){return Class.extend({init:function(configurator){this.store=configurator.getStore()},invite:function(members){var self=this,store=this.store,fs=[];fs=_.map(members,function(user){return function(next){user.id?next(!1,{success:user.id}):store.find("user",{$query:{email:user.email,deleteDate:{$isNull:!0}},fields:["id","firstName","lastName"]}).done(function(res){var fuser=res[0].data.length?res[0].data[0]:null;fuser?next(!1,{success:fuser.id}):store.save("user",{failureGlobal:!1,$set:{login:user.login,email:user.email,password:Math.round(Math.random()*1e11)}},{success:function(res){next(!1,{success:res.data.id})},failure:function(res){next(!1,{failure:user})}}).done()})}});var def=$.Deferred();return _.series(fs,function(err,res){err?def.failure(err):def.resolve(res)}),def}})});
define('tau/models/board.context.filter/model.board.context.filter.add.project',["Underscore","tau/core/extension.base","tau/libs/inviter/inviter"],function(_,BaseModel,Inviter){return BaseModel.extend({"bus configurator.ready:last + project.add.ready":function(evt,configurator,projectData){var self=this,store=configurator.getStore();store.save("project",{failureGlobal:!1,$set:{name:_.trim(projectData.name),color:_.trim(_.asString(projectData.color))||null,process:{id:projectData.process}}},{success:function(result){self.fire("project.saved",result.data)},failure:function(result){self.fire("project.add.failure",result.data.response.Message)}}).done();var inviter=new Inviter(configurator);inviter.invite(projectData.members).done(function(members){self.fire("projectMembers.saved",members)})},"bus configurator.ready:last + project.add.ready + project.saved + projectMembers.saved":function(evt,configurator,projectData,project,members){var self=this,store=configurator.getStore(),successed=_.compact(_.pluck(members,"success")),failed=_.compact(_.pluck(members,"failure"));if(failed.length){var message="Can't assign users.";this.fire("project.add.nonFatalFailure",message)}successed=_.filter(successed,function(id){return id!=configurator.getLoggedUser().id});var set={projectMembers:_.map(successed,function(id){return{user:{id:id}}})};store.save("project",{id:project.id,$set:set,fields:["id","name","color",{projectMembers:[{user:["id","firstName","lastName","avatarUri"]},{role:["id","name"]}]}]}).done(function(res){self.fire("projectMembers.connected",res[0].data)})},"bus project.saved + projectMembers.saved + projectMembers.connected":function(evt,projectSimple,members,projectFull){this.fire("project.add.success",projectFull)}})});
define('tau/models/board.context.filter/model.board.context.filter.add.team',["Underscore","tau/core/extension.base","tau/libs/inviter/inviter"],function(_,BaseModel,Inviter){return BaseModel.extend({"bus configurator.ready:last + team.add.ready":function(evt,configurator,teamData){var self=this,store=configurator.getStore();store.save("team",{failureGlobal:!1,$set:{name:_.trim(teamData.name),icon:_.trim(_.asString(teamData.icon))||null}},{success:function(result){self.fire("team.saved",result.data)},failure:function(result){self.fire("team.add.failure",result.data.response.Message)}}).done();var inviter=new Inviter(configurator);inviter.invite(teamData.members).done(function(members){self.fire("teamMembers.saved",members)})},"bus configurator.ready:last + team.add.ready + team.saved + teamMembers.saved":function(evt,configurator,teamData,team,members){var self=this,store=configurator.getStore(),successed=_.compact(_.pluck(members,"success")),failed=_.compact(_.pluck(members,"failure"));if(failed.length){var message="Can't assign users.";this.fire("team.add.nonFatalFailure",message)}successed=_.filter(successed,function(id){return id!=configurator.getLoggedUser().id});var set={teamMembers:_.map(successed,function(id){return{user:{id:id}}})};store.save("team",{id:team.id,$set:set,fields:["id","name","icon",{teamMembers:[{user:["id","firstName","lastName","avatarUri"]},{role:["id","name"]}]}]}).done(function(res){self.fire("teamMembers.connected",res[0].data)})},"bus team.saved + teamMembers.saved + teamMembers.connected":function(evt,teamSimple,members,teamFull){this.fire("team.add.success",teamFull)}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.main',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){this.fire("$el.ready",renderData.element)},"bus $el.ready":function(evt,$el){var $popover=$el.find(".i-role-popupcontent"),self=this,$submitButton=$popover.find(".i-role-action-submit");self.fire("$submitButton.ready",$submitButton),$submitButton.on("click",function(){self.fire("filter.submitted")}),$popover.detach(),$el.tauBubble({dontCloseSelectors:[".ui-autocomplete"],content:$popover,zIndex:999,template:['<div class="tau-bubble-board tau-teams-projects-manager-wrapper">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),onShow:function(){self.fire("$popup.shown",$popover)},onHide:function(){self.fire("$popup.hidden",$popover)},onArrowPositionConfig:function(config){return config.at="left bottom",config.offset="26 0",config},onResize:function($popup,data){var h=data.height;$popup.find(".i-role-list").css({maxHeight:h-$popup.find(".tau-teams-projects-search").height()-$popup.find(".tau-teams-projects-updater").height()-300,overflowY:"auto"})}}),$(window).resize(_.throttle(function(){$el.tauBubble("adjustSize")},100)),this.fire("$bubbled.ready",$el),this.fire("$popup.ready",$popover)},"bus $popup.ready":function(evt,$el){this.fire("$teamSection.ready",$el.find(".tau-teams")),this.fire("$projectSection.ready",$el.find(".tau-projects")),this.fire("$sections.ready",$el.find(".tau-teams, .tau-projects")),this.fire("$assignSection.ready",$el.find(".tau-teams-projects-updater"))},"bus $bubbled.ready:last + $sections.ready":function(evt,$bubbled,$el){var self=this;$el.on("click",".i-role-selecttrigger",function(e){e.stopPropagation(),e.stopImmediatePropagation();var item=$(e.currentTarget).data();$bubbled.tauBubble("option","onHide",$.noop),$bubbled.tauBubble("hide");var teams=item.entityType=="team"?[item.entityId]:[],projects=item.entityType=="project"?[item.entityId]:[];self.fire("model.setFilter",{selectedTeamsIds:teams,selectedProjectsIds:projects}),$bubbled.tauBubble("option","onHide",function(){self.fire("$popup.hidden",$popup)})})},"bus $bubbled.ready:last + $popup.ready:last + filter.submitted":function(evt,$bubbled,$popup){var self=this;$bubbled.tauBubble("option","onHide",$.noop),$bubbled.tauBubble("hide"),this.fire("model.setFilter",this.getCurrentState($popup)),$bubbled.tauBubble("option","onHide",function(){self.fire("$popup.hidden",$popup)})},"bus $bubbled.ready:last + $popup.ready:last + $popup.hidden":function(evt,$bubbled,$popup){this.fire("model.setFilter",this.getCurrentState($popup))},"bus $assignSection.ready:last + project.add.completed":function(evt,$section){$section.addClass("tau-teams-projects-updater_state_enabled")},"bus $assignSection.ready:last + team.add.completed":function(evt,$section){$section.addClass("tau-teams-projects-updater_state_enabled")},"bus $sections.ready + $submitButton.ready":function(evt,$sections,$submitButton){$sections.on("change",":checkbox",function(){$submitButton.hasClass("tau-teams-projects-submit_highlighted_true")||$submitButton.animateWithCss({cssClassName:"tau-teams-projects-submit_highlighted_true"})})},getCurrentState:function($list){var data={},$checked=$list.find(".tau-teams .i-role-list :checked");return data.selectedTeamsIds=$checked.map(function(){return parseInt(this.value,10)}).toArray(),$checked=$list.find(".tau-projects .i-role-list :checked"),data.selectedProjectsIds=$checked.map(function(){return parseInt(this.value,10)}).toArray(),data}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $popup.ready":function(evt,$el){var self=this;$el.delegate("input[name=filter]","keyup",function(){self.fire("filter.changed",$(this).val())}),$el.delegate("input[name=filter]","keydown",function(e){e.keyCode==$.ui.keyCode.ESCAPE&&e.stopPropagation(),e.which==$.ui.keyCode.ENTER&&$(this).trigger("blur")})},match:function(source,filter){var index=source.toLowerCase();return filter.length==0||_.any(filter,function(v){return index.indexOf(v)>=0})},"bus $sections.ready:last + filter.changed":function(evt,$sections,text){var filterIndex=_.trim(text).toLowerCase().split(/\s+/g),match=this.match;$sections.each(function(){var $section=$(this),$list=$section.find(".i-role-list"),$items=$list.find(".i-role-item"),found=0;$items.each(function(){var $item=$(this),itemText=$item.text(),matched=match(itemText,filterIndex);matched&&(found+=1),$item.toggleClass("tau-category-items-selector__item_filtered_false",!matched)}),$section.toggleClass("tau-managed-category_filtered_none",found==0)}),this.fire("filter.completed")},"bus $teamSection.ready:last + team.add.completed":function(evt,$section){$section.removeClass("tau-managed-category_filtered_none")},"bus $projectSection.ready:last + project.add.completed":function(evt,$section){$section.removeClass("tau-managed-category_filtered_none")}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $sections.ready":function(evt,$sections){$sections.each(function(){var $section=$(this),$chAll=$section.find("header :checkbox");$chAll.on("change",function(){$section.find(".i-role-list .i-role-item:visible :checkbox").prop("checked",$chAll.prop("checked"))});var _sync=function(){var $allCh=$section.find(".i-role-list .i-role-item:visible"),$nonCh=$allCh.find(":checkbox").not(":checked");$chAll.prop("checked",$nonCh.length==0&&$allCh.length)};$section.on("change",".i-role-list .i-role-item",_sync),$section.on("synccheckboxes",_sync)})},"bus $sections.ready:last + filter.completed":function(evt,$sections){$sections.trigger("synccheckboxes")},"bus $sections.ready:last + team.add.completed":function(evt,$sections){$sections.trigger("synccheckboxes")},"bus $sections.ready:last + project.add.completed":function(evt,$sections){$sections.trigger("synccheckboxes")},"bus $sections.ready:last + $popup.shown":function(evt,$sections){$sections.trigger("synccheckboxes")},"bus $sections.changed":function(e,changedData){var checkSelected=function(optionsList,data){var changes={};_.each(data,function(item){changes[item.id]=item.selected}),_.each(optionsList.find(".i-role-item :checkbox"),function(checkbox){var $checkbox=$(checkbox),id=$checkbox.val(),currentStatus=$checkbox.prop("checked"),desiredStatus=changes[id];currentStatus!==desiredStatus&&$checkbox.prop("checked",desiredStatus)})};checkSelected(changedData.projects.$optionsList,changedData.projects.data),checkSelected(changedData.teams.$optionsList,changedData.teams.data)}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.abstract',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({_selectText:function($input){$input[0].setSelectionRange(0,$input.val().length)},_initForm:function($section){var $form=$section.find(".i-role-form");return $section.on("click",".i-role-formtrigger",function(){$form.toggleClass("tau-new-item_active_false").toggleClass("tau-new-item_active_true"),$form.find(":submit:first").focus(),$form.find(":text:first").focus(),$section.find(".i-role-formtrigger").toggleClass("tau-active"),$section.toggleClass("tau-managed-category_formactive_true")}),$form.on("reset",function(){$form.find(":input").removeClass("tau-error"),$form.find(":submit:first").focus(),$form.find(":text:first").focus()}),$form.on("click","[type=reset]",function(){$form.addClass("tau-new-item_active_false"),$section.removeClass("tau-managed-category_formactive_true"),$section.find(".i-role-formtrigger").removeClass("tau-active")}),$form},_addSubmitDataListener:function($form,cb){$form.on("submit",function(e){e.preventDefault();var data={};$form.find(":input").each(function(){data[this.name]=this.value}),data.members=[],$form.find(".i-role-members-widget").trigger("process");var $members=$form.find(".i-role-member");$members.each(function(){data.members.push($(this).data())}),cb(data)})},_initRichSelect:function($form,$select){var $rich=$form.find(".i-role-currenticon");return $select.on("change",function(){var current=$select.val();$rich.trigger("change",current),$rich.attr("data-value",current||"default")}),$form.delegate(".i-role-richselect .i-role-option","click",function(){var ic=this.getAttribute("data-value");$select.val(ic),$select.trigger("change"),$form.find(":text:first").focus()}),$rich.parent().on("click",function(){$(this).toggleClass("tau-active"),$form.find(".i-role-richselect").toggle()}),$form.on("reset",function(){$select.val(""),$select.trigger("change")}),$rich},_addToList:function($section,template,data){data.selected=!0,data.isSupportView=!0;var $item=template.bind({},data),$form=$section.find(".i-role-form"),$list=$section.find(".i-role-list"),$f=$list.find(".i-role-item:first");$f.length?$f.after($item):$list.append($item),$list.parent().scrollTo(0,{duration:500}),$item.addClass("tau-added"),_.delay(function(){$item.removeClass("tau-added")},1500)}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.project',["Underscore","jQuery","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.abstract"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $projectSection.ready":function(evt,$section){var self=this,$form=this._initForm($section);this._addSubmitDataListener($form,function(data){self.fire("project.add.ready",data)});var $select=$form.find("select[name=color]"),$rich=this._initRichSelect($form,$select);$rich.on("change",function(evt,data){$rich.css("background-color",data)})},"bus configurator.ready:last + $projectSection.ready:last + project.add.success":function(evt,configurator,$section,data){this._addToList($section,configurator.getTemplateFactory().get("board.context.filter.projects.list"),data),$section.find("form").trigger("reset"),$section.removeClass("tau-managed-category_isempty_true"),this.fire("project.add.completed")},"bus $projectSection.ready:last + project.add.failure":function(evt,$section,error){$section.find(".i-role-form :text:first").focus().select().addClass("tau-error"),this.fire("error",error)},"bus $projectSection.ready:last + project.add.nonFatalFailure":function(evt,$section,error){this.fire("error",error)}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.team',["Underscore","jQuery","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.abstract"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $teamSection.ready":function(evt,$section){var self=this,$form=this._initForm($section);this._addSubmitDataListener($form,function(data){self.fire("team.add.ready",data)});var $select=$form.find("select"),$rich=this._initRichSelect($form,$select);$rich.on("change",function(evt,data){var prev=$rich.attr("data-value");$rich.removeClass("tau-icon_name_"+prev),$rich.addClass("tau-icon_name_"+(data||"default"))})},"bus configurator.ready:last + $teamSection.ready:last + team.add.success":function(evt,configurator,$section,data){this._addToList($section,configurator.getTemplateFactory().get("board.context.filter.teams.list"),data),$section.find("form").trigger("reset"),$section.removeClass("tau-managed-category_isempty_true"),this.fire("team.add.completed")},"bus $teamSection.ready:last + team.add.failure":function(evt,$section,error){$section.find(".i-role-form :text:first").focus().select().addClass("tau-error"),this.fire("error",error)},"bus $teamSection.ready:last + team.add.nonFatalFailure":function(evt,$section,error){this.fire("error",error)}})});
define('tau/ui/extensions/inviter/ui.extension.inviter.widget.abstract',["Underscore","jQuery","tau/core/extension.base","tau/utils/utils.constants","tau/libs/store2/store2"],function(_,$,ExtensionBase,Constants,Store2){return ExtensionBase.extend({_initTemplates:function(configurator){var templateFactory=configurator.getTemplateFactory();templateFactory.register({name:"board.context.filter.members-wiget.autocompleteItem",engine:"jqote2",markup:["<li>",'<a class="tau-item">','<img width="20" height="20" alt="" src="<%= this.avatarUri%>20" />',"<span><%! this.name %></span>","</a>","</li>"]}),templateFactory.register({name:"board.context.filter.members-wiget.selectedItem",engine:"jqote2",markup:["<li class=\"tau-user tau-user-<%! this.type || 'existing' %> i-role-member\">","<% if (this.avatarUri){ %>",'<img width="20" height="20" alt="" src="<%= this.avatarUri%>20" />',"<% } %>","<span><%! this.name %></span>",'<i class="tau-delete i-role-action-delete"></i>',"</li>"]}),templateFactory.register({name:"board.context.filter.members-wiget.popupContent",engine:"jqote2",markup:["<span><%! this.main %></span>",'<div class="tau-message <%! this.type %>"><%! this.sub %></div>']})},_initWidget:function(configurator,$form,entityRestriction){entityRestriction=entityRestriction||"";var templateFactory=configurator.getTemplateFactory(),bt=function(name,data){return templateFactory.get(name).bind({},data)},autocompleteItem=function(item){return item.name=item.name?item.name:_.trim(item.firstName+" "+item.lastName),bt("board.context.filter.members-wiget.autocompleteItem",item)},selectedItem=function(item){return item.name=item.name?item.name:_.trim(item.firstName+" "+item.lastName),item.name||(item.name=item.email),bt("board.context.filter.members-wiget.selectedItem",item)},isEmail=function(val){return val.match(Constants.get("emailRegexp"))},position={offset:"0 15",my:"left top",at:"left bottom",collision:"none"},$widget=$form.find(".i-role-members-widget"),$inp=$widget.find(".i-role-input"),$inpLi=$inp.closest("li"),$helper=$widget.find(".i-role-systemhelper"),$sizer=$widget.find(".i-role-sizer"),$placeholder=$widget.find(".i-role-placeholder"),$bubbled=$widget.tauBubble({template:['<div class="tau-invite-widget-tooltip">','    <div class="i-role-content" role="content">',"    </div>","</div>"].join(""),stackName:"members-widget",showEvent:"nothing",hideEvent:"nothing",onPositionConfig:function(c){return _.extend(c,position)}}),showMessage=function(data){var $content=bt("board.context.filter.members-wiget.popupContent",data);$bubbled.tauBubble("option","content",$content),$bubbled.tauBubble("option","alignTo",$inp),$bubbled.tauBubble("show")},hideMessage=function(){$bubbled.tauBubble("hide")},split=function(val){return _.compact(_.trim(val).split(/[\s,]+/))},resultBubble=function(term){var t=_.last(split(term)),conf;t&&t.length>2?(isEmail(t)?conf={main:"The invitation will be sent to",sub:t,type:"tau-valid"}:conf={main:"There's no one with this name. Please, enter the email address of the person you want to invite.",sub:t+" is invalid email",type:"tau-error"},showMessage(conf)):hideMessage()},refreshHelper=function(helperVal){helperVal=helperVal||helperVal===""?helperVal:$helper.text().toLowerCase();var inpVal=$inp.val().toLowerCase();if(inpVal&&_.startsWith(helperVal.toLowerCase(),inpVal)){var addVal=helperVal.slice(inpVal.length);$helper.find("s").text(inpVal),$helper.find("span").text(addVal)}else emptyHelper()},emptyHelper=function(){$helper.find("s").text(""),$helper.find("span").text("")},removeDuplicates=function(){var d=[],$ms=$widget.find(".i-role-member");$ms.each(function(k,v){d.push(_.extend($(this).data(),{_id:k}))}),_.forEach(_.groupBy(d,"email"),function(v){_.forEach(_.rest(v),function(vv){$ms.eq(vv._id).remove()})})},getName=function(item){return _.trim(_.asString(item.firstName)+" "+_.asString(item.lastName))||_.trim(item.email)},getHash=function(item){return _.trim(_.asString(item.id)+" "+_.asString(item.email))},syncSize=function(){var maxWidth=$widget.width()-10;$sizer.text($inp.val());var textWidth=$sizer.width();if(textWidth<=$inp.width()-8)return;var left=$inp[0].getBoundingClientRect().left,maxLineWidth=maxWidth-left,w=maxLineWidth;textWidth<maxWidth&&(textWidth<maxLineWidth?w=maxLineWidth:w=maxWidth),$inp.width()!=w&&$inp.width(w)},resetSize=function(){$inp.width("10")},processInput=function(){var val=_.trim($inp.val()),vals=split(val),wrongs=[],$ms=$widget.find(".i-role-member"),d=[];$ms.each(function(k,v){d.push($(this).data("email"))}),_.forEach(vals,function(val){if(isEmail(val)){var item={id:null,email:val,firstName:null,lastName:null,login:val,type:"invited",state:"notconfirmed"};item.name=getName(item),item.hash=getHash(item);if(_.indexOf(d,item.email)==-1){var $li=selectedItem(item).data(item);$inpLi.before($li)}}else wrongs.push(val)}),$inp.val(wrongs.join(" ")),$inp.focus(),emptyHelper(),hideMessage()},getRealIds=function(){var $ms=$widget.find(".i-role-member"),d=[];return $ms.each(function(k,v){d.push($(this).data("id"))}),_.compact(d)};$widget.on("click",function(){$inp.focus()}),$widget.on("click",".i-role-action-delete",function(){$(this).closest("li").remove()}),$inp.on("input",function(){$placeholder.hide()}),$inp.focusin(function(){hideMessage()}),$inp.focusout(function(){$inp.val()==""&&$widget.find(".i-role-member").length==0&&$placeholder.show()}),$inp.on("keydown",function(e){var name="";switch(e.which){case $.ui.keyCode.ESCAPE:if($helper.text()!=="")return e.stopPropagation(),e.preventDefault(),!1;break;case $.ui.keyCode.ENTER:name="enter";if($inp.val()==="")return;e.stopPropagation(),e.preventDefault();break;case $.ui.keyCode.BACKSPACE:name="backspace";break;case $.ui.keyCode.SPACE:name="whitespace"}if(name){$inp.trigger("keydown:"+name,e);if(name=="enter")return!1}}),$inp.on("keydown:enter",function(){processInput(),resetSize()}),$inp.on("keydown:whitespace",function(){processInput(),$inp.autocomplete("close"),hideMessage()}),$inp.on("keydown:backspace",function(){$inp.val().length==0&&($inp.closest("li").prev().remove(),resetSize()),hideMessage()}),$inp.on("keyup",function(){refreshHelper(),syncSize()}),$inp.on("paste",function(){setTimeout(function(){processInput(),syncSize()},1)}),$widget.on("process",processInput);var store2=new Store2(configurator);$inp.autocomplete({minLength:2,autoFocus:!0,position:position,source:function(request,next){var term=request.term;if(_.last(term)==" ")return;term=_.last(split(term)),store2.findAll("User?select={"+["id",'"User" as __type',"firstName","lastName","email","login","avatarUri"].join(",")+"}&where=("+' (firstName.startsWith("'+store2.arg(term)+'") '+' OR lastName.startsWith("'+store2.arg(term)+'") '+' OR email.startsWith("'+store2.arg(term)+'")'+") "+entityRestriction+" AND deleteDate == NULL AND isActive == True )").done(function(items){if(items.length){$bubbled.tauBubble("hide"),items=_.map(items,function(v){return v.name=getName(v),v.hash=getHash(v),v}),items=_.sortBy(items,function(v){return(_.startsWith(v.name.toLowerCase(),term.toLowerCase())?"0":"1")+v.name});var realIds=getRealIds();items=_.reject(items,function(item){return _.contains(realIds,item.id)})}else $inp.autocomplete("close"),resultBubble(term);next(items)}).fail(function(){})},focus:function(e,ui){var item=ui.item;return refreshHelper(getName(item)),!1},select:function(event,ui){var item=ui.item,$li=selectedItem(item).data(item);return $inpLi.before($li),$inp.val(""),emptyHelper(),hideMessage(),removeDuplicates(),event.stopPropagation(),!1},close:function(){emptyHelper()}}),$inp.data("autocomplete")._renderItem=function(ul,item){return autocompleteItem(item).data("item.autocomplete",item).appendTo(ul)},$inp.data("autocomplete")._renderMenu=function(ul,items){$(ul).addClass("tau-existing-user-tooltip").css("maxHeight",$(window).height()*.5);var that=this;$.each(items,function(index,item){that._renderItem(ul,item)})},$inp.data("autocomplete").menu.element.bind("menublur",function(){emptyHelper()}),$form.on("reset",function(){setTimeout(function(){var $members=$form.find(".i-role-member");$members.remove()},1)})}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.members-widget',["Underscore","jQuery","tau/ui/extensions/inviter/ui.extension.inviter.widget.abstract"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(evt,configurator){this._initTemplates(configurator)},"bus configurator.ready + $teamSection.ready":function(evt,configurator,$section){$section.length&&this._initWidget(configurator,$section)},"bus configurator.ready + $projectSection.ready":function(evt,configurator,$section){$section.length&&this._initWidget(configurator,$section)}})});
define('tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.viewer',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(ev,configurator){var self=this;configurator.getComponentBusRegistry().getByName("board.entityViewer").done(function(viewerBus){self.fire("viewerBus.ready",viewerBus)})},"bus viewerBus.ready + $sections.ready":function(ev,viewerBus,$el){$el.on("click",".i-role-viewtrigger",function(e){e.stopPropagation(),e.stopImmediatePropagation();var cardData=$(e.currentTarget).data();viewerBus.fire("cardDataToShow.ready",cardData)})}})});
define('tau/ui/templates/board.context.filter/ui.template.board.context.filter.selected',["tau/core/templates-factory"],function(templates){var config={name:"board.context.filter.selected",engine:"jqote2",markup:["<li>","<span>","<%! this.name %>","</span>","</li>"]};return templates.register(config)});
define('tau/ui/templates/board.context.filter/ui.template.board.context.filter.projects.list',["tau/core/templates-factory"],function(templates){var config={name:"board.context.filter.projects.list",engine:"jqote2",markup:['<li class="i-role-item">','<label class="tau-checkbox  <% if (this.id == -1){ %>  tau-null-selector <% } %>">','<input type="checkbox" id="content_filter_project_<%= this.id %>" value="<%= this.id %>"',"<% if (this.selected){ %>"," checked","<% } %> ","/>","<i></i>",'<span class="tau-checkbox-label">',"<% if (this.color){ %>",'<i class="tau-icon tau-icon_type_color" style="background-color: <%= this.color %>"></i>',"<%} else { %>",'<i class="tau-icon"></i>',"<% } %>","<%! this.name %>","</span>","</label>","<% if (this.isSupportView){ %>",'<i title="Apply project" class="tau-category-items-selector__selecttrigger tau-icon tau-icon_type_svg tau-icon_name_aim i-role-selecttrigger" data-entity-id="<%! this.id %>" data-entity-type="project"></i>','<i title="Open project in popup" class="tau-category-items-selector__viewtrigger tau-icon tau-icon_type_svg tau-icon_name_newwindow i-role-viewtrigger" data-entity-id="<%! this.id %>" data-entity-type="project"></i>',"<% } %>","</li>"]};return templates.register(config)});
define('tau/ui/templates/inviter/ui.template.inviter.widget.members',["tau/core/templates-factory"],function(templates){var config={name:"inviter.widget.members",engine:"jqote2",markup:['<div class="tau-invite-field  i-role-members-widget">','<ul class="tau-invite-field__inner">','<li  class="tau-inputholder">',"<div>",'<input class="tau-input i-role-input" type="text" />','<span class="tau-input-sizer i-role-sizer"></span>','<span class="tau-input-systemhelper i-role-placeholder">Start typing name(s) or email(s)</span>','<span class="tau-input-systemhelper i-role-systemhelper"><s></s><span></span></span>',"</div>","</li>","</ul>","</div>"]};return templates.register(config)});
define('tau/ui/templates/finder.project/ui.template.finder.project.add.form',["tau/core/templates-factory","tau/ui/templates/inviter/ui.template.inviter.widget.members"],function(templates){var config={name:"finder.project.add.form",engine:"jqote2",markup:['<form class="tau-new-item_active_false i-role-form">','<div class="tau-new-entity-form">','<div class="tau-new-entity-info">','<span class="tau-select-team-icon">','<i class="tau-icon tau-icon_type_color tau-icon_name_default i-role-currenticon" data-value="default"></i>',"</span>",'<input name="name" type="text" placeholder="Enter project name here"  class="tau-in-text tau-new-entity-name">','<select name="color" style="display:none;">','<option value=""></option>',"<% _.each(this.colors, function(item){ %>",'<option value="<%= item %>"><%= item %></option>',"<% }); %>","</select>","</div>",'<ul class="tau-teams-icon-list i-role-richselect">','<li><i class="tau-icon tau-i-close i-role-option" data-value=""></i></li>',"<% _.each(this.colors, function(item){ %>",'<li><i class="tau-icon tau-icon_type_color i-role-option" style="background-color:<%= item %>;" data-value="<%= item %>"></i></li>',"<% }); %>","</ul>",'<div class="tau-new-entity-process">','<label><div class="tau-note">Select process</div>','<select class="tau-select" name="process">',"<% _.each(this.processes, function(item){ %>",'<option <% if (item.isDefault){ %>selected<% } %> value="<%= item.id %>"><%! item.name %></option>',"<% }); %>","</select></label>","</div>",'<div class="tau-invite-widget">','<div class="tau-note">Invite people</div>','<%= fn.sub("inviter.widget.members") %>','<div class="tau-invite-footer">','<button class="tau-btn tau-success" type="submit">Create project</button>','<button class="tau-btn" type="reset">Cancel</button>',"</div>","</div>","</div>","</form>"]};return templates.register(config)});
define('tau/ui/templates/board.context.filter/ui.template.board.context.filter.teams.list',["tau/core/templates-factory"],function(factory){return factory.register({name:"board.context.filter.teams.list",engine:"jqote2",markup:['<li class="i-role-item">','<label class="tau-checkbox <% if (this.id == -1){ %>  tau-null-selector <% } %>">','<input type="checkbox" id="content_filter_project_<%= this.id %>" value="<%= this.id %>"',"<% if (this.selected){ %>"," checked","<% } %> ","/>","<i></i>",'<span class="tau-checkbox-label">','<i class="tau-icon tau-icon_type_svg tau-icon_name_<%= this.icon || ""  %>"></i>',"<%! this.name %>","</span>","</label>","<% if (this.isSupportView){ %>",'<i title="Apply team" class="tau-category-items-selector__selecttrigger tau-icon tau-icon_type_svg tau-icon_name_aim i-role-selecttrigger" data-entity-id="<%! this.id %>" data-entity-type="team"></i>','<i  title="Open team in popup" class="tau-category-items-selector__viewtrigger tau-icon tau-icon_type_svg tau-icon_name_newwindow i-role-viewtrigger" data-entity-id="<%! this.id %>" data-entity-type="team"></i>',"<% } %>","</li>"]})});
define('tau/ui/templates/finder.team/ui.template.finder.team.add.form',["tau/core/templates-factory","tau/ui/templates/inviter/ui.template.inviter.widget.members"],function(templates){var config={name:"finder.team.add.form",engine:"jqote2",markup:['<form class="tau-new-item_active_false i-role-form">','<div class="tau-new-entity-form">','<div class="tau-new-entity-info">','<span class="tau-select-team-icon">','<i class="tau-icon tau-icon_type_svg tau-icon_name_default i-role-currenticon" data-value="default"></i>',"</span>",'<input name="name" type="text" placeholder="Enter team name here"  class="tau-in-text tau-new-entity-name">','<select name="icon" style="display:none;">','<option value=""></option>',"<% _.each(this.icons, function(item){ %>",'<option value="<%= item %>"><%= item %></option>',"<% }); %>","</select>","</div>",'<ul class="tau-teams-icon-list i-role-richselect">','<li><i class="tau-icon tau-i-close i-role-option" data-value=""></i></li>',"<% _.each(this.icons, function(item){ %>",'<li><i class="tau-icon tau-icon_type_svg tau-icon_name_<%= item %> i-role-option" data-value="<%= item %>"></i></li>',"<% }); %>","</ul>",'<div class="tau-invite-widget ">','<div class="tau-note">Invite people</div>','<%= fn.sub("inviter.widget.members") %>','<div class="tau-invite-footer">','<button class="tau-btn tau-success" type="submit">Create team</button>','<button class="tau-btn" type="reset">Cancel</button>',"</div>","</div>","</div>","</form>"]};return templates.register(config)});
define('tau/ui/templates/board.context.filter/ui.template.board.context.filter.lists',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.projects.list","tau/ui/templates/finder.project/ui.template.finder.project.add.form","tau/ui/templates/board.context.filter/ui.template.board.context.filter.teams.list","tau/ui/templates/finder.team/ui.template.finder.team.add.form"],function(templates){var config={name:"board.context.filter.lists",engine:"jqote2",markup:['<div class="tau-teams-projects-manager i-role-popupcontent">',"<%var hideSearch = this.showSearch === true ? false : (this.teams.length < 25 && this.projects.length < 25);%>",'<section class="tau-teams-projects-search" <% if (hideSearch){ %>style="display:none"<% } %> >','<span class="tau-inline-group tau-search">','<input name="filter" type="text" placeholder="Search Teams and Projects" class="tau-in-text">','<button class="tau-btn tau-search" type="button"></button>',"</span>","</section>","<% if (this.showTeams !== false){ %>",'<section class="tau-managed-category <% if (this.teams.length == (this.canAddTeams === false ? 0 : 1)){ %>tau-managed-category_isempty_true tau-no-team<% } %> tau-teams i-role-section-teams">',"<header>",'<label class="tau-checkbox i-role-select-all-item">','<input <%if (this.checkedAllTeam) {%>checked<%}%> type="checkbox" value="">',"<i></i>",'<span class="tau-checkbox-label">Teams</span>',"</label>","<% if (this.canAddTeams !== false) { %>",'<button class="tau-add i-role-formtrigger" type="button">New team</button>',"<% } %>","</header>","<% if (this.canAddTeams !== false) { %>",'<%= fn.sub("finder.team.add.form", this) %>',"<% } %>",'<ul class="tau-category-items-selector i-role-list">','<%= fn.sub("board.context.filter.teams.list", this.teams) %>',"</ul>","<% if (this.canAddTeams !== false) { %>",'<div class="tau-no-message">','<div class="tau-img"></div>',"<p>Team is a group of people working together toward a common vision. Teams can work on projects.</p>",'<div class="tau-btn-wrap"><button class="tau-btn tau-success i-role-formtrigger" type="button">Create team</button></div>',"</div>","<% } %>",'<div class="tau-managed-category__message tau-managed-category__message_not-found" data-text-nofound="No such team found" data-text-noitems="No available teams"></div>','<div class="tau-managed-category__message tau-managed-category__message_isempty">You need to have some teams for custom sharing.</div>',"</section>","<% }%>","<% if (this.showProjects !== false){ %>",'<section class="tau-managed-category <% if (this.projects.length == (this.canAddProjects === false ? 0 : 1)){ %>tau-managed-category_isempty_true tau-no-project<% } %> tau-projects i-role-section-projects">',"<header>",'<label class="tau-checkbox i-role-select-all-item">','<input <%if (this.checkedAllProject) {%>checked<%}%> type="checkbox">',"<i></i>",'<span class="tau-checkbox-label">Projects</span>',"</label>","<% if (this.canAddProjects !== false) { %>",'<button class="tau-add i-role-formtrigger" type="button">New project</button>',"<% } %>","</header>","<% if (this.canAddProjects !== false) { %>",'<%= fn.sub("finder.project.add.form", this) %>',"<% } %>",'<ul class="tau-category-items-selector i-role-list">','<%= fn.sub("board.context.filter.projects.list", this.projects) %>',"</ul>","<% if (this.canAddProjects !== false) { %>",'<div class="tau-no-message">','<div class="tau-img"></div>',"<p>You usually need a project to deliver results. Projects hold all the work that needs to be done.</p>",'<div class="tau-btn-wrap"><button class="tau-btn tau-success i-role-formtrigger" type="submit">Create project</button></div>',"</div>","<% } %>",'<div class="tau-managed-category__message tau-managed-category__message_not-found" data-text-nofound="No such project found" data-text-noitems="No available projects"></div>','<div class="tau-managed-category__message tau-managed-category__message_isempty">You need to have some projects for custom sharing.</div>',"</section>","<% }%>","<% if (this.isEmailNotificationsEnabled){ %>",'<section class="tau-board-send-notification">','<button class="tau-btn tau-board-send-notification-submit i-role-action-bord-access-notify" role="action-bord-access-notify" type="button">Send Notification</button>',"</section>","<% } %>",'<section class="tau-teams-projects-updater <% if (this.teams.length > 1 || this.projects.length > 1){ %> tau-teams-projects-updater_state_enabled<% } %>">','<button class="tau-btn tau-primary tau-teams-projects-submit i-role-action-submit" role="action-submit" type="button">','<%= (this.submitLabel || "Show") %>',"</section>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.context.filter/ui.template.board.context.filter',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.selected","tau/ui/templates/board.context.filter/ui.template.board.context.filter.lists"],function(templates){var config={name:"board.context.filter",engine:"jqote2",markup:['<div class="tau-context-filter" >','<div class="tau-teams-projects">','<div class="tau-selected-teams">',"<ul>",'<%= fn.sub("board.context.filter.selected", this.selectedTeams) %>',"</ul>","<% if (this.selectedTeamsCount > 2){%>",'<span class="tau-teams-pill">+<%= this.selectedTeamsCount-2 %> more</span>',"<%}%>","</div>",'<div class="tau-selected-projects">',"<ul>",'<%= fn.sub("board.context.filter.selected", this.selectedProjects) %>',"</ul>","<% if (this.selectedProjectsCount > 2){%>",'<span class="tau-projects-pill">+<%= this.selectedProjectsCount-2 %> more</span>',"<%}%>","</div>","</div>",'<%= fn.sub("board.context.filter.lists", this) %>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.context.filter',["tau/components/component.creator","tau/models/board.context.filter/model.board.context.filter.data","tau/models/board.context.filter/model.board.context.filter.add.project","tau/models/board.context.filter/model.board.context.filter.add.team","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.main","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.project","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.team","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.members-widget","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.viewer","tau/components/extensions/error/extension.errorBar","tau/ui/templates/board.context.filter/ui.template.board.context.filter"],function(ComponentCreator,ModelMain,ModelAddProject,ModelAddTeam,ExtensionMain,ExtensionFilter,ExtensionSelection,ExtensionAddProject,ExtensionAddTeam,ExtensionMembers,ExtensionViewer,ExtensionError,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelMain,ModelAddProject,ModelAddTeam,ExtensionMain,ExtensionFilter,ExtensionSelection,ExtensionAddProject,ExtensionAddTeam,ExtensionMembers,ExtensionViewer,ExtensionError],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.editor.access/model.board.editor.access',["Underscore","tau/core/model-base"],function(_,BaseModel){return BaseModel.extend({"bus beforeInit":function(evt){var configurator=evt.data.config.context.configurator;this.fire("configurator.ready",configurator)},getTeams:function(store){var deferred=$.Deferred();return store.get("team",{fields:["id","name","icon"]}).done(function(result){deferred.resolve(result[0].data)}),deferred},getProjects:function(store){var deferred=$.Deferred();return store.get("project",{fields:["id","name","color","isActive"]}).done(function(result){var projects=_.filter(result[0].data,function(v){return v.isActive});deferred.resolve(projects)}),deferred},getBoardAccess:function(boardSettings,configurator){var deferred=$.Deferred(),loggedUser=configurator.getLoggedUser();return boardSettings.get({fields:["ownerId","user","id","name","isShared","customSharedData","acid"],callback:function(data){var isOwner=!data.ownerId||data.ownerId==loggedUser.id,dataAccess={isShared:data.isShared,isAdmin:loggedUser.isAdministrator,isOwner:isOwner,customSharedData:data.customSharedData,id:data.id,name:data.name,acid:data.acid};dataAccess.customSharedData||(dataAccess.customSharedData={isActive:!1,teamIds:[],projectIds:[]}),deferred.resolve(dataAccess)}.bind(this)}),deferred},getEmailNotificationSettings:function(configurator){var deferred=$.Deferred();return configurator.getGlobalSettingsService().getGlobalSettings({success:function(data){deferred.resolve(data.IsEmailNotificationsEnabled)},failure:function(){deferred.resolve(!1)}}),deferred},_process:function(items,data){var sortBySelectionAndName=function(item){return(item.id==-1?"0":"1")+(item.selected?"0_":"1_")+item.name.toUpperCase()},list=items;return list=_.chain(list).map(function(item){return{id:item.id,name:item.name,icon:item.icon,color:item.color,selected:_.indexOf(data,item.id)>=0}}).sortBy(sortBySelectionAndName).value(),list},"bus configurator.ready + boardSettings.ready:last":function(evt,configurator,bs){var store=configurator.getStore(),boardSettings=bs.boardSettings;$.when(this.getTeams(store),this.getProjects(store),this.getBoardAccess(boardSettings,configurator),this.getEmailNotificationSettings(configurator)).done(function(teams,projects,access,isEmailNotificationsEnabled){teams=this._process(teams,access.customSharedData.teamIds),projects=this._process(projects,access.customSharedData.projectIds),this.fire("dataBind",{access:access,teams:teams,projects:projects,canAddTeams:!1,canAddProjects:!1,checkedAllProject:projects.length==access.customSharedData.projectIds.length,checkedAllTeam:teams.length==access.customSharedData.teamIds.length,showSearch:!0,submitLabel:"Share",boardId:access.id,boardName:access.name,isEmailNotificationsEnabled:isEmailNotificationsEnabled,boardAcid:access.acid})}.bind(this));var fireRefresh=function(){this.fire("refresh")}.bind(this);boardSettings.unbind({listener:this}),boardSettings.bind({fields:["name","acid"],listener:this,callback:fireRefresh}),store.unbind(this),store.on({eventName:"afterSave",type:"team",listener:this},fireRefresh),store.on({eventName:"afterRemove",type:"team",listener:this},fireRefresh),store.on({eventName:"afterSave",type:"project",listener:this},fireRefresh),store.on({eventName:"afterRemove",type:"project",listener:this},fireRefresh)},"bus boardSettings.ready:last + form.submitted":function(evt,bs,form){bs.boardSettings.set({set:form})},"bus destroy + boardSettings.ready:last":function(evt,smt,bs){bs.boardSettings.unbind({listener:this})}})});
define('tau/ui/extensions/board.editor.access/ui.extension.board.editor.access',["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/slice/api"],function($,_,ExtensionBase,SliceApi,ErrorExtension){return ExtensionBase.extend({getProjectsAndTeams:function($list){function intValue(input){return parseInt(input.value,10)}return _.map($list.find(".i-role-list :checked"),intValue)},"bus afterRender+configurator.ready":function(evt,renderData,configurator){var dataBind=renderData.data,$el=renderData.element,$filter=$el.find(".i-role-popupcontent"),$sectionTeams=$filter.find(".i-role-section-teams"),$sectionProjects=$filter.find(".i-role-section-projects");this.toggleCustomSharedPanel($el,!dataBind.access.customSharedData.isActive),$el.on("change","[role=action-share]",function(e){this.handlers[$(e.target).val()].bind(this)($el)}.bind(this));var notifyButton=$el.find("[role=action-bord-access-notify]");this.getProjectsAndTeams($sectionProjects).length<1&&this.getProjectsAndTeams($sectionTeams).length<1&&notifyButton.prop("disabled",!0),$el.on("click",".i-role-popupcontent :checkbox",function(e){var teamIds=this.getProjectsAndTeams($sectionTeams),projectIds=this.getProjectsAndTeams($sectionProjects);$(e.target).is(":checked")?notifyButton.prop("disabled",!1):teamIds.length<1&&projectIds.length<1&&notifyButton.prop("disabled",!0),this.fireCustomSharedData(!0,!0,teamIds,projectIds)}.bind(this)),this.fire("$popup.ready",$filter),this.fire("$teamSection.ready",$sectionTeams),this.fire("$projectSection.ready",$sectionProjects),this.fire("$sections.ready",$filter.find(".tau-teams, .tau-projects"));var dataBind=renderData.data,sliceApi=configurator.getSliceFactory().create({});notifyButton.on("click",function(){notifyButton.prop("disabled",!0);var teamIds=this.getProjectsAndTeams($sectionTeams),projectIds=this.getProjectsAndTeams($sectionProjects),url=configurator.getUrlBuilder().getBoardPageRelativePath()+configurator.getUrlBuilder().getRelativeBoardUrl(dataBind.boardId,dataBind.boardAcid);sliceApi.notifyBoardAccess({$set:{teamIds:teamIds,projectIds:projectIds,boardUrl:url,boardName:dataBind.boardName}}).done(function(data){this.fire("notification",{message:"People will be notified that you've shared a board with them",delay:3e3})}.bind(this)).fail(function(data){this.fire("error",{message:data.data.responseText.Message,delay:3e3})}.bind(this))}.bind(this))},fireCustomSharedData:function(isShared,isActive,teamIds,projectIds){this.fire("form.submitted",{isShared:isShared,customSharedData:{isActive:isActive,teamIds:teamIds||[],projectIds:projectIds||[]}})},handlers:{"public":function($renderElement){this.toggleCustomSharedPanel($renderElement,!0),this.fireCustomSharedData(!0,!1)},"private":function($renderElement){this.toggleCustomSharedPanel($renderElement,!0),this.fireCustomSharedData(!1,!1)},custom:function($renderElement){this.toggleCustomSharedPanel($renderElement,!1),this.fireCustomSharedData(!0,!0)}},toggleCustomSharedPanel:function($renderElement,disabled){var $filter=$renderElement.find(".i-role-popupcontent");$filter.toggleClass("tau-disabled",disabled),$filter.find("input,button:not([role=action-bord-access-notify])").prop("disabled",disabled),disabled&&$filter.find(":checkbox").prop("checked",!1)}})});
define('tau/ui/templates/board.editor.access/ui.template.board.editor.access',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.lists"],function(templates){var config={name:"board.editor.access",engine:"jqote2",markup:['<div class="tau-access-settings">','<div class="tau-access-type">',"<%if (this.access.isOwner || this.access.isAdmin) {%>",'<label class="tau-line">','<div class="tau-field">','<input role="action-share" value="private" type="radio" name="share"<% if (!this.access.isShared) { %> checked<% } %>>',"</div>",'<div class="tau-txt">',"<h3>Private</h3>","<p>Only you as the board owner can see this board. That's the default option for new boards.</p>","</div>","</label>","<% if(this.access.isAdmin) {%>",'<label class="tau-line">','<div class="tau-field">','<input role="action-share" value="public" type="radio" name="share"<% if (this.access.isShared && !this.access.customSharedData.isActive) { %> checked<% } %>>',"</div>",'<div class="tau-txt">',"<h3>Public</h3>","<p>Everyone can see this board. It will be shown in the left menu.</p>","</div>","</label>","<%}%>",'<label class="tau-line">','<div class="tau-field">','<input role="action-share" value="custom" type="radio" name="share"<% if (this.access.isShared && this.access.customSharedData.isActive) { %> checked<% } %>>',"</div>",'<div class="tau-txt">',"<h3>Custom sharing</h3>","<p>You as the board owner or admin decide which team can see and change this board.</p>","</div>","</label>","<%}%>","</div>",'<div class="tau-notification-block">','<%= fn.sub("board.context.filter.lists", this) %>',"</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.editor.access',["Underscore","tau/components/component.creator","tau/models/board.editor.access/model.board.editor.access","tau/ui/extensions/board.editor.access/ui.extension.board.editor.access","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection","tau/components/extensions/error/extension.errorBar","tau/ui/templates/board.editor.access/ui.template.board.editor.access"],function(_,ComponentCreator,Model,ExtensionShare,ExtensionFilter,ExtensionSelection,ErrorBar,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionShare,ExtensionFilter,ExtensionSelection,ErrorBar],template:Template};return config["queue.bus"]=!0,ComponentCreator.create(creatorConfig,config)}}});
define('tau/ui/extensions/board.editor.container/ui.extension.board.editor.container.view',["Underscore","jQuery","tau/views/view.container"],function(_,$,ViewBase){return ViewBase.extend({"bus initialize":function(evt){},"bus initialize + boardSettings.ready":function(evt,config,bs){this.startLifeCycle(config,bs.boardSettings)},"bus refresh":function(){this.startLifeCycle()},startLifeCycle:function(evt,boardSettings){boardSettings=boardSettings||this.boardSettings,this.boardSettings=boardSettings;var _s=_.bind(this._super,this);boardSettings.get({fields:["edit"],callback:_.bind(function(result){this.config.visible=!!result.edit,_s(evt,boardSettings)},this)}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["edit"],listener:this,callback:_.bind(function(result){this.config&&(this.config.visible=!!result.edit,this.config.visible?this.fire("show"):this.fire("hide"),this.config.visible&&this.fire("tab.activate","setup"))},this)})}})});
define('tau/ui/extensions/board.editor.container/ui.extension.board.editor.container.tabs',["jQuery","tau/core/extension.base"],function($,BaseExtension){return BaseExtension.extend({resetLifecycle:!0,configTab:{limits:{isActive:function(data){var result=!1;return data.x&&data.x.types[0]==="entitystate"&&(result=!0),data.y&&data.y.types[0]==="entitystate"&&(result=!0),result},setState:function($element,data){$element.toggleClass("tau-disabled",!this.isActive(data))}},templates:{setState:function($tabHeader,data,configurator){var user=configurator.getLoggedUser(),templatesActive=data.ownerId==user.id||user.isAdministrator;$tabHeader.toggleClass("tau-disabled",!templatesActive)}},access:{setState:function($tabHeader,data,configurator){var user=configurator.getLoggedUser(),templatesActive=data.ownerId==user.id||user.isAdministrator;$tabHeader.toggleClass("tau-hide",!templatesActive)}}},"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator)},"bus afterRender":function(e,renderData){var $el=renderData.element;this.fire("$el.ready",$el)},"bus $el.ready":function(evt,$el){var self=this;$el.on("click",".i-role-tabheader:not(.tau-disabled)",function(){self.fire("tab.activate",$(this).data("label"))})},"bus $el.ready:last + tab.activate":function(evt,$el,id){var $tabs=$el.find(".i-role-tab"),$tab=$tabs.filter("[data-label="+id+"]:not(.tau-active)"),$tabHeaders=$el.find(".i-role-tabheaders .i-role-tabheader"),$tabHeader=$tabHeaders.filter("[data-label="+id+"]:not(.tau-active)");$tab.length&&$tabHeader.length&&($tabs.not($tab).removeClass("tau-active"),$tab.addClass("tau-active"),$tabHeaders.not($tabHeader).removeClass("tau-active"),$tabHeader.addClass("tau-active"),this.fire("tab.activate.completed",id))},"bus configurator.ready + componentsCreated":function(evt,configurator,childrenBusesData){var tabBuses={};_.forEach(childrenBusesData,function(childrenBusesData){var config=childrenBusesData.config,bus=childrenBusesData.component;_.has(config,"label")&&(tabBuses[config.label]=bus)}),this.fire("tabBuses.ready",tabBuses),$.when(configurator.getComponentBusRegistry().getByName("board_editor"),configurator.getComponentBusRegistry().getByName("board_templates")).done(_.bind(function(b1,b2,b3){var tabBuses={setup:b1,templates:b2,limits:b3};this.fire("tabBusesInternal.ready",tabBuses)},this));var isNew=configurator.getConfig("tmpBoardIsJustAdded",!1);configurator.setConfig("tmpBoardIsJustAdded",!1),isNew?(this.fire("tab.activate","templates"),this.fire("justAdded.opened")):this.fire("alreadyAdded.opened")},"bus $el.ready + tabBusesInternal.ready":function(evt,$el,tabBuses){tabBuses.templates.on("item.selected",function(){$el.parent().toggleClass("tau-full-cell-settings",!1),tabBuses.templates.fire("external.setFocusOnSelected")}),tabBuses.templates.on("item.selected.completed",function(){tabBuses.setup.fire("refresh")});var self=this;tabBuses.templates.on("setup.pressed",function(){self.fire("tab.activate","setup")})},"bus tabBusesInternal.ready:last + tab.activate.completed + justAdded.opened":function(evt,tabBuses){tabBuses.templates.once("afterRender",function(){tabBuses.templates.fire("external.selectDefault"),tabBuses.templates.fire("confirmation.toggle",!1)}),tabBuses.templates.fire("external.selectDefault"),tabBuses.templates.fire("confirmation.toggle",!1)},"bus tabBusesInternal.ready:last + tab.activate.completed":function(evt,tabBuses,tabId){tabId=="templates"&&(tabBuses.templates.fire("external.selectNone"),tabBuses.templates.fire("confirmation.toggle",!0))},"bus view.dom.ready:last + $el.ready:last + tabBuses.ready:last + tab.activate.completed":function(evt,$body,$el,tabBuses,tabId){tabId=="templates"||tabId=="customize"||tabId=="encoding"?$el.parent().toggleClass("tau-full-cell-settings",!0):$el.parent().toggleClass("tau-full-cell-settings",!1),tabId=="access"?$el.parent().toggleClass("tau-access",!0):$el.parent().toggleClass("tau-access",!1),tabBuses[tabId].fire("show")},"bus configurator.ready + $el.ready + boardSettings.ready":function(evt,configurator,$element,bs){var $tabs=$element.find(".i-role-tabheader"),setStateTabs=_.bind(function(data){$tabs.each(_.bind(function(index,element){var $element=$(element),role=$element.data("label");this.configTab[role]&&this.configTab[role].setState($element,data,configurator)},this))},this),boardSettings=bs.boardSettings,getSetting=function(){boardSettings.get({fields:["x","y","ownerId"],callback:setStateTabs})};getSetting(),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["x","y","ownerId"],listener:this,callback:getSetting})}})});
define('tau/ui/templates/board.editor.container/ui.template.board.editor.container',["tau/core/templates-factory","tau/nls/translator"],function(templates,T){var config={name:"board.editor.container",engine:"jqote2",markup:["<% var features = this.context.configurator.getFeaturesService(); %>",'<div class="tau-board-settings">','<div class="tau-board-settings-header i-role-tabheaders" role="toolbar">','<ul class="tau-board-settings-groups-tags i-role-tabheaders" >','<% if (features.isEnabled("boardTemplates")){ %>','<li class="i-role-tabheader" data-label="templates">Templates</li>',"<% } %>",'<li class="tau-active i-role-tabheader" data-label="setup">Setup</li>','<li class="i-role-tabheader" data-label="access">Access</li>','<li class="tau-extension-board-tooltip tau-disabled tau-extension-board-tooltip i-role-tabheader"','data-label="limits" data-collapsed-selector=".i-role-tabheader:not(.tau-active)" data-expanded-selector=".i-role-tabheader.tau-disabled"','data-title-expanded="'+T("You need to add the States axis to be able to set limits to WIP")+'"','data-title-collapsed="'+T("Set limits to work in progress")+'"',">Limits</li>",'<% if (features.isEnabled("boardEditorPrioritization")){ %>','<li class="i-role-tabheader" data-label="prioritization">Prioritize</li>',"<% } %>",'<li class="i-role-tabheader" data-label="customize">Customize Cards</li>','<li class="i-role-tabheader" data-label="encoding">Visual Encoding</li>',"</ul>","</div>",'<div class="i-role-tab tau-board-settings-group tau-active" role="editor" data-label="setup"></div>','<% if (features.isEnabled("boardTemplates")){ %>','<div class="i-role-tab tau-board-settings-group" role="templates"  data-label="templates"></div>',"<% } %>",'<div class="i-role-tab tau-board-settings-group" role="access"  data-label="access"></div>','<div class="i-role-tab tau-board-settings-group" role="limits"  data-label="limits"></div>','<div class="i-role-tab tau-board-settings-group" role="prioritization"  data-label="prioritization"></div>','<div class="i-role-tab tau-board-settings-group" role="customize"  data-label="customize"></div>','<div class="i-role-tab tau-board-settings-group" role="encoding"  data-label="encoding"></div>',"</div>"]};return templates.register(config)});
define('tau/components/component.board.editor.container',["Underscore","tau/components/component.container","tau/ui/extensions/board.container/ui.extension.board.container.events","tau/ui/extensions/board.editor.container/ui.extension.board.editor.container.view","tau/ui/extensions/board.editor.container/ui.extension.board.editor.container.tabs","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/ui/templates/board.editor.container/ui.template.board.editor.container"],function(_,ComponentContainer,BoardContainerExtension,ViewExtension,TabsExtension,TooltipExtension,Template){return{create:function(config){var creatorConfig={extensions:[BoardContainerExtension,TabsExtension,TooltipExtension].concat(config.extensions||[]),ViewType:ViewExtension,template:Template};return ComponentContainer.create(_.extend(config,creatorConfig))}}});
define('tau/ui/templates/board.editor.customize/ui.template.board.editor.customize',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.customize",engine:"jqote2",markup:['<div class="tau-coming-soon"><h2><span>Customize Cards</span></h2><h3>See exactly what you need on all zoom levels</h3><div class="tau-bg tau-customize-cards"></div></div>'],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.editor.customize',["tau/components/component.creator","tau/ui/templates/board.editor.customize/ui.template.board.editor.customize"],function(Creator,Template){return{create:function(config){var creatorConfig={template:Template},component=Creator.create(creatorConfig,config);return component.fire("dataBind",{}),component}}});
define('tau/ui/templates/board.editor.encoding/ui.template.board.editor.encoding',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.encoding",engine:"jqote2",markup:['<div class="tau-coming-soon"><h2><span>Visual Encoding</span></h2><h3>Highlight important things by custom rules</h3><div class="tau-bg tau-visual-encoding"></div></div>'],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.editor.encoding',["tau/components/component.creator","tau/ui/templates/board.editor.encoding/ui.template.board.editor.encoding"],function(Creator,Template){return{create:function(config){var creatorConfig={template:Template},component=Creator.create(creatorConfig,config);return component.fire("dataBind",{}),component}}});
define('tau/models/board.editor/board.filter.help.data',["Underscore"],function(_){return{general:[{label:"has 'wow' in tags or in name",value:"?'wow' in Tags or 'wow' in Name"},{label:"created last week",value:"?CreateDate > Today - 7(days)"}],assignable:[{label:"not done",value:"?EntityState.IsFinal != true"},{label:"assigned to a person with last name 'Gates'",value:"?AssignedUser.Where(LastName is 'Gates')"},{label:"with some effort",value:"?Effort > 0"},{label:"assigned to me",value:"?AssignedUser.Where(it is Me)"}],feature:[{label:"assigned to release started after 04-Mar-2013",value:"?Release.StartDate > '04-Mar-2013'"},{label:"has user stories with time spent",value:"?UserStories.Where(TimeSpent > 0)"}],team:[{label:"small teams",value:"?TeamMembers.Count < 4"},{label:"teams without related projects",value:"?TeamProjects.Count is 0"}],testCase:[{label:"failed today",value:"?LastStatus is False and LastRunDate is today"},{label:"for user story 'Make us happy'",value:"?UserStory is 'Make us happy'"}],entityState:[{label:"not done",value:"?IsFinal is False"},{label:"only in progress states",value:"?IsInitial is false and IsFinal is false and IsPlanned is false"},{label:"'developer' is responsible",value:"?Role is 'Developer'"},{label:"name starts with 'in'",value:"?Name.StartsWith('in')"}],tag:[{label:"Tags with user stories from project 'Triads'",value:"?Generals.Count > 0 and Generals.Where(EntityType is 'UserStory') and Generals.Where(Project.Name is 'Triads')"},{label:"Tags that starts with 'A' or 'B'",value:"?Name.StartsWith('A') or Name.StartsWith('B')"},{label:"Tags that contains 'rest' or 'soap'",value:"?Name.Contains('rest') or Name.Contains('soap')"}],impediment:[{label:"with critical priority",value:"?Priority is 'Critical'"},{label:"resolved",value:"?EntityState.IsFinal is true"},{label:"email of responsible contains 'ted'",value:"?Responsible.Email.Contains('ted')"},{label:"related to entities with 'rest' in name",value:"?Assignable.Name.Contains('rest')"}],iteration:[{label:"started last month",value:"?StartDate > today - 30(days)"},{label:"backlog",value:"?it is None"},{label:"in releases that have 'gold' in name",value:"?Release.Name.Contains('gold')"}],time_container:[{label:"current",value:"?it is Current"},{label:"future",value:"?it is Future"},{label:"past",value:"?it is Past"}],release:[{label:"started last year",value:"?StartDate > today - 365(days)"},{label:"without iterations",value:"?Iterations.Count is 0"}],role:[{label:"name starts with 'dev'",value:"?Name.StartsWith('dev')"},{label:"roles with effort and for pair of people",value:"?HasEffort is True and IsPair is True"}],severity:[{label:"most severe bugs",value:"?Importance is 1"},{label:"severity contains 'cri' and ends with 'cal'",value:"?Name.Contains('cri') and Name.EndsWith('cal')"}],requestType:[{label:"types with some requests",value:"?Requests.Count > 0"},{label:"types with name 'Issue'",value:"?Name is 'Issue'"}],testPlan:[{label:"without test runs",value:"?TestPlanRuns.Count is 0"},{label:"from projects where name contains 'tp'",value:"?Project.Name.Contains('tp')"}],process:[{label:"default process",value:"?IsDefault is True"},{label:"unused process",value:"?Projects.Count is 0"}],priority:[{label:"most important",value:"?Importance is 1"},{label:"name starts with 'must'",value:"?Name.StartsWith('must')"}],teamIteration:[{label:"started last month",value:"?StartDate > today - 30(days)"},{label:"backlog",value:"?it is None"}],assignment:[{label:"developers or qa engineers",value:"?Role is 'Developer' or Role is 'QA Engineer'"},{label:"added this year",value:"?CreateDate > today - 365(days)"},{label:"last name starts with 'D'",value:"?LastName.StartsWith('D')"},{label:"active admins",value:"?IsActive is true and IsAdministrator is true"}],user:[{label:"developers or qa engineers",value:"?Role is 'Developer' or Role is 'QA Engineer'"},{label:"added this year",value:"?CreateDate > today - 365(days)"},{label:"last name starts with 'D'",value:"?LastName.StartsWith('D')"},{label:"active admins",value:"?IsActive is true and IsAdministrator is true"}],releasable:[{label:"belongs to the current release",value:"?Release is Current"},{label:"belongs to a future release",value:"?Release is Future"}],project:[{label:"only active projects",value:"?IsActive is True"},{label:"problematic projects",value:"?Bugs.Count > 1000"}],task:[{label:"user story contains 'zoom' in name",value:"?UserStory.Name.Contains('zoom')"}],request:[{label:"not replied or without comments",value:"?IsReplied is False or Comments.Count is 0"}],bug:[{label:"belongs to the last 3 team iterations",value:"?TeamIteration is Past(3)"},{label:"with 'Confused' severity",value:"?Severity.Name is 'Confused'"}],userStory:[{label:"belongs to the 2 future iterations",value:"?Iteration is Future(2)"},{label:"without tasks",value:"?Tasks.Count is 0"},{label:"belongs to 'Quick Add' feature ",value:"?Feature is 'Quick Add'"},{label:"belongs to the current iteration",value:"?Iteration is Current"},{label:"assigned to 'Delta' team",value:"?Team is 'Delta'"}]}});
define('tau/models/board.editor/board.filter.help',["Underscore","jQuery","tau/core/class","tau/models/board.editor/board.filter.help.data","tau/store/types"],function(_,$,Class,data,tauTypes){var _cache={},map={assigneduser:"assignment"},additions={userStory:["releasable"],bug:["releasable"],feature:["releasable"],task:["releasable"],iteration:["releasable","time_container"],teamIteration:["time_container"],release:["time_container"]};return Class.extend({getTypes:function(type){return _cache.hasOwnProperty(type)||(_cache[type]=this._getTypes(type)),_cache[type]},_getTypes:function(type){var register=[];map.hasOwnProperty(type)&&(type=map[type]);var typeDescription=tauTypes.findByKeyword(type);typeDescription&&typeDescription.name&&additions.hasOwnProperty(typeDescription.name)&&(register=register.concat(additions[typeDescription.name]));if(!typeDescription)register.push(type);else{var parent=typeDescription.parent;register.push(typeDescription.name);while(parent){register.push(parent);var p=tauTypes.findByKeyword(parent);if(!p)break;parent=p.parent}}return register},get:function(config){config=config||{};var result={},self=this,$deferred=$.Deferred();return _.each(_.keys(config),function(key){var types=(config[key]||{}).types||[];if(types.length===0)return;result[key]=[];var keys=[];_.each(types,function(type){keys.push(self.getTypes(type))}),keys=_.intersection.apply(null,keys),_.each(keys,function(keyValue){var val=data[keyValue];if(!val)return;result[key]=result[key].concat(val)})}),$deferred.resolve(result),$deferred}})});
define('tau/models/board.editor/model.board.editor.read',["Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.help"],function(_,BaseModel,Help){var Model=BaseModel.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator)},"bus configurator.ready":function(evt,configurator){var self=this;configurator.getAppStateStore().get({fields:["acid"],callback:function(result){self.fire("acid.ready",result.acid)}}),configurator.getAppStateStore().unbind({listener:this}),configurator.getAppStateStore().bind({fields:["acid"],listener:this,callback:function(result){self.fire("refresh")}});var boardSettings=configurator.service("boardSettings");boardSettings.get({fields:["ownerId"],callback:function(boardData){var access={edit:!0},user=configurator.getLoggedUser();parseInt(user.id,10)!==parseInt(boardData.ownerId,10)&&!user.isAdministrator&&(access.edit=!1),self.fire("accessData.ready",access)}})},"bus configurator.ready:last + acid.ready:last + accessData.ready:last + form.readyToUpdate":function(evt,configurator,acid,accessData){var boardSettings=configurator.service("boardSettings"),self=this;this.getSpaceTotal(configurator.getSliceFactory(),boardSettings,acid,function(space){self.fire("updateData.ready",{space:space,access:accessData})})},"bus configurator.ready + acid.ready":function(evt,configurator,acid){var self=this,boardSettings=configurator.service("boardSettings");this.getSpaceTotal(configurator.getSliceFactory(),boardSettings,acid,function(space){self.fire("dataBind",{user:configurator.getLoggedUser(),space:space})})},"bus configurator.ready + destroy":function(evt,configurator){var boardSettings=configurator.service("boardSettings");boardSettings.unbind({listener:this})},getSpaceTotal:function(sliceFactory,boardSettings,acid,cb){var self=this,funcs=[];funcs.push(function(next){self.spaceAvailable(sliceFactory,boardSettings,acid,next)}),funcs.push(function(next){self.spaceCells(sliceFactory,boardSettings,acid,next)}),funcs.push(function(next){self.spaceAxisX(sliceFactory,boardSettings,acid,next)}),funcs.push(function(next){self.spaceAxisY(sliceFactory,boardSettings,acid,next)}),funcs.push(function(next){self.getPredefinedFilters(boardSettings,next)}),_.parallel(funcs,function(err,res){var space=self.processSpaces(res);cb(space)})},spaceAvailable:function(sliceFactory,boardSettings,acid,next){var definition={global:{acid:acid}},slice=sliceFactory.create({definition:definition});slice.space().done(function(result){next(!1,{space:result.data})})},spaceCells:function(sliceFactory,boardSettings,acid,next){boardSettings.get({fields:["name","x","y","cells","zoomLevel","hierarchyMode","viewMode","acid"],callback:function(settings){var sliceConfig={definition:{global:{acid:acid},x:settings.x,y:settings.y,cells:settings.cells}},slice=sliceFactory.create(sliceConfig);slice.on("error",function(){next(!1,{space:{},settings:settings})}),slice.space().done(function(result){next(!1,{space:result.data,settings:settings})})}})},spaceAxisX:function(sliceFactory,boardSettings,acid,next){boardSettings.get({fields:["name","x","y","cells","zoomLevel"],callback:function(settings){var sliceConfig={definition:{global:{acid:acid},y:settings.y,cells:settings.cells}},slice=sliceFactory.create(sliceConfig);slice.on("error",function(){next(!1,{space:{}})}),slice.space().done(function(result){next(!1,{space:result.data})})}})},spaceAxisY:function(sliceFactory,boardSettings,acid,next){boardSettings.get({fields:["name","x","y","cells","zoomLevel"],callback:function(settings){var sliceConfig={definition:{global:{acid:acid},x:settings.x,cells:settings.cells}},slice=sliceFactory.create(sliceConfig);slice.on("error",function(){next(!1,{space:{}})}),slice.space().done(function(result){next(!1,{space:result.data})})}})},processSpaces:function(res){var data={spaceDefault:res[0].space,spaceAvailable:{cells:res[1].space.cells||[],x:res[2].space.axes||[],y:res[3].space.axes||[],hierarchyMode:"inside",viewMode:""},settingsCurrent:res[1].settings},predefinedFilters=res[4],space={x:{name:"x",types:[],filter:"",predefinedFilters:predefinedFilters.x||[],orderingName:"",orderingDirection:0},y:{name:"y",types:[],filter:"",predefinedFilters:predefinedFilters.y||[],orderingName:"",orderingDirection:0},cells:{name:"cells",types:[],filter:"",predefinedFilters:predefinedFilters.cells||[],orderingName:"",orderingDirection:0},hierarchyMode:null,viewMode:null},lc=function(s){return s.toLowerCase()};space.hierarchyMode=data.settingsCurrent.hierarchyMode,space.viewMode=data.settingsCurrent.viewMode;var calculateTypes=function(axis){space[axis].types=_.map(data.spaceDefault.axes.items,function(v){var item={id:v.id,name:v.name,isAvailable:_.any(data.spaceAvailable[axis].items,function(u){return lc(u.id)===lc(v.id)}),isSelected:data.settingsCurrent[axis]&&_.any(data.settingsCurrent[axis].types,function(u){return lc(u)===lc(v.id)})};return item.isAvailable=item.isSelected?!0:item.isAvailable,item.groupName=v.groupName,item}),space[axis].filter=data.settingsCurrent[axis]?data.settingsCurrent[axis].filter||"":"";var groupedItems=_.filter(space[axis].types,function(v){return v.isAvailable});space[axis].grouped=_.groupBy(groupedItems,function(item){return item.groupName||"default"}),space[axis].grouped=_.map(space[axis].grouped,function(v,k){return{name:k,items:v}}),space[axis].grouped=_.sortBy(space[axis].grouped,function(v){return v.name=="default"?"AAAA":v.name});var axisType=data.settingsCurrent[axis]?data.settingsCurrent[axis].types[0]||"":"",selected=_.find(data.spaceAvailable[axis].items,function(u){return lc(u.id)===lc(axisType)});selected||(selected={});var definitionFilter=data.settingsCurrent&&data.settingsCurrent[axis]?data.settingsCurrent[axis].ordering:null,selectedFilter;definitionFilter&&definitionFilter.name&&(selectedFilter=_.find(selected.orderings,function(v){return v==definitionFilter.name})),selectedFilter||(selectedFilter=selected.defaultOrdering),space[axis].orderingNames=_.map(selected.orderings||[],function(v){var item={id:v,name:v,isSelected:selectedFilter?v==selectedFilter:!1};return item}),space[axis].orderingDirection=data.settingsCurrent&&data.settingsCurrent[axis]&&data.settingsCurrent[axis].ordering?data.settingsCurrent[axis].ordering.isDescending:0};calculateTypes("x"),calculateTypes("y"),space.cells.types=_.map(data.spaceDefault.cells.items,function(v){var item={id:v.id,name:v.name,isAvailable:_.any(data.spaceAvailable.cells.items,function(u){return lc(u.id)===lc(v.id)}),isSelected:_.any(data.settingsCurrent.cells.types,function(u){return lc(u)===lc(v.id)})};return item.isAvailable=item.isSelected?!0:item.isAvailable,item}),space.cells.filter=data.settingsCurrent.cells.filter||"";var selectedOrdering=data.settingsCurrent&&data.settingsCurrent.cells.ordering&&data.settingsCurrent.cells.ordering,selectedOrderingName=selectedOrdering&&selectedOrdering.name,selectedOrderingDirection=selectedOrdering?selectedOrdering.isDescending:0;return space.cells.orderingDirection=selectedOrderingDirection,space.cells.orderingNames=_.map(res[1].space.cells.orderings.items,function(value){return{id:value,name:value,isSelected:value==selectedOrderingName}}),space.acid=res[1].settings.acid||"",space},getPredefinedFilters:function(bs,next){bs.get({fields:["x","y","cells"],callback:function(settings){(new Help).get({x:settings.x,y:settings.y,cells:settings.cells}).done(function(r){next(!1,r)})}})},getSpaceEmpty:function(){var space={x:{name:"x",types:[],filter:""},y:{name:"y",types:[],filter:""},cells:{name:"cells",types:[],filter:""},hierarchyMode:null,viewMode:null};return space}});return Model});
define('tau/models/board.editor/model.board.editor.write',["Underscore","tau/core/extension.base"],function(_,BaseModel){var Model=BaseModel.extend({"bus boardSettings.ready:last + formData.changed":function(evt,bs,formData){formData.focus={x:[],y:[]},formData.selectedMarks={x:[],y:[]};var boardSettings=bs.boardSettings,self=this;boardSettings.setDef({set:formData}).done(function(){self.fire("settings.changed",formData)})},"bus boardSettings.ready:last + formData.acid.changed":function(evt,bs,formData){var boardSettings=bs.boardSettings,self=this;boardSettings.set({set:formData,callback:function(){self.fire("settings.acid.changed")}})}});return Model});
define('tau/models/board.editor/model.board.filter.help',["Underscore","tau/core/model-base","tau/models/board.editor/board.filter.help"],function(_,BaseModel,Help){return BaseModel.extend({"bus boardSettings.ready":function(evt,data){var help=new Help,boardSettings=data.boardSettings,self=this;boardSettings.unbind({listener:self}),boardSettings.bind({fields:["cells","x","y"],listener:self,callback:function(data){help.get(data).done(function(r){self.fire("refresh.help.content",r)})}})}})});
define('tau/models/board.editor/board.filter.suggestionManager',["Underscore","jQuery","tau/core/class"],function(_,$,Class){var suggestionsCache={};return Class.extend({init:function(configurator){this.url=configurator.getApplicationPath()+"/api/v2/lang/query",this.acidStore=configurator.getAppStateStore(),this.ajaxService=$.ajax},get:function(params){params=_.defaults(params||{},{query:{resourceTypes:[],script:""},take:50,skip:0,options:{insertDotForObjectAttribute:!0,insertLeftBracketForObjectCollectionMethod:!0}});var url=this.url+"/suggestions",$deferred=$.Deferred();return this.acidStore.get({fields:["acid"],callback:_.bind(function(res){var acid=res.acid;params.acid=acid;var strParams=JSON.stringify(params),cacheKey=(url+"/"+strParams).toLowerCase(),$subDeferred=suggestionsCache.hasOwnProperty(cacheKey)?suggestionsCache[cacheKey]:this.ajaxService({url:url,type:"POST",data:strParams,dataType:"json",contentType:"application/json; charset=utf-8"});suggestionsCache[cacheKey]=$subDeferred,$subDeferred.done($deferred.resolve).fail($deferred.fail)},this)}),$deferred}})});
define('tau/models/board.editor/model.board.editor.autocomplete',["Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.suggestionManager"],function(_,BaseModel,SuggestionManager){var Model=BaseModel.extend({"bus configurator.ready":function(evt,configurator){var suggestionManager=new SuggestionManager(configurator);this.fire("suggestionManager.ready",suggestionManager)},getTypes:function($input,settings){var name=$input.prop("name"),$deferred=$.Deferred();if(!name)return $deferred.reject(),$deferred;var node=name.replace("_filter","");return settings.get({fields:[node],callback:function(r){var types=[];r.hasOwnProperty(node)&&(types=r[node].types||[]),$deferred.resolve(types)}}),$deferred},"bus suggestionManager.ready:last + boardSettings.ready:last + filter.autocomplete.preload":function(evt,suggestionManager,bs,data){var $input=data.$input;this.getTypes($input,bs.boardSettings).done(function(types){if(types.length==0)return;var prefix=data.value;if(!prefix||prefix.length===0||prefix[0]!="?")return;var values=[prefix.trim()+" ",prefix.trim()+"."];_.each(values,function(value){var querySet={query:{resourceTypes:types,script:value}};suggestionManager.get(querySet)})})},"bus suggestionManager.ready:last  + boardSettings.ready:last + filter.autocomplete.resolve":function(evt,suggestionManager,bs,data){var $input=data.$input;this.getTypes($input,bs.boardSettings).done(function(types){if(types.length==0){data.next([]);return}var term=data.request.term.slice(0,$input[0].selectionStart),positive=function(res){var items=res.Suggestions?res.Suggestions.Items:[];items=_.map(items,function(item){return item.Source=res.Source,item.Position=res.Position,item}),data.next(items)},negative=function(){data.next([])},querySet={query:{resourceTypes:types,script:term}};suggestionManager.get(querySet).done(positive).fail(negative)})}});return Model});
define('tau/ui/templates/board.editor/ui.template.board.editor.axisTypes',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.axisTypes",engine:"jqote2",markup:["<% var UIID = _.UUID();  %>","<% _.forEach(this.grouped, function(group){ %>",'<% if (group.name != "default") { %>','<option value="<%! group.name + UIID %>" disabled="">----- <%! group.name %> -----</option>',"<% } %>","<% _.forEach(group.items, function(item){ %>","<% if (item.isAvailable){ %>",'<option value="<%= item.id %>" ',"<% if (item.isSelected){ %>","selected ","<% } %> ",">","<%! item.name %>","</option>","<% } %> ","<% }); %>","<% }); %>"]};return templates.register(config)});
define('libs/jquery/jquery.toggleFilter',["libs/jquery/jquery","libs/jquery/jquery.caret"],function(jQuery){(function($){$.fn.toggleFilter=function(options){function filterToggleExpand($element){$element.hasClass(settings.expandedClass)?$element.removeClass(settings.expandedClass):$element.addClass(settings.expandedClass)}function filterToggleEmpty($element,$input){$input.val()?$element.addClass(settings.filterOnClass+" i-role-filter-control_on"):$element.removeClass(settings.filterOnClass+" i-role-filter-control_on")}var settings=$.extend({expandedClass:"tau-inline-group",additionalClass:"",filterOnClass:"tau-boardsettings__filter_on",defaultExpand:!1},options);return options==="refresh"?(this.each(function(){var $filter=$(this),$filterInput=$filter.find(".i-role-filter-input");filterToggleEmpty($filter,$filterInput)}),this):(this.addClass(settings.additionalClass),settings.defaultExpand&&this.addClass(settings.expandedClass),this.each(function(){var $filter=$(this),$filterInput=$filter.find(".i-role-filter-input"),$filterToggle=$filter.find(".i-role-filter-toggle");filterToggleEmpty($filter,$filterInput),$filterInput.on("clear autocompletechange",function(){filterToggleEmpty($filter,$filterInput)}),$filterToggle.click(function(){$filterToggle.toggleClass("tau-checked"),filterToggleExpand($filter),filterToggleEmpty($filter,$filterInput),$filterInput.focus().caretToEnd()})}),this)}})(jQuery)});
define('tau/ui/extensions/board.editor/ui.extension.board.editor.form',["Underscore","jQuery","tau/core/extension.base","tau/ui/templates/board.editor/ui.template.board.editor.axisTypes","tau/ui/behaviour/overlay/ui.behaviour.overlay","libs/jquery/jquery.placeholder","libs/jquery/jquery.toggleFilter"],function(_,$,ExtensionBase,axisTypesTemplate){return ExtensionBase.extend({resetLifecycle:!0,"bus afterRender":function(evt,renderData){var $form=renderData.element,$filters=$form.find(".i-role-filter-input");$filters.placeholder(),$form.find(".i-role-filter-control").toggleFilter(),this.fire("$el.ready",$form),this.fire("$form.ready",$form)},"bus $el.ready:last + error":function(evt,$el){$el.tauOverlay("hide")},"bus $form.ready + updateData.ready":function(evt,$form,updateData){var self=this;$form.find(".i-role-sorter-toggler").on("click",function(){$(this).toggleClass("tau-checked")});var access=updateData.access;if(access.edit===!1)return $form.find("select, input, button").not(".i-role-filter-toggle").not(".i-role-sorter-toggler").prop("disabled",!0).addClass("permission-denied"),!1;$form.find(".i-role-filter-input").tauResetableInput(),$form.delegate("[name=cells_types]","change",function(){$(this).next().toggleClass("tau-checked")}),$form.on("click",".i-role-switch-filter",function(){var $xTypes=$form.find("[name=x_types]"),$yTypes=$form.find("[name=y_types]"),$xFilter=$form.find("[name=x_filter]"),$xFilterControl=$xFilter.parents(".i-role-filter-control:first"),$yFilter=$form.find("[name=y_filter]"),$yFilterControl=$yFilter.parents(".i-role-filter-control:first"),$xOrderingName=$form.find("[name=x_ordering_name]"),$xOrderingDir=$form.find("[name=x_ordering_direction]"),$xOrderingControl=$xOrderingDir.parents(".i-role-ordering-control:first"),$yOrderingName=$form.find("[name=y_ordering_name]"),$yOrderingDir=$form.find("[name=y_ordering_direction]"),$yOrderingControl=$yOrderingDir.parents(".i-role-ordering-control:first"),xTypesTemp=$xTypes.val(),xFilterTemp=$xFilter.val(),xOrderingNameTemp=$xOrderingName.find("option").map(function(){var $o=$(this);return{id:$o.attr("value"),name:$o.text(),isSelected:$o.attr("selected")||!1}}),yOrderingNameTemp=$yOrderingName.find("option").map(function(){var $o=$(this);return{id:$o.attr("value"),name:$o.text(),isSelected:$o.attr("selected")||!1}}),xOrderingDirTemp=$xOrderingDir.is(":checked");$xFilter.val($yFilter.val());var yVal=$yTypes.val(),xVal=$xTypes.val(),$xOpts=$xTypes.find("option").detach(),$yOpts=$yTypes.find("option").detach();$xTypes.append($yOpts),$xTypes.val(yVal),self.updateOrderingState($xOrderingName,yOrderingNameTemp),self.updateOrderingDirectionState($xOrderingDir,$yOrderingDir.is(":checked"));var yControlToCheck=!!$xOrderingControl.find(".i-role-sorter-toggler.tau-checked").length,xControlToCheck=!!$yOrderingControl.find(".i-role-sorter-toggler.tau-checked").length;$xOrderingControl.find(".i-role-sorter-toggler").toggleClass("tau-checked",xControlToCheck),$yOrderingControl.find(".i-role-sorter-toggler").toggleClass("tau-checked",yControlToCheck),$yFilter.val(xFilterTemp),$yTypes.append($xOpts),$yTypes.val(xTypesTemp),self.updateOrderingState($yOrderingName,xOrderingNameTemp),self.updateOrderingDirectionState($yOrderingDir,xOrderingDirTemp);var yFilterToCheck=$xFilterControl.hasClass("tau-inline-group"),xFilterToCheck=$yFilterControl.hasClass("tau-inline-group");$xFilterControl.toggleClass("tau-inline-group",xFilterToCheck).find(".i-role-filter-toggle").toggleClass("tau-checked",xFilterToCheck),$yFilterControl.toggleClass("tau-inline-group",yFilterToCheck).find(".i-role-filter-toggle").toggleClass("tau-checked",yFilterToCheck),$form.trigger("_change")});var controlsSelectors=["[name=cells_types]","[name=cells_ordering_name]","[name=cells_ordering_direction]","[name=x_types]","[name=x_ordering_name]","[name=x_ordering_direction]","[name=y_types]","[name=y_ordering_name]","[name=y_ordering_direction]"].join(",");$form.delegate(controlsSelectors,"change",function(e){$form.trigger("_change",{$input:$(this),sourceEvent:e})});var filterSelector="[name=cells_filter], [name=x_filter], [name=y_filter]";$form.on("_change",filterSelector,function(e){$form.trigger("_change",{$input:$(this),sourceEvent:e})}),$form.delegate(filterSelector,"clear",function(){$(this).trigger("_change")}),$form.delegate(filterSelector,"keydown",function(e){if(e.which==$.ui.keyCode.ENTER){var $input=$(this);$input.blur()}}),$form.on("_change",function(e,source){var skipOrdering=!1;source&&source.$input&&(self.resetFilters($form,source.$input),source.$input.is("[name=x_types]")&&(skipOrdering="x"),source.$input.is("[name=y_types]")&&(skipOrdering="y"),source.$input.is("[name=cells_types]")&&(skipOrdering="cells"));var data=self.bindForm($form,skipOrdering);self.fire("formData.changed",data)}),$form.find(".i-role-direction-toggler").on("click",function(){var $t=$(this);$t.toggleClass("tau-sort-inc"),$t.toggleClass("tau-sort-dec"),$t.hasClass("tau-sort-dec")?$t.next(":checkbox").attr("checked","checked"):$t.next(":checkbox").removeAttr("checked"),$t.next(":checkbox").trigger("change")})},"bus settings.changed":function(evt){this.fire("form.readyToUpdate")},"bus $form.ready":function(evt){this.fire("form.readyToUpdate")},"bus configurator.ready:last + $form.ready:last + updateData.ready ":function(evt,configurator,$form,updateData){this.updateForm(configurator,$form,updateData.space,updateData.access)},resetFilters:function($form,$element){$element.attr("name")=="x_types"&&$form.find("[name=x_filter]").val(""),$element.attr("name")=="y_types"&&$form.find("[name=y_filter]").val("")},bindForm:function($form,skipOrdering){var data={x:{types:[],filter:"",ordering:{name:"",isDescending:!1}},y:{types:[],filter:"",ordering:{name:"",isDescending:!1}},cells:{types:[],filter:"",ordering:{name:"",isDescending:!1}}};data.x.types=_.compact([$form.find("[name=x_types]").val()]),data.x.filter=_.trim($form.find("[name=x_filter]").val()),skipOrdering=="x"?data.x.ordering=null:(data.x.ordering.name=_.trim($form.find("[name=x_ordering_name]").val())||null,data.x.ordering.isDescending=$form.find("[name=x_ordering_direction]").is(":checked")),data.y.types=_.compact([$form.find("[name=y_types]").val()]),data.y.filter=_.trim($form.find("[name=y_filter]").val()),skipOrdering=="y"?data.y.ordering=null:(data.y.ordering.name=_.trim($form.find("[name=y_ordering_name]").val())||null,data.y.ordering.isDescending=$form.find("[name=y_ordering_direction]").is(":checked")),skipOrdering=="cells"?data.cells.ordering=null:(data.cells.ordering.name=_.trim($form.find("[name=cells_ordering_name]").val())||null,data.cells.ordering.isDescending=$form.find("[name=cells_ordering_direction]").is(":checked"));var types=[];return $form.find("[name=cells_types]:checked").each(function(){types.push($(this).val())}),data.cells.types=_.compact(types),data.cells.filter=_.trim($form.find("[name=cells_filter]").val()),data},updateForm:function(configurator,$form,space,access){var $filter=$form.find(".i-role-filter-input");$filter.placeholder("refresh"),$form.find(".i-role-filter-control").toggleFilter("refresh");var $cells=$form.find("[name=cells_types]"),$x_type=$form.find("[name=x_types]"),$y_type=$form.find("[name=y_types]"),$cells_filter=$form.find("[name=cells_filter]"),$x_filter=$form.find("[name=x_filter]"),$y_filter=$form.find("[name=y_filter]"),$x_ordering=$form.find("[name=x_ordering_name]"),$y_ordering=$form.find("[name=y_ordering_name]"),$cells_ordering=$form.find("[name=cells_ordering_name]"),$x_ordering_direction=$form.find("[name=x_ordering_direction]"),$y_ordering_direction=$form.find("[name=y_ordering_direction]"),$cells_ordering_direction=$form.find("[name=cells_ordering_direction]"),items=space.cells.types;_.forEach(items,function(item){$cells.filter(function(){return this.value==item.id||$(this).hasClass("permission-denied")}).prop("disabled",!item.isAvailable).toggleClass("tau-disabled",!item.isAvailable).next().prop("disabled",!item.isAvailable).toggleClass("tau-disabled",!item.isAvailable)});var strategyName="remove",updateStrategy={disable:_.bind(this.updateSelectByDisable,this),remove:_.bind(this.updateSelectByRemove,this)}[strategyName];updateStrategy(configurator,$x_type,space.x),updateStrategy(configurator,$y_type,space.y),this.updateFilterState($x_type.val(),$x_filter),this.updateFilterState($y_type.val(),$y_filter),this.updateFilterState($cells.filter(":checked").length,$cells_filter),this.updateOrderingState($x_ordering,space.x.orderingNames),this.updateOrderingState($y_ordering,space.y.orderingNames),this.updateOrderingState($cells_ordering,space.cells.orderingNames),this.updateOrderingDirectionState($x_ordering_direction,space.x.orderingDirection),this.updateOrderingDirectionState($y_ordering_direction,space.y.orderingDirection),this.updateOrderingDirectionState($cells_ordering_direction,space.cells.orderingDirection),this.toggleOrderingDisable($x_type.next(),$x_ordering.find("option").length,access),this.toggleOrderingDisable($y_type.next(),$y_ordering.find("option").length,access),this.toggleOrderingDisable($cells_ordering.parent(),$cells_ordering.find("option").length,access)},updateSelectByRemove:function(configurator,$select,axis){var $opts=configurator.getTemplateFactory().get(axisTypesTemplate.name).bind({},axis);$select.find("option:not(:first)").remove(),$select.append($opts)},updateSelectByDisable:function($select,items){var $opts=$select.find("option");_.forEach(items,function(item){$opts.filter(function(){return this.value==item.id}).prop("disabled",!item.isAvailable)})},setFilterFieldDisabled:function($input,isDisabled){$input.prop("disabled",isDisabled);var closest=$input.closest(".i-role-filter-control");closest.find(".i-role-help").prop("disabled",isDisabled),closest.find(".i-role-filter-toggle").prop("disabled",isDisabled&&!closest.hasClass("i-role-filter-control_on"))},updateFilterState:function(value,$dependentField){var state=!0;value&&!$dependentField.hasClass("permission-denied")&&(state=!1),this.setFilterFieldDisabled($dependentField,state)},updateOrderingState:function($select,data){$select.find("option").remove(),_.forEach(data,function(item){var $o=$('<option value="'+item.id+'">'+item.name+"</option>");item.isSelected&&$o.attr("selected",!0),$select.append($o)})},updateOrderingDirectionState:function($input,data){var b=!!data;$input.prev(":button").toggleClass("tau-sort-dec",b),$input.prev(":button").toggleClass("tau-sort-inc",!b),data?$input.prop("checked",!0):$input.prop("checked",!1)},toggleOrderingDisable:function($el,val,access){access.edit?val>0?$el.find(":input").prop("disabled",!1):$el.find(":input").prop("disabled",!0):val>0?$el.find("select").prop("disabled",!0):$el.find(":input").prop("disabled",!0)}})});
define('tau/ui/extensions/board.editor/ui.extension.board.editor.toggle',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,$editorForm=$el.filter(".tau-board-settings");$el.delegate("[role=action-toggle-editor-more]","click",function(){$el.parent().toggleClass("tau-more-settings"),$editorForm.toggleClass("tau-board-settings_state_full")})}})});
define('tau/ui/templates/board.editor/ui.template.board.editor.autocomplete.item',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.autocomplete.item",engine:"jqote2",markup:['<li class="tau-autocomplete__item">','<a class="tau-autocomplete__itemtrigger tau-autocomplete__itemtrigger-',"<%! this.SuggestionType.toLowerCase() %>",' drop-down-option">',"<%! this.Value %>","</a>","</li>"]};return templates.register(config)});
define('tau/ui/extensions/board.editor/ui.extension.board.editor.autocomplete',["jQuery","Underscore","tau/core/extension.base","tau/ui/templates/board.editor/ui.template.board.editor.autocomplete.item"],function($,_,ExtensionBase,autocompleteItemTemplate){return ExtensionBase.extend({"bus configurator.ready:last + view.dom.ready:last + $form.ready":function(evt,configurator,dom,$form){var $inputs=$form.find(":text"),self=this;$form.delegate(".i-role-clear","click",function(){var $relatedInput=$(this).parent().find(":text");$relatedInput.val("")}),$inputs.bind("click keydown keyup",function(e){var hasText=$(this).val().length>0,$f=$(this).parent();$f.toggleClass("tau-boardsettings__filter_empty_false",hasText)}),$inputs.each(function(){var $input=$(this);$.browser.msie&&$input.bind("keyup",function(event){$(this).data("selectionEnd",this.selectionEnd)}),$input.bind("keydown",function(event){event.keyCode===$.ui.keyCode.TAB&&$(this).data("autocomplete").menu.active&&event.preventDefault(),event.keyCode===$.ui.keyCode.SPACE&&event.ctrlKey&&$(this).autocomplete("search"),event.keyCode===$.ui.keyCode.ESCAPE&&$(this).autocomplete("close")}).bind("clear",function(e){$(this).autocomplete("close")}).bind("focusin",function(event){}).autocomplete({minLength:0,source:function(request,next){var $input=$(this.element);self.fire("filter.autocomplete.resolve",{$input:$input,request:request,next:next})},change:function(e,ui){var $input=$(this);$input.trigger("_change")},focus:function(){return!1},select:function(event,ui){var $input=$(this),selected=ui.item,oldVal=$input.val(),newVal=selected.Source.slice(0,selected.Position.Value);newVal+=selected.LangValue;var endVal=newVal,cursorShouldBe=newVal.length;return newVal+=oldVal.slice($input[0].selectionEnd>0?$input[0].selectionEnd:$input.data("selectionEnd")||0),$input.val(newVal),$input[0].focus(),$input[0].setSelectionRange(cursorShouldBe,cursorShouldBe),$input.data("selectionEnd",cursorShouldBe),_.contains(["ObjectAttribute","ObjectsCollectionAttribute","Method"],selected.SuggestionType)&&setTimeout(function(){$input.autocomplete("search",endVal)},100),self.fire("filter.autocomplete.preload",{value:newVal,$input:$input}),event.stopPropagation(),!1}});var template=configurator.getTemplateFactory().get(autocompleteItemTemplate.name);$input.data("autocomplete")._change=function(a){this._trigger("change",a,{item:this.selectedItem})},$input.data("autocomplete")._renderItem=function(ul,item){return template.bind({},item).data("item.autocomplete",item).appendTo(ul)},$input.data("autocomplete")._renderMenu=function(ul,items){$(ul).addClass("tau-autocomplete__menu").addClass("drop-down-list").css("maxHeight",$(window).height()*.4);var that=this;$.each(items,function(index,item){that._renderItem(ul,item)})}})}})});
define('tau/ui/extensions/board.editor/ui.extension.board.editor.stateSetup',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready + $el.ready":function(e,configurator,$el){var $trigger=$el.find(".i-role-statesetup"),fire=_.bind(this.fire,this);$trigger.on("click",function(){var $trigger=$(this);fire("$stateTrigger.executed",$trigger)}),configurator.getTemplateFactory().register({name:"board.editor.stateSetup.chooseProcess",engine:"jqote2",markup:["<div>","<h3>Please select processes to customize:</h3>",'<div class="tau-buttons">',"<% _.forEach(this.processes, function(v){%>",'<button type="button" class="tau-btn tau-primary" data-id="<%= v.id %>"><%! v.name %></button>',"<% }); %>","</div>","</div>"].join("")})},"bus $form.ready":function(evt,$form){$form.find("[name=x_types], [name=y_types]").each(function(){$(this).parent().find(".i-role-statesetup").toggle($(this).val().toLowerCase()=="entitystate")}),$form.on("change","[name=x_types], [name=y_types]",function(){$(this).parent().find(".i-role-statesetup").toggle($(this).val().toLowerCase()=="entitystate")}),$form.on("_change",function(){$form.find("[name=x_types], [name=y_types]").each(function(){$(this).parent().find(".i-role-statesetup").toggle($(this).val().toLowerCase()=="entitystate")})})},"bus configurator.ready:last + $form.ready:last + $stateTrigger.executed":function(e,configurator,$form,$trigger){var card=$form.find(".tau-board-settings-cards :checkbox:checked").val();card||(card="userstory"),this.fire("card.ready",card),this.getProcess(configurator,$trigger).done(_.bind(function(processId){this.fire("processId.ready",processId)},this))},"bus configurator.ready:last + $stateTrigger.executed:last + card.ready + processId.ready":function(evt,configurator,$trigger,card,processId){var url=configurator.getUrlBuilder().getAdminWorkflowEdit(processId),$frame=$('<iframe class="ui-popup_frame"></iframe>');$trigger.tauPopup(),$trigger.tauPopup("widget").append($frame),$trigger.tauPopup("show"),$trigger.one("taupopuphide",function(){$frame.remove()}),$trigger.tauPopup("widget").tauProgressIndicator(),$trigger.tauPopup("widget").tauProgressIndicator("show"),$frame.css("visibility","hidden"),$frame.attr("src",url),$frame.on("load",function(){var $settings=$(($frame[0].contentDocument||$frame[0].contentWindow.document).body),$s=$settings.find("._entities"),$opt=$s.find("option").filter(function(k,v){return $(v).attr("value").toLowerCase()=="tp.businessobjects."+card.toLowerCase()});$s.val($opt.attr("value")),$s.trigger("change"),setTimeout(function(){$trigger.tauPopup("widget").tauProgressIndicator("hide"),$frame.css("visibility","visible")},100)})},getProcess:function(configurator,$trigger){var def=$.Deferred();return configurator.getAppStateStore().get({fields:["acid"],callback:_.bind(function(result){var acid=result.acid;configurator.getApplicationContextService().getApplicationContext({acid:acid},{success:_.bind(function(context){this.chooseProcess(configurator,$trigger,context.processes).done(def.resolve)},this),failure:_.bind(function(){this.chooseProcess(configurator,$trigger,[]).done(def.resolve)},this)})},this)}),def},chooseProcess:function(configurator,$trigger,processes){var def=$.Deferred(),$c;return processes.length==1?(def.resolve(processes[0].id),def):($c=configurator.getTemplateFactory().get("board.editor.stateSetup.chooseProcess").bind({},{processes:processes}),$trigger.tauBubble({template:['<div class="tau-bubble tau-warning-bubble">','<div class="tau-bubble__arrow"  role="arrow"></div>','<div class="tau-bubble__inner tau-container">','<div role="content">',"</div>","</div>","</div>"].join(""),showOnCreation:!0,content:$c}),$trigger.tauBubble("widget").on("click","button",function(){def.resolve($(this).data("id"))}),def)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.errors',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){var insert=function(where,what,at){return[where.slice(0,at),what,where.slice(at)].join("")},langFilterTranslator={isMatch:function(err){return/BadRequestException$/i.test(err.Type)&&_.isObject(err.InnerException)&&/NotWellFormedLangExpressionException$/i.test(err.InnerException.Type)},buildError:function(err){var details=err.InnerException.Details,message=err.Message,detailsMessage=details.Message;return{message:message,details:detailsMessage}}},somethingGoingWrongTranslator={isMatch:function(err){return/\.HttpException$/i.test(err.Type)&&_.isObject(err.InnerException)&&err.InnerException.Message},buildError:function(err){return{message:err.Message,details:err.InnerException.Message}}},defaultTranslator={isMatch:function(){return!0},buildError:function(err){var msg=err.message||"Looks like application is not available. Please check your connection or server availability";return msg=_.isObject(err)&&_.isString(err.Message)?err.Message:msg,{message:msg}}},generalErrorHandler=function(evt){var self=this,err=evt.data,errorData=translateServerError(err);self.fire("error",errorData)},translateServerError=function(err){var translators=[langFilterTranslator,somethingGoingWrongTranslator,defaultTranslator],translator=_.find(translators,function(translator){return translator.isMatch(err)});return translator.buildError(err)};return ExtensionBase.extend({init:function(){var self=this;self._super.apply(self,arguments),self.generalErrorHandler=_.bind(generalErrorHandler,self);var storage=self.config.context.configurator.getRestStorage();storage.on("error",self.generalErrorHandler)},subscribeSliceToError:function(sliceInstance){var o=this;sliceInstance.on("error",o.generalErrorHandler)},"bus slice.ready":function(evt){var self=this;self.subscribeSliceToError(evt.data.slice),self.subscribeSliceToError(evt.data.base),self.subscribeSliceToError(evt.data.lazy)}})});
define('tau/ui/templates/board.editor/ui.template.board.editor.filterHelp',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.filterHelp",engine:"jqote2",markup:['<div class="filter-help cm-s-default" role="<%= this.name%>_help">',"<table>","<tbody>","<% if (this.predefinedFilters && this.predefinedFilters.length) {%>",'<tr class="filter-help-heading">','<td colspan="3"><h2>Advanced filters <span>(type <strong>?</strong> to use them)</span></h2></td>',"</tr>","<%}%>","<% _.forEach(this.predefinedFilters, function(filter){%>",'<tr class="i-role-complex-filter-example">',"<td>",'<button class="tau-btn tau-primary i-role-predefined-filter" data-value="<%= filter.value %>">use</button>',"</td>",'<td class="filter-help-output i-role-output-filter">',"<%= filter.value %>","</td>","<td>","<%= filter.label %>","</td>","</tr>","<% }); %>","</tbody>","</table>","</div>"],dependencies:[]};return templates.register(config)});
define('tp/codemirror/lib/codemirror',[],function(){var CodeMirror=function(){function CodeMirror(place,givenOptions){function keyMightStartIME(keyCode){return win&&(gecko&&keyCode==229||window.opera&&keyCode==197)||mac&&gecko}function isLine(l){return l>=0&&l<doc.size}function getLine(n){return getLineAt(doc,n)}function updateLineHeight(line,height){gutterDirty=!0;var diff=height-line.height;for(var n=line;n;n=n.parent)n.height+=diff}function setValue(code){var top={line:0,ch:0};updateLines(top,{line:doc.size-1,ch:getLine(doc.size-1).text.length},splitLines(code),top,top),updateInput=!0}function getValue(code){var text=[];return doc.iter(0,doc.size,function(line){text.push(line.text)}),text.join("\n")}function onMouseDown(e){function extend(e){var cur=posFromMouse(e,!0);if(cur&&!posEq(cur,last)){focused||onFocus(),last=cur,setSelectionUser(start,cur),updateInput=!1;var visible=visibleLines();if(cur.line>=visible.to||cur.line<visible.from)going=setTimeout(operation(function(){extend(e)}),150)}}for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==code&&n!=mover)return;for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==gutterText)return options.onGutterClick&&options.onGutterClick(instance,indexOf(gutterText.childNodes,n)+showingFrom,e),e_preventDefault(e);var start=posFromMouse(e);switch(e_button(e)){case 3:gecko&&!mac&&onContextMenu(e);return;case 2:start&&setCursor(start.line,start.ch,!0);return}if(!start){e_target(e)==scroller&&e_preventDefault(e);return}focused||onFocus();var now=+(new Date);if(lastDoubleClick&&lastDoubleClick.time>now-400&&posEq(lastDoubleClick.pos,start))return e_preventDefault(e),setTimeout(focusInput,20),selectLine(start.line);if(lastClick&&lastClick.time>now-400&&posEq(lastClick.pos,start))return lastDoubleClick={time:now,pos:start},e_preventDefault(e),selectWordAt(start);lastClick={time:now,pos:start};var last=start,going;if(dragAndDrop&&!posEq(sel.from,sel.to)&&!posLess(start,sel.from)&&!posLess(sel.to,start)){webkit&&(lineSpace.draggable=!0);var up=connect(targetDocument,"mouseup",operation(function(e2){webkit&&(lineSpace.draggable=!1),draggingText=!1,up(),Math.abs(e.clientX-e2.clientX)+Math.abs(e.clientY-e2.clientY)<10&&(e_preventDefault(e2),setCursor(start.line,start.ch,!0),focusInput())}),!0);draggingText=!0;return}e_preventDefault(e),setCursor(start.line,start.ch,!0);var move=connect(targetDocument,"mousemove",operation(function(e){clearTimeout(going),e_preventDefault(e),extend(e)}),!0),up=connect(targetDocument,"mouseup",operation(function(e){clearTimeout(going);var cur=posFromMouse(e);cur&&setSelectionUser(start,cur),e_preventDefault(e),focusInput(),updateInput=!0,move(),up()}),!0)}function onDoubleClick(e){for(var n=e_target(e);n!=wrapper;n=n.parentNode)if(n.parentNode==gutterText)return e_preventDefault(e);var start=posFromMouse(e);if(!start)return;lastDoubleClick={time:+(new Date),pos:start},e_preventDefault(e),selectWordAt(start)}function onDrop(e){e.preventDefault();var pos=posFromMouse(e,!0),files=e.dataTransfer.files;if(!pos||options.readOnly)return;if(files&&files.length&&window.FileReader&&window.File){function loadFile(file,i){var reader=new FileReader;reader.onload=function(){text[i]=reader.result,++read==n&&(pos=clipPos(pos),operation(function(){var end=replaceRange(text.join(""),pos,pos);setSelectionUser(pos,end)})())},reader.readAsText(file)}var n=files.length,text=Array(n),read=0;for(var i=0;i<n;++i)loadFile(files[i],i)}else try{var text=e.dataTransfer.getData("Text");if(text){var end=replaceRange(text,pos,pos),curFrom=sel.from,curTo=sel.to;setSelectionUser(pos,end),draggingText&&replaceRange("",curFrom,curTo),focusInput()}}catch(e){}}function onDragStart(e){var txt=getSelection();htmlEscape(txt),e.dataTransfer.setDragImage(escapeElement,0,0),e.dataTransfer.setData("Text",txt)}function onKeyDown(e){focused||onFocus();var code=e.keyCode;ie&&code==27&&(e.returnValue=!1);var mod=(mac?e.metaKey:e.ctrlKey)&&!e.altKey,anyMod=e.ctrlKey||e.altKey||e.metaKey;code==16||e.shiftKey?shiftSelecting=shiftSelecting||(sel.inverted?sel.to:sel.from):shiftSelecting=null;if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;if(code==33||code==34)return scrollPage(code==34),e_preventDefault(e);if(mod&&(code==36||code==35||mac&&(code==38||code==40)))return scrollEnd(code==36||code==38),e_preventDefault(e);if(mod&&code==65)return selectAll(),e_preventDefault(e);if(!options.readOnly){if(!anyMod&&code==13)return;if(!anyMod&&code==9&&handleTab(e.shiftKey))return e_preventDefault(e);if(mod&&code==90)return undo(),e_preventDefault(e);if(mod&&(e.shiftKey&&code==90||code==89))return redo(),e_preventDefault(e)}if(code==36&&options.smartHome)return smartHome(),e_preventDefault(e);curKeyId=(mod?"c":"")+(e.altKey?"a":"")+code;if(sel.inverted&&movementKeys[curKeyId]===!0){var range=selRange(input);range&&(reducedSelection={anchor:range.start},setSelRange(input,range.start,range.start))}!mod&&!e.altKey&&(curKeyId=null),fastPoll(curKeyId),options.pollForIME&&keyMightStartIME(code)&&(slowPollInterval=50)}function onKeyUp(e){if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;reducedSelection&&(reducedSelection=null,updateInput=!0),e.keyCode==16&&(shiftSelecting=null),slowPollInterval<2e3&&!alwaysPollForIME&&(slowPollInterval=2e3)}function onKeyPress(e){if(options.onKeyEvent&&options.onKeyEvent(instance,addStop(e)))return;if(options.electricChars&&mode.electricChars){var ch=String.fromCharCode(e.charCode==null?e.keyCode:e.charCode);mode.electricChars.indexOf(ch)>-1&&setTimeout(operation(function(){indentLine(sel.to.line,"smart")}),50)}var code=e.keyCode;code==13?(options.readOnly||handleEnter(),e_preventDefault(e)):!e.ctrlKey&&!e.altKey&&!e.metaKey&&code==9&&options.tabMode!="default"?e_preventDefault(e):fastPoll(curKeyId)}function onFocus(){if(options.readOnly=="nocursor")return;focused||(options.onFocus&&options.onFocus(instance),focused=!0,wrapper.className.search(/\bCodeMirror-focused\b/)==-1&&(wrapper.className+=" CodeMirror-focused"),leaveInputAlone||prepareInput()),slowPoll(),restartBlink()}function onBlur(){focused&&(options.onBlur&&options.onBlur(instance),focused=!1,wrapper.className=wrapper.className.replace(" CodeMirror-focused","")),clearInterval(blinker),setTimeout(function(){focused||(shiftSelecting=null)},150)}function updateLines(from,to,newText,selFrom,selTo){if(history){var old=[];doc.iter(from.line,to.line+1,function(line){old.push(line.text)}),history.addChange(from.line,newText.length,old);while(history.done.length>options.undoDepth)history.done.shift()}updateLinesNoUndo(from,to,newText,selFrom,selTo)}function unredoHelper(from,to){var change=from.pop();if(change){var replaced=[],end=change.start+change.added;doc.iter(change.start,end,function(line){replaced.push(line.text)}),to.push({start:change.start,added:change.old.length,old:replaced});var pos=clipPos({line:change.start+change.old.length-1,ch:editEnd(replaced[replaced.length-1],change.old[change.old.length-1])});updateLinesNoUndo({line:change.start,ch:0},{line:end-1,ch:getLine(end-1).text.length},change.old,pos,pos),updateInput=!0}}function undo(){unredoHelper(history.done,history.undone)}function redo(){unredoHelper(history.undone,history.done)}function updateLinesNoUndo(from,to,newText,selFrom,selTo){function updateLine(n){return n<=Math.min(to.line,to.line+lendiff)?n:n+lendiff}var recomputeMaxLength=!1,maxLineLength=maxLine.length;options.lineWrapping||doc.iter(from.line,to.line,function(line){if(line.text.length==maxLineLength)return recomputeMaxLength=!0,!0});var nlines=to.line-from.line,firstLine=getLine(from.line),lastLine=getLine(to.line);if(firstLine==lastLine)if(newText.length==1)firstLine.replace(from.ch,to.ch,newText[0]);else{lastLine=firstLine.split(to.ch,newText[newText.length-1]),firstLine.replace(from.ch,null,newText[0]),firstLine.fixMarkEnds(lastLine);var added=[];for(var i=1,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],firstLine));added.push(lastLine),doc.insert(from.line+1,added)}else if(newText.length==1)firstLine.replace(from.ch,null,newText[0]),lastLine.replace(null,to.ch,""),firstLine.append(lastLine),doc.remove(from.line+1,nlines);else{var added=[];firstLine.replace(from.ch,null,newText[0]),lastLine.replace(null,to.ch,newText[newText.length-1]),firstLine.fixMarkEnds(lastLine);for(var i=1,e=newText.length-1;i<e;++i)added.push(Line.inheritMarks(newText[i],firstLine));nlines>1&&doc.remove(from.line+1,nlines-1),doc.insert(from.line+1,added)}if(options.lineWrapping){var perLine=scroller.clientWidth/charWidth()-3;doc.iter(from.line,from.line+newText.length,function(line){if(line.hidden)return;var guess=Math.ceil(line.text.length/perLine)||1;guess!=line.height&&updateLineHeight(line,guess)})}else doc.iter(from.line,i+newText.length,function(line){var l=line.text;l.length>maxLineLength&&(maxLine=l,maxLineLength=l.length,maxWidth=null,recomputeMaxLength=!1)}),recomputeMaxLength&&(maxLineLength=0,maxLine="",maxWidth=null,doc.iter(0,doc.size,function(line){var l=line.text;l.length>maxLineLength&&(maxLineLength=l.length,maxLine=l)}));var newWork=[],lendiff=newText.length-nlines-1;for(var i=0,l=work.length;i<l;++i){var task=work[i];task<from.line?newWork.push(task):task>to.line&&newWork.push(task+lendiff)}var hlEnd=from.line+Math.min(newText.length,500);highlightLines(from.line,hlEnd),newWork.push(hlEnd),work=newWork,startWorker(100),changes.push({from:from.line,to:to.line+1,diff:lendiff}),textChanged={from:from,to:to,text:newText},setSelection(selFrom,selTo,updateLine(sel.from.line),updateLine(sel.to.line)),code.style.height=doc.height*textHeight()+2*paddingTop()+"px"}function replaceRange(code,from,to){function adjustPos(pos){if(posLess(pos,from))return pos;if(!posLess(to,pos))return end;var line=pos.line+code.length-(to.line-from.line)-1,ch=pos.ch;return pos.line==to.line&&(ch+=code[code.length-1].length-(to.ch-(to.line==from.line?from.ch:0))),{line:line,ch:ch}}from=clipPos(from),to?to=clipPos(to):to=from,code=splitLines(code);var end;return replaceRange1(code,from,to,function(end1){return end=end1,{from:adjustPos(sel.from),to:adjustPos(sel.to)}}),end}function replaceSelection(code,collapse){replaceRange1(splitLines(code),sel.from,sel.to,function(end){return collapse=="end"?{from:end,to:end}:collapse=="start"?{from:sel.from,to:sel.from}:{from:sel.from,to:end}})}function replaceRange1(code,from,to,computeSel){var endch=code.length==1?code[0].length+from.ch:code[code.length-1].length,newSel=computeSel({line:from.line+code.length-1,ch:endch});updateLines(from,to,code,newSel.from,newSel.to)}function getRange(from,to){var l1=from.line,l2=to.line;if(l1==l2)return getLine(l1).text.slice(from.ch,to.ch);var code=[getLine(l1).text.slice(from.ch)];return doc.iter(l1+1,l2,function(line){code.push(line.text)}),code.push(getLine(l2).text.slice(0,to.ch)),code.join("\n")}function getSelection(){return getRange(sel.from,sel.to)}function slowPoll(){if(pollingFast)return;poll.set(slowPollInterval,function(){startOperation(),readInput(),focused&&slowPoll(),endOperation()})}function fastPoll(keyId){function p(){startOperation();var changed=readInput();changed&&keyId&&(changed=="moved"&&movementKeys[keyId]==null&&(movementKeys[keyId]=!0),changed=="changed"&&(movementKeys[keyId]=!1)),!changed&&!missed?(missed=!0,poll.set(80,p)):(pollingFast=!1,slowPoll()),endOperation()}var missed=!1;pollingFast=!0,poll.set(20,p)}function readInput(){function computeOffset(n,startLine){var pos=0;for(;;){var found=text.indexOf("\n",pos);if(found==-1||(text.charAt(found-1)=="\r"?found-1:found)>=n)return{line:startLine,ch:n-pos};++startLine,pos=found+1}}if(leaveInputAlone||!focused)return;var changed=!1,text=input.value,sr=selRange(input);if(!sr)return!1;var changed=editing.text!=text,rs=reducedSelection,moved=changed||sr.start!=editing.start||sr.end!=(rs?editing.start:editing.end);if(!moved&&!rs)return!1;if(changed){shiftSelecting=reducedSelection=null;if(options.readOnly)return updateInput=!0,"changed"}var from=computeOffset(sr.start,editing.from),to=computeOffset(sr.end,editing.from);if(rs){var head=sr.start==rs.anchor?to:from,tail=shiftSelecting?sel.to:sr.start==rs.anchor?from:to;(sel.inverted=posLess(head,tail))?(from=head,to=tail):(reducedSelection=null,from=tail,to=head)}from.line==to.line&&from.line==sel.from.line&&from.line==sel.to.line&&!shiftSelecting&&(updateInput=!1);if(changed){var start=0,end=text.length,len=Math.min(end,editing.text.length),c,line=editing.from,nl=-1;while(start<len&&(c=text.charAt(start))==editing.text.charAt(start))++start,c=="\n"&&(line++,nl=start);var ch=nl>-1?start-nl:start,endline=editing.to-1,edend=editing.text.length;for(;;){c=editing.text.charAt(edend);if(text.charAt(end)!=c){++end,++edend;break}c=="\n"&&endline--;if(edend<=start||end<=start)break;--end,--edend}var nl=editing.text.lastIndexOf("\n",edend-1),endch=nl==-1?edend:edend-nl-1;updateLines({line:line,ch:ch},{line:endline,ch:endch},splitLines(text.slice(start,end)),from,to);if(line!=endline||from.line!=line)updateInput=!0}else setSelection(from,to);return editing.text=text,editing.start=sr.start,editing.end=sr.end,changed?"changed":moved?"moved":!1}function prepareInput(){var text=[],from=Math.max(0,sel.from.line-1),to=Math.min(doc.size,sel.to.line+2);doc.iter(from,to,function(line){text.push(line.text)}),text=input.value=text.join(lineSep);var startch=sel.from.ch,endch=sel.to.ch;doc.iter(from,sel.from.line,function(line){startch+=lineSep.length+line.text.length}),doc.iter(from,sel.to.line,function(line){endch+=lineSep.length+line.text.length}),editing={text:text,from:from,to:to,start:startch,end:endch},setSelRange(input,startch,reducedSelection?startch:endch)}function focusInput(){options.readOnly!="nocursor"&&input.focus()}function scrollEditorIntoView(){if(!cursor.getBoundingClientRect)return;var rect=cursor.getBoundingClientRect(),winH=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(rect.top<0||rect.bottom>winH)&&cursor.scrollIntoView()}function scrollCursorIntoView(){var cursor=localCoords(sel.inverted?sel.from:sel.to),x=options.lineWrapping?Math.min(cursor.x,lineSpace.offsetWidth):cursor.x;return scrollIntoView(x,cursor.y,x,cursor.yBot)}function scrollIntoView(x1,y1,x2,y2){var pl=paddingLeft(),pt=paddingTop(),lh=textHeight();y1+=pt,y2+=pt,x1+=pl,x2+=pl;var screen=scroller.clientHeight,screentop=scroller.scrollTop,scrolled=!1,result=!0;y1<screentop?(scroller.scrollTop=Math.max(0,y1-2*lh),scrolled=!0):y2>screentop+screen&&(scroller.scrollTop=y2+lh-screen,scrolled=!0);var screenw=scroller.clientWidth,screenleft=scroller.scrollLeft,gutterw=options.fixedGutter?gutter.clientWidth:0;return x1<screenleft+gutterw?(x1<50&&(x1=0),scroller.scrollLeft=Math.max(0,x1-10-gutterw),scrolled=!0):x2>screenw+screenleft&&(scroller.scrollLeft=x2+10-screenw,scrolled=!0,x2>code.clientWidth&&(result=!1)),scrolled&&options.onScroll&&options.onScroll(instance),result}function visibleLines(){var lh=textHeight(),top=scroller.scrollTop-paddingTop(),from_height=Math.max(0,Math.floor(top/lh)),to_height=Math.ceil((top+scroller.clientHeight)/lh);return{from:lineAtHeight(doc,from_height),to:lineAtHeight(doc,to_height)}}function updateDisplay(changes){if(!scroller.clientWidth){showingFrom=showingTo=displayOffset=0;return}var visible=visibleLines();if(changes!==!0&&changes.length==0&&visible.from>=showingFrom&&visible.to<=showingTo)return;var from=Math.max(visible.from-100,0),to=Math.min(doc.size,visible.to+100);showingFrom<from&&from-showingFrom<20&&(from=showingFrom),showingTo>to&&showingTo-to<20&&(to=Math.min(doc.size,showingTo));var intact=changes===!0?[]:computeIntact([{from:showingFrom,to:showingTo,domStart:0}],changes),intactLines=0;for(var i=0;i<intact.length;++i){var range=intact[i];range.from<from&&(range.domStart+=from-range.from,range.from=from),range.to>to&&(range.to=to),range.from>=range.to?intact.splice(i--,1):intactLines+=range.to-range.from}if(intactLines==to-from)return;intact.sort(function(a,b){return a.domStart-b.domStart});var th=textHeight(),gutterDisplay=gutter.style.display;lineDiv.style.display=gutter.style.display="none",patchDisplay(from,to,intact),lineDiv.style.display="";var different=from!=showingFrom||to!=showingTo||lastHeight!=scroller.clientHeight;different&&(lastHeight=scroller.clientHeight),showingFrom=from,showingTo=to,displayOffset=heightAtLine(doc,from),mover.style.top=displayOffset*th+"px",code.style.height=doc.height*th+2*paddingTop()+"px";if(lineDiv.childNodes.length!=showingTo-showingFrom)throw new Error("BAD PATCH! "+JSON.stringify(intact)+" size="+(showingTo-showingFrom)+" nodes="+lineDiv.childNodes.length);if(options.lineWrapping){maxWidth=scroller.clientWidth;var curNode=lineDiv.firstChild;doc.iter(showingFrom,showingTo,function(line){if(!line.hidden){var height=Math.round(curNode.offsetHeight/th)||1;line.height!=height&&(updateLineHeight(line,height),gutterDirty=!0)}curNode=curNode.nextSibling})}else maxWidth==null&&(maxWidth=stringWidth(maxLine)),maxWidth>scroller.clientWidth?(lineSpace.style.width=maxWidth+"px",code.style.width="",code.style.width=scroller.scrollWidth+"px"):lineSpace.style.width=code.style.width="";gutter.style.display=gutterDisplay,(different||gutterDirty)&&updateGutter(),updateCursor()}function computeIntact(intact,changes){for(var i=0,l=changes.length||0;i<l;++i){var change=changes[i],intact2=[],diff=change.diff||0;for(var j=0,l2=intact.length;j<l2;++j){var range=intact[j];change.to<=range.from&&change.diff?intact2.push({from:range.from+diff,to:range.to+diff,domStart:range.domStart}):change.to<=range.from||change.from>=range.to?intact2.push(range):(change.from>range.from&&intact2.push({from:range.from,to:change.from,domStart:range.domStart}),change.to<range.to&&intact2.push({from:change.to+diff,to:range.to+diff,domStart:range.domStart+(change.to-range.from)}))}intact=intact2}return intact}function patchDisplay(from,to,intact){if(!intact.length)lineDiv.innerHTML="";else{function killNode(node){var tmp=node.nextSibling;return node.parentNode.removeChild(node),tmp}var domPos=0,curNode=lineDiv.firstChild,n;for(var i=0;i<intact.length;++i){var cur=intact[i];while(cur.domStart>domPos)curNode=killNode(curNode),domPos++;for(var j=0,e=cur.to-cur.from;j<e;++j)curNode=curNode.nextSibling,domPos++}while(curNode)curNode=killNode(curNode)}var nextIntact=intact.shift(),curNode=lineDiv.firstChild,j=from,sfrom=sel.from.line,sto=sel.to.line,inSel=sfrom<from&&sto>=from,scratch=targetDocument.createElement("div"),newElt;doc.iter(from,to,function(line){var ch1=null,ch2=null;inSel?(ch1=0,sto==j&&(inSel=!1,ch2=sel.to.ch)):sfrom==j&&(sto==j?(ch1=sel.from.ch,ch2=sel.to.ch):(inSel=!0,ch1=sel.from.ch)),nextIntact&&nextIntact.to==j&&(nextIntact=intact.shift()),!nextIntact||nextIntact.from>j?(line.hidden?scratch.innerHTML="<pre></pre>":scratch.innerHTML=line.getHTML(ch1,ch2,!0),lineDiv.insertBefore(scratch.firstChild,curNode)):curNode=curNode.nextSibling,++j})}function updateGutter(){if(!options.gutter&&!options.lineNumbers)return;var hText=mover.offsetHeight,hEditor=scroller.clientHeight;gutter.style.height=(hText-hEditor<2?hEditor:hText)+"px";var html=[],i=showingFrom;doc.iter(showingFrom,Math.max(showingTo,showingFrom+1),function(line){if(line.hidden)html.push("<pre></pre>");else{var marker=line.gutterMarker,text=options.lineNumbers?i+options.firstLineNumber:null;marker&&marker.text?text=marker.text.replace("%N%",text!=null?text:""):text==null&&(text=""),html.push(marker&&marker.style?'<pre class="'+marker.style+'">':"<pre>",text);for(var j=1;j<line.height;++j)html.push("<br>&nbsp;");html.push("</pre>")}++i}),gutter.style.display="none",gutterText.innerHTML=html.join("");var minwidth=String(doc.size).length,firstNode=gutterText.firstChild,val=eltText(firstNode),pad="";while(val.length+pad.length<minwidth)pad+="";pad&&firstNode.insertBefore(targetDocument.createTextNode(pad),firstNode.firstChild),gutter.style.display="",lineSpace.style.marginLeft=gutter.offsetWidth+"px",gutterDirty=!1}function updateCursor(){var head=sel.inverted?sel.from:sel.to,lh=textHeight(),pos=localCoords(head,!0),globalY=pos.y+displayOffset*textHeight();inputDiv.style.top=Math.max(Math.min(globalY,scroller.offsetHeight),0)+"px",inputDiv.style.left=pos.x-scroller.scrollLeft+"px",posEq(sel.from,sel.to)?(cursor.style.top=pos.y+"px",cursor.style.left=(options.lineWrapping?Math.min(pos.x,lineSpace.offsetWidth):pos.x)+"px",cursor.style.display=""):cursor.style.display="none"}function setSelectionUser(from,to){var sh=shiftSelecting&&clipPos(shiftSelecting);sh&&(posLess(sh,from)?from=sh:posLess(to,sh)&&(to=sh)),setSelection(from,to)}function setSelection(from,to,oldFrom,oldTo){oldFrom==null&&(oldFrom=sel.from.line,oldTo=sel.to.line);if(posEq(sel.from,from)&&posEq(sel.to,to))return;if(posLess(to,from)){var tmp=to;to=from,from=tmp}from.line!=oldFrom&&(from=skipHidden(from,oldFrom,sel.from.ch)),to.line!=oldTo&&(to=skipHidden(to,oldTo,sel.to.ch)),posEq(from,to)?sel.inverted=!1:posEq(from,sel.to)?sel.inverted=!1:posEq(to,sel.from)&&(sel.inverted=!0),posEq(from,to)?posEq(sel.from,sel.to)||changes.push({from:oldFrom,to:oldTo+1}):posEq(sel.from,sel.to)?changes.push({from:from.line,to:to.line+1}):(posEq(from,sel.from)||(from.line<oldFrom?changes.push({from:from.line,to:Math.min(to.line,oldFrom)+1}):changes.push({from:oldFrom,to:Math.min(oldTo,from.line)+1})),posEq(to,sel.to)||(to.line<oldTo?changes.push({from:Math.max(oldFrom,from.line),to:oldTo+1}):changes.push({from:Math.max(from.line,oldTo),to:to.line+1}))),sel.from=from,sel.to=to,selectionChanged=!0}function skipHidden(pos,oldLine,oldCh){function getNonHidden(dir){var lNo=pos.line+dir,end=dir==1?doc.size:-1;while(lNo!=end){var line=getLine(lNo);if(!line.hidden){var ch=pos.ch;if(ch>oldCh||ch>line.text.length)ch=line.text.length;return{line:lNo,ch:ch}}lNo+=dir}}var line=getLine(pos.line);return line.hidden?pos.line>=oldLine?getNonHidden(1)||getNonHidden(-1):getNonHidden(-1)||getNonHidden(1):pos}function setCursor(line,ch,user){var pos=clipPos({line:line,ch:ch||0});(user?setSelectionUser:setSelection)(pos,pos)}function clipLine(n){return Math.max(0,Math.min(n,doc.size-1))}function clipPos(pos){if(pos.line<0)return{line:0,ch:0};if(pos.line>=doc.size)return{line:doc.size-1,ch:getLine(doc.size-1).text.length};var ch=pos.ch,linelen=getLine(pos.line).text.length;return ch==null||ch>linelen?{line:pos.line,ch:linelen}:ch<0?{line:pos.line,ch:0}:pos}function scrollPage(down){var linesPerPage=Math.floor(scroller.clientHeight/textHeight()),head=sel.inverted?sel.from:sel.to,target=heightAtLine(doc,head.line)+Math.max(linesPerPage-1,1)*(down?1:-1);setCursor(lineAtHeight(doc,target),head.ch,!0)}function scrollEnd(top){var pos=top?{line:0,ch:0}:{line:doc.size-1,ch:getLine(doc.size-1).text.length};setSelectionUser(pos,pos)}function selectAll(){var endLine=doc.size-1;setSelection({line:0,ch:0},{line:endLine,ch:getLine(endLine).text.length})}function selectWordAt(pos){var line=getLine(pos.line).text,start=pos.ch,end=pos.ch;while(start>0&&/\w/.test(line.charAt(start-1)))--start;while(end<line.length&&/\w/.test(line.charAt(end)))++end;setSelectionUser({line:pos.line,ch:start},{line:pos.line,ch:end})}function selectLine(line){setSelectionUser({line:line,ch:0},{line:line,ch:getLine(line).text.length})}function handleEnter(){replaceSelection("\n","end"),options.enterMode!="flat"&&indentLine(sel.from.line,options.enterMode=="keep"?"prev":"smart")}function handleTab(shift){function indentSelected(mode){if(posEq(sel.from,sel.to))return indentLine(sel.from.line,mode);var e=sel.to.line-(sel.to.ch?0:1);for(var i=sel.from.line;i<=e;++i)indentLine(i,mode)}shiftSelecting=null;switch(options.tabMode){case"default":return!1;case"indent":indentSelected("smart");break;case"classic":if(posEq(sel.from,sel.to)){shift?indentLine(sel.from.line,"smart"):replaceSelection("	","end");break};case"shift":indentSelected(shift?"subtract":"add")}return!0}function smartHome(){var firstNonWS=Math.max(0,getLine(sel.from.line).text.search(/\S/));setCursor(sel.from.line,sel.from.ch<=firstNonWS&&sel.from.ch?0:firstNonWS,!0)}function indentLine(n,how){if(how=="smart")if(!mode.indent)how="prev";else var state=getStateBefore(n);var line=getLine(n),curSpace=line.indentation(),curSpaceString=line.text.match(/^\s*/)[0],indentation;how=="prev"?n?indentation=getLine(n-1).indentation():indentation=0:how=="smart"?indentation=mode.indent(state,line.text.slice(curSpaceString.length)):how=="add"?indentation=curSpace+options.indentUnit:how=="subtract"&&(indentation=curSpace-options.indentUnit),indentation=Math.max(0,indentation);var diff=indentation-curSpace;if(!diff){if(sel.from.line!=n&&sel.to.line!=n)return;var indentString=curSpaceString}else{var indentString="",pos=0;if(options.indentWithTabs)for(var i=Math.floor(indentation/tabSize);i;--i)pos+=tabSize,indentString+="	";while(pos<indentation)++pos,indentString+=" "}replaceRange(indentString,{line:n,ch:0},{line:n,ch:curSpaceString.length})}function loadMode(){mode=CodeMirror.getMode(options,options.mode),doc.iter(0,doc.size,function(line){line.stateAfter=null}),work=[0],startWorker()}function gutterChanged(){var visible=options.gutter||options.lineNumbers;gutter.style.display=visible?"":"none",visible?gutterDirty=!0:lineDiv.parentNode.style.marginLeft=0}function wrappingChanged(from,to){if(options.lineWrapping){wrapper.className+=" CodeMirror-wrap";var perLine=scroller.clientWidth/charWidth()-3;doc.iter(0,doc.size,function(line){if(line.hidden)return;var guess=Math.ceil(line.text.length/perLine)||1;guess!=1&&updateLineHeight(line,guess)}),lineSpace.style.width=code.style.width=""}else wrapper.className=wrapper.className.replace(" CodeMirror-wrap",""),maxWidth=null,maxLine="",doc.iter(0,doc.size,function(line){line.height!=1&&!line.hidden&&updateLineHeight(line,1),line.text.length>maxLine.length&&(maxLine=line.text)});changes.push({from:0,to:doc.size})}function TextMarker(){this.set=[]}function markText(from,to,className){function add(line,from,to,className){mark=getLine(line).addMark(new MarkedText(from,to,className,tm.set))}from=clipPos(from),to=clipPos(to);var tm=new TextMarker;if(from.line==to.line)add(from.line,from.ch,to.ch,className);else{add(from.line,from.ch,null,className);for(var i=from.line+1,e=to.line;i<e;++i)add(i,null,null,className);add(to.line,null,to.ch,className)}return changes.push({from:from.line,to:to.line+1}),tm}function setBookmark(pos){pos=clipPos(pos);var bm=new Bookmark(pos.ch);return getLine(pos.line).addMark(bm),bm}function addGutterMarker(line,text,className){return typeof line=="number"&&(line=getLine(clipLine(line))),line.gutterMarker={text:text,style:className},gutterDirty=!0,line}function removeGutterMarker(line){typeof line=="number"&&(line=getLine(clipLine(line))),line.gutterMarker=null,gutterDirty=!0}function changeLine(handle,op){var no=handle,line=handle;return typeof handle=="number"?line=getLine(clipLine(handle)):no=lineNo(handle),no==null?null:(op(line,no)&&changes.push({from:no,to:no+1}),line)}function setLineClass(handle,className){return changeLine(handle,function(line){if(line.className!=className)return line.className=className,!0})}function setLineHidden(handle,hidden){return changeLine(handle,function(line,no){if(line.hidden!=hidden)return line.hidden=hidden,updateLineHeight(line,hidden?0:1),hidden&&(sel.from.line==no||sel.to.line==no)&&setSelection(skipHidden(sel.from,sel.from.line,sel.from.ch),skipHidden(sel.to,sel.to.line,sel.to.ch)),gutterDirty=!0})}function lineInfo(line){if(typeof line=="number"){if(!isLine(line))return null;var n=line;line=getLine(line);if(!line)return null}else{var n=lineNo(line);if(n==null)return null}var marker=line.gutterMarker;return{line:n,handle:line,text:line.text,markerText:marker&&marker.text,markerClass:marker&&marker.style,lineClass:line.className}}function stringWidth(str){return measure.innerHTML="<pre><span>x</span></pre>",measure.firstChild.firstChild.firstChild.nodeValue=str,measure.firstChild.firstChild.offsetWidth||10}function charFromX(line,x){function getX(len){return measure.innerHTML="<pre><span>"+lineObj.getHTML(null,null,!1,len)+"</span></pre>",measure.firstChild.firstChild.offsetWidth}if(x<=0)return 0;var lineObj=getLine(line),text=lineObj.text,from=0,fromX=0,to=text.length,toX,estimated=Math.min(to,Math.ceil(x/charWidth()));for(;;){var estX=getX(estimated);if(!(estX<=x&&estimated<to)){toX=estX,to=estimated;break}estimated=Math.min(to,Math.ceil(estimated*1.2))}if(x>toX)return to;estimated=Math.floor(to*.8),estX=getX(estimated),estX<x&&(from=estimated,fromX=estX);for(;;){if(to-from<=1)return toX-x>x-fromX?from:to;var middle=Math.ceil((from+to)/2),middleX=getX(middle);middleX>x?(to=middle,toX=middleX):(from=middle,fromX=middleX)}}function measureLine(line,ch){var extra="";if(options.lineWrapping){var end=line.text.indexOf(" ",ch+2);extra=line.text.slice(ch+1,end<0?line.text.length:end+(ie?5:0))}measure.innerHTML="<pre>"+line.getHTML(null,null,!1,ch)+'<span id="CodeMirror-temp-'+tempId+'">'+(line.text.charAt(ch)||" ")+"</span>"+extra+"</pre>";var elt=document.getElementById("CodeMirror-temp-"+tempId),top=elt.offsetTop,left=elt.offsetLeft;if(ie&&ch&&top==0&&left==0){var backup=document.createElement("span");backup.innerHTML="x",elt.parentNode.insertBefore(backup,elt.nextSibling),top=backup.offsetTop}return{top:top,left:left}}function localCoords(pos,inLineWrap){var x,lh=textHeight(),y=lh*(heightAtLine(doc,pos.line)-(inLineWrap?displayOffset:0));if(pos.ch==0)x=0;else{var sp=measureLine(getLine(pos.line),pos.ch);x=sp.left,options.lineWrapping&&(y+=Math.max(0,sp.top))}return{x:x,y:y,yBot:y+lh}}function coordsChar(x,y){function getX(len){var sp=measureLine(lineObj,len);if(tw){var off=Math.round(sp.top/th);return Math.max(0,sp.left+(off-innerOff)*scroller.clientWidth)}return sp.left}y<0&&(y=0);var th=textHeight(),cw=charWidth(),heightPos=displayOffset+Math.floor(y/th),lineNo=lineAtHeight(doc,heightPos);if(lineNo>=doc.size)return{line:doc.size-1,ch:0};var lineObj=getLine(lineNo),text=lineObj.text,tw=options.lineWrapping,innerOff=tw?heightPos-heightAtLine(doc,lineNo):0;if(x<=0&&innerOff==0)return{line:lineNo,ch:0};var from=0,fromX=0,to=text.length,toX,estimated=Math.min(to,Math.ceil((x+innerOff*scroller.clientWidth*.9)/cw));for(;;){var estX=getX(estimated);if(!(estX<=x&&estimated<to)){toX=estX,to=estimated;break}estimated=Math.min(to,Math.ceil(estimated*1.2))}if(x>toX)return{line:lineNo,ch:to};estimated=Math.floor(to*.8),estX=getX(estimated),estX<x&&(from=estimated,fromX=estX);for(;;){if(to-from<=1)return{line:lineNo,ch:toX-x>x-fromX?from:to};var middle=Math.ceil((from+to)/2),middleX=getX(middle);middleX>x?(to=middle,toX=middleX):(from=middle,fromX=middleX)}}function pageCoords(pos){var local=localCoords(pos,!0),off=eltOffset(lineSpace);return{x:off.left+local.x,y:off.top+local.y,yBot:off.top+local.yBot}}function textHeight(){var offsetHeight=lineDiv.offsetHeight;return offsetHeight==cachedFor?cachedHeight:(cachedFor=offsetHeight,measure.innerHTML="<pre>x<br>x<br>x<br>x<br>x<br>x<br>x<br>x<br>x<br>x</pre>",cachedHeight=measure.firstChild.offsetHeight/10||1)}function charWidth(){return scroller.clientWidth==cachedFor?cachedWidth:(cachedFor=scroller.clientWidth,cachedWidth=stringWidth("x"))}function paddingTop(){return lineSpace.offsetTop}function paddingLeft(){return lineSpace.offsetLeft}function posFromMouse(e,liberal){var offW=eltOffset(scroller,!0),x,y;try{x=e.clientX,y=e.clientY}catch(e){return null}if(!liberal&&(x-offW.left>scroller.clientWidth||y-offW.top>scroller.clientHeight))return null;var offL=eltOffset(lineSpace,!0);return coordsChar(x-offL.left,y-offL.top)}function onContextMenu(e){function rehide(){var newVal=splitLines(input.value).join("\n");newVal!=val&&operation(replaceSelection)(newVal,"end"),inputDiv.style.position="relative",input.style.cssText=oldCSS,leaveInputAlone=!1,prepareInput(),slowPoll()}var pos=posFromMouse(e);if(!pos||window.opera)return;(posEq(sel.from,sel.to)||posLess(pos,sel.from)||!posLess(pos,sel.to))&&operation(setCursor)(pos.line,pos.ch);var oldCSS=input.style.cssText;inputDiv.style.position="absolute",input.style.cssText="position: fixed; width: 30px; height: 30px; top: "+(e.clientY-5)+"px; left: "+(e.clientX-5)+"px; z-index: 1000; background: white; "+"border-width: 0; outline: none; overflow: hidden; opacity: .05; filter: alpha(opacity=5);",leaveInputAlone=!0;var val=input.value=getSelection();focusInput(),setSelRange(input,0,input.value.length);if(gecko){e_stop(e);var mouseup=connect(window,"mouseup",function(){mouseup(),setTimeout(rehide,20)},!0)}else setTimeout(rehide,50)}function restartBlink(){clearInterval(blinker);var on=!0;cursor.style.visibility="",blinker=setInterval(function(){cursor.style.visibility=(on=!on)?"":"hidden"},650)}function matchBrackets(autoclear){function scan(line,from,to){if(!line.text)return;var st=line.styles,pos=forward?0:line.text.length-1,cur;for(var i=forward?0:st.length-2,e=forward?st.length:-2;i!=e;i+=2*d){var text=st[i];if(st[i+1]!=null&&st[i+1]!=style){pos+=d*text.length;continue}for(var j=forward?0:text.length-1,te=forward?text.length:-1;j!=te;j+=d,pos+=d)if(pos>=from&&pos<to&&re.test(cur=text.charAt(j))){var match=matching[cur];if(match.charAt(1)==">"==forward)stack.push(cur);else{if(stack.pop()!=match.charAt(0))return{pos:pos,match:!1};if(!stack.length)return{pos:pos,match:!0}}}}}var head=sel.inverted?sel.from:sel.to,line=getLine(head.line),pos=head.ch-1,match=pos>=0&&matching[line.text.charAt(pos)]||matching[line.text.charAt(++pos)];if(!match)return;var ch=match.charAt(0),forward=match.charAt(1)==">",d=forward?1:-1,st=line.styles;for(var off=pos+1,i=0,e=st.length;i<e;i+=2)if((off-=st[i].length)<=0){var style=st[i+1];break}var stack=[line.text.charAt(pos)],re=/[(){}[\]]/;for(var i=head.line,e=forward?Math.min(i+100,doc.size):Math.max(-1,i-100);i!=e;i+=d){var line=getLine(i),first=i==head.line,found=scan(line,first&&forward?pos+1:0,first&&!forward?pos:line.text.length);if(found)break}found||(found={pos:null,match:!1});var style=found.match?"CodeMirror-matchingbracket":"CodeMirror-nonmatchingbracket",one=markText({line:head.line,ch:pos},{line:head.line,ch:pos+1},style),two=found.pos!=null&&markText({line:i,ch:found.pos},{line:i,ch:found.pos+1},style),clear=operation(function(){one.clear(),two&&two.clear()});autoclear?setTimeout(clear,800):bracketHighlighted=clear}function findStartLine(n){var minindent,minline;for(var search=n,lim=n-40;search>lim;--search){if(search==0)return 0;var line=getLine(search-1);if(line.stateAfter)return search;var indented=line.indentation();if(minline==null||minindent>indented)minline=search-1,minindent=indented}return minline}function getStateBefore(n){var start=findStartLine(n),state=start&&getLine(start-1).stateAfter;return state?state=copyState(mode,state):state=startState(mode),doc.iter(start,n,function(line){line.highlight(mode,state),line.stateAfter=copyState(mode,state)}),start<n&&changes.push({from:start,to:n}),n<doc.size&&!getLine(n).stateAfter&&work.push(n),state}function highlightLines(start,end){var state=getStateBefore(start);doc.iter(start,end,function(line){line.highlight(mode,state),line.stateAfter=copyState(mode,state)})}function highlightWorker(){var end=+(new Date)+options.workTime,foundWork=work.length;while(work.length){if(!getLine(showingFrom).stateAfter)var task=showingFrom;else var task=work.pop();if(task>=doc.size)continue;var start=findStartLine(task),state=start&&getLine(start-1).stateAfter;state?state=copyState(mode,state):state=startState(mode);var unchanged=0,compare=mode.compareStates,realChange=!1,i=start,bail=!1;doc.iter(i,doc.size,function(line){var hadState=line.stateAfter;if(+(new Date)>end)return work.push(i),startWorker(options.workDelay),realChange&&changes.push({from:task,to:i+1}),bail=!0;var changed=line.highlight(mode,state);changed&&(realChange=!0),line.stateAfter=copyState(mode,state);if(compare){if(hadState&&compare(hadState,state))return!0}else if(changed!==!1||!hadState)unchanged=0;else if(++unchanged>3)return!0;++i});if(bail)return;realChange&&changes.push({from:task,to:i+1})}foundWork&&options.onHighlightComplete&&options.onHighlightComplete(instance)}function startWorker(time){if(!work.length)return;highlight.set(time,operation(highlightWorker))}function startOperation(){updateInput=null,changes=[],textChanged=selectionChanged=!1}function endOperation(){var reScroll=!1;selectionChanged&&(reScroll=!scrollCursorIntoView()),changes.length?updateDisplay(changes):(selectionChanged&&updateCursor(),gutterDirty&&updateGutter()),reScroll&&scrollCursorIntoView(),selectionChanged&&(scrollEditorIntoView(),restartBlink()),focused&&!leaveInputAlone&&(updateInput===!0||updateInput!==!1&&selectionChanged)&&prepareInput(),selectionChanged&&options.matchBrackets&&setTimeout(operation(function(){bracketHighlighted&&(bracketHighlighted(),bracketHighlighted=null),matchBrackets(!1)}),20);var tc=textChanged;selectionChanged&&options.onCursorActivity&&options.onCursorActivity(instance),tc&&options.onChange&&instance&&options.onChange(instance,tc)}function operation(f){return function(){nestedOperation++||startOperation();try{var result=f.apply(this,arguments)}finally{--nestedOperation||endOperation()}return result}}function SearchCursor(query,pos,caseFold){this.atOccurrence=!1,caseFold==null&&(caseFold=typeof query=="string"&&query==query.toLowerCase()),pos&&typeof pos=="object"?pos=clipPos(pos):pos={line:0,ch:0},this.pos={from:pos,to:pos};if(typeof query!="string")this.matches=function(reverse,pos){if(reverse){var line=getLine(pos.line).text.slice(0,pos.ch),match=line.match(query),start=0;while(match){var ind=line.indexOf(match[0]);start+=ind,line=line.slice(ind+1);var newmatch=line.match(query);if(!newmatch)break;match=newmatch,start++}}else var line=getLine(pos.line).text.slice(pos.ch),match=line.match(query),start=match&&pos.ch+line.indexOf(match[0]);if(match)return{from:{line:pos.line,ch:start},to:{line:pos.line,ch:start+match[0].length},match:match}};else{caseFold&&(query=query.toLowerCase());var fold=caseFold?function(str){return str.toLowerCase()}:function(str){return str},target=query.split("\n");target.length==1?this.matches=function(reverse,pos){var line=fold(getLine(pos.line).text),len=query.length,match;if(reverse?pos.ch>=len&&(match=line.lastIndexOf(query,pos.ch-len))!=-1:(match=line.indexOf(query,pos.ch))!=-1)return{from:{line:pos.line,ch:match},to:{line:pos.line,ch:match+len}}}:this.matches=function(reverse,pos){var ln=pos.line,idx=reverse?target.length-1:0,match=target[idx],line=fold(getLine(ln).text),offsetA=reverse?line.indexOf(match)+match.length:line.lastIndexOf(match);if(reverse?offsetA>=pos.ch||offsetA!=match.length:offsetA<=pos.ch||offsetA!=line.length-match.length)return;for(;;){if(reverse?!ln:ln==doc.size-1)return;line=fold(getLine(ln+=reverse?-1:1).text),match=target[reverse?--idx:++idx];if(idx>0&&idx<target.length-1){if(line!=match)return;continue}var offsetB=reverse?line.lastIndexOf(match):line.indexOf(match)+match.length;if(reverse?offsetB!=line.length-match.length:offsetB!=match.length)return;var start={line:pos.line,ch:offsetA},end={line:ln,ch:offsetB};return{from:reverse?end:start,to:reverse?start:end}}}}}var options={},defaults=CodeMirror.defaults;for(var opt in defaults)defaults.hasOwnProperty(opt)&&(options[opt]=(givenOptions&&givenOptions.hasOwnProperty(opt)?givenOptions:defaults)[opt]);var targetDocument=options.document,wrapper=targetDocument.createElement("div");wrapper.className="CodeMirror"+(options.lineWrapping?" CodeMirror-wrap":""),wrapper.innerHTML='<div style="overflow: hidden; position: relative; width: 1px; height: 0px;"><textarea style="position: absolute; width: 10000px;" wrap="off" autocorrect="off" autocapitalize="off"></textarea></div><div class="CodeMirror-scroll cm-s-'+options.theme+'">'+'<div style="position: relative">'+'<div style="position: relative">'+'<div class="CodeMirror-gutter"><div class="CodeMirror-gutter-text"></div></div>'+'<div class="CodeMirror-lines"><div style="position: relative">'+'<div style="position: absolute; width: 100%; height: 0; overflow: hidden; visibility: hidden"></div>'+'<pre class="CodeMirror-cursor">&#160;</pre>'+"<div></div>"+"</div></div></div></div></div>",place.appendChild?place.appendChild(wrapper):place(wrapper);var inputDiv=wrapper.firstChild,input=inputDiv.firstChild,scroller=wrapper.lastChild,code=scroller.firstChild,mover=code.firstChild,gutter=mover.firstChild,gutterText=gutter.firstChild,lineSpace=gutter.nextSibling.firstChild,measure=lineSpace.firstChild,cursor=measure.nextSibling,lineDiv=cursor.nextSibling;webkit||(lineSpace.draggable=!0),options.tabindex!=null&&(input.tabindex=options.tabindex),!options.gutter&&!options.lineNumbers&&(gutter.style.display="none");try{stringWidth("x")}catch(e){throw e.message.match(/unknown runtime/i)&&(e=new Error("A CodeMirror inside a P-style element does not work in Internet Explorer. (innerHTML bug)")),e}var poll=new Delayed,highlight=new Delayed,blinker,mode,doc=new BranchChunk([new LeafChunk([new Line("")])]),work,focused;loadMode();var sel={from:{line:0,ch:0},to:{line:0,ch:0},inverted:!1},shiftSelecting,reducedSelection,lastClick,lastDoubleClick,draggingText,updateInput,changes,textChanged,selectionChanged,leaveInputAlone,gutterDirty,displayOffset=0,showingFrom=0,showingTo=0,lastHeight=0,curKeyId=null,editing,bracketHighlighted,maxLine="",maxWidth;operation(function(){setValue(options.value||""),updateInput=!1})();var history=new History,slowPollInterval=2e3,alwaysPollForIME=!win&&!mac&&(gecko||window.opera);options.pollForIME&&alwaysPollForIME&&(slowPollInterval=50),connect(scroller,"mousedown",operation(onMouseDown)),connect(scroller,"dblclick",operation(onDoubleClick)),connect(lineSpace,"dragstart",onDragStart),connect(lineSpace,"selectstart",e_preventDefault),gecko||connect(scroller,"contextmenu",onContextMenu),connect(scroller,"scroll",function(){updateDisplay([]),options.fixedGutter&&(gutter.style.left=scroller.scrollLeft+"px"),options.onScroll&&options.onScroll(instance)}),connect(window,"resize",function(){updateDisplay(!0)}),connect(input,"keyup",operation(onKeyUp)),connect(input,"input",function(){fastPoll(curKeyId)}),connect(input,"keydown",operation(onKeyDown)),connect(input,"keypress",operation(onKeyPress)),connect(input,"focus",onFocus),connect(input,"blur",onBlur),connect(scroller,"dragenter",e_stop),connect(scroller,"dragover",e_stop),connect(scroller,"drop",operation(onDrop)),connect(scroller,"paste",function(){focusInput(),fastPoll()}),connect(input,"paste",function(){fastPoll()}),connect(input,"cut",function(){fastPoll()});var hasFocus;try{hasFocus=targetDocument.activeElement==input}catch(e){}hasFocus?setTimeout(onFocus,20):onBlur();var instance=wrapper.CodeMirror={getValue:getValue,setValue:operation(setValue),getSelection:getSelection,replaceSelection:operation(replaceSelection),focus:function(){focusInput(),onFocus(),fastPoll()},setOption:function(option,value){var oldVal=options[option];options[option]=value,option=="mode"||option=="indentUnit"?loadMode():option=="readOnly"&&value=="nocursor"?input.blur():option=="theme"?scroller.className=scroller.className.replace(/cm-s-\w+/,"cm-s-"+value):option=="lineWrapping"&&oldVal!=value?operation(wrappingChanged)():option=="pollForIME"&&alwaysPollForIME&&(slowPollInterval=value?50:2e3),(option=="lineNumbers"||option=="gutter"||option=="firstLineNumber"||option=="theme")&&operation(gutterChanged)()},getOption:function(option){return options[option]},undo:operation(undo),redo:operation(redo),indentLine:operation(function(n,dir){isLine(n)&&indentLine(n,dir==null?"smart":dir?"add":"subtract")}),historySize:function(){return{undo:history.done.length,redo:history.undone.length}},clearHistory:function(){history=new History},matchBrackets:operation(function(){matchBrackets(!0)}),getTokenAt:operation(function(pos){return pos=clipPos(pos),getLine(pos.line).getTokenAt(mode,getStateBefore(pos.line),pos.ch)}),getStateAfter:function(line){return line=clipLine(line==null?doc.size-1:line),getStateBefore(line+1)},cursorCoords:function(start){return start==null&&(start=sel.inverted),pageCoords(start?sel.from:sel.to)},charCoords:function(pos){return pageCoords(clipPos(pos))},coordsChar:function(coords){var off=eltOffset(lineSpace);return coordsChar(coords.x-off.left,coords.y-off.top)},getSearchCursor:function(query,pos,caseFold){return new SearchCursor(query,pos,caseFold)},markText:operation(markText),setBookmark:setBookmark,setMarker:operation(addGutterMarker),clearMarker:operation(removeGutterMarker),setLineClass:operation(setLineClass),hideLine:operation(function(h){return setLineHidden(h,!0)}),showLine:operation(function(h){return setLineHidden(h,!1)}),lineInfo:lineInfo,addWidget:function(pos,node,scroll,vert,horiz){pos=localCoords(clipPos(pos));var top=pos.yBot,left=pos.x;node.style.position="absolute",code.appendChild(node);if(vert=="over")top=pos.y;else if(vert=="near"){var vspace=Math.max(scroller.offsetHeight,doc.height*textHeight()),hspace=Math.max(code.clientWidth,lineSpace.clientWidth)-paddingLeft();pos.yBot+node.offsetHeight>vspace&&pos.y>node.offsetHeight&&(top=pos.y-node.offsetHeight),left+node.offsetWidth>hspace&&(left=hspace-node.offsetWidth)}node.style.top=top+paddingTop()+"px",node.style.left=node.style.right="",horiz=="right"?(left=code.clientWidth-node.offsetWidth,node.style.right="0px"):(horiz=="left"?left=0:horiz=="middle"&&(left=(code.clientWidth-node.offsetWidth)/2),node.style.left=left+paddingLeft()+"px"),scroll&&scrollIntoView(left,top,left+node.offsetWidth,top+node.offsetHeight)},lineCount:function(){return doc.size},getCursor:function(start){return start==null&&(start=sel.inverted),copyPos(start?sel.from:sel.to)},somethingSelected:function(){return!posEq(sel.from,sel.to)},setCursor:operation(function(line,ch){ch==null&&typeof line.line=="number"?setCursor(line.line,line.ch):setCursor(line,ch)}),setSelection:operation(function(from,to){setSelection(clipPos(from),clipPos(to||from))}),getLine:function(line){if(isLine(line))return getLine(line).text},setLine:operation(function(line,text){isLine(line)&&replaceRange(text,{line:line,ch:0},{line:line,ch:getLine(line).text.length})}),removeLine:operation(function(line){isLine(line)&&replaceRange("",{line:line,ch:0},clipPos({line:line+1,ch:0}))}),replaceRange:operation(replaceRange),getRange:function(from,to){return getRange(clipPos(from),clipPos(to))},coordsFromIndex:function(off){var lineNo=0,ch;return doc.iter(0,doc.size,function(line){var sz=line.text.length+1;if(sz>off)return ch=off,!0;off-=sz,++lineNo}),clipPos({line:lineNo,ch:ch})},operation:function(f){return operation(f)()},refresh:function(){updateDisplay(!0)},getInputField:function(){return input},getWrapperElement:function(){return wrapper},getScrollerElement:function(){return scroller},getGutterElement:function(){return gutter}},pollingFast=!1;TextMarker.prototype.clear=operation(function(){for(var i=0,e=this.set.length;i<e;++i){var mk=this.set[i].marked;if(!mk)continue;for(var j=0;j<mk.length;++j)mk[j].set==this.set&&mk.splice(j--,1)}changes.push({from:0,to:doc.size})}),TextMarker.prototype.find=function(){var from,to;for(var i=0,e=this.set.length;i<e;++i){var line=this.set[i],mk=line.marked;for(var j=0;j<mk.length;++j){var mark=mk[j];if(mark.set==this.set)if(mark.from!=null||mark.to!=null){var found=lineNo(line);found!=null&&(mark.from!=null&&(from={line:found,ch:mark.from}),mark.to!=null&&(to={line:found,ch:mark.to}))}}}return{from:from,to:to}};var tempId=Math.floor(Math.random()*16777215).toString(16),cachedHeight,cachedFor,cachedWidth,cachedFor=0,matching={"(":")>",")":"(<","[":"]>","]":"[<","{":"}>","}":"{<"},nestedOperation=0;SearchCursor.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(reverse){function savePosAndFail(line){var pos={line:line,ch:0};return self.pos={from:pos,to:pos},self.atOccurrence=!1,!1}var self=this,pos=clipPos(reverse?this.pos.from:this.pos.to);for(;;){if(this.pos=this.matches(reverse,pos))return this.atOccurrence=!0,this.pos.match||!0;if(reverse){if(!pos.line)return savePosAndFail(0);pos={line:pos.line-1,ch:getLine(pos.line-1).text.length}}else{if(pos.line==doc.size-1)return savePosAndFail(doc.size);pos={line:pos.line+1,ch:0}}}},from:function(){if(this.atOccurrence)return copyPos(this.pos.from)},to:function(){if(this.atOccurrence)return copyPos(this.pos.to)},replace:function(newText){var self=this;this.atOccurrence&&operation(function(){self.pos.to=replaceRange(newText,self.pos.from,self.pos.to)})()}};for(var ext in extensions)extensions.propertyIsEnumerable(ext)&&!instance.propertyIsEnumerable(ext)&&(instance[ext]=extensions[ext]);return instance}function copyState(mode,state){if(state===!0)return state;if(mode.copyState)return mode.copyState(state);var nstate={};for(var n in state){var val=state[n];val instanceof Array&&(val=val.concat([])),nstate[n]=val}return nstate}function startState(mode,a1,a2){return mode.startState?mode.startState(a1,a2):!0}function StringStream(string){this.pos=this.start=0,this.string=string}function MarkedText(from,to,className,set){this.from=from,this.to=to,this.style=className,this.set=set}function Bookmark(pos){this.from=pos,this.to=pos,this.line=null}function Line(text,styles){this.styles=styles||[text,null],this.text=text,this.height=1,this.marked=this.gutterMarker=this.className=null,this.stateAfter=this.parent=this.hidden=null}function copyStyles(from,to,source,dest){for(var i=0,pos=0,state=0;pos<to;i+=2){var part=source[i],end=pos+part.length;state==0?(end>from&&dest.push(part.slice(from-pos,Math.min(part.length,to-pos)),source[i+1]),end>=from&&(state=1)):state==1&&(end>to?dest.push(part.slice(0,to-pos),source[i+1]):dest.push(part,source[i+1])),pos=end}}function LeafChunk(lines){this.lines=lines,this.parent=null;for(var i=0,e=lines.length,height=0;i<e;++i)lines[i].parent=this,height+=lines[i].height;this.height=height}function BranchChunk(children){this.children=children;var size=0,height=0;for(var i=0,e=children.length;i<e;++i){var ch=children[i];size+=ch.chunkSize(),height+=ch.height,ch.parent=this}this.size=size,this.height=height,this.parent=null}function getLineAt(chunk,n){for(;;){for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;break}n-=sz}if(chunk.lines)return chunk.lines[n]}}function lineNo(line){if(line.parent==null)return null;var cur=line.parent,no=indexOf(cur.lines,line);for(var chunk=cur.parent;chunk;cur=chunk,chunk=chunk.parent)for(var i=0,e=chunk.children.length;;++i){if(chunk.children[i]==cur)break;no+=chunk.children[i].chunkSize()}return no}function lineAtHeight(chunk,h){var n=0;e:do{for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],ch=child.height;if(h<ch){chunk=child;continue e}h-=ch,n+=child.chunkSize()}return n}while(!chunk.lines);for(var i=0,e=chunk.lines.length;i<e;++i){var line=chunk.lines[i],lh=line.height;if(h<lh)break;h-=lh}return n+i}function heightAtLine(chunk,n){var h=0;e:do{for(var i=0,e=chunk.children.length;i<e;++i){var child=chunk.children[i],sz=child.chunkSize();if(n<sz){chunk=child;continue e}n-=sz,h+=child.height}return h}while(!chunk.lines);for(var i=0;i<n;++i)h+=chunk.lines[i].height;return h}function History(){this.time=0,this.done=[],this.undone=[]}function stopMethod(){e_stop(this)}function addStop(event){return event.stop||(event.stop=stopMethod),event}function e_preventDefault(e){e.preventDefault?e.preventDefault():e.returnValue=!1}function e_stopPropagation(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0}function e_stop(e){e_preventDefault(e),e_stopPropagation(e)}function e_target(e){return e.target||e.srcElement}function e_button(e){if(e.which)return e.which;if(e.button&1)return 1;if(e.button&2)return 3;if(e.button&4)return 2}function connect(node,type,handler,disconnect){function wrapHandler(event){handler(event||window.event)}if(typeof node.addEventListener=="function"){node.addEventListener(type,wrapHandler,!1);if(disconnect)return function(){node.removeEventListener(type,wrapHandler,!1)}}else{node.attachEvent("on"+type,wrapHandler);if(disconnect)return function(){node.detachEvent("on"+type,wrapHandler)}}}function Delayed(){this.id=null}function countColumn(string,end){end==null&&(end=string.search(/[^\s\u00a0]/),end==-1&&(end=string.length));for(var i=0,n=0;i<end;++i)string.charAt(i)=="	"?n+=tabSize-n%tabSize:++n;return n}function computedStyle(elt){return elt.currentStyle?elt.currentStyle:window.getComputedStyle(elt,null)}function eltOffset(node,screen){var bod=node.ownerDocument.body,x=0,y=0,skipBody=!1;for(var n=node;n;n=n.offsetParent){var ol=n.offsetLeft,ot=n.offsetTop;n==bod?(x+=Math.abs(ol),y+=Math.abs(ot)):(x+=ol,y+=ot),screen&&computedStyle(n).position=="fixed"&&(skipBody=!0)}var e=screen&&!skipBody?null:bod;for(var n=node.parentNode;n!=e;n=n.parentNode)n.scrollLeft!=null&&(x-=n.scrollLeft,y-=n.scrollTop);return{left:x,top:y}}function eltText(node){return node.textContent||node.innerText||node.nodeValue||""}function posEq(a,b){return a.line==b.line&&a.ch==b.ch}function posLess(a,b){return a.line<b.line||a.line==b.line&&a.ch<b.ch}function copyPos(x){return{line:x.line,ch:x.ch}}function htmlEscape(str){return badTextContent?(escapeElement.innerHTML="",escapeElement.appendChild(document.createTextNode(str))):escapeElement.textContent=str,escapeElement.innerHTML}function editEnd(from,to){if(!to)return from?from.length:0;if(!from)return to.length;for(var i=from.length,j=to.length;i>=0&&j>=0;--i,--j)if(from.charAt(i)!=to.charAt(j))break;return j+1}function indexOf(collection,elt){if(collection.indexOf)return collection.indexOf(elt);for(var i=0,e=collection.length;i<e;++i)if(collection[i]==elt)return i;return-1}CodeMirror.defaults={value:"",mode:null,theme:"default",indentUnit:2,indentWithTabs:!1,tabMode:"classic",enterMode:"indent",electricChars:!0,onKeyEvent:null,lineWrapping:!1,lineNumbers:!1,gutter:!1,fixedGutter:!1,firstLineNumber:1,readOnly:!1,smartHome:!0,onChange:null,onCursorActivity:null,onGutterClick:null,onHighlightComplete:null,onFocus:null,onBlur:null,onScroll:null,matchBrackets:!1,workTime:100,workDelay:200,undoDepth:40,tabindex:null,pollForIME:!1,document:window.document};var modes={},mimeModes={};CodeMirror.defineMode=function(name,mode){!CodeMirror.defaults.mode&&name!="null"&&(CodeMirror.defaults.mode=name),modes[name]=mode},CodeMirror.defineMIME=function(mime,spec){mimeModes[mime]=spec},CodeMirror.getMode=function(options,spec){typeof spec=="string"&&mimeModes.hasOwnProperty(spec)&&(spec=mimeModes[spec]);if(typeof spec=="string")var mname=spec,config={};else if(spec!=null)var mname=spec.name,config=spec;var mfactory=modes[mname];return mfactory?mfactory(options,config||{}):(window.console&&console.warn("No mode "+mname+" found, falling back to plain text."),CodeMirror.getMode(options,"text/plain"))},CodeMirror.listModes=function(){var list=[];for(var m in modes)modes.propertyIsEnumerable(m)&&list.push(m);return list},CodeMirror.listMIMEs=function(){var list=[];for(var m in mimeModes)mimeModes.propertyIsEnumerable(m)&&list.push({mime:m,mode:mimeModes[m]});return list};var extensions={};CodeMirror.defineExtension=function(name,func){extensions[name]=func},CodeMirror.fromTextArea=function(textarea,options){function save(){textarea.value=instance.getValue()}options||(options={}),options.value=textarea.value,!options.tabindex&&textarea.tabindex&&(options.tabindex=textarea.tabindex);if(textarea.form){var rmSubmit=connect(textarea.form,"submit",save,!0);if(typeof textarea.form.submit=="function"){var realSubmit=textarea.form.submit;function wrappedSubmit(){save(),textarea.form.submit=realSubmit,textarea.form.submit(),textarea.form.submit=wrappedSubmit}textarea.form.submit=wrappedSubmit}}textarea.style.display="none";var instance=CodeMirror(function(node){textarea.parentNode.insertBefore(node,textarea.nextSibling)},options);return instance.save=save,instance.toTextArea=function(){save(),textarea.parentNode.removeChild(instance.getWrapperElement()),textarea.style.display="",textarea.form&&(rmSubmit(),typeof textarea.form.submit=="function"&&(textarea.form.submit=realSubmit))},instance},CodeMirror.copyState=copyState,CodeMirror.startState=startState,StringStream.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==0},peek:function(){return this.string.charAt(this.pos)},next:function(){if(this.pos<this.string.length)return this.string.charAt(this.pos++)},eat:function(match){var ch=this.string.charAt(this.pos);if(typeof match=="string")var ok=ch==match;else var ok=ch&&(match.test?match.test(ch):match(ch));if(ok)return++this.pos,ch},eatWhile:function(match){var start=this.pos;while(this.eat(match));return this.pos>start},eatSpace:function(){var start=this.pos;while(/[\s\u00a0]/.test(this.string.charAt(this.pos)))++this.pos;return this.pos>start},skipToEnd:function(){this.pos=this.string.length},skipTo:function(ch){var found=this.string.indexOf(ch,this.pos);if(found>-1)return this.pos=found,!0},backUp:function(n){this.pos-=n},column:function(){return countColumn(this.string,this.start)},indentation:function(){return countColumn(this.string)},match:function(pattern,consume,caseInsensitive){if(typeof pattern!="string"){var match=this.string.slice(this.pos).match(pattern);return match&&consume!==!1&&(this.pos+=match[0].length),match}function cased(str){return caseInsensitive?str.toLowerCase():str}if(cased(this.string).indexOf(cased(pattern),this.pos)==this.pos)return consume!==!1&&(this.pos+=pattern.length),!0},current:function(){return this.string.slice(this.start,this.pos)}},CodeMirror.StringStream=StringStream,MarkedText.prototype={attach:function(line){this.set.push(line)},detach:function(line){var ix=indexOf(this.set,line);ix>-1&&this.set.splice(ix,1)},split:function(pos,lenBefore){if(this.to<=pos&&this.to!=null)return null;var from=this.from<pos||this.from==null?null:this.from-pos+lenBefore,to=this.to==null?null:this.to-pos+lenBefore;return new MarkedText(from,to,this.style,this.set)},dup:function(){return new MarkedText(null,null,this.style,this.set)},clipTo:function(fromOpen,from,toOpen,to,diff){this.from!=null&&this.from>=from&&(this.from=Math.max(to,this.from)+diff),this.to!=null&&this.to>from&&(this.to=to<this.to?this.to+diff:from),fromOpen&&to>this.from&&(to<this.to||this.to==null)&&(this.from=null),toOpen&&(from<this.to||this.to==null)&&(from>this.from||this.from==null)&&(this.to=null)},isDead:function(){return this.from!=null&&this.to!=null&&this.from>=this.to},sameSet:function(x){return this.set==x.set}},Bookmark.prototype={attach:function(line){this.line=line},detach:function(line){this.line==line&&(this.line=null)},split:function(pos,lenBefore){if(pos<this.from)return this.from=this.to=this.from-pos+lenBefore,this},isDead:function(){return this.from>this.to},clipTo:function(fromOpen,from,toOpen,to,diff){(fromOpen||from<this.from)&&(toOpen||to>this.to)?(this.from=0,this.to=-1):this.from>from&&(this.from=this.to=Math.max(to,this.from)+diff)},sameSet:function(x){return!1},find:function(){return!this.line||!this.line.parent?null:{line:lineNo(this.line),ch:this.from}},clear:function(){if(this.line){var found=indexOf(this.line.marked,this);found!=-1&&this.line.marked.splice(found,1),this.line=null}}},Line.inheritMarks=function(text,orig){var ln=new Line(text),mk=orig.marked;if(mk)for(var i=0;i<mk.length;++i)if(mk[i].to==null&&mk[i].style){var newmk=ln.marked||(ln.marked=[]),mark=mk[i],nmark=mark.dup();newmk.push(nmark),nmark.attach(ln)}return ln},Line.prototype={replace:function(from,to_,text){!from&&(to_==null||to_==this.text.length)&&(this.className=this.gutterMarker=null);var st=[],mk=this.marked,to=to_==null?this.text.length:to_;copyStyles(0,from,this.styles,st),text&&st.push(text,null),copyStyles(to,this.text.length,this.styles,st),this.styles=st,this.text=this.text.slice(0,from)+text+this.text.slice(to),this.stateAfter=null;if(mk){var diff=text.length-(to-from);for(var i=0,mark=mk[i];i<mk.length;++i)mark.clipTo(from==null,from||0,to_==null,to,diff),mark.isDead()&&(mark.detach(this),mk.splice(i--,1))}},split:function(pos,textBefore){var st=[textBefore,null],mk=this.marked;copyStyles(pos,this.text.length,this.styles,st);var taken=new Line(textBefore+this.text.slice(pos),st);if(mk)for(var i=0;i<mk.length;++i){var mark=mk[i],newmark=mark.split(pos,textBefore.length);newmark&&(taken.marked||(taken.marked=[]),taken.marked.push(newmark),newmark.attach(taken))}return taken},append:function(line){var mylen=this.text.length,mk=line.marked,mymk=this.marked;this.text+=line.text,copyStyles(0,line.text.length,line.styles,this.styles);if(mymk)for(var i=0;i<mymk.length;++i)mymk[i].to==null&&(mymk[i].to=mylen);if(mk&&mk.length){mymk||(this.marked=mymk=[]);e:for(var i=0;i<mk.length;++i){var mark=mk[i];if(!mark.from)for(var j=0;j<mymk.length;++j){var mymark=mymk[j];if(mymark.to==mylen&&mymark.sameSet(mark)){mymark.to=mark.to==null?null:mark.to+mylen,mymark.isDead()&&(mymark.detach(this),mk.splice(i--,1));continue e}}mymk.push(mark),mark.attach(this),mark.from+=mylen,mark.to!=null&&(mark.to+=mylen)}}},fixMarkEnds:function(other){var mk=this.marked,omk=other.marked;if(!mk)return;for(var i=0;i<mk.length;++i){var mark=mk[i],close=mark.to==null;if(close&&omk)for(var j=0;j<omk.length;++j)if(omk[j].sameSet(mark)){close=!1;break}close&&(mark.to=this.text.length)}},addMark:function(mark){mark.attach(this),this.marked==null&&(this.marked=[]),this.marked.push(mark),this.marked.sort(function(a,b){return(a.from||0)-(b.from||0)})},highlight:function(mode,state){var stream=new StringStream(this.text),st=this.styles,pos=0,changed=!1,curWord=st[0],prevWord;this.text==""&&mode.blankLine&&mode.blankLine(state);while(!stream.eol()){var style=mode.token(stream,state),substr=this.text.slice(stream.start,stream.pos);stream.start=stream.pos,pos&&st[pos-1]==style?st[pos-2]+=substr:substr&&(!changed&&(st[pos+1]!=style||pos&&st[pos-2]!=prevWord)&&(changed=!0),st[pos++]=substr,st[pos++]=style,prevWord=curWord,curWord=st[pos]);if(stream.pos>5e3){st[pos++]=this.text.slice(stream.pos),st[pos++]=null;break}}return st.length!=pos&&(st.length=pos,changed=!0),pos&&st[pos-2]!=prevWord&&(changed=!0),changed||(st.length<5&&this.text.length<10?null:!1)},getTokenAt:function(mode,state,ch){var txt=this.text,stream=new StringStream(txt);while(stream.pos<ch&&!stream.eol()){stream.start=stream.pos;var style=mode.token(stream,state)}return{start:stream.start,end:stream.pos,string:stream.current(),className:style||null,state:state}},indentation:function(){return countColumn(this.text)},getHTML:function(sfrom,sto,includePre,endAt){function span(text,style){if(!text)return;first&&ie&&text.charAt(0)==" "&&(text=""+text.slice(1)),first=!1,style?html.push('<span class="',style,'">',htmlEscape(text),"</span>"):html.push(htmlEscape(text))}var html=[],first=!0;includePre&&html.push(this.className?'<pre class="'+this.className+'">':"<pre>");var st=this.styles,allText=this.text,marked=this.marked;sfrom==sto&&(sfrom=null);var len=allText.length;endAt!=null&&(len=Math.min(endAt,len));if(!allText&&endAt==null)span(" ",sfrom!=null&&sto==null?"CodeMirror-selected":null);else if(!marked&&sfrom==null)for(var i=0,ch=0;ch<len;i+=2){var str=st[i],style=st[i+1],l=str.length;ch+l>len&&(str=str.slice(0,len-ch)),ch+=l,span(str,style&&"cm-"+style)}else{var pos=0,i=0,text="",style,sg=0,markpos=-1,mark=null;function nextMark(){marked&&(markpos+=1,mark=markpos<marked.length?marked[markpos]:null)}nextMark();while(pos<len){var upto=len,extraStyle="";if(sfrom!=null)if(sfrom>pos)upto=sfrom;else if(sto==null||sto>pos)extraStyle=" CodeMirror-selected",sto!=null&&(upto=Math.min(upto,sto));while(mark&&mark.to!=null&&mark.to<=pos)nextMark();mark&&(mark.from>pos?upto=Math.min(upto,mark.from):(extraStyle+=" "+mark.style,mark.to!=null&&(upto=Math.min(upto,mark.to))));for(;;){var end=pos+text.length,appliedStyle=style;extraStyle&&(appliedStyle=style?style+extraStyle:extraStyle),span(end>upto?text.slice(0,upto-pos):text,appliedStyle);if(end>=upto){text=text.slice(upto-pos),pos=upto;break}pos=end,text=st[i++],style="cm-"+st[i++]}}sfrom!=null&&sto==null&&span(" ","CodeMirror-selected")}return includePre&&html.push("</pre>"),html.join("")},cleanUp:function(){this.parent=null;if(this.marked)for(var i=0,e=this.marked.length;i<e;++i)this.marked[i].detach(this)}},LeafChunk.prototype={chunkSize:function(){return this.lines.length},remove:function(at,n){for(var i=at,e=at+n;i<e;++i){var line=this.lines[i];line.cleanUp(),this.height-=line.height}this.lines.splice(at,n)},collapse:function(lines){lines.splice.apply(lines,[lines.length,0].concat(this.lines))},insertHeight:function(at,lines,height){this.height+=height,this.lines.splice.apply(this.lines,[at,0].concat(lines));for(var i=0,e=lines.length;i<e;++i)lines[i].parent=this},iterN:function(at,n,op){for(var e=at+n;at<e;++at)if(op(this.lines[at]))return!0}},BranchChunk.prototype={chunkSize:function(){return this.size},remove:function(at,n){this.size-=n;for(var i=0;i<this.children.length;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var rm=Math.min(n,sz-at),oldHeight=child.height;child.remove(at,rm),this.height-=oldHeight-child.height,sz==rm&&(this.children.splice(i--,1),child.parent=null);if((n-=rm)==0)break;at=0}else at-=sz}if(this.size-n<25){var lines=[];this.collapse(lines),this.children=[new LeafChunk(lines)]}},collapse:function(lines){for(var i=0,e=this.children.length;i<e;++i)this.children[i].collapse(lines)},insert:function(at,lines){var height=0;for(var i=0,e=lines.length;i<e;++i)height+=lines[i].height;this.insertHeight(at,lines,height)},insertHeight:function(at,lines,height){this.size+=lines.length,this.height+=height;for(var i=0,e=this.children.length;i<e;++i){var child=this.children[i],sz=child.chunkSize();if(at<=sz){child.insertHeight(at,lines,height);if(child.lines&&child.lines.length>50){while(child.lines.length>50){var spilled=child.lines.splice(child.lines.length-25,25),newleaf=new LeafChunk(spilled);child.height-=newleaf.height,this.children.splice(i+1,0,newleaf),newleaf.parent=this}this.maybeSpill()}break}at-=sz}},maybeSpill:function(){if(this.children.length<=10)return;var me=this;do{var spilled=me.children.splice(me.children.length-5,5),sibling=new BranchChunk(spilled);if(!me.parent){var copy=new BranchChunk(me.children);copy.parent=me,me.children=[copy,sibling],me=copy}else{me.size-=sibling.size,me.height-=sibling.height;var myIndex=indexOf(me.parent.children,me);me.parent.children.splice(myIndex+1,0,sibling)}sibling.parent=me.parent}while(me.children.length>10);me.parent.maybeSpill()},iter:function(from,to,op){this.iterN(from,to-from,op)},iterN:function(at,n,op){for(var i=0,e=this.children.length;i<e;++i){var child=this.children[i],sz=child.chunkSize();if(at<sz){var used=Math.min(n,sz-at);if(child.iterN(at,used,op))return!0;if((n-=used)==0)break;at=0}else at-=sz}}},History.prototype={addChange:function(start,added,old){this.undone.length=0;var time=+(new Date),last=this.done[this.done.length-1];if(time-this.time>400||!last||last.start>start+added||last.start+last.added<start-last.added+last.old.length)this.done.push({start:start,added:added,old:old});else{var oldoff=0;if(start<last.start){for(var i=last.start-start-1;i>=0;--i)last.old.unshift(old[i]);last.added+=last.start-start,last.start=start}else last.start<start&&(oldoff=start-last.start,added+=oldoff);for(var i=last.added-oldoff,e=old.length;i<e;++i)last.old.push(old[i]);last.added<added&&(last.added=added)}this.time=time}},Delayed.prototype={set:function(ms,f){clearTimeout(this.id),this.id=setTimeout(f,ms)}};var dragAndDrop=function(){if(/MSIE [1-8]\b/.test(navigator.userAgent))return!1;var div=document.createElement("div");return"draggable"in div}(),gecko=/gecko\/\d{7}/i.test(navigator.userAgent),ie=/MSIE \d/.test(navigator.userAgent),webkit=/WebKit\//.test(navigator.userAgent),lineSep="\n";(function(){var te=document.createElement("textarea");te.value="foo\nbar",te.value.indexOf("\r")>-1&&(lineSep="\r\n")})();var tabSize=8,mac=/Mac/.test(navigator.platform),win=/Win/.test(navigator.platform),movementKeys={};for(var i=35;i<=40;++i)movementKeys[i]=movementKeys["c"+i]=!0;document.documentElement.getBoundingClientRect!=null&&(eltOffset=function(node,screen){try{var box=node.getBoundingClientRect();box={top:box.top,left:box.left}}catch(e){box={top:0,left:0}}if(!screen)if(window.pageYOffset==null){var t=document.documentElement||document.body.parentNode;t.scrollTop==null&&(t=document.body),box.top+=t.scrollTop,box.left+=t.scrollLeft}else box.top+=window.pageYOffset,box.left+=window.pageXOffset;return box});var escapeElement=document.createElement("pre"),badTextContent=htmlEscape("	")!="	";CodeMirror.htmlEscape=htmlEscape;var splitLines,selRange,setSelRange;return"\n\nb".split(/\n/).length!=3?splitLines=function(string){var pos=0,nl,result=[];while((nl=string.indexOf("\n",pos))>-1)result.push(string.slice(pos,string.charAt(nl-1)=="\r"?nl-1:nl)),pos=nl+1;return result.push(string.slice(pos)),result}:splitLines=function(string){return string.split(/\r?\n/)},CodeMirror.splitLines=splitLines,window.getSelection?(selRange=function(te){try{return{start:te.selectionStart,end:te.selectionEnd}}catch(e){return null}},webkit?setSelRange=function(te,start,end){start==end?te.setSelectionRange(start,end):(te.setSelectionRange(start,end-1),window.getSelection().modify("extend","forward","character"))}:setSelRange=function(te,start,end){try{te.setSelectionRange(start,end)}catch(e){}}):(selRange=function(te){try{var range=te.ownerDocument.selection.createRange()}catch(e){return null}if(!range||range.parentElement()!=te)return null;var val=te.value,len=val.length,localRange=te.createTextRange();localRange.moveToBookmark(range.getBookmark());var endRange=te.createTextRange();endRange.collapse(!1);if(localRange.compareEndPoints("StartToEnd",endRange)>-1)return{start:len,end:len};var start=-localRange.moveStart("character",-len);for(var i=val.indexOf("\r");i>-1&&i<start;i=val.indexOf("\r",i+1),start++);if(localRange.compareEndPoints("EndToEnd",endRange)>-1)return{start:start,end:len};var end=-localRange.moveEnd("character",-len);for(var i=val.indexOf("\r");i>-1&&i<end;i=val.indexOf("\r",i+1),end++);return{start:start,end:end}},setSelRange=function(te,start,end){var range=te.createTextRange();range.collapse(!0);var endrange=range.duplicate(),newlines=0,txt=te.value;for(var pos=txt.indexOf("\n");pos>-1&&pos<start;pos=txt.indexOf("\n",pos+1))++newlines;range.move("character",start-newlines);for(;pos>-1&&pos<end;pos=txt.indexOf("\n",pos+1))++newlines;endrange.move("character",end-newlines),range.setEndPoint("EndToEnd",endrange),range.select()}),CodeMirror.defineMode("null",function(){return{token:function(stream){stream.skipToEnd()}}}),CodeMirror.defineMIME("text/plain","null"),CodeMirror}();return CodeMirror});
define('tp/codemirror.stylesheet',["jQuery"],function($){$(document).ready(function(){function loadCss(url){var link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=url,document.getElementsByTagName("head")[0].appendChild(link)}loadCss(require.toUrl("tp/codemirror/theme/default.css"))})});
define('tp/codemirror/lib/util/runmode',["../codemirror"],function(CodeMirror){CodeMirror.runMode=function(string,modespec,callback){var mode=CodeMirror.getMode({indentUnit:2},modespec),isNode=callback.nodeType==1;if(isNode){var node=callback,accum=[];callback=function(string,style){string=="\n"?accum.push("<br>"):style?accum.push('<span class="cm-'+CodeMirror.htmlEscape(style)+'">'+CodeMirror.htmlEscape(string)+"</span>"):accum.push(CodeMirror.htmlEscape(string))}}var lines=CodeMirror.splitLines(string),state=CodeMirror.startState(mode);for(var i=0,e=lines.length;i<e;++i){i&&callback("\n");var stream=new CodeMirror.StringStream(lines[i]);while(!stream.eol()){var style=mode.token(stream,state);callback(stream.current(),style,i,stream.start),stream.start=stream.pos}}isNode&&(node.innerHTML=accum.join(""))}});
define('tp/codemirror/mode/python/python',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("python",function(conf,parserConf){function wordRegexp(words){return new RegExp("^(("+words.join(")|(")+"))\\b")}function tokenBase(stream,state){if(stream.sol()){var scopeOffset=state.scopes[0].offset;if(stream.eatSpace()){var lineOffset=stream.indentation();return lineOffset>scopeOffset?indentInfo="indent":lineOffset<scopeOffset&&(indentInfo="dedent"),null}scopeOffset>0&&dedent(stream,state)}if(stream.eatSpace())return null;var ch=stream.peek();if(ch==="#")return stream.skipToEnd(),"comment";if(stream.match(/^[0-9\.]/,!1)){var floatLiteral=!1;stream.match(/^\d*\.\d+(e[\+\-]?\d+)?/i)&&(floatLiteral=!0),stream.match(/^\d+\.\d*/)&&(floatLiteral=!0),stream.match(/^\.\d+/)&&(floatLiteral=!0);if(floatLiteral)return stream.eat(/J/i),"number";var intLiteral=!1;stream.match(/^0x[0-9a-f]+/i)&&(intLiteral=!0),stream.match(/^0b[01]+/i)&&(intLiteral=!0),stream.match(/^0o[0-7]+/i)&&(intLiteral=!0),stream.match(/^[1-9]\d*(e[\+\-]?\d+)?/)&&(stream.eat(/J/i),intLiteral=!0),stream.match(/^0(?![\dx])/i)&&(intLiteral=!0);if(intLiteral)return stream.eat(/L/i),"number"}return stream.match(stringPrefixes)?(state.tokenize=tokenStringFactory(stream.current()),state.tokenize(stream,state)):stream.match(tripleDelimiters)||stream.match(doubleDelimiters)?null:stream.match(doubleOperators)||stream.match(singleOperators)||stream.match(wordOperators)?"operator":stream.match(singleDelimiters)?null:stream.match(types)?"builtin":stream.match(keywords)?"keyword":stream.match(identifiers)?"variable":(stream.next(),ERRORCLASS)}function tokenStringFactory(delimiter){while("rub".indexOf(delimiter.charAt(0).toLowerCase())>=0)delimiter=delimiter.substr(1);var singleline=delimiter.length==1,OUTCLASS="string";return function(stream,state){while(!stream.eol()){stream.eatWhile(/[^'"\\]/);if(stream.eat("\\")){stream.next();if(singleline&&stream.eol())return OUTCLASS}else{if(stream.match(delimiter))return state.tokenize=tokenBase,OUTCLASS;stream.eat(/['"]/)}}if(singleline){if(parserConf.singleLineStringErrors)return ERRORCLASS;state.tokenize=tokenBase}return OUTCLASS}}function indent(stream,state,type){type=type||"py";var indentUnit=0;if(type==="py"){for(var i=0;i<state.scopes.length;++i)if(state.scopes[i].type==="py"){indentUnit=state.scopes[i].offset+conf.indentUnit;break}}else indentUnit=stream.column()+stream.current().length;state.scopes.unshift({offset:indentUnit,type:type})}function dedent(stream,state){if(state.scopes.length==1)return;if(state.scopes[0].type==="py"){var _indent=stream.indentation(),_indent_index=-1;for(var i=0;i<state.scopes.length;++i)if(_indent===state.scopes[i].offset){_indent_index=i;break}if(_indent_index===-1)return!0;while(state.scopes[0].offset!==_indent)state.scopes.shift();return!1}return state.scopes.shift(),!1}function tokenLexer(stream,state){indentInfo=null;var style=state.tokenize(stream,state),current=stream.current();if(current===".")return style=state.tokenize(stream,state),current=stream.current(),style==="variable"?"variable":ERRORCLASS;if(current==="@")return style=state.tokenize(stream,state),current=stream.current(),style==="variable"||current==="@staticmethod"||current==="@classmethod"?"meta":ERRORCLASS;if(current==="pass"||current==="return")state.dedent+=1;(current===":"&&!state.lambda&&state.scopes[0].type=="py"||indentInfo==="indent")&&indent(stream,state);var delimiter_index="[({".indexOf(current);return delimiter_index!==-1&&indent(stream,state,"])}".slice(delimiter_index,delimiter_index+1)),indentInfo==="dedent"&&dedent(stream,state)?ERRORCLASS:(delimiter_index="])}".indexOf(current),delimiter_index!==-1&&dedent(stream,state)?ERRORCLASS:(state.dedent>0&&stream.eol()&&state.scopes[0].type=="py"&&(state.scopes.length>1&&state.scopes.shift(),state.dedent-=1),style))}var ERRORCLASS="error",singleOperators=new RegExp("^[\\+\\-\\*/%&|\\^~<>!]"),singleDelimiters=new RegExp("^[\\(\\)\\[\\]\\{\\}@,:`=;\\.]"),doubleOperators=new RegExp("^((==)|(!=)|(<=)|(>=)|(<>)|(<<)|(>>)|(//)|(\\*\\*))"),doubleDelimiters=new RegExp("^((\\+=)|(\\-=)|(\\*=)|(%=)|(/=)|(&=)|(\\|=)|(\\^=))"),tripleDelimiters=new RegExp("^((//=)|(>>=)|(<<=)|(\\*\\*=))"),identifiers=new RegExp("^[_A-Za-z][_A-Za-z0-9]*"),wordOperators=wordRegexp(["and","or","not","is","in"]),commonkeywords=["as","assert","break","class","continue","def","del","elif","else","except","finally","for","from","global","if","import","lambda","pass","raise","return","try","while","with","yield"],commontypes=["bool","classmethod","complex","dict","enumerate","float","frozenset","int","list","object","property","reversed","set","slice","staticmethod","str","super","tuple","type"],py2={types:["basestring","buffer","file","long","unicode","xrange"],keywords:["exec","print"]},py3={types:["bytearray","bytes","filter","map","memoryview","open","range","zip"],keywords:["nonlocal"]};if(!parserConf.version||parseInt(parserConf.version,10)!==3){commonkeywords=commonkeywords.concat(py2.keywords),commontypes=commontypes.concat(py2.types);var stringPrefixes=new RegExp("^(([rub]|(ur)|(br))?('{3}|\"{3}|['\"]))","i")}else{commonkeywords=commonkeywords.concat(py3.keywords),commontypes=commontypes.concat(py3.types);var stringPrefixes=new RegExp("^(([rb]|(br))?('{3}|\"{3}|['\"]))","i")}var keywords=wordRegexp(commonkeywords),types=wordRegexp(commontypes),indentInfo=null,external={startState:function(basecolumn){return{tokenize:tokenBase,scopes:[{offset:basecolumn||0,type:"py"}],lastToken:null,lambda:!1,dedent:0}},token:function(stream,state){var style=tokenLexer(stream,state);return state.lastToken={style:style,content:stream.current()},stream.eol()&&stream.lambda&&(state.lambda=!1),style},indent:function(state,textAfter){return state.tokenize!=tokenBase?0:state.scopes[0].offset}};return external}),CodeMirror.defineMIME("text/x-python","python")});
define('tau/ui/extensions/board.editor/ui.extension.board.editor.help',["jQuery","tau/components/extensions/component.extension.base","Underscore","tau/ui/templates/board.editor/ui.template.board.editor.filterHelp","tp/codemirror/lib/codemirror","tp/codemirror.stylesheet","tp/codemirror/lib/util/runmode","tp/codemirror/mode/python/python"],function($,ExtensionBase,_,template,CodeMirror){return ExtensionBase.extend({"bus content.ready:last + refresh.help.content":function(evt,contentElements,helpData){var self=this,t=template.get();_.each(contentElements,function($content){_.each(_.keys(helpData),function(name){var elements=$content.find("[role="+name+"_help]");if(elements.length){var $newContent=t.bind({},{name:"rebind",predefinedFilters:helpData[name]});elements.find("table").remove(),elements.append($newContent.find("table")),self.fire("content.$element.ready",elements.parent())}})})},"bus afterRender:last + content.$element.ready":function(evt,data,$content){var $examples=$(".i-role-complex-filter-example",$content),filterType=$(".filter-help",$content).attr("role")+"_button",$helpButton=$("."+filterType,data.element);$examples.length>0?$helpButton.show():$helpButton.hide()},"bus afterRender":function(evt){var self=this,$element=evt.data.element,content=[];$element.find(".i-role-help").each(function(){var $helpEl=$(this),$relatedInput=$helpEl.parent().find(":text"),$content=$helpEl.next(".i-role-help-content").detach();$content.show(),content.push($content),$content.delegate(".i-role-predefined-filter","click",function(){var v=$(this).data("value");$helpEl.tauBubble("hide"),$relatedInput.focus(),setTimeout(function(){$relatedInput.val(v)},1)}),self.fire("content.$element.ready",$content),$helpEl.tauBubble({content:$content,zIndex:999,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow" role="arrow"></div>','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join(""),onResize:function($popup,data){var h=data.height;$popup.find("[role=content]").css({maxHeight:h-20,overflowY:"auto"})},onShow:function($popup){$popup.find(".i-role-output-filter").each(function(){var $output=$(this);$output.data("processed")||(CodeMirror.runMode($output.text(),"python",this),$output.data("processed",!0))})}})}),self.fire("content.ready",content)}})});
define('tau/ui/templates/board.editor/ui.template.board.editor.filter',["tau/core/templates-factory","tau/ui/templates/board.editor/ui.template.board.editor.filterHelp"],function(templates){var config={name:"board.editor.filter",engine:"jqote2",markup:['<div class="tau-boardsettings__filter i-role-filter-control">','<button class="tau-btn i-role-filter-toggle" type="button">Filter ','<span class="tau-boardsettings__status tau-boardsettings__status_on">on </span>','<span class="tau-boardsettings__status tau-boardsettings__status_off">off</span></button>','<div class="i-role-filter">','<input type="text" name="<%= this.name %>_filter" placeholder="type ? for advanced filter"',' class="i-role-filter-input tau-boardsettings__filter__input tau-in-text tau-x-large tau-filter" value="<%! this.filter %>" ',"/>",'<button type="button" tabindex="-1" class="tau-help i-role-help"></button>','<div class="tau-help-content i-role-help-content">','<%= fn.sub("board.editor.filterHelp", this) %>',"</div>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.editor/ui.template.board.editor.ordering',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.ordering",engine:"jqote2",markup:['<span class="tau-inline-group tau-sorter i-role-ordering-control">','<button class="tau-btn tau-sorter-toggle i-role-sorter-toggler" type="button">Sort</button>','<select class="tau-select tau-sorter-value" name="<%= this.name %>_ordering_name">',"</select>",'<button class="tau-btn tau-sort-<%= this.name %> tau-sort-inc tau-sorter-dir i-role-direction-toggler"></button>','<input type="checkbox" name="<%= this.name %>_ordering_direction" value="1" style="display:none;" />',"</span>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.editor/ui.template.board.editor.stateSetup',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.stateSetup",engine:"jqote2",markup:['<button type="button" class="tau-btn tau-board-settings__statesetup i-role-statesetup">Setup States</button>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.editor/ui.template.board.editor',["tau/nls/translator","tau/core/templates-factory","tau/ui/templates/board.editor/ui.template.board.editor.filter","tau/ui/templates/board.editor/ui.template.board.editor.ordering","tau/ui/templates/board.editor/ui.template.board.editor.axisTypes","tau/ui/templates/board.editor/ui.template.board.editor.stateSetup","tau/extensions/extension.underscore"],function(T,templates){var config={name:"board.editor",engine:"jqote2",markup:_.flatten(["<% var UIID = _.UUID();  %>",'<div class="tau-board-settings tau-boardsettings" role="form-settings">','<div class="tau-board-settings-cards">',"<h4>Select the cards you want to see</h4>",'<div class="tau-section">',"<% _.forEach(this.space.cells.types, function(item){ %> ","<label>",'<input type="checkbox" name="cells_types" value="<%= item.id %>" ',"<% if (item.isSelected){ %> checked ","<% } %> ","/>",'<button type="button" ',' class="tau-btn tau-<%= item.id %>',"<% if (item.isSelected){ %> tau-checked ","<% } %> ",'"><%= item.name %></button>',"</label>","<% }); %>","</div>",'<div class="tau-section">','<%= fn.sub("board.editor.ordering", this.space.cells) %>','<%= fn.sub("board.editor.filter", this.space.cells) %>',"</div>","</div>",'<div class="tau-board-settings-lanes">',"<h4>Set vertical and horizontal lanes</h4>",'<div class="tau-y-lane tau-section">','<select name="x_types" class="tau-select">','<option value="">No vertical lanes</option>','<%= fn.sub("board.editor.axisTypes", this.space.x) %>',"</select>",'<%= fn.sub("board.editor.ordering", this.space.x) %>','<%= fn.sub("board.editor.filter", this.space.x) %>',"<% if (this.user.isAdministrator){ %>",'<%= fn.sub("board.editor.stateSetup", {}) %>',"<% } %>","</div>",'<div class="tau-x-lane tau-section">','<select name="y_types" class="tau-select">','<option value="">No horizontal lanes</option>','<%= fn.sub("board.editor.axisTypes", this.space.y) %>',"</select>",'<%= fn.sub("board.editor.ordering", this.space.y) %>','<%= fn.sub("board.editor.filter", this.space.y) %>',"<% if (this.user.isAdministrator){ %>",'<%= fn.sub("board.editor.stateSetup", {}) %>',"<% } %>","</div>",'<button type="button" class="tau-lane-switch i-role-switch-filter" title="Swap lanes">Swap lanes</button>',"</div>","</div>"]),dependencies:[]};return templates.register(config)});
define('tau/components/component.board.editor',["Underscore","tau/components/component.creator","tau/models/board.editor/model.board.editor.read","tau/models/board.editor/model.board.editor.write","tau/models/board.editor/model.board.filter.help","tau/models/board.editor/model.board.editor.autocomplete","tau/ui/extensions/board.editor/ui.extension.board.editor.form","tau/ui/extensions/board.editor/ui.extension.board.editor.toggle","tau/ui/extensions/board.editor/ui.extension.board.editor.autocomplete","tau/ui/extensions/board.editor/ui.extension.board.editor.stateSetup","tau/ui/extensions/board.plus/ui.extension.board.plus.errors","tau/ui/extensions/board.editor/ui.extension.board.editor.help","tau/ui/templates/board.editor/ui.template.board.editor"],function(_,ComponentCreator,ModelRead,ModelWrite,ModelHelp,ModelAutocomplete,ExtensionForm,ExtensionToggle,ExtensionAutocomplete,ExtensionStateSetup,ExtensionErrors,ExtensionTooltips,Template){return{create:function(config){var creatorConfig={"queue.bus":!0,extensions:[ModelRead,ModelWrite,ModelHelp,ModelAutocomplete,ExtensionForm,ExtensionToggle,ExtensionAutocomplete,ExtensionStateSetup,ExtensionErrors,ExtensionTooltips],template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/models/board.editor.prioritization/model.board.editor.prioritization',["Underscore","tau/core/extension.base"],function(_,BaseModel){return BaseModel.extend({"bus beforeInit":function(evt){var configurator=evt.data.config.context.configurator;this.fire("configurator.ready",configurator),configurator.service("boardSettings").get({fields:["ownerId","prioritization","cells"],callback:_.bind(function(result){var isOwner=configurator.getLoggedUser().id==result.ownerId,ordering=_.defaults(result.cells.ordering||{},{name:"rank"}),isPrioritizable=!ordering.name||ordering.name.toLowerCase()=="rank",types=["project","team","user"];isPrioritizable=isPrioritizable&&_.intersection(types,result.cells.types||[]).length==0,this.fire("dataBind",_.defaults(result||{},{prioritization:{mode:"enabled"},access:{edit:(configurator.getLoggedUser().isAdministrator||isOwner)&&isPrioritizable}}))},this)}),configurator.service("boardSettings").unbind({listener:this}),configurator.service("boardSettings").bind({fields:["cells"],listener:this,callback:_.bind(function(result){this.fire("refresh")},this)})},"bus configurator.ready + afterRender":function(evt,configurator,renderData){var $el=renderData.element,boardSettings=configurator.service("boardSettings");$el.on("change",":radio",function(){var formData={};_.forEach($el.find("form").serializeArray(),function(v,k){formData[v.name]=v.value}),boardSettings.set({set:{prioritization:formData}})})}})});
define('tau/ui/templates/board.editor.prioritization/ui.template.board.editor.prioritization',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.prioritization",engine:"jqote2",markup:['<div class="tau-access-settings tau-prioritization-settings">','<div class="tau-access-type">',"<form>",'<label class="tau-line">','<div class="tau-field">','<input value="enabled" type="radio" name="mode"<% if (this.prioritization.mode == "enabled") { %> checked<% } %> <% if (!this.access.edit){ %> disabled class="tau-disabled"<% } %> >',"</div>",'<div class="tau-txt">',"<h3>Prioritization on</h3>","</div>","</label>",'<label class="tau-line">','<div class="tau-field">','<input value="disabled" type="radio" name="mode"<% if (this.prioritization.mode == "disabled") { %> checked<% } %>  <% if (!this.access.edit){ %> disabled class="tau-disabled"<% } %>>',"</div>",'<div class="tau-txt">',"<h3>Prioritization off</h3>","<p> You won't be able to prioritize cards by drag and drop on this board. This option is recommended if you want to lock priorities. </p>","</div>","</label>",'<label class="tau-line tau-line-img">','<div class="tau-field">','<input value="shift" type="radio" name="mode"<% if (this.prioritization.mode == "shift") { %> checked<% } %>  <% if (!this.access.edit){ %> disabled class="tau-disabled"<% } %>>',"</div>",'<div class="tau-txt">',"<h3>Prioritize only if the Shift key is pressed</h3>","<p>You won't be able to prioritize unless the Shift key is pressed.</p>","</div>","</label>","</form>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.editor.prioritization',["Underscore","tau/components/component.creator","tau/models/board.editor.prioritization/model.board.editor.prioritization","tau/ui/templates/board.editor.prioritization/ui.template.board.editor.prioritization"],function(_,ComponentCreator,Model,Template){return{create:function(config){var creatorConfig={extensions:[Model],template:Template};return config["queue.bus"]=!0,ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.editor.remember.context/model.board.editor.remember.context',["Underscore","tau/core/model-base","tau/models/board.editor/board.filter.help"],function(_,BaseModel){var Model=BaseModel.extend({"bus beforeInit":function(evt){var configurator=evt.data.config.context.configurator,self=this;self.fire("configurator.ready",configurator),configurator.getAppStateStore().get({fields:["acid"],callback:function(result){self.fire("acid.ready",result.acid)}}),configurator.getAppStateStore().unbind({listener:this}),configurator.getAppStateStore().bind({fields:["acid"],listener:this,callback:function(result){self.fire("acid.changed",result.acid)}})},"bus boardSettings.ready:last + remember.acid":function(evt,bs,acid){var boardSettings=bs.boardSettings,self=this;boardSettings.set({set:{acid:acid},callback:function(){self.fire("settings.acid.changed")}})},"bus configurator.ready:last + boardSettings.ready:last + acid.ready + afterInit":function(evt,configurator,bs,acid){var self=this,loggedUser=configurator.getLoggedUser(),boardSettings=bs.boardSettings;boardSettings.get({fields:["ownerId","id","acid"],callback:function(data){var editable=!data.ownerId||data.ownerId==loggedUser.id||loggedUser.isAdministrator;self.fire("dataBind",{editable:editable,acid:data.acid,currentAcid:acid,boardAcidEqualToCurrentAcid:data.acid==acid}),self.fire("board.acid.ready",data.acid)}}),boardSettings.unbind({listener:self}),boardSettings.bind({fields:["acid"],listener:self,callback:function(data){self.fire("refresh")}})},"bus boardSettings.ready:last + destroy":function(evt,bs){bs.boardSettings.unbind({listener:this})},"bus settings.changed":function(evt,settings){settings&&settings.acid&&this.fire("board.acid.ready",settings.acid)},"bus configurator.ready:last + board.acid.ready":function(evt,configurator,acid){if(!acid)return;var self=this,store=configurator.getStore(),sortByValueGetter=function(item){return item.name.toUpperCase()};store.get("project",{fields:["id","name","color","isActive"]}).done(function(result){var projects=_.filter(result[0].data,function(v){return v.isActive});projects=_.sortBy(projects,sortByValueGetter),self.fire("projects.ready",[{id:-1,name:"No project",icon:""}].concat(projects))}),store.get("team",{fields:["id","name","icon"]}).done(function(result){var teams=result[0].data;teams=_.sortBy(teams,sortByValueGetter),self.fire("teams.ready",[{id:-1,name:"No team",icon:""}].concat(teams))});var contextStore=configurator.getApplicationContextService();contextStore.getApplicationContext({acid:acid},{success:function(context){self.fire("applicationContext.ready",context)},failure:function(){self.fire("applicationContext.ready",{appContext:{teamContext:{},projectContext:{},selectedProjects:{},selectedTeams:{}}})}})},"bus teams.ready + projects.ready + applicationContext.ready":function(evt,teams,projects,appContext){if(!appContext)return;var selectedProjectIds={};for(var i=0;i<appContext.selectedProjects.length;i++)selectedProjectIds[appContext.selectedProjects[i].id]=!0;var selectedTeamIds={},totalTeamsNumber=teams.length,totalProjectsNumber=projects.length;for(var i=0;i<appContext.selectedTeams.length;i++)selectedTeamIds[appContext.selectedTeams[i].id]=!0;teams=_.filter(teams,function(team){return appContext.appContext.teamContext.no&&team.id==-1?!0:selectedTeamIds[team.id]});if(teams.length==totalTeamsNumber){if(totalTeamsNumber>1||teams[0].id!=-1)teams=[{name:"Any Team"}]}else teams.length==0&&(teams=[{name:"No Team"}]);projects=_.filter(projects,function(project){return appContext.appContext.projectContext.no&&project.id==-1?!0:selectedProjectIds[project.id]});if(projects.length==totalProjectsNumber){if(totalProjectsNumber>1||projects[0].id!=-1)projects=[{name:"Any Project"}]}else projects.length==0&&(projects=[{name:"No Project"}]);this.fire("context.data.ready",{teams:teams,projects:projects})}});return Model});
define('tau/ui/extensions/board.editor.remember.context/ui.extension.board.editor.remember.context',["Underscore","tau/core/extension.base","tau/models/board.editor/board.filter.suggestionManager"],function(_,ExtensionBase){return ExtensionBase.extend({changeAcid:function($form,currentAcid,boardAcid){$form.find("[name=selected_acid]").val(currentAcid);var rememberButton=$form.find("[name=remember_context]");boardAcid==currentAcid?rememberButton.addClass("tau-checked"):rememberButton.removeClass("tau-checked");if(currentAcid==""){var button=$form.find("[name=remember_context]");button.tauBubble("option","disabled",!0)}},"bus afterRender:last + dataBind:last + acid.changed":function(evt,afterRender,data,acid){var sliceAcid=data.acid;this.changeAcid(afterRender.element,acid,sliceAcid)},createTooltip:function(button,content){button.tauBubble({content:content,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),zIndex:999,className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mouseleave",mode:"tooltip",onPositionConfig:function(config){return config.at="center top",config.my="center bottom",config.offset="0 0",config},onShow:function(){this.adjustPosition()}})},"bus dataBind + afterRender":function(evt,data,afterRender){var element=afterRender.element;this.createTooltip(element.find("[name=remove_context]"),"Remove context"),data.acid||this.createTooltip(element.find("[name=remember_context]"),"Remember selected teams and projects")},"bus afterRender + dataBind":function(evt,afterRender,data){var element=afterRender.element;if(!data.editable){element.find("select, input, button").prop("disabled",!0).addClass("permission-denied");return}var self=this,setAcidValue=function($form,newAcidValue){var currentAcid=element.find("[name=acid]").val();if(currentAcid==newAcidValue)return;newAcidValue==""?(element.find("[name=remember_context]").tauBubble("option","disabled",!0),element.find("[name=remove_context]").attr("disabled",!0),element.find("[name=remember_context]").removeClass("tau-checked")):(element.find("[name=remove_context]").attr("disabled",!1),element.find("[name=remember_context]").addClass("tau-checked")),element.find("[name=acid]").val(newAcidValue),self.fire("remember.acid",newAcidValue)};element.on("click","[name=remember_context]",function(){var newAcidValue=element.find("[name=selected_acid]").val();setAcidValue(element,newAcidValue)}),element.on("click","[name=remove_context]",function(){setAcidValue(element,"")})},createBubble:function(button,html){var timeoutId=null,activeElement=$([]),removeTimeout=function(){timeoutId&&(window.clearTimeout(timeoutId),timeoutId=null)},mouseEnterHandler=function(evt){activeElement=$(this),removeTimeout()},mouseLeaveHandler=function(evt){activeElement=$([]),removeTimeout(),timeoutId=window.setTimeout(hideBubble,500)},hideBubble=function(){button.tauBubble("hide")};button.on("mouseleave",mouseLeaveHandler),button.on("mouseenter",mouseEnterHandler),button.tauBubble({zIndex:999,template:['<div class="tau-bubble tau-bubble-important">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble__inner" role="content"></div>',"</div>"].join(""),onPositionConfig:function(){var offset="0 -6",position={of:button,collision:"fit none",my:"center top",at:"center bottom",offset:offset};return position},onShow:function($popup){activeElement.is(".tau-remember-context")||hideBubble(),$popup.on("mouseleave",mouseLeaveHandler),$popup.on("mouseenter",mouseEnterHandler)},onHide:function($popup){$popup.off("mouseleave",mouseLeaveHandler),$popup.off("mouseenter",mouseEnterHandler)},onResize:function($popup,data){var h=data.height;$popup.find(".tau-bubble__inner").css({maxHeight:h-50,overflowY:"auto"})},className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mousedown",mode:"tooltip",delay:500,content:html,stackName:"tooltip"})},"bus beforeInit:last + afterRender:last + context.data.ready":function(evt,beforeInit,afterRender,context){var configurator=beforeInit.config.context.configurator,html=configurator.getTemplateFactory().get("board.editor.remember.context.data").bind({},context),button=afterRender.element.find("[name=remember_context]");button.prop("disabled",!1),this.createBubble(button,html),button.tauBubble("option","disabled",!1)}})});
define('tau/ui/templates/board.editor.remember.context/ui.template.board.editor.remember.context',["tau/nls/translator","tau/core/templates-factory","tau/ui/templates/board.editor/ui.template.board.editor.filter"],function(T,templates){var config={name:"board.editor.remember.context",engine:"jqote2",markup:['<span class="tau-inline-group tau-board-context-cache">','<button type="button" name="remember_context" role="action-remember-context" ','data-title="'+T("Show&nbsp;only&nbsp;highlighted&nbsp;cards")+'"  ','class="tau-extension-board-tooltip tau-btn tau-remember-context ',"<%if (this.boardAcidEqualToCurrentAcid) {%>","tau-checked","<%}%>",'"',">Save context</button>",'<input type="hidden" name="selected_acid" value="<%=this.currentAcid%>"/>','<input type="hidden" name="acid" value="<%=this.acid%>"/>','<button type="button" name="remove_context" role="action-remove-selected-context" ','data-title="'+T("Remove&nbsp;selected&nbp;context")+'" ',"<% if (!this.acid) { %> "," disabled ","<% } %>",'class="tau-extension-board-tooltip tau-btn tau-close tau-remove-selected-context"></button>',"</span>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.editor.remember.context/ui.template.board.editor.remember.context.data',["tau/core/templates-factory"],function(templates){var config={name:"board.editor.remember.context.data",engine:"jqote2",markup:['<div class="tau-team-project-default">',"<p><strong>Projects and teams</strong> saved for this board:</p>",'<ul class="tau-default-teams">',"<% for(var i=0;i<this.teams.length;i++){ %>",'<li><i class="tau-icon tau-icon_type_svg tau-icon_name_<%=this.teams[i].icon%>"></i><span><%= this.teams[i].name%></span>',"<% } %>","</ul>",'<ul class="tau-default-projects">',"<% for(var i=0;i<this.projects.length;i++){ %>","<li>","<% if (this.projects[i].color) {%>",'<i class="tau-icon tau-icon_type_color" style="background-color: <%=this.projects[i].color%>; "></i>',"<%}%>","<span><%= this.projects[i].name%></span></li>","<% } %>","</ul>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.editor.remember.context',["Underscore","tau/components/component.creator","tau/models/board.editor.remember.context/model.board.editor.remember.context","tau/ui/extensions/board.editor.remember.context/ui.extension.board.editor.remember.context","tau/ui/templates/board.editor.remember.context/ui.template.board.editor.remember.context","tau/ui/templates/board.editor.remember.context/ui.template.board.editor.remember.context.data"],function(_,ComponentCreator,Model,Extnsion,Template){return{create:function(config){var creatorConfig={extensions:[Model,Extnsion],template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/models/board.entityViewer/model.board.entityViewer',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("dataBind",{})}})});
define('tau/ui/extensions/board.entityViewer/ui.extension.board.entityViewer',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(ev,configurator){var self=this,req=configurator.getRequireLoader();req(["all.components"],function(){req(["tau/components/component.application"],function(appComponent){var appConfigurator=configurator.createChild();appConfigurator._id=_.uniqueId("board_entityViewer_"),appConfigurator.isBoardEdition=!0,self.fire("appData.ready",{component:appComponent,configurator:appConfigurator})})})},"bus afterRender":function(){var $body=$("body");$body.tauProgressIndicator(),this.fire("$progressIndicator.ready",$body)},"bus appData.ready":function(ev,appData){var appConfigurator=appData.configurator,appComponent=appData.component;appConfigurator.getHashService().setFakeWindow();var self=this,appConfig={context:{configurator:appConfigurator},options:{applicationId:"boardEntityViewerPopup",integration:{showInPopup:!0,keepAlive:!0},routing:{silent:!0,executeOnStart:!1},comet:{enabled:!1}}};appConfig.options.comet.enabled=appConfigurator.getFeaturesService().isEnabled("comet.notifications");var appBus=appComponent.create(appConfig);appBus.on("application.error",function(evt){self.fire("error",evt.data)}),appBus.initialize(appConfig),self.fire("appBus.ready",appBus)},"bus appData.ready:last + appBus.ready:last + cardDataToShow.ready":function(ev,appData,appBus,cardData){var appConfigurator=appData.configurator;if(!cardData.entityId||!cardData.entityType){console.error("bad data for viewer",cardData);return}this.cleanupStore(appConfigurator),appBus.fire("history.reset"),appBus.fire("application.navigate.entity",{id:cardData.entityId,entity:cardData.entityType})},"bus appBus.error":function(ev,err){this.fire("error",err)},"bus appBus.ready + destroy":function(ev,appBus){appBus.destroy()},cleanupStore:function(configurator){configurator.getStore().evictData()}})});
define('tau/components/component.board.entityViewer',["tau/components/component.creator","tau/models/board.entityViewer/model.board.entityViewer","tau/ui/extensions/board.entityViewer/ui.extension.board.entityViewer","tau/components/extensions/error/extension.errorBar"],function(ComponentCreator,ModelMain,ExtensionViewer,ExtensionError){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelMain,ExtensionViewer,ExtensionError],template:{name:"board.entityViewer",engine:"jqote2",markup:'<div style="display:none;"></div>'}};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.flowHelp/model.board.flowHelp',["Underscore","tau/core/extension.base"],function(_,BaseModel){return BaseModel.extend({"bus beforeInit":function(evt,initData){var configurator=initData.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("dataBind",{})},"bus configurator.ready":function(evt,configurator){var boardName="Story Map Backlog";if($('.tau-boardselector__list .tau-boardselector__link:contains("'+boardName+'")').size()>0){console.log('Board "'+boardName+'" already exists');return}var request={$where:'publicData.name=="\\"'+boardName+'\\""',$fields:["key","publicData.name","publicData.definition"],$limit:{start:0,max:50}};configurator.getRestStorage().select("boardTemplates",request).done(_.bind(function(response){var boardTemplate=response.data[0];this.fire("boardTemplate.ready",boardTemplate)},this))},"bus configurator.ready:last + boardTemplate.ready":function(evt,configurator,boardTemplate){var factory=configurator.getBoardDefinitionFactory(),definition=_.extend(factory.createForLoggedUser(),boardTemplate.definition,{name:boardTemplate.name,isDraft:!1});factory.createBoard(definition).done(_.bind(function(definition){console.log("definition.saved",definition),this.fire("add.board",{board:{id:definition.id}})},this))}})});
define('tau/ui/templates/board.flowHelp/ui.template.board.flowHelp',["tau/core/templates-factory"],function(templates){var config={name:"board.flowHelp",engine:"jqote2",markup:['<div class="tau-gs-info">','    <div class="tau-process">','        <select class="tau-select">',"            <option>Kanban flow</option>","        </select>","    </div>",'    <div class="tau-gs-steps">','        <div class="tau-step tau-step-done">1.</div>','        <div class="tau-step tau-step-current">2.</div>','        <div class="tau-step">3.</div>',"    </div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.flowHelp',["Underscore","tau/components/component.creator","tau/models/board.flowHelp/model.board.flowHelp","tau/ui/templates/board.flowHelp/ui.template.board.flowHelp"],function(_,ComponentCreator,Model,Template){return{create:function(config){var creatorConfig={extensions:[Model],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.quick.add.general',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({resetLifecycle:!0,"bus afterRender":function(e,renderData){var $element=renderData.element,showQuickAddPopup=_.bind(this.showQuickAddPopup,this);$element.find("[role=action-quick-add]").on("click",function(){showQuickAddPopup($(this))})},showQuickAddPopup:function($target){var bubbleConfig={target:$target,cleanupOnHide:!0,stackName:"quickAddGeneral",showOnCreation:!0,zIndex:1e4,onShow:function(){$target.removeClass("tau-quick-add-collapse")},onHide:function(){$target.addClass("tau-quick-add-collapse")},className:"tau-quick-add-dialog-general",onPositionConfig:function(){return{of:$target,collision:"none none",my:"left top",at:"left bottom",offset:"-12 1"}},dontCloseSelectors:["#ui-datepicker-div"],componentsConfig:{components:[{type:"board.cell.quick.add"}]}};this.fire("initBubble",bubbleConfig)}})});
define('tau/models/model.board.quick.add',["Underscore","tau/core/model-base"],function(_,BaseModel){return BaseModel.extend({"bus afterInit":function(){this.fire("dataBind",{})}})});
define('tau/ui/templates/board.add/ui.template.board.general-quick-add',["tau/core/templates-factory","tau/nls/translator"],function(templates,T){var config={name:"board.quick-add",engine:"jqote2",markup:['<div class="tau-btn-add-bg"><div role="action-quick-add"  class="tau-btn tau-btn-big tau-quick-add-collapse tau-success tau-add tau-quick-add"><span>Add</span><i data-collapsed-selector=".tau-sp-collapsed .tau-quick-add-collapse .tau-extension-board-tooltip" data-title-collapsed="'+T("Quick add")+'" class="tau-extension-board-tooltip"></i></div></div>'],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.general.quick.add',["Underscore","tau/components/component.creator","tau/ui/extensions/board.plus/ui.extension.board.plus.quick.add.general","tau/models/model.board.quick.add","tau/ui/templates/board.add/ui.template.board.general-quick-add","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension"],function(_,ComponentCreator,ExtensionQuickAdd,Model,Template,ExtensionTooltip,BubbleCreator,CreatorEx){return{create:function(config){var creatorConfig={extensions:[ExtensionQuickAdd,Model,ExtensionTooltip,BubbleCreator,CreatorEx],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/components/component.board.header',["Underscore","tau/components/component.board.container"],function(_,ComponentCreator){return{create:function(config){var creatorConfig={extensions:[]},componentBus=ComponentCreator.create(_.extend(creatorConfig,config));return componentBus}}});
define('tau/models/board.limits/model.board.limits',["Underscore","tau/core/model-base"],function(_,BaseModel){return BaseModel.extend({INITIAL_STATE:"b64_X0luaXRpYWw_2_",FINAL_STATE:"b64_X0ZpbmFs_",ENTITY_STATE:"entitystate","bus afterInit":function(evt){this.fire("dataBind",{});var configurator=evt.data.config.context.configurator;this.fire("configurator.ready",configurator)},getSlice:function(configurator,boardSettings){var sliceDeferred=$.Deferred();return this.getDefinition(boardSettings).done(_.bind(function(dataDefinition){configurator.getAppStateStore().get({fields:["acid"],callback:function(data){var definition={};definition.global={acid:data.acid},definition=_.extend(definition,dataDefinition);var slice=configurator.getSliceFactory().create({definition:definition});sliceDeferred.resolve(slice)}})},this)),sliceDeferred},getDefinition:function(boardSettings){var deferred=$.Deferred();return boardSettings.get({fields:["cells","x","y"],callback:function(data){deferred.resolve({cells:data.cells,x:data.x,y:data.y})}}),deferred},getLimitFields:function(configurator,boardSettings){var deferred=$.Deferred();return this.getSlice(configurator,boardSettings).done(_.bind(function(slice){var action,definition=slice.config.definition;definition.y&&definition.y.types&&definition.y.types[0]==this.ENTITY_STATE&&(action="y"),definition.x&&definition.x.types&&definition.x.types[0]==this.ENTITY_STATE&&(action="x"),action?slice[action]({$take:999}).done(function(data){deferred.resolve(data.data.items)}):deferred.reject()},this)),deferred},limitValues:function(boardSettings){var deferred=$.Deferred();return boardSettings.get({fields:["limits"],callback:_.bind(function(data){deferred.resolve(data.limits&&data.limits[this.ENTITY_STATE]||{})},this)}),deferred},getAccess:function(configurator,boardSettings){var deferred=$.Deferred(),access={edit:!0},user=configurator.getLoggedUser();return boardSettings.get({fields:["ownerId"],callback:function(boardData){return parseInt(user.id,10)!==parseInt(boardData.ownerId,10)&&!user.isAdministrator&&(access.edit=!1),deferred.resolve(access)}}),deferred},getData:function(configurator,boardSettings){return $.when(this.getLimitFields(configurator,boardSettings),this.limitValues(boardSettings),this.getAccess(configurator,boardSettings)).pipe(_.bind(function(fields,values,access){return fields=_.reduce(fields,function(memo,item){var action="y";item.x&&(action="x");if(item[action].toString()!==this.INITIAL_STATE&&item[action].toString()!==this.FINAL_STATE){var value=values[item[action]];if(!_.isNumber(value)||_.isNaN(value))value="";item.dynamic.items[0].value=value,memo.push(item.dynamic.items[0])}return memo},[],this),{fields:fields,access:access,values:values}},this))},loadData:function(configurator,boardSettings){return _.bind(function(){this.getData(configurator,boardSettings).done(_.bind(function(data){this.fire("dataLimits.ready",data)},this)).fail(_.bind(function(){this.fire("dataLimits.ready",{fields:[],access:{edit:!1}})},this))},this)},"bus configurator.ready + boardSettings.ready":function(evt,configurator,boardSettings){boardSettings=boardSettings.boardSettings;var loadData=this.loadData(configurator,boardSettings);loadData(),configurator.getAppStateStore().unbind({listener:this}),configurator.getAppStateStore().bind({fields:["acid"],listener:this,callback:loadData}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["x","y","cells"],listener:this,callback:loadData})},"bus configurator.ready + boardSettings.ready + destroy":function(evt,configurator,bs){configurator.getAppStateStore().unbind({listener:this}),bs.boardSettings.unbind({listener:this})}})});
define('tau/ui/templates/board.limits/ui.template.board.limit-item',["tau/core/templates-factory"],function(templates){var config={name:"board.limit-item",engine:"jqote2",markup:['<div class="tau-limiter">',"<h4>Limits for States</h4>",'<div class="tau-limit-matrix">',"<%if(this.fields.length){%>","<form>","<table>","<% _.forEach(this.fields,_.bind(function(item) {%>","<tr>","<th><%=item.data.name%></th>",'<td><input class="tau-in-text <%if(!this.access.edit){%>tau-disabled<%}%>" <%if(!this.access.edit){%>disabled<%}%> name="<%=item.id%>" min="0" max="999" value="<%=item.value%>" type="number"></td>',"</tr>","<%},this));%>","</table>","</form>","<%}else{%>",'<div class="tau-empty-limit-text">There\'s no work in progress.</div>',"<%}%>","</div>","</div>"]};return templates.register(config)});
define('tau/ui/extensions/board.limits/ui.extension.board.limits',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/templates/board.limits/ui.template.board.limit-item","libs/jquery/jquery.inputMaskEditor"],function(_,$,ExtensionBase){return ExtensionBase.extend({temp:{},"bus afterRender:last + dataLimits.ready + configurator.ready:last + boardSettings.ready:last":function(evt,afterRender,dataLimits,configurator,boardSettings){var $element=afterRender.element;$element.html(""),this.temp=_.extend(this.temp,dataLimits.values),$element.append(configurator.getTemplateFactory().get("board.limit-item").bind({},dataLimits)),this.setHandler($element,boardSettings.boardSettings)},setHandler:function($element,boardSettings){var $inputs=$element.find("input"),mask=/^\d+$/i;$inputs.closest("form").on("submit",function(){return!1});var saveLimits=_.debounce(_.bind(function(event){var $input=$(event.target);mask.test($input.val())||$input.val("");var limitData=$input.closest("form").serializeArray();limitData=_.reduce(limitData,function(memo,item){return memo[item.name]=parseInt(item.value,10),memo},{}),this.temp=_.extend(this.temp,limitData),boardSettings.set({set:{limits:{entitystate:this.temp}},callback:$.noop}),this.fire("changeLimits",this.temp)},this),100);$inputs.on("input keydown",saveLimits),$inputs.inputMaskEditor({mask:mask})}})});
define('tau/ui/templates/board.limits/ui.template.board.limits',["tau/core/templates-factory"],function(templates){var config={name:"board.limit",engine:"jqote2",markup:['<div class="i-role-limit-list" >',"</div>"]};return templates.register(config)});
define('tau/components/component.board.limits',["Underscore","tau/components/component.creator","tau/models/board.limits/model.board.limits","tau/ui/extensions/board.limits/ui.extension.board.limits","tau/ui/templates/board.limits/ui.template.board.limits"],function(_,ComponentCreator,Model,Extention,Template){return{create:function(config){var creatorConfig={extensions:[Extention,Model],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.main.menu/model.board.main.menu',["tau/core/extension.base"],function(BaseModel){return BaseModel.extend({"bus beforeInit":function(evt,initConfig){this.fire("configurator.ready",initConfig.config.context.configurator)},"bus afterInit":function(evt,config){var configurator=config.config.context.configurator,loggedUser=configurator.getLoggedUser(),store=configurator.getStore(),self=this;store.get("user",{id:loggedUser.id,fields:["avatarUri","firstName","lastName"]}).done({success:function(result){var userData=result[0].data;self.fire("dataBind",{userAvatarURI:userData.avatarUri+"24",userId:userData.id,dashboardUrl:configurator.getUrlBuilder().getDashboardUrl(),logoutUrl:configurator.getUrlBuilder().getLogoutUrl(),userName:[userData.firstName,userData.lastName].join(" ")})}}),store.unbind(this),store.on({eventName:"afterSave",type:"user",listener:self},function(data){data.data.id==loggedUser.id&&self.fire("refresh")})}})});
define('tau/ui/extensions/board.main.menu/ui.extension.board.main.menu',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var self=this,$el=renderData.element,$menus=$el.find(".tau-user-menu");$menus.each(function(){var $menu=$(this),$subMenu=$menu.find(".tau-user-submenu");$subMenu.detach();var coords;$menu.click(function(evt){coords={x:evt.pageX-$(this).position().left}});var onPositionConfig=function(config){config.at="left bottom",config.my="center top",config.offset=coords.x+" 0"};$menu.tauBubble({content:$subMenu,target:$menu,alignTo:$menu,zIndex:999,onArrowPositionConfig:onPositionConfig,onPositionConfig:onPositionConfig,onShow:function($subMenu){$subMenu.find(".tau-menu-item").bind("click",function(){$menu.tauBubble("hide")}),$subMenu.find(".tau-user-menu-profile").bind("click",function(){self.fire("show.user.profile"),$menu.tauBubble("hide")}),$subMenu.find(".tau-user-menu-getting-started").bind("click",function(){self.fire("gettingStarted.show"),$menu.tauBubble("hide")})},onHide:function($subMenu){$subMenu.find(".tau-menu-item").unbind("click"),$subMenu.find(".tau-user-menu-profile").unbind("click")}})})}})});
define('tau/ui/extensions/board.main.menu/ui.extension.board.main.menu.viewer',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(ev,initConfig){var self=this,configurator=initConfig.config.context.configurator;configurator.getComponentBusRegistry().getByName("board.entityViewer").done(function(viewerBus){self.fire("viewerBus.ready",viewerBus)})},"bus viewerBus.ready:last + dataBind:last + show.user.profile":function(e,viewerBus,data){viewerBus.fire("cardDataToShow.ready",{entityType:"user",entityId:data.userId})}})});
define('tau/ui/extensions/board.main.menu/ui.extension.board.main.menu.feedback',["jQuery","tau/core/extension.base"],function($,ExtensionBase){function setHourlyAlarm(callback){var now=new Date,mins=now.getMinutes(),secs=now.getSeconds(),msToNextHour=((60-mins)*60-secs)*1e3;clearTimeout(d),d=setTimeout(function(){callback(),setHourlyAlarm(callback)},msToNextHour)}var d=null;return ExtensionBase.extend({"bus afterRender + view.dom.ready":function(evt,renderData){var $el=renderData.element,$feedback=$el.find(".uservoice-feedback-button"),callback=function(){$feedback.stop(!0,!0),$feedback.animateWithCss({cssClassName:"uservoice-feedback-button-shaked"})};setHourlyAlarm(callback)}})});
define('tau/ui/templates/board.main.menu/ui.template.board.main.menu',["tau/core/templates-factory"],function(){var config={name:"board.main.menu",engine:"jqote2",markup:['<ul class="tau-main-menu">','<li class="tau-menu-item">','<a class="tau-back-to-old-ui" href="<%=this.dashboardUrl%>">TP2</a>',"</li>",'<li class="tau-menu-item tau-menu-items-container tau-user-menu">','<span class="tau-popup-link">Help</span>','<ul class="tau-user-submenu">','<li class="tau-menu-item"><a href="http://www.targetprocess.com/3/guide/" target="blank">User Guide</a></li>',"</ul>","</li>",'<li class="tau-menu-item tau-menu-items-container tau-user-menu">','<img title="<%! this.userName %>" class="tau-user-avatar" src="<%= this.userAvatarURI%>" />','<ul class="tau-user-submenu">','<li class="tau-menu-item tau-user-name"><%=this.userName%></li>','<li class="tau-menu-item tau-user-menu-profile"><span>My Profile</span></li>','<li class="tau-menu-item tau-user-menu-logout"><a href="<%=this.logoutUrl%>">Logout</a></li>',"</ul>","</li>",'<li class="tau-menu-item uservoice-feedback-button-container">','<a class="uservoice-feedback-button" href="javascript:UserVoice.showPopupWidget();">Feedback</a>',"</li>","</ul>"],dependencies:[]};return config});
define('tau/components/component.board.main.menu',["tau/components/component.creator","tau/models/board.main.menu/model.board.main.menu","tau/ui/extensions/board.main.menu/ui.extension.board.main.menu","tau/ui/extensions/board.main.menu/ui.extension.board.main.menu.viewer","tau/ui/extensions/board.main.menu/ui.extension.board.main.menu.feedback","tau/ui/templates/board.main.menu/ui.template.board.main.menu"],function(ComponentCreator,Model,Extension,ExtensionViewer,ExtensionFeedback,Template){return{create:function(config){var creatorConfig={extensions:[Model,Extension,ExtensionViewer,ExtensionFeedback],template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/models/board.overview/model.board.overview',["Underscore","tau/core/extension.base"],function(_,BaseModel){var Model=BaseModel.extend({"bus beforeInit":function(evt,initConfig){this.fire("dataBind",{viewMode:"board"});var configurator=initConfig.config.context.configurator,options=_.defaults(initConfig.config,{boardName:"board_plus"});this.fire("options.ready",options),this.fire("configurator.ready",configurator)},"bus options.ready:last + configurator.ready:last + boardSettings.ready":function(evt,options,configurator,bs){configurator.getComponentBusRegistry().getByName(options.boardName,_.bind(function(bus){this.fire("boardBus.ready",bus)},this))},"bus boardBus.ready":function(evt,boardBus){var self=this;boardBus.removeAllListeners(this),boardBus.on("overview.board.retrieved",function(e,$boardEl){self.fire("$boardEl.ready",$boardEl),self.fire("$boardGrid.ready",$boardEl.find(".i-role-grid"))},this),boardBus.on("overview.board.updated",function(e,$boardEl){self.fire("$boardEl.ready",$boardEl),self.fire("$boardGrid.ready",$boardEl.find(".i-role-grid"))},this),boardBus.fire("overview.board.retrieve")},"bus boardBus.ready > destroy":function(evt,boardBus){boardBus.removeAllListeners(this)}});return Model});
define('tau/ui/extensions/board.overview/ui.extension.board.overview',["Underscore","jQuery","tau/core/extension.base"],function(_,$,EventEmitter){return EventEmitter.extend({"bus beforeInit + view.dom.ready":function(){var $element=$('<div style="overflow:scroll;width:30px;">s g s e l e m e n t s f s e </div>');$("body").append($element),this.scrollWidth=$element.width()-$element[0].clientWidth,$element.remove();var self=this;Array.prototype.map?require(["libs/d3/d3"],function(draw){self.fire("draw.ready",draw)}):self.fire("draw.ready",!1)},"bus $boardGrid.ready":function(evt,$boardGrid){$boardGrid.unbind("scroll.overview"),$boardGrid.bind("scroll.overview",_.bind(function(){this.fire("visiblerPosition.update")},this))},"bus $el.ready:last + $boardGrid.ready:last + svg.ready:last + visiblerPosition.update":function(evt,$el,$grid){var offset={x:$grid.scrollLeft(),y:$grid.scrollTop()},x=Math.max(0,Math.min(this.maxVisiblerOrigin.x,offset.x/this.verticalProportion)),y=Math.max(0,Math.min(this.maxVisiblerOrigin.y,offset.y/this.horizontalProportion));$el.find(".tau-boardoverview__visibler").attr("x",x).attr("y",y).data([{x:x,y:y}])},"bus afterRender":function(evt,renderData){this.fire("$el.ready",renderData.element)},"bus options.ready:last + draw.ready:last + $el.ready:last + $boardEl.ready":function(evt,options,draw,$el,$boardEl){if(!draw)return;var config={width:options.width,height:options.height,$boardElement:$boardEl},$holder=$el.find("[role=holder]");this.drawOverview($holder,config).done(_.bind(function(svg){this.fire("svg.ready",svg)},this))},drawOverview:function($holder,config){var def=$.Deferred(),currentSVG=$holder.find("svg");$holder.toggleClass("tau-boardoverview__holder_state_redraw",!0);var drawConfig=_.defaults(config,{width:$.browser.msie?206:207,height:400}),svg=this.draw($holder,drawConfig)[0];return $holder.toggleClass("tau-boardoverview__holder_state_redraw",!1),currentSVG.remove(),def.resolve(svg)},getGridMetrics:function(grid){var $table=$(grid).find("table"),table=$table[0],real={w:$table.width(),h:$table.height()},gridMetrics={contentSize:{width:real.w,height:real.h},clientSize:{width:Math.min(grid.clientWidth,table.clientWidth),height:Math.min(grid.clientHeight,table.clientHeight)}};return gridMetrics},getViewMetrics:function(drawConfig,grid){var max={w:drawConfig.width,h:drawConfig.height},width=max.w,gridMetrics=this.getGridMetrics(grid),proportion=this.verticalProportion=this.horizontalProportion=gridMetrics.contentSize.width/width,contentHeight=Math.ceil(gridMetrics.contentSize.height/proportion),overviewMetrics={clientSize:{width:drawConfig.width,height:Math.min(drawConfig.height,contentHeight)},contentSize:{width:Math.ceil(gridMetrics.contentSize.width/proportion),height:contentHeight},selectorSize:{width:Math.ceil(gridMetrics.clientSize.width/proportion),height:Math.ceil(gridMetrics.clientSize.height/proportion)}};return{width:width,verticalProportion:proportion,horizontalProportion:proportion,overviewMetrics:overviewMetrics}},getFitsViewMetrics:function(drawConfig,grid){var gridMetrics=this.getGridMetrics(grid);this.horizontalProportion=gridMetrics.contentSize.width/drawConfig.width,this.veticalProportion=gridMetrics.contentSize.height/drawConfig.height;var overviewMetrics={clientSize:_.clone(drawConfig),contentSize:_.clone(drawConfig),selectorSize:{width:Math.ceil(gridMetrics.clientSize.width/this.horizontalProportion),height:Math.ceil(gridMetrics.clientSize.height/this.veticalProportion)}};return{width:drawConfig.width,verticalProportion:this.veticalProportion,horizontalProportion:this.horizontalProportion,overviewMetrics:overviewMetrics}},draw:function($holder,drawConfig){var $board=drawConfig.$boardElement,$grid=$board.find(".i-role-grid"),grid=$grid[0],$table=$grid.find("table"),table=$table[0];$table=$table.length?$table:$grid.children().eq(0);if(!$table.length)return!1;drawConfig=_.clone(drawConfig);var scrollWidth=this.scrollWidth,metrics=this.getViewMetrics(drawConfig,grid),clientHeight=metrics.overviewMetrics.clientSize.height,overviewIsFitsInTheDesiredSize=clientHeight>=metrics.overviewMetrics.contentSize.height;overviewIsFitsInTheDesiredSize==0?(drawConfig.width-=scrollWidth+(scrollWidth>0?1:0),metrics=this.getViewMetrics(drawConfig,grid),clientHeight>metrics.overviewMetrics.clientSize.height&&(drawConfig.width+=scrollWidth,metrics=this.getFitsViewMetrics(drawConfig,grid),scrollWidth=0)):scrollWidth=0,clientHeight=metrics.overviewMetrics.clientSize.height;var data=this.getData($board),width=metrics.width,verticalProportion=metrics.verticalProportion,horizontalProportion=metrics.horizontalProportion,overviewMetrics=metrics.overviewMetrics,selectorSize=overviewMetrics.selectorSize;$holder.parent().width(drawConfig.width+scrollWidth+($.browser.msie?1:0)),$holder.width(overviewMetrics.clientSize.width),$holder.parent().height(clientHeight+2);var _s=function(val){return _.isNaN(val)?0:val},svg=d3.select($holder[0]).append("svg").attr("class","tau-boardoverview__chart").attr("width",_s(overviewMetrics.clientSize.width)).attr("height",_s(overviewMetrics.contentSize.height)),x=0,y=0,girdY=0,maxVisiblerOrigin=this.maxVisiblerOrigin={x:overviewMetrics.contentSize.width-selectorSize.width,y:overviewMetrics.contentSize.height-selectorSize.height};_.forEach(data.rows,function(row,i){var cellHeight=row.height/verticalProportion;x=0,_.forEach(row.cells,function(cell,j){var cellWidth=cell.width/horizontalProportion;svg.append("rect").attr("class","tau-boardoverview__cell").attr("width",_s(cellWidth)).attr("height",_s(cellHeight)).attr("x",_s(x)).attr("y",_s(y)),_.forEach(cell.cards,function(card,k){var cardClass="tau-boardoverview__card-"+card.type.toLowerCase(),cardWidth=card.width/horizontalProportion,cardHeight=card.height/verticalProportion,cardRect=svg.append("rect").attr("class","tau-boardoverview__card "+cardClass).attr("width",_s(cardWidth)).attr("height",_s(cardHeight)).attr("x",_s(card.offsetLeft/horizontalProportion)).attr("y",_s(card.offsetTop/verticalProportion))}),x+=cellWidth}),girdY+=row.height,y=girdY/verticalProportion});var startCoords={x:grid.scrollLeft/horizontalProportion,y:grid.scrollTop/verticalProportion},visibler=svg.append("rect").data([{x:startCoords.x,y:startCoords.y}]).attr("class","tau-boardoverview__visibler").attr("width",_s(overviewMetrics.selectorSize.width)).attr("height",_s(overviewMetrics.selectorSize.height)).attr("x",function(d){return _s(d.x)}).attr("y",function(d){return _s(d.y)}),click=function(){var p=d3.mouse(svg[0][0]),x=Math.max(0,Math.min(maxVisiblerOrigin.x,p[0]-selectorSize.width/2)),y=Math.max(0,Math.min(maxVisiblerOrigin.y,p[1]-selectorSize.height/2));visibler.attr("x",_s(x)).attr("y",_s(y)).data([{x:x,y:y}]);var gridX=x*horizontalProportion,gridY=y*verticalProportion;grid.scrollLeft=gridX,grid.scrollTop=gridY};svg.on("click",click);var dragmove=function(d){var x=Math.max(0,Math.min(maxVisiblerOrigin.x,d3.event.x)),y=Math.max(0,Math.min(maxVisiblerOrigin.y,d3.event.y));visibler.attr("x",d.x=_s(x)).attr("y",d.y=_s(y))},dragstop=function(){var x=visibler.attr("x"),y=visibler.attr("y"),gridX=x*horizontalProportion,gridY=y*verticalProportion;grid.scrollLeft=gridX,grid.scrollTop=gridY},drag=d3.behavior.drag().origin(Object).on("drag",dragmove).on("dragend",dragstop);return visibler.call(drag),svg},getData:function($board){var _comp=function(el,name){var c=getComputedStyle(el)[name];return _.isNaN(c)?0:parseInt(getComputedStyle(el)[name],10)},data={rows:[],colNum:0,rowNum:0},$grid=$board.find(".i-role-grid"),$trs=$grid.find("tr");return $trs=$trs.length?$trs:$grid.find(".i-role-cellholder"),$trs.each(function(){var trData={height:this.clientHeight||$(this).height(),cells:[]};data.rows.push(trData);var $cells=$(".i-role-cellholder",this);$cells=$cells.length?$cells:$(this),$cells.each(function(){if(this.getAttribute("data-is-hidden"))return;var w=_comp(this,"width");if($(this).css("display")=="none")return;var cellData={width:w,cards:[]};trData.cells.push(cellData),$(".i-role-card",this).each(function(){cellData.cards.push({id:this.id,type:this.getAttribute("data-entity-type").toLowerCase(),offsetLeft:this.offsetLeft+(this.offsetParent?this.offsetParent.offsetLeft:0),offsetTop:this.offsetTop+(this.offsetParent?this.offsetParent.offsetTop:0),width:_comp(this,"width"),height:_comp(this,"height")})})})}),data.rows.length&&(data.colNum=$board.find(".i-role-header[data-dimension=x] .i-role-cellholder:not([data-is-hidden=1])").length,data.rowNum=$board.find(".i-role-header[data-dimension=y] .i-role-cellholder:not([data-is-hidden=1])").length),data}})});
define('tau/ui/templates/board.overview/ui.template.board.overview',["tau/core/templates-factory"],function(templates){var config={name:"board.overview",engine:"jqote2",markup:['<% if (this.viewMode == "board"){ %>','<div class="tau-boardoverview <% if (this.isCollapsed == false) { %>tau-boardoverview_active_true<% } %>">','<div role="holder" class="tau-boardoverview__holder">',"</div>","</div>","<% } else { %>","<div></div>","<% } %>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.overview',["Underscore","tau/components/component.creator","tau/models/board.overview/model.board.overview","tau/ui/extensions/board.overview/ui.extension.board.overview","tau/ui/templates/board.overview/ui.template.board.overview"],function(_,ComponentCreator,Model,ExtensionDraw,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionDraw],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.owner/model.board.owner',["tau/core/extension.base"],function(ModelBase){return ModelBase.extend({"bus beforeInit:last + boardSettings.ready":function(evt,initConfig,bs){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator);var self=this,boardSettings=bs.boardSettings;boardSettings.get({fields:["ownerId"],callback:function(data){self.fire("ownerId.ready",data.ownerId)}})},"bus configurator.ready:last + ownerId.ready":function(evt,configurator,ownerId){var self=this;configurator.getStore().get("user",{id:ownerId||configurator.getLoggedUser().id,fields:["id","firstName","lastName","avatarUri","email"]}).done({success:function(res){var data=res[0].data;data.name=_.trim([data.firstName,data.lastName].join(" "))||data.email,data.name=data.name.replace(/\s/g,"&nbsp;"),self.fire("dataBind",data)},failure:function(res){self.fire("dataBind",{})}})}})});
define('tau/ui/templates/board.owner/ui.template.board.owner',["tau/core/templates-factory"],function(templates){var config={name:"board.owner",engine:"jqote2",markup:["<% if (this.name){ %>",'<span class="tau-board-owner">','<span class="tau-label">Board owner</span>','<span class="tau-avatar tau-extension-board-tooltip"  ','data-title="<%=this.name%>">','<img src="<%! this.avatarUri %>20" />',"</span>","</span>","<% } %>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.owner',["tau/components/component.creator","tau/models/board.owner/model.board.owner","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/ui/templates/board.owner/ui.template.board.owner"],function(Creator,Model,ExtensionTooltip,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionTooltip],template:Template};return Creator.create(creatorConfig,config)}}});
define('tau/models/board.paging/model.board.paging',["Underscore","tau/core/model-base"],function(_,BaseModel){var Model=BaseModel.extend({"bus afterInit":function(evt){var self=this,config=evt.data.config,configurator=evt.data.config.context.configurator;self.fire("configurator.ready",configurator),configurator.getComponentBusRegistry().getByName(config.boardName).done(function(bus){self.fire("boardBus.ready",bus)})},"bus boardBus.ready":function(evt){var boardBus=evt.data,self=this,_f=_.bind(self.fire,self),_fire=function(newName){return function(evt){_f(newName||evt.name,evt.data)}};boardBus.removeAllListeners(this),boardBus.on("board.paging.settings",_fire("pagingData.ready"),this),boardBus.on("board.paging.settings.retrieved",_fire("pagingData.retrieved"),this),boardBus.on("page.move.to",_fire("refresh"),this),boardBus.fire("board.paging.settings.retrieve",{})},"bus pagingData.retrieved":function(evt){var boardData=evt.data,paging=this._calculatePaging(boardData),self=this;self.fire("dataBind",paging),self.fire("paging.ready",paging)},"bus paging.ready:last+pagingData.ready":function(evt){var currentPaging=_.values(evt)[0].data,boardData=_.values(evt)[1].data,newPaging=this._calculatePaging(boardData);(currentPaging.pagesX!=newPaging.pagesX||currentPaging.pagesY!=newPaging.pagesY)&&this.fire("refresh")},"bus boardBus.ready:last+page.switched":function(evt){var boardBus=_.values(evt)[0].data,page=_.values(evt)[1].data,self=this;boardBus.fire("page.switched",page)},"bus boardBus.ready+destroy":function(evt){var boardBus=_.values(evt)[0].data;boardBus.removeAllListeners(this)},_calculatePaging:function(boardData){var data={pagesX:boardData.x.totalPages||1,pagesY:boardData.y.totalPages||1,current:boardData.page};return data}});return Model});
define('tau/ui/extensions/board.paging/ui.extension.board.paging',["Underscore","jQuery","tau/core/event.emitter"],function(_,$,EventEmitter){return EventEmitter.extend({"bus afterRender":function(evt){var $el=evt.data.element,self=this;$el.delegate(".i-role-page","click",function(e){var $page=$(this),data=$page.data(),pageData={x:data.x,y:data.y};$el.find(".i-role-page").removeClass("tau-boardpaging__page_current_true"),$page.addClass("tau-boardpaging__page_current_true"),self.fire("page.switched",pageData)})}})});
define('tau/ui/templates/board.paging/ui.template.board.paging',["tau/core/templates-factory"],function(templates){var config={name:"board.paging",engine:"jqote2",markup:['<div class="tau-boardpaging">','<div class="tau-boardpaging__holder">',"<% if (this.pagesY > 1 || this.pagesX > 1){ %>","<table>","<% for (var y=0; y<this.pagesY; y++){ %>","<tr>","<% for (var x=0; x<this.pagesX; x++){ %>",'<td class="tau-boardpaging__page i-role-page',"<% if (this.current.x == x && this.current.y == y){ %>"," tau-boardpaging__page_current_true","<% } %>",'" data-x="<%= x %>" data-y="<%= y %>">',"</td>","<% } %>","</tr>","<% } %>","</table>","<% } %>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.paging',["Underscore","tau/components/component.creator","tau/models/board.paging/model.board.paging","tau/ui/extensions/board.paging/ui.extension.board.paging","tau/ui/templates/board.paging/ui.template.board.paging"],function(_,ComponentCreator,Model,ExtensionDraw,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionDraw],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/core/bus.profiler',["Underscore","tau/core/class"],function(_,Class){var BusProfiler=Class.extend({init:function(originalBus){var selfProfiler=this;selfProfiler.stream=[],selfProfiler.stopped=!1;var fnSrcFireMethod=originalBus.fire;originalBus.fire=function(){var args=arguments;!selfProfiler.stopped&&selfProfiler.registerEvent(args),fnSrcFireMethod.apply(this,args)}},stop:function(){this.stopped=!0},registerEvent:function(args){var tick=+(new Date),evt={tick:tick,name:args[0],data:args[1]||{}};this.stream.push(evt)},data:function(){return this.stream}});return BusProfiler});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.profiler',["Underscore","jQuery","tau/core/event.emitter"],function(_,$,EventEmitter){var findEventByName=function(stream,name){var result=_(stream).chain().find(function(evt){return evt.name===name}).value();return result},selectEventsCollectionByName=function(stream,name){var result=_(stream).chain().select(function(evt){return evt.name===name}).value();return result},diff=function(stream,evtStart,evtEnd){var e0=findEventByName(stream,evtStart),e1=findEventByName(stream,evtEnd);return e1.tick-e0.tick},overallTime=function(stream){var e0=stream[0],eL=stream[stream.length-1];return eL.tick-e0.tick},basicSkeleton=function(stream){var total=diff(stream,"initialize","view.skeleton.built"),rest=diff(stream,"model.get.sliceInfo","model.sliceInfo.retrieved");return{client:total-rest,server:rest,total:total}},groupEventTimeline=function(srcEvtLine,pairedEvtLine,startEventName,endEventName,groupIdIterator){var groupedTimeLine={};for(var i=0;i<srcEvtLine.length;i++){var item=srcEvtLine[i],groupId=groupIdIterator(item),pair=_(pairedEvtLine).find(function(evt){var id=groupIdIterator(evt);return id==groupId});if(!pair)console.log("pair event ["+endEventName+"] is not found for ["+startEventName+"]"),console.log("cell group: "+groupId);else{var timePoint={id:groupId,orig:item,pair:pair};groupedTimeLine[timePoint.id]=timePoint}}return groupedTimeLine},getAvgMaxTotal=function(timeMetrics){var maxValue=_(timeMetrics).max(function(m){return m}),totalSum=0;_(timeMetrics).each(function(m){totalSum+=m});var avgValue=totalSum/timeMetrics.length;return{avg:avgValue.toFixed(2),max:maxValue.toFixed(2),total:totalSum.toFixed(2)}},cellsSkeletons=function(stream){var viewCellSlotBuiltStart=findEventByName(stream,"view.cellSlot.built.start"),viewCellSlotBuilt=selectEventsCollectionByName(stream,"view.cellSlot.built"),viewCellSkeletonBuilt=selectEventsCollectionByName(stream,"view.cell.skeleton.built"),e0=viewCellSlotBuiltStart,eL=viewCellSkeletonBuilt[viewCellSkeletonBuilt.length-1],overallTime=eL.tick-e0.tick,modelGetCellBasicInfo=selectEventsCollectionByName(stream,"model.get.cell.basicInfo"),modelCellBasicInfoRetrieved=selectEventsCollectionByName(stream,"model.cell.basicInfo.retrieved"),serverGroups=groupEventTimeline(modelGetCellBasicInfo,modelCellBasicInfoRetrieved,"model.get.cell.basicInfo","model.cell.basicInfo.retrieved",function(item){return["x",item.data.x,"y",item.data.y].join("")}),totalGroups=groupEventTimeline(viewCellSlotBuilt,viewCellSkeletonBuilt,"view.cellSlot.built","view.cell.skeleton.built",function(item){return["x",item.data.data.x,"y",item.data.data.y].join("")}),serverMetrics=[],clientMetrics=[];return _(totalGroups).each(function(v,k){var total=v.pair.tick-v.orig.tick,rest=serverGroups[k],server=0;rest.orig.data.hasOwnProperty("x")&&rest.orig.data.hasOwnProperty("y")&&(server=rest.pair.tick-rest.orig.tick,serverMetrics.push(server));var client=total-server;clientMetrics.push(client)}),{total:overallTime,client:getAvgMaxTotal(clientMetrics),server:getAvgMaxTotal(serverMetrics)}},formatResult=function(messages){var $placeholder=$("<div></div>");$placeholder.width(375),$placeholder.height(225),$placeholder.empty().append("<p><b>Performance statistics:</b></p>");for(var i=0;i<arguments.length;i++){$placeholder.append("<hr />");if(_.isArray(arguments[i]))for(var s=0;s<arguments[i].length;s++)$placeholder.append("<p style='padding:1;margin:0;'>"+arguments[i][s]+"</p>");else $placeholder.append("<p style='padding:1;margin:0;'>"+arguments[i]+"</p>")}return $placeholder};return EventEmitter.extend({init:function(config){this._super(config),this.expected=0,this.actual=0},"bus model.sliceInfo.retrieved":function(evt){var evtSlc=evt.data,hasX=!!evtSlc.marksX,hasY=!!evtSlc.marksY,xl=hasX?evtSlc.marksX.length:1,yl=hasY?evtSlc.marksY.length:1;this.expected=xl*yl,hasX&&hasY&&(this.expected+=xl+yl)},"bus profiler.ready:last+afterRender:last+view.cell.skeleton.built":function(evt){++this.actual;var r=this.actual===this.expected;if(r){var busProfiler=evt["profiler.ready"].data.profiler,$element=evt.afterRender.data.element;busProfiler.stop();var stream=busProfiler.data(),e0=stream[0],eL=stream[stream.length-1],total=eL.tick-e0.tick,label=["D",'<sup style="background-color:rgba(255, 25, 0, 0.5);font-size:9px;border:1px solid;color:#000;padding:0 1px 0 1px;">',total,"</sup>"].join("");this.buildDiagnostics(busProfiler,$element,label)}},buildDiagnostics:function(busProfiler,$element,label){var $stat=$("<div></div>");$stat.css("padding","4px").css("background","rgba(125, 125, 125, 0.7)").css("font-size","10px").css("color","#ffffff").css("width","20px").css("height","20px").css("z-index","100").css("margin-top","3px").css("margin-left","3px").css("position","absolute").css("top","0px").css("left","0px");var collectStatistics=function(){var stream=busProfiler.data(),$headers=$element.find("[role=header]"),colsCount=$headers.filter("[data-dimension=x]").find("[role=cell]").size(),rowsCount=$headers.filter("[data-dimension=y]").find("[role=cell]").size(),cardCount=$element.find("[role=grid]").find("[role=card]").size(),generalInfoMsg="Slice: "+colsCount+" x "+rowsCount+" ["+cardCount+" cards]",overallTimeMsg="Overall time: ["+overallTime(stream)+"] ms",basic=basicSkeleton(stream),basicSkeletonMsg=["Basic skeleton: ["+basic.total+"] ms","> Client: ["+basic.client+"] ms","> Server: ["+basic.server+"] ms"],cells=cellsSkeletons(stream),cellsSkeletonsMsgTotal="Cells skeletons build process has taken ["+cells.total+"] ms",cellsSkeletonsMsgServer=["> Server: ","[","AVG:"+cells.server.avg," / ","MAX: "+cells.server.max,"] ms"].join(""),cellsSkeletonsMsgClient=["> Client: ","[","AVG:"+cells.client.avg," / ","MAX: "+cells.client.max," / ","SUM: "+cells.client.total,"] ms"].join(""),$container=formatResult(generalInfoMsg,overallTimeMsg,basicSkeletonMsg,[cellsSkeletonsMsgTotal,cellsSkeletonsMsgServer,cellsSkeletonsMsgClient]);$container.css("padding","4px").css("background","rgba(125, 125, 125, 0.7)").css("font-size","10px").css("color","#ffffff").css("z-index","100").css("position","absolute").appendTo($stat),$stat.children().eq(0).toggle(function(){$container.hide()},function(){$container.show()})},$analyze=$("<div title='diagnostics'>"+label+"</div>");$analyze.css("color","#A9D975").css("font-size","18px").css("font-family","Tahoma").css("text-align","center").css("width","100%").css("height","100%").css("line-height","100%").css("cursor","pointer").one("click",collectStatistics),$stat.append($analyze),$element.append($stat)}})});
define('tau/views/view.board.plus',["jQuery","tau/core/extension.base.stateful","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,EventEmitter,BoardPlusUtils){return EventEmitter.extend({name:"view.board.plus","bus view.build.skeleton":function(evt){BoardPlusUtils.resetCardIds();var data=evt.data;this.fire("template.bind",{name:"boardplus.skeleton",data:data})},"bus template.boardplus.skeleton.bound":function(evt){var self=this,$element=evt.data.element;this.fire("view.skeleton.built",{element:$element});var $cells=$element.find(".i-role-cell");self.fire("view.cellSlot.built.start",{cells:$cells}),$cells.each(function(){var coords={};this.hasAttribute("data-x")&&(coords.x=this.getAttribute("data-x")),this.hasAttribute("data-y")&&(coords.y=this.getAttribute("data-y")),self.fire("view.cellSlot.built",{element:this,data:coords})}),self.fire("view.cellSlot.built.end",{cells:$cells})},"bus view.build.cell.skeleton":function(evt){var data=evt.data,hasX=data.hasOwnProperty("x"),hasY=data.hasOwnProperty("y"),cellType=hasX&&hasY?"grid":"axis",templateName="boardplus.cell."+cellType+".skeleton",bindData=data;cellType=="axis"&&(bindData=BoardPlusUtils.convertCellAxisData(bindData)),this.bindCellTemplate(templateName,bindData)},bindCellTemplate:function(templateName,data){this.fire("template.bind",{name:templateName,data:data})},appendCellToBoardSkeleton:function(cellEvtData,$skeleton){var cellDataItem=cellEvtData.data,$cellContent=cellEvtData.element,cellId=BoardPlusUtils.generateId(cellDataItem),$cell=$skeleton.find("#"+cellId),target={cell:$cell,content:$cellContent};this.fire("view.cell.skeleton.element.beforeUpdate",target),$cell.append($cellContent),this.fire("view.cell.skeleton.element.afterUpdate",target),this.fireCellSkeletonBuilt({element:$cell,data:cellDataItem})},fireCellSkeletonBuilt:function(eventData){this.fire("view.cell.skeleton.built",eventData)},"bus view.skeleton.built:last+template.boardplus.cell.grid.skeleton.bound":function(evt){var $skeleton=evt["view.skeleton.built"].data.element,cellEvtData=evt["template.boardplus.cell.grid.skeleton.bound"].data;this.appendCellToBoardSkeleton(cellEvtData,$skeleton)},"bus view.skeleton.built:last+template.boardplus.cell.axis.skeleton.bound":function(evt){var $skeleton=evt["view.skeleton.built"].data.element,cellEvtData=evt["template.boardplus.cell.axis.skeleton.bound"].data;this.appendCellToBoardSkeleton(cellEvtData,$skeleton)},"bus view.cell.skeleton.built":function(evt){var self=this,evtData=evt.data,dataItem=evtData.data,hasX=dataItem.hasOwnProperty("x"),hasY=dataItem.hasOwnProperty("y");if(hasX&&hasY){var $cell=evtData.element;$cell.find(".i-role-card").each(function(){var $card=$(this);self.fire("view.card.skeleton.built",{element:$card,data:{id:$card.attr("data-id"),type:$card.attr("data-type")}})})}}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.controller',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){var onViewCellSkeletonBuiltTickHandler=function(meta,cell){var ext=this;meta.refActualCellsCount+=1,meta.refActualCellsData.push(cell),meta.refActualCellsCount===meta.expectedCellsCount&&ext.fire("overview.cells.skeletons.ready",{cells:meta.refActualCellsData,cardGroups:meta.refActualCellsCardsGroupedHash})};return ExtensionBase.extend({init:function(config){this._super(config),this.config=config},"bus initialize":function(evt,initConfig){var options=this._extractOptions(initConfig.options,{dragndrop:{containmentRefreshTimeout:null},clipboard:{processTimeout:null}});this.fire("options.ready",options),this.fire("configurator.ready",evt.data.context.configurator),this.fire("board.configurator.initialized",{configurator:evt.data.context.configurator}),this.startLifeCycle(evt.data)},"bus refresh":function(evt){this.startLifeCycle(this.config)},"bus configurator.ready > refresh":function(evt,configurator){this.fire("configurator.ready",configurator)},"bus options.ready > refresh":function(evt,options){this.fire("options.ready",options)},startLifeCycle:function(data){var self=this;self.fire("start.lifecycle",data)},"bus start.lifecycle":function(){var self=this;self.fire("afterInit",{}),self.fire("model.get.sliceInfo")},"bus pastElement:last+afterRender":function(evt){var newElement=evt.afterRender.data,pastElement=evt.pastElement.data,$newElement=newElement.element,$pastElement=pastElement.element;$pastElement!==$newElement&&this.fire("board.element.updated",{newElement:$newElement,oldElement:$pastElement})},"bus view.skeleton.built":function(evt){var self=this;self.fire("afterRender",evt.data),self.fire("pastElement",evt.data)},"bus afterRender":function(evt){var $el=evt.data.element,$grid=$el.find(".i-role-grid");this.fire("$el.ready",$el),this.fire("$grid.ready",$grid)},"bus model.sliceInfo.retrieved":function(evt){var self=this,data=evt.data;self.fire("view.build.skeleton",data);var eColsCount=data.x.onPage,eRowsCount=data.y.onPage,iColsCount=eColsCount||1,iRowsCount=eRowsCount||1,expectedCellsCount=iColsCount*iRowsCount+eColsCount+eRowsCount;self.fire("metaInfo",{expectedCellsCount:expectedCellsCount,refActualCellsCount:0,refActualCellsData:[]})},"bus model.cell.basicInfo.retrieved":function(evt){var cellDataItem=evt.data;this.fire("view.build.cell.skeleton",cellDataItem)},"bus view.cellSlot.built.start":function(){this.fire("model.get.cell.basicInfo.start",{})},"bus view.cellSlot.built.end":function(){this.fire("model.get.cell.basicInfo.end",{})},fireOverviewCardsReady:function(metaInfo){this.fire("overview.cards.ready",{cards:metaInfo.refActualCellsCardsHash,cardGroups:metaInfo.refActualCellsCardsGroupedHash})},"bus metaInfo":function(){this.onViewCellSkeletonBuiltTick=onViewCellSkeletonBuiltTickHandler},"bus overview.cells.skeletons.ready":function(){this.onViewCellSkeletonBuiltTick=$.noop},"bus metaInfo:last+view.cell.skeleton.built":function(e){var meta=e.metaInfo.data,cell=e["view.cell.skeleton.built"].data;this.onViewCellSkeletonBuiltTick(meta,cell)},"bus metaInfo+view.cards.update.complete":function(e){var meta=e.metaInfo.data;this.fireOverviewCardsReady(meta)},"bus view.skeleton.built+overview.cells.skeletons.ready":function(e){var element=e["view.skeleton.built"].data.element,cells=e["overview.cells.skeletons.ready"].data.cells;this.fire("overview.board.ready",{element:element,cells:cells})}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.requestIndicator',["jQuery","app.path","tau/components/extensions/component.extension.base"],function($,AppPath,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){this.fire("template.bind",{name:"boardplus.request.indicator",data:{imageSrc:AppPath.get()+"/JavaScript/tau/css/images/loader-yellow.gif"}})},"bus template.boardplus.request.indicator.bound+afterRender":function(evt){var $indicator=evt["template.boardplus.request.indicator.bound"].data.element;evt.afterRender.data.element.append($indicator)},"bus template.boardplus.request.indicator.bound:last+model.requestBegin":function(evt){var $indicator=evt["template.boardplus.request.indicator.bound"].data.element;$indicator.show()},"bus template.boardplus.request.indicator.bound:last+model.requestCompleted":function(evt){var $indicator=evt["template.boardplus.request.indicator.bound"].data.element;$indicator.hide()}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cards-lazy-loading',["Underscore","jQuery","tau/core/extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({resetLifecycle:!0,"bus slice.ready":function(e,evtSlice){var self=this,lazyCall=function(se){var items=se.data.result.items,reduceIterator=function(memo,cellItem){return _(cellItem.dynamic.items).each(function(item){memo.push(item.data.id)}),memo},cardIds=_(items).chain().reduce(reduceIterator,[]).uniq().value(),$q={$set:{CardsIds:cardIds}};evtSlice.lazy.cardDetails($q).done(function(r){var sItems=r.data.items,hashIds=_(sItems).reduce(function(memo,t){var id=t.data&&t.data.id;return id&&(memo[id]=t),memo},{}),rItems=_(cardIds).reduce(function(memo,i){var item=hashIds[i];return item&&memo.push(hashIds[i]),memo},[]);self.fire("lazy.cards.ready",rItems)})};evtSlice.base.on("after.cells",lazyCall),evtSlice.base.on("after.list",lazyCall)},"bus domWrapper.ready:last + lazy.cards.ready":function(e,domWrapper,cardItems){var self=this;_.each(cardItems,function(c){var $card=domWrapper.augmentCard(c);self.fire("card.is.augmented",{element:$card})})}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.progress',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus initialize + $el.ready":function(evt,initConfig,$el){$el.tauProgressIndicator(),$el.tauProgressIndicator("show")},"bus initialize + $el.ready + overview.board.ready":function(evt,initConfig,$el){$el.tauProgressIndicator("hide"),$el.tauProgressIndicator("destroy")},"bus initialize + $el.ready + no.data.in.slice":function(evt,initConfig,$el){$el.tauProgressIndicator("hide"),$el.tauProgressIndicator("destroy")},"bus initialize + $el.ready + view.dom.ready":function(evt,initConfig,$el){var $progress=$el.parent().tauProgressIndicator();this.fire("progressProcess.ready",_.bind($progress.tauProgressIndicator,$progress))},"bus progressProcess.ready:last + before_refresh":function(evt,progress){this.timeout=setTimeout(function(){progress("show")},500)},"bus progressProcess.ready:last + overview.board.ready":function(evt,progress){clearTimeout(this.timeout),progress("hide")},"bus progressProcess.ready:last + no.data.in.slice":function(evt,progress){clearTimeout(this.timeout),progress("hide")},"bus progressProcess.ready:last + destroy":function(evt,progress){progress("destroy")}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.empty.data',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus initialize + configurator.ready":function(evt,init,configurator){configurator.getTemplateFactory().register({name:"board.plus.emptyMessage",engine:"jqote2",markup:['<div class="tau-no-data-in-slice <% if (this.type != "isEmpty"){ %>tau-notconfigured<% } %> i-role-empty-message">','<div class="tau-empty-message">','<h2 class="<% if (this.type == "isEmpty"){ %>tau-no-data_empty<% } %> i-role-empty-message-text"><%! this.message %></h2>','<% if (this.type != "isEmpty"){ %>','<div class="tau-col">','<div class="tau-txt">Select the cards you want<br />to see on the board</div>','<div class="tau-step-pic tau-step1-pic"></div>',"</div>",'<div class="tau-col">','<div class="tau-txt">Set horizontal<br />and vertical lanes</div>','<div class="tau-step-pic tau-step2-pic"></div>',"</div>",'<div class="tau-col">','<div class="tau-txt">Use filters</div>','<div class="tau-step-pic tau-step3-pic"></div>',"</div>","<% } %>","</div>","</div>"]})},"bus configurator.ready:last + view.skeleton.built:last + viewPort.afterRender + no.data.in.slice":function(evt,configurator,viewData,vp,noData){noData.type=="isEmpty"?noData.message="Yikes...! Nothing in there :-|":noData.type=="notConfiguredBoard"?noData.message="Setup your board":noData.type=="notConfiguredView"&&(noData.message="Setup your view");var $message=configurator.getTemplateFactory().get("board.plus.emptyMessage").bind({},noData),$el=viewData.element,isList=$el.children().eq(0).hasClass("tau-board-composite-view"),$place=$el.find(".i-role-board-body");$el.addClass("no-data-in-slice-container"),isList||$el.children().css({opacity:1}),$place.append($message)},"bus view.skeleton.built:last + has.data.in.slice":function(evt,viewData){viewData.element.find(".i-role-empty-message").remove()},"bus operation.added":function(evt){this.fire("has.data.in.slice")}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cardsUpdater',["Underscore","jQuery","tau/core/event.emitter"],function(_,$,EventEmitter){var getCssClassByZoomLevel=function(zoomLevel){return"zoom-level-"+zoomLevel};return EventEmitter.extend({"bus view.skeleton.built":function(){this.fire("view.cards.update.complete")},"bus view.skeleton.built:last + model.zoomLevelChanged":function(evt){var $skeleton=evt["view.skeleton.built"].data.element,$board=$skeleton.children(),currentZoom=$board.data("zoomLevel"),newZoom=evt["model.zoomLevelChanged"].data.zoomLevel;currentZoom!=newZoom&&!$skeleton.hasClass("tau-board-becomes-old")&&($board.data("zoomLevel",newZoom),$board.removeClass(getCssClassByZoomLevel(currentZoom)),$board.addClass(getCssClassByZoomLevel(newZoom)))}})});
define('tau/models/board.plus/model.board.base',["Underscore","tau/core/event.emitter"],function(_,BaseModel){return BaseModel.extend({getPageMoveStrategy:function(page){return{page:page,up:function(){this.page.y--},down:function(){this.page.y++},left:function(){this.page.x--},right:function(){this.page.x++}}},getMarks:function(axisName,page,marks){return marks.slice(0,page.size[axisName])},isLastPage:function(axisName,data,pageSettings){var limit=this.getPageLimit(axisName,pageSettings);return data.length<limit},getPageLimit:function(axisName,pageSettings){return Math.floor(pageSettings.size[axisName]*1.25)+1},getSlicePagingArgs:function(axisName,pageSettings){var $take=this.getPageLimit(axisName,pageSettings);return{$take:$take,$skip:pageSettings.size[axisName]*pageSettings[axisName]}},isConfigured:function(obj){return obj?_.isString(obj)?!0:obj.id?!0:_.isArray(obj.types)?obj.types.length>0:!1:!1},getPagesCountForAxis:function(itemsCount,sizeOfPage){var count=Math.floor(itemsCount/sizeOfPage),delta=itemsCount-count*sizeOfPage;return delta>0&&sizeOfPage*.25<delta&&count++,count===0&&(count=1),count},getEmptyModelInfoArgs:function(definition){return{viewMode:"board",marksX:[],definition:definition,x:this.getAxisNullPagingObject(),y:this.getAxisNullPagingObject(),zoomLevel:definition.zoomLevel||3,marksY:[],page:{x:0,y:0}}},getAxisPagingObject:function(axisName,data,pageSettings){var self=this,isLastPage=self.isLastPage(axisName,data,pageSettings),offset=isLastPage?self.getPageLimit(axisName,pageSettings):pageSettings.size[axisName],onPageData=data.slice(0,offset),currentPage=pageSettings[axisName],isFirstPage=currentPage===0;return{isNull:!1,currentPage:currentPage,isFirst:isFirstPage,isLast:isLastPage,hasPrev:!isFirstPage,prevPage:isFirstPage?null:currentPage-1,hasNext:!isLastPage,nextPage:isLastPage?null:currentPage+1,data:onPageData,onPage:onPageData.length,maxOnPage:pageSettings.size[axisName]}},getAxisNullPagingObject:function(){return{currentPage:0,isFirst:!0,isLast:!0,hasPrev:!1,prevPage:null,hasNext:!1,nextPage:null,data:[],start:0,end:0,onPage:0,maxOnPage:0,total:0,totalPages:1}}})});
define('tau/models/board.plus/model.board.nodata',["Underscore","./model.board.base"],function(_,baseModel){return baseModel.extend({"bus model.sliceInfo.retrieved + model.cells.content.loaded + definition.ready:last":function(evt,axis){var definition=evt["definition.ready"].data,x=axis.x.data||[],y=axis.y.data||[],cards=evt["model.cells.content.loaded"].data.data.items,hasX=!axis.x.isNull,hasY=!axis.y.isNull,isEmptyBoard=axis.viewMode==="board"&&(x.length===0||hasY&&y.length===0)&&(y.length===0||x.length===0&&hasX)&&(cards.length===0||cards[0].dynamic.items.length===0),isEmptyList=axis.viewMode==="list"&&(cards.length===0||cards[0].dynamic.items.length===0),isEmpty=isEmptyBoard||isEmptyList;if(isEmpty){var type="isEmpty";!this.isConfigured(definition.cells)&&!this.isConfigured(definition.x)&&!this.isConfigured(definition.y)&&(type="notConfigured"+(isEmptyBoard?"Board":"View")),this.fire("no.data.in.slice",{type:type})}else this.fire("has.data.in.slice",{});this.fire("data.in.slice",{isEmpty:isEmpty})}})});
define('tau/models/board.plus/augmenter/board.plus.augmenter',["Underscore","tau/core/class"],function(_,Class){var baseField="id,name,entityType.name as type",tagsEffort=[baseField,"tags,effort"].join(","),isFinalState="entityState.IsFinal as isFinalState",assignments="assignedUser.Select({id,firstName,lastName,email,avatarUri}) as assignedUsers",assignedUsers=assignments,units="units",tasksInfo="tasks.Count() as allTasks,tasks.Count(entityState.IsFinal != true) as openTasks",bugsInfo="bugs.Count() as allBugs, bugs.Count(entityState.IsFinal != true) as openBugs",userStoriesInfo="userStories.Count() as userStoriesCount, userStories.Count(entityState.IsFinal != true) as openUserStoriesCount",fullName='firstName+ " " +LastName as name',login="login as login",roleName="role.Name as roleName",votes="requesters.Count() as votes",teamMembersCount="TeamMembers.Count() as teamCount",commentsCount="comments.Count() as commentsCount",allocation="CurrentAllocation",assignablesInfo="Assignables.Count(entityState.IsFinal != true) as relatedEntitiesCount",lastCommentUser="lastCommentedUser",severityName="severity.name as severityName",impedimentInfo="impediments.Count(entityState.IsFinal != true) as openImpedimentsCount",projectInfo="{Project.id, Project.name, Project.abbreviation, Project.color} as Project",teamInfo="{Team.id, Team.name, Team.icon} as Team",relationInfo="{slaveRelations.ActiveSlaveRelationsCount() as activeSlaveCount, masterRelations.ActiveMasterRelationsCount() as activeMasterCount} as relations",fieldsConfig={user:{type:"user",data:["id",'"user" as type',"modifyDate","avatarUri",fullName,login,roleName,teamMembersCount,allocation,assignablesInfo,impedimentInfo]},userstory:{type:"userstory",data:[units,tagsEffort,assignments,tasksInfo,bugsInfo,impedimentInfo,isFinalState,projectInfo,teamInfo],lazy:["id",relationInfo]},bug:{type:"bug",data:[units,tagsEffort,assignments,impedimentInfo,severityName,isFinalState,projectInfo,teamInfo],lazy:["id",relationInfo]},feature:{type:"feature",data:[units,tagsEffort,assignments,impedimentInfo,userStoriesInfo,isFinalState,projectInfo,teamInfo],lazy:["id",relationInfo]},request:{type:"request",data:[units,tagsEffort,assignments,impedimentInfo,votes,"createDate",commentsCount,lastCommentUser,isFinalState,projectInfo,teamInfo],lazy:["id",relationInfo]},task:{type:"task",data:[units,tagsEffort,assignments,impedimentInfo,isFinalState,projectInfo,teamInfo],lazy:["id",relationInfo]},impediment:{type:"impediment",data:[baseField,"{responsible.avatarUri as avatarURI,responsible.lastName,responsible.firstName,responsible.id} as responsible","createDate","priority.name as priorityName",isFinalState,projectInfo],lazy:["id",relationInfo]},testcase:{type:"testcase",data:["id","name","entityType.name AS type","tags","lastStatus","lastRunDate",projectInfo],lazy:["id",relationInfo]},project:{type:"project",data:["id","name","entityType.name AS type","color","tags","teamProjects.Count() AS teamProjectsCount","teamProjects.Select({Team.id, Team.name, Team.icon}) AS Teams"],lazy:["id",relationInfo,"{ userStories.Sparkline(16) AS userStories, bugs.Sparkline(16) AS bugs } as sparklines"]},team:{type:"team",data:["id","name","entityType.name AS type","icon","tags","teamMembers.Count() AS teamMembersCount",'teamMembers.Select({User.id, User.firstName+ " " + User.lastName as name, User.avatarUri}) AS Members'],lazy:["id",relationInfo,'{ Assignables.Where(EntityType.name == "UserStory").Sparkline(16) AS userStories, Assignables.Where(EntityType.name == "Bug").Sparkline(16) AS bugs } as sparklines']}},releaseFields=["id","name","isCurrent","EffortCompleted() as effortCompleted","EffortTotal() as effortTotal","isNext","isPrevious","startDate","endDate","units","entityType.name AS type"],axisXConfig={team:{type:"team",data:["id","name","entityType.name AS type","icon"]},release:{type:"release",data:releaseFields},project:{type:"release",data:["id","name","entityType.name AS type","color"]}},axisYConfig={team:{type:"team",data:["id","name","entityType.name AS type","icon","teamMembers.Select({User.id, User.firstName, User.lastName, User.email, User.avatarUri}) AS users"]},userstory:{type:"userstory",data:["id","name","entityType.name AS type","entityType","{entityState.name} as entityState","effort","units",assignments,projectInfo]},feature:{type:"feature",data:["id","name","entityType.name AS type","entityType","{entityState.name} as entityState","effort","units",assignments,projectInfo]},release:{type:"release",data:releaseFields},project:{type:"release",data:["id","name","entityType.name AS type","color"]}},getCardFieldsData=function(type,sections){var f=fieldsConfig[type],resItems=[];return _.each(sections,function(s){var items=f[s]||[];resItems=_.union(resItems,items)}),{type:f.type,data:"{"+_.compact(resItems).join(",")+"}"}};return _.each(axisYConfig,function(v,k){axisYConfig[k].data="{"+_.compact(v.data).join(",")+"}"}),_.each(axisXConfig,function(v,k){axisXConfig[k].data="{"+_.compact(v.data).join(",")+"}"}),Class.extend({augmentCells:function(cellsDefinition,sections){sections=sections||["data","lazy"];var types=cellsDefinition.types;return _.each(types,function(type,k){type=type.toLowerCase(),fieldsConfig.hasOwnProperty(type)&&(types[k]=getCardFieldsData(type,sections))}),cellsDefinition},augmentAxisY:function(axisDefinition){if(axisDefinition.types&&axisDefinition.types.length){var type=axisDefinition.types[0].toLowerCase();axisYConfig.hasOwnProperty(type)&&(axisDefinition.data=axisYConfig[type].data)}return axisDefinition},augmentAxisX:function(axisDefinition){if(axisDefinition.types&&axisDefinition.types.length){var type=axisDefinition.types[0].toLowerCase();axisXConfig.hasOwnProperty(type)&&(axisDefinition.data=axisXConfig[type].data)}return axisDefinition},augmentCellsLazyInfo:function(definitionBase){var def=_.deepClone(definitionBase),types=def.cells.types;return _.each(types,function(item,k){var type=item.type.toLowerCase();fieldsConfig.hasOwnProperty(type)&&(types[k]=getCardFieldsData(type,["lazy"]))}),def}})});
define('tau/models/board.plus/model.board.definition.augmenter',["Underscore","tau/core/extension.base","tau/models/board.plus/augmenter/board.plus.augmenter"],function(_,ModelBase,Augmenter){return ModelBase.extend({"bus before_slice.ready":function(evt,sliceData){var self=this,fullSlice=sliceData.slice,baseSlice=sliceData.slice.clone(),lazySlice=sliceData.slice.clone();sliceData.slice=fullSlice,sliceData.full=fullSlice,sliceData.base=baseSlice,sliceData.lazy=lazySlice,self.on("refresh",function(){baseSlice.abort(),lazySlice.abort()}),self.on("destroy",function(){baseSlice.abort(),lazySlice.abort()});var augmenter=new Augmenter,defFull=fullSlice.config.definition;defFull.cells=augmenter.augmentCells(defFull.cells),defFull.x&&(defFull.x=augmenter.augmentAxisX(defFull.x)),defFull.y&&(defFull.y=augmenter.augmentAxisY(defFull.y));var defBase=baseSlice.config.definition;defBase.cells=augmenter.augmentCells(defBase.cells,["data"]),defBase.x&&(defBase.x=augmenter.augmentAxisX(defBase.x)),defBase.y&&(defBase.y=augmenter.augmentAxisY(defBase.y));var defLazy=lazySlice.config.definition;defLazy.cells=augmenter.augmentCells(defLazy.cells,["lazy"]),defLazy.x&&(defLazy.x=augmenter.augmentAxisX(defLazy.x)),defLazy.y&&(defLazy.y=augmenter.augmentAxisY(defLazy.y))}})});
define('tau/models/board.plus/model.board.plus.refresher',["Underscore","tau/core/extension.base"],function(_,BaseExtension){return BaseExtension.extend({"bus boardSettings.ready:last + refresh":function(evt,bs){this.fire("boardSettings.ready",bs)},"bus configurator.ready + overview.board.ready":function(evt,configurator){var acidStore=configurator.getAppStateStore();acidStore.unbind({listener:this}),acidStore.bind({fields:["acid"],listener:this,callback:_.bind(function(){_.delay(_.bind(this.fire,this,"refresh"),100)},this)})},"bus configurator.ready > destroy":function(evt,configurator){var acidStore=configurator.getAppStateStore();acidStore.unbind({listener:this})},"bus boardSettings.ready + overview.board.ready":function(evt,bs){var boardSettings=bs.boardSettings;boardSettings.unbind({listener:this}),boardSettings.bind({fields:["x","y","cells","focus","user"],listener:this,callback:_.bind(function(){this.fire("refresh")},this)})},"bus boardSettings.ready + no.data.in.slice":function(evt,bs){var boardSettings=bs.boardSettings;boardSettings.unbind({listener:this}),boardSettings.bind({fields:["x","y","cells","focus","user"],listener:this,callback:_.bind(function(){this.fire("refresh")},this)})},"bus boardSettings.ready > destroy":function(evt,bs){var boardSettings=bs.boardSettings;boardSettings.unbind({listener:this})}})});
define('tau/models/board.plus/model.board.zoomLevel',["Underscore","tau/core/model-base"],function(_,BaseModel){var ZoomLevelModel=BaseModel.extend({"bus boardSettings.ready":function(evt){var self=this,boardSettings=evt.data.boardSettings;boardSettings.unbind({listener:this}),boardSettings.bind({fields:["zoomLevel"],listener:self,callback:_.bind(self.onZoomLevelUpdated,self)}),boardSettings.get({fields:["zoomLevel"],callback:function(r){self.onDataReady(r)}})},onDataReady:function(r){var self=this,data={zoomLevel:r.zoomLevel};self.fire("zoomLevelReady",data),this.config.bindData&&self.fire("dataBind",data),!this.validateZoomLevel(r.zoomLevel)&&this.normalizeZoomLevel(r.zoomLevel)&&this.fire("updateZoomLevel",{zoomLevel:this.normalizeZoomLevel(r.zoomLevel)})},validateZoomLevel:function(zoomLevel){return this.config.hasOwnProperty("min")&&zoomLevel<this.config.min?!1:this.config.hasOwnProperty("max")&&zoomLevel>this.config.max?!1:zoomLevel!=undefined},normalizeZoomLevel:function(zoomLevel){if(this.config.hasOwnProperty("min")&&this.config.hasOwnProperty("max")){if(zoomLevel==undefined)return this.config.defaultValue;if(zoomLevel<this.config.min)return this.config.min;if(zoomLevel>this.config.max)return this.config.max}return zoomLevel},onZoomLevelUpdated:function(r){var self=this;if(!this.validateZoomLevel(r.zoomLevel))return;self.bus.fire("zoomLevelUpdated",r)},"bus boardSettings.ready+destroy":function(evt){var self=this;self.onDataReady=function(){};var boardSettings=evt["boardSettings.ready"].data.boardSettings;boardSettings.unbind({listener:this})}});return ZoomLevelModel});
define('tau/models/board.plus/model.board.slice.metaInfo',["Underscore","tau/core/event.emitter"],function(_,Model){return Model.extend({"bus model.cells.content.loaded":function(evt){var metaInfo=evt.data.data.metaInfo||{},self=this;self.fire("model.cells.metaInfo.ready",metaInfo)}})});
define('tau/models/board.plus/model.filter.suggestions.preloading',["Underscore","./model.board.base","tau/models/board.editor/board.filter.suggestionManager"],function(_,baseModel,SuggestionsManager){return baseModel.extend({"bus configurator.ready":function(evt,configurator){var suggestionManager=new SuggestionsManager(configurator);this.fire("suggestionManager.ready",suggestionManager)},_preload:function(types,prefix,service){var resourceTypes=[];_.isArray(types)||(types=[types]);if(types.indexOf("effort")>=0||types.indexOf("source")>=0)return;_.each(types,function(type){_.isString(type)?resourceTypes.push(type):resourceTypes.push(type.type)}),prefix=prefix||"";var preloads=["?"];prefix.length>1&&prefix[0]==="?"&&preloads.push(prefix.trim()+" ");if(resourceTypes.length===0)return;_.each(preloads,function(s){service.get({query:{resourceTypes:resourceTypes,script:s}})})},"bus board.definition.ready + suggestionManager.ready:last + overview.board.ready:last":function(evt,definition,suggestionManager){var f=_.bind(function(){definition.x&&this._preload(definition.x.types,definition.x.filter,suggestionManager),definition.y&&this._preload(definition.y.types,definition.y.filter,suggestionManager),definition.cells&&(this._preload(definition.cells.types,definition.cells.filter,suggestionManager),definition.user&&this._preload(definition.cells.types,definition.user.cardFilter,suggestionManager))},this,definition);_.delay(f,100)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cells.paging',["Underscore","jQuery","tau/core/event.emitter","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/nls/translator"],function(_,$,EventEmitter,ProgressIndicator,T){var PAGE_SIZE_MAP={0:[100,100,100],1:[100,50,25],2:[50,25,25]},GET_PAGE_SIZE=function(amountOfAxes,zoomLevel){var index=0;return zoomLevel>1&&zoomLevel<5?index=1:zoomLevel>=5&&(index=2),PAGE_SIZE_MAP[amountOfAxes][index]},GET_MAX_PAGE_SIZE=function(){return PAGE_SIZE_MAP[0][0]},CellPagingManager=function($cell){var $cellHolder=$cell.parent(),$moreEx=$cellHolder.children(".i-role-cell-paging-more"),alreadyBuiltIn=$moreEx.size()>0;return{isEnabled:function(){return alreadyBuiltIn},disable:function(){alreadyBuiltIn&&$moreEx.css("visibility","hidden"),$cellHolder.find(".i-role-cell-paging-stack").css("visibility","hidden")},enable:function(data){var $more=alreadyBuiltIn?$moreEx:$('<div class="i-role-cell-paging-more tau-cell-paging-more"><div class="i-role-cell-paging-more-link tau-cell-paging-more-link">'+T("show more&hellip;")+"</div></div>");$more.data(data),!alreadyBuiltIn&&$more.appendTo($cellHolder);var $stack=$cellHolder.find(".i-role-cell-paging-stack");if($stack.size()===0){var $moreStack=$('<div class="i-role-tau-always-last i-role-cell-paging-stack tau-cell-paging-stack"><div class="tau-stack-text">'+T("show more&hellip;")+"</div></div>");$moreStack.appendTo($(".i-role-cell",$cellHolder))}else $stack.css("visibility","visible");$more.css("visibility","visible")},remove:function(){alreadyBuiltIn&&$moreEx.remove(),$cellHolder.find(".i-role-cell-paging-stack").remove()}}},isAxisExist=function(r,axisName){var a=r[axisName];return a&&a.types&&a.types.length>0};return EventEmitter.extend({lifeCycleCleanUp:function(e){this.resetSubscriptions()},fireModelGetCellBasicInfo:function(coords){var self=this,args={from:coords.from,to:coords.to};coords.hasOwnProperty("x")&&(args.x=coords.x===null?"null":coords.x),coords.hasOwnProperty("y")&&(args.y=coords.y===null?"null":coords.y),self.fire("model.get.cell.basicInfo",args)},"bus boardSettings.ready":function(e){var self=this,bs=e.data.boardSettings;bs.get({fields:["x","y","zoomLevel","viewMode","collapse"],callback:function(r){var amountOfAxes=0;r.viewMode!=="list"&&(isAxisExist(r,"x")&&++amountOfAxes,isAxisExist(r,"y")&&++amountOfAxes);var zoomLevel=r.zoomLevel,collapse=r.collapse||{x:[],y:[]},size=GET_PAGE_SIZE(amountOfAxes,zoomLevel);self.fire("cell.paging.settings",{amountOfAxes:amountOfAxes,zoomLevel:zoomLevel,pageSize:size,maxPageSize:GET_MAX_PAGE_SIZE(),collapse:collapse,getPageSize:function(coords){var result=this.pageSize;if(-1!==_(this.collapse.x).indexOf(coords.x)||-1!==_(this.collapse.y).indexOf(coords.y))result=this.maxPageSize;return result}})}})},"bus overview.cells.skeletons.ready:last > view.cell.skeleton.updated":function(evt,dataCells,sceleton){this._moveAlwaysVisibleToEnd(sceleton.element)},"bus view.card.batch.move.$successCards":function(evt,data){if(data.length>0)var cell=data[0].parent()},"bus overview.board.ready + cell.paging.settings":function(e,$0,settings){settings.pageSize=GET_MAX_PAGE_SIZE(),this.fire("cell.paging.settings",settings)},"bus overview.cells.skeletons.ready:last+cell.paging.settings:last+cell.paging.byFilter":function(e,overview,paging,pagingFilter){var self=this;self.triggerPagingOnCells(pagingFilter.filter,overview.cells,paging)},triggerPagingOnCells:function(filterDelegate,overviewCells,pagingSettings){var self=this,$gridCells=_(overviewCells).filter(function(c){var $cell=c.element,cd=$cell.data();return cd.hasOwnProperty("x")&&cd.hasOwnProperty("y")&&filterDelegate(cd)});_($gridCells).each(function(c){var $cell=c.element,cd=$cell.data(),newPageSize=pagingSettings.getPageSize({x:cd.x,y:cd.y}),cardsCount=$cell.find(".i-role-card").size(),cellPM=CellPagingManager($cell),hasMore=cellPM.isEnabled();if(hasMore&&cardsCount<newPageSize){var coords={x:cd.x,y:cd.y,from:cardsCount,to:newPageSize};cellPM.disable(),self.fireModelGetCellBasicInfo(coords)}})},"bus cell.paging.settings:last+view.cellSlot.built":function(e,settings,cellCoordinates){var coords=cellCoordinates.data;coords.from=0,coords.to=settings.getPageSize(coords)-1,this.fireModelGetCellBasicInfo(coords)},"bus view.cell.skeleton.built":function(evt){var evtData=evt.data,dataItem=evtData.data,$cell=evtData.element,fixedPlugins=_(dataItem.fixed.items).find(function(item){var itemType=item.type||"";return itemType.toLowerCase()==="cellpaging"}),cellPM=CellPagingManager($cell);fixedPlugins?cellPM.enable(fixedPlugins.data):cellPM.remove()},"bus cell.paging.settings:last + view.skeleton.built":function(evt,settings,skeleton){var self=this,$el=skeleton.element,processPagingInCell=function($cell){self.fire("paging.cell.show.more",{});var cdata=$cell.data(),actualCardsCount=$cell.children(".i-role-card").size();CellPagingManager($cell).disable(),ProgressIndicator.get($cell).show(),$cell.parent().css("opacity",.5),self.fireModelGetCellBasicInfo({x:cdata.x,y:cdata.y,from:actualCardsCount,to:actualCardsCount+(settings.getPageSize(cdata)-1)})},processShowMoreClick=function(e){var $morePanel=$(this).parent(".i-role-cell-paging-more"),$cell=$morePanel.siblings(".i-role-cell");processPagingInCell($cell)},processStackClick=function(e){var $cell=$(this).parent(".i-role-cell");processPagingInCell($cell)};$el.delegate(".i-role-cell-paging-more-link","click",processShowMoreClick),$el.delegate(".i-role-cell-paging-stack","click",processStackClick)},"bus overview.board.ready:last > view.cell.skeleton.built":function(evt,overview,cell){ProgressIndicator.get(cell.element).hide(),cell.element.parent().css("opacity",1),this.fire("view.cell.skeleton.updated",cell)},"bus overview.board.ready:last > view.cell.skeleton.element.beforeUpdate":function(e,$0,update){update.content.css("opacity",.15)},"bus scrollManager.ready:last > overview.board.ready:last > view.cell.skeleton.element.afterUpdate":function(e,scrollManager,overview,update){var $cellContent=update.content;$cellContent.size()>0&&scrollManager.scrollToVisibility($cellContent.last(),{axis:"y",duration:1e3,easing:"easeInSine",offset:{top:20},onAfter:function(){$cellContent.animate({opacity:1},"slow","easeOutBounce")}})},_moveAlwaysVisibleToEnd:function(cell){var stack=$(".i-role-tau-always-last",cell).detach();cell.append(stack)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.external.api',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({"bus slice.ready:last + external.api.get.slice":function(evt,slice){this.fire("external.api.slice.ready",slice)}})});
define('tau/ui/extensions/board.plus/ui.board.plus.domWrapper',["Underscore","jQuery","tau/core/class","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/core/templates-factory","tau/nls/translator"],function(_,$,Class,BoardPlusUtils,TemplatesFactory,T){var animateWithClass=function($el,className){var $defer=$.Deferred();$el.removeClass(className).addClass(className);var timeout=parseFloat($el.css("MozAnimationDuration")||$el.css("WebkitAnimationDuration")||1)*parseFloat($el.css("MozAnimationIterationCount")||$el.css("WebkitAnimationIterationCount")||1)*1e3;return _.delay(_.bind(function($d){this.removeClass(className),$d&&$d.resolve()},$el,$defer),timeout),$defer},compareOrderings=function(o1,o2){var f1=parseFloat(o1),f2=parseFloat(o2);return f1-f2},getCellPagingMore=function($cell){return $cell.siblings(".i-role-cell-paging-more")},executeAxisLineUpdate=function($queueToUpd,options){var d=$.Deferred(),animationClass=options.suspendAnimation?"":"tau-operation_axis_updated",updLen=$queueToUpd.length;for(var u=0;u<updLen;u++){var updateItem=$queueToUpd[u],$old=updateItem.$cardEx,$new=updateItem.$cardNV;$old.replaceWith($new),animateWithClass($new,animationClass)}return d.resolve(),d},executeAxisLineRemove=function($axisCells,$linesCells,options){var d=$.Deferred();if($axisCells.size()!==0){var $inners=$axisCells.find("*");$inners.each(function(e){var $e=$(this);$e.removeProp("checked"),$e.prop("disabled",!0);var roles=$e.attr("class")||"",x=roles.replace(/i-role-/ig,"i-disabled-role-");$e.attr("class",x)}),getCellPagingMore($linesCells).remove(),$linesCells.find(".i-role-card").remove();var $all=$axisCells.add($linesCells);$all.each(function(){var $e=$(this),cellCssSelected=$e.attr("class")||"";cellCssSelected=cellCssSelected.replace(/i-role-(?!cell\b)/ig,"tau-disabled-role-"),$e.attr("class",cellCssSelected),$e.addClass("tau-cellaxis__removed").css("opacity",.3);var $holder=$e.parent(".i-role-cellholder"),selections=$holder.attr("class")||"",x=selections.replace(/i-role-(?!cellholder\b)/ig,"tau-disabled-role-").replace(/tau-selected/ig,"tau-disabled-selected");$holder.attr("class",x)})}return d.resolve(),d},insert$cardTo$cell=function($card,$cell,forceAppend){var cardOrdering=$card.data("orderingValue"),$more=getCellPagingMore($cell);if($more.size()>0){var maxAvailableOrdering=$more.data("nextOrderingValue");if(compareOrderings(cardOrdering,maxAvailableOrdering)>0)return forceAppend?($card.appendTo($more),$card):null}var $predecessor=findPriorityPredecessor(cardOrdering,$cell);return $predecessor.before($card),$card},executeRemove=function($selection,options){var d=$.Deferred(),animationClass=options.suspendAnimation?"":"tau-operation_card_deleted";return $selection.size()===0?d.resolve():($selection.removeClass("i-role-card"),animateWithClass($selection,animationClass).done(function(){$selection.remove(),d.resolve()})),d},executeClear=function($selection,options){var d=$.Deferred();return $selection.remove(),d.resolve(),d},executeUpdate=function($queueToUpd,options){var d=$.Deferred(),animationClass=options.suspendAnimation?"":"tau-operation_card_updated",$affectedCards=[],updLen=$queueToUpd.length;for(var u=0;u<updLen;u++){var updateItem=$queueToUpd[u],$old=updateItem.$cardEx,$new=updateItem.$cardNV;$old.replaceWith($new),$affectedCards.push($new),animateWithClass($new,animationClass)}return d.resolve($affectedCards),d},executeAppend=function($queueToAdd,options){var d=$.Deferred(),animationClass=options.suspendAnimation?"":"tau-operation_card_added",$affectedCards=[],addLen=$queueToAdd.length;for(var a=0;a<addLen;a++){var addItem=$queueToAdd[a],$card=addItem.$card,$insertedCard=insert$cardTo$cell($card,addItem.$cell,options.forceAppend);$insertedCard&&$affectedCards.push($insertedCard),animateWithClass($card,animationClass)}return d.resolve($affectedCards),d},findPriorityPredecessor=function(cardOrdering,$cell){var $predecessor={before:function($c){$cell.append($c)}},$cellCards=$cell.find(".i-role-card"),size=$cellCards.size(),c=null,i=size;while(--i>=0&&(c=$cellCards.eq(i))&&compareOrderings(cardOrdering,c.data("orderingValue"))<0&&($predecessor=c));return $predecessor},replaceCardsFastMethod=function($cell,$oldCardsSelection,newCards){var method,$prev=$oldCardsSelection.first().prev();if($prev.size()>0)method=function(){$prev.after(newCards)};else{var $next=$oldCardsSelection.last().next();$next.size()>0?method=function(){$next.before(newCards)}:method=function(){$cell.append(newCards)}}$oldCardsSelection.remove(),method()},DomWrapper=Class.extend({init:function($el,configurator){this.board=$el,this.urlBuilder=configurator.getUrlBuilder(),this.templateFactory=configurator.getTemplateFactory()},decorate:function(boardDecorator,decoratorSettings){return boardDecorator(this,decoratorSettings),this},createQuickAddPanel:function(){var $quickAddPanel=$('<div class="tau-quick-add"><button class="tau-btn tau-btn-big tau-add tau-success"></button></div>');return $quickAddPanel},compareOrderings:compareOrderings,animateWithClass:animateWithClass,isListMode:function(){var $b=this.board,isListMode=$b.children(".i-role-board-body").hasClass("tau-board-composite-view");return isListMode},augmentCard:function(cardData,$target){$target=$target?$target:this.board;var sliceCardId=cardData.id,augmentData=cardData.data,$cards=this.getCardBySliceIdInTarget(sliceCardId,$target);return $cards.each(function(){var $card=$(this);_.each(augmentData,function(v,k){var selector=".i-role-card-content-"+k,$field=$card.find(selector);if($field.size()){var templateName="boardplus.card."+k,template=TemplatesFactory.get(templateName),d={};d[k]=v;var $fieldUpdate=template.bind({},d);$field.replaceWith($fieldUpdate)}})}),$cards},getCardBySliceId:function(cardIdB64){return this.getCardBySliceIdInTarget(cardIdB64,this.board)},getCardBySliceIdInTarget:function(cardIdB64,$targetCardHolder){return $targetCardHolder.find(".i-role-card[data-id="+cardIdB64+"]")},getCellHoldersBySliceCoordinatesInTarget:function(coordinates,$targetCardHolder){var attributesSelectors=_(coordinates).map(function(val,key){return"[data-"+key+"="+val+"]"});return $targetCardHolder.find(".i-role-cellholder"+attributesSelectors.join(""))},getCellHoldersAxisLineBySliceCoordinates:function(coordinates){return this.getCellHoldersBySliceCoordinatesInTarget(coordinates,this.board)},getCellsBySliceCoordinatesInTarget:function(coordinates,$targetCardHolder){var attributesSelectors=_(coordinates).map(function(val,key){return"[data-"+key+"="+val+"]"});return $targetCardHolder.find(".i-role-cell"+attributesSelectors.join(""))},getCellsAxisLineBySliceCoordinates:function(coordinates){return this.getCellsBySliceCoordinatesInTarget(coordinates,this.board)},getAxesHeaders:function(dimension){var $headers;return arguments.length===0?$headers=this.board.find(".i-role-header"):$headers=this.board.find(".i-role-header[data-dimension="+dimension+"]"),$headers},appendCount:function($header,title,counts){var $countElement=$('<div class="tau-axiscell__item tau-cards-count" title="'+title+'"><span>'+counts+"</span></div>");return $header.append($countElement),$countElement},updateAxisCellMetaInfo:function($axisCell,countObj,$cellsAxisLine){var $counter=$axisCell.children(".tau-cards-count"),cellHolder=$cellsAxisLine.closest(".i-role-cellholder"),limit=countObj.limit,counts=countObj.count,title=countObj.title,dimension=countObj.dimension,classLimit="";limit==counts&&(classLimit="tau-axis-limit_warning_"+dimension),limit<counts&&(classLimit="tau-axis-limit_overhead_"+dimension),limit===""&&(classLimit="tau-axis-limit_"+dimension),cellHolder.removeClass("tau-axis-limit_"+dimension+" tau-axis-limit_warning_"+dimension+" tau-axis-limit_overhead_"+dimension),cellHolder.addClass(classLimit);var limitText="";return limit!==""&&(limitText=" of "+limit),$counter.size()===0?($counter=$('<div class="tau-axiscell__item tau-cards-count" title="'+title+'"><span>'+counts+limitText+"</span></div>"),$axisCell.append($counter)):($counter.html("<span>"+counts+limitText+"</span>"),$counter.attr("title",title)),$counter},updateAxesMetaInfo:function(items,limits){var self=this,getCountForCoordinate=function(c){var item=_.find(items,function(i){return i.x==c.x&&i.y==c.y}),limit=_.reduce(limits,function(memo,item){var x=parseInt(item[c.x],10),y=parseInt(item[c.y],10);return memo="",_.isNumber(x)&&!_.isNaN(x)?memo=x:_.isNumber(y)&&!_.isNaN(y)&&(memo=y),memo},""),defObj={count:0,title:"",limit:limit,dimension:c.x&&"x"||c.y&&"y"},obj=item?_.reduce(item.counts,function(m,ic){m.count+=ic.count;var prefix=m.title?" / ":"";return m.title+=prefix+ic.type+": "+ic.count,m},defObj):defObj;return obj};self.getAxesHeaders().find(".i-role-cell").each(function(){var $axisCell=$(this),coords=$axisCell.data(),countObj=getCountForCoordinate(coords),$cellsAxisLine=self.getCellsAxisLineBySliceCoordinates(coords),$counter=self.updateAxisCellMetaInfo($axisCell,countObj,$cellsAxisLine);countObj.count>0||countObj.limit!==""?$counter.show():$counter.hide()})},getCardByPositionOrLast:function(position){var $cards=this.board.find(".i-role-card");return position<$cards.size()?$cards.eq(position):$cards.last()},getGrid:function(){return this.board.find(".i-role-grid")},getCards:function(){return this.getGrid().find(".i-role-card")},hasDataItemInCoordinates:function(itemData,coords){var $cellHolder=this.getCellHolderByCoordinates(coords),$card=this.getCardBySliceIdInTarget(itemData.id,$cellHolder);return $card.size()!==0},applyCellPagingUpdate:function(args){var self=this,$appendedCards=self.getAppendedCardsForCell(args.$cell),$queueToRemove=$(),len=$appendedCards.size();for(var i=0;i<len;i++){var $el=$appendedCards.eq(i),b64Id=$el.data("id"),match=args.$cards.is(".i-role-card[data-id="+b64Id+"]");match&&($queueToRemove=$queueToRemove.add($el))}$queueToRemove.remove()},getAppendedCardsForCell:function($cell){var $appendedCards=getCellPagingMore($cell).find(".i-role-card");return $appendedCards},getAxisCellByCoordinate:function(coords){var $b=this.board,$cell=$();try{$cell=$b.find("#"+BoardPlusUtils.generateId(coords))}catch(e){}return $cell},getCellByCoordinate:function(coords){var $b=this.board,isListMode=this.isListMode(),cloneOfCoordinates=isListMode?{x:"null",y:"null"}:_.clone(coords);cloneOfCoordinates.x=cloneOfCoordinates.x||"null",cloneOfCoordinates.y=cloneOfCoordinates.y||"null";var $cell=$();try{$cell=$b.find("#"+BoardPlusUtils.generateId(cloneOfCoordinates))}catch(e){}return $cell},getCellHolderByCoordinates:function(coordinates){var $cell=this.getCellByCoordinate(coordinates);return $cell.parent()},expandAxis:function(coords){var dimension=coords.x?"x":"y",$cells=this.getCellHoldersAxisLineBySliceCoordinates(coords);$cells.removeClass("tau-collapsed_"+dimension),$cells.each(function(){var $cell=$(this);!$cell.hasClass("tau-collapsed_x")&&!$cell.hasClass("tau-collapsed_y")&&$cell.removeClass("tau-collapsed")})},collapseAxis:function(coords){var dimension=coords.x?"x":"y",$cells=this.getCellHoldersAxisLineBySliceCoordinates(coords);$cells.addClass("tau-collapsed_"+dimension),$cells.addClass("tau-collapsed")},expandCell:function(board,x,y){board.fire("view.axis.collapser.executed.before"),x&&this.expandAxis({x:x}),y&&this.expandAxis({y:y}),board.fire("view.axis.collapser.executed.after");var action="expand",eventName="board.save.header.collapsing.settings";x&&board.fire(eventName,{id:x,dimension:"x",setting:action}),y&&board.fire(eventName,{id:y,dimension:"y",setting:action})},drawCard:function(cardData){var template=this.templateFactory.get("boardplus.card.skeleton"),d=cardData.data;return d.entityRef=this.urlBuilder.getNewViewUrl(_.asString(d.id),_.asString(d.type),!0),template.bindPure({},cardData)},create$card:function(cardData){var template=this.templateFactory.get("boardplus.card.skeleton"),d=cardData.data;d.entityRef=this.urlBuilder.getNewViewUrl(_.asString(d.id),_.asString(d.type),!0);var $card=template.bind({},cardData);return $card},$createAxisMark:function(axisMarkData){var template=TemplatesFactory.get("boardplus.cell.axis.item"),converted=BoardPlusUtils.convertCellAxisData({dynamic:{items:[axisMarkData]}});converted.dynamic=!0;var $axisMark=template.bind({},converted);return $axisMark},applyCardsBatchAdd:function(args){var self=this;args=_.defaults(args,{callback:$.noop,options:{forceAppend:!1},items:[]});var options=args.options,dataItems=args.items,callback=args.callback,$affectedCells=[],affectedDataItemsUnique={},$queueToAdd=[];for(var i=0,len=dataItems.length;i<len;i++){var item=dataItems[i],coordinates={x:item.x,y:item.y};if(self.hasDataItemInCoordinates(item.data,coordinates))continue;var d=item.data.data;affectedDataItemsUnique[d.id+d.type]=d;var $cell=self.getCellByCoordinate(coordinates);$cell.size()&&$affectedCells.push($cell);var $card=self.create$card(item.data);$queueToAdd.push({$card:$card,$cell:$cell})}var $defer=executeAppend($queueToAdd,options);$.when($defer).then(function(rAdd){callback({$affectedCells:$affectedCells,cards:rAdd,affectedDataItems:_(affectedDataItemsUnique).values()})})},applyCardsBatchRemove:function(args){args=_.defaults(args,{callback:$.noop,options:{},items:[]});var options=args.options,dataItems=args.items,callback=args.callback,affectedDataItemsUnique={},$affectedCells=[],len=dataItems.length,$targetCards=$();for(var i=0;i<len;i++){var item=dataItems[i],d=item.data.data;affectedDataItemsUnique[d.id+d.type]=d;var $cards=this.getCardBySliceId(item.data.id);$targetCards=$targetCards.add($cards)}$targetCards.each(function(i,card){var $cell=$(card).parent(".i-role-cell");$cell.size()&&$affectedCells.push($cell)});var $del=executeRemove($targetCards,options);$.when($del).then(function(){callback({$affectedCells:$affectedCells,affectedDataItems:_(affectedDataItemsUnique).values()})})},applyCardsBatchUpdate:function(args){var self=this;args=_.defaults(args,{callback:$.noop,options:{forceAppend:!1},items:[]});var options=args.options,dataItems=args.items,callback=args.callback,$queueToDel=$(),$queueToUpd=[],$queueToAdd=[],affectedDataItemsUnique={},$updatedCards=[],targetCardId,setupIterationPrerequisites=function(id,iteration){if(iteration===0)targetCardId=id,$queueToDel=self.getCardBySliceId(targetCardId);else if(targetCardId!==id){var msg="DEBUG INFO: Multiply IDs in batch update are not supported";throw console.log(msg),msg}},len=dataItems.length,isListMode=self.isListMode();isListMode&&len>1&&(len=1);var $affectedCells=[];for(var i=0;i<len;i++){var d=dataItems[i];setupIterationPrerequisites(d.data.id,i);var di=d.data.data;affectedDataItemsUnique[di.id+di.type]=di;var cellCoords={x:d.x,y:d.y},$cell=self.getCellByCoordinate(cellCoords);$cell.size()&&$affectedCells.push($cell);var $cellHolder=self.getCellHolderByCoordinates(cellCoords),$cardEx=self.getCardBySliceIdInTarget(targetCardId,$cellHolder),$cardNV=self.create$card(d.data),widget="tauselectable";$cardNV.data(widget,$.extend({},$cardEx.data(widget)));var newOrdering=0,extOrdering=0,hasOrdering=d.data.hasOwnProperty("orderingValue");hasOrdering&&(newOrdering=d.data.orderingValue,extOrdering=$cardEx.data("orderingValue")),$cardEx.size()>0&&self.compareOrderings(extOrdering,newOrdering)===0?($queueToDel=$queueToDel.not($cardEx),$queueToUpd.push({$cardNV:$cardNV,$cardEx:$cardEx})):$queueToAdd.push({$card:$cardNV,$cell:$cell}),$updatedCards.push($cardNV)}var $del=executeClear($queueToDel,options),$upd=executeUpdate($queueToUpd,options),$add=executeAppend($queueToAdd,options);$.when($del,$upd,$add).then(function(rDel,rUpd,rAdd){callback({$affectedCells:$affectedCells,cards:_.union(rUpd,rAdd),affectedDataItems:_(affectedDataItemsUnique).values()})})},applyAxisBatchAdd:function(args){args=_.defaults(args,{callback:$.noop,options:{force:!1},items:[]});var dataItems=args.items,callback=args.callback,affectedCells=[],affectedDataItemsUnique={},len=dataItems.length;for(var i=0;i<len;i++){var item=dataItems[i],d=item.data.data;affectedDataItemsUnique[d.id+d.type]=d;var $el=$("<div/>");$el.data(item.data),affectedCells.push($el)}callback({$affectedCells:affectedCells,affectedDataItems:_(affectedDataItemsUnique).values()})},applyAxisBatchUpdate:function(args){var self=this;args=_.defaults(args,{callback:$.noop,options:{forceAppend:!1},items:[]});var options=args.options,dataItems=args.items,callback=args.callback,$queueToUpd=[],affectedDataItemsUnique={},$updatedCards=[],targetCardId,setupIterationPrerequisites=function(id,iteration){if(iteration===0)targetCardId=id;else if(targetCardId!==id){var msg="DEBUG INFO: Multiply IDs in batch update are not supported";throw console.log(msg),msg}},len=dataItems.length,isListMode=self.isListMode();isListMode&&(len=0);var $affectedCells=[];for(var i=0;i<len;i++){var d=dataItems[i];setupIterationPrerequisites(d.data.id,i);var di=d.data.data;affectedDataItemsUnique[di.id+di.type]=di;var axisName=d.location.toLowerCase().charAt(0),coordinates={};coordinates[axisName]=d[axisName];var $axisMarkCell=self.getAxisCellByCoordinate(coordinates);$affectedCells.push($axisMarkCell);var $cardEx=$axisMarkCell.find(".i-role-axis-item"),$cardNV=self.$createAxisMark(d.data);$queueToUpd.push({$cardNV:$cardNV,$cardEx:$cardEx}),$updatedCards.push($cardNV)}var $upd=executeAxisLineUpdate($queueToUpd,options);$.when($upd).then(function(){callback({$affectedCells:$affectedCells,cards:$updatedCards,affectedDataItems:_(affectedDataItemsUnique).values()})})},applyAxisBatchRemove:function(args){args=_.defaults(args,{callback:$.noop,options:{},items:[]});var options=args.options,dataItems=args.items,callback=args.callback,affectedDataItemsUnique={},$affectedCells=[],len=dataItems.length,$targetCells=$(),$axisTargetCells=$();for(var i=0;i<len;i++){var item=dataItems[i],d=item.data.data;affectedDataItemsUnique[d.id+d.type]=d;var axisName=item.location.toLowerCase().charAt(0),coordinates={};coordinates[axisName]=item.data.id;var $cells=this.getCellsBySliceCoordinatesInTarget(coordinates,this.getGrid());$targetCells=$targetCells.add($cells);var $axisCell=this.getAxisCellByCoordinate(coordinates);$axisTargetCells=$axisTargetCells.add($axisCell)}$targetCells.each(function(i,cell){var $cell=$(cell);$affectedCells.push($cell)});var $del=executeAxisLineRemove($axisTargetCells,$targetCells,options);$.when($del).then(function(){callback({$affectedCells:$affectedCells,affectedDataItems:_(affectedDataItemsUnique).values()})})},highlightAxesLines:function(dataItems){var me=this,$targetAxesCells=$(),$targetToHighlight=$();for(var i=0,len=dataItems.length;i<len;i++){var item=dataItems[i],coordinates={};coordinates[item.location.charAt(0).toLowerCase()]=item.data.id;var $axisCell=me.getAxisCellByCoordinate(coordinates);if($axisCell.size()===1){$targetAxesCells=$targetAxesCells.add($axisCell);var $cellHolders=me.getCellHoldersAxisLineBySliceCoordinates(coordinates);$targetToHighlight=$targetToHighlight.add($cellHolders)}}$targetAxesCells.size()>0&&$.scrollTo($targetAxesCells.eq(0),{onAfter:function(){me.animateWithClass($targetToHighlight,"tau-axis_highlighted")}})},applyCardsBatchMove:function(args){var rdef=$.Deferred(),self=this;if(!args.targetCellCoordinates)throw new Error("Target cell coordinates are not provided for move operation");args=_.defaults(args,{options:{forceAppend:!1},items:[]});var tcc=args.targetCellCoordinates,options=args.options,targetItems=[],sideEffectItems=[];_.each(args.items,function(arr,i){arr.length===1&&arr[0].x==tcc.x&&arr[0].y==tcc.y?targetItems.push(arr[0]):sideEffectItems.push(arr)});var dataItems=_.sortBy(targetItems,function(t){return t.data.orderingValue||0}),$targetCells=[],cardDomIds=[],resultCards=[],cardsBatchHTML="",$oldSelection=$(),customData={},widget="tauselectable";_.each(dataItems,function(d){cardsBatchHTML+=self.drawCard(d.data);var domId=BoardPlusUtils.getLatestCardId(d.data.data.id);cardDomIds.push(domId),d.domId=domId;var $cardEx=self.getCardBySliceId(d.data.id);$cardEx.size()&&($oldSelection=$oldSelection.add($cardEx),customData[domId]=$.extend({},$cardEx.data(widget)))});if(dataItems.length){var cellCoordinates=_.pick(dataItems[0],"x","y"),$cell=self.getCellByCoordinate(cellCoordinates);$cell.size()&&($targetCells=[$cell],replaceCardsFastMethod($cell,$oldSelection,cardsBatchHTML))}_.each(cardDomIds,function(domId){var node=BoardPlusUtils.getDomNodeByIdFast($targetCells[0],domId),$node=$(node);if(!node){var data=_.find(dataItems,function(d){return d.domId===domId});$node=self.create$card(data)}$node.data(widget,customData[domId]),resultCards.push($node)});var deferreds=[];return _(sideEffectItems.length).times(function(){deferreds.push($.Deferred())}),$.when.apply($,deferreds).then(function(){var ri=[].splice.call(arguments,0),$affectedCells=$targetCells,cards=resultCards;_(ri).each(function(r){$affectedCells=$affectedCells.concat(r.$affectedCells),cards=cards.concat(r.cards)});var animationClass=options.suspendAnimation?"":"tau-operation_card_updated";_.each(cards,function($c){animateWithClass($c,animationClass)}),rdef.resolve({$affectedCells:$affectedCells,cards:cards})}),_.forEach(sideEffectItems,function(arr,i){self.applyCardsBatchUpdate({items:arr,callback:deferreds[i].resolve})}),rdef},getUnsortedCardsHolder:function($cell){var $c=$cell.next(".i-role-cell-paging-more");return $c},createUnsortedCardsHolder:function(){var $c=$(['<div class="i-role-cell-paging-more tau-cell-paging-more">','<div class="i-role-cell-paging-more-link tau-cell-paging-more-link">',T("show more&hellip;"),"</div>","</div>"].join(""));return $c}});return DomWrapper.fly=function($el){return new DomWrapper($el)},DomWrapper});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.operations.strategies',["Underscore","jQuery","tau/core/class"],function(_,$,Class){var _getLocation=function(operationArgs){return(operationArgs.items[0].location||"card").toLowerCase()},_findMaxOrderingValue=function(items){var nonEmptyItem=_.find(items,function(item){return!item.dynamic.items[0].data.empty}),maxOrderingValue=0;return nonEmptyItem&&(maxOrderingValue=nonEmptyItem.dynamic.items[0].orderingValue),maxOrderingValue},OperationsStrategies={applyCompleteHandler:function(extensionInstance,configurator,domWrapper,location,operation,dataItem){var cmd=dataItem.cmd,options=cmd.options||{};if(location!=="card")if(location!=="card"&&options.force&&operation==="added"){var items=dataItem.dataItems;if(_.isArray(items)&&items[0]&&_.contains(["project","team"],items[0].type.toLowerCase())){var acidStore=configurator.getAppStateStore(),ctxService=configurator.getApplicationContextService();acidStore.get({fields:["acid"],callback:function(r){ctxService.getApplicationContext({acid:r.acid},{success:function(ctx){var prevContext={project:ctx.selectedProjectIds,team:ctx.selectedTeamIds},type=items[0].type.toLowerCase();prevContext[type]=_.union(prevContext[type],_.pluck(items,"id"));var config={projectIds:prevContext.project,teamIds:prevContext.team};ctxService.getApplicationContext(config,{success:function(r){extensionInstance.fire("operation.highlightItems",cmd.items),acidStore.set({set:{acid:r.acid}},function(r){})}})}})}})}else OperationsStrategies.refresh(extensionInstance,cmd.items)}else location!=="card"&&options.force?OperationsStrategies.refresh(extensionInstance):location!=="card"&&!options.force&&operation==="added"&&dataItem.affected$CellsArray.length>0?OperationsStrategies.generateNotificationMessage(extensionInstance,cmd.items):location!=="card"&&!options.force&&operation==="deleted"&&dataItem.affected$CellsArray.length>0?OperationsStrategies.generateNotificationMessage(extensionInstance,null):location!=="card"&&!options.force&&operation==="notinslice"&&dataItem.affected$CellsArray.length>0?OperationsStrategies.generateNotificationMessage(extensionInstance,null):location==="card"||!!options.force},refresh:function(extension,itemsToHighlight){itemsToHighlight&&extension.fire("operation.highlightItems",itemsToHighlight),extension.fire("refresh")},generateNotificationMessage:function(extension,targetItems){var me=this,$messageNode=$(["<div>","Board axes were changed, you can ",'<a href="#" class="i-role-refresh-action">refresh the board</a>',"</div>"].join(""));$messageNode.delegate(".i-role-refresh-action","click",_.bind(function(e){var ext=this;return e.preventDefault(),me.refresh(ext,targetItems),!1},extension)),extension.fire("notification",{$node:$messageNode})},triggerPagingAfterQuickAdd:function(extension,pagingSettings,operationArgs){var dimension=_getLocation(operationArgs).charAt(0).toLowerCase(),altDimension=dimension==="x"?"y":"x",oldPage={};oldPage[dimension]=pagingSettings[dimension].currentPage,oldPage[altDimension]=pagingSettings[altDimension].currentPage;var axisPageSettings=pagingSettings[dimension],maxOrderingValue=_findMaxOrderingValue(axisPageSettings.data),newOrderingValue=operationArgs.items[0].data.orderingValue,totalPages=axisPageSettings.totalPages||1,pageNo=newOrderingValue>maxOrderingValue?0:totalPages-1,newPage={};newPage[dimension]=pageNo,newPage[altDimension]=pagingSettings[altDimension].currentPage,extension.fire("operation.highlightItems",operationArgs.items),newPage[dimension]==oldPage[dimension]?extension.fire("refresh"):extension.fire("page.switched",newPage)}};return OperationsStrategies});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.operations',["Underscore","jQuery","tau/core/extension.base.stateful","tau/ui/extensions/board.plus/ui.board.plus.domWrapper","tau/ui/extensions/board.plus/ui.extension.board.plus.operations.strategies"],function(_,$,BaseExtension,DomWrapper,OperationsStrategies){var locationNamesMap={card:"Cards",x:"Axis",y:"Axis"},operationNamesMap={added:"Add",updated:"Update",cascade:"Update",deleted:"Remove",notinslice:"Remove"},generalOperationHandler=function(e,domWrapper,operationArgs){var self=this,eventName=_.keys(e)[1].substring("operation.".length);_.defaults(operationArgs,{operation:eventName,options:{}});var method=self._getMethodNameByOperationArgs(operationArgs);eventName==="cascade"&&(operationArgs.options.suspendAnimation=!0),domWrapper[method]({options:operationArgs.options,items:operationArgs.items,callback:self._createCallback(operationArgs,domWrapper)})};return BaseExtension.extend({init:function(){var self=this;self._debounceSelectionReapply=_.debounce(function(){self.fire("selection.reapply",{})},500),this._super.apply(this,arguments)},"bus view.skeleton.built + board.paging.settings + overview.board.ready":function(e,skeleton,pagingSettings){var domWrapper=new DomWrapper(skeleton.element,this.config.context.configurator);domWrapper.getPagingSettings=function(){return pagingSettings},this.fire("domWrapper.ready",domWrapper)},"bus domWrapper.ready:last > view.cell.skeleton.element.beforeUpdate":function(e,domWrapper,update){domWrapper.applyCellPagingUpdate({$cell:update.cell,$cards:$(update.content)})},throwIfChanged:function(seed,newValue,msg){if(newValue!==seed)throw console.log(msg),msg},cometDataAdapter:function(data){var items=data.items,operation="",location="",len=items.length;for(var i=0;i<len;i++){var x=items[i];i===0?(operation=x.modification,location=x.location):(this.throwIfChanged(operation,x.modification,"DEBUG INFO: Multiply operations in comet notification are not supported"),this.throwIfChanged(location,x.location,"DEBUG INFO: Multiply locations in comet notification are not supported"))}return{operation:operation.toLowerCase(),items:items}},"bus domWrapper.ready:last + comet.tick":function(e,domWrapper,cometDataItems){var self=this,d=self.cometDataAdapter(cometDataItems.data);self.fire("operation.execute",d)},"bus operation.execute":function(e){var self=this,d=e.data;self.fire("operation."+d.operation,d)},"bus domWrapper.ready:last + operation.added":generalOperationHandler,"bus domWrapper.ready:last + operation.updated":generalOperationHandler,"bus domWrapper.ready:last + operation.deleted":generalOperationHandler,"bus domWrapper.ready:last + operation.notinslice":generalOperationHandler,"bus domWrapper.ready:last + operation.cascade":generalOperationHandler,"bus configurator.ready:last + domWrapper.ready:last + operation.execute.done":function(e,configurator,domWrapper,d){var self=this,cmd=d.cmd,l=self._getLocation(cmd),o=cmd.operation;OperationsStrategies.applyCompleteHandler(self,configurator,domWrapper,l,o,d)},"bus operation.highlightItems > domWrapper.ready":function(e,items,domWrapper){domWrapper.highlightAxesLines(items)},_createCallback:function(operationArgs,domWrapper){var self=this,isListMode=domWrapper.isListMode();return function(r){var params={cmd:operationArgs,dataItems:r.affectedDataItems,affected$CellsArray:r.$affectedCells};r.hasOwnProperty("cards")&&(params.cards=r.cards),self.notifyUpdatedCells(r.$affectedCells),isListMode&&operationArgs.operation==="deleted"?self._debounceSelectionReapply():self.fire("selection.reapply",{}),self.notifyExecuted(params)}},_getLocation:function(operationArgs){var src=(operationArgs.items[0].location||"card").toLowerCase(),res=src;return src!=="card"&&(res=src.charAt(0)),res},_getMethodNameByOperationArgs:function(operationArgs){var location=this._getLocation(operationArgs),operation=operationArgs.operation;return["apply",locationNamesMap[location],"Batch",operationNamesMap[operation]].join("")},notifyExecuted:function(params){var self=this;self.fire("operation.execute.done",params)},notifyUpdatedCells:function(cells){var self=this,len=cells.length;for(var i=0;i<len;i++){var $cell=cells[i];self.fire("view.cell.skeleton.updated",{element:$cell})}},"bus operation.execute.done":function(e,params){var self=this,operation=params.cmd.operation,location=self._getLocation(params.cmd);_.contains(["updated","added","cascade"],operation)&&location==="card"&&_.each(params.cards,function($card){var d=$card.data();self.fire("view.card.skeleton.built",{element:$card,data:{id:d.id,type:d.type}})})}})});
define('tau/models/board.plus/model.board.slice.comet',["Underscore","./model.board.base"],function(_,BaseModel){var unSubscribe=function(e,subscription){subscription.stop()},fn=function(callback,context){var timeout=null,c=_.bind(callback,context);return{postpone:function(){clearTimeout(timeout),timeout=setTimeout(c,100)},flush:function(){clearTimeout(timeout),c()}}};return BaseModel.extend({processMessageInQueue:function(queue,location,r){var reason=r.data.reason,modification=r.data.items[0].modification.toLowerCase(),orderingReason=["ModifyDate","NumericPriority"];modification==="updated"&&location==="card"&&_.difference(orderingReason,reason).length===0?queue.add(r):queue.flush(r)},createFireCometTickHandler:function(viewMode){var self=this,cometState={},queue={_queue:[],add:function(r){this._queue.push(r),this._handler.postpone()},flush:function(r){this._handler.flush(),self.fire("comet.tick",r)}};return queue._handler=fn(function(){var q=this._queue,isSubstituteModification=q.length>1;while(q.length>0){var r=q.shift();isSubstituteModification&&_.each(r.data.items,function(i){i.modification="cascade"}),window.appIsInDebugMode===!0&&console.log("   cascade update: ",r),self.fire("comet.tick",r)}},queue),function(r){window.appIsInDebugMode===!0&&console.log("   slice comet: ",r);var item=r.data.items[0],location=(item.location||"").toLowerCase(),sliceId=(item.data.id||"").toLowerCase(),currTimestamp=r.timestamp,prevTimestamp=cometState[sliceId]||0;if(prevTimestamp>currTimestamp||viewMode==="list"&&location!=="card")return;cometState[sliceId]=r.timestamp,self.processMessageInQueue(queue,location,r)}},fireSubscriptionReady:function(r){this.fire("comet.subscription.ready",r)},"bus configurator.ready + slice.ready + viewMode.ready":function(e,configurator,sliceReady,viewMode){var self=this,slice=sliceReady.slice,subscription=configurator.getComet().listen("slice",{parameters:slice.getSliceParams()}).on({callback:self.createFireCometTickHandler(viewMode)}).start();self.fireSubscriptionReady(subscription)},"bus comet.subscription.ready:last + before_destroy":unSubscribe,"bus comet.subscription.ready:last + before_refresh":unSubscribe})});
define('tau/ui/extensions/ui.extension.templateBinder',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/core/templates-factory"],function(_,$,BaseExtension,templatesFactory){return BaseExtension.extend({"bus template.bind":function(evtArgs){var src=evtArgs.data,templateName=src.name,data=src.data,config=src.config||{},template=templatesFactory.get(templateName),$el=template.bind(config,data);src.element=$el,this.fire("template."+templateName+".bound",src)},"bus template.pure.bind":function(evtArgs){var src=evtArgs.data,templateName=src.name,data=src.data,config=src.config||{},template=templatesFactory.get(templateName),html=template.bindPure(config,data);src.html=html,this.fire("template."+templateName+".pure.bound",src)},"bus template.multiply.pure.bind":function(evtArgs){var src=evtArgs.data,templateName=src.name,data=src.arrayData,config=src.config||{},outputEvt={items:[]},template=templatesFactory.get(templateName);_.each(data,function(itemData){var html=template.bindPure(config,itemData);outputEvt.items.push({html:html,data:itemData})}),this.fire("template.multiply."+templateName+".pure.bound",outputEvt)}})});
define('tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-cells',["Underscore","jQuery"],function(_,$){var setPosition=function(e){var $grid=$(e.delegateTarget),$cellHolder=$(e.currentTarget),$flyButtonPanel=this,padding=2,pos=$cellHolder.position(),panelHeight=$flyButtonPanel.height(),panelWidth=$flyButtonPanel.width(),cellHolderHeight=$cellHolder.height(),cellHolderWidth=$cellHolder.width(),hldrOffset=$cellHolder.offset(),gridOffset=$grid.offset(),cellOffsetY=cellHolderHeight-panelHeight,gridDomElement=$grid[0],scrollBarHeight=gridDomElement.offsetHeight-gridDomElement.clientHeight,scrollBarWidth=gridDomElement.offsetWidth-gridDomElement.clientWidth,top=pos.top+cellOffsetY+$grid.scrollTop()-1.5*padding,gridH=gridOffset.top+$grid.height()-scrollBarHeight,cellH=hldrOffset.top+cellHolderHeight,deltaH=_.max([0,cellH-gridH]);top-=deltaH;var panelInnerOffsetY=_.max([0,panelHeight+2*padding-(cellHolderHeight-deltaH)]);top+=panelInnerOffsetY;var cellOffsetX=cellHolderWidth-panelWidth,left=pos.left+cellOffsetX+$grid.scrollLeft()-padding,gridX0=gridOffset.left+$grid.width()-scrollBarWidth,cellX0=hldrOffset.left+cellHolderWidth,deltaW=_.min([0,gridX0-cellX0]);left+=deltaW;var panelInnerOffsetX=_.max([0,panelWidth-(cellHolderWidth-deltaW)-padding]);left+=panelInnerOffsetX,$flyButtonPanel.css("top",top).css("left",left)};return function(domWrapper,settings){var isActivatedMode=!1,activatedScope,lastScopeCoordinate,sharedState=null,$buttonPanel=settings.$buttonPanel;$buttonPanel.hide();var $button=$buttonPanel.find(".tau-btn"),predicateAddAction=function(d){return _.find(settings.items,function(itemData){var matchLocation=itemData.x==d.x&&itemData.y==d.y;if(matchLocation){var hasAddAction=_.find(itemData.fixed.items,function(item){return item.type==="AddAction"});if(hasAddAction)return!0}return!1})},createEventHandler=function(eventFlag,callback){return function(e){var $cellHolder=$(e.currentTarget),d=$cellHolder.data(),action=predicateAddAction(d);return lastScopeCoordinate=eventFlag+"_"+d.x+"_"+d.y,!isActivatedMode&&action?callback(e,{actionItems:action}):{}}},onClickHandler=function(){if(sharedState&&!isActivatedMode){isActivatedMode=!0,activatedScope=lastScopeCoordinate;var o={data:sharedState,deactivate:function(){isActivatedMode=!1,activatedScope!==lastScopeCoordinate&&$buttonPanel.hide()}};settings.onActivate(o)}};$button.click(onClickHandler);var $targetGrid=domWrapper.getGrid();$targetGrid.find(".i-role-cellholder").addClass("i-role-ch-quickadd-target");var adjustButtonPanel=function(e){setPosition.call($buttonPanel,e)},showButtonPanel=_.throttle(function($cellHolder){if(!sharedState)return;$buttonPanel.css("position","absolute"),$buttonPanel.appendTo($cellHolder),$buttonPanel.show()},500),hideButtonPanel=function(){$buttonPanel.hide()},activateButtonPanel=function(e,obj){sharedState=obj,setPosition.call($buttonPanel,e);var $cellHolder=$(e.currentTarget);return showButtonPanel($cellHolder),{buttonIsVisible:!0}},deactivateButtonPanel=function(){sharedState=null,hideButtonPanel()},doubleClick=_.debounce(function(event){($(event.target).hasClass("i-role-ch-quickadd-target")||$(event.target).hasClass("i-role-cell"))&&createEventHandler("enter",activateButtonPanel)(event).buttonIsVisible&&$button.click()},300),selector=".i-role-cellholder.i-role-ch-quickadd-target";$targetGrid.on("mousemove",selector,{},createEventHandler("enter",adjustButtonPanel)),$targetGrid.on("mouseenter",selector,{},createEventHandler("enter",activateButtonPanel)),$targetGrid.on("mouseleave",selector,{},createEventHandler("leave",deactivateButtonPanel)),$targetGrid.on("dblclick",selector,doubleClick)}});
define('tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-list',["Underscore","jQuery"],function(_,$){return function(domWrapper,settings){var isActivatedMode=!1,activatedScope,lastScopeCoordinate,sharedState=null,$buttonPanel=settings.$buttonPanel;$buttonPanel.hide();var $button=$buttonPanel.find(".tau-btn"),predicateAddAction=function(d){return _.find(settings.items,function(itemData){var matchLocation=itemData.x==d.x&&itemData.y==d.y;if(matchLocation){var hasAddAction=_.find(itemData.fixed.items,function(item){return item.type==="AddAction"});if(hasAddAction)return!0}return!1})},createEventHandler=function(eventFlag,callback){return function(e){var $grid=$(e.delegateTarget),$cellHolder=$grid.find(".i-role-cellholder"),d=$cellHolder.data(),action=predicateAddAction(d);lastScopeCoordinate=eventFlag+"_"+d.x+"_"+d.y,!isActivatedMode&&action&&callback(e,{actionItems:action})}},onClickHandler=function(){if(sharedState){isActivatedMode=!0,activatedScope=lastScopeCoordinate;var o={data:sharedState,deactivate:function(){isActivatedMode=!1,activatedScope!==lastScopeCoordinate&&$buttonPanel.hide()}};settings.onActivate(o)}};$button.click(onClickHandler);var $targetGrid=domWrapper.getGrid().parent(".i-role-board-body"),showButtonPanel=function(e,obj){sharedState=obj,$buttonPanel.show()},hideButtonPanel=function(){sharedState=null,$buttonPanel.hide()},padding=2,widthCellholder=$targetGrid.find(".i-role-cellholder").width(),buttonPanelWidth=32;$buttonPanel.css("left",widthCellholder-buttonPanelWidth-padding),$buttonPanel.css("bottom",padding),$buttonPanel.css("position","absolute"),$buttonPanel.addClass("i-role-quick-add-decorator-list"),$targetGrid.append($buttonPanel);var doubleClick=_.debounce(function(event){$(event.target).hasClass("i-role-cellholder")&&$button.is(":visible")&&$button.click()},300),selector=".i-role-grid,.i-role-quick-add-decorator-list";$targetGrid.on("mouseenter",selector,createEventHandler("enter",showButtonPanel)),$targetGrid.on("mouseleave",selector,createEventHandler("leave",hideButtonPanel)),$targetGrid.on("dblclick",selector,doubleClick)}});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.quick.add.cells',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-cells","tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-list"],function(_,$,ExtensionBase,CellsQuickAddDecorator,ListQuickAddDecorator){return ExtensionBase.extend({resetLifecycle:!0,"bus slice.cells.quickadd.api.ready:last + domWrapper.ready:last + model.cellActions.ready":function(e,quickAddApi,domWrapper,cellsActions){var self=this,$buttonPanel=domWrapper.createQuickAddPanel();$buttonPanel.hide();var api=quickAddApi;api.on("after.addData",_.bind(self.onAfterAddData,self)),api.on("after.listAddData",_.bind(self.onAfterAddData,self));var QuickAddDecorator=domWrapper.isListMode()?ListQuickAddDecorator:CellsQuickAddDecorator;domWrapper.decorate(QuickAddDecorator,{$buttonPanel:$buttonPanel,items:cellsActions.items,onActivate:function(e){var param={target:$buttonPanel.find(".tau-btn"),actionItems:e.data.actionItems,ctrl:e};self.showQuickAddPopup(api,domWrapper,param)}})},onAfterAddData:function(e){var result=e.data.result,d=result[0];this.fire("operation.added",{options:{forceAppend:!0},items:[{data:d.dataItem,x:d.x,y:d.y}]})},cellHasCards:function(cell){var children=$(cell).children(".i-role-card");return children.size()>0},showQuickAddPopup:function(slice,domWrapper,activationData){var self=this,button=activationData.target,findCellActionItemInData=function(cellData){return _.find(cellData.fixed.items,function(item){return item.type==="AddAction"})},actionItems=activationData.actionItems,addActionItem=findCellActionItemInData(actionItems),cellHolder=domWrapper.getCellByCoordinate(actionItems),cellIsInitiallyEmpty=!this.cellHasCards(cellHolder),CONST_ADDEXPAND_CLASS="tau-quick-add_expand",viewMode=domWrapper.isListMode()?"list":"board",$gridView=domWrapper.getGrid().parents(".tau-board-grid-view,.tau-entity-list"),bubbleConfig={target:button,cleanupOnHide:!0,stackName:"quickAdd",showOnCreation:!0,zIndex:1e4,onShow:function(){$gridView.prop("disabled",!0),button.parent().addClass(CONST_ADDEXPAND_CLASS)},onHide:function(){$gridView.prop("disabled",!1),button.parent().removeClass(CONST_ADDEXPAND_CLASS),activationData.ctrl.deactivate();if(cellIsInitiallyEmpty&&self.cellHasCards(cellHolder)){var x=actionItems.x,y=actionItems.y;domWrapper.expandCell(self,x,y)}},onPositionConfig:function(){var position={of:button,collision:"fit flip",my:"left top",at:"left bottom",offset:"-30 0"};return button.tauBubble("widget").height()<button.offset().top&&(position=_.extend(position,{my:"left bottom",at:"left top"})),position},dontCloseSelectors:["#ui-datepicker-div"],componentsConfig:{components:[{type:"board.cell.quick.add",options:{slice:slice,action:actionItems,addAction:addActionItem,viewMode:viewMode}}]}};self.fire("initBubble",bubbleConfig)}})});
define('tau/models/board.plus/model.board.plus.quick.add.cells',["Underscore","./model.board.base"],function(_,ModelBase){return ModelBase.extend({"bus overview.board.ready":function(evt){var f=_.bind(this.fire,this,"cellActions.init");_.delay(f,500)},"bus configurator.ready + slice.ready + cellActions.init":function(evt,configurator,sliceData){var slice=sliceData.slice.clone();this.fire("slice.cells.quickadd.api.ready",slice)},"bus slice.cells.quickadd.api.ready + model.sliceInfo.retrieved":function(evt,slice,sliceInfo){var x=_.pluck(sliceInfo.x.data,"x"),y=_.pluck(sliceInfo.y.data,"y"),coords={$whereX:x.length?{x:{$in:x}}:undefined,$whereY:y.length?{y:{$in:y}}:undefined},self=this;if(sliceInfo.definition.cells&&sliceInfo.definition.cells.types.length==0){self.fire("model.cellActions.ready",{items:[]});return}var cellActionsDeferred;switch(sliceInfo.viewMode){case"list":cellActionsDeferred=slice.listModeActionsV2(coords);break;default:cellActionsDeferred=slice.cellActionsV2(coords)}cellActionsDeferred.done(function(cellActions){self.fire("model.cellActions.ready",cellActions.data)})}})});
define('application.creator',["jQuery"],function($){return{create:function(appConfig){var $return=$.Deferred(),req=require;return req(["all.components"],function(){req(["tau/components/component.application.generic"],function(appComponent){appConfig.options=appConfig.options||{},appConfig.options.applicationId=appConfig.options.applicationId||appConfig.applicationId,appConfig.options.integration=appConfig.options.integration||appConfig.integration,appConfig.context=appConfig.context||{},appConfig.context.configurator=appConfig.context.configurator||appConfig.configurator;var appBus=appComponent.create(appConfig);$return.resolve(appBus)})}),$return}}});
define('tp/reports/service.chart.size',["tau/core/class","tau/core/event"],function(Class,Event){var Service=Class.extend({size:function(){return{width:$(window).width()*.85,height:$(window).height()*.7}}});return Event.implementOn(Service.prototype),Service});
define('tp/reports/tp.application.reports',["jQuery","application.creator","tau/services/service.navigator","tp/reports/service.chart.size"],function($,AppCreator,ServiceNavigator,ServiceChartSize){var APP_ID="appReports",initializeApplication=function(configurator){configurator._id=_.uniqueId("report_charts_viewer"),configurator.isBoardEdition=!0;var ROUTING_PATTERNS=[{pattern:/reports$/,adapter:function(){this.resolve({id:null,entity:"reports"})},type:"tau/components/component.page.reports",host:"tau/components/component.master.empty"},{pattern:/reports\/(\w+)/,adapter:function(reportType){this.resolve({id:null,entity:"reports",reportType:reportType})},type:"tau/components/component.page.reports",host:"tau/components/component.master.empty"},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,adapter:function(entityType,entityId,tail){this.resolve({id:parseInt(entityId),entity:entityType,action:"show"})},type:"tau/components/component.page.entity",host:"tau/components/component.master.empty"},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,adapter:function(entityType,entityId,action){this.resolve({id:parseInt(entityId),entity:entityType,action:action})},type:"tau/components/component.page.entity",host:"tau/components/component.master.empty"}],appConfig={name:"application charts",applicationId:APP_ID,routes:ROUTING_PATTERNS,configurator:configurator,options:{routing:{silent:!0}},integration:{disableProgressIndicator:!0,showInPopup:!0,keepAlive:!1}};return AppCreator.create(appConfig).pipe(function(appBus){var $return=$.Deferred();return appBus.on("innerContentRendered",function(e,renderData){var $el=renderData.element,$applicationRoleNode=$el.parents(".i-role-application")}),appBus.initialize(appConfig),$return.resolve(appBus),$return})},initialize=function(parentConfigurator,parameters){var configurator=parentConfigurator.createChild();configurator.getExternal().setFakeWindow(),configurator.registerService("chart.size",new ServiceChartSize),configurator.registerService("navigator",new ServiceNavigator(configurator,{parameterName:APP_ID})),configurator.service("navigator").to("reports/"+parameters.active),initializeApplication(configurator)};return{initialize:initialize}});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.burnDown',["jQuery","tau/components/extensions/component.extension.base","Underscore","tp/reports/tp.application.reports"],function($,ExtensionBase,_,reportsApplication){return ExtensionBase.extend({"bus configurator.ready:last + domWrapper.ready":function(evt,configurator,domWrapper){domWrapper.board.on("click",".tau-label__burnDown",function(){var restStorage=configurator.getRestStorage();$.when(restStorage.data("burnDownVer2Filter","setting",{scope:"Public",userData:{burnDownType:$(this).data("entity-type"),plannableId:$(this).data("entity-id")}})).done(function(){reportsApplication.initialize(configurator,{active:"burnDown"})})})}})});
define('tau/ui/templates/board.plus/ui.template.boardplus.skeleton.board',["Underscore","tau/core/templates-factory","tau/ui/extensions/board.plus/ui.board.plus.utils"],function(_,templates,BoardPlusUtils){var config={name:"boardplus.skeleton.board",engine:"jqote2",customFunctions:{generateId:BoardPlusUtils.generateId,generateCellData:BoardPlusUtils.generateElementData,hasAdditionalInfo:function(data,occurrence,key){return _.any(data,function(item){return key&&(item=item[key]),~occurrence.indexOf(item)})}},markup:["<% var hasX = !this.x.isNull; %>","<% var hasY = !this.y.isNull; %>",'<% var xcols = hasX ? this.x.data : [{x:"null"}]; %>','<% var yrows = hasY ? this.y.data : [{y:"null"}]; %>','<% var xColsAdditionalInfo = fn.hasAdditionalInfo(this.definition.x&&this.definition.x.types,["release","iteration","teamiteration"]); %>','<% var yRowsAdditionalInfo = fn.hasAdditionalInfo(this.definition.y&&this.definition.y.types,["release","iteration","teamiteration"]); %>','<% var yRowsUserAvatar = fn.hasAdditionalInfo(this.definition.y&&this.definition.y.types,["team"])&&!fn.hasAdditionalInfo(this.definition.cells&&this.definition.cells.types,["user"],"type"); %>','<% var additionalClasses = [" zoom-level-" + this.zoomLevel]; %>','<% !hasX && additionalClasses.push(" tau-no-cols"); %>','<% !hasY && additionalClasses.push(" tau-no-rows"); %>','<div class="tau-board-body <%=xColsAdditionalInfo?"additional-info_x":""%> <%=yRowsUserAvatar?"additional-info_avatar":""%> <%=yRowsAdditionalInfo?"additional-info_y":""%> ">',"<div class=\"tau-board-grid-view<%= additionalClasses.join('') %>\" ",'data-zoom-level="<%= this.zoomLevel%>"',">",'<div role="board-body" class="i-role-board-body">',"<% if (hasX && hasY) { %>",'<div class="tau-x-header">','<div class="tau-cell">','<div class="tau-collapser">','<button class="tau-h-collapser i-role-collapser"></button>',"</div>",'<div class="tau-label">',"<%= this.y.title %>"," / ","<%= this.x.title %>","</div>","</div>","</div>","<% } %>","<% if (hasY) { %>",'<div role="header" data-dimension="y" class="i-role-header tau-rows-header tau-header-<%= this.definition.y.types[0].toLowerCase() %>">',"<ul>","<% for (var i = 0; i < this.y.data.length; i++) { %>","<% var m = this.y.data[i]; %>",'<li role="cellholder" class="i-role-cellholder tau-cellholder" id="ch_<%= fn.generateId(m) %>" <%= fn.generateCellData({y:m.y}) %>>','<div role="cell" class="i-role-cell tau-cell" id="<%= fn.generateId(m) %>" <%= fn.generateCellData({y:m.y}) %>>',"</div>","</li>","<% } %>","</ul>","</div>","<% } %>","<% if (hasX) { %>",'<div role="header" data-dimension="x" class="i-role-header tau-cols-header tau-header-<%= this.definition.x.types[0].toLowerCase() %>">',"<ul>","<% for (var i = 0; i < this.x.data.length; i++) { %>","<% var m = this.x.data[i]; %>",'<li role="cellholder" class="i-role-cellholder tau-cellholder" id="ch_<%= fn.generateId(m) %>" <%= fn.generateCellData({x:m.x}) %>>','<div role="cell" class="i-role-cell tau-cell" id="<%= fn.generateId(m) %>" <%= fn.generateCellData({x:m.x}) %>>',"</div>","</li>","<% } %>","</ul>","</div>","<% } %>",'<div role="grid" class="i-role-grid tau-grid <% if (!hasX){ %>tau-grid_x_false<% } %> <% if (!hasY){ %>tau-grid_y_false<% } %>" id="grid_<%= _.uniqueId() %>">','<table cellpadding="0" cellspacing="0">',"<tbody>","<% for (var y = 0; y < yrows.length; y++) { %>","<tr>","<% for (var x = 0; x < xcols.length; x++) { %>","<% var coords = { x: xcols[x].x, y: yrows[y].y }; %>",'<td role="cellholder" class="i-role-cellholder tau-cellholder" id="ch_<%= fn.generateId(coords) %>" <%= fn.generateCellData(coords) %> >','<div role="cell" class="i-role-cell tau-cell" id="<%= fn.generateId(coords) %>" <%= fn.generateCellData(coords) %>>',"</div>","</td>","<% } %>","</tr>","<% } %>","</tbody>","</table>","</div>","</div>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.skeleton.list',["Underscore","tau/core/templates-factory","tau/ui/extensions/board.plus/ui.board.plus.utils"],function(_,templates,BoardPlusUtils){var config={name:"boardplus.skeleton.list",engine:"jqote2",customFunctions:{generateId:BoardPlusUtils.generateId,generateCellData:BoardPlusUtils.generateElementData},markup:['<% var coords = { x: "null", y: "null" }; %>','<% var additionalClasses = [" zoom-level-" + this.zoomLevel].join(" "); %>','<div class="tau-board-body">','<div role="board-body" class="i-role-board-body tau-board-composite-view <%= additionalClasses %>" data-zoom-level="<%= this.zoomLevel%>">','<div role="grid" class="i-role-grid tau-entity-list">','<div role="cellholder" class="i-role-cellholder" <%= fn.generateCellData(coords) %> id="ch_<%= fn.generateId(coords) %>">','<div role="cell" class="i-role-cell" id="<%= fn.generateId(coords) %>" <%= fn.generateCellData(coords) %>></div>',"</div>","</div>",'<div role="card-details-holder" class="i-card-details-holder tau-entity-data"></div>',"</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.skeleton',["Underscore","tau/core/templates-factory","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/ui/templates/board.plus/ui.template.boardplus.skeleton.board","tau/ui/templates/board.plus/ui.template.boardplus.skeleton.list"],function(_,templates,BoardPlusUtils){var config={name:"boardplus.skeleton",engine:"jqote2",customFunctions:{generateId:BoardPlusUtils.generateId,generateCellData:BoardPlusUtils.generateElementData},markup:["<% var viewMode = this.viewMode; %>",'<%= fn.sub("boardplus.skeleton." + viewMode, this) %>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.cell.grid.skeleton',["tau/core/templates-factory","tau/ui/templates/board.plus/ui.template.boardplus.card.skeleton"],function(templates){var config={name:"boardplus.cell.grid.skeleton",engine:"jqote2",markup:[["<% for(var itemIndex = 0; itemIndex < this.dynamic.items.length; itemIndex++) { %>","<%  var dataItem = this.dynamic.items[itemIndex]; %>",'<%= fn.sub("boardplus.card.skeleton", dataItem) %>',"<% } %>"].join("")]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.cell.axis.item',["tau/core/templates-factory","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/utils/utils.date","tau/utils/utils.translation","tau/services/service.features"],function(templates,BoardPlusUtils,dateUtils,Translation,FeatureService){var featureService=new FeatureService(window.tauFeatures),config={name:"boardplus.cell.axis.item",engine:"jqote2",customFunctions:{generateCardData:BoardPlusUtils.generateElementData,processDates:function(startDate,endDate,isCurrent){function timeLeft(startDate,endDate){startDate=dateUtils.parse(startDate),endDate=dateUtils.parse(endDate);var rangeDateHours=Math.floor((endDate-startDate)/36e5),rangeDateDays=Math.ceil(rangeDateHours/24);return rangeDateDays?rangeDateDays+" "+Translation.pluralize("day|days",rangeDateDays)+" left":rangeDateHours+" "+Translation.pluralize("hour|hours",rangeDateHours)+" left"}var sDate=dateUtils.convertToTimezone(startDate),eDate=dateUtils.convertToTimezone(endDate),additionalClass=isCurrent?"tau-label__date_current":"",timeLeft=isCurrent?'<span class="time-left">'+timeLeft(new Date,eDate)+"</span>":"",format=sDate.getYear()==eDate.getYear()?"d-MMM":dateUtils.getFormatData().date.short;return'<span class="tau-label tau-label__date '+additionalClass+'">'+dateUtils.formatAs(sDate,format)+" &mdash; "+dateUtils.formatAs(eDate,format)+" "+timeLeft+"</span>"},velocity:function(data){var units=data.units||"",effort=data.effortSum||0;effort=Math.round(effort);var velocity=Math.round(data.velocity),style="tau-label__velocity_perfect",effortLimit="Perfect match!",range=velocity-effort;if(velocity!==0&&range!==0){var percent=Math.abs(range)*100/velocity;range>0&&(effortLimit="remain."),range<0&&(effortLimit="overhead."),percent<5?style="tau-label__velocity_warning":range<0&&(style="tau-label__velocity_overhead")}else range!==0&&(range>0&&(effortLimit="remain."),range<0&&(effortLimit="overhead."),range<0&&(style="tau-label__velocity_overhead"));var burnDown="";return data.id&&(data.type=="Iteration"||data.type=="TeamIteration")&&(burnDown=this.burnDownIcon(data)),range=Math.abs(range),range=range?range+" "+units+" ":"",'<span class="tau-label tau-label__text tau-label__velocity">'+burnDown+'<span class="tau-label_mark">'+effort+"</span>"+" of "+'<span class="tau-label_mark">'+velocity+" "+units+"</span>"+" assigned. "+'<span class="'+style+'">'+range+effortLimit+"</span>"+"</span>"},effort:function(data){var additionalClass="",actionWord=" done.",effortCompleted="";if(!data.effortCompleted&&data.isCurrent||data.isPrevious||data.effortCompleted)effortCompleted='<span class="tau-label_mark">'+data.effortCompleted+"</span>"+" of ";data.isCurrent&&(additionalClass="tau-label__effort_current"),data.isNext&&(additionalClass="tau-label__effort_next",data.effortCompleted||(actionWord=" assigned.")),data.isPrevious&&(additionalClass="tau-label__effort_previous",data.effortCompleted==data.effortTotal&&(effortCompleted=""));var burnDown="";return data.type=="Release"&&data.id&&(burnDown=this.burnDownIcon(data)),'<span class="tau-label tau-label__effort '+additionalClass+'">'+burnDown+effortCompleted+'<span class="tau-label_mark">'+data.effortTotal+" "+data.units+"</span>"+actionWord+"</span>"},burnDownIcon:function(data){return'<span class="tau-icon tau-icon_type_svg tau-icon_name_burn-down tau-label__burnDown" data-entity-id="'+data.id+'" data-entity-type="'+data.type.toLowerCase()+'"></span>'},processTags:function(tags){return _.compact(_.asString(tags).split(","))}},markup:['<% var axis = this.itemData.hasOwnProperty("effort") ? "Y" : "X"; %>','<% if (this.entity.type == "user"){ %>','<div class="i-role-axis-item tau-axiscell__item tau-label i-role-focustrigger">',"<% if (this.isSupportView){ %>",'<span <% if (this.isSupportView){ %> class="i-role-cellaxis-viewtrigger" <% } %> <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %>>',"<% if (this.itemData.avatarUri){ %>",'<span class="tau-avatar tau-avatar_<%= this.entity.id %>" >','<img src="<%= this.itemData.avatarUri %>24" />',"</span>","<% } %>",'<span class="tau-label__text tau-name i-role-name"><%! this.name %></span>',"</span>","<% } else { %>",'<span class="tau-name"><%! this.name %></span>',"<% } %>","</div>",'<% } else if (axis == "Y" && (this.entity.type == "userstory" || this.entity.type == "feature") && this.itemData.id){ %>','<div class="i-role-axis-item tau-axiscell__item tau-label i-role-focustrigger">',"<% var item = this.itemData; %>",'<% if (item.hasOwnProperty("id")) { %>','<span class="<% if (this.isSupportView){ %>i-role-cellaxis-viewtrigger <% } %>ui-type-icon ui-type-icon-<%= this.entity.type %>" <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %>>',"<%= item.id %>","</span>","<% } %>",'<div class="tau-state"><%! item.entityState.name %></div>','<div class="<% if (this.isSupportView){ %>i-role-cellaxis-viewtrigger <% } %> tau-name  i-role-name"  <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %>><%! this.name %></div>',"<% if (item.project && item.project.abbreviation) {%>",'<div <% if (item.project.color){ %> style="background-color: <%= item.project.color %>;"<% } %> ','class="tau-project-abbr" title="<%! item.project.name %>"',">","<%! item.project.abbreviation %>","</div>","<% } %>","<% var usersCount = item.assignedUsers.length - 2;%>",'<%if (item.hasOwnProperty("assignedUsers")) {%>','<div class="tau-people">','<%= fn.sub("boardplus.card.assignedUsers",{count:usersCount,items:item.assignedUsers.slice(0,2),viewTrigger:true}) %>',"</div>","<% } %>",'<% if (item.hasOwnProperty("effort")){ %>','<div class="tau-effort">',"<%= item.effort %>",'<%= item.units || "pt" %>',"</div>","<% } %>","</div>","<% } else { %>",'<div class="i-role-axis-item">','<div class="tau-axiscell__item tau-label i-role-focustrigger">',"<% if (this.isSupportView){ %>",'<span class="i-role-cellaxis-viewtrigger" <%= fn.generateCardData({ id: this.id, "entity-id": this.entity.id, "entity-type": this.entity.type}) %> >','<% if (this.entity.type == "team"){ %>',"<span>","<% if (this.itemData.icon){ %>","<i class=\"tau-icon tau-icon_type_svg tau-icon_name_<%= this.itemData.icon || '' %>\"></i>","<% } else { %>",'<i class="tau-icon tau-icon_type_svg tau-icon_name_trihead"></i>',"<% } %>","</span>",'<% } else if (this.entity.type == "project") { %>',"<% if (this.itemData.color){ %>",'<i class="tau-icon tau-icon_type_color ui-type-icon-project" style="background-color: <%= this.itemData.color %>;"></i>',"<%} else {%>",'<i class="tau-icon tau-icon_type_color ui-type-icon-project tau-icon_name_empty"></i>',"<%}%>","<% } else { %>",'<span class="ui-type-icon ui-type-icon-<%= this.entity.type %>" >',"<%= this.entity.id %>","</span>","<% } %>",'<span class="tau-label__text  i-role-name"><%! this.name %><%if(this.itemData.isCurrent){%> <span class="tau-label__text_current">(Current)</span><%}%></span></span>',"<% } else { %>",'<span class="i-role-name"><%! this.name %><%if(this.itemData.isCurrent){%> <span class="tau-label__text_current">(Current)</span><%}%></span>',"<% } %>","</div>",'<% if (this.entity.type == "team"){ %>','<div class="tau-team-members">',"<% var users = this.itemData.users || []; _.forEach(users, function(user,index,users){ %>","<%if(index < 7){%>",'<span class="tau-avatar i-role-cellaxis-viewtrigger" <%= fn.generateCardData({ id: user.id, "entity-id": user.id, "entity-type": "user"}) %> ><img title="<%= user.name %>" src="<%= user.avatarUri %>24" /></span>',"<%}%>","<%if(index == 7){%>",'<span class="count-users">+ <%=users.length - index%></span>',"<%}%>","<% });  %>","</div>","<% } %>","<% if (this.itemData.startDate && this.itemData.endDate){ %>","<%= fn.processDates(this.itemData.startDate, this.itemData.endDate,this.itemData.isCurrent)%>","<% } %>","<% if (this.itemData.velocity !== undefined){%>","<%= fn.velocity(this.itemData)%>","<%}%>","<% if (this.itemData.effortCompleted !== undefined && this.itemData.effortTotal !== undefined){%>","<%= fn.effort(this.itemData)%>","<%}%>","</div>","<% } %>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.cell.axis.skeleton',["tau/core/templates-factory","tau/ui/templates/board.plus/ui.template.boardplus.cell.axis.item"],function(templates){var config={name:"boardplus.cell.axis.skeleton",engine:"jqote2",markup:["<% if (this.dynamic) { %>",'<%= fn.sub("boardplus.cell.axis.item", this) %>','<div class="i-role-axis-mark-collapser tau-axiscell__item tau-collapser">','<button role="collapser" class="i-role-collapser tau-v-collapser"></button>',"</div>",'<label class="i-role-axis-mark-selector tau-axiscell__item tau-selector">','<input type="checkbox" name="focus" />',"</label>","<% } %>"]};return templates.register(config)});
define('tau/ui/templates/board.plus/ui.template.boardplus.request.indicator',["tau/core/templates-factory"],function(templates){var config={name:"boardplus.request.indicator",engine:"jqote2",markup:['<div style="display:none;" role="status" aria-hidden="true">','<div class="loadBar" id="loadDiv">','<img class="icon" src="<%= this.imageSrc %>">&nbsp;<span>Loading</span>',"</div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.board.plus.base',["Underscore","tau/core/bus.profiler","tau/ui/extensions/board.plus/ui.extension.board.plus.profiler","tau/components/component.creator","tau/views/view.board.plus","tau/ui/extensions/board.plus/ui.extension.board.plus.controller","tau/ui/extensions/board.plus/ui.extension.board.plus.requestIndicator","tau/ui/extensions/board.plus/ui.extension.board.plus.cards-lazy-loading","tau/ui/extensions/board.plus/ui.extension.board.plus.progress","tau/ui/extensions/board.plus/ui.extension.board.plus.empty.data","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsUpdater","tau/models/board.plus/model.board.nodata","tau/models/board.plus/model.board.definition.augmenter","tau/models/board.plus/model.board.plus.refresher","tau/models/board.plus/model.board.zoomLevel","tau/models/board.plus/model.board.slice.metaInfo","tau/models/board.plus/model.filter.suggestions.preloading","tau/ui/extensions/board.plus/ui.extension.board.plus.cells.paging","tau/ui/extensions/board.plus/ui.extension.board.plus.errors","tau/components/extensions/error/extension.errorBar","tau/ui/extensions/board.plus/ui.extension.board.plus.external.api","tau/ui/extensions/board.plus/ui.extension.board.plus.operations","tau/models/board.plus/model.board.slice.comet","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/ui.extension.templateBinder","tau/ui/extensions/board.plus/ui.extension.board.plus.quick.add.cells","tau/models/board.plus/model.board.plus.quick.add.cells","tau/ui/extensions/board.plus/ui.extension.board.plus.burnDown","tau/ui/templates/board.plus/ui.template.boardplus.skeleton","tau/ui/templates/board.plus/ui.template.boardplus.cell.grid.skeleton","tau/ui/templates/board.plus/ui.template.boardplus.cell.axis.skeleton","tau/ui/templates/board.plus/ui.template.boardplus.card.content","tau/ui/templates/board.plus/ui.template.boardplus.request.indicator"],function(_,BusProfiler,ExtensionProfiler,creator,ViewBoardPlus,ControllerBoardPlus,RequestIndicatorExtension,CardsLazyLoadingExtension,ProgressExt,EmptyDataExt,ExtensionCardsUpdater,ModelBoardNoData,ModelBoardCellQueryAugmenter,ModelRefresher,ModelZoomLevel,ModelMetaInfo,ModelSuggestionsPreloading,ExtensionCellPaging,ErrorsExtension,ErrorBarExtension,ExternalAPIExtension,OperationsExtension,ModelBoardSliceComet,BubbleCreator,ComponentCreatorExtension,TemplateBinder,QuickAddCellsExtension,QuickAddCellsModel,BurnDownExtension){return{create:function(inheritanceConfig,config){var featureService=config.context.configurator.getFeaturesService(),creatorConfig={ViewType:ViewBoardPlus,"queue.bus":!0,extensions:inheritanceConfig.extensions.concat([ControllerBoardPlus,ExtensionCellPaging,RequestIndicatorExtension,ProgressExt,EmptyDataExt,ModelMetaInfo,ModelSuggestionsPreloading,ModelBoardNoData,ErrorsExtension,ErrorBarExtension,ExtensionCardsUpdater,ModelBoardCellQueryAugmenter,ModelRefresher,ExternalAPIExtension,OperationsExtension,BubbleCreator,ComponentCreatorExtension,TemplateBinder,BurnDownExtension,CardsLazyLoadingExtension])};featureService.isEnabled("comet.notifications")&&creatorConfig.extensions.push(ModelBoardSliceComet);var isFeatureEnabled=featureService.isEnabled("quick.add");isFeatureEnabled&&(creatorConfig.extensions=creatorConfig.extensions.concat([QuickAddCellsExtension,QuickAddCellsModel])),config["queue.bus"]=!0;var componentBus=creator.create(creatorConfig,config);return componentBus}}});
define('tau/models/board.plus/model.board.plus',["Underscore","tau/models/board.plus/model.board.base"],function(_,BaseModel){return BaseModel.extend({"bus configurator.ready:last + start.lifecycle":function(evt,configurator){configurator.getAppStateStore().get({fields:["acid"],callback:_.bind(function(result){this.fire("acid.ready",result.acid)},this)})},"bus boardSettings.ready:last + start.lifecycle":function(evt,bs){var self=this,boardSettings=bs.boardSettings;boardSettings.get({fields:["x","y","cells","zoomLevel","viewMode","page","focus","selectedMarks","user","acid"],callback:function(r){self.fire("board.configuration.ready",r)}})},"bus board.configuration.ready":function(evt,r){var self=this,definition={};r.hasOwnProperty("x")&&r.x!==null&&(definition.x=r.x),r.hasOwnProperty("y")&&r.y!==null&&(definition.y=r.y),r.hasOwnProperty("cells")&&r.cells!==null&&(definition.cells=r.cells),definition.zoomLevel=self.normalizeZoomLevel(r.zoomLevel||3),definition.page=_.defaults(r.page||{},{x:0,y:0,size:{x:8,y:20}}),definition.focus=_.defaults(r.focus||{},{x:[],y:[]}),definition.selectedMarks=_.defaults(r.selectedMarks||{},{x:[],y:[]}),definition.viewMode=r.viewMode||"board",definition.boardId=r.id,definition.user=_.defaults(r.user||{},{cardsFilter:""}),self.fire("definition.ready",definition),self.fire("board.definition.ready",definition)},"bus configurator.ready + definition.ready + acid.ready":function(evt,configurator,definition,acid){var sliceConfig={definition:definition};sliceConfig.definition.global={acid:acid};var slice=configurator.getSliceFactory().create(sliceConfig);this.fire("slice.ready",{slice:slice})},"bus slice.ready:last + before_destroy":function(evt){this.fire("clearError");var slice=evt["slice.ready"].data.slice;slice.abort()},"bus slice.ready:last + before_refresh":function(evt){this.fire("clearError");var slice=evt["slice.ready"].data.slice;slice.abort()},"bus slice.ready + model.get.sliceInfo":function(evt){var self=this,slice=evt["slice.ready"].data.slice;self.onGetSliceInfo(slice)},onGetSliceInfo:function(slice){},"bus boardSettings.ready:last + destroy":function(evt){var boardSettings=evt["boardSettings.ready"].data.boardSettings;boardSettings.unbind({listener:this})},"bus boardSettings.ready":function(evt){var self=this,boardSettings=evt.data.boardSettings;boardSettings.unbind({listener:self}),boardSettings.bind({fields:["zoomLevel"],listener:self,callback:_.bind(self.onZoomLevelUpdated,self)}),boardSettings.bind({fields:["page"],listener:self,callback:function(r){self.fire("page.changed",_.deepClone(r.page))}}),boardSettings.get({fields:["zoomLevel"],callback:_.bind(self.onZoomLevelReady,self)})},normalizeZoomLevel:function(zoomLevel){return Math.max(1,Math.min(6,zoomLevel))},"bus before_model.zoomLevelChanged":function(evt){var data=evt.data;data.zoomLevel=this.normalizeZoomLevel(data.zoomLevel)},"bus definition.ready":function(evt){var page=evt.data.page;this.fire("page.ready",_.deepClone(page))},onZoomLevelUpdated:function(zoomLevel){zoomLevel.name||this.fire("model.zoomLevelChanged",zoomLevel)},onZoomLevelReady:function(zoomLevel){this.fire("model.zoomLevelChanged",zoomLevel)}})});
define('tau/models/board.plus/model.board.plus.grid',["Underscore","tau/models/board.plus/model.board.plus"],function(_,BaseModel){return BaseModel.extend({requestSpace:function(definition,configurator,acid){var self=this,hasX=self.isConfigured(definition.x),hasY=self.isConfigured(definition.y),$spaceDeferred=$.Deferred(),processSpace=function(space){var response={viewMode:"board",definition:definition,zoomLevel:definition.zoomLevel||3};if(space&&space.data){var axesData={};_.forEach(space.data.axes.items,function(v){axesData[v.id]=v.name}),response.titleX=axesData[definition.x.types[0].toLowerCase()],response.titleY=axesData[definition.y.types[0].toLowerCase()]}$spaceDeferred.resolve(response)};return hasX&&hasY?configurator.getSliceFactory().create({definition:{global:{acid:acid}}}).space().done(processSpace).fail(processSpace):processSpace({}),$spaceDeferred},requestSize:function(slice){var self=this,$deferred=$.Deferred(),processSize=function(r){var size=r?r.data:{x:0,y:0};$deferred.resolve(_.deepClone(size))};return slice.size().done(processSize).fail(processSize),$deferred},requestMarks:function(axisName,definition,slice){var self=this,$deferred=$.Deferred(),page=definition.page,completeCall=function(marks,isAxisConfigured,isFocusArgs){var result={},axisPagingObject=isAxisConfigured?self.getAxisPagingObject(axisName,marks.items,page):self.getAxisNullPagingObject();axisPagingObject.isNull=!isAxisConfigured,axisPagingObject.isFocus=!!isFocusArgs,result[axisName]=axisPagingObject,result["marks"+axisName.toUpperCase()]=axisPagingObject.data,$deferred.resolve(result)},askForMarks=function(){var axisArgs=self.getSlicePagingArgs(axisName,page);return definition.focus[axisName].length>0&&(axisArgs={id:{$in:definition.focus[axisName]}},page[axisName]=0),slice[axisName](axisArgs).fail(function(){completeCall({items:[]},!1,!1)})},processAxisResponse=function(marks,isFocusArgs){var isAxisConfigured=self.isConfigured(definition[axisName]);if(isFocusArgs&&marks&&marks.items){var items={};_.each(marks.items,function(item){_.each(definition.focus[axisName],function(v){v.toLowerCase()==item[axisName].toLowerCase()&&(items[v.toLowerCase()]=item)})}),marks.items=_.values(items),marks.items.length&&(page.size[axisName]=marks.items.length)}if(isAxisConfigured&&(!marks.items||marks.items.length===0)&&(page[axisName]>0||isFocusArgs)){var data={page:{},focus:{}};return page[axisName]=0,data.page[axisName]=0,isFocusArgs&&(data.focus[axisName]=[],definition.focus[axisName]=[]),askForMarks().done(function(marks){processAxisResponse(marks.data)}),self.fire("board.settings.silent.set",data),!1}completeCall(marks,isAxisConfigured,isFocusArgs)};return askForMarks().done(function(args){var isFocusArgs=!1;args&&args.command&&args.command.config&&args.command.config.hasOwnProperty("id")&&(isFocusArgs=!0),processAxisResponse(args.data,isFocusArgs)}),$deferred},"bus configurator.ready:last + onGetSliceInfo.execute + acid.ready:last":function(evt,configurator,slice,acid){var self=this,definition=_.deepClone(slice.config.definition),$space=self.requestSpace(definition,configurator,acid),$size=self.requestSize(slice),$x=self.requestMarks("x",definition,slice),$y=self.requestMarks("y",definition,slice);$.when($space,$x,$y).done(function(s,x,y){var info=self.publishSliceInfoEvent(s,x,y);$size.done(function(size){_.each(["x","y"],function(axisName){info[axisName].isFocus&&(size[axisName]=info[axisName].onPage)}),self.publishBoardPagingSettingsEvent(size,info)})})},"bus boardSettings.ready:last + board.settings.silent.set":function(evt,bs,$set){var boardSettings=bs.boardSettings;boardSettings.get({fields:["page","focus"],callback:function(r){var page=r.page||{},focus=r.focus||{},data={page:page,focus:focus};_.extend(page,$set.page),_.extend(focus,$set.focus),boardSettings.set({set:data,isSilent:!0})}})},"bus board.paging.settings:last + board.paging.settings.retrieve":function(evt){this.fire("board.paging.settings.retrieved",_.values(evt)[0].data)},"bus page.move.to+board.paging.settings:last + boardSettings.ready:last":function(evt){var boardSettings=evt["boardSettings.ready"].data.boardSettings,pageSettings=evt["board.paging.settings"].data,moveValue=evt["page.move.to"].data.direction,page=pageSettings.page;this.getPageMoveStrategy(page)[moveValue](),boardSettings.set({set:{page:page}})},"bus boardSettings.ready:last+page.switched":function(evt,bs,page){var boardSettings=bs.boardSettings;boardSettings.set({set:{page:page}})},publishSliceInfoEvent:function(space,x,y){_.extend(space,x),_.extend(space,y);var availableDirections={up:space.y.hasPrev,down:space.y.hasNext,left:space.x.hasPrev,right:space.x.hasNext};return space=_.extend(space,{availableDirections:availableDirections,page:{x:space.x.currentPage,y:space.y.currentPage}}),space.x.title=space.titleX,space.y.title=space.titleY,this.fire("model.sliceInfo.retrieved",space),space},publishBoardPagingSettingsEvent:function(size,info){var self=this;_.each(["x","y"],function(axisName){if(size[axisName]){var axis=info[axisName];axis.total=size[axisName],axis.totalPages=self.getPagesCountForAxis(size[axisName],axis.maxOnPage)}}),this.fire("board.paging.settings",info)},onGetSliceInfo:function(slice){this.fire("onGetSliceInfo.execute",slice)}})});
define('tau/models/board.plus/model.board.pages.preloading',["Underscore","./model.board.base"],function(_,baseModel){return baseModel.extend({})});
define('tau/models/board.plus/model.board.cell',["Underscore","jQuery","tau/core/event.emitter"],function(_,$,baseModel){return baseModel.extend({"bus slice.ready:last+model.get.cell.content":function(evt,evtSlice,evtCellContent){var self=this,slice=evtSlice.base,coords=evtCellContent;self.onGetCellContent(slice,coords)},onGetCellContent:function(slice,coords){var self=this,$skip=coords.from,$take=coords.to-coords.from+1,cfg={$take:self.generateExcessTake($take),$skip:$skip};coords.x!=="null"&&(cfg.x=coords.x),coords.y!=="null"&&(cfg.y=coords.y),slice.cell(cfg).done(function(r){var cellContent=r.data.items.length>0?r.data.items[0]:{},resp=self.preProcessCellResponse(cellContent,coords);self.fireCellBasicInfoRetrieved(resp)})},"bus model.get.cell.basicInfo":function(evt){var self=this,coords=evt.data;coords.x=coords.x||null,coords.y=coords.y||null,coords.x&&coords.y?(coords.x=coords.x.toString(),coords.y=coords.y.toString(),self.fire("model.get.cell.content",coords)):self.fire("model.get.axisCell.basicInfo",coords)},"bus model.sliceInfo.retrieved:last+model.get.axisCell.basicInfo":function(evt){var self=this,coords=evt["model.get.axisCell.basicInfo"].data,sliceInfo=evt["model.sliceInfo.retrieved"].data,isX=coords.hasOwnProperty("x"),isY=coords.hasOwnProperty("y"),axisName=coords.x?"X":"Y",marks=sliceInfo["marks"+axisName],cellContent=_(marks).find(function(item){var axis=axisName.toLowerCase();return item[axis]==coords[axis]});self.fireCellBasicInfoRetrieved({dataItem:cellContent,coords:coords})},fireCellBasicInfoRetrieved:function(dataItemCoords){var self=this,cellContent=dataItemCoords.dataItem;return self.fire("model.cell.basicInfo.retrieved",cellContent),cellContent.dynamic.items},"bus configurator.ready:last + acid.ready:last + before_model.cell.basicInfo.retrieved":function(evt,configurator,acid,cellData){var builder=configurator.getUrlBuilder();_.forEach(cellData.dynamic.items,function(item){var data=item.data;data.entityRef=builder.getNewViewUrl(_.asString(data.id),_.asString(data.type),acid)})},fireCardsDataReady:function(cardsDynamicItems){this.fire("model.cards.data.ready",{cards:cardsDynamicItems})},preProcessCellResponse:function(dataItem,coords){var cellData=_.defaults(dataItem,{dynamic:{items:[]},fixed:{items:[]},x:coords.x,y:coords.y}),cellPagingFixedItem=_(cellData.fixed.items).find(function(item){return item.type==="cellpaging"});if(cellPagingFixedItem){var $take=coords.to-coords.from+1,dynamicItems=cellData.dynamic.items;cellData.dynamic.items=dynamicItems.slice(0,$take),cellPagingFixedItem.data=cellPagingFixedItem.data||{},cellPagingFixedItem.data.nextOrderingValue=this.getNextOrderingValue($take,dynamicItems)}else coords.to=coords.from+(cellData.dynamic.items.length-1);return{dataItem:cellData,coords:coords}},getNextOrderingValue:function(index,dynamicItems){if(index>=dynamicItems.length)throw"DEBUG: index is out of range. To implement cell paging logic we must query more card items then show to user";return dynamicItems[index].orderingValue},generateExcessTake:function($take){return $take+Math.round($take/4)}})});
define('tau/models/board.plus/model.board.cell.freezable',["Underscore","jQuery","./model.board.cell"],function(_,$,baseModel){return baseModel.extend({"bus start.lifecycle":function(evt){this.onGetCellContent=$.noop,this.fire("model.get.cell.basicInfo.dump",{dump:{}})},preProcessAggregatedCellItem:function(cellItem){var srcCoords=cellItem.coords,srcItem=cellItem.dataItem,requestedLength=srcCoords.to-srcCoords.from+1,actualLength=srcItem.dynamic.items.length;if(actualLength<=requestedLength)return cellItem;var cellPaging=_(srcItem.fixed.items).find(function(item){return item.type="cellpaging"});if(cellPaging)return cellItem=this.preProcessCellResponse(srcItem,srcCoords),cellItem;var isExceed25Rule=actualLength>this.generateExcessTake(requestedLength);return isExceed25Rule&&(srcItem.fixed.items.push({type:"cellpaging"}),cellItem=this.preProcessCellResponse(srcItem,srcCoords)),cellItem},processResponse:function(r,dump,dumpValues){var cells=r.data.items;for(var k=0,len=cells.length;k<len;k++){var cell=cells[k],key=this.getKey(cell);dump.hasOwnProperty(key)&&_.extend(dump[key].dataItem,cell)}var cardsData=[];for(var v=0;v<dumpValues.length;v++){var dumpValue=this.preProcessAggregatedCellItem(dumpValues[v]),filteredCards=this.fireCellBasicInfoRetrieved(dumpValue);cardsData=cardsData.concat(filteredCards)}this.fireCardsDataReady(cardsData)},getKey:function(cell){var x=cell.x||"null",y=cell.y||"null";return x+"_"+y},"bus model.cells.content.loaded+model.cards.data.ready":function(evt){var self=this;delete self.onGetCellContent},"bus model.cells.content.loaded+model.get.cell.basicInfo.dump:last+model.get.cell.basicInfo.end":function(evt){var dump=evt["model.get.cell.basicInfo.dump"].data.dump,dumpValues=_.values(dump),data=evt["model.cells.content.loaded"].data;this.processResponse(data,dump,dumpValues)},"bus slice.ready:last+model.get.cell.basicInfo.dump:last+model.get.cell.basicInfo.end":function(evt){var dump=evt["model.get.cell.basicInfo.dump"].data.dump,dumpValues=_.values(dump),self=this,x={},y={},$takeMax=0;_.each(dumpValues,function(dv){var requestedCount=dv.coords.to-dv.coords.from+1;$takeMax<requestedCount&&($takeMax=requestedCount);var v=dv.dataItem;v.x&&v.x!="null"&&(x[v.x]=1),v.y&&v.y!="null"&&(y[v.y]=1)}),x=_.keys(x),y=_.keys(y);var $query={};x.length&&($query.x={$in:x}),y.length&&($query.y={$in:y}),$query.$skip=0,$query.$take=self.generateExcessTake($takeMax),self.fire("model.execute.cell.query",{query:$query})},"bus slice.ready:last+model.execute.cell.query":function(evt,evtSlice,evtCellQuery){var slice=evtSlice.base,$query=evtCellQuery.query,self=this;slice.cell($query).done(function(r){self.fire("model.cells.content.loaded",r)}).fail(function(r){self.fire("model.cells.content.loaded",{data:{items:[]}})})},"bus model.get.cell.basicInfo.dump:last+model.get.cell.basicInfo":function(evt){var dump=evt["model.get.cell.basicInfo.dump"].data.dump,coords=evt["model.get.cell.basicInfo"].data;if(!coords.x||!coords.y)return;var content={x:coords.x.toString(),y:coords.y.toString(),dynamic:{items:[]},fixed:{items:[]}};dump[this.getKey(content)]={dataItem:content,coords:coords}}})});
define('tau/ui/extensions/board.plus/ui.board.plus.layout',["Underscore","jQuery","tau/core/class"],function(_,$,Class){var Board=Class.extend({setConfig:function(config){this.config=config,_.defaults(this.config,{useFixedColumnSizes:!1,columnSizes:{}}),this.setSizes(config.sizes)},setFixedColumnSize:function(d){var self=this;_.extend(this.config.columnSizes,d),_(d).chain().keys().each(function(k){var c=self.cols[k];c.extraWidth=0})},getFixedColumnSize:function(columnId){var self=this;if(!self.config.useFixedColumnSizes)return null;var c=self.cols[columnId],r=c.isCollapsed?null:this.config.columnSizes[columnId];return r=r||null,r},resolveColumnSize:function(columnId){var resolvedSize=this.getFixedColumnSize(columnId);if(!resolvedSize){var column=this.cols[columnId],$columnCell=column.items[0].$el,columnZoomLevel=this.getItemZoomLevelOrDefault(column.isCollapsed),zoomLevelCardWidth=this.getSizeInfo(columnZoomLevel).width;resolvedSize=$columnCell.width()/zoomLevelCardWidth}return Math.floor(resolvedSize)},setSizes:function(sizes){_.forEach(sizes,function(size){_.defaults(size,{cardsInRowMin:0,cardsInRowMax:99999,clientColsMin:99999,clientRowsMin:99999})}),this.config.sizes=sizes},getSizeInfo:function(zoomLevel){return this.config.sizes[zoomLevel]},setCurrentZoomLevel:function(zoomLevel){return zoomLevel=zoomLevel||this.currentZoom||1,zoomLevel in this.config.sizes||(zoomLevel=5),this.currentZoom=zoomLevel,this.currentZoom},getCurrentZoomLevel:function(){return this.currentZoom||1},getColumnsCount:function(){return _.keys(this.cols).length},getItemZoomLevelOrDefault:function(isCollapsed){return isCollapsed?"collapsed":this.getCurrentZoomLevel()},setElement:function($el){this.$el=$el,this.$grid=$el.find(".i-role-grid"),this.$headers=$el.find(".i-role-header"),this.cells=[],this.rows={},this.cols={},this.headerCells=[];var gridWidth=this.$grid.width(),scrollWidth=this.config.scrollY===!1?0:gridWidth-(this.$grid[0].clientWidth||gridWidth);this.padding=this.config.padding*2||14,this.scrollWidth=scrollWidth+this.padding,this.cellBorderWidth=0,this.initializeGridModel()},refreshElement:function(){this.setElement(this.$el)},initializeGridModel:function(){var $cells=this.$grid.find(".i-role-cell"),self=this;$cells.each(function(){var $cell=$(this),$cellHolder=$cell.parent();if($cellHolder.css("display")=="none")return;var isCollapsedByX=$cellHolder.hasClass("tau-collapsed_x"),isCollapsedByY=$cellHolder.hasClass("tau-collapsed_y"),data=$cell.data(),cellItem={$el:$cell,cardsNum:$cell.find(".i-role-card").length,isCollapsed:isCollapsedByX,data:data,width:null,height:null,isHidden:!1},cellColumn=self.cols[data.x];self.cols[data.x]=cellColumn?cellColumn:{x:data.x,items:[],_sizes:[],cardsNum:0,extraWidth:0,isCollapsed:isCollapsedByX};var cellRow=self.rows[data.y];self.rows[data.y]=cellRow?cellRow:{y:data.y,items:[],height:null,_sizes:[],cardsNum:0,isCollapsed:isCollapsedByY},self.cols[data.x].cardsNum+=cellItem.cardsNum,self.cols[data.x].items.push(cellItem),self.rows[data.y].cardsNum+=cellItem.cardsNum,self.rows[data.y].items.push(cellItem),self.cells.push(cellItem)});var createHeaderCellsIterator=function(axisName){var modelName=axisName==="x"?"cols":"rows",syncSize=axisName==="x"?"width":"height";return function(){var $cell=$(this);if($cell.parent().attr("data-is-hidden"))return;var data=$cell.data(),cell={$el:$cell,data:data,syncItem:self[modelName][data[axisName]],syncSize:syncSize};self.headerCells.push(cell)}};this.$headers.filter("[data-dimension=x]").find(".i-role-cell").each(createHeaderCellsIterator("x")),this.$headers.filter("[data-dimension=y]").find(".i-role-cell").each(createHeaderCellsIterator("y"))},updateSize:function(){this.calculateOptimalSize(),this.justifyWidth(),this.justifyHeight(),this.justifyHeightByHeader(),this.updateCells(),this.updateHeaders()},calculateOptimalSize:function(){var self=this,zoomLevel=self.getCurrentZoomLevel(),clientWidth=this.$grid[0].clientWidth||this.$grid.width(),clientHeight=this.$grid[0].clientHeight||this.$grid.height(),cardSizeInfo=self.getSizeInfo(zoomLevel),cardWidth=cardSizeInfo.width,cardHeight=cardSizeInfo.height,scrollWidth=this.scrollWidth,borderWidth=this.cellBorderWidth,currentRowsLength=_.values(this.rows).length||1,currentColsLength=_.values(this.cols).length||1,colMinWidth=clientWidth/Math.min(cardSizeInfo.clientColsMin,currentColsLength)-scrollWidth,cardsInRowMax=Math.floor((colMinWidth-scrollWidth-borderWidth)/cardWidth)||1,rowMinWidth=clientHeight/Math.min(cardSizeInfo.clientRowsMin,currentRowsLength),cardsInColMax=Math.floor(rowMinWidth/cardHeight),ratio=3,cells=this.cells;_.each(cells,function(cell){var cardSizeInfo=self.getSizeInfo(self.getItemZoomLevelOrDefault(cell.isCollapsed)),r=self.getCellResizeInfo(cell,ratio,cardsInRowMax,cardsInColMax,cardSizeInfo);cell.height=r.height,cell.cardsInCol=r.cardsInCol,cell.cardsInRow=r.cardsInRow}),_.each(self.rows,function(row){row.height=_.max(row.items,function(r){return r.height}).height,row.cardsInCol=_(row.items).chain().pluck("cardsInCol").max().value()}),_.each(self.cols,function(col){col.extraWidth=0,col.cardsInRow=_(col.items).chain().pluck("cardsInRow").max().value()}),_.each(cells,function(cell){cell.cardsInRow=self.cols[cell.data.x].cardsInRow,cell.height=self.rows[cell.data.y].height,cell.cardsInCol=self.rows[cell.data.y].cardsInCol})},getCellResizeInfo:function(cell,ratio,cardsInRowMax,cardsInColMax,cardSizeInfo){var self=this,cellCardsNum=cell.cardsNum,cardWidth=cardSizeInfo.width,cardHeight=cardSizeInfo.height,cardSpace=cardWidth*cardHeight,cardsInCell=cellCardsNum||1,cellWidth=Math.sqrt(cardsInCell*cardSpace/ratio),cardsInRow=null,fixedCardsSize=self.getFixedColumnSize(cell.data.x);fixedCardsSize!=null?cardsInRow=fixedCardsSize:(cardsInRow=_.min([Math.ceil(cellWidth/cardWidth),cardsInRowMax,cardSizeInfo.cardsInRowMax]),cardsInRow=_.max([cardsInRow,cardSizeInfo.cardsInRowMin]));var cardsInCol=Math.ceil(cardsInCell/cardsInRow);return self.config.scrollY!==!1&&(cardsInCol=Math.min(cardsInCol,cardsInColMax)),{height:cardsInCol*cardHeight,cardsInCol:cardsInCol,cardsInRow:cardsInRow}},getActualTableWidth:function(){var self=this;return 1+_.reduce(self.cols,function(memo,c){var colWidth=self.calculateColumnWidth(c);return memo+colWidth+1},1)},getTargetColumns:function(columns){var self=this,freeWidthColumns=_.filter(columns,function(c){var s=self.getFixedColumnSize(c.x);return s==null}),expandedColumns=_.filter(freeWidthColumns,function(col){return!col.isCollapsed}),r=expandedColumns.length!==0?expandedColumns:freeWidthColumns;return r},getZoomLevelCardWidth:function(zoomLevel,columns){var hasExpandedColumns=_.some(columns,function(c){return!c.isCollapsed}),selector=hasExpandedColumns?zoomLevel:"collapsed",cardSize=this.getSizeInfo(selector);return cardSize.width},justifyWidth:function(){var self=this,zoomLevel=self.getCurrentZoomLevel();if(_.values(this.rows).length==0)return;var clientWidth=this.$grid[0].clientWidth||this.$grid.width(),tableWidth=self.getActualTableWidth(),availableWidth=clientWidth-tableWidth;if(availableWidth<=0)return;var colsToResize=self.getTargetColumns(self.cols);if(colsToResize.length===0)return;var zoomLevelCardWidth=self.getZoomLevelCardWidth(zoomLevel,colsToResize),availableCards=Math.floor(availableWidth/zoomLevelCardWidth);if(availableCards>0){var koefs=self.distributionByCardsCount(colsToResize),incrementationByColumns=self.translateKoefsToAbsoluteIncrementors(colsToResize,koefs,availableCards);colsToResize=self.distributeCardsIncrementation(colsToResize,incrementationByColumns)}if(self.config.scrollY===!1){var extraWidth=clientWidth-self.getActualTableWidth();self.distributeExtraWidthToColumns(colsToResize,extraWidth)}},distributeCardsIncrementation:function(columns,incrementationByColumns){return _.each(columns,function(clmn,k){var cardsIncrementor=incrementationByColumns[k];_.each(clmn.items,function(cell){var cardsInRow=cell.cardsInRow+cardsIncrementor;cell.cardsInRow=cardsInRow,clmn.cardsInRow=cardsInRow})}),columns},translateKoefsToAbsoluteIncrementors:function(colsToResize,koefs,availableCards){var self=this,absoluteCardsIncrementation=[],lessCards=availableCards;_(colsToResize.length).times(function(k){absoluteCardsIncrementation[k]=0});while(lessCards>0){koefs=self._normalize(koefs);var freeCards=lessCards;_.each(koefs,function(koef,k){var cards=Math.min(lessCards,Math.round(freeCards*koef));absoluteCardsIncrementation[k]+=cards,lessCards-=cards}),koefs.pop()}return absoluteCardsIncrementation},distributionByCardsCount:function(columns){var totalCards=_.reduce(columns,function(memo,col){return memo+col.cardsNum},0);totalCards=totalCards||1;var allZeroKoefs=!0,koefs=_.map(columns,function(col){var k=col.cardsNum>0?_(col.items).chain().pluck("cardsNum").max().value()/totalCards:0;return k!=0&&(allZeroKoefs=!1),k});if(allZeroKoefs){var normalKoef=1/koefs.length;koefs=_.map(koefs,function(){return normalKoef})}return koefs},distributeExtraWidthToColumns:function(columns,totalExtraWidth){var self=this;if(totalExtraWidth>0){var columnsLength=columns.length||1,distribution=self._distribute(totalExtraWidth,columnsLength,Math.floor);_.each(columns,function(clmn,k){clmn.extraWidth=distribution[k]})}return columns},justifyHeight:function(){var zoomLevel=this.getCurrentZoomLevel(),cardSize=this.getSizeInfo(zoomLevel),cardHeight=cardSize.height,self=this;_.forEach(this.rows,function(row){row._sizes=[]}),_.forEach(this.cells,function(cell){var cardsInCol=cell.cardsInCol,realCardsInCol=Math.ceil(cell.cardsNum/cell.cardsInRow)||1;if(realCardsInCol<=cardsInCol){var cellHeight=cardHeight*realCardsInCol;cell.cardsInCol=realCardsInCol,cell.height=cellHeight}self.rows[cell.data.y]._sizes.push(cell.height)}),_.forEach(this.rows,function(row){row.height=Math.max.apply(null,row._sizes)}),_.forEach(this.cells,function(cell){cell.height=self.rows[cell.data.y].height})},justifyHeightByHeader:function(){var self=this;_.forEach(this.rows,function(row,y){row.minHeight=null;var header=_.find(self.headerCells,function(v){return v.data.y==y});header&&!header.isCollapsed&&(row.minHeight=header.$el.children().height())}),_.forEach(this.cells,function(cell){cell.minHeight=self.rows[cell.data.y].minHeight})},updateCells:function(){var self=this;_.each(self.cells,function(cell){var $cell=cell.$el;$cell.width(self.calculateCellWidth(cell)),cell.minHeight&&$cell.css("min-height",cell.minHeight)})},calculateCellWidth:function(cell){var self=this,clmn=self.cols[cell.data.x];return self.calculateColumnWidth(clmn)},calculateColumnWidth:function(clmn){var self=this,cardsInRow=clmn.cardsInRow,extraWidth=clmn.extraWidth,scrollWidth=self.scrollWidth,columnZoomLevel=self.getItemZoomLevelOrDefault(clmn.isCollapsed),cardWidth=self.getSizeInfo(columnZoomLevel).width;return cardsInRow*cardWidth+extraWidth+scrollWidth},updateHeaders:function(){var self=this,j=0;_.each(self.headerCells,function(cell,i){var $cell=cell.$el;if(cell.syncSize=="height"&&self.config.scrollY===!1){var data=cell.data,$tds=self.rows[data.y].items[0].$el.parent().parent().children(),hs=[];$tds.each(function(){var h=parseFloat(getComputedStyle(this).height,10);$.browser.msie&&i==self.headerCells.length-1&&(h=$(this).height()),hs.push(h)});var h=Math.max.apply(null,hs);$.browser.webkit&&(h=Math.round(h),h-=1),$cell.height(h),j++}else{var cellWidth=self.calculateCellWidth(cell);$cell.width(cellWidth)}})},_distribute:function(value,num,funcToDivide){var dist=[],less=value;funcToDivide=funcToDivide||Math.round;var part=funcToDivide(value/num);for(var i=0;i<num;i++)dist[i]=less?part:0,less-=part;return dist[dist.length-1]=dist[dist.length-1]+less,dist},_normalize:function(koefs){var norm=1/_.reduce(koefs,function(memo,num){return memo+num},0),normKoefs=_.map(koefs,function(num){return num*norm});return normKoefs}});return Board});
define('tau/ui/extensions/board.plus/ui.board.plus.decorator.columns-resize',["Underscore","jQuery"],function(_,$){return function(boardNode,settings){_.defaults(settings,{onResize:$.noop,resetTrigger:$.Deferred});var RESIZER_ACTIVATION_TIME=150,RESIZER_HIDE_TIME=150,RESIZE_BLOCK_TIME=150,resizeInProgress=!1,gridResizer={__$decreaser:$('<button type="button" class="tau-board-grid-resize-controls__btn tau-board-grid-resize-controls__decreaser">-</button>'),__$increaser:$('<button type="button" class="tau-board-grid-resize-controls__btn tau-board-grid-resize-controls__increaser">+</button>'),__$element:$('<div class="tau-board-grid-resize-controls tau-board-grid-resize-controls_trigger-type-"/>'),__onControlClick:function(evt){this.__deactivate(),this.hide(!0),resizeInProgress=!0,this.__$decreaser.is(evt.target)?grid.decreaseColSize(this.__showConfig.colIndex):this.__$increaser.is(evt.target)&&grid.increaseColSize(this.__showConfig.colIndex),setTimeout($.proxy(function(){resizeInProgress=!1},this),RESIZE_BLOCK_TIME)},__onMouseEnter:function(){this.__$element.removeClass("tau-board-grid-resize-controls_hiding"),this.__hideTimeoutId&&(clearTimeout(this.__hideTimeoutId),this.__hideTimeoutId=null)},__onMouseLeave:function(){this.__$element.addClass("tau-board-grid-resize-controls_hiding"),this.hide()},__activate:function(){this.__isActive||(this.__isActive=!0,this.__$element.addClass("tau-active"))},__deactivate:function(){this.__isActive&&(this.__isActive=!1,this.__$element.removeClass("tau-active"))},__setControlsPosition:function(){var offset=this.__showConfig.cursorY-this.__$element[0].getBoundingClientRect().top;this.__$element.children().css("top",offset)},show:function(config){this.__showConfig=config,this.__$decreaser.attr("disabled",null).removeClass("tau-board-grid-resize-controls__btn__disabled");var columnSize=settings.resolveColumnSize(config.x);1>=columnSize&&(this.__$decreaser.attr("disabled","disabled"),this.__$decreaser.addClass("tau-board-grid-resize-controls__btn__disabled")),this.__$element.attr("class",function(index,className){return className.replace(/(tau-board-grid-resize-controls_trigger-type-)\w*/g,"$1"+config.triggerType)}),grid.showResizer(this.__$element,config.position),this.__setControlsPosition(),this.__activateTimeoutId||(this.__activateTimeoutId=setTimeout(this.__getActivateTimeoutProxy(),RESIZER_ACTIVATION_TIME))},__activateTimeout:function(){this.__activateTimeoutId=null,this.__activate()},__getActivateTimeoutProxy:function(){return this.__showTimeoutProxy||(this.__showTimeoutProxy=$.proxy(this,"__activateTimeout")),this.__showTimeoutProxy},hide:function(instantly){this.__activateTimeoutId?(clearTimeout(this.__activateTimeoutId),this.__activateTimeoutId=null,this.__hideTimeout()):instantly?this.__hideTimeout():this.__hideTimeoutId||(this.__hideTimeoutId=setTimeout(this.__getHideTimeoutProxy(),RESIZER_HIDE_TIME))},__hideTimeout:function(){this.__hideTimeoutId=null,this.__deactivate(),grid.hideResizer(this.__$element)},__getHideTimeoutProxy:function(){return this.__hideTimeoutProxy||(this.__hideTimeoutProxy=$.proxy(this,"__hideTimeout")),this.__hideTimeoutProxy},tryHide:function(testCallback){testCallback(this.__$element)&&this.hide()},init:function(){return this.__$element.append(this.__$decreaser,this.__$increaser),this.__$element.on({click:$.proxy(this,"__onControlClick"),mouseenter:$.proxy(this,"__onMouseEnter"),mouseleave:$.proxy(this,"__onMouseLeave")}),this}}.init(),gridResizeTrigger={__$element:$('<span class="tau-board-grid-resize-trigger"></span>'),__$triggerA:$('<div class="tau-board-grid-resize-trigger__a"/>'),__$triggerB:$('<div class="tau-board-grid-resize-trigger__b"/>'),__getColIndex:function(){return this.__$element.closest(".i-role-cellholder").index()},__getResizerConfig:function(evt){var config=null,trigger=evt.target,$currCellHolder=this.__$element.closest(".i-role-cellholder");if(this.__$triggerA.is(trigger)){var $prevCellHolder=$currCellHolder.prev(),prevX=$prevCellHolder.data("x");config={x:prevX,position:this.__$triggerA[0].getBoundingClientRect().left,colIndex:$prevCellHolder.index(),triggerType:"a"}}else if(this.__$triggerB.is(trigger)){var currX=$currCellHolder.data("x");config={x:currX,position:this.__$triggerB[0].getBoundingClientRect().left,colIndex:this.__getColIndex(),triggerType:"b"}}return config.cursorY=evt.clientY,config},__onMouseEnter:function(evt){resizeInProgress||gridResizer.show(this.__getResizerConfig(evt))},__onMouseLeave:function(evt){resizeInProgress||gridResizer.tryHide(function($resizer){return!($(evt.relatedTarget).closest($resizer).size()>0)})},attachTo:function(cellNode){gridResizer.hide();var $cellHolderNode=$(cellNode).closest(".i-role-cellholder"),xh=$cellHolderNode.height(),index=$cellHolderNode.index(),COLLAPSED_CLASS="tau-collapsed_x",hideL=!1,hideR=!1;$cellHolderNode.hasClass(COLLAPSED_CLASS)&&(hideR=!0);if(index===0)hideL=!0;else if(index>0){var $parent=$cellHolderNode.parent(),$leftSibling=$parent.children().eq(index-1);$leftSibling.hasClass(COLLAPSED_CLASS)&&(hideL=!0)}var $a=this.__$triggerA,$b=this.__$triggerB;hideL?$a.hide():$a.show(),hideR?$b.hide():$b.show(),$a.height(xh),$b.height(xh),this.__$element.appendTo(cellNode)},detach:function(){gridResizer.hide(),this.__$element.detach()},init:function(){return this.__$element.append(this.__$triggerA,this.__$triggerB),this.__$element.on({mouseenter:$.proxy(this,"__onMouseEnter"),mouseleave:$.proxy(this,"__onMouseLeave")}),this}}.init(),grid={__toGridCoordinates:function(position){var $grid=this.__$element.find(".i-role-grid"),coordinate=position-this.__$element[0].getBoundingClientRect().left,gridPosition=$grid.position(),leftBorder=gridPosition.left,gridWidth=$grid[0].clientWidth||$grid.width(),rightBorder=leftBorder+gridWidth-8,DELTA=20,shift=0;return Math.abs(leftBorder-coordinate)<DELTA?shift=1:Math.abs(rightBorder-coordinate)<DELTA&&(shift=-1),{coordinate:coordinate,shift:shift}},increaseColSize:function(colIndex){var $cell=this.__$element.find(".tau-cols-header, .tau-grid").find(".tau-cellholder:nth-child("+(colIndex+1)+") .tau-cell").eq(0);settings.onResize({type:"+",x:$cell.data("x")})},decreaseColSize:function(colIndex){var $cell=this.__$element.find(".tau-cols-header, .tau-grid").find(".tau-cellholder:nth-child("+(colIndex+1)+") .tau-cell").eq(0);settings.onResize({type:"-",x:$cell.data("x")})},showResizer:function($resizer,position){var c=this.__toGridCoordinates(position),gridCoordinates=c.coordinate,map={0:"",1:"tau-board-grid-resize-controls__btn__right-shift","-1":"tau-board-grid-resize-controls__btn__left-shift"};$resizer.removeClass(map[1]).removeClass(map["-1"]).addClass(map[c.shift]),$resizer.css("left",gridCoordinates).appendTo(this.__$element.find(".i-role-board-body"))},hideResizer:function($resizer){$resizer.detach()},init:function($node){return this.__$element=$node.find(".tau-board-grid-view"),this.__$element.on({mouseenter:function(){var $cellHolder=$(this);if(!settings.isAvailable())gridResizeTrigger.detach();else{var $cellNode=$cellHolder.find(".i-role-cell");gridResizeTrigger.attachTo($cellNode.get(0))}}},".i-role-grid .i-role-cellholder"),settings.resetTrigger.progress(function(){gridResizeTrigger.detach()}),this}}.init(boardNode)}});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.layout',["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.layout","tau/ui/extensions/board.plus/ui.board.plus.decorator.columns-resize"],function($,ExtensionBase,BoardLayout,ColumnResizeDecorator){return ExtensionBase.extend({resetLifecycle:!0,isFixedSizeApplicable:function(boardLayout){var zl=boardLayout.getCurrentZoomLevel(),cc=boardLayout.getColumnsCount();return zl>1&&zl<6&&cc>1},updateFixedColumnSize:function(bsApi,params,callback){bsApi.get({fields:["columnSizes"],callback:function(r){_.defaults(r,{columnSizes:{}}),r.columnSizes[params.x]=params.size,callback({col:params.x,size:params.size}),bsApi.set({set:{columnSizes:r.columnSizes}})}})},applyColumnResizeDecorator:function($node,boardLayout,boardSettings,bsApi){var self=this,$d=$.Deferred();self.on("resize.executed",$d.notify);var decoratorInstance=ColumnResizeDecorator($node,{resetTrigger:$d,isAvailable:function(){return self.isFixedSizeApplicable(boardLayout)},resolveColumnSize:function(columnId){return boardLayout.resolveColumnSize(columnId)},onResize:function(params){var size=this.resolveColumnSize(params.x),t=params.type;t==="+"&&++size,t==="-"&&--size,params.size=size,self.updateFixedColumnSize(bsApi,params,function(p){var d={};d[p.col]=p.size,boardLayout.setFixedColumnSize(d)})}});return bsApi.bind({fields:["columnSizes"],listener:self,callback:function(r){self.triggerResize({})}}),decoratorInstance},"bus start.lifecycle + boardSettings.ready + overview.board.ready + view.dom.ready":function(evt,init,bs,overview,domReady){var self=this,boardSettings=this.boardSettings=bs.boardSettings,$el=overview.element,fontSize=$el.css("fontSize")||16,r=parseFloat(fontSize),px=this.px=function(em){var base=Math.round(r);return em*base},padding=px(.5),boardLayout=new BoardLayout;boardSettings.get({fields:["focus","zoomLevel","cells","columnSizes"],callback:function(res){var focus=res.focus||{},isInFocusMode=focus.x&&focus.x.length>0,columnSizes=isInFocusMode?{}:res.columnSizes;boardLayout.setConfig({columnSizes:columnSizes,sizes:self._getSizes(px,res.cells.types),padding:padding,scrollY:!1}),boardLayout.setElement($el),boardLayout.setCurrentZoomLevel(res.zoomLevel),isInFocusMode||self.applyColumnResizeDecorator($el,boardLayout,res,boardSettings),self.fire("boardLayout.ready",boardLayout),self.triggerResize({refreshElement:!0})}})},triggerResize:function(args){this.fire("resize.executed",args)},"bus initialize":function(evt){var configurator=evt.data.context.configurator,self=this;$(configurator.getWindow()).bind("resize.board",function(){self.triggerResize({})})},"bus boardSettings.ready":function(evt){var boardSettings=evt.data.boardSettings,self=this;boardSettings.unbind({listener:self}),boardSettings.bind({fields:["zoomLevel"],listener:this,callback:function(res){self.triggerResize({zoomLevel:res.zoomLevel})}}),boardSettings.bind({fields:["edit"],listener:this,callback:function(res){self.fire("view.edit.applied")}}),boardSettings.bind({fields:["cells"],listener:this,callback:function(res){self.fire("cells.changed")}})},"bus view.edit.applied":function(evt){var self=this;setTimeout(function(){self.triggerResize({})},1)},"bus view.card.batch.move.completed":function(){this.triggerResize({onlyHeaders:!0})},"bus view.card.batch.move":function(){this.triggerResize({onlyHeaders:!0})},"bus view.card.drag.changed":function(){this.triggerResize({onlyHeaders:!0})},"bus view.axis.collapser.executed.after":function(){this.triggerResize({refreshElement:!0})},"bus view.cell.skeleton.updated":function(e){this.triggerResize({})},"bus boardLayout.ready:last > resize.executed":function(evt,boardLayout,config){boardLayout.setSizes(this._getSizes(this.px,this.boardSettings.settings.cells.types));var self=this;_.defaults(config,{onlyHeaders:!1,refreshElement:!1,zoomLevel:boardLayout.getCurrentZoomLevel()}),boardLayout.setCurrentZoomLevel(config.zoomLevel),boardLayout.config.useFixedColumnSizes=self.isFixedSizeApplicable(boardLayout),config.refreshElement&&boardLayout.refreshElement(),config.onlyHeaders?boardLayout.updateHeaders():boardLayout.updateSize(),config.onlyHeaders||(self.fire("board.size.updated",{element:boardLayout.$el}),self.fire("board.layout.updated",{element:boardLayout.$el})),self.fire("resize.completed",config),self.fire("overview.board.updated",boardLayout.$el)},"bus overview.board.ready:last+overview.board.retrieve":function(evt){var $el=_.values(evt)[0].data.element;this.fire("overview.board.retrieved",$el)},"bus boardSettings.ready:last+destroy":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings;boardSettings.unbind({listener:this})},"board initialize:last+destroy":function(evt){var configurator=_.values(evt)[0].data.context.configurator;$(configurator.getWindow()).unbind("resize.board")},_getSizes:function(px,cells){var isProj=_.contains(cells,"project"),isTeam=_.contains(cells,"team"),isUser=_.contains(cells,"user"),sizes={collapsed:{width:px(1.35),height:px(1.35),cardsInRowMax:3,cardsInRowMin:3},1:{width:px(1.35),height:px(1.35),cardsInRowMax:3,cardsInRowMin:3,clientColsMin:5,clientRowsMin:5},2:{width:px(6.6),height:px(1.9+.3+.3),clientColsMin:2,clientRowsMin:2},3:{width:px(6.8),height:px(3.4),clientColsMin:2,clientRowsMin:2},4:{width:px(12.3+.3),height:px(6.4),clientColsMin:2,clientRowsMin:2},5:{width:px(14.3+.3),height:px(5.9),clientColsMin:2,clientRowsMin:2},6:{width:408,height:67,clientColsMin:2,clientRowsMin:2}};if(isProj||isTeam){sizes[2]={width:px(3.3+.3),height:px(1.9+.3+.3),clientColsMin:2,clientRowsMin:2};var w=isProj?9.25:10.8125;sizes[3]={width:px(.675+w+.375+.3),height:px(3.4),clientColsMin:2,clientRowsMin:2},sizes[4]={width:px(12.925+.3),height:px(8.25),clientColsMin:2,clientRowsMin:2},sizes[5]={width:px(20.1625),height:px(9),clientColsMin:2,clientRowsMin:2}}return isUser&&(sizes[2]={width:px(2.05+.3),height:px(5.9),clientColsMin:2,clientRowsMin:2},sizes[6]={width:px(14.3+.3),height:px(5.9),clientColsMin:2,clientRowsMin:2}),_.forEach(sizes,function(v){v.width=Math.ceil(v.width),v.height=Math.ceil(v.height)}),sizes}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.dom.updater.board',["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function($,_,ExtensionBase){return ExtensionBase.extend({"bus view.skeleton.built":function(evt){var $element=evt.data.element;$element.children().css({opacity:0})},"bus page.ready > page.changed":function(evt){var from=_.values(evt)[0].data,to=_.values(evt)[1].data,direction=this.getDirection(from,to);this.fire("refresh",{page:{from:from,to:to,direction:direction}})},"bus refresh > board.element.updated":function(evt){var refreshData=evt.refresh.data||{},elementsData=evt["board.element.updated"].data,$oldElement=elementsData.oldElement,$newElement=elementsData.newElement,parent=$oldElement.parent();parent.append($newElement),refreshData.page&&refreshData.page.direction?this.fire("page.appended",{prev:$oldElement,next:$newElement,data:refreshData.page}):this.fire("board.reload",{prev:$oldElement,next:$newElement})},"bus board.element.updated > refresh":function(evt,data){data.oldElement.hide().remove()},"bus afterRender:last > refresh":function(evt,data,refreshData){if(refreshData&&refreshData.page&&refreshData.page.direction)return;data.element.addClass("tau-board-becomes-old")},"bus board.reload > no.data.in.slice":function(evt,data){var $oldElement=data.prev;$oldElement.hide().removeClass("tau-board-becomes-old").replaceWith(data.next)},"bus board.reload > overview.board.ready > board.size.updated":function(evt,data){var $oldElement=data.prev;$oldElement.hide().removeClass("tau-board-becomes-old").replaceWith(data.next)},"bus page.appended > overview.board.ready > board.size.updated":function(evt){var pages=_.values(evt)[0].data,$oldElement=pages.prev,$newElement=pages.next;this.swap($oldElement,$newElement,pages.data.direction)},swap:function($oldBoard,$newBoard,direction){var controlProperty=this.directionToProperty(direction),animationProperties={};$(".tau-grid",$oldBoard).css("overflow","hidden"),$(".tau-grid",$newBoard).css("overflow","hidden"),animationProperties[controlProperty]="+=100%",$newBoard.css(controlProperty,"-100%"),$newBoard.children().css("opacity","1"),$oldBoard.add($newBoard).animate(animationProperties,{duration:750,complete:function(){$newBoard.css(controlProperty,""),$(".tau-grid",$newBoard).css({overflowY:"scroll",overflowX:"auto"}),setTimeout(function(){$oldBoard.remove()},50)}})},"bus refresh > overview.board.ready > board.size.updated":function(evt){var $element=evt["overview.board.ready"].data.element,refreshData=evt.refresh.data||{};(!refreshData.page||!refreshData.page.direction)&&$element.children().animate({opacity:1})},"bus initialize > overview.board.ready > board.size.updated":function(evt){var $element=evt["overview.board.ready"].data.element;$element.children().animate({opacity:1})},getDirection:function(pageFrom,pageTo){var direction=null;return pageFrom.x==pageTo.x?pageFrom.y-pageTo.y==1?direction="up":pageFrom.y-pageTo.y==-1&&(direction="down"):pageFrom.y==pageTo.y&&(pageFrom.x-pageTo.x==1?direction="left":pageFrom.x-pageTo.x==-1&&(direction="right")),direction},directionToProperty:function(direction){return{up:"top",down:"bottom",left:"left",right:"right"}[direction]}})});
define('tau/models/board.plus/model.board.dragndrop',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready + model.cells.metaInfo.ready":function(ev,configurator){var boardSettings=configurator.service("boardSettings");boardSettings.get({fields:["viewMode","cells","prioritization"],callback:_.bind(function(r){this.fire("viewMode.ready",r.viewMode),this.fire("cellsOrdering.ready",_.defaults(r.cells.ordering||{},{isDescending:!1})),this.fire("prioritizationSettings.ready",_.defaults(r.prioritization||{},{mode:"enabled"}))},this)}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["prioritization"],listener:this,callback:_.bind(function(r){this.fire("prioritizationSettings.ready",_.defaults(r.prioritization||{},{mode:"enabled"}))},this)})},"bus configurator.ready:last + viewMode.ready:last + cellsOrdering.ready:last + model.cells.metaInfo.ready:last + prioritizationSettings.ready":function(evt,configurator,viewMode,cellsOrdering,options,prioritizationSettings){options=_.clone(options),_.defaults(options,{enable:!1,isPrioritizable:!0,isBatch:!0,simpleCommands:[],commandName:null,prioritizationSettings:prioritizationSettings}),options.sortAfter=options.isPrioritizable,options.sortAfterDir=cellsOrdering.isDescending?"desc":"asc",prioritizationSettings.mode=="disabled"&&(options.isPrioritizable=!1),viewMode!=="list"&&options.simpleCommands.push("move"),options.isPrioritizable&&options.simpleCommands.push("prioritize"),options.simpleCommands.length&&(options.commandName=_.camelize(options.simpleCommands.join(" and "))),options.simpleCommands.length&&options.isBatch&&(options.commandName+="Batch"),options.commandName&&(options.enable=!0),options.isPrioritizable&&(options.isPrioritizable=options.prioritizationSettings.mode==="shift"?"shift":options.isPrioritizable),configurator.getGlobalBus().fire("isPrioritizable.ready",options.isPrioritizable),this.fire("dndOptions.ready",options||{})},"bus model.sliceInfo.retrieved":function(e,sliceInfo){var conditions={};_.forEach(["x","y"],function(dimName){conditions[dimName]=[],_.forEach(sliceInfo[dimName].data,function(item){var val=item[dimName];conditions[dimName].push(val)})}),this.fire("conditions.ready",conditions)},"bus conditions.ready:last + dndOptions.ready:last + viewMode.ready:last + slice.ready:last + shift.isPressed + view.card.batch.move":function(evt,conditions,options,viewMode,sliceData,isPressed,batch){var slice=sliceData.slice;options.isPrioritizable&&options.prioritizationSettings.mode==="shift"&&(isPressed?(options.simpleCommands=viewMode=="list"?["prioritize"]:["move","prioritize"],options.commandName=viewMode=="list"?"prioritizeBatch":"moveAndPrioritizeBatch"):viewMode!="list"&&(options.simpleCommands=["move"],options.commandName="moveBatch")),this.fire("shift.isPressed",isPressed);var command=this._prepareCommand(slice,batch,options,conditions);command(_.bind(function(result){this.fire("view.card.batch.move.after",result)},this))},_prepareParameters:function(batch,options,conditions){var parameters={},items=[];return _.forEach(batch,function(cardData){var source=cardData.source,target=cardData.target,item={itemId:source.entityId};_.include(options.simpleCommands,"move")&&(item=_.extend(item,{oldX:source.x,oldY:source.y,x:target.x,y:target.y})),_.include(options.simpleCommands,"prioritize")&&(item=_.extend(item,{beforeItemId:target.beforeEntityId||null,afterItemId:target.afterEntityId||null})),items.push(item)}),parameters.$set={items:items},conditions.x.length&&(parameters.x={$in:conditions.x}),conditions.y.length&&(parameters.y={$in:conditions.y}),parameters},_createSuccessMoveHandler:function(argOutput,argOptions,argCallback){return _.bind(function(output,options,callback,r){var responseItems=r.data.items;_.forEach(output,function(item,i){var cardMovements=responseItems[i].items;cardMovements.length===0&&cardMovements.push({x:"__x_not_in_slice__",y:"__y_not_in_slice__",dataItem:{id:item.sliceId,type:item.entityType,data:{id:item.entityId,type:item.entityType,name:""}}});var moves=_.map(cardMovements,function(move){var r={dataItem:move.dataItem};return _.include(options.simpleCommands,"move")&&(r.x=move.x,r.y=move.y),r});item.commands[options.commandName]={executed:!0,error:!1,result:moves}}),callback(output)},this,argOutput,argOptions,argCallback)},_createFailureMoveHandler:function(output,options,cb){return _.bind(function(output,options,cb,err){var errMessage=err?err.data.responseText.Message:"Error";_.forEach(output,function(item,i){item.commands[options.commandName]={executed:!0,error:errMessage,result:[]}}),cb(output)},this,output,options,cb)},_generateDefaultOutput:function(batch,options){var output=[];return _.forEach(batch,function(cardData,i){var uid=cardData.uid,source=cardData.source,target=cardData.target;output.push({sliceId:source.sliceId,targetX:target.x,targetY:target.y,entityType:source.entityType,entityId:source.entityId,elementId:source.elementId,uid:uid,commands:{}}),output[i].commands[options.commandName]={executed:!1,error:!1,result:[]}}),output},_prepareCommand:function(argSlice,argBatch,argOptions,argConditions){return argBatch=_.filter(argBatch,function(v){return v.source.sliceId}),_.bind(function(slice,batch,options,cb){var output=this._generateDefaultOutput(batch,options),params=this._prepareParameters(batch,options,argConditions);slice[options.commandName](params).done(this._createSuccessMoveHandler(output,options,cb)).fail(this._createFailureMoveHandler(output,options,cb))},this,argSlice,argBatch,argOptions)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.dragndrop',["Underscore","jQuery","tau/core/extension.base","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function(_,$,ExtensionBase,ProgressIndicator){return ExtensionBase.extend({resetLifecycle:!0,"bus $el.ready":function(ev,$el){var $headerX=$el.find(".i-role-header[data-dimension=x]"),$headerY=$el.find(".i-role-header[data-dimension=y]");this.fire("$headerX.ready",$headerX),this.fire("$headerY.ready",$headerY);var fire=_.bind(this.fire,this);fire("shift.isPressed",!1),$(document).on("keydown",function(e){e.which==$.ui.keyCode.SHIFT&&fire("shift.isPressed",!0)}),$(document).on("keyup",function(e){e.which==$.ui.keyCode.SHIFT&&fire("shift.isPressed",!1)})},"bus $selectable.ready":function(e,$selectable){this._$selectable=$selectable},"bus $el.ready:last + $grid.ready:last + $selectable.ready:last + viewMode.ready:last + dndOptions.ready":function(ev,$el,$grid,$selectable,viewMode,dndOptions){var self=this,$body=$el.find(".i-role-board-body"),$containment,$sortable;viewMode==="list"?($containment=$grid.find(".i-role-cellholder"),$sortable=$body):($containment=$grid.find("table"),$sortable=$grid),$sortable.data("tauSortable")&&($sortable.tauSortable("destroy"),$sortable.unbind("tausortablestart.board"),$sortable.unbind("tausortablechanged.board"),$sortable.unbind("tausortablegroupentered.board"),$sortable.unbind("tausortablegroupleft.board"),$sortable.unbind("tausortablestop.board"));if(!dndOptions.enable)return;var isPrioritizable=dndOptions.isPrioritizable;$sortable.tauSortable({groups:".i-role-grid .i-role-cellholder",items:".i-role-card",appendTo:$grid,containment:$containment,addClasses:!1,useSelectable:$selectable,moveInGroup:isPrioritizable,processToGroup:function($item,$fromGroup,$toGroup){var $targetPlace=$toGroup;$toGroup.is(".i-role-cellholder")&&($targetPlace=$toGroup.children(".i-role-cell")),$targetPlace.data("isempty",!0);if($fromGroup.is($targetPlace))return;$item.appendTo($targetPlace),self.cellHasCards($targetPlace)&&$targetPlace.data("isempty",!1)}}),self.fire("$sortable.ready",$sortable),$sortable.bind("tausortablestart.board",function(event,ui){ui.helper&&ui.helper.find(".i-role-card").removeClass("i-role-card"),ui.items.removeClass("i-role-card"),self.fire("sort.started",[event,ui])}),$sortable.bind("tausortablechanged.board",function(event,ui){self.fire("sort.changed",[event,ui])}),$sortable.bind("tausortablegroupentered.board",function(event,ui){self.fire("sort.groupentered",[event,ui])}),$sortable.bind("tausortablegroupleft.board",function(event,ui){self.fire("sort.groupleft",[event,ui])}),$sortable.bind("tausortablestop.board",function(event,ui){ui.items.addClass("i-role-card"),self.fire("sort.stopped",[event,ui])})},"bus options.ready:last+sort.started":function(ev,o,sortData){if(o.dragndrop.containmentRefreshTimeout){var ui=sortData[1],$dragged=$(ui.item);_.delay(function($dragged){$dragged&&$dragged.data("draggable")&&$dragged.data("draggable")._setContainment()},o.dragndrop.containmentRefreshTimeout,$dragged)}},"bus $sortable.ready:last+sort.changed":function(){this.fire("view.card.drag.changed")},"bus $sortable.ready:last+$headerX.ready:last+$headerY.ready:last+sort.groupentered":function(ev,$sortable,$headerX,$headerY,sortData){var ui=sortData[1];ui&&ui.group&&this.highlightTarget($sortable,ui.group,$headerX,$headerY),this.fire("view.card.drag.changed")},"bus $sortable.ready:last+$headerX.ready:last+$headerY.ready:last+sort.groupleft":function(ev,$sortable,$headerX,$headerY,sortData){var ui=sortData[1];ui&&ui.group&&this.unhighlightTarget($sortable,ui.group,$headerX,$headerY),this.fire("view.card.drag.changed")},"bus $sortable.ready:last+$headerX.ready:last+$headerY.ready:last+sort.stopped":function(ev,$sortable,$headerX,$headerY,sortData){var ui=sortData[1];ui&&ui.group&&this.unhighlightTarget($sortable,ui.group,$headerX,$headerY)},"bus sort.stopped":function(ev,sortData){var ui=sortData[1];if(!ui.item)return;var items=_.map(ui.items,function(card){return $.data(card,"boardDnd")});items=_.sortBy(items,function(item){return item.order}),this.fire("view.card.batch.move",items)},"bus configurator.ready:last + domWrapper.ready:last + dndOptions.ready:last + view.card.batch.move.after":function(e,configurator,domWrapper,dndOptions,moveResponse){var self=this,groups=self.unpackMovementResponse(moveResponse,domWrapper),targetCellCoordinates={x:moveResponse[0].targetX,y:moveResponse[0].targetY},$errorCards=$();_.forEach(groups.error,function(r){$errorCards=$errorCards.add(r.$card),domWrapper.animateWithClass(r.$card,"tau-card_failed"),self.fire("error",{message:r.error})}),self.restoreErrorCardsPositions($errorCards).pipe(_.bind(function(){return this.processCardsPositions(groups,targetCellCoordinates,domWrapper,configurator)},this)).pipe(_.bind(function(dr){var limit=configurator.getSliceFactoryOptions().options.DnDTurnOffCometWhenItemsCountExceed,cards=dr.cards||[];return cards.length>limit&&_.forEach(cards,function($node){domWrapper.animateWithClass($node,"tau-card_highlighted")}),_.forEach(dr.$affectedCells,_.bind(function(cell){var $cell=$(cell);$cell.data("isempty")&&domWrapper.expandCell(this,$cell.data("x"),$cell.data("y"))},this)),dr},this)).pipe(_.bind(function(dr){if(!dndOptions.sortAfter)_.forEach(dr.cards,function($card){var $ch=$card.parents(".i-role-cell:first"),$c=domWrapper.getUnsortedCardsHolder($ch);$c.length||($c=$ch),!$card.prev(".i-role-card").length&&!$card.next(".i-role-card").length&&$c.append($card)});else{var comp=function(a,b){return dndOptions.sortAfterDir=="desc"?a>b:a<b};_.forEach(dr.cards,function($card){var ov=parseFloat($card.data("orderingValue")),$ch=$card.parents(".i-role-cell:first"),$other=$ch.children(".i-role-card").not($card),$last=$other.last();if(!comp(parseFloat($last.data("orderingValue")),ov)){var $o=$other.filter(function(k,c){return comp(parseFloat($(c).data("orderingValue")),ov)});$o.length?$o.last().after($card):$card.prependTo($ch)}else if($other.length){var $c=domWrapper.getUnsortedCardsHolder($ch);$c.length||($ch.find(".i-role-cell-paging-stack").length?$c=domWrapper.createUnsortedCardsHolder().appendTo($ch):$c=$ch),$c.append($card)}})}return dr.cards||[]},this)).done(_.bind(function(cards){this.completeEventsProtocol(cards),this.fire("view.card.batch.move.finished",{})},this))},"bus view.skeleton.built:last + view.card.batch.move":function(e,skeleton){ProgressIndicator.get(skeleton.element).show({hover:!0,delay:2e3})},"bus view.skeleton.built:last + view.card.batch.move.after":function(e,skeleton){ProgressIndicator.get(skeleton.element).hide()},"bus configurator.ready:last + view.card.batch.move.$successCards":function(e,configurator,cards){var limit=configurator.getSliceFactoryOptions().options.DnDTurnOffCometWhenItemsCountExceed;cards.length>limit&&this.fire("refresh")},processCardsPositions:function(groups,targetCellCoordinates,domWrapper,configurator){var def=$.Deferred(),limit=configurator.getSliceFactoryOptions().options.DnDTurnOffCometWhenItemsCountExceed,successMoveResponse=groups.success,len=successMoveResponse.length;if(!len)def.resolve({});else{var updates=this.extractBatchesUpdates(successMoveResponse);domWrapper.applyCardsBatchMove({targetCellCoordinates:targetCellCoordinates,options:{suspendAnimation:len>limit},items:updates}).done(function(dr){def.resolve(dr)})}return def},extractBatchesUpdates:function(successMoveResponse){var r=[];for(var i=0,len=successMoveResponse.length;i<len;i++){var cardData=successMoveResponse[i],adapted=_(cardData.moves).map(function(move){return{x:move.x,y:move.y,data:move.dataItem}});adapted.length&&adapted[0].data.data&&r.push(adapted)}return r},completeEventsProtocol:function($successCardsArray){this.fire("view.card.batch.move.$successCards",$successCardsArray),this.fire("view.card.batch.move.completed",$successCardsArray),$successCardsArray.length&&this.fire("selection.reapply",{})},restoreErrorCardsPositions:function($errorCards){var def=$.Deferred(),self=this,errorCards=_.sortBy($errorCards.toArray(),function(card){var prevData=$(card).data("boardDnd").source||{};return prevData.index}),fs=_.map(errorCards,function(card){return function(next){var $card=$(card),prevData=$card.data("boardDnd").source||{},$cell=$("#"+prevData.cellElementId);if(prevData.beforeElementId){var $beforeEl=$cell.find("#"+prevData.beforeElementId);$beforeEl.length?$card.insertAfter($beforeEl):$card.prependTo($cell)}else $card.prependTo($cell);self._$selectable.tauSelectable("select",$card),errorCards.length==1&&self._$selectable.tauSelectable("raiseChanged",$card,!0,!0),next()}});return fs=_.map(fs,function(f){return function(next){f(next)}}),_.series(fs,function(){def.resolve()}),def},toggleTarget:function($grid,$cell,$headerX,$headerY,toggle){var targetClassName="tau-cellholder_dndtarget_true",className="tau-cellholder_dndcrossing_true";if(!$grid.find($cell).length)return;var xIndex=$cell.index()+1,$col=$grid.find("tr > .i-role-cellholder:nth-child("+xIndex+")").not($cell),$row=$cell.siblings();$row.length>0&&($col.toggleClass(className,toggle),$headerX.length&&$headerX.find(".i-role-cellholder:nth-child("+xIndex+")").toggleClass(className,toggle)),$col.length>0&&($row.toggleClass(className,toggle),$headerY.length&&$headerY.find(".i-role-cellholder[data-y="+$cell.data("y")+"]").toggleClass(className,toggle));var rl=$row.length>0,cl=$col.length>0;rl&&cl?$cell.toggleClass(targetClassName,toggle):(rl||cl)&&$cell.toggleClass(className,toggle)},cellHasCards:function(cell){var children=$(cell).children(".i-role-card");return children.size()>0},highlightTarget:function($grid,$cell,$headerX,$headerY){this.toggleTarget($grid,$cell,$headerX,$headerY,!0)},unhighlightTarget:function($grid,$cell,$headerX,$headerY){this.toggleTarget($grid,$cell,$headerX,$headerY,!1)},assignResponseItemUID:function(rItem){var responseItemUID=rItem.uid;return _.forEach(rItem.commands,function(cmd){cmd.result=_.map(cmd.result,function(move){return move.uid=responseItemUID,move})}),rItem},unpackMovementResponse:function(response,domWrapper){var self=this,$cards=domWrapper.getCards(),groups={error:[],success:[]};for(var i=0,len=response.length;i<len;i++){var rItem=response[i];rItem=self.assignResponseItemUID(rItem);var commands=_.chain(_.values(rItem.commands));rItem.error=commands.pluck("error").compact().value().join(" ")||null,rItem.moves=commands.pluck("result").concat().compact().value()||[];var prop=rItem.error?"error":"success";rItem.$card=$cards.filter("#"+rItem.elementId),groups[prop].push(rItem)}return groups}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.selection.board',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({resetLifecycle:!0,"bus configurator.ready":function(ev,configurator){var self=this,clipboardManager=configurator.getClipboardManager();clipboardManager.getAll(function(err,cards){self.fire("cardsData.ready",{cards:cards,isInitial:!0})}),clipboardManager.unbind(this),clipboardManager.bind(this,function(err,cards){self.fire("cardsData.ready",{cards:cards,isInitial:!1})})},"bus configurator.ready+options.ready":function(evt,configurator,o){var self=this,clipboardManager=configurator.getClipboardManager(),process=_.bind(function(clipboardManager,operation,card){clipboardManager[operation](card)},this,clipboardManager);o.clipboard.processTimeout&&(process=_.debounce(process,o.clipboard.processTimeout)),self.fire("clipboardProcess.ready",process)},"bus $grid.ready":function(ev,$grid){var self=this;$grid.tauSelectable({items:".i-role-card",triggerSelector:":not(.tau-id)",ctrl:!0,selectOnMouseup:!0,className:"tau-selected",changed:function(event,ui){var $item=ui.item,selected=ui.selected;self.fire("view.card.selected",{element:$item,selected:selected})}}),self.fire("$selectable.ready",$grid),$grid.rselect({trigger:".i-role-cellholder, .i-role-cell",selectionClass:"tau-selected",selectable:".tau-cellholder .tau-card",show:function(){$(this).pscroller("enable")},end:function(evt,data){$(this).pscroller("disable"),$grid.tauSelectable("option","fireEvents",!1),$grid.tauSelectable("select",$(data.selection)),$grid.tauSelectable("option","fireEvents",!0),self.fire("view.card.selected",{element:$(data.selection),selected:!0}),self.fire("view.card.selected",{element:$(data.deselection),selected:!1})}})},"bus scrollManager.ready:last+$selectable.ready:last+view.card.selected":function(evt,scrollManager,$selectable,selectionData){var $layout=$selectable.closest(".tau-app-main-pane"),clipboardIsCollapsed=!$layout.hasClass("tau-layout-board_south-expanded_true"),$card=selectionData.element;clipboardIsCollapsed&&selectionData.selected&&_.delay(function(){var clipboardIsUncollapsed=$layout.hasClass("tau-layout-board_south-expanded_true");clipboardIsUncollapsed&&$card.length==1&&scrollManager.scrollToVisibility($card)},1e3)},"bus view.cell.skeleton.updated":function(evt,o){this.fire("$selectionScope.ready",o.element.parents(".i-role-grid:first"))},"bus overview.board.ready":function(evt,o){this.fire("$selectionScope.ready",o.element.find(".i-role-grid"))},"bus $selectable.ready:last+$selectionScope.ready:last+cardsData.ready:last":function(ev,$selectable,$scope,cardsData){this._applySelection($selectable,$scope,cardsData.cards,cardsData.isInitial)},"bus $selectable.ready:last+$selectionScope.ready:last+cardsData.ready:last + selection.reapply":function(ev,$selectable,$scope,cardsData){this._applySelection($selectable,$scope,cardsData.cards,cardsData.isInitial)},"bus $selectable.ready:last+clipboardProcess.ready:last+view.card.selected":function(ev,$selectable,clipboardProcess,selection){var $cards=selection.element,isSelected=selection.selected,addBatch=[],removeBatch=[],$selected=$selectable.tauSelectable("getSelected");$cards.each(function(){var $card=$(this),data=_.pick($card.data(),"id","entityId","entityType"),$alreadySelected=$selected.filter(function(){var $o=$(this),oData=$o.data();return data.id==oData.id&&data.entityType.toLowerCase()==oData.entityType.toLowerCase()&&$o.attr("id")!=$card.attr("id")}),avatarUri=$card.find(".tau-avatar img").prop("src");avatarUri=avatarUri&&avatarUri.replace(/\d+$/,"");if($alreadySelected.length==0){var card={id:data.id,data:{id:data.entityId,type:data.entityType,name:$card.find(".i-role-name").text(),icon:$card.find(".tau-icon").data("icon"),color:$card.find(".i-role-color").data("color"),avatarUri:avatarUri}};isSelected?addBatch.push(card):removeBatch.push(card)}}),clipboardProcess("add",addBatch),clipboardProcess("remove",removeBatch)},"bus $selectable.ready:last + sort.stopped":function(ev,$selectable,sortData){var ui=sortData[1],$cards=ui.items||$();$selectable.tauSelectable("option","fireEvents",!1),$selectable.tauSelectable("reset",$cards),$selectable.tauSelectable("option","fireEvents",!0)},"bus clipboardProcess.ready:last+view.card.batch.move.$successCards":function(ev,clipboardProcess,$cardsArray){var cardsData=[];_($cardsArray).each(function($card){var data=_.pick($card.data(),"id","entityId","entityType"),card={id:data.id,data:{id:data.entityId,type:data.entityType}};cardsData.push(card)}),clipboardProcess("remove",cardsData)},"bus clipboardProcess.ready:last + operation.notinslice":function(e,clipboardProcess,op){this._cometRemove(clipboardProcess,op.items)},"bus clipboardProcess.ready:last + operation.deleted":function(e,clipboardProcess,op){this._cometRemove(clipboardProcess,op.items)},_cometRemove:function(clipboardProcess,items){var cardsData=_.map(items,function(item){var data=item.data;return{id:data.id,data:{type:data.type}}});clipboardProcess("remove",cardsData)},_applySelection:function($selectable,$scopedEl,cardsData,isInitial){var HIGHLIGHT_CSS_CLASS="tau-card_selectedasdouble_true",$markedAsSelected=$selectable.tauSelectable("getSelected").filter(function(){return $(this).parents().is($scopedEl)}),$shouldBeSelected=$(),$actualCards=$scopedEl.find(".i-role-card");$actualCards.removeClass(HIGHLIGHT_CSS_CLASS),_(cardsData).each(function(item){var $cardsToHighlight=$actualCards.filter(function(){var d=$(this).data();return item.data.id==d.entityId&&item.data.type.toLowerCase()==d.entityType.toLowerCase()});$cardsToHighlight.addClass(HIGHLIGHT_CSS_CLASS);var $cardsToSelect=$cardsToHighlight.filter(function(){return $markedAsSelected.is(this)});$cardsToSelect.length&&($cardsToHighlight=$cardsToSelect),isInitial&&($cardsToHighlight=$cardsToHighlight.eq(0)),$shouldBeSelected=$shouldBeSelected.add($cardsToHighlight)});var $shouldBeReset=$markedAsSelected.not($shouldBeSelected);$selectable.tauSelectable("option","fireEvents",!1),$selectable.tauSelectable("reset",$shouldBeReset),$selectable.tauSelectable("select",$shouldBeSelected),$selectable.tauSelectable("option","fireEvents",!0)}})});
define('tau/ui/extensions/board.plus/ui.board.plus.scrollManager',["jQuery","tau/core/class"],function($,Class){var ScrollManager=Class.extend({init:function(){this.$element=null},setElement:function(el){this.$element=$(el)},scrollToVisibility:function($item,options){var $grid=this.$element,$table=$grid.children("table");options=options||!1;var gridRect=$grid[0].getBoundingClientRect(),itemRect=$item[0].getBoundingClientRect();if(itemRect.bottom>=gridRect.bottom)if(options)$grid.scrollTo($item,options);else if($table.length){var tableRect=$table[0].getBoundingClientRect();$grid[0].scrollTop=Math.ceil(itemRect.top)-Math.ceil(tableRect.top)-Math.ceil(gridRect.height)+Math.ceil(itemRect.height)+20}options&&options.onAfter&&options.onAfter.call()}});return ScrollManager});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.scrollManager',["jQuery","tau/core/extension.base","tau/ui/extensions/board.plus/ui.board.plus.scrollManager"],function($,ExtensionBase,ScrollManager){return ExtensionBase.extend({"bus $el.ready+$grid.ready":function(evt,$el,$grid){var self=this,scrollManager=new ScrollManager;scrollManager.setElement($grid),self.fire("scrollManager.ready",scrollManager)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.scroll',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus $el.ready+$grid.ready":function(evt,$el,$grid){var self=this,$headerHorizontal=$el.find(".i-role-header[data-dimension=x]"),$headerHorizontalList=$headerHorizontal.find("ul"),$headerVertical=$el.find(".i-role-header[data-dimension=y]"),$headerVerticalList=$headerVertical.find("ul"),syncScroll=function(){return self.syncScroll($grid,$headerHorizontalList,$headerVerticalList)};$grid.bind({scroll:syncScroll});var speed=60,evtMap={mousewheel:function(evt,offset){var s=-$grid.scrollTop()+Math.round(offset*speed);$grid.scrollTop(-s),syncScroll()}};$headerVertical.bind(evtMap),$headerHorizontal.bind(evtMap),self.fire("syncScroll.ready",syncScroll),$grid.pscroller()},"bus syncScroll.ready:last + view.dom.ready":function(evt,syncScroll){syncScroll()},"bus syncScroll.ready:last + view.axis.collapser.executed.after":function(evt,syncScroll){syncScroll()},"bus $el.ready:last + $grid.ready:last + view.axis.collapser.executed.before":function(evt,$el,$grid){var $of,gridRect=$grid[0].getBoundingClientRect(),$firstVisible,$cells=$grid.find(".tau-cell");$cells.each(function(){var $cell=$(this),cellRect=this.getBoundingClientRect();cellRect.left=cellRect.left-1;if(cellRect.top>=gridRect.top&&cellRect.top<=gridRect.bottom&&cellRect.left>=gridRect.left&&cellRect.left<=gridRect.right)return $firstVisible=$cell,!1}),$firstVisible||$cells.each(function(){var $cell=$(this),cellRect=this.getBoundingClientRect();cellRect.left=cellRect.left-1;if(cellRect.top<=gridRect.top&&cellRect.bottom>=gridRect.top&&cellRect.left>=gridRect.left&&cellRect.left<=gridRect.right)return $firstVisible=$cell,!1}),$firstVisible||$cells.each(function(){var $cell=$(this),cellRect=this.getBoundingClientRect();cellRect.left=cellRect.left-1;if(cellRect.top>=gridRect.top&&cellRect.top<=gridRect.bottom&&cellRect.left<=gridRect.left&&cellRect.right>=gridRect.left)return $firstVisible=$cell,!1}),$firstVisible||$cells.each(function(){var $cell=$(this),cellRect=this.getBoundingClientRect();cellRect.left=cellRect.left-1;if(cellRect.top<=gridRect.top&&cellRect.bottom>=gridRect.top&&cellRect.left<=gridRect.left&&cellRect.right>=gridRect.left)return $firstVisible=$cell,!1}),$of=$firstVisible;if(!$of||!$of.length)return;var fromGrid=$of.position();fromGrid.top<0&&(fromGrid.top=0),fromGrid.left<0&&(fromGrid.left=0);var self=this,propScroll=_.bind(self.propScroll,self,$grid,$of,fromGrid);self.fire("propScroll.ready",propScroll)},"bus syncScroll.ready:last + resize.completed":function(evt,syncScroll){syncScroll()},"bus propScroll.ready > view.axis.collapser.executed.after > resize.completed":function(evt,propScroll){propScroll()},syncScroll:function($grid,$horizontal,$vertical){var offset={x:$grid.scrollLeft(),y:$grid.scrollTop()};$horizontal.length&&$horizontal.css("margin-left",-1*offset.x);if($vertical.length){var mt=-1*offset.y;$vertical.css("margin-top",mt)}},propScroll:function($grid,$of,fromGrid){var ofRect=$of[0].getBoundingClientRect(),tableRect=$grid.find("table:first")[0].getBoundingClientRect(),fromTable={top:ofRect.top-tableRect.top,left:ofRect.left-tableRect.left},s=0;$grid.parents(".i-browser_engine_ie").length&&(s=-1),$grid.parents(".i-browser_engine_webkit").length!=0;var offset={top:Math.round(fromTable.top)-Math.round(fromGrid.top)+s,left:Math.round(fromTable.left)-Math.round(fromGrid.left)};$grid.scrollTo(offset)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.hints',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus boardSettings.ready":function(evt,bs){var boardSettings=bs.boardSettings;boardSettings.get({fields:["zoomLevel"],callback:_.bind(function(r){this.fire("zoomLevel.ready",r.zoomLevel)},this)}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["zoomLevel"],listener:this,callback:_.bind(function(r){this.fire("zoomLevel.ready",r.zoomLevel)},this)})},"bus $grid.ready":function(evt,$grid){var $bubbled=$grid.tauBubble({className:"zoom-level-5 tau-cardtooltip",showEvent:"nothing",template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),zIndex:100});this.fire("$bubbled.ready",$bubbled),this.fire("hint.enable")},"bus sort.started":function(){this.fire("hint.disable")},"bus view.card.batch.move.after":function(){_.delay(_.bind(this.fire,this,"hint.enable"),100)},"bus $grid.ready:last+$bubbled.ready:last+zoomLevel.ready:last+hint.enable:last":function(evt,$grid,$bubbled,zoomLevel){zoomLevel<4?this._enable($grid,$bubbled):this._enable($grid,$bubbled,!0)},"bus $grid.ready:last+$bubbled.ready:last+hint.disable":function(evt,$grid,$bubbled){this._disable($grid,$bubbled)},_showHandler:function($bubbled,evt){var $card=$(evt.currentTarget);$bubbled.tauBubble("option","content",'<div class="tau-card tau-'+$card.attr("data-entity-type")+'">'+$card.html()+"</div>"),$bubbled.tauBubble("option","alignTo",$card),$bubbled.tauBubble("option","className","zoom-level-5 tau-cardtooltip tau-cardtooltip_type_"+$card.attr("data-entity-type")),clearTimeout(this.timeout),this.timeout=setTimeout(_.bind($bubbled.tauBubble,$bubbled,"show"),750)},_hideHandler:function($bubbled){clearTimeout(this.timeout),$bubbled.tauBubble("hide")},_enable:function($grid,$bubbled,onlyCollapsed){this._disable($grid,$bubbled);var s=".i-role-card";onlyCollapsed&&(s=".i-role-cellholder.tau-collapsed .i-role-card"),$grid.delegate(s,"mouseenter.hint",_.bind(this._showHandler,this,$bubbled)),$grid.delegate(s,"mouseleave.hint",_.bind(this._hideHandler,this,$bubbled))},_disable:function($grid,$bubbled){this._hideHandler($grid,$bubbled);var s=".i-role-card";$grid.undelegate(s,"mouseenter.hint"),$grid.undelegate(s,"mouseleave.hint")}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.hintsHeader',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var $header=$el.find(".i-role-header[data-dimension=x]");$header.length==0&&this.fire("$headerX.ready",$header)},"bus $headerX.ready":function(evt,$headerX){var onPositionConfig=function(config){return config.at="center bottom",config.my="center top",config.offset="-1 5",config},onArrowPositionConfig=function(config){return config.at="center bottom",config.my="center top",config.offset="-1 5",config},$bubbledHeader=$headerX.tauBubble({className:"tau-cardtooltip tau-cardtooltip-header  zoom-level-3",showEvent:"nothing",template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container" role="content"></div>',"</div>"].join(""),zIndex:1e3,onPositionConfig:onPositionConfig,onArrowPositionConfig:onArrowPositionConfig});this.fire("$bubbledHeader.ready",$bubbledHeader),this.fire("hintHeader.enable")},"bus sort.started":function(){this.fire("hintHeader.disable")},"bus view.card.batch.move.after":function(){_.delay(_.bind(this.fire,this,"hintHeader.enable"),100)},"bus $headerX.ready:last+$bubbledHeader.ready:last+hintHeader.enable:last":function(evt,$headerX,$bubbledHeader){this._enable($headerX,$bubbledHeader)},"bus $headerX.ready:last+$bubbledHeader.ready:last+hintHeader.disable:last":function(evt,$headerX,$bubbledHeader){this._disable($headerX,$bubbledHeader)},_showHandler:function($bubbled,evt){var $card=$(evt.currentTarget);if(!$card.parents(".i-role-cellholder:first").hasClass("tau-collapsed")){$bubbled.tauBubble("disable");return}$bubbled.tauBubble("enable");var $viewTrigger=$card.find(".i-role-cellaxis-viewtrigger"),data=$viewTrigger.data(),name=$card.find(".tau-label__text").text();if(!data||!data.entityType)return;var $t=$('<div class="tau-card tau-'+data.entityType+'"><div></div><div class="tau-name i-role-name">'+name+"</div></div>"),$popup=$bubbled.tauBubble("widget");$popup.length&&data.entityType!=$popup.data("entityType")&&($popup.removeClass("tau-cardtooltip-header-"+$popup.data("entityType")),$popup.data("entityType",data.entityType),$popup.addClass("tau-cardtooltip-header-"+$popup.data("entityType"))),$popup.length||$bubbled.tauBubble("option","className","tau-cardtooltip tau-cardtooltip-header  zoom-level-3 tau-cardtooltip-header-"+data.entityType),$bubbled.tauBubble("option","content",$t),$bubbled.tauBubble("option","alignTo",$viewTrigger),clearTimeout(this.timeout),this.timeout=setTimeout(_.bind($bubbled.tauBubble,$bubbled,"show"),500)},_hideHandler:function($bubbled,evt){clearTimeout(this.timeout),$bubbled.tauBubble("hide")},_enable:function($grid,$bubbled,onlyCollapsed){this._disable($grid,$bubbled);var s=".tau-label";$grid.delegate(s,"mouseenter.hint",_.bind(this._showHandler,this,$bubbled)),$grid.delegate(s,"mouseleave.hint",_.bind(this._hideHandler,this,$bubbled))},_disable:function($grid,$bubbled){this._hideHandler($grid,$bubbled);var s=".tau-label";$grid.undelegate(s,"mouseenter.hint"),$grid.undelegate(s,"mouseleave.hint")}})});
define('tau/libs/working-queue',["Underscore"],function(_){var ClassWorkingQueue=function(settings){var me=this;me.queue=[],me.interval=settings.interval,me.iterator=settings.iterator,me.proceed=_.bind(me.proceed,me),me.start=_.bind(me.start,me)};return ClassWorkingQueue.prototype={tick:function(){return+(new Date)},start:function(){var o=this;o.lastResume=o.tick(),o.next()},next:function(){var o=this;o.queue.length>0&&_.defer(o.proceed)},push:function(item){var o=this;o.queue.push(item),o.queue.length===1&&o.start()},proceed:function(){var me=this;if(me.queue.length===0)return;me.iterator(me.queue.shift());var delta=me.tick()-me.lastResume;delta>me.interval?me.wait():me.next()},wait:function(){var o=this;_.delay(o.start,o.interval)}},ClassWorkingQueue});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cardsSparklines',["jQuery","tau/core/extension.base","tau/libs/working-queue","tau/libs/sparklines/sparklines"],function($,ExtensionBase,WorkingQueue,Sparklines){var LOADING_CLASS="tau-sparkline-loading";return ExtensionBase.extend({init:function(){this.sparklineDrawQueue=new WorkingQueue({interval:150,iterator:function(node){var conf={width:100,height:50,letterWidth:9,letterHeight:9},sparklines=new Sparklines(conf);sparklines.draw(null,node),$(node).parent().removeClass(LOADING_CLASS)}}),this._super.apply(this,arguments)},"bus card.is.augmented":function(e){var $sp=e.data.element.find(".i-role-sparkline");this._pushToDrawingQueue($sp)},"bus overview.board.ready:last + operation.execute.done":function(evt,renderData,operation){var $el=renderData.element,$sp=this._extractEmptySparkline($el);this._pushToDrawingQueue($sp)},"bus overview.board.ready:last + view.card.batch.move.finished":function(evt,renderData,operation){var $el=renderData.element,$sp=this._extractEmptySparkline($el);this._pushToDrawingQueue($sp)},_extractEmptySparkline:function($el){return $el.find(".i-role-card .i-role-sparkline:empty")},_pushToDrawingQueue:function($sp){var o=this;$sp.parent().addClass(LOADING_CLASS),$sp.each(function(){o.sparklineDrawQueue.push(this)})}})});
define('tau/models/board.plus/model.board.collapse',["Underscore","jQuery","tau/core/event.emitter"],function(_,$,Model){return Model.extend({"bus boardSettings.ready":function(evt,boardData){var self=this;boardData.boardSettings.get({fields:["collapse"],callback:function(res){self.fire("settings.collapse.provided",res.collapse)}})},"bus settings.collapse.provided":function(evt){var collapsed=evt.data||{x:[],y:[]};this.fire("view.collapsed.axis",collapsed)},"bus boardSettings.ready:last + board.save.header.collapsing.settings":function(evt,boardData,headerData){var that=this,boardSettings=boardData.boardSettings;boardSettings.get({fields:["collapse"],callback:function(res){boardSettings.set({set:{collapse:that.toggleCollapsedId(res.collapse,headerData)}})}})},toggleCollapsedId:function(collapsedIds,headerData){var methodName={collapse:"union",expand:"without"};return collapsedIds=collapsedIds||{x:[],y:[]},collapsedIds[headerData.dimension]=_[methodName[headerData.setting]](collapsedIds[headerData.dimension],headerData.id),collapsedIds}})});
define('tau/models/board.plus/model.board.collapse.empty',["Underscore","./model.board.collapse"],function(_,Model){return Model.extend({"bus model.sliceInfo.retrieved + model.cells.content.loaded":function(evt){var cards=evt["model.cells.content.loaded"].data,axises=evt["model.sliceInfo.retrieved"].data,emptyValues=function(axis){var empty=[],marks=_.pluck(axises["marks"+axis.toUpperCase()]||[],axis);return _.each(marks,function(value){var items=_.select(cards.data.items,function(v){return v[axis]==value&&v.dynamic.items.length>0});items.length===0&&empty.push(value)}),empty},emptyX=emptyValues("x"),emptyY=emptyValues("y");this.fire("model.empty.data.ready",{x:emptyX,y:emptyY})},"bus settings.collapse.provided + model.empty.data.ready":function(evt){var empty=evt["model.empty.data.ready"].data,serverCollapsed=evt.data||{x:[],y:[]},data={x:_.without(empty.x,_.keys(serverCollapsed.x)),y:_.without(empty.y,_.keys(serverCollapsed.y))};this.fire("model.empty.axis.info",data)},"bus settings.collapse.provided":function(evt){},_fireCollapsedDataEvent:function(evt){var collapsingSettings=evt["settings.collapse.provided"]||evt["board.empty.collapsed.changed"],collapsed=_.cloneDeep(collapsingSettings.data||{x:[],y:[]}),empty=evt["model.empty.axis.info"].data;collapsed.x=_.union(collapsed.x,empty.x),collapsed.y=_.union(collapsed.y,empty.y),this.fire("view.collapsed.axis",collapsed)},"bus settings.collapse.provided + model.empty.axis.info":function(evt){this._fireCollapsedDataEvent(evt)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.collapse',["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,_,ExtensionBase,boardUtils){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,self=this,$header=$el.find(".i-role-header"),$grid=$el.find(".i-role-grid");$header.delegate(".i-role-collapser","click",function(e){var $cell=$(this).parents(".i-role-cellholder:first"),dimension=self.getCellDimension($cell),id=$cell.attr("data-"+dimension);self.fire("view.axis.collapser.executed.before"),self.toggleCollapsing($grid,$cell,dimension),self.fire("view.axis.collapser.executed.after");var action=$cell.hasClass("tau-collapsed")?"collapse":"expand";self.fire("board.save.header.collapsing.settings",{id:id,dimension:dimension,setting:action})}),$el.find(".tau-x-header .i-role-collapser").click(function(){var $header=$(this);self.toggleHeaderCollapsing($header),self.fire("view.axis.collapser.executed.after");var action=$header.hasClass("tau-collapsed")?"collapse":"expand";self.fire("board.save.header.collapsing.settings",{id:0,dimension:"axisY",setting:action})})},toggleHeaderCollapsing:function($header){$header.toggleClass("tau-collapsed").closest(".tau-board-grid-view").toggleClass("rows-h-collapsed")},toggleCollapsing:function($grid,$headerCell,dimension){var collapsed1="tau-collapsed",collapsed2="tau-collapsed_"+dimension;$headerCell.toggleClass(collapsed1+" "+collapsed2);var $cells=boardUtils.dimension($grid,$headerCell);$cells.toggleClass(collapsed2).each(function(){var $cell=$(this),realCollapsed=$cell.hasClass("tau-collapsed_x")||$cell.hasClass("tau-collapsed_y");$cell.toggleClass(collapsed1,realCollapsed)})},"bus afterRender + view.collapsed.axis":function(evt,renderData,collapsedData){var $el=renderData.element,self=this,settings=collapsedData,$grid=$el.find(".i-role-grid"),$headerCells=$el.find(".i-role-header .i-role-cellholder");$headerCells.each(function(){var $headerCell=$(this),dimension=self.getCellDimension($headerCell),id=$headerCell.attr("data-"+dimension),shouldBeCollapsed=_.contains(settings[dimension],id);shouldBeCollapsed&&self.toggleCollapsing($grid,$headerCell,dimension)});var $header=$el.find(".tau-x-header .i-role-collapser"),shouldBeCollapsed=_.contains(settings.axisY,0);$header.length&&shouldBeCollapsed&&self.toggleHeaderCollapsing($header),self.fire("view.axis.collapser.executed.after")},"bus view.cell.skeleton.element.afterUpdate":function(evt,update){var cell=update.cell,moreCollapsed=cell.find(".more-collapsed");moreCollapsed.length||(moreCollapsed=$('<span class="more-collapsed">&#8230;</span>')),cell.find(".i-role-card:last").after(moreCollapsed)},getCellDimension:function($cell){return $cell.attr("data-x")?"x":"y"}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.focus',["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils","Underscore"],function($,ExtensionBase,boardUtils,_){return ExtensionBase.extend({focusCells:function($grid,$input){var $cell=$input.parents(".i-role-cellholder:first"),dimension=$cell.parents(".i-role-header:first").data("dimension"),$allCells=boardUtils.dimension($grid,$cell).add($cell);return $allCells.toggleClass("tau-selected_"+dimension),$allCells.each(function(){var $cell=$(this);$cell.toggleClass("tau-selected",$cell.hasClass("tau-selected_x")||$cell.hasClass("tau-selected_y"))}),{cell:$cell,dimension:dimension}},_processSelectedMarks:function(axisName,marks,$el,$grid){var self=this;_.each(marks,function(mark){var idObj={};idObj[axisName]=mark;var id=boardUtils.generateId(idObj),$i=$("#"+id,$el).find("[name=focus]");$i.prop("checked",!0),self.focusCells($grid,$i)})},"bus board.selection.defaults.process":function(evt){var self=this,selectedMarks=_.defaults(evt.data.selectedMarks||{},{x:[],y:[]}),$el=evt.data.element,$grid=$el.find(".i-role-grid");_.each(["x","y"],function(axis){self._processSelectedMarks(axis,selectedMarks[axis],$el,$grid)}),self.fire("board.selection.defaults.ready",evt.data)},"bus board.selection.saveChanges":function(evt){var mark=evt.data.mark,boardSettings=evt.data.boardSettings,selected=_.defaults(evt.data.selectedMarks||{},{x:[],y:[]});mark.checked?selected[mark.dimension].push(mark.value):selected[mark.dimension]=_.without(selected[mark.dimension],mark.value),boardSettings.set({set:{selectedMarks:selected}})},"bus board.selection.defaults.ready":function(evt){var boardSettings=evt.data.boardSettings,$el=evt.data.element,self=this,$grid=$el.find(".i-role-grid"),$headers=$el.find(".i-role-header");$headers.delegate("[name=focus]","change",function(){var $input=$(this),focusCells=self.focusCells($grid,$input),dimension=focusCells.dimension,mark={checked:$input.prop("checked"),dimension:dimension,value:focusCells.cell.attr("data-"+dimension)};boardSettings.get({fields:["selectedMarks"],callback:function(r){var selectionArgs={selectedMarks:r.selectedMarks,boardSettings:boardSettings,mark:mark};self.fire("board.selection.saveChanges",selectionArgs)}})})},"bus boardSettings.ready:last+overview.board.ready":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element,self=this;boardSettings.get({fields:["selectedMarks"],callback:function(res){self.fire("board.selection.defaults.process",{selectedMarks:res.selectedMarks,element:$el,boardSettings:boardSettings})}})},"bus boardSettings.ready:last+destroy":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings;boardSettings.unbind({listener:this})}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.paging',["jQuery","Underscore","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,_,ExtensionBase,boardUtils){return ExtensionBase.extend({init:function(config){this._super(config),this.buttons={up:{className:"tau-nav-up",data:"up",code:"&uarr;"},right:{className:"tau-nav-right",data:"right",code:"&rarr;"},down:{className:"tau-nav-down",data:"down",code:"&darr;"},left:{className:"tau-nav-left",data:"left",code:"&larr;"}}},"bus afterRender + board.paging.settings":function(evt){var $board=evt.afterRender.data.element,$grid=$(".tau-board-grid-view",$board),pageSettings=evt["board.paging.settings"].data,self=this;_.each(pageSettings.availableDirections,function(enable,buttonType){enable&&self.getNavigationButton(self.buttons[buttonType]).appendTo($grid)});var handleNavigation=function(){$grid.undelegate(".tau-page-navigation-button","click",handleNavigation),$(".tau-page-navigation-button",$grid).hide(),self.fire("page.move.to",{direction:$(this).data("direction"),element:$board})};$grid.on("click",".tau-page-navigation-button",handleNavigation),self.fire("ui.board.paging.ready",{element:$board})},getNavigationButton:function(button){return $('<button class="'+button.className+' tau-page-navigation-button" data-direction="'+button.data+'">'+button.code+"</button>")}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.counts',["jQuery","tau/components/extensions/component.extension.base","Underscore","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,ExtensionBase,_,boardUtils){return ExtensionBase.extend({getMessage:function(counts,axisName,hasShowMore){var cards=" cards",are=" are";counts===1&&(cards=" card",are=" is");var weNotKnow=hasShowMore?" are visible, we don't know the real total so far...":"";return hasShowMore||(cards+=are),counts+cards+" in this "+(axisName==="x"?"column":"row")+weNotKnow},appendBubble:function($header,title,counts){var $countElement=$('<div class="tau-axiscell__item tau-cards-count" title="'+title+'"><span>'+counts+"</span></div>");return $header.append($countElement),$countElement},updateCount:function($countElement,title,counts){return $countElement.html("<span>"+counts+"</span>"),$countElement.attr("title",title),$countElement},refreshCounts:function(cells){var hash={x:{},y:{}},self=this;_.each(["x","y"],function(axisName){_.each(cells.cells,function(cell){var id=cell.data[axisName];if(!id||id==="null")return;hash[axisName].hasOwnProperty(id)||(hash[axisName][id]={id:id,header:null,count:0,hasShowMore:!1});var o={};o[axisName]=id;var elementId=boardUtils.generateId(o);cell.element.attr("id")==elementId?hash[axisName][id].header=cell.element:(hash[axisName][id].count+=cell.element.children(".tau-card").length,!hash[axisName][id].hasShowMore&&cell.element.parent().children(".i-role-cell-paging-more").length>0&&(hash[axisName][id].hasShowMore=!0))}),_.each(_.values(hash[axisName]),function(line){var $countBubble=line.header.children(".tau-cards-count"),message=self.getMessage(line.count,axisName,line.hasShowMore);if(line.count===0){$countBubble.hide();return}$countBubble.length===0?$countBubble=self.appendBubble(line.header,message,line.count):self.updateCount($countBubble,message,line.count),line.count>0?$countBubble.show():$countBubble.hide()})})},"bus overview.cells.skeletons.ready":function(evt,cells){this.refreshCounts(cells)},"bus overview.cells.skeletons.ready:last > view.card.batch.move.completed":function(evt,cells){this.refreshCounts(cells)},"bus overview.cells.skeletons.ready:last > view.cell.skeleton.updated":function(evt,cells){this.refreshCounts(cells)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.full-counts',["jQuery","Underscore","tau/components/extensions/component.extension.base"],function($,_,ExtensionBase){return ExtensionBase.extend({resetLifecycle:!0,init:function(){var self=this;self._super.apply(self,arguments),self._updateMetaInfoDebouncedHandler=_.debounce(self.updateMetaInfoAsync,500)},updateMetaInfoAsync:function(sliceInfo,sliceApi,limits,domWrapper){var self=this;self._request&&self._request.reject({data:{status:0}});var x=_.pluck(sliceInfo.x.data,"x"),y=_.pluck(sliceInfo.y.data,"y"),coords={$whereX:x.length?{x:{$in:x}}:undefined,$whereY:y.length?{y:{$in:y}}:undefined};if(coords.$whereX||coords.$whereY)self._request=sliceApi.axesCounts(coords).done(function(r){self._request=null,domWrapper.updateAxesMetaInfo(r.data.items,limits),self.fire("view.axes.counters.updated")})},"bus boardSettings.ready":function(evt,boardSettings){boardSettings=boardSettings.boardSettings;var limitsReady=_.bind(function(data){this.fire("boardSettings.limitsReady",data.limits||{})},this);boardSettings.get({fields:["limits"],listener:this,callback:limitsReady}),boardSettings.bind({fields:["limits"],listener:this,callback:limitsReady})},"bus model.sliceInfo.retrieved + slice.ready + domWrapper.ready + boardSettings.limitsReady":function(e,sliceInfo,api,domWrapper,limits){this._updateMetaInfoDebouncedHandler(sliceInfo,api.slice,limits,domWrapper)},"bus boardSettings.limitsReady:last > model.sliceInfo.retrieved:last > slice.ready:last > domWrapper.ready:last >  view.card.batch.move.completed":function(e,limits,sliceInfo,api,domWrapper){this._updateMetaInfoDebouncedHandler(sliceInfo,api.slice,limits,domWrapper)},"bus boardSettings.limitsReady:last > model.sliceInfo.retrieved:last > slice.ready:last > domWrapper.ready:last > view.cell.skeleton.updated":function(e,limits,sliceInfo,api,domWrapper){this._updateMetaInfoDebouncedHandler(sliceInfo,api.slice,limits,domWrapper)},"bus boardSettings.limitsReady:last > model.sliceInfo.retrieved:last > slice.ready:last > domWrapper.ready:last > boardSettings.limitsReady:last > operation.execute.done":function(e,limits,sliceInfo,api,domWrapper){this._updateMetaInfoDebouncedHandler(sliceInfo,api.slice,limits,domWrapper)},"bus model.sliceInfo.retrieved:last > slice.ready:last > domWrapper.ready:last > boardSettings.limitsReady":function(e,sliceInfo,api,domWrapper,limits){this._updateMetaInfoDebouncedHandler(sliceInfo,api.slice,limits,domWrapper)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.base',["jQuery","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/components/extensions/component.extension.base"],function($,IndicatorFactory,boardPlusUtils,ExtensionBase){var destroyApplication=function(e){var viewPort=e["viewPort.created"].data;viewPort.application.destroy()};return ExtensionBase.extend({appOptions:{},requireApplicationComponent:function(callback){var self=this,require=self.config.context.configurator.require;require(["all.components"],function(){require(["tau/components/component.application"],callback)})},onCardIdMouseDown:function(e){e.stopPropagation()},loadCardDetails:function(cardData){this.fire("view.load.cardDetails",cardData)},isSupportedCardForView:function(cardData){return boardPlusUtils.isSupportedCardForView(cardData)},cleanupStore:function(viewPort){viewPort.configurator.getStore().evictData()},"bus start.lifecycle":function(e){var self=this;self.requireApplicationComponent(function(PopupApplicationComponent){self.fire("applicationComponent.ready",{component:PopupApplicationComponent})})},"bus start.lifecycle+applicationComponent.ready":function(evt,initData,PopupApplicationComponent){var self=this,configurator=initData.context.configurator.createChild();configurator._id=_.uniqueId("board_cardView_"),configurator.isBoardEdition=!0,configurator.getHashService().setFakeWindow();var appConfig={context:{configurator:configurator},options:self.appOptions};appConfig.options.comet.enabled=configurator.getFeaturesService().isEnabled("comet.notifications");var applicationPopup=PopupApplicationComponent.component.create(appConfig);this.fire("viewerBus.ready",applicationPopup),applicationPopup.on("afterRender",function(evt){self.fire("viewPort.afterRender",evt.data)}),applicationPopup.on("application.error",function(evt){self.fire("view.cardDetails.lastResult",{type:"error",data:evt.data})}),applicationPopup.on("application.navigate",function(evt){self.fire("view.cardDetails.routing")}),applicationPopup.on("contentRendered",function(evt){self.fire("view.cardDetails.loaded",evt.data),self.fire("view.cardDetails.lastResult",{type:"loaded",data:evt.data})}),applicationPopup.initialize(appConfig),self.fire("viewPort.created",{application:applicationPopup,configurator:configurator})},"bus view.cardDetails.lastResult":function(e){var self=this,lastResult=e.data;lastResult.type==="error"&&self.fire("error",lastResult.data)},"bus view.skeleton.built":function(evt){var self=this,$skeleton=evt.data.element;$skeleton.delegate(".tau-id","mousedown",function(e){e.stopPropagation()}),self.subscribe($skeleton,$.proxy(self.loadCardDetails,self))},"bus refresh + viewPort.created":destroyApplication,"bus destroy + viewPort.created":destroyApplication})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.board',["jQuery","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.base"],function($,ExtensionBase){return ExtensionBase.extend({appOptions:{applicationId:"boardPopup",integration:{showInPopup:!0,keepAlive:!0},routing:{silent:!0,executeOnStart:!1},comet:{enabled:!1}},"bus view.dom.ready":function(){var $body=$("body");$body.tauProgressIndicator(),this.fire("$progressIndicator.ready",$body)},subscribe:function($skeleton,callback){var self=this,delegateCallback=_.debounce(function(e){var cardData=$(e.currentTarget).data();if(self.isSupportedCardForView(cardData)===!1)return;$("body").tauProgressIndicator("show"),callback(cardData)},500,!0);$skeleton.delegate(".i-role-card","dblclick",delegateCallback),$skeleton.delegate(".i-role-cellaxis-viewtrigger","click",delegateCallback),$skeleton.delegate(".tau-id","click",function(e){e.ctrlKey||(e.stopPropagation(),e.preventDefault(),$(this).closest(".tau-card").trigger("dblclick"))})},"bus acid.ready:last + viewPort.created:last + view.load.cardDetails":function(e,acid,viewPort,cardData){this.cleanupStore(viewPort),viewPort.application.fire("history.reset"),viewPort.application.fire("application.navigate.entity",{id:cardData.entityId,type:cardData.entityType,acid:acid})}})});
define('tau/models/board.plus/model.board.plus.quick.add.axes',["Underscore","./model.board.base"],function(_,ModelBoardBase){return ModelBoardBase.extend({"bus overview.board.ready":function(evt){var f=_.bind(this.fire,this,"axesActions.init");_.delay(f,500)},"bus configurator.ready + slice.ready + axesActions.init":function(e,configurator,sliceSource){var sliceClone=sliceSource.slice.clone();this.fire("slice.axes.quickadd.api.ready",sliceClone)},"bus slice.ready + model.sliceInfo.retrieved + axesActions.init":function(evt,sliceReady,sliceInfo){var self=this;sliceInfo.definition.x&&sliceInfo.definition.x.types.length||sliceInfo.definition.y&&sliceInfo.definition.y.types.length?sliceReady.slice.axesActions().done(function(r){self.fire("model.axesActions.ready",r.data)}):self.fire("model.axesActions.ready",{items:[]})}})});
define('tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-axes',["Underscore","jQuery"],function(_,$){var setPosition=function(e){var $axisHeader=$(e.delegateTarget),$flyPanel=this;$flyPanel.css("position","absolute"),$flyPanel.appendTo($axisHeader);var dimension=$axisHeader.data("dimension"),padding=2,offsetLeft=$axisHeader.width()-$flyPanel.width()-2*padding;dimension==="y"?($flyPanel.css("top",$axisHeader.height()-$flyPanel.height()-2*padding),$flyPanel.css("left",offsetLeft)):dimension==="x"&&($flyPanel.css("top",padding),$flyPanel.css("left",offsetLeft))};return function(domWrapper,settings){var isActivatedMode=!1,activatedScope,lastScopeCoordinate,sharedState=null,$buttonPanel=settings.$buttonPanel;$buttonPanel.hide();var $button=$buttonPanel.find(".tau-btn"),$target=domWrapper.getAxesHeaders(),predicateAddAction=function(dimension){var location=dimension.toLowerCase();return _.find(settings.items,function(itemData){var dataLocation=itemData.location,matchLocation=dataLocation.toLowerCase()===location;if(matchLocation){var hasAddAction=_.find(itemData.fixed.items,function(item){return item.type==="AddAction"});if(hasAddAction)return!0}return!1})},createEventHandler=function(eventFlag,callback){return function(e){var $node=$(e.delegateTarget),d=$node.data(),action=predicateAddAction(d.dimension);return lastScopeCoordinate=eventFlag+"_"+d.dimension,!isActivatedMode&&action?callback(e,{actionItems:action}):{}}},onClickHandler=function(){if(sharedState){isActivatedMode=!0,activatedScope=lastScopeCoordinate;var o={data:sharedState,deactivate:function(){isActivatedMode=!1,activatedScope!==lastScopeCoordinate&&$buttonPanel.hide()}};settings.onActivate(o)}};$button.click(onClickHandler);var showButtonPanel=_.throttle(function(){if(!sharedState)return;$buttonPanel.show()},500),hideButtonPanel=function(){$buttonPanel.hide()},activatePanel=function(e,obj){return sharedState=obj,setPosition.call($buttonPanel,e),showButtonPanel(),{buttonIsVisible:!0}},deactivatePanel=function(){sharedState=null,hideButtonPanel()},doubleClick=_.debounce(function(event){($(event.target).hasClass("i-role-cellholder")||$(event.target).hasClass("i-role-cell"))&&createEventHandler("enter",activatePanel)(event).buttonIsVisible&&$button.click()},300);$target.on("mouseenter",createEventHandler("enter",activatePanel)),$target.on("mouseleave",createEventHandler("leave",deactivatePanel)),$target.on("dblclick",doubleClick)}});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.quick.add.axes',["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.decorator.quick-add-axes"],function($,ExtensionBase,AxesQuickAddDecorator){return ExtensionBase.extend({resetLifecycle:!0,"bus slice.axes.quickadd.api.ready:last + domWrapper.ready:last + model.axesActions.ready":function(e,sliceQuickAddApi,domWrapper,axesActions){var self=this,$buttonPanel=domWrapper.createQuickAddPanel();$buttonPanel.hide();var api=sliceQuickAddApi;api.on("after.addAxisData",_.bind(self.onAfterAddAxisData,self)),domWrapper.decorate(AxesQuickAddDecorator,{$buttonPanel:$buttonPanel,items:axesActions.items,onActivate:function(e){var param={target:$buttonPanel.find(".tau-btn"),actionItems:e.data.actionItems,ctrl:e};self.showQuickAddPopup(api,domWrapper,param)}})},setupBatchAddOperation:function(){this.itemsToAdd=[]},onAfterAddAxisData:function(e){var result=e.data.result,axisItem=result[0];this.itemsToAdd.push({data:axisItem.dataItem,location:axisItem.location})},triggerBatchAddOperation:function(){if(this.itemsToAdd.length===0)return;this.fire("operation.added",{options:{force:!0},items:this.itemsToAdd})},showQuickAddPopup:function(slice,domWrapper,activationData){var self=this,button=activationData.target,findCellActionItemInData=function(cellData){return _.find(cellData.fixed.items,function(item){return item.type==="AddAction"})},actionItems=activationData.actionItems,addActionItem=findCellActionItemInData(actionItems),CONST_ADDEXPAND_CLASS="tau-quick-add_expand",viewMode="axis",$gridView=domWrapper.getGrid().parents(".tau-board-grid-view,.tau-entity-list"),isXAxis=(activationData.actionItems.location||"").toLowerCase()==="xaxis",bubbleConfig={target:button,cleanupOnHide:!0,stackName:"quickAdd",showOnCreation:!0,zIndex:1e4,onShow:function(){$gridView.prop("disabled",!0),button.parent().addClass(CONST_ADDEXPAND_CLASS),self.setupBatchAddOperation()},onHide:function(){$gridView.prop("disabled",!1),button.parent().removeClass(CONST_ADDEXPAND_CLASS),self.triggerBatchAddOperation(),activationData.ctrl.deactivate()},onPositionConfig:function(){var my="left "+(isXAxis?"top":"bottom"),at="left "+(isXAxis?"bottom":"top");return{of:button,collision:"fit flip",my:my,at:at,offset:"-30 0"}},onArrowPositionConfig:function(arrowPositionConfig){if(isXAxis){var offset=arrowPositionConfig.offset,parts=offset.split(" ");parts[0]=-5,arrowPositionConfig.offset=parts.join(" ")}return arrowPositionConfig},dontCloseSelectors:["#ui-datepicker-div"],componentsConfig:{components:[{type:"board.cell.quick.add",options:{slice:slice,action:actionItems,addAction:addActionItem,viewMode:viewMode}}]}};self.fire("initBubble",bubbleConfig)}})});
define('tau/components/component.board.plus',["tau/components/component.board.plus.base","tau/models/board.plus/model.board.plus.grid","tau/models/board.plus/model.board.pages.preloading","tau/models/board.plus/model.board.cell.freezable","tau/ui/extensions/board.plus/ui.extension.board.plus.layout","tau/ui/extensions/board.plus/ui.extension.board.plus.dom.updater.board","tau/models/board.plus/model.board.dragndrop","tau/ui/extensions/board.plus/ui.extension.board.plus.dragndrop","tau/ui/extensions/board.plus/ui.extension.board.plus.selection.board","tau/ui/extensions/board.plus/ui.extension.board.plus.scrollManager","tau/ui/extensions/board.plus/ui.extension.board.plus.scroll","tau/ui/extensions/board.plus/ui.extension.board.plus.hints","tau/ui/extensions/board.plus/ui.extension.board.plus.hintsHeader","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsSparklines","tau/models/board.plus/model.board.collapse","tau/models/board.plus/model.board.collapse.empty","tau/ui/extensions/board.plus/ui.extension.board.plus.collapse","tau/ui/extensions/board.plus/ui.extension.board.plus.focus","tau/ui/extensions/board.plus/ui.extension.board.plus.paging","tau/ui/extensions/board.plus/ui.extension.board.plus.counts","tau/ui/extensions/board.plus/ui.extension.board.plus.full-counts","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.board","tau/models/board.plus/model.board.plus.quick.add.axes","tau/ui/extensions/board.plus/ui.extension.board.plus.quick.add.axes"],function(BaseBoardComponent,ModelBoardPlus,ModelBoardPagesPreloading,ModelBoardCell,LayoutExtension,DomUpdater,ModelDragndrop,DragndropExtension,SelectionExtension,ScrollManagerExtension,ScrollExtension,HintsExtension,HintsHeaderExtension,SparklinesExtension,CollapseModel,CollapseModelEmpty,CollapseExtension,FocusExtension,PagingExtension,CountsExtension,FullCountsExtension,CardViewerExtension,QuickAddAxesModel,QuickAddAxesExtension){return{create:function(config){var creatorConfig={extensions:[ModelBoardPlus,ModelBoardPagesPreloading,ModelBoardCell,DomUpdater,LayoutExtension,ModelDragndrop,DragndropExtension,SelectionExtension,ScrollManagerExtension,ScrollExtension,HintsExtension,HintsHeaderExtension,SparklinesExtension,CollapseModelEmpty,CollapseExtension,FocusExtension,PagingExtension,CardViewerExtension].concat(config.extensions||[])},featureService=config.context.configurator.getFeaturesService(),isFeatureEnabled=featureService.isEnabled("axes.quick.add");return isFeatureEnabled&&(creatorConfig.extensions=creatorConfig.extensions.concat([QuickAddAxesModel,QuickAddAxesExtension])),featureService.isEnabled("full.counts")?creatorConfig.extensions.push(FullCountsExtension):creatorConfig.extensions.push(CountsExtension),BaseBoardComponent.create(creatorConfig,config)}}});
define('tau/models/board.plus/model.board.plus.list',["Underscore","tau/models/board.plus/model.board.plus"],function(_,BoardPlusModel){return BoardPlusModel.extend({onGetSliceInfo:function(slice){var definition=slice.config.definition,processedAxes=this.getEmptyModelInfoArgs(definition);processedAxes.viewMode="list",this.fire("model.sliceInfo.retrieved",processedAxes),this.fire("board.paging.settings",processedAxes)}})});
define('tau/models/board.plus/model.board.cell.list',["Underscore","tau/models/board.plus/model.board.cell"],function(_,BaseModelBoardCell){return BaseModelBoardCell.extend({onGetCellContent:function(slice,coords){var self=this,$skip=coords.from,$take=coords.to-coords.from+1,cfg={$take:self.generateExcessTake($take),$skip:$skip},fnCallback=function(r){r.data.items=r.data.items.length!==0?r.data.items:[{}];var cr=self.preProcessCellResponse(r.data.items[0],coords);r.data.items[0]=cr.dataItem,self.fire("model.cells.content.loaded",r);var filteredDynamicItems=self.fireCellBasicInfoRetrieved(cr);self.fireCardsDataReady(filteredDynamicItems)};slice.list(cfg).done(fnCallback).fail(function(){fnCallback({data:{items:[]}})})}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.dom.updater.list',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus view.skeleton.built":function(evt){evt.data.element.children().css({opacity:0})},"bus board.element.updated":function(evt){var elementsData=evt.data,$oldElement=elementsData.oldElement,$newElement=elementsData.newElement;$oldElement.replaceWith($newElement)},"bus overview.board.ready":function(evt){var $element=evt.data.element;$element.children().css({opacity:1})}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.selection.list',["jQuery","Underscore","tau/core/extension.base"],function($,_,ExtensionBase){return ExtensionBase.extend({init:function(){this._super.apply(this,arguments),this.fire("view.card.selection.ref",{last:{position:-1},stack:[]})},"bus view.card.selection.ref:last + domWrapper.ready":function(e,selectionRef,domWrapper){var self=this,$selectable=domWrapper.getGrid();$selectable.tauSelectable({items:".i-role-card",ctrl:!0,forceSelection:!0,className:"tau-selected",changed:function(event,ui){var $item=ui.item,selected=ui.selected,data=$item.data();if(selected)selectionRef.last.position=$item.index(),selectionRef.stack[selectionRef.stack.length-1]!==data.id&&selectionRef.stack.push(data.id);else{var i=_.indexOf(selectionRef.stack,data.id);selectionRef.stack.splice(i,1)}self.fire("view.card.selected",{element:$item,selected:selected})}}),self.fire("$selectable.ready",$selectable)},"bus $selectable.ready + domWrapper.ready":function(e,$selectable,domWrapper){var $first=domWrapper.getCardByPositionOrLast(0);$selectable.tauSelectable("select",$first)},"bus domWrapper.ready:last + $selectable.ready:last + view.card.selection.ref:last + selection.reapply":function(ev,domWrapper,$selectable,selectionRef,operation){var $markedAsSelected=$selectable.tauSelectable("getSelected");$selectable.tauSelectable("option","fireEvents",!1),$selectable.tauSelectable("select",$markedAsSelected),$selectable.tauSelectable("option","fireEvents",!0);var liveCardIDs=[];$markedAsSelected.each(function(i){liveCardIDs.push($(this).data("id"))}),selectionRef.stack=_.intersection(selectionRef.stack,liveCardIDs);var $lastCard=null;if(selectionRef.stack.length===0)$lastCard=domWrapper.getCardByPositionOrLast(selectionRef.last.position),$lastCard.size()>0?$selectable.tauSelectable("select",$lastCard):this.fire("view.empty.cardDetails");else{var id=selectionRef.stack[selectionRef.stack.length-1];$lastCard=domWrapper.getCardBySliceId(id),selectionRef.last.position=$lastCard.index();var d=$lastCard.data()}},"bus $selectable.ready:last + view.card.selected":function(e,$selectable,selectedCard){$selectable.tauSelectable("option","fireEvents",!1),$selectable.tauSelectable(selectedCard.selected?"select":"reset",selectedCard.element),$selectable.tauSelectable("option","fireEvents",!0)}})});
define('tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.list',["jQuery","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.base"],function($,IndicatorFactory,boardPlusUtils,CardsViewerExtensionBase){return CardsViewerExtensionBase.extend({appOptions:{applicationId:"listPopup",turnOffLoadingIndicator:!0,integration:{showInPopup:!1},routing:{silent:!0,executeOnStart:!1},comet:{enabled:!1}},"bus viewerBus.ready + view.skeleton.built + viewPort.afterRender":function(e,viewerBus){var $skeleton=e["view.skeleton.built"].data.element,$viewPort=e["viewPort.afterRender"].data.element;$skeleton.find(".i-card-details-holder").append($viewPort),viewerBus.fire("view.dom.ready")},subscribe:function($skeleton,callback){var self=this;self._viewCardSelectedHandler&&self.bus.removeListener("view.card.selected",self._viewCardSelectedHandler,self.bus),self._viewCardSelectedHandler=function(e){if(!e.data.selected)return;var cardData=e.data.element.data();if(self.isSupportedCardForView(cardData)===!1)return;callback(cardData)},$skeleton.delegate(".tau-id","click",function(e){e.ctrlKey||(e.stopPropagation(),e.preventDefault(),$(this).closest(".tau-card").trigger("mousedown"))}),self.on("view.card.selected",self._viewCardSelectedHandler)},"bus acid.ready:last + viewPort.created:last + view.load.cardDetails":function(e,acid,viewPort,cardData){this.fire("has.data.in.slice"),this.fireRouterOnViewPort(viewPort,{id:cardData.entityId,entity:cardData.entityType,acid:acid})},"bus viewPort.created:last + view.empty.cardDetails":function(e,viewPort){viewPort.application.fire("application.exit"),this.fire("no.data.in.slice",{type:"isEmpty"})},fireRouterOnViewPort:function(viewPort,routingData){viewPort.application.fire("history.reset"),viewPort.application.fire("application.navigate.entity",routingData)},"bus view.skeleton.built:last + view.cardDetails.routing":function(e,skeleton){var $skeleton=skeleton.element;this.showProgress($skeleton)},"bus view.skeleton.built:last + view.cardDetails.lastResult":function(e,skeleton){var $skeleton=skeleton.element;this.removeProgress($skeleton)},"bus view.skeleton.built:last + view.empty.cardDetails":function(e,skeleton){var $skeleton=skeleton.element;this.removeProgress($skeleton)},"bus view.card.batch.move.completed":function(e){this.fire("view.card.batch.move.completed.spec.cardsViewer")},showProgress:function($skeleton){var $holder=$skeleton.find(".i-card-details-holder");IndicatorFactory.get($holder).show()},removeProgress:function($skeleton){var $holder=$skeleton.find(".i-card-details-holder");IndicatorFactory.get($holder).hide()}})});
define('tau/components/component.board.plus.list',["tau/components/component.board.plus.base","tau/models/board.plus/model.board.plus.list","tau/models/board.plus/model.board.cell.list","tau/ui/extensions/board.plus/ui.extension.board.plus.dom.updater.list","tau/models/board.plus/model.board.dragndrop","tau/ui/extensions/board.plus/ui.extension.board.plus.dragndrop","tau/ui/extensions/board.plus/ui.extension.board.plus.selection.list","tau/ui/extensions/board.plus/ui.extension.board.plus.scrollManager","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsViewer.list","tau/ui/extensions/board.plus/ui.extension.board.plus.cardsSparklines"],function(BaseBoardComponent,ModelBoardSkeleton,ModelBoardCellInfo,DomUpdater,DragndropModel,DragndropExtension,SelectionExtension,ScrollManagerExtension,ExtensionCardsViewerList,SparklinesExtension){return{create:function(config){var creatorConfig={extensions:[ModelBoardSkeleton,ModelBoardCellInfo,DomUpdater,DragndropModel,DragndropExtension,SelectionExtension,ScrollManagerExtension,ExtensionCardsViewerList,SparklinesExtension]};return BaseBoardComponent.create(creatorConfig,config)}}});
define('tau/ui/templates/board.plus.list/ui.template.fake-list',["tau/core/templates-factory"],function(templates){var config={name:"fake-list",engine:"jqote2",markup:['<div class="tau-board-body">','   <div class="tau-coming-soon">',"       <h2><span>List</span></h2>","       <h3>Deep hierarchy. Full inline edit. Drag and drop actions </h3>",'       <div class="tau-bg tau-list-view"></div>',"   </div>","</div>"]};return templates.register(config)});
define('tau/components/component.board.plus.newlist',["tau/components/component.creator","tau/ui/templates/board.plus.list/ui.template.fake-list"],function(Creator,Template){return{create:function(config){var creatorConfig={template:Template},component=Creator.create(creatorConfig,config);return component.fire("dataBind",{}),component}}});
define('tau/ui/templates/board.plus.timeline/ui.template.fake-timeline',["tau/core/templates-factory"],function(templates){var config={name:"fake-timeline",engine:"jqote2",markup:['<div class="tau-board-body">','   <div class="tau-coming-soon">',"       <h2><span>Timeline</span></h2>","       <h3>Track progress. Create Roadmaps. Plan Releases and Iterations</h3>",'       <div class="tau-bg tau-timeline-view"></div>',"   </div>","</div>"]};return templates.register(config)});
define('tau/components/component.board.plus.timeline',["tau/components/component.creator","tau/ui/templates/board.plus.timeline/ui.template.fake-timeline"],function(Creator,Template){return{create:function(config){var creatorConfig={template:Template},component=Creator.create(creatorConfig,config);return component.fire("dataBind",{}),component}}});
define('tau/models/board.selector/model.board.selector',["Underscore","tau/core/extension.base","tau/core/bus"],function(_,BaseModel,Class){var bsService=Class.extend({init:function(bus){this.id=null,this.boardSettings=null,this.bus=bus,this.bus.unbind(this),this.bus.on("boardSettings.ready",function(evt){var boardSettings=evt.data.boardSettings,id=boardSettings.settings.id;id&&this.id&&id!=this.id?(this.id=id,this.boardSettings=boardSettings,this.fire("changed",{entity:{id:id,type:"board"},boardSettings:boardSettings})):(this.id=id,this.boardSettings=boardSettings,this.fire("ready",{entity:{id:id,type:"board"},boardSettings:boardSettings}))},this)},reset:function(){this.id=null,this.boardSettings=null},getCurrent:function(cb){cb({entity:{id:this.id,type:"board"},boardSettings:this.boardSettings})}}),Model=BaseModel.extend({resetLifecycle:!0,init:function(config){this._super(config),this.bsService=new bsService(this.bus),this.bsService.on("ready",function(data){this.fire("bsServiceData.ready",data)},this)},"bus refresh":function(){this.bsService.unbind(this)},"bus bsServiceData.ready:last + beforeInit":function(evt,bs,initConfig){var configurator=initConfig.config.context.configurator;this.bsService.unbind(this),this.bsService.on("changed",function(evt,data){this.fire("_boardSettings.ready",data.boardSettings),this.fire("currentBoard.changed",data.entity)},this),this.bsService.getCurrent(_.bind(function(data){var boardSettings=data.boardSettings;this.fire("_boardSettings.ready",data.boardSettings);var groupName=boardSettings.getGroupName();this.fire("storageConfig.ready",{groupName:groupName}),this.fire("currentBoard.ready",data.entity)},this)),this.fire("configurator.ready",configurator)},"bus configurator.ready":function(evt,configurator){var fire=_.bind(this.fire,this),storage=configurator.getRestStorage();storage.removeAllListeners(this),storage.on("afterRemove",function(data){this.fire("board.removed",{id:data.data.$key})},this)},"bus board.removed > currentBoard.changed":function(){this.fire("refresh")},"bus _boardSettings.ready":function(evt,boardSettings){var fire=_.bind(this.fire,this);boardSettings.unbind({listener:this}),boardSettings.bind({fields:["name","isShared","viewMode","acid"],listener:this,callback:function(res){setTimeout(function(){fire("refresh")},1e3)}})},getTeams:function(store,userId){var deferred=$.Deferred();return store.get("teamMembers",{$query:{user:{id:userId}},fields:[{team:["id"]}]}).done(function(result){var teams=_.map(result[0].data,function(teamMember){return{id:teamMember.team.id}});deferred.resolve(teams)}),deferred},getProjects:function(store,userId){var deferred=$.Deferred();return store.get("projectMembers",{$query:{user:{id:userId}},fields:[{project:["id"]}]}).done(function(result){var projects=_.map(result[0].data,function(projectMember){return{id:projectMember.project.id}});deferred.resolve(projects)}),deferred},getBoardsByUser:function(storage,storageConfig,userId){return storage.select(storageConfig.groupName,{$where:"(ownerId == "+userId+' or publicData.isShared == "true")',$fields:["key","ownerId","publicData.name","publicData.isShared","publicData.customSharedData","publicData.createdAt","userData.menuIsVisible AS userMenuIsVisible","userData.menuNumericPriority AS userMenuNumericPriority","publicData.menuIsVisible","publicData.menuNumericPriority","publicData.viewMode","publicData.acid","userData.viewMode AS userViewMode"],$limit:{start:0,max:10}}).pipe(function(data){return data.data})},"bus configurator.ready + storageConfig.ready":function(evt,configurator,storageConfig){var loggedUserId=configurator.getLoggedUser().id,storage=configurator.getRestStorage(),store=configurator.getStore();$.when(this.getProjects(store,loggedUserId),this.getTeams(store,loggedUserId),this.getBoardsByUser(storage,storageConfig,loggedUserId)).done(function(projects,teams,boards){var projectIds=_.pluck(projects,"id"),teamIds=_.pluck(teams,"id");boards=_.filter(boards,function(board){if(board.ownerId===loggedUserId)return!0;if(!board.isShared)return!0;if(!board.customSharedData||!board.customSharedData.isActive)return!0;var boardHasProjects=_.intersection(board.customSharedData.projectIds,projectIds).length>0,boardHasTeams=_.intersection(board.customSharedData.teamIds,teamIds).length>0;return boardHasProjects||boardHasTeams}),this.fire("boards.ready",boards)}.bind(this))},"bus currentBoard.ready > boards.ready":function(evt,current,boards){var fire=_.bind(this.fire,this),items=_(boards).chain().map(function(v,k){var key=v.key,item={key:key,ownerId:v.ownerId,name:v.name||key,isShared:v.isShared===!0,acid:v.acid||"",menuIsVisible:_.isUndefined(v.userMenuIsVisible)?v.menuIsVisible:v.userMenuIsVisible,priority:v.userMenuNumericPriority||v.menuNumericPriority||999999,viewMode:v.userViewMode||v.viewMode||"board"};return item.isActive=item.key==current.id,item.menuNumericPriority=item.priority,item}).sortBy(function(v){return v.priority}).value(),grouped=_.groupBy(items,function(v){return v.menuIsVisible?"menu":"more"}),groupMore=grouped.more||[];current=_.find(groupMore,function(v){return v.isActive});var itemsMore=grouped.more||[],data={items:grouped.menu||[],itemsMore:itemsMore,currentItem:current};fire("dataBind",data)}});return Model});
define('tau/ui/extensions/board.selector/ui.extension.board.selector.main',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $el=renderData.element,$groups=$el.find(".tau-boardselector__group"),$items=$el.find(".i-role-item"),$links=$el.find(".i-role-item a");this.fire("$el.ready",$el),this.fire("$groups.ready",$groups),this.fire("$items.ready",$items),this.fire("$links.ready",$links)},"bus $el.ready:last + $bubbled.ready:last + $items.ready:last + board.removed":function(evt,$el,$bubbled,$items,board){var $item=$items.filter("[data-id="+board.id+"]");$item.remove(),this.fire("refresh")},"bus $el.ready:last + $bubbled.ready:last + $items.ready:last + currentBoard.changed":function(evt,$el,$bubbled,$items,board){var $item=$items.filter("[data-id="+board.id+"]"),selectionClassName="tau-boardselector__item_active_true";$item.length?($item.hasClass(selectionClassName)||($items.removeClass(selectionClassName),$item.addClass(selectionClassName)),$bubbled.tauBubble("hide"),this._updateShowMore($el)):this.fire("refresh")},"bus $el.ready:last + edit.completed":function(evt,$el){this._updateShowMore($el)},_updateShowMore:function($el){var $showMore=$el.find(".i-role-action-showmore"),$c=$showMore.tauBubble("widget").find(".tau-boardselector__item_active_true");$showMore.find("span:first").text($c.length?$c.text():""),$showMore.parent().toggleClass("tau-boardselector__headermenu__item_focused_true",$c.length>0)}})});
define('tau/ui/extensions/board.selector/ui.extension.board.selector.linkupdater',["jQuery","tau/core/extension.base"],function($,BaseExtension){return BaseExtension.extend({resetLifecycle:!0,"bus configurator.ready":function(e,configurator){var self=this,appStateStore=configurator.getAppStateStore();appStateStore.get({fields:["acid"],callback:function(r){self.fire("acidData.ready",{id:r.id,acid:r.acid})}}),appStateStore.unbind({listener:this}),appStateStore.bind({listener:self,fields:["acid"],callback:function(r){self.fire("acidData.ready",{id:appStateStore.settings.id,acid:r.acid})}})},"bus configurator.ready:last + $links.ready:last + acidData.ready":function(evt,configurator,$links,acidData){$links.each(function(){var $link=$(this),data=_.clone(acidData),boardId=$link.attr("data-id"),boardAcid=$link.attr("data-acid").trim();data.acid=boardAcid||acidData.acid;var url=configurator.getUrlBuilder().getRelativeBoardUrl(boardId,data);$link.attr("href",url)}),this.fire("linksUpdated")},"bus configurator.ready:last + destroy":function(e,configurator){var appStateStore=configurator.getAppStateStore();appStateStore.unbind({listener:this})}})});
define('tau/ui/extensions/board.selector/ui.extension.board.selector.help',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({configFieldName:"collapser_aside_collapsed","bus afterInit":function(evt){var configurator=evt.data.config.context.configurator,settingsManager=configurator.getSettingsManager(),configFieldName=this.configFieldName,self=this;settingsManager.get({fields:[configFieldName],callback:function(result){self.fire("hintsEnable.ready",!!result[configFieldName])}}),settingsManager.unbind({listener:this}),settingsManager.bind({listener:this,fields:[configFieldName],callback:function(result){self.fire("hintsEnable.ready",!!result[configFieldName])}})},"bus afterRender":function(evt,renderData){var self=this,$element=renderData.element,$items=$element.find(".i-role-item");$items.each(function(){var $el=$(this),$content="<span>"+$el.text()+"</span>";$el.tauBubble({content:$content,template:['<div class="tau-bubble-board">','<div class="tau-bubble-board__arrow"  role="arrow"></div>','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join(""),zIndex:999,className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mouseleave",mode:"tooltip",onPositionConfig:function(config){return config.at="right center",config.my="left center",config.offset="0 0",config},onShow:function(config){this.adjustPosition()}})}),this.fire("$hinted.ready",$items)},"bus $hinted.ready:last+hintsEnable.ready:last":function(evt,$hinted,isEnable){$hinted.tauBubble(isEnable?"enable":"disable")}})});
define('tau/ui/extensions/board.selector/ui.extension.board.selector.editable',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var self=this,$dndItems=$el.find(".i-role-item"),$dndGroups=$el.find(".i-role-list"),$groups=$el.find(".tau-boardselector__group"),$moreItems=$el.find(".i-role-moreitems").detach(),$showMore=$el.find(".i-role-action-showmore");$dndGroups.delegate(".i-role-item a","click",function(e){$(this).closest(".tau-boardselector__group_mode_configure").length&&e.preventDefault()}),$showMore.bind("click",function(e){$(this).closest(".tau-boardselector__group_mode_configure").length&&(e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation())});var _setLayout=_.bind(this._setLayout,this,$moreItems);_setLayout(),$showMore.tauBubble({alignTo:$el,content:$moreItems,showEvent:"click",onShow:function(){_setLayout(),$el.addClass("tau-boardselector_expanded_true"),$(window).bind("resize.boardselector",_.throttle(_setLayout,200))},onHide:function(){$el.removeClass("tau-boardselector_expanded_true"),$(window).unbind("resize.boardselector")},onPositionConfig:function(config){config.my="left top",config.at="right top",config.offset="0 0"},template:['<div class="tau-bubble-board tau-boardselector__bubble ">','<div class="tau-bubble-board__inner tau-container"  role="content"></div>',"</div>"].join("")}),this.fire("$bubbled.ready",$showMore);var oldDocument,oldEsc;$("body").find(".tau-boardselector__overlay").remove(),$moreItems.delegate(".i-role-action-configure","click",_.bind(function(){$groups.addClass("tau-boardselector__group_mode_configure"),$("body").append('<div class="ui-popup-overlay tau-boardselector__overlay"></div>'),$el.addClass("tau-boardselector_mode_configure"),this._setHeight($groups,"edit"),$el.tauSortable({groups:$dndGroups,items:$dndItems,zIndex:300,distance:5,appendTo:$el.parent(),processToGroup:function($item,$fromGroup,$toGroup){$item.appendTo($toGroup)},stop:_setLayout}),oldDocument=$showMore.data("tauBubble")._onDocumentClick,oldEsc=$showMore.data("tauBubble")._onKeyDown,$showMore.data("tauBubble")._onDocumentClick=function(){},$showMore.data("tauBubble")._onKeyDown=function(){}},this)),$moreItems.delegate(".i-role-action-done, .i-role-action-collapse","click",_.bind(function(){$el.hasClass("tau-boardselector_mode_configure")&&($groups.removeClass("tau-boardselector__group_mode_configure"),$("body").find(".tau-boardselector__overlay").remove(),$el.removeClass("tau-boardselector_mode_configure"),$showMore.data("tauBubble")._onDocumentClick=oldDocument,$showMore.data("tauBubble")._onKeyDown=oldEsc,self.fire("edit.done"),$el.tauSortable("destroy"),this._setHeight($groups,"redraw")),$showMore.tauBubble("hide")},this)),$el.bind("tausortablestop",function(event,ui){self.fire("sort.stopped",[event,ui]),self.fire("dragndrop.completed")})},"bus configurator.ready:last + $groups.ready:last + storageConfig.ready:last + edit.done":function(e,configurator,$groups,storageConfig){var self=this,storage=configurator.getRestStorage(),requests=[],pr=1,$visibleGroup=$groups.eq(0);$visibleGroup.find(".i-role-item").each(function(){var $item=$(this),data={id:$item.attr("data-id"),menuIsVisible:1,menuNumericPriority:pr++};requests.push(_.bind(function(data,next){storage.data(storageConfig.groupName,data.id,{scope:"Public",userData:{menuIsVisible:data.menuIsVisible,menuNumericPriority:data.menuNumericPriority}}).done(function(){next(!1)})},this,data))});var $moreGroup=$groups.eq(1);$moreGroup.find(".i-role-item").each(function(){var $item=$(this),data={id:$item.attr("data-id"),menuIsVisible:0,menuNumericPriority:pr++};requests.push(_.bind(function(data,next){storage.data(storageConfig.groupName,data.id,{scope:"Public",userData:{menuIsVisible:data.menuIsVisible,menuNumericPriority:data.menuNumericPriority}}).done(function(){next(!1)})},this,data))}),_.series(requests,function(){self.fire("edit.completed")})},_setLayout:function($group){var cols=0,rows=0,len=$group.find(".i-role-item").length;if(len){var h=$(window).height(),w=$(window).width();rows=Math.round(h/47/3),cols=Math.floor(len/rows);var maxCols=Math.floor(w/220)-1,maxColsByRows=Math.floor(len/5);$group.find(".i-role-list").parent().css("maxWidth",(Math.min(maxColsByRows,maxCols,cols)||1)*13.75+"rem")}},_setHeight:function($groups,action){var OFFSET_BOTTOM=99,strategy={redraw:{"max-height":$(window).height()-$groups[0].getBoundingClientRect().top-OFFSET_BOTTOM,height:""},edit:{height:$(window).height()-$groups[0].getBoundingClientRect().top,"max-height":""}};$groups.eq(0).find(".i-role-list").css(strategy[action]||{})},"bus $el.ready + view.dom.ready:last":function(e,$el){this._setHeight($el,"redraw"),$(window).off("resize.boardadd"),$(window).on("resize.boardadd",_.bind(function(){this._setHeight($el,"redraw")},this))}})});
define('tau/ui/templates/board.selector/ui.template.board.selector.item',["tau/core/templates-factory"],function(templates){var config={name:"board.selector.item",engine:"jqote2",markup:['<li class="tau-boardselector__item tau-boardselector__item_type_<%= this.viewMode %> i-role-item',"<% if (this.isActive){ %> tau-boardselector__item_active_true<% } %> ","<% if (this.isShared){ %> tau-boardselector__item_access_public <% } else { %> tau-boardselector__item_access_private <% } %> ",'" ','data-id="<%= this.key %>" data-acid="<%= this.acid %>" data-menu-numeric-priority="<%= this.menuNumericPriority %>" >','<a class="tau-boardselector__link" href="#page=board/<%= this.key %>" data-id="<%= this.key %>" data-acid="<%= this.acid %>"><span><%! this.name %></span></a>',"</li>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/board.selector/ui.template.board.selector',["tau/core/templates-factory","tau/nls/translator","tau/ui/templates/board.selector/ui.template.board.selector.item"],function(templates,T){var config={name:"board.selector",engine:"jqote2",markup:['<div class="tau-boardselector">','<div class="tau-boardselector__group  tau-boardselector__group-main i-role-group">','<div class="tau-boardselector__groupheader">','<ul class="tau-boardselector__headermenu">','<li class="tau-boardselector__headermenu__item tau-boardselector__headermenu__item-title">',"<span>Boards</span>","</li>",'<li class="tau-boardselector__headermenu__item <%= (this.currentItem ? "tau-boardselector__headermenu__item_focused_true" : "") %> tau-boardselector__headermenu__item-more">','<span class="tau-button-link tau-boardselector__action tau-boardselector__action-more i-role-action-showmore">','<span class="tau-boardselector__moreboard i-role-info tau-extension-board-tooltip" data-title="'+T("See&nbsp;all&nbsp;boards")+'"><%! (this.currentItem ? this.currentItem.name : "") %></span> ','<span class="tau-boardselector__moretext tau-extension-board-tooltip" data-title="'+T("See&nbsp;all&nbsp;boards")+'">More</span>',"</span>","</li>","</ul>","</div>",'<ul class="tau-boardselector__list i-role-list" data-type="main">',"<% _.forEach(this.items, function(board, i){ %>",'<%= fn.sub("board.selector.item", board) %>',"<% }); %>","</ul>","</div>",'<div class="tau-boardselector__group tau-boardselector__group-more i-role-moreitems  i-role-group">','<div class="tau-boardselector__groupheader">','<ul class="tau-boardselector__headermenu">','<li class="tau-boardselector__headermenu__item tau-boardselector__headermenu__item-collapse">','<button class="tau-button-link tau-boardselector__action tau-boardselector__action-collapse tau-extension-board-tooltip i-role-action-collapse">'+T("Hide")+"</button>&nbsp;","</li>",'<li class="tau-boardselector__headermenu__item tau-boardselector__headermenu__item-configure">','<button class="tau-button-link tau-boardselector__action tau-boardselector__action-configure  i-role-action-configure">Customize menu</button>',"</li>",'<li class="tau-boardselector__headermenu__item tau-boardselector__headermenu__item-done">','<button class="tau-button-link tau-boardselector__action tau-boardselector__action-done  i-role-action-done">Finish</button>',"</li>","</ul>","</div>",'<ul class="tau-boardselector__list i-role-list" data-type="more" data-emptyplaceholder="">',"<% _.forEach(this.itemsMore, function(board, i){ %>",'<%= fn.sub("board.selector.item", board) %>',"<% }); %>","</ul>",'<div class="tau-boardselector__listemptyplaceholder">','<p class="tau-boardselector__listemptyplaceholder__arrow"></p>','<p class="tau-boardselector__listemptyplaceholder__default">Use this space to store the boards you use rarely.</p>','<p class="tau-boardselector__listemptyplaceholder__default">Click <strong>Customize Menu</strong> to drag the boards here, or to change their order.</p>','<p class="tau-boardselector__listemptyplaceholder__edit">',"Click <strong>Finish</strong> when done.</p>","</div>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.selector',["Underscore","tau/components/component.creator","tau/models/board.selector/model.board.selector","tau/ui/extensions/board.selector/ui.extension.board.selector.main","tau/ui/extensions/board.selector/ui.extension.board.selector.linkupdater","tau/ui/extensions/board.selector/ui.extension.board.selector.help","tau/ui/extensions/board.selector/ui.extension.board.selector.editable","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/ui/templates/board.selector/ui.template.board.selector"],function(_,ComponentCreator,Model,MainExtension,LinkUpdaterExtension,TooltipExtension,EditableExtension,ExtensionTooltip,Template){return{create:function(config){config=config||{},config["queue.bus"]=!0;var creatorConfig={extensions:[Model,MainExtension,LinkUpdaterExtension,TooltipExtension,EditableExtension,ExtensionTooltip],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/board.startScreen/model.board.startScreen',["Underscore","tau/core/extension.base"],function(_,BaseModel){return BaseModel.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator);var options=_.defaults(initConfig.config.options||{},{boardTemplatesGroupName:"boardTemplates",boardTemplateGroupsGroupName:"boardTemplateGroups",boardsGroupName:"boards"});this.fire("options.ready",options);var def=$.Deferred();configurator.getLoggedUser().isAdministrator?configurator.getRestStorage().select(options.boardsGroupName,{$where:'(publicData.isShared == "true")',$fields:["key"]}).done(function(result){var boards=result.data||[];boards.length==0?def.resolve():def.reject()}):def.reject(),def.done(_.bind(function(){this.fire("dataBind",{})},this)).fail(function(){configurator.getRouting().redirect(configurator.getUrlBuilder().getRelativeBoardUrl("current"))})},"bus configurator.ready:last + options.ready:last + boardsSet.selected":function(evt,configurator,options,setName){var storage=configurator.getRestStorage();storage.select(options.boardTemplateGroupsGroupName,{$fields:["key","publicData.name","publicData.boardTemplateIds"]}).done(_.bind(function(r){var group=_.find(r.data,function(v){return v.name==setName});this.fire("boardTemplateIds.ready",group?group.boardTemplateIds:[])},this))},"bus configurator.ready:last + options.ready:last + boardTemplateIds.ready":function(evt,configurator,options,boardTemplateIds){var storage=configurator.getRestStorage();storage.select(options.boardTemplatesGroupName,{$fields:["key","publicData.name","publicData.definition"]}).done(_.bind(function(r){var templates=r.data;templates=_.map(boardTemplateIds,function(id){return _.find(templates,function(v){return v.key==id})}),this.fire("boardTemplates.ready",templates)},this))},"bus configurator.ready:last + options.ready:last + boardTemplates.ready":function(evt,configurator,options,boardTemplates){var storage=configurator.getRestStorage(),defs=[];_.forEach(boardTemplates,function(item,i){var definition=item.definition||{};definition.name=item.name,definition.viewMode=definition.viewMode||"board",definition.isShared=!0,definition.menuNumericPriority=-100+i,_.forEach(["cells","x","y"],function(axis){definition[axis]=definition[axis]||{types:[]},definition[axis]&&(definition[axis]=_.defaults(definition[axis],{types:[],ordering:{name:null,isDescending:!1},filter:""}))}),definition&&defs.push(function(next){storage.data(options.boardsGroupName,definition.id,{scope:"Public",publicData:definition,userData:{menuIsVisible:1}}).done(function(){next()})})}),defs.unshift(function(next){storage.remove(options.boardsGroupName,{$where:'(publicData.isShared == "true")'}).done(function(){next(!1)})}),_.series(defs,_.bind(function(){this.fire("boardsSet.applied"),defs.length==1&&configurator.setConfig("tmpBoardIsJustAdded",!0),configurator.getRouting().redirect(configurator.getUrlBuilder().getRelativeBoardUrl("current"))},this))}})});
define('tau/ui/extensions/board.startScreen/ui.extension.board.startScreen',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $el=renderData.element;$el.on("click",".i-role-trigger",_.bind(function(evt,el){var $t=$(evt.currentTarget);this.fire("boardsSet.selected",$t.data("type"))},this))}})});
define('tau/ui/templates/board.startScreen/ui.template.board.startScreen',["tau/core/templates-factory"],function(templates){var config={name:"board.startScreen",engine:"jqote2",markup:['<div class="tau-start-screen">','<div class="tau-start-screen__invitation">',"<h1>targetprocess<sup>3</sup></h1>","<h2>Start Your Experiments!</h2>",'<ul class="tau-start-screen__menu">','<li class="tau-start-screen__menu-item-scrum">','<a class="i-role-trigger" data-type="scrum">',"<h3>Scrum</h3>","<p>","Iterate as needed","<br>","until the distillate is clear.","</p>","</a>","</li>",'<li class="tau-start-screen__menu-item-kanban">','<a class="i-role-trigger" data-type="kanban">',"<h3>Kanban</h3>","<p>","Want to keep the flow going?","<br>","Heat to increase throughput.","</p>","</a>","</li>",'<li class="tau-start-screen__menu-item-from-scratch">','<a class="i-role-trigger" data-type="scratch">',"<h3>From Scratch</h3>","<p>","Whip up a custom process.","<br>","Alchemists are welcome!","</p>","</a>","</li>","</ul>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.board.startScreen',["Underscore","tau/components/component.creator","tau/models/board.startScreen/model.board.startScreen","tau/ui/extensions/board.startScreen/ui.extension.board.startScreen","tau/ui/templates/board.startScreen/ui.template.board.startScreen"],function(_,ComponentCreator,Model,ExtensionMain,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionMain],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/tags/tagsProcessor',["tau/core/class"],function(Class){return Class.extend({init:function(configurator){},asArray:function(str){return this._process(str)},asString:function(arr){var tags=this._process(arr);return tags.join(", ")},_process:function(tags){return _.isString(tags)&&(tags=tags.split(",")),tags=_.map(tags,function(token){return _.trim(token)}),tags=_.compact(tags),tags=_.uniq(tags,!1,function(v){return v.toLowerCase()}),tags}})});
define('tau/models/board.templates.editor/model.board.templates.editor',["Underscore","tau/core/extension.base","tau/models/tags/tagsProcessor"],function(_,ExtensionBase,TagsProcessor){return ExtensionBase.extend({"bus beforeInit":function(evt,initData){var configurator=initData.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("dataBind",{}),this.fire("tagsProcessor.ready",new TagsProcessor);var options=_.defaults(initData.config.options||{},{groupName:"boardTemplates"});this.fire("options.ready",options)},"bus boardSettings.ready:last + form.submitted":function(evt,bs){var boardSettings=bs.boardSettings;boardSettings.get({fields:["cells","x","y","zoomLevel","viewMode"],callback:_.bind(function(r){this.fire("boardData.ready",r)},this)})},"bus options.ready:last + configurator.ready:last + tagsProcessor.ready:last + boardData.ready + form.submitted":function(evt,options,configurator,tagsProcessor,boardData,formData){var storage=configurator.getRestStorage(),templateData={name:_.asString(formData.name).trim().slice(0,50),description:_.asString(formData.description).trim().slice(0,255),tags:tagsProcessor.asArray(tagsProcessor.asArray(formData.tags).concat(["custom"])),definition:_.pick(boardData,"cells","x","y","zoomLevel","viewMode"),numericPriority:(new Date).getTime()};templateData.name.length?storage.data(options.groupName,undefined,{scope:"Public",publicData:templateData}).done(_.bind(function(res){this.fire("form.processed",res)},this)):this.fire("form.failed",{name:"Should not be empty"})}})});
define('tau/ui/extensions/board.templates.editor/ui.extension.board.templates.editor',["jQuery","tau/core/extension.base","libs/jquery/jquery.placeholder"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $el=renderData.element;this.fire("$el.ready",$el)},"bus boardSettings.ready + $el.ready":function(evt,bs,$el){var boardSettings=bs.boardSettings,$trigger=$el.find(".i-role-formtrigger"),$form=$el.find("form"),$content=$el.find(".i-role-formholder").detach();$trigger.tauBubble({zIndex:120,content:$content,onShow:function(){$form.find(":text:first").focus(),boardSettings.get({fields:["name"],callback:_.bind(function($form,r){$form.find("[name=name]").val(_.asString(r.name))},this,$form)})}}),this.fire("$form.ready",$form),this.fire("$bubbled.ready",$trigger)},"bus $form.ready":function(evt,$form){$form.placeholder(),$form.on("submit",_.bind(function(e){e.preventDefault();var data={};$form.find(":input").each(function(){data[this.name]=this.value}),this.fire("form.submitted",data)},this))},"bus $bubbled.ready:last + $form.ready:last + form.processed":function(evt,$bubbled,$form){this.fire("notification",{message:"Board template was added"}),$bubbled.tauBubble("hide"),$form.trigger("reset")},"bus $bubbled.ready:last + $form.ready:last + form.failed":function(evt,$bubbled,$form,errors){var $inputs=$form.find(":input");$inputs.removeClass("tau-error"),_.forEach(errors,_.bind(function(text,name){$inputs.filter("[name="+name+"]").addClass("tau-error"),this.fire("error",{message:text})},this)),$inputs.filter(".tau-error:first").focus()}})});
define('tau/ui/templates/board.templates.editor/ui.template.board.templates.editor',["tau/core/templates-factory"],function(templates){var config={name:"board.templates.editor",engine:"jqote2",markup:['<div class="tau-inline-group tau-board-save-template">','<button type="button" class="tau-btn tau-save-template i-role-formtrigger" >',"Save as Template","</button>",'<div class="tau-save-template-form i-role-formholder">',"<form>",'<div class="tau-field"><input type="text" class="tau-in-text" placeholder="Name" name="name"></div>','<div class="tau-field"><textarea placeholder="Description" class="tau-in-text" name="description"></textarea></div>','<div class="tau-field"><input type="text" class="tau-in-text" placeholder="Tags, comma separated" name="tags"></div>','<div class="tau-field"><button class="tau-btn" type="submit">Save</button></div>',"</form>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.board.templates.editor',["Underscore","tau/components/component.creator","tau/models/board.templates.editor/model.board.templates.editor","tau/ui/extensions/board.templates.editor/ui.extension.board.templates.editor","tau/components/extensions/error/extension.errorBar","tau/ui/templates/board.templates.editor/ui.template.board.templates.editor"],function(_,ComponentCreator,Model,ExtensionMain,ExtensionNotification,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionMain,ExtensionNotification],template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/models/board.templates.selector/model.board.templates.selector',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt,initData){var configurator=initData.config.context.configurator,options=_.defaults(initData.config.options||{},{groupName:"boardTemplates",sliceTagsAt:!1});this.fire("configurator.ready",configurator),this.fire("options.ready",options),this.fire("itemsDefault.ready",[])},"bus options.ready + configurator.ready":function(evt,options,configurator){var storage=configurator.getRestStorage();storage.removeAllListeners(this),storage.on("afterInsert",function(data){data.data.$group==options.groupName&&this.fire("refresh")},this),storage.on("afterRemove",function(data){data.data.$group==options.groupName&&this.fire("item.remove.completed",data.data.id)},this),storage.select(options.groupName,{$fields:["key","publicData.name","publicData.description","publicData.tags","publicData.definition","publicData.numericPriority"],$limit:{start:0,max:10}}).done(_.bind(function(r){this.fire("itemsCustom.ready",r.data)},this))},"bus itemsDefault.ready + itemsCustom.ready":function(evt,itemsDefault,itemsCustom){var items=itemsDefault.concat(itemsCustom);_.each(items,function(item,index){item.id=index}),this.fire("items.ready",items)},"bus configurator.ready + options.ready + items.ready":function(evt,configurator,options,items){var tags=[{name:"All",count:99999,isSelected:!0},{name:"Scrum",count:99998},{name:"Kanban",count:99997},{name:"Custom",count:99996}],nTags=_.reduce(items,function(tags,item){return tags.concat(item.tags||[])},[]);nTags=_.groupBy(nTags,function(v){return v.toLowerCase()}),nTags=_.map(nTags,function(v,tag){return{name:v[0],count:v.length}}),tags=tags.concat(nTags),tags=_.uniq(tags,!1,function(v){return v.name.toLowerCase()}),tags=_.sortBy(tags,function(v){return-v.count});var limits=_.reduce(tags,function(limits,tag,i){return limits[i+1]=(limits.length?limits[i]:0)+tag.name.length+5,limits},[0]),lsInBody=($("body").width()-600)/10,pos=limits.indexOf(_.find(limits,function(v){return v>lsInBody})),sliceAt=options.sliceTagsAt||(pos<0?limits.length:pos),appPath=configurator.getApplicationPath(),user=configurator.getLoggedUser();items=_.sortBy(items,"numericPriority"),items=_.map(items,function(v,k){return{id:v.id,name:v.name,description:v.description||"",previewSrc:appPath+"/JavaScript/tau/css/images/board_templates/"+(v.numericPriority<100?v.numericPriority:"default")+".png",access:{remove:k>0&&user.isAdministrator?!0:!1}}});var moreTags=tags.slice(sliceAt);moreTags=_.sortBy(moreTags,function(v){return v.name.toLowerCase()}),this.fire("dataBind",{items:items,tags:tags.slice(0,sliceAt),moreTags:moreTags})},"bus boardSettings.ready:last + items.ready:last + item.selected":function(evt,bs,items,id){var boardSettings=bs.boardSettings,item=items[id];if(!item)return;var definition=item.definition;definition.name=item.name,definition.viewMode=definition.viewMode||"board",_.forEach(["cells","x","y"],function(axis){definition[axis]=definition[axis]||{types:[]},definition[axis]&&(definition[axis]=_.defaults(definition[axis],{types:[],ordering:{name:null,isDescending:!1},filter:""}))}),definition&&boardSettings.setDef({set:definition}).done(_.bind(function(){this.fire("board.template.selected",definition),this.fire("item.selected.completed",id)},this))},"bus configurator.ready:last + options.ready:last + items.ready:last + item.remove":function(evt,configurator,options,items,id){var item=_.find(items,function(v){return v.id==id});if(!item)return;var storage=configurator.getRestStorage();storage.remove(options.groupName,{id:item.id,$key:item.key}).done()},"bus configurator.ready > destroy":function(evt,configurator){var storage=configurator.getRestStorage();storage.removeAllListeners(this)}})});
define('tau/ui/extensions/board.templates.selector/ui.extension.board.templates.selector.main',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({resetLifecycle:!0,"bus afterRender":function(evt,renderData){var $el=renderData.element;this.fire("confirmation.toggle",!0),this.fire("$el.ready",$el),this.fire("$list.ready",$el.find(".tau-templates-body")),this.fire("$items.ready",$el.find(".i-role-item"))},"bus $items.ready":function(evt,$items){var self=this;$items.find(".i-role-tabheader").on("click",function(e){e.stopPropagation(),self.fire("setup.pressed")})},"bus $el.ready:last + $items.ready:last + confirmation.toggle":function(evt,$el,$items,useConfirmation){var self=this,prevConfirmation=$el.data("confirmation");if(prevConfirmation==useConfirmation)return;$items.each(function(){var $item=$(this),id=$item.data("id"),$bubbled=$item.tauBubble({template:['<div class="tau-bubble tau-warning-bubble">','<div class="tau-bubble__inner tau-container"  role="content"></div>',"</div>"].join(""),content:["<h3>This board settings will be reset and new template will be applied. Do you want to do that?</h3>",'<div class="tau-buttons">','<button class="tau-btn tau-attention i-role-actionok">Ok</button>','<button class="tau-btn i-role-actioncancel">Cancel</button>',"</div>"].join(""),onPositionConfig:function(conf){return conf.my="center center",conf.at="center center",conf.offset="0 0",conf},onBeforeShow:function(){if($item.hasClass("tau-template-item-checked"))return!1},onHide:function(){$item.toggleClass("tau-template-item_hover",!1)},onShow:function(){$item.toggleClass("tau-template-item_hover",!0);var $w=$bubbled.tauBubble("widget");$w.unbind("click"),$w.one("click",".i-role-actioncancel",function(){$bubbled.tauBubble("hide")}),$w.one("click",".i-role-actionok",function(){$items.not($item).removeClass("tau-template-item-checked"),$item.toggleClass("tau-template-item-checked",!0),$bubbled.tauBubble("hide"),self.fire("item.selected",id)})},zIndex:130})}),useConfirmation?($items.tauBubble("enable"),$items.unbind("click.boardTemplates")):($items.tauBubble("disable"),$items.on("click.boardTemplates",function(){var $item=$(this),id=$item.data("id");$items.not($item).removeClass("tau-template-item-checked"),$item.toggleClass("tau-template-item-checked",!0),self.fire("item.selected",id)})),$el.data("confirmation",!!useConfirmation)},"bus $el.ready:last + $list.ready:last + $items.ready:last + external.setFocusOnSelected":function(evt,$el,$list,$items){var $item=$items.filter(".tau-template-item-checked");$item.length&&$list.scrollTo($item)},"bus $el.ready:last + $list.ready:last + $items.ready:last + external.selectDefault":function(evt,$el,$list,$items){var $item=$items.first().toggleClass("tau-template-item-checked",!0);$item.length&&$list.scrollTo($item)},"bus $el.ready:last + $list.ready:last + $items.ready:last + external.selectNone":function(evt,$el,$list,$items){$items.filter(".tau-template-item-checked").toggleClass("tau-template-item-checked",!1)}})});
define('tau/ui/extensions/board.templates.selector/ui.extension.board.templates.selector.filter',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var self=this,$form=$el.find("form.i-role-filterform"),$tagInput=$form.find("[name=tag]");$form.on("submit",function(e){e.preventDefault(),self.fire("filter.submitted",$(this).serializeArray())}),$el.delegate("input[name=name]","keyup",function(){$form.submit()}),$el.delegate("input[name=name]","keydown",function(e){e.keyCode==$.ui.keyCode.ESCAPE&&e.stopPropagation(),e.which==$.ui.keyCode.ENTER&&$(this).trigger("blur")});var $more=$el.find(".i-role-moretagstrigger"),$moreList=$el.find(".i-role-moretagslist").detach();$el.on("click",".i-role-tag",function(){var $tag=$(this);$el.find(".i-role-tag.tau-active").not(this).toggleClass("tau-active",!1),$tag.toggleClass("tau-active",!0),$tagInput.val($tag.text()),$form.submit()}),$more.length&&($el.on("click",".i-role-tag",function(){$more.toggleClass("tau-active",!1),$more.text($more.data("labelText"))}),$more.tauBubble({zIndex:130,content:$moreList}),$moreList.find("ul").css("maxHeight",$(window).height()*.4),$moreList.on("click",".i-role-tag",function(){$el.find(".i-role-tag.tau-active").not(this).toggleClass("tau-active",!1);var $tag=$(this),text=$tag.text();$more.toggleClass("tau-active",!0),$more.text(text),$more.tauBubble("hide"),$tagInput.val($tag.text()),$form.submit()}))},matchName:function(source,filter){var index=source.toLowerCase();return filter.length==0||_.any(filter,function(v){return index.indexOf(v)>=0})},matchTag:function(source,filter){var index=source.toLowerCase();return filter.length==0||_.any(filter,function(v){return index==v})},"bus $el.ready:last + items.ready:last + filter.submitted":function(evt,$el,items,filterData){var filter={};_.forEach(filterData,function(v){filter[v.name]=v.value});var indexes={name:_.compact(_.trim(filter.name).toLowerCase().split(/\s+/g)),tag:_.compact(_.trim(filter.tag).toLowerCase()!="all"?[_.trim(filter.tag).toLowerCase()]:[])},matches={name:this.matchName,tag:this.matchTag},$items=$el.find(".i-role-item"),found=0;_.any(indexes,function(v){return v.length>0})?(_.forEach(items,function(item){var matchedByTags=item.tags.length==0&&indexes["tag"].length==0||_.any(item.tags||[],function(v){return matches.tag(v,indexes.tag)}),matchedByName=matches.name(item.name,indexes.name)||matches.name(item.description,indexes.name),matched=matchedByTags&&matchedByName,$item=$items.filter("[data-id="+item.id+"]");matched&&$item.length&&(found+=1),$item.toggleClass("tau-templates-settings__item_filtered_false",!matched),$item.toggleClass("tau-templates-settings__item_filtered_true",matched)}),$el.toggleClass("tau-templates-settings_filtered_none",found==0)):($el.toggleClass("tau-templates-settings_filtered_none",!1),$items.toggleClass("tau-templates-settings__item_filtered_false",!1),$items.toggleClass("tau-templates-settings__item_filtered_true",!1)),this.fire("filter.completed")}})});
define('tau/ui/extensions/board.templates.selector/ui.extension.board.templates.selector.remove',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus $items.ready":function(evt,$items){var self=this;$items.each(function(){var $item=$(this),$trigger=$item.find(".i-role-actionremove"),id=$trigger.parents(".i-role-item:first").data("id"),$bubbled=$trigger.tauBubble({template:['<div class="tau-bubble tau-warning-bubble">','<div class="tau-bubble__arrow"  role="arrow"></div>','<div class="tau-bubble__inner tau-container"  role="content"></div>',"</div>"].join(""),content:["<h3>Do you really want to delete this template?</h3>",'<div class="tau-buttons">','<button class="tau-btn tau-danger i-role-actionok">Delete</button>','<button class="tau-btn i-role-actioncancel">Cancel</button>',"</div>"].join(""),onPositionConfig:function(conf){return conf.my="center top",conf.at="center bottom",conf.offset="-70 0",conf},onHide:function(){$item.toggleClass("tau-template-item_hover",!1)},onShow:function(){$item.toggleClass("tau-template-item_hover",!0);var $w=$bubbled.tauBubble("widget");$w.unbind("click"),$w.one("click",".i-role-actioncancel",function(){$bubbled.tauBubble("hide")}),$w.one("click",".i-role-actionok",function(){$bubbled.tauBubble("hide"),self.fire("item.remove",id)})},zIndex:130})})},"bus $el.ready:last + item.remove.completed":function(evt,$el,id){$el.find(".i-role-item[data-id="+id+"]").remove(),$el.find("form.i-role-filterform").submit()}})});
define('tau/ui/templates/board.templates.selector/ui.template.board.templates.selector',["tau/core/templates-factory"],function(templates){var config={name:"board.templates.selector",engine:"jqote2",markup:['<div class="tau-templates-settings">','<div class="tau-templates-header">','<form class="i-role-filterform">','<span class="tau-inline-group tau-search">','<input type="text" name="name" placeholder="Search templates" class="tau-in-text">','<input type="hidden" name="tag" />','<button type="submit" class="tau-btn tau-search"></button>',"</span>",'<div class="tau-templates-tags">','<ul class="i-role-tagslist">',"<% _.forEach(this.tags, function(item){ %>",'<li class="i-role-tag <% if (item.isSelected) { %>tau-active<% } %>">',"<span>","<%! item.name %>","</span>","</li>","<% }); %>","<% if (this.moreTags.length) { %>",'<li class="tau-more i-role-moretagstrigger" data-label-text="more"><span>more</span></li>',"<% } %>","</ul>","</div>","<% if (this.moreTags.length) { %>",'<div class="tau-template-tags-list  i-role-moretagslist">','<ul class="tau-templates-tags">',"<% _.forEach(this.moreTags, function(item){ %>",'<li class="i-role-tag">',"<span>","<%! item.name %>","</span>","</li>","<% }); %>","</ul>","</div>","<% } %>","</form>","</div>",'<div class="tau-templates-body">',"<% _.forEach(this.items, function(item, k){ %>",'<div class="tau-template-item i-role-item" data-id="<%= item.id %>">',"<% if (item.access.remove){ %>",'<button type="button" class="tau-button-link tau-delete i-role-actionremove" >',"</button>","<% } %>",'<div class="tau-template-preview">','<img height="50" width="83" alt="" src="<%= item.previewSrc %>">','<button type="button" class="tau-btn tau-primary i-role-tabheader" data-label="setup" >',"Setup","</button>","</div>",'<div class="tau-template-name">',"<%! item.name %>","</div>",'<div class="tau-template-desc">',"<%! item.description %>","</div>","</div>","<% }); %>","</div>",'<div class="tau-templates-settings__message" data-text-nofound="No such template found" data-text-noitems="No available templates"></div>',"</div>"]};return templates.register(config)});
define('tau/components/component.board.templates.selector',["Underscore","tau/components/component.creator","tau/models/board.templates.selector/model.board.templates.selector","tau/ui/extensions/board.templates.selector/ui.extension.board.templates.selector.main","tau/ui/extensions/board.templates.selector/ui.extension.board.templates.selector.filter","tau/ui/extensions/board.templates.selector/ui.extension.board.templates.selector.remove","tau/ui/templates/board.templates.selector/ui.template.board.templates.selector"],function(_,ComponentCreator,Model,ExtensionMain,ExtensionFilter,ExtensionRemove,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionMain,ExtensionFilter,ExtensionRemove],template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/models/board.toolbar/model.board.toolbar',["Underscore","tau/core/model-base","tau/models/board.editor/board.filter.help"],function(_,BaseModel,Help){var Model=BaseModel.extend({"bus beforeInit":function(evt){var configurator=evt.data.config.context.configurator,self=this;self.fire("configurator.ready",configurator)},"bus afterInit + boardSettings.ready:last":function(evt){var self=this,settings=_.values(evt)[0].data,boardSettings=_.values(evt)[1].data.boardSettings,loggedUser=self.config.context.configurator.getLoggedUser(),processCallback=function(data,examples){var cells=data.cells||{types:[]};cells.name="cells",data.user&&data.user.cardFilter?cells.filter=data.user.cardFilter:cells.filter="",cells.predefinedFilters=examples,self.fire("cell.types",cells.types);var isOwner=!data.ownerId||data.ownerId==loggedUser.id;self.fire("dataBind",{name:data.name,isShared:data.isShared,viewMode:data.viewMode,cells:cells,zoom:{value:data.zoomLevel,min:settings.config.min,max:settings.config.max},isAdmin:loggedUser.isAdministrator,isOwner:isOwner})};boardSettings.get({fields:["ownerId","user","id","name","isShared","viewMode","zoomLevel","cells"],callback:function(data){(new Help).get({cells:data.cells}).done(function(r){processCallback(data,r.cells||[])})}}),boardSettings.unbind({listener:self}),boardSettings.bind({fields:["cells"],listener:self,callback:function(data){self.fire("cell.types",data.cells.types)}})},"bus configurator.ready:last + user.filter.changed":function(evt,configurator,filter){configurator.service("boardSettings").set({set:{user:{cardFilter:filter}}})},"bus boardSettings.ready:last + destroy":function(evt,data){data.boardSettings.unbind({listener:this})}});return Model});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.editor',["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils","tau/nls/translator"],function($,ExtensionBase,boardUtils,T){return ExtensionBase.extend({"bus boardSettings.ready:last + afterRender":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element;boardSettings.get({fields:["edit"],callback:function(result){$el.find("[role=action-toggle-editor]").toggleClass("tau-checked",!!result.edit)}}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["edit"],listener:this,callback:function(result){$el.find("[role=action-toggle-editor]").toggleClass("tau-checked",!!result.edit)}}),$el.undelegate("[role=action-toggle-editor]","click"),$el.delegate("[role=action-toggle-editor]","click",function(){boardSettings.get({fields:["edit"],callback:function(result){boardSettings.set({set:{edit:!result.edit}})}})})},"bus boardSettings.ready:last+destroy":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings;boardSettings.unbind({listener:this})}})});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.focus',["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils","Underscore"],function($,ExtensionBase,boardUtils,_){return ExtensionBase.extend({"bus boardSettings.ready:last + afterRender":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element,$focusAction=$el.find("[role=action-focus]"),$unfocusAction=$el.find("[role=action-unfocus]"),toggleHighlight=function(btn,highlight){btn.removeClass("tau-btn-active-highlight"),highlight&&btn.addClass("tau-btn-active-highlight")},cb=function(){boardSettings.get({fields:["focus","selectedMarks"],callback:function(res){var selected=_.defaults(res.selectedMarks||{},{x:[],y:[]}),hasSelected=!!selected.x.length||!!selected.y.length;$focusAction.prop("disabled",!hasSelected),toggleHighlight($focusAction,hasSelected);var focused=_.defaults(res.focus||{},{x:[],y:[]}),hasFocused=!!focused.x.length||!!focused.y.length;$unfocusAction.prop("disabled",!hasFocused),toggleHighlight($unfocusAction,hasFocused)}})};boardSettings.unbind({listener:this}),boardSettings.bind({fields:["focus","selectedMarks"],skipSilentCallsFiltering:!0,listener:this,callback:cb}),boardSettings.get({fields:["focus","selectedMarks"],callback:cb});var reaction=function(doFocus){boardSettings.get({fields:["focus","selectedMarks"],callback:function(res){var focus=res.focus||{x:[],y:[]},selectedMarks=res.selectedMarks||{x:[],y:[]};doFocus?(selectedMarks.x.length>0&&(focus.x=selectedMarks.x),selectedMarks.y.length>0&&(focus.y=selectedMarks.y)):focus={x:[],y:[]},boardSettings.set({set:{focus:focus,selectedMarks:{x:[],y:[]}}})}})};$focusAction.on("click",function(){var r=reaction(!0);return $(this).blur(),r}),$unfocusAction.on("click",function(){var r=reaction(!1);return $(this).blur(),r})}})});
define('tau/models/board.toolbar/model.board.toolbar.zoom',["Underscore","tau/core/model-base"],function(_,BaseModel){var ZoomLevelModel=BaseModel.extend({"bus boardSettings.ready":function(evt){var self=this,boardSettings=evt.data.boardSettings;boardSettings.unbind({listener:this}),boardSettings.bind({fields:["zoomLevel"],listener:self,callback:_.bind(self.onZoomLevelUpdated,self)}),boardSettings.get({fields:["zoomLevel"],callback:_.bind(self.onDataReady,self)})},onDataReady:function(result){var value=this.normalize(result.zoomLevel,this.config);this.isValid(value,this.config)&&this.fire("zoom.provided",{value:value})},onZoomLevelUpdated:function(r){var value=this.normalize(r.zoomLevel,this.config);this.isValid(value,this.config)&&this.fire("zoom.provided",{value:value})},"bus boardSettings.ready:last + zoom.updated":function(evt){var boardSettings=_.values(evt)[0].data.boardSettings,zoom=_.values(evt)[1].data,value=this.normalize(zoom.value,this.config);this.isValid(value,this.config)&&boardSettings.get({fields:["zoomLevel"],callback:function(r){r.zoomLevel!=value&&boardSettings.set({set:{zoomLevel:value}})}})},"bus boardSettings.ready + destroy":function(evt){var self=this;self.onDataReady=function(){};var boardSettings=evt["boardSettings.ready"].data.boardSettings;boardSettings.unbind({listener:this})},isValid:function(value,config){return config.hasOwnProperty("min")&&value<config.min?!1:config.hasOwnProperty("max")&&value>config.max?!1:value!=undefined},normalize:function(value,config){if(config.hasOwnProperty("min")&&config.hasOwnProperty("max")){if(value==undefined)return config.defaultValue;if(value<config.min)return this.config.min;if(value>config.max)return config.max}return value}});return ZoomLevelModel});
define('tau/models/board.toolbar/model.board.toolbar.name',["Underscore","tau/core/extension.base"],function(_,BaseModel){return BaseModel.extend({"bus boardSettings.ready":function(evt){var self=this,boardSettings=evt.data.boardSettings;boardSettings.unbind({listener:this}),boardSettings.bind({fields:["name"],listener:this,callback:_.bind(function(r){this.fire("name.provided",{value:r.name})},this)})}})});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.zoom',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$zoomer=$element.find("[role=zoomer]"),config={max:$zoomer.data("zoomMax"),min:$zoomer.data("zoomMin"),animate:!0,change:_.bind(this.onSliderChange,this),value:$zoomer.data("zoomValue")};$zoomer.slider(config)},onSliderChange:function(event,ui){var self=this;self.bus.fire("zoom.updated",{value:ui.value})},"bus afterRender:last+zoom.provided":function(evt){var $element=_.values(evt)[0].data.element,data=_.values(evt)[1].data,$zoomer=$element.find("[role=zoomer]"),prevValue=$zoomer.slider("value");prevValue!=data.value&&$zoomer.slider("value",data.value)}})});
define('libs/jquery/jquery.tau.resetableInput',["libs/jquery/jquery"],function(jQuery){(function($,pluginName){if(pluginName in $.fn)throw new Error('The "'+pluginName+'" jQuery plugin is already defined.');var show=function($el){$el.css("visibility","visible")},hide=function($el){$el.css("visibility","hidden")},iterator=function(options){var $input=$(this);if(!$input.is('input[type="text"]'))return $(this);options=$.extend({cssClass:"",template:'<button type="button" tabindex="-1"></button>',onAttach:function($input,$button){var $wrapper=$('<span class="tau-resetable-input"></span>');$wrapper.insertBefore($input),$input.detach(),$wrapper.append($input).append($button)}},options);var $reseter=$(options.template).addClass(options.cssClass);hide($reseter),options.onAttach($input,$reseter),$input.addClass("i-role-resetable-target"),$reseter.addClass("i-role-resetable-trigger");var timeout=null,toggleButton=function(){$input.val()?show($reseter):hide($reseter)},onActivate=function(){clearTimeout(timeout),timeout=setTimeout(toggleButton,0)},onDeactivate=function(){clearTimeout(timeout),hide($reseter)},$parent=$input.parent(),$selector=".i-role-resetable-target,.i-role-resetable-trigger",handlers={mouseenter:onActivate,mouseleave:onDeactivate},initSubscription=function(){$parent.on(handlers,$selector)},resetSubscription=function(){$parent.off(handlers,$selector),$parent.on(handlers,$selector)},removeSubscription=function(){$parent.off(handlers,$selector)},onFocus=function(){onActivate(),removeSubscription()},onBlur=function(){onDeactivate(),resetSubscription()};return $input.on({keydown:onActivate,input:onActivate,focus:onFocus,blur:onBlur}),initSubscription(),$reseter.on("mousedown",function(evt){if(evt.which!=1)return;return hide($(this)),$input.val("").focus().trigger($.Event("keydown",{keyCode:8})).trigger($.Event("keyup",{keyCode:8})).trigger($.Event("keypress",{keyCode:8})).trigger("input").trigger("clear"),evt.preventDefault(),!1}),$(this)};$.fn[pluginName]=function(options){return $.browser.msie||this.each(function(){iterator.call(this,options)}),this}})(jQuery,"tauResetableInput")});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.userFilter',["jQuery","tau/ui/extensions/board.editor/ui.extension.board.editor.autocomplete","tau/ui/extensions/board.plus/ui.board.plus.utils","Underscore","libs/jquery/jquery.placeholder","libs/jquery/jquery.tau.resetableInput"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $el=renderData.element,$filter=$el.find(".i-role-filter-input");$filter.tauResetableInput().placeholder(),$el.find(".i-role-filter-control").toggleFilter({additionalClass:"tau-boardsettings__filter_hide-toggle",defaultExpand:!0}),this.fire("$form.ready",$el),this.fire("$el.ready",$el)},"bus $el.ready":function(evt,$element){var self=this;$element.on("_change","[name=cells_filter]",function(){var $input=$(this);self.fire("user.filter.changed",$input.val())}),$element.delegate("[name=cells_filter]","clear",function(){var $input=$(this);self.fire("user.filter.changed",$input.val())}),$element.delegate("[name=cells_filter]","keydown",function(e){e.which==$.ui.keyCode.ENTER&&$(this).blur()})},"bus cell.types + afterRender:last + view.dom.ready:last":function(evt,types,data){$("[name=cells_filter]",data.element).prop("disabled",types.length===0),$(".i-role-help",data.element).prop("disabled",types.length===0)}})});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.viewMode',["jQuery","tau/components/extensions/component.extension.base","tau/ui/extensions/board.plus/ui.board.plus.utils"],function($,ExtensionBase,boardUtils){return ExtensionBase.extend({"bus boardSettings.ready:last+afterRender":function(evt,boardSettings,afterRender){var boardSettings=boardSettings.boardSettings,$el=afterRender.element;$el.on("click","[role=action-toggle-viewMode]",function(){boardSettings.set({set:{viewMode:$(this).val()}})})}})});
define('tau/ui/behaviour/common/ui.behaviour.editableText',["Underscore","jQuery"],function(_,$){$.widget("ui.editableText",{_create:function(){this.element.textEditor(this.options)},enable:function(){this.element.data("textEditor").enable()},disable:function(){this.element.data("textEditor").disable()},activate:function(){this.element.data("textEditor").isActive()?this.element.data("textEditor").onBlur():this.element.data("textEditor").onFocus()},setValidationErrors:function(data){this.element.addClass("ui-validationerror"),_.isString(data)&&this.element.attr("title",data)},resetValidationErrors:function(data){this.element.removeClass("ui-validationerror"),this.element.removeAttr("title",data)},setValue:function(value){this.element.text(value)},destroy:function(){}})});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.name',["jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.editableText"],function($,ExtensionBase){return ExtensionBase.extend({"bus boardSettings.ready:last + afterRender":function(evt){function selectText(element){var text=element,selection=window.getSelection(),range=document.createRange();range.selectNodeContents(text),selection.removeAllRanges(),selection.addRange(range)}var boardSettings=_.values(evt)[0].data.boardSettings,$el=_.values(evt)[1].data.element,$nameEl=$el.find("[role=name]"),$nameOutputEl=$el.find("[role=name_output]");this.fire("$nameEl.ready",$nameEl),this.fire("$nameOutputEl.ready",$nameOutputEl);if($nameEl.size()!==1)return;$nameEl.editableText({enabled:!1,restoreText:!0,className:" ",classNameActive:" ",maxLength:40,onSave:function(text){var name=_.trim(text.slice(0,40));$nameEl.editableText("setValue",name),$nameEl.prev().text(name),boardSettings.set({set:{name:name},callback:function(){}})}}),$nameEl.editableText("disable"),boardSettings.get({fields:["edit","isDraft"],callback:function(res){res.edit?($nameEl.editableText("enable"),setTimeout(function(){$nameEl.click(),res.isDraft&&selectText($nameEl[0])},1e3)):$nameEl.editableText("disable")}}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["edit"],listener:this,callback:function(res){res.edit?($nameEl.editableText("enable"),$nameEl.click()):$nameEl.editableText("disable")}})},"bus $nameEl.ready:last + name.provided":function(evt,$el,data){$el.text(data.value)},"bus $nameOutputEl.ready:last + name.provided":function(evt,$el,data){$el.text(data.value)}})});
define('tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.remove',["jQuery","tau/core/extension.base.stateful"],function($,ExtensionBase){return ExtensionBase.extend({"bus boardSettings.ready:last + afterRender":function(evt){var configurator=this.config.context.configurator,boardSettings=evt["boardSettings.ready"].data.boardSettings,$el=evt.afterRender.data.element,$buttonRemove=$el.find("[role=action-remove]");$buttonRemove.tauConfirm({content:["<h3>"+$buttonRemove.data("confirmMessage")+"</h3>"].join(""),callbacks:{success:_.bind(function(){var storage=configurator.getRestStorage(),id=boardSettings.settings.id;storage.remove(boardSettings.getGroupName(),{$key:id}).done(function(){this.fire("remove.board",{board:{id:id}}),configurator.getHistory().exclude(id);var prev=configurator.getHistory().pop(),prevId="current";configurator.getRouting().redirect(configurator.getUrlBuilder().getRelativeBoardUrl(prevId))}.bind(this))},this)},zIndex:130})}})});
define('tau/ui/templates/board.toolbar/ui.template.board.toolbar',["tau/nls/translator","tau/core/templates-factory","tau/ui/templates/board.editor/ui.template.board.editor.filter"],function(T,templates){var config={name:"board.toolbar",engine:"jqote2",markup:['<div class="tau-board-header">','<% var authPrefix = (this.isAdmin || this.isOwner) ? "" : "disabled_"; %>','<div role="name_output" class="i-role-name_output tau-board-name"><%! this.name %></div>','<div role="name"  class="<% if (!(this.isAdmin || this.isOwner)){ %>disabled<% } %>i-role-name tau-board-name-editor"><%! this.name %></div>',"<% if (this.isAdmin || this.isOwner) { %>",'<button type="button" role="action-remove" class="tau-btn tau-attention tau-board-terminator" data-confirm-message="Do you really want to delete this board?">'+T("Remove board")+"</button>","<% } %>",'<%= fn.sub("board.editor.filter", this.cells) %>','<button role="action-toggle-editor" class="tau-btn tau-options tau-board-settings-toggle tau-extension-board-tooltip" data-collapsed-selector=".tau-checked" data-title="'+T("Show&nbsp;board&nbsp;setup")+'" data-title-collapsed="'+T("Hide&nbsp;board&nbsp;setup")+'" type="button"></button>','<span class="tau-inline-group tau-board-view-switch">','<button type="button"  role="action-toggle-viewMode" value="board" class="tau-btn <% if (this.viewMode == "board"){%>tau-checked <% } %>">'+T("board")+"</button>",'<button type="button" role="action-toggle-viewMode" value="list"  class="tau-btn <% if (this.viewMode == "list"){%>tau-checked <% } %>">'+T("view")+"</button>",'<button type="button"  role="action-toggle-viewMode" value="newlist"  class="tau-btn <% if (this.viewMode == "newlist"){%>tau-checked <% } %>">'+T("list")+"</button>",'<button type="button"  role="action-toggle-viewMode" value="timeline"  class="tau-btn <% if (this.viewMode == "timeline"){%>tau-checked <% } %>">'+T("timeline")+"</button>","</span>",'<% if (this.viewMode == "board") { %>','<span class="tau-inline-group tau-focuser">','<button type="button" role="action-focus" data-title="'+T("Show&nbsp;only&nbsp;highlighted&nbsp;cards")+'" disabled=""    class="tau-extension-board-tooltip tau-btn tau-focus-in">focus</button>','<button type="button" role="action-unfocus" data-title="'+T("See&nbsp;all&nbsp;cards")+'" disabled=""  class="tau-extension-board-tooltip tau-btn tau-close tau-focus-out"></button>',"</span>","<% } %>",'<span role="zoomer" class="tau-zoomer ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all"',' data-zoom-value="<%= this.zoom.value %>" ',' data-zoom-min="<%= this.zoom.min || 1 %>" ',' data-zoom-max="<%= this.zoom.max || 6 %>" ',">",'<a href="#" class="ui-slider-handle ui-state-default ui-corner-all tau-extension-board-tooltip" data-title="'+T("Zoom&nbsp;in/out&nbsp;on&nbsp;cards")+'" style="left: 100%;"></a>',"</span>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.toolbar',["Underscore","tau/components/component.creator","tau/models/board.toolbar/model.board.toolbar","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.editor","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.focus","tau/models/board.toolbar/model.board.toolbar.zoom","tau/models/board.toolbar/model.board.toolbar.name","tau/models/board.editor/model.board.filter.help","tau/models/board.editor/model.board.editor.autocomplete","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.zoom","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.userFilter","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.viewMode","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.name","tau/ui/extensions/board.toolbar/ui.extension.board.toolbar.remove","tau/ui/extensions/board.editor/ui.extension.board.editor.help","tau/ui/extensions/board.tooltip/ui.extension.board.tooltip","tau/ui/templates/board.toolbar/ui.template.board.toolbar"],function(_,ComponentCreator,Model,ExtensionEditor,ExtensionFocus,ExtensionZoom,ModelZoom,ModelName,ModelHelp,ModelAutocomplete,ExtUserFilter,ExtensionViewMode,ExtensionName,ExtensionRemove,ExtensionHelpFilter,ExtensionTooltip,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionEditor,ExtensionFocus,ExtensionZoom,ModelZoom,ModelHelp,ModelAutocomplete,ExtUserFilter,ExtensionViewMode,ExtensionName,ExtensionRemove,ExtensionHelpFilter,ExtensionTooltip].concat(config.extensions||[]),template:Template},componentBus=ComponentCreator.create(creatorConfig,config);return componentBus}}});
define('tau/ui/extensions/board.tools.container/ui.extension.board.tools.container.view',["Underscore","jQuery","tau/views/view.container"],function(_,$,ViewBase){return ViewBase.extend({"bus initialize":function(evt){},"bus initialize + boardSettings.ready":function(evt,config,bs){this.startLifeCycle(config,bs.boardSettings)},"bus refresh":function(){this.startLifeCycle()},startLifeCycle:function(evt,boardSettings){boardSettings=boardSettings||this.boardSettings,this.boardSettings=boardSettings;var _s=_.bind(this._super,this);boardSettings.get({fields:["viewMode"],callback:_.bind(function(result){this.config.visible=result.viewMode=="board",_s(evt,boardSettings)},this)}),boardSettings.unbind({listener:this}),boardSettings.bind({fields:["viewMode"],listener:this,callback:_.bind(function(result){this.config&&(this.config.visible=result.viewMode=="board",this.fire(this.config.visible?"show":"hide"))},this)})}})});
define('tau/ui/extensions/board.tools.container/ui.extension.board.tools.container.tabs',["Underscore","jQuery","tau/core/extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator)},"bus afterRender":function(e,renderData){this.fire("$el.ready",renderData.element)},"bus configurator.ready + componentsCreated":function(evt,configurator,childrenBusData){var tabBuses={};_.forEach(childrenBusData,function(childBusData){var config=childBusData.config;_.has(config,"label")&&(tabBuses[config.label]=childBusData.component)}),this.fire("tabBuses.ready",tabBuses)},"bus $el.ready + tabBuses.ready":function(evt,$el,tabBuses){var self=this,$tabHeaders=$el.find(".i-role-tabheaders .i-role-tabheader");$el.on("click",".i-role-tabheader:not(.tau-disabled)",function(){self.fire("tab.activate",$(this).data("label"))}),$tabHeaders.each(function(){var $tabHeader=$(this),label=$tabHeader.data("label");tabBuses[label].fire("$trigger.ready",$tabHeader),$tabHeader.bind("taububbleshow",function(){$tabHeader.toggleClass("tau-checked",!0),self.fire("tab.activate.completed",label)}),$tabHeader.bind("taububblehide",function(){$tabHeader.toggleClass("tau-checked",!1)});var positionConfig={collision:"fit none",my:"right bottom",at:"right top",offset:"0 0"};label=="flowHelp"?$tabHeader.tauBubble("option",{className:"tau-tools-popup",onPositionConfig:function(config){return _.extend(config,positionConfig)}}):label=="overviews"?$tabHeader.tauBubble("option",{className:"tau-tools-popup tau-tools-board-map",onPositionConfig:function(config){return _.extend(config,positionConfig)}}):label=="legend"&&$tabHeader.tauBubble("option",{className:"tau-tools-popup",onPositionConfig:function(config){return _.extend(config,positionConfig)}})})}})});
define('tau/ui/templates/board.tools.container/ui.template.board.tools.container',["tau/core/templates-factory"],function(templates){var config={name:"board.tools.container",engine:"jqote2",markup:["<% var features = this.context.configurator.getFeaturesService(); %>",'<div class="tau-boardtools">','<div class="tau-inline-group tau-boardtools__buttonsholder i-role-tabheaders">','<% if (features.isEnabled("flowHelp")){ %>','<button class="tau-btn tau-boardtools__switcher i-role-tabheader" data-label="flowHelp">Help</button>',"<% } %>",'<button class="tau-btn tau-boardtools__switcher i-role-tabheader" data-label="overviews">Map</button>','<button class="tau-btn tau-boardtools__switcher i-role-tabheader" data-label="legend">Legend</button>',"</div>",'<% if (features.isEnabled("flowHelp")){ %>','<div class="i-role-tab" role="flowHelp" data-label="flowHelp"></div>',"<% } %>",'<div class="i-role-tab" role="overviews" data-label="overviews"></div>','<div class="i-role-tab" role="legend" data-label="legend"></div>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.tools.container',["Underscore","tau/components/component.container","tau/ui/extensions/board.container/ui.extension.board.container.events","tau/ui/extensions/board.tools.container/ui.extension.board.tools.container.view","tau/ui/extensions/board.tools.container/ui.extension.board.tools.container.tabs","tau/ui/templates/board.tools.container/ui.template.board.tools.container"],function(_,Creator,ExtensionEvents,ExtensionView,ExtensionTabs,Template){return{create:function(config){var creatorConfig={extensions:[ExtensionEvents,ExtensionTabs].concat(config.extensions||[]),ViewType:ExtensionView,template:Template};return Creator.create(_.extend(config,creatorConfig))}}});
define('tau/ui/extensions/board.tools.switcher/ui.extension.board.tools.switcher',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({topPadding:150,pagerHeight:0,"bus initialize":function(evt,initConfig){var self=this,options=self._extractOptions(initConfig,{settingsName:"board_tools_visible"}),context=initConfig.context,configurator=context.configurator;self.fire("config.ready",options),self.fire("context.ready",context),self.fire("configurator.ready",configurator)},"bus afterInit":function(evt){var configurator=evt.data.config.context.configurator,self=this;configurator.getComponentBusRegistry().getByName("board_plus").done(function(bus){self.setBoardBus(bus)})},"bus config.ready:last+configurator.ready:last+afterInit":function(evt){var config=_.values(evt)[0].data,configurator=_.values(evt)[1].data,self=this,settingsManager=configurator.getSettingsManager(),settingsName=config.settingsName;settingsManager.get({fields:[settingsName],callback:function(r){var value=!!r[settingsName];self.fire("dataBind",{visibility:value})}})},"bus childComponentCreated":function(evt){var component=evt.data;component.name==="board.tools.container"&&this.setComponentBoardToolsContainer(component)},"bus afterRender":function(evt){var $element=evt.data.element,self=this,$boardMapElement=$element.find("[role=action-switchmap]");this.boadMapPopupConfig={target:$boardMapElement,alignTo:$boardMapElement,zIndex:"",onShow:function(){self.fire("visibility.switched",!1),$boardMapElement.addClass("tau-checked")},onHide:function(){$boardMapElement.removeClass("tau-checked"),self.fire("visibility.switched",!1)},onPositionConfig:function(){var offset="-12 3",position={of:$element,collision:"none none",my:"left bottom",at:"left top",offset:offset};return position},onShow:function(){$boardMapElement.addClass("tau-checked"),$boardMapElement.tauBubble("widget").addClass("tau-tools-popup tau-tools-board-map")},onHide:function(){$boardMapElement.removeClass("tau-checked")},componentsConfig:{components:[{type:"board.tools.container",settingsName:"board_tools_visible",children:[{type:"board.paging",boardName:"board_plus"},{type:"board.overview",boardElement:this.boardElement,width:$.browser.msie?206:207}]}]}},this.calculateAndUpdateHeightOfBoardMapPopup(),this.onWindowResizeHandler=_.bind(this.calculateAndUpdateHeightOfBoardMapPopup,this),$(window).bind("resize",this.onWindowResizeHandler),this.fire("initBubble",this.boadMapPopupConfig);var $legendSwitcher=$element.find("[role=action-switchlegend]"),bubbleConfig={target:$legendSwitcher,alignTo:$legendSwitcher,content:'<div class="tau-card-legend"/>',zIndex:"",onPositionConfig:function(){var position={of:$legendSwitcher,collision:"none none",my:"right bottom",at:"right top",offset:"19 0"};return position},onShow:function(){$legendSwitcher.addClass("tau-checked"),$legendSwitcher.tauBubble("widget").addClass("tau-tools-popup")},onHide:function(){$legendSwitcher.removeClass("tau-checked")}};$legendSwitcher.tauBubble(bubbleConfig)},"bus config.ready:last+configurator.ready:last+visibility.switched":function(evt){var config=_.values(evt)[0].data,configurator=_.values(evt)[1].data,visibility=_.values(evt)[2].data,self=this,settingsManager=configurator.getSettingsManager(),settingsName=config.settingsName,set={};set[settingsName]=visibility,settingsManager.set({set:set,callback:function(r){}})},setBoardBus:function(boardBus){var self=this;this.boardBus&&this.boardBus.removeAllListeners(this),this.boardBus=boardBus,boardBus&&(boardBus.on("overview.board.retrieved",function(e){this.setBoardElement(e.data),this.boadMapPopupConfig&&(this.boadMapPopupConfig.componentsConfig.components[0].children[1].boardElement=self.boardElement)},this),boardBus.on("board.paging.settings",function(evt){var verticalPageNumber=(evt.data.y||{totalPages:1}).totalPages,pagerHeight=(verticalPageNumber>1?verticalPageNumber:0)*18;pagerHeight!=this.pagerHeight&&(this.pagerHeight=pagerHeight,this.calculateAndUpdateHeightOfBoardMapPopup())},this),boardBus.on("overview.board.updated",function(e){this.boardElement==e.data?this.boardOverview&&this.boardOverview.fire("refresh"):this.setBoardElement(e.data)},this),boardBus.fire("overview.board.retrieve"))},setBoardElement:function(boardElement){this.boardElement&&this.boardElement.find(".i-role-grid").unbind("scroll.overview"),this.boardElement=boardElement,boardElement&&this.boardElement.find(".i-role-grid").bind("scroll.overview",_.bind(function(){this.boardOverview&&this.boardOverview.fire("updateVisiblerPosition")},this)),this.boardOverview&&this.boardOverview.fire("setBoardElement",boardElement)},setComponentBoardToolsContainer:function(boardToolsContainer){this.boardToolsContainer&&this.boardToolsContainer.removeAllListeners(this),this.boardToolsContainer=boardToolsContainer,boardToolsContainer&&boardToolsContainer.on("children.ready",function(evt){var overviewBus=_.find(evt.data,function(childData){return childData.config.type=="board.overview"}).bus;this.setBoardOverview(overviewBus)},this)},setBoardOverview:function(boardOverview){this.boardOverview&&this.boardOverview.removeAllListeners(this),this.boardOverview=boardOverview,boardOverview&&boardOverview.on("svg.ready",function(){this.boardToolsContainer.fire("adjustPosition")},this)},setBoardOverviewHeight:function(height){this.boadMapPopupConfig&&(this.boadMapPopupConfig.componentsConfig.components[0].children[1].height=height),this.boardOverview&&this.boardOverview.fire("setHeight",height)},calculateAndUpdateHeightOfBoardMapPopup:function(){var height=$("body").height()-(this.topPadding+this.pagerHeight);this.setBoardOverviewHeight(height)},destroy:function(){this.onWindowResizeHandler&&$(window).unbind("resize",this.onWindowResizeHandler),this.setBoardBus(null),this.setBoardOverview(null),this.setComponentBoardToolsContainer(null),this.setBoardElement(null),this._super.apply(this,arguments)}})});
define('tau/ui/templates/board.tools.switcher/ui.template.board.tools.switcher',["tau/core/templates-factory"],function(templates){var config={name:"board.tools.switcher",engine:"jqote2",markup:['<div class="tau-inline-group tau-boardtools__buttonsholder">','<button role="action-switchmap" class="tau-btn tau-boardtools__switcher">Board Map</button>','<button role="action-switchlegend" class="tau-btn tau-boardtools__switcher">Legend</button>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.board.tools.switcher',["Underscore","tau/components/component.creator","tau/ui/extensions/board.tools.switcher/ui.extension.board.tools.switcher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/board.tools.switcher/ui.template.board.tools.switcher"],function(_,ComponentFactory,ExtensionSwitcher,BubbleCreator,ComponentCreator,Template){return{create:function(config){var creatorConfig={extensions:[ExtensionSwitcher,BubbleCreator,ComponentCreator],template:Template};return ComponentFactory.create(creatorConfig,config)}}});
define('tau/models/model.board.zoomLevel',["Underscore","tau/core/model-base"],function(_,BaseModel){var ZoomLevelModel=BaseModel.extend({"bus boardSettings.ready":function(evt){var self=this,boardSettings=evt.data.boardSettings;boardSettings.unbind({listener:self}),boardSettings.bind({fields:["zoomLevel"],listener:self,callback:_.bind(self.onZoomLevelUpdated,self)}),boardSettings.get({fields:["zoomLevel"],callback:function(r){self.onDataReady(r)}})},onDataReady:function(r){var self=this,data={zoomLevel:r.zoomLevel};self.fire("zoomLevelReady",data),this.config.bindData&&self.fire("dataBind",data),!this.validateZoomLevel(r.zoomLevel)&&this.normalizeZoomLevel(r.zoomLevel)&&this.fire("updateZoomLevel",{zoomLevel:this.normalizeZoomLevel(r.zoomLevel)})},validateZoomLevel:function(zoomLevel){return this.config.hasOwnProperty("min")&&zoomLevel<this.config.min?!1:this.config.hasOwnProperty("max")&&zoomLevel>this.config.max?!1:zoomLevel!=undefined},normalizeZoomLevel:function(zoomLevel){if(this.config.hasOwnProperty("min")&&this.config.hasOwnProperty("max")){if(zoomLevel==undefined)return this.config.defaultValue;if(zoomLevel<this.config.min)return this.config.min;if(zoomLevel>this.config.max)return this.config.max}return zoomLevel},onZoomLevelUpdated:function(r){var self=this;if(!this.validateZoomLevel(r.zoomLevel))return;self.bus.fire("zoomLevelUpdated",r)},"bus boardSettings.ready:last+updateZoomLevel":function(evt){var boardSettings=evt["boardSettings.ready"].data.boardSettings,data=evt.updateZoomLevel.data,zoomLevel=data.zoomLevel;this.validateZoomLevel(zoomLevel)||(zoomLevel=this.normalizeZoomLevel(zoomLevel)),boardSettings.set({set:{zoomLevel:zoomLevel}})},"bus boardSettings.ready+destroy":function(evt){var self=this;self.onDataReady=function(){};var boardSettings=evt["boardSettings.ready"].data.boardSettings;boardSettings.unbind({listener:this})}});return ZoomLevelModel});
define('tau/ui/templates/board.zoomLevel/ui.template.board.zoomLevel',["tau/core/templates-factory"],function(templates){var config={name:"ui.template.board.zoomLevel",engine:"jqote2",markup:['<div class="tau-zoom-level">',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/extensions/board.zoomLevel/ui.extension.board.zoomLevel.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$element=$element.find("[role=zoomer]")},"bus afterRender:last+zoom.provided":function(evt){var $element=evt.afterRender.data.element,data=evt["zoom.provided"].data;$element.slider(config);var config={max:this.config.max,min:this.config.min,animate:!0,change:_.bind(this.onSliderChange,this),value:data.zoomLevel};this.config.bindData||($element=$element.find("[role=zoomer]")),$element.slider(config)},onSliderChange:function(event,ui){this.updateZoomLevel(ui.value)},updateZoomLevel:function(value){var self=this;self.bus.fire("updateZoomLevel",{zoomLevel:value})}})});
define('tau/components/component.board.zoomLevel',["Underscore","tau/components/component.creator","tau/models/model.board.zoomLevel","tau/ui/templates/board.zoomLevel/ui.template.board.zoomLevel","tau/ui/extensions/board.zoomLevel/ui.extension.board.zoomLevel.editable"],function(_,creator,ModelBoardZoomLevel,template,ZoomLevelEditableExtension){return{create:function(config){var creatorConfig={ModelType:ModelBoardZoomLevel,template:template,extensions:[ZoomLevelEditableExtension]};return creator.create(creatorConfig,config)}}});
define('tau/models/model.breadcrumbs',["Underscore","tau/core/model-base"],function(_,ModelBase){var Model=ModelBase.extend({"bus afterInit":function(e){var configurator=this.config.context.configurator;configurator.getRouting().on("stateChanged",function(e){configurator.getHistory().updateCurrent({url:configurator.getRouting().getUrl().source})},this)},"bus currentFound":function(e){this._dataHandler(e.data)},"bus currentUpdated":function(e){var configurator=this.config.context.configurator;configurator.getHistory().updateCurrent(e.data)},_dataHandler:function(data){var self=this,configurator=self.config.context.configurator;if(data){configurator.getHistory().setCurrent(data);var stack=configurator.getHistory().stack,item=_.detect(stack,function(item){return item.id===data.id});if(item){var index=_.indexOf(stack,item);configurator.getHistory().stack=stack.slice(0,index)}}self.fire("stackFound",configurator.getHistory().stack)},"bus beforeInit+stackFound":function(e){var data=_.clone(e.stackFound.data);data=data.slice(-3),this.fire("dataBind",{items:data})},"bus destroy":function(){var configurator=this.config.context.configurator;configurator.getRouting().removeAllListeners(this)}});return Model});
define('tau/models/model.breadcrumbs.entity',["Underscore","tau/core/model-base","tau/core/termProcessor"],function(_,ModelBase,TermProcessor){var initialDataProcessor=function(model,appContext){this.model=model,this.appContext=appContext;var terms=appContext.processes[0].terms;this.termProcessor=new TermProcessor(terms)};initialDataProcessor.prototype={getTitle:function(entity){var parts=[];return _.each(this.fields,function(fieldName){parts.push(entity[fieldName])}),parts.join(" ")},convertToItem:function(entity){var _generateTitle=_.bind(function(entity){var name=this.termProcessor.getTerms(entity.__type).name;return name+" #"+entity.id+" "+this.getTitle(entity)},this);return{id:entity.id,url:this.model.config?this.model.config.context.configurator.getUrlBuilder().getNewViewUrl(entity.id,entity.__type,!0):"",title:_generateTitle(entity)}},onGetEntity:function(result){this.entity=result.data},done:function(){this.model.fire("currentFound",this.convertToItem(this.entity))}};var BreadCrumbsEntityModel=ModelBase.extend({onInit:function(){var self=this,ctx=self.config.context,typeName=ctx.entity.entityType.name,entityId=ctx.entity.id,process=ctx.applicationContext.processes[0],processor=new initialDataProcessor(self,ctx.applicationContext),afterSaveCallback=function(e){e.data.changes.hasOwnProperty("name")&&self.store.get(typeName,{id:entityId,fields:["id","name"]},{success:function(r){self.fire("currentUpdated",processor.convertToItem(r.data))}}).done()};self.store.on({eventName:"afterSave",type:typeName,listener:this},afterSaveCallback);var fields=this.config.fields||["id","name"];processor.fields=_.clone(this.config.fields)||["name"],self.store.get(typeName,{id:entityId,fields:fields},{scope:processor,success:processor.onGetEntity}).done({scope:processor,success:processor.done})}});return BreadCrumbsEntityModel});
define('tau/components/extensions/breadcrumbs/extension.breadcrumbs.items',["tau/components/extensions/component.extension.base"],function(Class){return Class.extend({init:function(config){this._super(config);var self=this;this.historyListener||(this.historyListener=function(){self.fire("refresh")},self.config.context.configurator.getHistory().on("changed",this.historyListener,this))},destroy:function(e){this.historyListener&&this.config.context.configurator.getHistory().removeListener("changed",this.historyListener,this),this._super()}})});
define('tau/ui/templates/breadcrumbs/ui.template.breadcrumbs.item',["tau/core/templates-factory"],function(templates){var config={name:"breadcrumbs-item",markup:['   <li class="ui-breadcrumbs__item"><a href="${url}">${title}</a></li>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/breadcrumbs/ui.template.breadcrumbs',["tau/core/templates-factory","tau/ui/templates/breadcrumbs/ui.template.breadcrumbs.item"],function(templates){var config={name:"breadcrumbs",markup:["{{if items.length}}",'   <ul class="ui-breadcrumbs">','       {{tmpl(items) "breadcrumbs-item"}}',"   </ul>","{{/if}}"],dependencies:["breadcrumbs-item"]};return templates.register(config)});
define('tau/components/component.breadcrumbs',["tau/components/component.creator","tau/models/model.breadcrumbs","tau/models/model.breadcrumbs.entity","tau/components/extensions/breadcrumbs/extension.breadcrumbs.items","tau/ui/templates/breadcrumbs/ui.template.breadcrumbs"],function(creator,Model,ModelCurrentEntity,ItemExtension,template){return{create:function(config){var creatorConfig={extensions:[Model,ItemExtension],template:template};config.disableStoreSubscriptions||creatorConfig.extensions.push(ModelCurrentEntity);var component=creator.create(creatorConfig,config);return config.disableStoreSubscriptions&&component.on("afterInit",function(){this.fire("currentFound",null)}),component}}});
define('tau/ui/extensions/bubble.container/ui.extension.bubble.container',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $el=renderData.element;this.fire("$el.ready",$el)},"bus $el.ready + $trigger.ready":function(evt,$el,$trigger){$trigger.tauBubble({content:$el,zIndex:"",onShow:_.bind(function(){this.fire("show")},this)}),this.fire("$bubbled.ready",$trigger)},"bus $bubbled.ready + componentsCreated":function(evt,$trigger,childrenBusData){$trigger.tauBubble("adjustPosition"),_.forEach(childrenBusData,function(childBusData){var bus=childBusData.component;bus.on("svg.ready",function(){$trigger.tauBubble("adjustPosition")})})},"bus $bubbled.ready:last + $el.ready:last + show.completed":function(evt,$trigger,$el){$trigger.tauBubble("adjustPosition")}})});
define('tau/components/component.bubble.container',["Underscore","tau/components/component.container","tau/ui/extensions/board.container/ui.extension.board.container.events","tau/ui/extensions/bubble.container/ui.extension.bubble.container","tau/views/view.board.container"],function(_,ComponentContainer,BoardContainerExtension,MainExtension,View){return{create:function(config){var creatorConfig={extensions:[BoardContainerExtension,MainExtension].concat(config.extensions||[]),ViewType:config.ViewType||View};return ComponentContainer.create(_.extend(config,creatorConfig))}}});
define('tau/models/model.button',["tau/core/model.editable.base","app.path"],function(ModelBase,AppPath){return ModelBase.extend({onInit:function(){this.fire("dataBind",{label:this.config.label,disabled:this.config.disabled})}})});
define('tau/ui/tags/ui.tag.implode',["Underscore"],function(_){return{register:function(cfg,templateOptionsRef){templateOptionsRef.$tau=templateOptionsRef.$tau||{},templateOptionsRef.$tau.text_implode=function(text){var processed=new String(text);if(_.isString(text))processed=text;else if(_.isArray(text)){var tmp=_.clone(text),last=tmp.pop();processed=_.filter([tmp.join(", "),last],function(s){return s!=0}).join(" &amp; ")}return processed}}}});
define('tau/ui/templates/button/ui.template.button',["tau/core/templates-factory","tau/ui/tags/ui.tag.implode"],function(templates,implodeTag){var config={name:"button",tags:[implodeTag],markup:['<div><button class="tau-btn {{if cssClass}} ${cssClass}{{/if}}" type="button" {{if disabled}}disabled="disabled"{{/if}}>${label}</button></div>'],dependencies:[]};return templates.register(config)});
define('tau/ui/extensions/button/ui.extension.button',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({init:function(){this._super.apply(this,arguments),this.onButtonClickProxy=_.bind(this.onButtonClick,this)},"bus afterRender":function(evt){evt.data.element.find(".ui-button").click(this.onButtonClickProxy)},"bus afterRender:last+enable":function(evt){evt.afterRender.data.element.find("button").prop("disabled",!1)},"bus afterRender:last+disable":function(evt){evt.afterRender.data.element.find("button").prop("disabled",!0)},onButtonClick:function(evt){this.fire("view.button.click")},destroy:function(){this._super.apply(this,arguments),delete this.onButtonClickProxy}})});
define('tau/components/component.button',["Underscore","tau/components/component.creator","tau/models/model.button","tau/ui/templates/button/ui.template.button","tau/ui/extensions/button/ui.extension.button"],function(_,creator,ButtonModel,ButtonTemplate,ButtonBehaviourExtension){return{create:function(config){var creatorConfig={ModelType:ButtonModel,template:ButtonTemplate,extensions:config.extensions||[]};return creatorConfig.extensions=creatorConfig.extensions.concat([ButtonBehaviourExtension]),creator.create(creatorConfig,config)}}});
define('JQuery',["libs/jquery/jquery","libs/jquery/jquery.isSupport","libs/jquery/jquery.ui","libs/jquery/jquery.ui.sortable.performance","libs/jquery/jquery.tmpl","libs/jquery/jquery.mousewheel","libs/jquery/jquery.ui.timepicker","libs/jquery/jquery.ui.confirmation","libs/jquery/jquery.notifyBar","libs/jqote2/jquery.jqote2","libs/jquery/jquery.ui.animateWithCss","libs/jquery/jquery.ui.sprite","libs/jquery/jquery.ui.tauPopup","libs/jquery/jquery.ui.tauBubble","libs/jquery/jquery.ui.tauConfirm","libs/jquery/jquery.ui.position","libs/jquery/jquery.textEditor","libs/jquery/jquery.ui.tauSortable","libs/jquery/jquery.ui.tauSelectable","libs/jquery/jquery.ui.tauProgressIndicator","libs/jquery/jquery.scrollTo","libs/jquery/jquery.gid","libs/jquery/jquery.ui.pscroller","libs/jquery/jquery.ui.rselect","libs/jquery/rhinoslider","libs/respond/respond.min"],function($){return $});
define('tau/models/model.buttonGroup',["Underscore","JQuery","tau/core/model-base"],function(_,$,Class){return Class.extend({"bus afterInit":function(){this.items=this.config.items,this.useMultipleSelection=this.config.selectionMode==="multiple",this.fire("dataBind",{items:this.items})},"bus afterRender":function(e,afterRenderData){var $element=afterRenderData.element,self=this;$element.on("click",function(clickEvt){clickEvt.preventDefault();var data=$(clickEvt.target).data();_.each(self.items,function(item){item.id===data.id&&item.name==data.name?item.isSelected=!0:self.useMultipleSelection||(item.isSelected=!1)}),self.fire("buttonGroup.selectionChanged",{selectedItems:_.select(self.items,function(item){return item.isSelected===!0})}),self.fire("refresh")})}})});
define('tau/ui/templates/ui.template.buttonGroup',["tau/core/templates-factory"],function(templates){var config={name:"buttonGroup",engine:"jqote2",markup:["<% for(var i=0; i<this.items.length; i++){%>",'<button data-id="<%= this.items[i].id %>" data-name="<%= this.items[i].name%>"','class="i-role-selector tau-btn tau-<%=this.items[i].name.toLowerCase()%> <%= (this.items[i].isSelected ? "tau-checked" : "")%>">',"<%= this.items[i].label %>","</button>","<%}%>"]};return templates.register(config)});
define('tau/components/component.buttonGroup',["Underscore","tau/components/component.creator","tau/models/model.buttonGroup","tau/ui/templates/ui.template.buttonGroup"],function(_,creator,ModelType,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:_.clone(config.extensions||[])};return creator.create(creatorConfig,config)}}});
define('tau/views/view.collapsible',["tau/views/view.container"],function(ViewType){var containerView=ViewType.extend({"bus beforeInit":function(evt){var configRef=evt.data.config,collapsed=configRef.collapsed,name=this.bus.name||"unknown";configRef.children=[{id:"header",type:"collapsibleHeader",name:name+" header",collapsed:collapsed,children:configRef.header||[]},{id:"inners",type:"container",name:name+" inner",visible:!collapsed,children:configRef.items||[]}]},"bus childrenRendered":function(evt){var children=evt.data.children,header=children[0],inners=children[1];header.on("expanded",function(evt){inners.fire("show")}),header.on("collapsed",function(evt){inners.fire("hide")})},"bus expand+childrenRendered:last":function(evt){var children=evt.childrenRendered.data.children;children[0].fire("expand")},"bus collapse+childrenRendered:last":function(evt){var children=evt.childrenRendered.data.children;children[0].fire("collapse")}});return containerView});
define('tau/ui/extensions/collapsible/ui.extension.collapsible',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evtArgs){this.element=evtArgs.data.element,evtArgs.data.data.collapsed&&this._collapse()},"bus expand":function(){this._expand()},"bus collapse":function(){this._collapse()},_collapse:function(){this.element.addClass("closed")},_expand:function(){this.element.removeClass("closed")}})});
define('tau/ui/extensions/collapsible/ui.extension.collapsible.state',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evtArgs){var config=this.config=evtArgs.data.config;if(config.hasOwnProperty("stateName")){var state=config[config.stateName];if(_.isNull(state)||_.isUndefined(state))return;var collapsed=state.toString().toLowerCase()=="true";config.collapsed=collapsed,this.collapsed=collapsed}},getStateName:function(){return this.config.stateName},onStateChanged:function(stateObject){var state=stateObject[this.getStateName()];if(_.isNull(state)||_.isUndefined(state))state=this.collapsed;var collapsed=state.toString().toLowerCase()=="true",eventName=collapsed?"collapse":"expand",config=this.config;config.collapsed=collapsed;var stateName=config.stateName;stateName&&(config[stateName]=collapsed),this.fire(eventName)},"bus childrenRendered":function(evt){var children=evt.data.children,header=children[0];header.on("expanded",this.onExpanded,this),header.on("collapsed",this.onCollapsed,this)},onCollapsed:function(){this.saveState(!0)},onExpanded:function(){this.saveState(!1)},saveState:function(collapsed){var stateName=this.getStateName();if(stateName&&this.config[stateName]!=collapsed){var self=this,componentSettings=self.config.context.componentSettings;if(componentSettings){var set={};set[stateName]=collapsed,componentSettings.set({set:set})}}},"bus destroy":function(evt){var self=this,componentSettings=self.config.context.componentSettings;componentSettings&&componentSettings.unbind({listener:self})},"bus initialize":function(evtArgs){var self=this,componentSettings=self.config.context.componentSettings;componentSettings&&componentSettings.bind({fields:[this.getStateName()],listener:self,callback:self.onStateChanged})}})});
define('tau/components/component.collapsible',["Underscore","tau/core/component-base","tau/views/view.collapsible","tau/components/extensions/component.creator.extension","tau/ui/extensions/collapsible/ui.extension.collapsible","tau/ui/extensions/collapsible/ui.extension.collapsible.state","tau/ui/extensions/layout/ui.extension.layout","tau/ui/templates/container/ui.template.container.list"],function(_,ComponentType,ViewType,ComponentCreatorExtension,CollapsibleExtension,CollapsibleStateExtension,LayoutExtension,template){return{create:function(stConf){var config=_.clone(stConf)||{};_.defaults(config,{store:config.context.configurator.getStore(),template:template,cssClass:"ui-collapsible",layout:"list",collapsed:!0});var component=new ComponentType(config);return _.isArray(config.extensions)&&_.each(config.extensions,function(extension){component.attach(extension)}),component.attach(ComponentCreatorExtension).attach(CollapsibleExtension).attach(LayoutExtension).attach(CollapsibleStateExtension).attach(ViewType).bus}}});
define('tau/ui/extensions/collapsibleHeader/ui.extension.collapsibleHeader',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evtArgs){var self=this;self.element=evtArgs.data.element;var data=evtArgs.data.data,isCollapsed=data.collapsed;self.collapsed=isCollapsed;var cssClass=isCollapsed?"collapsed":"expanded";self.element.addClass(cssClass),self.element.bind("click",$.proxy(self._onClickHandler,self))},"bus collapse":function(){var self=this;self.collapsed||self._onClickHandler()},"bus expand":function(){var self=this;self.collapsed&&self._onClickHandler()},_onClickHandler:function(){var self=this;self.collapsed=!self.collapsed;var isCollapsed=self.collapsed,toRemove=isCollapsed?"expanded":"collapsed",toAdd=isCollapsed?"collapsed":"expanded",$element=self.element;$element.removeClass(toRemove),$element.addClass(toAdd),this.fire(toAdd)}})});
define('tau/ui/templates/collapsibleHeader/ui.template.collapsibleHeader',["tau/core/templates-factory"],function(templates){var config={name:"collapsibleHeader",markup:['<div class="ui-collapsible-header">','    <div class="ui-children-container"></div>',"</div>"]};return templates.register(config)});
define('tau/components/component.collapsibleHeader',["Underscore","tau/core/component-base","tau/views/view.container","tau/components/extensions/component.creator.extension","tau/ui/extensions/layout/ui.extension.layout","tau/ui/extensions/collapsibleHeader/ui.extension.collapsibleHeader","tau/ui/templates/collapsibleHeader/ui.template.collapsibleHeader"],function(_,ComponentType,ViewType,ComponentCreatorExtension,LayoutExtension,CollapsibleHeaderExtension,template){return{create:function(config){return config=config||{},_.defaults(config,{template:template,cssClass:"ui-collapsible-header",childrenContainerSelector:".ui-children-container"}),(new ComponentType(config)).attach(ComponentCreatorExtension).attach(LayoutExtension).attach(CollapsibleHeaderExtension).attach(ViewType).bus}}});
define('tau/ui/behaviour/common/ui.behaviour.richeditor',["Underscore","jQuery","tau/configurator"],function(_,$,configurator){function configureHtmlOutput(ev){var editor=ev.editor,dataProcessor=editor.dataProcessor,htmlFilter=dataProcessor&&dataProcessor.htmlFilter;dataFilter=dataProcessor&&dataProcessor.dataFilter;var excludeElements=["head","base","basefont","meta","link","title","style","script","input","isindex","textarea","button","option","select","frameset","frame","iframe","object","embed","applet","bgsound","marque","blink"],rules={elements:{$:function(element){return _.indexOf(excludeElements,element.name)>0?!1:(element.attributes["class"]&&delete element.attributes["class"],element.attributes.id&&delete element.attributes.id,element.attributes.role&&delete element.attributes.role,element)},a:function(element){return _.trim(element.attributes.href).match(/^javascript:/gi)&&(delete element.attributes.href,delete element.attributes["data-cke-saved-href"]),element},style:function(element){return!1},script:function(element){return!1}},attributeNames:[[/^on/,"no"]]};htmlFilter.addRules(rules),dataFilter.addRules(rules)}$.widget("ui.richeditor",{staticExecutionGroups:{},$target:null,$editor:null,$input:null,ckeInstance:null,ckeConfig:{enterMode:3,language:"en",toolbar:[],toolbarStartupExpanded:!1,disableNativeSpellChecker:!1,scayt_autoStartup:!1,removePlugins:"elementspath",resize_enabled:!1,height:150,width:"auto",skin:"v3",resize_dir:"vertical",startupFocus:!0,autoGrow_maxHeight:8e3,extraPlugins:"autogrow",contentsCss:require.toUrl("../css.ext/tau.clientinput.ckeditor.css"),on:{instanceReady:configureHtmlOutput}},options:{validation:{},executionGroupName:null,hideTarget:!0,scrollToButtonBar:!1,placeholder:{className:null,text:null},settings:{},saveAction:{checkChanges:!0,disableIfEmpty:!1,available:!0,text:"Done"},cancelAction:{available:!1,text:"Cancel"},onCreateEditor:function(text){},onStartEdit:function(text){},onStopEdit:function(text){},onSave:function(text){},onBeforeSaveWithClose:function(text){},onSaveWithClose:function(text){},onCancel:function(){}},_create:function(){this.init()},getTemplate:function(){var arr=['<div class="ui-richeditor">','   <textarea class="ui-richeditor__area" style="height:'+this.options.settings.height+'px;"></textarea>','   <div class="ui-richeditor__controls button-group">'],saveOptions=this.options.saveAction;saveOptions.available&&(arr=arr.concat(['<button class="ui-richeditor__controls__save button" type="button">',saveOptions.text,"</button>"]));var cancelOptions=this.options.cancelAction;return cancelOptions.available&&(arr=arr.concat(['<button class="ui-richeditor__controls__cancel button" type="button">',cancelOptions.text,"</button>"])),arr=arr.concat(['       <div class="ui-richeditor__controls__status_message"></div>',"   </div>","</div>"]),arr.join("")},setText:function(text){this.$target.html(text)},setValidationErrors:function(data){this.element.addClass("ui-validationerror"),_.isString(data)&&this.element.attr("title",data)},resetValidationErrors:function(data){this.element.removeClass("ui-validationerror"),this.element.removeAttr("title")},setValue:function(value){this.setText(value)},init:function(){this.$target=$(this.element),this.$target.addClass("editable");var mergedSettings={};$.extend(!0,mergedSettings,this.ckeConfig,this.options.settings),mergedSettings.autoGrow_minHeight=Math.max(this.$target.height(),mergedSettings.height),this.options.settings=mergedSettings,this.options.settings.maxHeight&&(this.options.settings.autoGrow_maxHeight=this.options.settings.maxHeight),this.bindEventsTarget(this.$target),this._applyPlaceholder(this.$target,this.options.placeholder)},_applyPlaceholder:function($el,config){config.className&&$.trim($el.html())===""&&($el.addClass(config.className),$el.text(config.text))},_removePlaceholder:function($el,config){config.className&&$el.hasClass(config.className)&&($el.removeClass(config.className),$el.text(""))},bindEventsTarget:function($el){var shortClick=function($el,handler){return function($el,handler){var prevPageX=null,prevPageY=null;$el.bind("mousedown",function(e){e.which!=3&&(prevPageX=e.pageX,prevPageY=e.pageY)}),$el.bind("mouseup",function(e){if(e.which!=3){var delta=5;prevPageX>e.pageX-delta&&prevPageX<e.pageX+delta&&prevPageY>e.pageY-delta&&prevPageY<e.pageY+delta&&handler.call(this,e),prevPageX=null,prevPageY=null}})}.call(this,$el,handler)},cb=$.proxy(this.showEditor,this),bindEvent=function($el,cb){$el.bind("dblclick",cb)},clearSelection=function(){if(document.selection&&document.selection.empty)document.selection.empty();else if(window.getSelection){var sel=window.getSelection();sel.removeAllRanges()}};bindEvent($el,function(e){clearSelection();if(e.target.tagName.toLowerCase()=="a")return;cb()})},_dataChangeEventHandler:function(evt){var self=this;if(!self._visible)return;var $saveBtn=self.$editor.find(".ui-richeditor__controls__save");window.setTimeout(function(){var data=evt.sender.getData(),isEnabled=data.length>0;$saveBtn.attr("disabled",isEnabled?!1:"disabled"),isEnabled?$saveBtn.removeClass("disable"):$saveBtn.addClass("disable")},150)},__displayEditor:function(){var self=this;self.options.hideTarget&&self.$target.hide(),self.$editor.show();if(self.options.scrollToButtonBar){var $target=self.element.parent().find(".ui-richeditor__controls"),$scrollable=$(".ui-popup-content.tau-container");$scrollable.size()==0&&($scrollable=$(window)),$scrollable.scrollTop($target.offset().top)}},getSettings:function(){return this.options.settings},setSettings:function(settings){this.options.settings=settings},_applyEditor:function(){var self=this;self.$input.parents("body").length?this.ckeInstance?(self.__displayEditor(),this.ckeInstance.setMode("wysiwyg"),this.ckeInstance.setData(this.$input.val())):(self._trigger("beforeapply",this.options.settings),this.initCKEditor(this.$input,this.options.settings,function($input,instance){self.__displayEditor(),self.ckeInstance=instance,self.options.onCreateEditor({api:self});var saveActionSettings=self.options.saveAction;if(saveActionSettings.available&&saveActionSettings.disableIfEmpty){var dataChangeEvents=["contentDom","afterCommandExec","key","insertElement","taukeypress"],handler=$.proxy(self._dataChangeEventHandler,self);for(var i=0,len=dataChangeEvents.length;i<len;i++)instance.on(dataChangeEvents[i],handler)}})):(self.$editor.show(),window.setTimeout(function(){self._applyEditor()},0))},showEditor:function(){var self=this;if(!self._visible){self._visible=!0,self._removePlaceholder(self.$target,self.options.placeholder),self._initText||(self._initText=self.options.hasOwnProperty("text")?self.options.text:self.$target.html()),self.$editor?self.$editor.hide():(self.$editor=self.createEditor(),self.$editor.hide(),self.$editor.insertAfter(self.$target));var groupName=self.options.executionGroupName;return groupName&&(self.staticExecutionGroups[groupName]&&self.staticExecutionGroups[groupName]._innerCancel(),self.staticExecutionGroups[groupName]=self),self.$input.val(self._initText),self._applyEditor(),self.options.onStartEdit({editor:self.$editor,element:self.$input,ckeInstance:self.ckeInstance,initialText:self._initText}),self.$editor}},hideEditor:function(){var $target=this.$target,$input=this.$input,$editor=this.$editor;$input.blur(),$editor.hide(),this.options.hideTarget&&$target.show();var self=this;self._applyPlaceholder(self.$target,self.options.placeholder),this._visible=!1,self.options.onStopEdit({element:self.$input,editor:self.$editor,text:self._initText})},initCKEditor:function($input,config,cb){var ckPath=configurator.getCkPath(),self=this,ckEditor=ckPath+"/ckeditor.js",ckFinder=ckPath+"/ckfinder/ckfinder.js",ckPlugins=ckPath+"/../Javascript/EditView/ckeditor.plugins.js";self.element.addClass("ui-overlay-container");var onLoadCkEditor=function(_){CKEDITOR.tools.indexOf=_.indexOf,CKEDITOR.editor.prototype.resize=function(width,height,isContentHeight,resizeInner){var container=this.container,contents=CKEDITOR.document.getById("cke_contents_"+this.name),outer=resizeInner?container.getChild(1):container;outer.setSize("width",width,!0),!CKEDITOR.env.webkit;var delta=isContentHeight?0:(outer.$.offsetHeight||0)-(contents.$.clientHeight||0);contents.setStyle("height",Math.max(height-delta,0)+"px"),this.fire("resize")},CKEDITOR.replace($input.attr("id"),config);var instance=CKEDITOR.instances[$input.attr("id")];CKFinder.SetupCKEditor(instance,ckPath+"/ckfinder/");var disableSave=function(){self.$editor.find(".ui-richeditor__controls__save").attr("disabled","disabled").addClass("disable")},enableSave=function(){self.$editor.find(".ui-richeditor__controls__save").removeAttr("disabled").removeClass("disable")};instance.on("charcount_limit_reached",disableSave),instance.on("charcount_limit_restored",enableSave),cb($input,instance),self.element.removeClass("ui-overlay-container")};require([ckEditor],function(){require([ckFinder],function(){require(["Underscore",ckPlugins],onLoadCkEditor)})})},createEditor:function(){var $editor=$(this.getTemplate()),$input=this.$input=$editor.find("textarea");return $input.attr("id",_.uniqueId("ui-richeditor__area")),this.bindEventsEditor($editor),$editor},bindEventsEditor:function($editor){var opts=this.options,$save=$editor.find(".ui-richeditor__controls__save"),$cancel=$editor.find(".ui-richeditor__controls__cancel");opts.saveAction.available&&$save.click($.proxy(this._save,this)),opts.cancelAction.available&&$cancel.click($.proxy(this._cancel,this))},_isChangedText:function(text){return text!=this._initText},_allowSave:function(text){var result=!0,shouldCheckChanges=this.options.saveAction.checkChanges;return shouldCheckChanges&&!this._isChangedText(text)&&(result=!1),result},_getValueSanitized:function(){var $input=this.$input;return this.ckeInstance&&this.ckeInstance.updateElement(),$input.val()},performSave:function(callBeforeSaveWithClose){var sanitized=this._getValueSanitized();return this._allowSave(sanitized)?(this._initText=sanitized,this.setText(sanitized),callBeforeSaveWithClose&&this.options.onBeforeSaveWithClose(sanitized),this.options.onSave(sanitized),sanitized):null},_save:function(evt){evt.preventDefault();var sanitized=this.performSave(!0);sanitized!==null?(this.options.onSaveWithClose(sanitized),this.hideEditor()):this._innerCancel()},_cancel:function(evt){evt.preventDefault(),this._innerCancel()},_innerCancel:function(){this.hideEditor(),this.options.onCancel()},destroy:function(){var groupName=this.options.executionGroupName;groupName&&this.staticExecutionGroups[groupName]===this&&(this.staticExecutionGroups[groupName]=null),this.ckeInstance&&(this.ckeInstance.focusManager.forceBlur(),this.ckeInstance.destroy()),this.$editor&&this.$editor.remove()}})});
define('tau/ui/extensions/comments/ui.extension.comment.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,ExtensionBase){var CommentsExtension=ExtensionBase.extend({category:"edit",destroy:function(){this.destroyDynamicComponents(),this._super()},lifeCycleCleanUp:function(){this.destroyDynamicComponents(),this._super()},destroyDynamicComponents:function(){var self=this;self.componentList&&(self.componentList.destroy(),delete self.componentList)},"bus applyTo+permissionsReady":function(evtArgs){var applyToData=evtArgs.applyTo.data,permissions=evtArgs.permissionsReady.data;this.applyPermissions(applyToData.config,applyToData.data,applyToData.element,permissions)},applyPermissions:function(ctrlConfig,ctrlData,ctrlElement,permissions){var self=this,config=this.config=_.extend({},ctrlConfig,{comment:ctrlData}),$element=this.element=ctrlElement,$menu=$('<li class="ui-comment-menu button-group"></li>'),$commentBody=$element.children(".ui-comment-body");if(permissions.editable){$commentBody.addClass("editable");var fnReply=$.proxy(self.onReply,self);$menu.append($('<a class="reply button small"><span class="icon"></span>reply</a>').click(fnReply));var fnEdit=$.proxy(self.onEdit,self);$menu.append($('<a class="edit button small"><span class="icon"></span>edit</a>').click(fnEdit)),$(['<div class="ui-comment-reply">','   <div class="ui-editor-placeholder" style="display: none;"></div>',"</div>"].join("")).insertAfter($commentBody.find(".ui-comment-text"))}if(permissions.deletable){var fnDelete=$.proxy(self.onDelete,self);$menu.append($('<a class="delete button danger small"><span class="icon"></span>delete</a>').click(fnDelete)),$commentBody.addClass("deletable")}$commentBody.find(".ui-comment-heading").append($menu);var $comments=$element.children(".ui-comments"),componentsConfig={components:[{type:"commentList"}],context:config.context};this.componentList||this.createComponents(componentsConfig,function(data){var item=data[0],applyConfig={element:$comments,data:{comments:ctrlData.comments||[]},config:_.extend({},item.config,{commentId:self.config.comment.id})};self.componentList=item.component,item.component.fire("applyTo",applyConfig)})},showEditorForEdit:function(){var self=this,$commentText=this.element.find("> .ui-comment-body > .ui-comment-text"),data=this.element.tmplItem().data;this.showEditor({element:$commentText,text:data.description,checkChanges:!1,saveHandler:function(text){self.fire("saveComment",{description:text})}})},showEditorForReply:function(){var self=this,$replyPlaceHolder=this.element.find("> .ui-comment-body > .ui-comment-reply > .ui-editor-placeholder"),data=this.element.tmplItem().data;self.showEditor({element:$replyPlaceHolder,text:"",hideTarget:!1,saveText:"Add Reply",saveHandler:function(text){self.fire("replyToComment",{description:text,parentId:data.id})}})},showEditor:function(argsConfig){var self=this,fnSaveHandlerWrapper=function(){self.fire("editorSave"),argsConfig.saveHandler.apply(this,arguments)},$element=argsConfig.element,$ckEditor=$element.richeditor({text:argsConfig.text,hideTarget:argsConfig.hideTarget!==!1,executionGroupName:"comments",onSaveWithClose:fnSaveHandlerWrapper,validation:{trim:!0},settings:{toolbar:[["Bold","Italic","Strike"],["NumberedList","BulletedList"],["Link","Unlink"],["Image"],["Source"]],startupFocus:!0,extraPlugins:""},saveAction:{text:argsConfig.saveText||"Save",disableIfEmpty:!0,checkChanges:argsConfig.checkChanges},cancelAction:{available:!0}}),$editorElement=$ckEditor.richeditor("showEditor");this.fire("editorCreated",{editorElement:$editorElement})},onReply:function(evt){var self=this;evt.stopPropagation(),evt.preventDefault(),self.showEditorForReply()},onEdit:function(evt){var self=this;evt.stopPropagation(),evt.preventDefault(),self.showEditorForEdit()},onDelete:function(evt){var self=this,$commentBody=self.element.find("> .ui-comment-body");$commentBody.confirmation({message:"Delete comment?",ok:$.proxy(self.onConfirmDelete,self),cancel:$.proxy(self.onCancelDelete,self)}),$commentBody.confirmation("show")},onCancelDelete:function(evt){evt.stopPropagation(),evt.preventDefault(),this.element.find("> .ui-comment-body").confirmation("hide")},onConfirmDelete:function(evt){evt.stopPropagation(),evt.preventDefault(),this.fire("deleteComment")}});return CommentsExtension});
define('tau/utils/utils.htmlConverter',["tau/configurator","Underscore"],function(configurator,_){return{fromSourceToHtml:function(text){var path=configurator.getApplicationPath()+"/",processed=text||"",r=/(?:<img(?=\s)(?:[^>"']|"[^"]*"|'[^']*')*?\s)src\s*=\s*("~\/([^"]*)"|'~\/([^']*)')(?:[^>]*>)/gi;processed=processed.replace(r,function(el,src,v1,v2){var val=v1||v2,quot=src[0];return el.replace(src,function(){return quot+path+val+quot})});var regexp=/<[^<]+?>/g,tagsPositions=[],match;while((match=regexp.exec(processed))!=null)tagsPositions.push({left:match.index,right:match.index+match[0].length});return processed.replace(/\w[\xa0]+\w/g,function(str,pos){return _.find(tagsPositions,function(tagPos){return tagPos.left<=pos&&tagPos.right>=pos})?str:str.replace(/[\xa0]/g," ")})},fromHtmlToSource:function(text){var path=configurator.getApplicationPath(),processed=text||"",s='(?:<img(?=\\s)(?:[^>"\']|"[^"]*"|\'[^\']*\')*?\\s)src\\s*=\\s*("'+path+'/([^"]*)"|\''+path+"/([^']*)')(?:[^>]*>)",r=new RegExp(s,"gi");return processed=processed.replace(r,function(el,src,v1,v2){var val=v1||v2,quot=src[0];return el.replace(src,function(){return quot+"~/"+val+quot})}),processed},replacePlainTextUrlWithHTML:function(html){var $el=$("<div/>");$el.html(html);var placeholders=[];$el.find("a, img").each(function(index,item){var $origin=$(item),placeholderId="_link_"+index;placeholders.push({origin:$origin,placeholderId:placeholderId}),$origin.replaceWith($('<div id="'+placeholderId+'" />'))});var contentHtml=$el.html();return contentHtml=contentHtml.replace(/\b(((http|ftp)[s]?):\/\/)([0-9a-z-?!(){}\[\]^|$,"*\.@;&:%_\/\\\\+~#=`]+)/gi,function(url){var filename=url.split("?")[0],index=arguments[arguments.length-2],original=arguments[arguments.length-1],lookForSpecialCasesBehind=function(index,original){var char1="",char2="";while(index>1){var c=original.substring(index-1,index);if(c.search(/\S/)>-1)if(char2=="")char2=c;else if(char1==""){char1=c;break}index-=1}return char2=="="||char1=="="&&char2=='"'||char1=="="&&char2=="'"};return lookForSpecialCasesBehind(index,original)?url:filename&&filename.search(/\.(jpg|gif|png|jpeg)$/)>-1?"<img style='max-width: 600px' src='"+url+"'>":"<a href='"+url+"' target='_blank'>"+url+"</a>"}),$el.html(contentHtml),$.each(placeholders,function(index,item){$el.find("#"+item.placeholderId).replaceWith(item.origin)}),$el.html().replace(/&amp;/g,"&")}}});
define('tau/models/dataprocessor/model.processor.comment',["tau/utils/utils.htmlConverter","tau/utils/utils.date"],function(htmlConverter,dateUtils){function commentConverter(context){this.context=context}return commentConverter.prototype={destroy:function(){this.context=null},convertDTO:function(comment){var self=this,commentData={id:comment.id,parentId:comment.parentId,avatar:[comment.owner.avatarUri,"32"].join(""),name:self.getName(comment.owner),description:htmlConverter.fromSourceToHtml(comment.description),age:this.getAge(comment.createDate),createDate:dateUtils.format.datetime.short(dateUtils.convertToTimezone(comment.createDate)),comments:[],deleted:"DELETED"===comment.description,isRequester:comment.owner.kind&&comment.owner.kind.toString().toLowerCase()==="requester"};return this.context&&this.context.getLoggedUser().id==comment.owner.id&&(commentData.isOwnerComment=!0),commentData},getName:function(commentOwner){var firstName=commentOwner.firstName||"",lastName=commentOwner.lastName||"",result="";if(firstName.length>0||lastName.length>0)result=[firstName," ",_.trim(lastName).substring(0,1),"."].join("");return result},getAge:function(commentCreateDate){if(!commentCreateDate)return"Draft";var result=dateUtils.getAge(dateUtils.parse(commentCreateDate));return result.isZero?"Just added":result.toString()}},commentConverter});
define('tau/models/model.comment.editable',["Underscore","tau/core/model.editable.base","tau/models/dataprocessor/model.processor.comment"],function(_,ModelBase,CommentProcessor){var EditableCommentModel=ModelBase.extend({name:"Editable Comments","bus applyTo":function(evt){var data=this.bindedData=evt.data.data;this.authorizate(data)},authorizate:function(data){var deleted=this.bindedData.deleted,permissions={editable:!deleted,deletable:!0};this.fire("permissionsReady",permissions)},_convertDTO:function(serverData){var config=this.config,parentCommentId=config.parentCommentId,converter=new CommentProcessor(config.context),commentDTO=converter.convertDTO(_.extend({},serverData));return commentDTO.parentId=parentCommentId,commentDTO},"bus afterInit":function(evtArgs){var self=this,loggedUser=self.config.context.getLoggedUser();this.config=evtArgs.data.config,this.config.store.get("user",{id:loggedUser.id,fields:["id","firstName","lastName","kind","avatarUri"]}).done($.proxy(function(args){var serverData={id:null,description:"",owner:args[0].data},draftComment=self._convertDTO(serverData);self.bindedData=draftComment,self.fire("dataBind",draftComment)},this))},_fireUpdate:function(commentId,$set){var self=this;$set.general={id:self.config.context.entity.id},self.fire("save",{id:commentId,typeName:"comment",$set:$set,$include:["id","description","createDate","parentId",{owner:["id","firstName","lastName","kind","avatarUri"]}]})},"bus saveComment":function(evt){var self=this,$set=evt.data,commentId=this.bindedData.id;self._fireUpdate(commentId,$set)},"bus replyToComment":function(evt){var self=this,$set=evt.data;self._fireUpdate(null,$set)},"bus deleteComment":function(){var comment=this.bindedData,commentId=comment.id;comment.comments&&comment.comments.length>0?this._fireUpdate(commentId,{description:"DELETED"}):this.fire("remove",{id:commentId,typeName:"comment"})}});return EditableCommentModel});
define('tau/ui/extensions/comments/ui.extension.comment.practices.notification',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){var commentsExtension=ExtensionBase.extend({category:"edit",beforeSaveComment:function(cmdData){var $checkbox=this.placeHolder.find('input[type="checkbox"]'),settings={};$checkbox.each(function(i,el){var $el=$(el);$el.attr("checked")&&(settings[$el.val()]=!0)}),cmdData.cmd["comment-practices-notification-opts"]=settings},"bus editorSave":function(){if(!this.globalSettings.IsEmailNotificationsEnabled)return;var self=this;self.config.store.on({eventName:"beforeSave",type:"comment",listener:self},function(e){var cmdData=e.data;self.beforeSaveComment(cmdData)})},"bus editorCreated":function(evt){this.globalSettings=this.config.context.applicationContext.globalSettings||{};if(!this.globalSettings.IsEmailNotificationsEnabled)return;var $editor=evt.data.editorElement;this.placeHolder=$editor.find(".tau-notification-practices-settings");if(!this.placeHolder.length){var $notificationSettings=this.placeHolder=$('<div class="tau-notification-practices-settings"><span class="prompt">Notify by email: </span></div>');$notificationSettings.append("<input type='checkbox' id='owner' value='Owner' /><label for='owner'>Owner</label>"),$notificationSettings.append("<input type='checkbox' id='people' value='Assigned' /><label for='people'>Assigned people</label>"),this.config.context.entity.entityType.name.toLowerCase()==="request"?$notificationSettings.append("<input type='checkbox' id='requestor' value='Requesters' /><label for='requestor'>Requester(s)</label>"):$notificationSettings.append("<input type='checkbox' id='team' value='Team' /><label for='team'>Project Team</label>"),$notificationSettings.insertBefore($editor.find(".ui-richeditor__controls"))}},"bus destroy":function(){this.config.store.unbind(this),this._super.apply(this,arguments)}});return commentsExtension});
define('tau/ui/templates/comments/ui.template.comments.comment',["tau/core/templates-factory"],function(templates){var config={name:"comments-comment",markup:['<div class="ui-comment comment-id-${id}">','   <div class="ui-comment-body{{if isOwnerComment }} ui-commets-comment-owner{{/if}}{{if isRequester }} tau-comments-requester{{/if}}" >',"      {{if deleted}}","      DELETED","      {{else}}",'      <div class="ui-comment-heading">','         <li class="ui-comment-avatar" style=\'background-image:url("${avatar}")\'></li>','         <li class="ui-comment-name">${name}</li>','         <li class="ui-comment-ago"><span title="${createDate}">(${age})</span></li>',"      </div>",'      <div class="ui-comment-text">{{html description}}</div>',"      {{/if}}","   </div>",'   <div class="ui-comments">',"       {{if comments }}",'           {{tmpl(comments) "comments-comment"}}',"       {{/if}}","   </div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.comment',["tau/components/component.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/comments/ui.extension.comment.editable","tau/models/model.comment.editable","tau/ui/extensions/comments/ui.extension.comment.practices.notification","tau/ui/templates/comments/ui.template.comments.comment"],function(creator,ExtensionComponentCreator,EditableExtension,EditableModelType,NotificationPractice,template){return{create:function(config){var creatorConfig={extensions:[EditableModelType,EditableExtension,NotificationPractice,ExtensionComponentCreator],template:template};return creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/comments/ui.extension.comments.new.editor',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,ExtensionBase){var NewEditorCommentExtension=ExtensionBase.extend({category:"edit",destroy:function(){this.$ckEditor.richeditor("destroy"),this._super()},"bus afterRender":function(evtArgs){this.element=evtArgs.data.element,this.initializeEditor()},onSave:function(commentText){var self=this;self.fire("editorSave"),self.fire("saveComment",{description:commentText}),self.closeEditor()},onCancel:function(evt){this.closeEditor()},closeEditor:function(){this.fire("destroy")},initializeEditor:function(){var self=this;this.$editorPlaceHolder=this.element.find(".ui-comment-text"),this.$ckEditor=this.$editorPlaceHolder.richeditor({executionGroupName:"comments",onSave:$.proxy(self.onSave,self),onCancel:$.proxy(self.onCancel,self),validation:{trim:!0},scrollToButtonBar:!0,settings:{toolbar:[["Bold","Italic","Strike"],["NumberedList","BulletedList"],["Link","Unlink"],["Image"],["Source"]],startupFocus:!0,extraPlugins:""},saveAction:{text:"Add comment",disableIfEmpty:!0},cancelAction:{available:!0}});var $editorElement=this.$ckEditor.richeditor("showEditor");this.fire("editorCreated",{editorElement:$editorElement})}});return NewEditorCommentExtension});
define('tau/ui/templates/comments/ui.template.comments.comment.new.editor',["tau/core/templates-factory"],function(templates){var config={name:"comments-comment-new-editor",markup:['<div class="ui-comment-new">','    <div class="ui-comment-heading">',"        <div class=\"ui-comment-avatar\" style='background:url(${avatar}) top left no-repeat;width:32px; height:32px;'></div>","    </div>",'    <div class="ui-comment-editor-placeholder">','        <div class="ui-comment-text"></div>',"    </div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.comment.new.editor',["tau/components/component.creator","tau/components/extensions/component.creator.extension","tau/models/model.comment.editable","tau/ui/extensions/comments/ui.extension.comments.new.editor","tau/ui/extensions/comments/ui.extension.comment.practices.notification","tau/ui/templates/comments/ui.template.comments.comment.new.editor"],function(creator,ExtensionComponentCreator,EditableModelType,NewCommentEditor,NotificationPractice,template){return{create:function(config){var creatorConfig={extensions:[EditableModelType,NewCommentEditor,NotificationPractice,ExtensionComponentCreator],template:template};return creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/comments/ui.extension.commentList.editable',["tau/components/extensions/component.extension.base","tau/ui/templates/comments/ui.template.comments.comment"],function(ExtensionBase,commentTemplate){var commentListEditable=ExtensionBase.extend({destroy:function(){this.destroyDynamicComponents(),this._super()},lifeCycleCleanUp:function(){this.destroyDynamicComponents(),this._super()},destroyDynamicComponents:function(){var self=this;if(self.dynamicComponents&&self.dynamicComponents.length){var item=null;while(item=self.dynamicComponents.pop())item.destroy()}},"bus applyTo":function(evt){var self=this;self.dynamicComponents=[];var data=evt.data,comments=data.data.comments;this.element=data.element;var $comments=data.element.children(".ui-comment");this.config=data.config;var context=data.config.context,componentsConfig={components:[],context:context};$comments.each(function(i){componentsConfig.components.push({type:"comment"})}),self.createComponents(componentsConfig,function(data){for(var i=0,len=data.length;i<len;i++){var item=data[i],applyConfig={element:$comments.eq(i),data:comments[i],config:item.config};item.component.fire("applyTo",applyConfig),self.dynamicComponents.push(item.component)}})}});return commentListEditable});
define('tau/components/component.commentList',["tau/components/component.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/comments/ui.extension.commentList.editable"],function(componentCreator,CreatorExtension,EditableCommentList){return{create:function(config){var creatorConfig={extensions:[CreatorExtension,EditableCommentList]};return config.name="comment.commentList",componentCreator.create(creatorConfig,config)}}});
define('tau/ui/extensions/baseList/ui.extension.baseList',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt){var cfg=evt.data.config;this.options={emptyDataMessage:cfg.emptyDataMessage||"No data",contentSelector:cfg.contentSelector||null,emptyElementCssClass:cfg.emptyElementCssClass||"ui-empty-data-msg"}},"bus dataBind+afterRender":function(evtArgs){this.element=evtArgs.afterRender.data.element,evtArgs.dataBind.data.items.length===0&&this._applyToggleNoData(!0)},"bus hideListContent":function(evtArgs){this._applyToggleNoData(!0)},"bus showListContent":function(evtArgs){this._applyToggleNoData(!1)},_applyToggleNoData:function(showMsg){this._toggleNoData(showMsg)},_getVisibilityMethodName:function(show){return show?"show":"hide"},_toggleNoData:function(showMsg){var contentMethod=this._getVisibilityMethodName(!showMsg),messageMethod=this._getVisibilityMethodName(showMsg),$el=this.element,opt=this.options;$el.find(opt.contentSelector)[contentMethod](),this._getNoDataMessageElement($el,opt)[messageMethod]()},_getNoDataMessageElement:function($el,options){var result=$el.find("."+options.emptyElementCssClass);return result.length===0&&(result=$(['<span class="',options.emptyElementCssClass,'">',options.emptyDataMessage,"</span>"].join("")).appendTo($el)),result}})});
define('tau/components/component.list.creator',["tau/components/component.creator","tau/ui/extensions/baseList/ui.extension.baseList"],function(componentCreator,BaseListExtension){return{create:function(configCreator,componentConfig){return componentConfig.emptyDataMessage=configCreator.message,componentConfig.contentSelector=configCreator.template.options.contentSelector,configCreator.showEmptyMessage!==!1&&(configCreator.extensions=configCreator.extensions||[],configCreator.extensions.push(BaseListExtension)),componentCreator.create(configCreator,componentConfig)}}});
define('tau/models/model.comments',["Underscore","tau/core/model-base","tau/models/dataprocessor/model.processor.comment","tau/utils/utils.date","tau/store/types.targetprocess"],function(_,ModelBase,CommentProcessor,dateUtils){function initialDataProcessor(model,converter){this.model=model,this.converter=converter}initialDataProcessor.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},onAssignableRetrieved:function(result){this.assignable=this.model.assignable=result.data;var rawData=result.data.comments,sortedComments=_(rawData).sortBy(function(item){return+dateUtils.parse(item.createDate)}),commentsTree=this.convertDTO(sortedComments).convertToTree(null);this.model.bus.fire("dataBind",{items:commentsTree})},convertDTO:function(rawComments){var self=this;return this.convertedComments=_(rawComments).map(function(rawItem){return self.converter.convertDTO(rawItem)}),this},convertToTree:function(parentCommentId){var result=[],dtoComments=this.convertedComments;for(var i=0,len=dtoComments.length;i<len;i++){var item=dtoComments[i];item.parentId==parentCommentId&&(result.push(item),item.comments=this.convertToTree(item.id))}return result}};var modelComments=ModelBase.extend({name:"Comments",onInit:function(){var assignable=this.config.context.entity;this.converter=new CommentProcessor(this.config.context);var dataProcessor=new initialDataProcessor(this,this.converter);this.store.get(assignable.entityType.name,{id:assignable.id,fields:["id",{comments:["id","description","createDate","parentId",{owner:["id","firstName","lastName","kind","avatarUri"]}],list:!0}]},dataProcessor.getAssignableRetrievedCallback()).done()},"bus createDTO":function(evt){var data=evt.data,commentDTO=this.converter.convertDTO(data);commentDTO.comments=[],this.fire("DTOCreated",commentDTO)},destroy:function(){this.converter.destroy(),this.converter=null,this._super()}});return modelComments});
define('tau/models/model.comments.editable',["Underscore","tau/core/model.editable.base"],function(_,ModelBase){var modelComments=ModelBase.extend({name:"Editable Comments",_signUpEventsIfRequired:function(){var self=this;if(self._signedUp)return;self._signedUp=!0;var beforeSaveCallback=function(evt){evt.data.cmd.guid=+(new Date),self.fire("prepareUpdate",evt.data)},afterSaveCallback=function(evt){self.fire("applyUpdate",evt.data)},beforeRemoveCallback=function(evt){evt.data.cmd.guid=+(new Date),self.fire("prepareRemove",evt.data)},afterRemoveCallback=function(evt){var parentCommentId=evt.data.obj.parentId,parentComment=self.getComment(parentCommentId);parentComment&&parentComment.deleted&&parentComment.comments.length===1?self.store.remove("comment",{id:parentCommentId}).done():self.fire("applyRemove",evt.data)};self.store.unbind(self),self.store.on({eventName:"beforeSave",type:"comment",listener:self},beforeSaveCallback).on({eventName:"afterSave",type:"comment",listener:self},afterSaveCallback).on({eventName:"beforeRemove",type:"comment",listener:self},beforeRemoveCallback).on({eventName:"afterRemove",type:"comment",listener:self},afterRemoveCallback)},"bus dataBind":function(evt){var commentsTree=evt.data.items;this.commentsList=this.getPlainList(commentsTree);var ids=_(this.commentsList).pluck("id"),permissions={editable:!0,editableItems:ids,deletable:!0,deletableItems:ids},self=this;self._signUpEventsIfRequired(),self.fire("permissionsReady",permissions)},getComment:function(commentId){var result=commentId?_(this.commentsList).detect(function(obj){return obj.id===commentId}):null;return result},getPlainList:function(comments){var arrComments=[];for(var i=0,len=comments.length;i<len;i++){var cmt=comments[i];arrComments.push(cmt);var innerComments=arguments.callee.call(this,comments[i].comments);arrComments=arrComments.concat(innerComments)}return arrComments}});return modelComments});
define('tau/ui/extensions/ui.extension.shortcutProcessor',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.htmlConverter"],function(_,$,BaseExtension,htmlConverter){return BaseExtension.extend({"bus beforeInit + afterRender":function(evt,initConfig,renderData){var $el=renderData.element,contentSelector=initConfig.config.shortcutProcessorTarget,$content=$el.find(contentSelector),store=initConfig.config.context.configurator.getStore(),entitiesIds=[],self=this,re=/\b(?:id):(?:\W|&nbsp;){0,5}(\d+)\b/gi;$content.each(function(i,item){var $item=$(item),itemHtml=$item.html(),changed=!1;itemHtml=itemHtml.replace(re,function(){changed=!0;var id=arguments[1];return entitiesIds.push(id),"<span class='tau-shortcut-loading' data-entity-id='"+id+"'>id:"+id+"</span>"});var processedHtml=htmlConverter.replacePlainTextUrlWithHTML(itemHtml);itemHtml!=processedHtml&&(itemHtml=processedHtml,changed=!0),changed&&$item.html(itemHtml)}),entitiesIds=_.uniq(entitiesIds);var self=this;entitiesIds.length?(_.forEach(entitiesIds,function(id){store=store.get("general",{id:id,fields:["id","name",{entityType:["id","name"]}],silent:!0},{success:function(res){self.fire("shortcut.readyToInsert",res.data)}})}),store.done(function(){self.fire("shortcuts.completed",{})})):this.fire("shortcuts.completed",{})},"bus beforeInit:last + afterRender:last + shortcut.readyToInsert":function(obj,initConfig,renderData,shortcut){var $el=renderData.element,$link=$("<a/>").attr("href",initConfig.config.context.configurator.getUrlBuilder().getNewViewUrl(shortcut.id,shortcut.entityType.name,!0)).html("#"+shortcut.id+"&nbsp;"+$.jqotenc(shortcut.name));$el.find("[data-entity-id="+shortcut.id+"]").each(function(){$(this).replaceWith($link.clone())})}})});
define('tau/ui/extensions/comments/ui.extension.comments.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/templates/comments/ui.template.comments.comment"],function(_,$,ExtensionBase,commentTemplate){var commentsExtension=ExtensionBase.extend({category:"edit",destroy:function(){var self=this;self.destroyDynamicComponents(),self._super()},destroyDynamicComponents:function(){var self=this;self.commentListComponent&&(self.commentListComponent.destroy(),delete self.commentListComponent)},"bus dataBind+afterRender":function(evtArgs){var self=this;self.destroyDynamicComponents();var commentsData={comments:evtArgs.dataBind.data.items},$element=this.element=evtArgs.afterRender.data.element,selector=".ui-all-comments",$commentListElementToApply=$element.find(selector),config={components:{type:"commentList"},context:this.config.context};self.createComponents(config,function(componentsData){self.commentListComponent=componentsData[0].component;var applyConfig={element:$commentListElementToApply,data:commentsData,config:config};self.commentListComponent.fire("applyTo",applyConfig)})},getGUIDSelector:function(guid){return"guid-comment-"+guid},getCommentIdClass:function(id){return"comment-id-"+id},"bus prepareUpdate":function(evt){var cmd=evt.data.cmd,$targetComment=null,parentId=cmd.config.$set.parentId,containerSelector=".ui-all-comments"+(parentId?" ."+this.getCommentIdClass(parentId)+" .ui-comments":""),guidClass=this.getGUIDSelector(cmd.guid);if(!cmd.config.id)$targetComment=$("<div class='ui-comment "+guidClass+"'><div class='ui-comment-body'>Adding new comment. Please wait...</div></div>").appendTo(this.element.find(containerSelector));else{var idCssClass=this.getCommentIdClass(cmd.config.id);$targetComment=this.element.find(".ui-all-comments ."+idCssClass)}this.fire("markElementToBeUpdated",{element:$targetComment})},"bus applyUpdate":function(evt){var self=this,cmd=evt.data.cmd,guid=cmd.guid,idCssClass=this.getCommentIdClass(evt.data.id);if(!cmd.config.id){var guidClass=this.getGUIDSelector(guid),$targetCommentElement=this.element.find(".ui-all-comments").find("."+guidClass);$targetCommentElement.addClass(idCssClass).removeClass(guidClass)}this.on("afterRender",function(evt){evt.removeListener();var $comments=evt.data.element,$updatedComment=$comments.find("."+idCssClass+" > .ui-comment-body");self.fire("updateElement",{element:$updatedComment})}),this.fire("refresh")},"bus prepareRemove":function(evt){var cmd=evt.data.cmd,idCssClass=this.getCommentIdClass(cmd.config.id),$comment=this.element.find(".ui-all-comments ."+idCssClass);this.fire("markElementToBeDeleted",{element:$comment})},"bus applyRemove":function(evt){var self=this,cmd=evt.data.cmd,idCssClass=this.getCommentIdClass(cmd.config.id),$comment=this.element.find(".ui-all-comments ."+idCssClass);this.fire("deleteElement",{element:$comment,callback:function(){self.fire("refresh")}})}});return commentsExtension});
define('tau/ui/extensions/comments/ui.extension.comments.add',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,ExtensionBase){var addCommentExtension=ExtensionBase.extend({category:"edit",destroy:function(){var self=this;self.destroyDynamicComponents(),self._super()},lifeCycleCleanUp:function(){var self=this;self.destroyDynamicComponents(),self._super()},destroyDynamicComponents:function(){var self=this;self.commentNewEditorComponent&&(self.commentNewEditorComponent.destroy(),delete self.commentNewEditorComponent)},"bus initialize":function(evtArgs){this.config=evtArgs.data},"bus afterRender+permissionsReady+dataBind":function(evtArgs){this.element=evtArgs.afterRender.data.element;var permissions=evtArgs.permissionsReady.data;this.data=evtArgs.dataBind.data,this.initializeAddCommentLink()},initializeAddCommentLink:function(){this.$addLink=$("<span class='ui-comments-add-link'>Add Comment</span>").click($.proxy(this.addNewComment,this)).insertAfter(this.element.find(".ui-all-comments"))},onCloseEditor:function(evt){this.$addLink.show()},addNewComment:function(){var self=this;self.$addLink.hide();var componentsConfig={components:[{type:"comment.new.editor"}],context:self.config.context};self.createComponents(componentsConfig,function(data){var component=self.commentNewEditorComponent=data[0].component;component.on("afterRender",function(evt){var $newComment=evt.data.element;$newComment.insertAfter(self.$addLink)}),component.on("destroy",$.proxy(self.onCloseEditor,self)),component.initialize()})}});return addCommentExtension});
define('tau/ui/templates/comments/ui.template.comments',["tau/core/templates-factory","tau/ui/templates/comments/ui.template.comments.comment"],function(templates){var config={name:"comments",options:{contentSelector:".ui-comments-content"},markup:['<div class="box ui-comments-control">','   <div class="ui-all-comments ui-comments-content">','       {{tmpl(items) "comments-comment"}}',"   </div>","</div>"].join(""),dependencies:["comments-comment"]};return templates.register(config)});
define('tau/components/component.comments',["Underscore","tau/components/component.list.creator","tau/components/extensions/component.creator.extension","tau/models/model.comments","tau/models/model.comments.editable","tau/ui/extensions/ui.extension.shortcutProcessor","tau/ui/extensions/comments/ui.extension.comments.editable","tau/ui/extensions/comments/ui.extension.comments.add","tau/ui/templates/comments/ui.template.comments"],function(_,creator,ExtensionComponentCreator,ModelType,EditableModelType,ShortcutProcessorExtension,EditableExtension,ExtensionAdd,template){return{create:function(config){var creatorConfig={extensions:_.concat([ModelType,EditableModelType,ShortcutProcessorExtension,EditableExtension,ExtensionAdd,ExtensionComponentCreator,config.extensions]),template:template,showEmptyMessage:!1};return config.shortcutProcessorTarget=".ui-comment-text",creator.create(creatorConfig,config)}}});
define('tau/models/model.customField',["Underscore","tau/core/model-base","tau/utils/utils.htmlConverter","tau/utils/utils.date"],function(_,ModelBase,htmlConverter,dateUtils){var customFieldsModel=ModelBase.extend({_process:function(conf,config){var urlBuilder=this.config.context.configurator.getUrlBuilder(),processor={RichText:function(conf){return conf.value=htmlConverter.fromSourceToHtml(conf.value),conf},Date:function(conf){return conf.value=dateUtils.format.date.short(dateUtils.convertToTimezone(conf.value)),conf.output=conf.value,conf},DropDown:function(conf){return conf.options=this._getOptions(conf),conf.value=_.asString(conf.value),conf.output=_.asString(conf.value),conf},Entity:function(conf){return conf.value=conf.value||{},conf.options=this._getOptions(conf),conf.value=_.defaults(conf.value,{id:null,name:"",kind:null}),conf.value.__type=conf.value.kind,conf.value.url=conf.value.__type?urlBuilder.getNewViewUrl(conf.value.id,conf.value.__type,!0):null,conf.output=conf.value.name+"",conf},MultipleSelectionList:function(conf){return conf.options=this._getOptions(conf),conf.value?(conf.value=_.asString(conf.value).split(","),conf.output=conf.value.join(", ")):(conf.value=null,conf.output=""),conf},Number:function(conf,context){return conf.value=(conf.value||_.isNumber(conf.value)?parseFloat(conf.value)+"":"").replace(".",context.applicationContext.culture.decimalSeparator),conf.output=conf.value,conf},URL:function(conf){return conf.value=conf.value||{},_.defaults(conf.value,{url:"",title:""}),conf.options=null,conf},TemplatedURL:function(conf){conf.value=conf.value||"",conf.isEmpty=conf.value==="";var choices=_.compact(conf.value.split(/\s*,\s*/g)),template=conf.options||"";return choices=_.map(choices,function(choice){return{title:choice,url:template.replace("{0}",choice)}}),conf.output=choices,conf},_getOptions:function(conf){return conf.options?_.asString(conf.options).split("\r\n"):[]}};return conf.type in processor&&(conf=processor[conf.type](conf,config.context)),conf.type!="url",conf},createConfiguration:function(sourceField,entity,processFields,entityFields,config){var fieldFromProcess=_.find(processFields,function(field){return field.type.toLowerCase()==sourceField.type.toLowerCase()&&field.name==sourceField.name}),fieldFromEntity=_.find(entityFields,function(field){return field.type.toLowerCase()==sourceField.type.toLowerCase()&&field.name==sourceField.name}),targetConfiguration={};if(fieldFromProcess&&fieldFromEntity)targetConfiguration={name:fieldFromEntity.name,type:fieldFromEntity.type,required:fieldFromProcess.required,listed:fieldFromProcess.listed,value:fieldFromEntity.value,options:fieldFromProcess.value,output:fieldFromEntity.value},targetConfiguration=this._process(targetConfiguration,config);else{if(!fieldFromProcess||!!fieldFromEntity)throw new Error("No valid configuration for field "+sourceField.name);targetConfiguration={name:fieldFromProcess.name,type:fieldFromProcess.type,required:fieldFromProcess.required,listed:fieldFromProcess.listed,value:null,options:fieldFromProcess.value,output:null},targetConfiguration=this._process(targetConfiguration,config)}return targetConfiguration},"bus configurationProvided":function(evt){var configuration=evt.data;_.isEmpty(configuration)==0&&this.fire("dataBind",configuration),this.configuration=configuration},"bus beforeInit":function(evt){var config=evt.data.config;this.store=config.store?config.store:this.store;var entity=config.context.entity,processFields=config.context.getCustomFields(),customField=config.customField||config.data,self=this,sourceField={name:customField.name,type:customField.type};this.store.get(entity.entityType.name,{id:entity.id,fields:["id","customFields"]}).done({success:function(result){var entityFields=result[0].data.customFields,configuraton=self.createConfiguration(sourceField,entity,processFields,entityFields,config);self.fire("configurationProvided",configuraton)}})}});return customFieldsModel});
define('tau/models/model.customField.editable',["Underscore","tau/core/model.editable.base"],function(_,ModelBase){var editableModel=ModelBase.extend({category:"edit",name:"Editable custom field","bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0,deletable:!0})},"bus beforeSave":function(evt){var val=evt.data.cmd.$set.customFields[0].value;evt.data.cmd.$set.customFields[0].value=val?val:null,evt.data.cmd.$set.customFields[0].type=="URL"&&val.label==null&&val.url==null&&(evt.data.cmd.$set.customFields[0].value=null)},"bus beforeInit+configurationProvided":function(evt){var entity=evt.beforeInit.data.config.context.entity,field=evt.configurationProvided.data;this.configuration=field,this.beforeSaveHandler||(this.beforeSaveHandler=_.bind(this._beforeSave,this),this.store.on({eventName:"beforeSave",type:entity.entityType.name,listener:this,hasChanges:["customFields"],filter:{id:entity.id}},this.beforeSaveHandler)),this.afterSaveHandler||(this.afterSaveHandler=_.bind(this._afterSave,this),this.store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,hasChanges:["customFields"],filter:{id:entity.id}},this.afterSaveHandler))},_beforeSave:function(evt){var changedField=evt.data.changes.customFields[0];_.mergeFields(evt.data.cmd.config.fields,["customFields"]);var currentField=this.configuration;changedField.name==currentField.name&&changedField.type==currentField.type&&this.bus.fire("preRefreshRow",{data:changedField})},_afterSave:function(evt){this.bus.fire("refreshRow",{})},destroy:function(){this.beforeSaveHandler=null,this.afterSaveHandler=null,this._super()}});return editableModel});
define('tau/core/tau-widget',["Underscore","jQuery","tau/core/event"],function(_,$,event){var widget=function(name,obj){var createFn=obj._create||function(){};obj._create=function(){var self=this;createFn.apply(self,arguments),self.bus=self.options.bus||self.element.data("bus"),event.subscribeOn(self)},_.extend(obj,{_fire:function(){this.bus.fire.apply(this.bus,arguments)}}),$.widget(name,obj)};return{widget:widget}});
define('tau/ui/behaviour/checkbox/ui.behaviour.checkboxToggle',["jQuery","tau/core/tau-widget"],function($,tau){tau.widget("ui.checkboxToggle",{options:{onSave:function(){},classNames:{checked:"checked",unchecked:"unchecked"}},_create:function(){this.init()},init:function(){var $el=this.element;this.toggleProxy=$.proxy(this.onClick,this),$el.click(this.toggleProxy)},activate:function(){var c=this.options.classNames;this._toggle(this.element,c.checked,c.unchecked),this.options.onSave(this.element.hasClass(c.checked))},onClick:function(evt){evt.stopPropagation(),this.toggle()},toggle:function(){var $el=this.element,c=this.options.classNames;this._toggle($el,c.checked,c.unchecked),this.options.onSave($el.hasClass(c.checked))},_toggle:function($el,first,second){var $switcher=$el;$switcher.hasClass(first)?($switcher.removeClass(first),$switcher.addClass(second)):$switcher.hasClass(second)?($switcher.removeClass(second),$switcher.addClass(first)):$switcher.addClass(first)},destroy:function(){delete this.toggleProxy}})});
define('tau/ui/behaviour/customField/ui.behaviour.customField.row',["Underscore","jQuery"],function(_,$){$.widget("ui.behaviourCustomFieldRow",{options:{onActivate:$.noop},_create:function(){var $element=this.element;this.$element=$element;var self=this;$element.click(function(e){e.preventDefault(),self.options.onActivate.call(this,e)})},setValidationErrors:function(data){var $form=this.$element;_.each(data,function(value,name){$form.find("[name="+name+"]").addClass("ui-editableText-validationerror").attr("title",value)})},resetValidationErrors:function(data){this.$element.find(":text").removeClass("ui-editableText-validationerror").attr("title",null)},setValue:function(data){var $form=this.$element;_.each(data,function(value,name){$form.find("[name="+name+"]").val(value)})},destroy:function(){}})});
define('tau/components/extensions/customField/extension.customField.checkbox.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/checkbox/ui.behaviour.checkboxToggle","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $row=eventData.afterRender.data.element,$widget=$row.find(".ui-customfield__value");$widget.checkboxToggle({classNames:{checked:"ui-customfield__value_checked",unchecked:"ui-customfield__value_unchecked"},onSave:function(text){$widget.removeClass("ui-validationerror"),self.bus.fire("elementUpdated"),self.bus.fire("save",{customFields:[{name:fieldData.name,type:fieldData.type,value:text}]})}}),$row.behaviourCustomFieldRow({onActivate:function(e){e.stopPropagation(),$(e.target).hasClass("ui-customfield__value")==0&&$widget.checkboxToggle("activate")}}),$row.addClass("ui-customfield_editable_true")}}})});
define('tau/ui/extensions/customField/ui.extension.customField.required',["Underscore","tau/components/extensions/component.extension.base"],function(_,ModelBase){var editableModel=ModelBase.extend({category:"view",name:"Required custom field","bus afterRender+beforeInit+dataBind":function(evt){var data=evt.dataBind.data;if(evt.beforeInit.data.config.customField&&evt.beforeInit.data.config.customField.required){var value=data.value;value&&(value.hasOwnProperty("url")?value=value.url:value.hasOwnProperty("id")&&(value=value.id)),!_.isBoolean(value)&&!_.isNumber(value)&&_.isEmpty(value)&&(evt.afterRender.data.element.find(".ui-customfield__value").addClass("ui-validationerror"),evt.afterRender.data.element.attr("title","Required field"))}}});return editableModel});
define('tau/ui/templates/customField/ui.template.customField.checkbox',["tau/core/templates-factory"],function(templates){var config={name:"customField-checkbox",markup:['<div class="ui-customfield ui-customfield-checkbox">',"   <table>","   <tbody>","   <tr>",'       <td class="ui-customfield__label">${name}</td>','       <td class="ui_custom_field_value_container"><div class="ui-customfield__value ui-customfield__value_{{if value}}checked{{else}}unchecked{{/if}}">&nbsp;</div></td>',"   </tr>","   </tbody>","   </table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.checkbox',["tau/components/component.creator","tau/models/model.customField","tau/models/model.customField.editable","tau/components/extensions/customField/extension.customField.checkbox.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/ui/templates/customField/ui.template.customField.checkbox"],function(creator,ModelType,ModelTypeEditable,ExtensionEditable,RequireCustomField,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[ModelTypeEditable,RequireCustomField,ExtensionEditable]};return creator.create(creatorConfig,config)}}});
/* objecttools
 *
 * JavaScript Object and JSON reference utilities
 * Copyright 2011 Andreas Kalsch
 */

define('libs/schema.js/lib/objecttools',["require","exports","module"],function(require,exports,module){typeof global=="undefined"&&typeof window=="object"&&(window.global=window),Object.keys||(Object.keys=function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)obj.hasOwnProperty.call(obj,key)&&(keys[keys.length]=key);return keys});var __id=0,specialObjectKeys=["$ref","$refs","$$refs"],objecttools={},find=objecttools.find=function(object,path){var key,obj=object;for(var li=path.length,i=0;i<li;i++){if((key=path[i])===undefined)break;if(!((obj instanceof Object||obj instanceof Array)&&key in obj))return;obj=obj[key]}return obj},__registry={},id=objecttools.id=function(object){if(object instanceof Object)return object.hasOwnProperty("__id")||(object.__id=__id++),object.__id;return},resetRefs=objecttools.resetRefs=function(object){if(object instanceof Object){var refs=getRefs(object);return refs?(refs.splice(0),refs):(refs=[],object instanceof Array?object.push({$$refs:refs}):object.$refs=refs,refs)}return null},getRefs=objecttools.getRefs=function(object){if(object instanceof Object)return object instanceof Array&&object[object.length-1]&&object[object.length-1].$$refs instanceof Array?object[object.length-1].$$refs:object.hasOwnProperty("$refs")?object.$refs:null;return null},addRef=objecttools.addRef=function(object,toPath,fromPath){var refs=getRefs(object);if(!refs)throw new Error("You need to call resetRefs(object) first!");return refs.push(toPath),refs.push(fromPath),refs},findRefs=objecttools.findRefs=function(object){var fromPathById={},toPath=[],refs=resetRefs(object),self=function(obj){if(!(obj instanceof Object))return;var _id=id(obj);if(fromPathById[_id]!==undefined){refs.push([].concat(toPath)),refs.push(fromPathById[_id]);return}fromPathById[_id]=["#"].concat(toPath);if(object instanceof Array){for(var li=object.length,i=0;i<li;i++)toPath.push(i),self(obj[i]),toPath.pop();return}for(var ks=Object.keys(obj),li=ks.length,i=0,key;key=ks[i],i<li;i++){if(specialObjectKeys.indexOf(key)>-1)continue;toPath.push(key),self(obj[key]),toPath.pop()}};return self(object),object},resolveRefs=objecttools.resolveRefs=function(object,isTrustedSource){var refs,isArray=object instanceof Array;if(isArray){var last=object[object.length-1];last instanceof Object&&last.$refs instanceof Array&&(refs=last.$refs)}else object instanceof Object&&object.$refs instanceof Array&&(refs=object.$refs);if(!refs)return object;var to,to_last,from,from_first,obj;for(var li=refs.length,i=0;i<li;i+=2){to=[].concat(refs[i]),from=[].concat(refs[i+1]),to_last=to.pop(),from_first=from.shift();if(to_last===undefined||from_first===undefined)continue;obj=find(object,to);if(!obj)continue;from_first!=="#"&&from.unshift(from_first);if(from_first!=="#"&&!isTrustedSource)continue;obj[to_last]=find(from_first==="#"?object:global,from),refs.splice(i,2),i-=2,li-=2}return object};module.exports={},typeof module=="object"&&module.exports&&(module.exports=objecttools)});
define('libs/schema.js/lib/utils',["require","exports","module"],function(require,exports,module){var slice=Array.prototype.slice,hasOwnProperty=Object.hasOwnProperty;Object.keys||(Object.keys=function(obj){if(obj!==Object(obj))throw new Error("Invalid object");var keys=[];for(var key in obj)hasOwnProperty.call(obj,key)&&(keys[keys.length]=key);return keys}),exports.extend=function(obj){var args=slice.call(arguments,1),source;for(var i=0,ii=args.length;i<ii;i++){source=args[i];for(var prop in source)obj[prop]=source[prop]}return obj},exports.locale=function(obj,locale){if(obj instanceof Object){locale=""+locale||"en";if(obj[locale]!==undefined)return obj[locale];parts=locale.split("_");while(parts.pop()){locale=parts.join("_");if(obj[locale]!==undefined)return obj[locale]}return obj.en}return obj}});
define('libs/schema.js/lib/schema',["require","exports","module","./utils","./objecttools"],function(require,exports,module){var utils=require("./utils"),objecttools=require("./objecttools");module.exports=function(){var env=this,Schema=this.Schema=function(rawSchema){typeof rawSchema=="string"&&(rawSchema=JSON.parse(rawSchema));if(rawSchema instanceof Schema)return rawSchema;utils.extend(this,rawSchema),this.id===undefined&&(this.id=""+Schema._id++),Schema.instances[this.id]=this};utils.extend(Schema.prototype,{validate:function(instance,options){var data=new env.Validation(this,instance,options);return delete data.instance.__id,data},setFallbacks:function(_fallbacks){return typeof _fallbacks=="string"?this.fallbacks=env.Validation[_fallbacks]:_fallbacks===undefined?this.fallbacks=env.fallbacks:this.fallbacks=utils.extend({},env.fallbacks,_fallbacks),this}}),utils.extend(Schema,{_id:1,create:function(rawSchema){if(typeof rawSchema=="string")var rawSchema=JSON.parse(rawSchema);var validation=env.schemaSchema.validate(rawSchema);if(validation.isError())throw console.log(validation.getError()),validation.getError();return validation.instance},createSeveral:function(schemaDict){for(var key in schemaDict)schemaDict[key].id===undefined&&(schemaDict[key].id=key),schemaDict[key]=this.create(schemaDict[key]);return schemaDict},instances:{},resolveRefs:function(){for(var id in this.instances)objecttools.resolveRefs(this.instances[id],!0)}})}});
define('libs/schema.js/lib/validation',["require","exports","module","./utils","./objecttools"],function(require,exports,module){var utils=require("./utils"),objecttools=require("./objecttools"),locale=utils.locale,slice=Array.prototype.slice;module.exports=function(){var env=this,detectRecursion=this.detectRecursion,Validation=this.Validation=function(schema,instance,options){options=options||{},this._flags={},this._errors={},this._wasError=0,this._stack=[],this.path=[],this.id=Validation._id++,this.schema,this.push(schema),this.instance=instance,this.locale=env.locale||"en",this.detectRecursion=options.detectRecursion||detectRecursion,this.errors=[];var validation=this,_Error=this.Error=function(attribute,description,moreInfo){this.schema=validation.schema,this.path=validation.path?[].concat(validation.path):[],this.attribute=attribute||"",this.description=typeof description=="object"?locale(description,validation.locale)(this):description||"",moreInfo&&utils.extend(this,moreInfo),validation._errors[this.id()]||(validation._errors[this.id()]=!0,validation.errors.push(this)),validation._wasError++};_Error.prototype.toJSON=function(){return{path:this.path,name:this.attribute,description:this.description}},_Error.prototype.id=function(){return[this.path,undefined,this.attribute]+""},this.instance=this.start(instance),delete this._flags,this._errors,this._wasError,this._stack,this.path,this.id};utils.extend(Validation.prototype,{isError:function(){return this.errors.length>0},getError:function(){if(this.errors.length===0)return null;var e=new Error(locale(env.i18n("validation_error"),this.locale)(this));return e.errors=this.errors,e.toJSON=function(){return{message:this.message,errors:this.errors}},e},wasError:function(){var was=this._wasError;return this._wasError=0,was},push:function(schema,key){this.schema=schema,this._stack.push(schema),key!==undefined&&this.path.push(key)},pop:function(omitKey){var ret=[this._stack.pop(),omitKey?undefined:this.path.pop()],len=this._stack.length;return this.schema=len?this._stack[len-1]:null,ret},getFlag:function(instance){return objecttools.id(instance)+"_"+this.schema.id},flagObject:function(instance){return this._flags[this.getFlag(instance)]=!0,instance},isObjectFlagged:function(instance){return this.getFlag(instance)in this._flags},callPlugin:function(plugin,instance){var args=arguments.length>2?slice.call(arguments,1):[instance];return typeof plugin!="function"&&(plugin=Validation.plugins[plugin]||Validation.plugins.addError),plugin.apply(this,args)}}),utils.extend(Validation,{_id:1,registerPlugins:function(plugins){utils.extend(Validation.plugins,plugins)},plugins:{addError:function(instance,errorName){return new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance}}}),require("./"+this.v+"/validation").call(this)}});
/* schema.js
 *
 * Sophisticated JSON schema data validation and adaptation
 * Copyright 2010-2011 Andreas Kalsch
 */

define('libs/schema.js/lib/environment',["require","exports","module","./objecttools","./utils","./schema","./validation"],function(require,exports,module){var objecttools=require("./objecttools"),utils=require("./utils"),slice=Array.prototype.slice,extend=utils.extend,locale=utils.locale,Environment=function(id,options){var env;if(typeof id=="object")options=id;else{if(Environment.instances[id])return Environment.instances[id];env=this,this.id=id,Environment.instances[id]=this}options=options||{};var _i18n=options.i18n||["../i18n/default"];_i18n instanceof Array||(_i18n=[_i18n]);var i18n=this.i18n=function(id){return i18n[id]||{en:function(){return""}}},part;for(var i=0,ii=_i18n.length;i<ii;i++)part=_i18n[i],typeof part=="object"?extend(i18n,part):extend(i18n,require(part));delete options.i18n,this.locale=options.locale||"en",delete options.locale,this.v="draft-02",delete options.v,this.detectRecursion=options.detectRecursion===undefined?!0:options.detectRecursion,delete options.detectRecursion,require("./schema").call(this);var Schema=this.Schema;Schema.v=this.v,require("./validation").call(this);var Validation=this.Validation,fallbacks=options.fallbacks||"TOLERANT_FALLBACKS";typeof fallbacks=="object"?this.fallbacks=extend(Validation.STRICT_FALLBACKS,fallbacks):this.fallbacks=Validation[fallbacks],delete options.fallbacks,extend(this,options),require("./"+this.v+"/setupSchemaSchema").call(this);var validation=this.schemaSchema.validate(this.schemaSchema,{detectRecursion:!0});if(validation.isError())throw console.log("The core schema is not valid!"),validation.getError()};extend(Environment.prototype,{validateCall:function(func,context){if(func.SCHEMA instanceof this.Schema){var v=func.SCHEMA.validate(slice.call(arguments,2)),args=v.instance;if(v.isError())throw v.getError();return func.apply(context,args)}throw"No SCHEMA defined"},validateCallAsync:function(func,context){if(!(func.SCHEMA instanceof this.Schema))throw"No SCHEMA defined";var args=slice.call(arguments,2),_cb=args.pop(),v=func.SCHEMA.validate(args),args=v.instance;if(v.isError())return _cb(v.getError());args.push(_cb),func.apply(context,args)},f:function(schema,isValidating,isAsync,func){var args=slice.call(arguments),func=args.pop();if(args.length===0)return func.IS_ASYNC=!1,func;if(schema instanceof Object){var isValidating=!!args[1],schema=this.Schema.create(schema),isAsync=!!args[2],func_,func__,_this=this;return isAsync?func_=function(){return _this.validateCallAsync.apply(_this,[func,this].concat(slice.call(arguments)))}:func_=function(){return _this.validateCall.apply(_this,[func,this].concat(slice.call(arguments)))},func.SCHEMA=schema,func.IS_VALIDATING=isValidating,func.IS_ASYNC=isAsync,func_.SCHEMA=schema,func_.IS_VALIDATING=isValidating,func_.IS_ASYNC=isAsync,func__=isValidating?func_:func,isValidating||(func__.validate=func_),func__}return func.IS_ASYNC=!!args[0],func}}),Environment.instances={};var createEnvironment=function(id,options){return new Environment(id,options)};return module.exports={},typeof module=="object"&&module.exports?module.exports=createEnvironment:window.createEnvironment=createEnvironment,module.exports});
define('libs/schema.js/i18n/default',["require","exports","module"],function(require,exports,module){module.exports={validation_error:{de:function(){return"Diese Instanz ist nicht gltig"},en:function(){return"This instance is not valid"}},validation_error_type:{de:function(){return"Ungltiger Typ"},en:function(){return"Invalid type"}},validation_error_minLength:{de:function(validation){return"Der Text muss mindestens "+validation.schema.minLength+" Zeichen haben."},en:function(validation){return"Text must be longer than "+validation.schema.minLength+" symbols"}},validation_error_maxLength:{en:function(validation){return"Text must be shorter than "+validation.schema.maxLength+" symbols"}},validation_error_minimum:{en:function(validation){return"Number must be greater than "+validation.schema.minimum+""}},validation_error_maximum:{en:function(){return"Please, enter a reasonable number."}},validation_error_pattern:{en:function(){return"Incorrect value"}},validation_error_optional:{en:function(){return"Required field"}}}});
define('libs/schema.js/lib/draft-02/validation',["require","exports","module","Underscore","../utils","../objecttools"],function(require,exports,module){var _=require("Underscore"),utils=require("../utils"),objecttools=require("../objecttools");module.exports=function(){var env=this,Schema=this.Schema;utils.extend(this.Validation.prototype,{start:function(instance){if(this.detectRecursion&&instance instanceof Object){if(this.isObjectFlagged(instance))return instance;this.flagObject(instance)}return instance=this["extends"](instance),this.wasError()?instance:(instance=this.adapters(instance,"pre"),this.wasError()?instance:(instance=this.optional(instance),this.wasError()||instance===undefined?instance:(instance=this.empty(instance),this.wasError()||instance===""||instance===null?instance:(instance=this.type(instance),this.wasError()?instance:(instance=this.requires(instance),this.wasError()?instance:(instance=this.adapters(instance,"post"),instance))))))},"extends":function(instance){return this.schema["extends"]?(this.push(this.schema["extends"]),instance=this.start(instance),this.pop(!0),instance):instance},optional:function(instance){return this.schema.optional||instance!==undefined?instance:this.callPlugin(this.schema.fallbacks.optional,instance,"optional")},empty:function(instance){return this.schema.empty||instance!==undefined&&instance!==""&&instance!==null?instance:this.callPlugin(this.schema.fallbacks.optional,instance,"empty")},adapters:function(instance,position){if(!this.schema[position])return instance;var adapters=this.schema[position];adapters instanceof Array||(adapters=[adapters]);var len=this.errors.length,adapter;for(var li=adapters.length,i=0;i<li;i++){adapter=adapters[i],instance=this.callPlugin(adapter,instance);if(this.errors.length>len)return instance}return instance},type:function(instance,type,isFirst){isFirst=isFirst===!1?!1:!0;var toType=type||this.schema.type;if(!(toType instanceof Array)){var fromType=typeof instance,ok=function(){if(toType==="any")return!0;if(toType==="null")return instance===null;if(toType==="array")return instance instanceof Array;if(toType==="object")return instance instanceof Object&&!(instance instanceof Array);if(toType==="number")return fromType==="number";if(toType==="integer")return fromType==="number"&&Math.round(instance)===instance;if(toType==="string")return fromType==="string";if(toType==="boolean")return fromType==="boolean"}();if(!ok){instance=this.callPlugin(this.schema.fallbacks.type,instance,"type");if(this.wasError())return instance}var type=typeof instance;return type==="number"?(instance=this.minimum(instance),this.wasError()?instance:(instance=this.maximum(instance),this.wasError()?instance:(instance=this.maxDecimal(instance),this.wasError()?instance:(isFirst&&(instance=this["enum"](instance)),instance)))):type==="string"?(instance=this.pattern(instance),this.wasError()?instance:(instance=this.minLength(instance),this.wasError()?instance:(instance=this.maxLength(instance),this.wasError()?instance:(isFirst&&(instance=this["enum"](instance)),instance)))):instance instanceof Array?(instance=this.minItems(instance),this.wasError()?instance:(instance=this.maxItems(instance),this.wasError()?instance:(instance=this.items(instance),this.wasError()?instance:(instance=this.additionalProperties(instance),this.wasError()?instance:(isFirst&&(instance=this["enum"](instance)),instance))))):instance instanceof Object?(instance=this.properties(instance),instance=this.additionalProperties(instance),this.wasError()?instance:(isFirst&&(instance=this["enum"](instance)),instance)):instance}var inst,len=this.errors.length;for(var li=toType.length,i=0;i<li;i++){inst=this.type(instance,toType[i],i===0);if(this.errors.length===len){instance=inst;break}i+1<li&&(this.errors.splice(len,1),this.wasError())}return instance},"enum":function(instance){return"enum"in this.schema?_.indexOf(this.schema["enum"],instance)>-1?instance:this.callPlugin(this.schema.fallbacks["enum"],instance,"enum"):instance},requires:function(instance){if(this.schema.requires!==undefined&&this.parentInstance){var tempSchema;typeof this.schema.requires=="string"?(tempSchema={properties:{}},tempSchema.properties[this.schema.requires]={type:"any"}):tempSchema={properties:this.schema.requires},tempSchema=Schema.create(tempSchema);var schema_key=this.pop();this.push(tempSchema),this.properties(this.parentInstance),this.pop(!0),this.push.apply(this,schema_key)}return instance},properties:function(instance){if("properties"in this.schema){var props=this.schema.properties,prop,inst;this.parentInstance=instance;var isIn,inst;for(var key in props){this.push(props[key],key),isIn=key in instance,key!="__id"?inst=this.start(instance[key]):(inst=undefined,isIn=!1);if(isIn||inst!==undefined)instance[key]=inst;this.pop()}this.parentInstance=null}return this.wasError(),instance},additionalProperties:function(instance){if("additionalProperties"in this.schema)if(instance instanceof Object&&!(instance instanceof Array)){var props=this.schema.properties||{};if(!this.schema.additionalProperties){for(var ks=Object.keys(instance),li=ks.length,i=0,key;key=ks[i],i<li;i++)if(!(key in props)&&key!="__id")return this.callPlugin(this.schema.fallbacks.additionalProperties,instance,"additionalProperties")}else if(this.schema.additionalProperties!==!0)for(var ks=Object.keys(instance),li=ks.length,i=0,key;key=ks[i],i<li;i++)key in props||(this.push(this.schema.additionalProperties,key),key!=="__id"&&(instance[key]=this.start(instance[key])),this.pop())}else if(this.schema.items instanceof Array)if(!this.schema.additionalProperties){if(instance.length>this.schema.items.length)return this.callPlugin(this.schema.fallbacks.additionalProperties,instance,"additionalProperties")}else if(this.schema.additionalProperties!==!0)for(var li=instance.length,i=this.schema.items.length;i<li;i++)this.push(this.schema.additionalProperties,i),instance[i]=this.start(instance[i]),this.pop();return instance},items:function(instance){if("items"in this.schema)if(this.schema.items instanceof Array){var isIn,inst;for(var li=this.schema.items.length,i=0;i<li;i++){this.push(this.schema.items[i],i),isIn=i in instance,i!="__id"?inst=this.start(instance[i]):(isIn=!1,inst=undefined);if(isIn||inst!==undefined)instance[i]=inst;this.pop()}}else for(var li=instance.length,i=0;i<li;i++)this.push(this.schema.items,i),i!="__id"&&(instance[i]=this.start(instance[i])),this.pop();return instance},maxItems:function(instance){return this.schema.maxItems&&instance.length>this.schema.maxItems?this.callPlugin(this.schema.fallbacks.maxItems,instance,"maxItems"):instance},minItems:function(instance){return this.schema.minItems&&instance.length<this.schema.minItems?this.callPlugin(this.schema.fallbacks.minItems,instance,"minItems"):instance},minimum:function(instance){if("minimum"in this.schema){var minimumCanEqual="minimumCanEqual"in this.schema?this.schema.minimumCanEqual:!0;return(minimumCanEqual?instance>=this.schema.minimum:instance>this.schema.minimum)?instance:this.callPlugin(this.schema.fallbacks.minimum,instance,"minimum")}return instance},maximum:function(instance){if("maximum"in this.schema){var maximumCanEqual="maximumCanEqual"in this.schema?this.schema.maximumCanEqual:!0;return(maximumCanEqual?instance<=this.schema.maximum:instance<this.schema.maximum)?instance:this.callPlugin(this.schema.fallbacks.maximum,instance,"maximum")}return instance},maxDecimal:function(instance){if("maxDecimal"in this.schema){var factor=Math.pow(10,this.schema.maxDecimal);return Math.round(instance*factor)/factor===instance?instance:this.callPlugin(this.schema.fallbacks.maxDecimal,instance,"maxDecimal")}return instance},pattern:function(instance){return this.schema.pattern?this.schema.pattern.test(instance)?instance:this.callPlugin(this.schema.fallbacks.pattern,instance,"pattern"):instance},minLength:function(instance){return this.schema.minLength===undefined?instance:instance.length>=this.schema.minLength?instance:this.callPlugin(this.schema.fallbacks.minLength,instance,"minLength")},maxLength:function(instance){return this.schema.maxLength===undefined?instance:instance.length<=this.schema.maxLength?instance:this.callPlugin(this.schema.fallbacks.maxLength,instance,"maxLength")}}),utils.extend(this.Validation,{TOLERANT_FALLBACKS:{optional:"setDefault",type:"castTolerantlyToType","enum":"setDefault",requires:"addError",additionalProperties:"removeAdditionalProperties",maxItems:"sliceToMaxItems",minItems:"addError",maximum:"setMaximum",minimum:"setMinimum",maxDecimal:"roundToMaxDecimal",pattern:"addError",minLength:"addError",maxLength:"addError"},STRICT_FALLBACKS:{optional:"addError",type:"addError","enum":"addError",requires:"addError",additionalProperties:"addError",maxItems:"addError",minItems:"addError",maximum:"addError",minimum:"addError",maxDecimal:"addError",pattern:"addError",minLength:"addError",maxLength:"addError"}}),this.Validation.registerPlugins({addToRefs:function(instance){if(instance instanceof Object&&!(instance instanceof Array)&&typeof instance.$ref=="string"){var toPath=this.path,fromPath=instance.$ref.split(".");objecttools.addRef(this.instance,[].concat(toPath),fromPath[0]==="#"?[].concat(fromPath):["#","constructor","instances"].concat(fromPath))}return instance},instantiateSchema:function(instance){if(!(instance instanceof Object)||instance instanceof Array)return instance;var isThisInstance=instance===this.instance;instance instanceof Schema||(instance=new Schema(instance)),isThisInstance&&(this.instance=instance);if(instance.properties instanceof Object){var props=instance.properties||{};for(var key in props)props[key]instanceof Object&&!(props[key]instanceof Schema)&&(props[key]=new Schema(props[key]))}if(instance.items instanceof Array){var items=instance.items;for(var li=items.length,i=0;i<li;i++)items[i]instanceof Object&&!(items[i]instanceof Schema)&&(items[i]=new Schema(items[i]))}else instance.items instanceof Object&&(instance.items instanceof Schema||(instance.items=new Schema(instance.items)));if(instance.requires&&instance.requires instanceof Object&&!(instance.requires instanceof Array)){var props=instance.requires;for(var key in props)props[key]=new Schema(props[key])}return instance.additionalProperties instanceof Object&&!(instance.additionalProperties instanceof Schema)&&(instance.additionalProperties=new Schema(instance.additionalProperties)),instance["extends"]instanceof Object&&(instance["extends"]instanceof Schema||(instance["extends"]=new Schema(instance["extends"]))),instance.setFallbacks(instance.fallbacks),objecttools.resetRefs(instance),instance},castTolerantlyToType:function(instance,errorName){errorName=errorName||"type";var toType=this.schema.type,fromType=typeof instance,inst;if(toType==="string")return fromType==="object"?instance!==null&&typeof instance.toString=="function"&&instance.toString!==Object.prototype.toString&&instance.toString!==Array.prototype.toString?""+instance:(new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance):""+instance;if(toType==="number"){if(fromType!=="boolean")return inst=parseFloat(instance),isNaN(inst)&&instance!=0?(new this.Error(errorName,env.i18n["validation_error_"+errorName]?env.i18n["validation_error_"+errorName]:"validation_error_"+errorName),instance):isNaN(inst)?instance:inst;if(instance===!1)return 0;if(instance===!0)return 1}if(toType==="integer"){if(fromType!=="boolean")return inst=parseInt(instance,10),isNaN(inst)?(new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance):inst;if(instance===!1)return 0;if(instance===!0)return 1}if(toType==="boolean")return fromType==="string"?instance.trim().toLowerCase()==="false"?!1:(inst=parseFloat(instance),isNaN(inst)?!0:!!inst):!!instance;if(toType==="object")return instance instanceof Array&&instance.length===0?{}:((fromType!=="object"||instance===null||instance instanceof Array)&&new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance);if(toType==="array"){if(!instance)return[];if(instance instanceof Object){var inst=[],key_int,allInt=!0;if(Object.keys(instance).length===0)return inst;for(var key in instance){key_int=parseInt(key,10),""+key_int===key?inst[key_int]=instance[key]:allInt=!1;break}}return new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance}if(toType==="null")return new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance},roundToMaxDecimal:function(instance,errorName){if(this.schema.maxDecimal===undefined)return new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance;var factor=Math.pow(10,this.schema.maxDecimal);return Math[instance<0?"ceil":"floor"](instance*factor)/factor},setMinimum:function(instance,errorName){return this.schema.minimum===undefined?(new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance):this.schema.minimum},setMaximum:function(instance,errorName){return this.schema.maximum===undefined?(new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance):this.schema.maximum},truncateToMaxLength:function(instance,errorName){return this.schema.maxLength===undefined?(new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance):instance.substr(0,this.schema.maxLength)},setDefault:function(instance,errorName){if("default"in this.schema)return this.schema["default"];new this.Error(errorName,env.i18n["validation_error_"+errorName])},removeAdditionalProperties:function(instance,errorName){if(this.schema.type==="object"){var props=this.schema.properties||{};for(var ks=Object.keys(instance),li=ks.length,i=0,key;key=ks[i],i<li;i++)props[key]===undefined&&delete instance[key];return instance}if(this.schema.items&&this.schema.items instanceof Array)for(var li=instance.length,i=this.schema.items.length;i<li;i++)delete instance[i];return instance},sliceToMaxItems:function(instance,errorName){return this.schema.maxItems!==undefined?instance.length>this.schema.maxItems&&instance.splice(this.schema.maxItems):new this.Error(errorName,env.i18n["validation_error_"+errorName]),instance},deleteInstance:function(instance){return undefined}})}});
define('libs/schema.js/lib/draft-02/setupSchemaSchema',["require","exports","module"],function(require,exports,module){module.exports=function(){var Schema=this.Schema,Validation=this.Validation,rawSchema={id:"jsonSchemaCore",title:"JSON Schema Core Schema",description:"This is the JSON Schema for JSON Schemas.",type:"object",properties:{type:{type:["string","array"],items:{type:"string","enum":{$ref:"#.properties.type.enum"}},uniqueItems:!0,description:"This is a type definition value. This can be a simple type, or a union type","enum":["string","object","array","boolean","number","integer","null","any"],minItems:2,optional:!0,"default":"any",pre:"addToRefs",labels:{de:{string:"Text",object:"Objekt",array:"Liste","boolean":"wahr/falsch",number:"Zahl",integer:"ganze Zahl","null":"undefiniert"},en:{}}},id:{type:"string",optional:!0,minLength:1,pattern:"[^\\.#]",description:"A globally unique ID for this schema. It can be used to reference the schema from another one."},optional:{type:"boolean",description:"This indicates that the instance property in the instance object is not required.",optional:!0,"default":!1,pre:"addToRefs"},empty:{type:"boolean",description:"This indicates that the instance property in the instance object can be empty.",optional:!0,"default":!1,pre:"addToRefs"},"enum":{type:"array",optional:!0,description:"This provides an enumeration of possible values that are valid for the instance property. It goes only for the first type, if type is an array of types.",minItems:1,uniqueItems:!0},description:{type:"string",optional:!0,description:"This provides a description of the purpose the instance property. The value can be a string or it can be an object with properties corresponding to various different instance languages (with an optional default property indicating the default description).",pre:"addToRefs"},title:{type:"string",optional:!0,description:"This provides the title of the property",pre:"addToRefs"},"default":{type:"any",optional:!0,description:"This indicates the default for the instance property.",pre:"addToRefs"},options:{type:"array",optional:!0,items:{type:"object",properties:{label:{type:"string",optional:!0},value:{type:"any"}}},pre:"addToRefs"},"extends":{type:"object",optional:!0,pre:"addToRefs"},requires:{type:["string","object"],additionalProperties:{$ref:"#"},optional:!0,description:"indicates a required property or a schema that must be validated if this property is present",pre:"addToRefs"},nonStandard:{type:"boolean",optional:!0,"default":!1,nonStandard:!0},pre:{type:["string","array","any"],items:{type:["string","any"]},optional:!0,description:"One or several prefix adapters identified by plugin IDs",nonStandard:!0,pre:"addToRefs"},post:{type:["string","array","any"],items:{type:["string","any"]},optional:!0,description:"One or several postfix adapters identified by plugin IDs",nonStandard:!0,pre:"addToRefs"},fallbacks:{type:"object",additionalProperties:{type:["string","object"],description:"Identifier for a adapter function that will be executed if a constraint is violated"},description:"Fallback object, with property names = schema property names",nonStandard:!0,pre:"addToRefs"},properties:{type:"object",additionalProperties:{$ref:"#"},description:"This is a definition for the properties of an object value",optional:!0,"default":{},pre:"addToRefs"},items:{type:["object","array"],properties:{$ref:"#.properties"},items:{$ref:"#"},description:"When the value is an array, this indicates the schema to use to validate each item in an array",optional:!0,pre:["instantiateSchema","addToRefs"]},maxItems:{type:"integer",optional:!0,description:"When the instance value is an array, this indicates maximum number of items.",minimum:0,pre:"addToRefs"},minItems:{type:"integer",optional:!0,description:"When the instance value is an array, this indicates minimum number of items.",minimum:0,pre:"addToRefs"},additionalProperties:{type:["boolean","object"],properties:{$ref:"#.properties"},description:"This provides a default property definition for all properties that are not explicitly defined in an object type definition.",optional:!0,"default":!0,pre:["instantiateSchema","addToRefs"]},minimum:{type:"number",optional:!0,description:"This indicates the minimum value for the instance property when the type of the instance value is a number.",pre:"addToRefs"},minimumCanEqual:{type:"boolean",optional:!0,description:"If the minimum is defined, this indicates whether or not the instance property value can equal the minimum.","default":!0,pre:"addToRefs"},maximum:{type:"number",optional:!0,description:"This indicates the maximum value for the instance property when the type of the instance value is a number.",pre:"addToRefs"},maximumCanEqual:{type:"boolean",optional:!0,description:"If the maximum is defined, this indicates whether or not the instance property value can equal the maximum.","default":!0,pre:"addToRefs"},maxDecimal:{type:"integer",optional:!0,description:"This indicates the maximum number of decimal places in a floating point number.",pre:"addToRefs"},pattern:{type:["string","object"],format:"regex",description:"When the instance value is a string, this provides a regular expression that a instance string value should match in order to be valid.",optional:!0,pre:["addToRefs",function(instance,walker){return instance instanceof RegExp?instance:typeof instance=="string"?new RegExp(instance):instance}]},maxLength:{type:"number",optional:!0,description:"When the instance value is a string, this indicates maximum length of the string.",pre:"addToRefs"},minLength:{type:"number",optional:!0,description:"When the instance value is a string, this indicates minimum length of the string.",pre:"addToRefs"},format:{type:"string",optional:!0,description:"This indicates what format the data is among some predefined formats which may include:\n\ndate - a string following the ISO format \naddress \nschema - a schema definition object \nperson \npage \nhtml - a string representing HTML",pre:"addToRefs"}},pre:["instantiateSchema","addToRefs"]};(jsonSchemaCore=new Schema(rawSchema)).setFallbacks(Validation.STRICT_FALLBACKS);for(var key in jsonSchemaCore.properties)(jsonSchemaCore.properties[key]=new Schema(jsonSchemaCore.properties[key])).setFallbacks(Validation.STRICT_FALLBACKS);(jsonSchemaCore.properties.type.items=new Schema(jsonSchemaCore.properties.type.items)).setFallbacks(Validation.STRICT_FALLBACKS),jsonSchemaCore.properties.type.items["enum"]=jsonSchemaCore.properties.type["enum"],jsonSchemaCore.properties.id.pattern=new RegExp(jsonSchemaCore.properties.id.pattern),(jsonSchemaCore.properties.options.items=new Schema(jsonSchemaCore.properties.options.items)).setFallbacks(Validation.STRICT_FALLBACKS),jsonSchemaCore.properties.requires.additionalProperties=jsonSchemaCore,(jsonSchemaCore.properties.pre.items=new Schema(jsonSchemaCore.properties.pre.items)).setFallbacks(Validation.STRICT_FALLBACKS),(jsonSchemaCore.properties.post.items=new Schema(jsonSchemaCore.properties.post.items)).setFallbacks(Validation.STRICT_FALLBACKS),(jsonSchemaCore.properties.fallbacks.additionalProperties=new Schema(jsonSchemaCore.properties.fallbacks.additionalProperties)).setFallbacks(Validation.STRICT_FALLBACKS),jsonSchemaCore.properties.properties.additionalProperties=jsonSchemaCore,jsonSchemaCore.properties.items.properties=jsonSchemaCore.properties,jsonSchemaCore.properties.items.items=jsonSchemaCore,jsonSchemaCore.properties.additionalProperties.properties=jsonSchemaCore.properties,this.schemaSchema=jsonSchemaCore}});
define('tau/utils/utils.jsonSchema',["Underscore","jQuery","libs/schema.js/lib/environment","libs/schema.js/lib/utils","libs/schema.js/lib/objecttools","libs/schema.js/lib/schema","libs/schema.js/i18n/default","libs/schema.js/lib/draft-02/validation","libs/schema.js/lib/draft-02/setupSchemaSchema"],function(_,$,env,utils,tools,i18n,validation,schema){var $schema=env("prod",{fallbacks:"STRICT_FALLBACKS"});return $schema.PATTERN_DATE=/^([0-1]{0,1}[0-9]{1})\/([0-3]{0,1}[0-9]{1})\/([0-9]{4})$/,$schema.PATTERN_URL=/^([a-z]+?)\:\/\/.+?$/,$schema.Validation.registerPlugins({trim:function(instance){return $.trim(instance)}}),$schema.Validation.prototype.optional=function(instance){return this.schema.optional||instance!==undefined&&instance!==null&&instance!==""?instance:this.callPlugin(this.schema.fallbacks.optional,instance,"optional")},$schema});
define('tau/models/customField/model.customField.date.editable',["tau/models/model.customField.editable","tau/utils/utils.jsonSchema","tau/utils/utils.date"],function(ModelBase,jsonSchema,dateUtils){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{type:"string",optional:!1,post:function(val){if(this.wasError()==0){var date=dateUtils.parse(val);date==null?new this.Error("Date","Incorrect date format"):date<new Date("01/01/1900")?new this.Error("Date","Date must be greater then 01-01-1900"):val=dateUtils.format.date.short(date)}return val},additionalProperties:{dateFormat:dateUtils.getFormatData().date.short}}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0];this.schema.properties.value.optional=!this.config.customField.required,this.schema.properties.value.empty=!this.config.customField.required,args.validation=this.schema.validate(data)}});return model});
define('tau/ui/behaviour/date/ui.behaviour.dateEditor',["Underscore","jQuery","tau/core/tau"],function(_,$,tauUtils){$.widget("ui.dateEditor",{options:{widgetName:"datepicker",onSave:function(){},validation:{required:!1},dateFormat:"m/dd/yy"},errors:[],_create:function(){this.init()},init:function(){var $element=$(this.element);this.$element=$element,$element.click($.proxy(this.showEditor,this)),$element.addClass("ui-dateeditor-source")},setValidationErrors:function(data){this.element.addClass("ui-validationerror"),_.isString(data)&&this.element.attr("title",data)},resetValidationErrors:function(data){this.element.removeClass("ui-validationerror"),this.element.removeAttr("title",data)},activate:function(){this._justActivated=!0,this.showEditor(),this.$editor.find(":text").focus()},_attachKeyBoardHandling:function(){var self=this,keyBoardHandler={handleKeyDown:function(){self.mapKeys.apply(self,arguments)}};this.options.keyboardManager.pushHandler(keyBoardHandler)},showEditor:function(e){var self=this;if(!this._editorIsVisible){if(!this.$editor){var $editor=$(tauUtils.concat('<span class="ui-dateeditor">','    <input type="text" maxlength="20" />',"</span>")),$input=$editor.find(":text");$input.focus();var $body=$("body"),bodyClickHandler=function(evt){self._onDocumentClick.apply(self,arguments),$body.unbind("click",bodyClickHandler)},attachBodyClickFunction=function(){$body.click(bodyClickHandler)};$input[this.options.widgetName]({showButtonPanel:!1,dateFormat:this.options.dateFormat,buttonText:"choose",showOn:"button",beforeShow:attachBodyClickFunction,onSelect:function(date){$input.focus()}}),$editor.insertAfter(this.$element),this.$editor=$editor}this._attachKeyBoardHandling(),self._documentClickDelegate||(self._documentClickDelegate=function(ev){self._onDocumentClick(ev)},$(document.body).click(self._documentClickDelegate)),this.$element.hide(),this._editorIsVisible=!0,this.$editor.show(),this.$editor.find(":text").val(this.$element.text())}},trimString:function(value){return _.trim(value||"")},_getDefaultValue:function(){return this.options.date||this.element.text()},_onSave:function(){var value=this.$editor.find(":text").val(),changedValue={value:value};(this.options.beforeChange||function(){})(changedValue),value=changedValue.value,this.hideEditor(),this.$element.show();var defaultValue=this._getDefaultValue();this.trimString(defaultValue)!=this.trimString(value)&&this.options.onSave(value),this.$element.text(value),this.options.keyboardManager.popHandler()},_onCancel:function(){this.options.keyboardManager.popHandler();var value=this.$editor.find(":text").val();this.hideEditor(),this.$element.show(),this.options.onCancel&&this.options.onCancel()},hideEditor:function(){this.$editor&&this._editorIsVisible&&(this.$editor.hide(),this._editorIsVisible=!1),this._documentClickDelegate&&($(document.body).unbind("click",this._documentClickDelegate),delete this._documentClickDelegate)},_onDocumentClick:function(ev){var self=this,$elementClick=$(ev.target);if(!this._editorIsVisible)return;if(this._justActivated&&ev.target!=document.body){this._justActivated=!1;return}if($elementClick.hasClass("ui-dateeditor-source")||$elementClick.hasClass("ui-dateeditor")||$elementClick.parents(".ui-dateeditor").length>0||$elementClick.parents(".ui-datepicker").length>0||$elementClick.parents(".ui-datepicker-calendar").length>0||$elementClick.parents(".ui-datepicker-header").length>0)return;self._onSave(),self.hideEditor(),ev.stopPropagation(),ev.preventDefault()},destroy:function(){this.hideEditor();var $editor=this.$editor;if($editor){var $input=$editor.find(":text");$input[this.options.widgetName]("destroy"),$editor.remove()}},mapKeys:function(event){switch(event.which){case 13:event.preventDefault(),this._onSave();break;case 27:event.preventDefault(),this._onCancel()}}})});
define('tau/components/extensions/customField/extension.customField.date.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","tau/ui/behaviour/date/ui.behaviour.dateEditor","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,Class,dateUtils){return Class.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $row=eventData.afterRender.data.element,$widget=$row.find(".ui-customfield__value");$widget.addClass("editableText"),this.$widget=$widget,$.datepicker.parseDate=function(format,value,settings){return dateUtils.parse(value)},$.datepicker.formatDate=function(format,date,settings){return dateUtils.formatAs(date,format)};var dateFormat=dateUtils.getFormatData().date.short;$widget.dateEditor({dateFormat:dateFormat,keyboardManager:this.config.context.configurator.getKeyBoardManager(),onSave:function(date){self.bus.fire("save",{customFields:[{name:fieldData.name,type:fieldData.type,value:date}]})}}),$row.behaviourCustomFieldRow({onActivate:function(){$widget.dateEditor("activate"),$widget.focus()}}),$row.addClass("ui-customfield_editable_true")}},"bus validate":function(){this.$widget.dateEditor("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.dateEditor("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){this.$widget.dateEditor("setValidationErrors",evt.data.validation.errors[0].description)}})});
define('tau/ui/extensions/customField/ui.extension.customField.editable',["tau/components/extensions/component.extension.base","tau/ui/behaviour/overlay/ui.behaviour.overlay"],function(ExtensionBase){var extension=ExtensionBase.extend({"bus afterRender":function(evtArgs){this.element=evtArgs.data.element},_markElementAsUpdate:function(){this.element.tauOverlay(),this.fire("markElementToBeUpdated",{element:this.element})},"bus preRefreshRow":function(evt){this._markElementAsUpdate()},_refreshElement:function(){if(!this.element.hasClass("updating"))return;this.element.parents(".tmpl-container-list:first").tauOverlay("hide");var self=this;this.on("afterRender",function(e){e.removeListener(),self.fire("updateElement",{element:self.element})}),this.fire("refresh")},"bus refreshRow":function(evt){this._refreshElement()}});return extension});
define('tau/ui/templates/customField/ui.template.customField.date',["tau/core/templates-factory"],function(templates){var config={name:"customField-date",markup:['<div class="ui-customfield {{if !output}}ui-customfield_empty_true{{/if}}">',"   <table>","   <tbody>","   <tr>",'<td class="ui-customfield__label">${name}</td>','<td class="ui_custom_field_value_container">','<div class="ui-customfield__value">${output}</div>',"</td>","   </tr>","   </tbody>","   </table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.date',["tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.date.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/customField/extension.customField.date.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/templates/customField/ui.template.customField.date"],function(creator,ModelType,ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight]};return creator.create(creatorConfig,config)}}});
define('tau/components/extensions/customField/extension.customField.url.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");this.$widget=$widget,$el.find(".ui-customfield__label").behaviourCustomFieldRow({}),$el.addClass("ui-customfield_editable_true")}}})});
define('tau/ui/templates/customField/ui.template.customField.dropdown',["tau/core/templates-factory"],function(templates){var config={name:"customField-dropdown",markup:['<div class="ui-customfield ui-customfield-dropdown {{if !value}}ui-customfield_empty_true{{/if}}">',"   <table>","   <tbody>","   <tr>",'       <td class="ui-customfield__label">${name}</td>','       <td class="ui_custom_field_value_container">','<div class="ui-customfield__value">',"${value}","</div>","</td>","   </tr>","   </tbody>","   </table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.dropdown',["Underscore","tau/components/component.creator","tau/models/model.customField","tau/models/model.customField.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/bubble/extension.bubble.creator.direct","tau/components/extensions/component.creator.extension","tau/components/extensions/customField/extension.customField.url.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/templates/customField/ui.template.customField.dropdown"],function(_,creator,Model,ModelEditable,RequireCustomField,PopupExtension,CreatorExtension,RowExtension,EditableExtension,template){return{create:function(config){var creatorConfig={ModelType:Model,extensions:[ModelEditable,RequireCustomField,RowExtension,EditableExtension,CreatorExtension,{type:PopupExtension,config:{popupEditorContainer:[{target:"tr",alignTo:".ui-customfield__value",componentsConfig:{components:[{type:"customField.dropdown.list"}]}}]}}],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.dropdown.editable',["Underscore","tau/models/model.customField.editable"],function(_,ModelBase){var model=ModelBase.extend({"bus beforeInit":function(evt){this.store=evt.data.config.store;if(this.config.data){var curValue=this.config.data.value,choices=[];_.map(this.config.data.options,function(item){curValue!==item&&choices.push({id:item,name:item})});var nullableValue=curValue?!this.config.data.required:!1;this.fire("dataBind",{states:choices,nullableValue:nullableValue})}},"bus updateState":function(evt){var val=null;evt.data&&evt.data.id&&(val=evt.data.id);var $set={customFields:[{name:this.config.data.name,type:this.config.data.type,value:val}]};this.fire("save",$set)}});return model});
define('tau/utils/utils.textsearch',["Underscore","tau/core/class"],function(_,Class){var Textsearch=Class.extend({data:[],load:function(data){var self=this;_.forEach(data,function(item){item.normalizeData=self._normalize(item.data)}),this.data=data},_createRegex:function(query){var pattern=_.trim(query);pattern=pattern.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"),pattern=pattern.replace(/[ ]+/g,"([-[\\]{}()*+?.,\\\\^$|#:;! ]+|\\s+|\\s+[ \\S]*?\\s+)");var regex=new RegExp(pattern,"i");return regex},_normalize:function(string){return _.trim(string)},search:function(query){var result=[],regex=this._createRegex(query);return _.forEach(this.data,function(item){var target=item.normalizeData,match=target.match(regex);if(match){var resultItem={_id:item._id,data:item.data,entry:{from:match.index,len:match[0].length}};result.push(resultItem)}}),result},match:function(text,query){var result=null,match=this._normalize(text).match(this._createRegex(query));return match&&(result={from:match.index,len:match[0].length}),result}});return Textsearch});
define('tau/ui/behaviour/common/ui.behaviour.listSelectable',["Underscore","jQuery"],function(_,$){$.widget("ui.listSelectable",{_create:function(){},_handler:function($items){},enable:function(opts){opts=_.defaults(opts||{},{saveScroll:!1});if(this._enabled)return;this._enabled=!0;var $filter=this.element.parents(".ui-drop-down:first").find(".filter-field-wrapper :text");$filter.length&&$filter.focus();var self=this;this.reset(opts);var nextIndex=function(index){return index++,index>=self._max&&(index=0),index},prevIndex=function(index){return index--,index<0&&(index=self._max-1),index},$items=this.$items,className=this.options.className;this.options.keyboardManager.pushHandler({handleKeyDown:function(evt){var index=self._index;switch(evt.keyCode){case $.ui.keyCode.DOWN:evt.preventDefault(),index=nextIndex(index);break;case $.ui.keyCode.UP:evt.preventDefault(),index=prevIndex(index);break;case $.ui.keyCode.ENTER:evt.preventDefault();if(index<0)return;self.$items.eq(index).trigger("click");break;default:return}self._index=index,self.$items.removeClass(className),index>=0&&self.$items.eq(index).addClass(className),self.$list.animate({scrollTop:self._getOffset(index)},{duration:0})}})},_getOffset:function(num){var $item=this.$items.eq(num);if($item.length==0)return 0;var innerTop=this.$inner.position().top,itemTop=$item.position().top,group=$item.parent("i-group");group.length&&(itemTop+=group.position().top);var offset=-innerTop+itemTop-this.$list.height()/2;return offset},reset:function(opts){opts=_.defaults(opts||{},{saveScroll:!1}),this.$items=this.element.find(this.options.items).filter(":visible");var $list=this.element;this.$list=$list,this.$inner=this.$list.find(this.options.inner||".i-inner"),opts.saveScroll==0&&$list.scrollTop(0);var height=$list.height();this.step=this.$items.eq(0).height()*.5,this._index=-1,this._max=this.$items.length;var className=this.options.className;opts.saveScroll==0&&this.$items.removeClass(className)},disable:function(){if(!this._enabled)return;this._enabled=!1,this.options.keyboardManager.popHandler()},destroy:function(){this.disable()}})});
define('tau/ui/extensions/stateList/ui.extension.stateList.editable',["Underscore","jQuery","tau/utils/utils.textsearch","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(_,$,TextSearch,ExtensionBase){var stateListEditable=ExtensionBase.extend({"bus dataBind+afterRender":function(evtArgs){this.searchIndex=null;var config=this.config,element=this.element=evtArgs.afterRender.data.element,dataToBind=this.dataToBind=evtArgs.dataBind.data,realStatesLength=0;_.forEach(dataToBind.states,function(state){state.items?realStatesLength+=state.items.length:realStatesLength++}),this.$list=element.find(".drop-down-list"),this.$options=this.$list.find(".i-role-option"),this.$list.on("click",".i-role-option",_.bind(this.onItemSelected,this)),config.hasOwnProperty("maxHeight")&&this.$list.css("max-height",config.maxHeight).css("overflow-y","auto");var $actions=$("<div class='drop-down-actions' role='actions' />"),hasActions=!1;if(dataToBind.hasOwnProperty("defaultValue")){hasActions=!0;var defaultValueLabel=this.config.defaultValueLabel||"default";$("<span class='action-link default'>"+defaultValueLabel+"</span>").click($.proxy(this.defaultValue,this)).appendTo($actions)}this.config.allowToReset=_.isUndefined(this.config.allowToReset)?!0:this.config.allowToReset;if(dataToBind.nullableValue&&this.config.allowToReset){hasActions=!0;var clearValueLabel=this.config.clearValueLabel||"reset";$("<span class='action-link clear' role='action-reset'>"+clearValueLabel+"</span>").click($.proxy(this.clearValue,this)).appendTo($actions)}hasActions&&$actions.insertBefore(this.$list);if(dataToBind.states.length===0&&dataToBind.completed){var emptyDataMessage=config.emptyDataMessage||"None";this.$list.append("<span class='empty-message'>"+emptyDataMessage+"</span>")}config.filter&&realStatesLength>3&&(this.filterField=$("<input type='text' class='filter-field' />").keyup($.proxy(this._filterDelegate,this)),$("<div class='filter-field-wrapper'></div>").append(this.filterField).insertBefore(this.$list));if(config.expandable&&!dataToBind.completed){var mode=config.mode||"short";if(mode!=="full"){var $footer=$("<div class='drop-down-footer'></div>"),modeText=this.config.fullModeLabel||"more...";this.$mode=$("<div class='action-link more'>"+modeText+"</div>").click($.proxy(this._toggleMode,this)).appendTo($footer),$footer.insertAfter(this.$list)}}this.bus.fire("listOptionsReady",{element:element}),this._createSelectable()},_createSelectable:function(){this.$list.listSelectable({items:".drop-down-option:visible",className:"drop-down-option_hover",keyboardManager:this.config.context.configurator.getKeyBoardManager()}),this.$list.addClass("tau-dropdownlist_selectable_true")},_enableSelectable:function(){this.$list.hasClass("tau-dropdownlist_selectable_true")&&this.$list.listSelectable("enable")},_disableSelectable:function(){this.$list.hasClass("tau-dropdownlist_selectable_true")&&this.$list.listSelectable("disable")},"bus listOptionsReady:last+focus":function(evt){this._enableSelectable()},"bus listOptionsReady:last+refresh":function(evt){this._enableSelectable()},"bus listOptionsReady:last+blur":function(evt){this._disableSelectable()},_toggleMode:function(evt){evt.stopPropagation();var newMode=this.config.mode==="full"?"short":"full";this.fire("refresh",{mode:newMode})},clearValue:function(evt){evt.stopPropagation(),this._updateState(null)},defaultValue:function(evt){evt.stopPropagation(),this._updateState(this.dataToBind.defaultValue)},onItemSelected:function(evtArgs){var data=$(evtArgs.currentTarget).data();this._updateState(data.id)},_updateState:function(value){var isConfirmed=!0;this.config.confirmation&&window.confirm&&(isConfirmed=window.confirm(this.config.confirmation)),isConfirmed&&this.fire("updateState",{id:value})},_resetList:function(){this.$options.show()},_noResults:function(text){var text='"'+text+'" not found';this.$noResults?this.$noResults.text(text):this.$noResults=$("<div class='not-found' />").text(text).insertBefore(this.$list),this.$noResults.show()},_clearNoResults:function(){this.$noResults&&this.$noResults.hide()},_filterDelegate:function(evt){if(evt.keyCode==jQuery.ui.keyCode.DOWN||evt.keyCode==jQuery.ui.keyCode.UP||evt.keyCode==jQuery.ui.keyCode.ENTER||evt.keyCode==jQuery.ui.keyCode.ESCAPE)return;if(!this.searchIndex){var data=[];this.searchIndex=new TextSearch,this.$options.each(function(key,item){data.push({_id:key,data:$(item).text()}),$(this).data("text",$(item).text())}),this.searchIndex.load(data)}var searchText=this.filterField.val(),result=this.searchIndex.search(searchText);this.$options.hide();var $options=this.$options;_.forEach(result,function(item){var $option=$options.eq(item._id),text=$option.data("text")+"";text=text.substr(0,item.entry.from)+"<em>"+text.substr(item.entry.from,item.entry.len)+"</em>"+text.substr(item.entry.from+item.entry.len,text.length);var $textOption=$option.find(".i-role-optiontext");$textOption.length?$textOption.html(text):$option.html(text),$option.show(),$option.parent().show()}),$options.filter(":hidden").parent().not($options.filter(":visible").parent()).hide(),searchText.length?result.length==0?this._noResults(searchText):this._clearNoResults():(this._clearNoResults(),this._resetList()),this.$list.listSelectable("reset")}});return stateListEditable});
define('tau/ui/extensions/bubble/ui.extension.bubble.listResizer',["jQuery","tau/core/extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender:last + popupResize:last":function(evt,renderData,$tauBubbled){this._resize(renderData.element,$tauBubbled,{})},_resize:function($el,$tauBubbled,options){options=_.defaults(options||{},{list:"[role=list]",additionalHeight:0});var bubbledOptions=$tauBubbled.data("tauBubble").options,$list=$el.find(options.list),$within=bubbledOptions.within,h=100;$within||($within=bubbledOptions.application||$(window)),options.additionalHeight||($list.css("height",1),$list.css("maxHeight",1),options.additionalHeight=$el.outerHeight(!0)+150),$within.length&&(h=$within.height()*.6-options.additionalHeight);var styles={maxHeight:h,overflowY:"auto",overflowX:"hidden",height:"auto"};$list.css(styles)}})});
define('tau/ui/templates/state/ui.template.state.option',["tau/core/templates-factory"],function(templates){var config={name:"state.option",engine:"jqote2",markup:["<% if (this.items) { %>",'<div class="drop-down-group i-group">','<span class="i-group-name"><%! this.name %></span>','<%= fn.sub("state.option", this.items) %>',"</div>","<% } else { %>",'<div role="option" data-id="<%! this.id %>" class="i-role-option drop-down-option" <% if (this.description) { %> title=<%! this.description %> <% } %> >',"<% if (this.asHtml) { %>","<%= this.name %>","<% } else { %>","<%! this.name %>","<% } %>","</div>","<% } %>"]};return templates.register(config)});
define('tau/ui/templates/state/ui.template.state.list.dropdown',["tau/core/templates-factory","tau/ui/templates/state/ui.template.state.option"],function(templates){var config={name:"state.list.dropdown",engine:"jqote2",markup:['<div class="ui-drop-down">',"<% if (this.states.length) { %>",'<div role="list" class="drop-down-list">','<div class="drop-down-list__inner i-inner">','<%= fn.sub("state.option", this.states) %>',"</div>","</div>","<% } else { %>",'<div class="drop-down-list">','<div role="placeholder-empty">No items found</div>',"</div>","<% } %>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.dropdown.list',["tau/components/component.creator","tau/core/model-base","tau/models/customField/model.customField.dropdown.editable","tau/ui/extensions/stateList/ui.extension.stateList.editable","tau/ui/extensions/bubble/ui.extension.bubble.listResizer","tau/ui/templates/state/ui.template.state.list.dropdown"],function(creator,Model,ModelEditable,EditableExtension,ListExtension,template){return{create:function(config){var creatorConfig={ModelType:Model,extensions:[ModelEditable,EditableExtension,ListExtension],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.entity.editable',["Underscore","tau/models/model.customField.editable"],function(_,ModelBase){return ModelBase.extend({"bus entitySelected":function(evt){var $set={},cf={name:this.config.data.name,type:"Entity",value:null};$set.customFields=[cf];var entity=evt.data.entity;entity&&entity.id&&(cf.value={id:entity.id,kind:entity.__type,name:entity.name}),this.fire("save",{$set:$set})}})});
define('tau/components/extensions/customField/extension.customField.entity.finder',["Underscore","tau/core/extension.base","tau/models/customField/model.customField.entity.editable"],function(_,ExtensionBase,ModelCustomFieldEntityEditable){return ExtensionBase.extend({"bus beforeInit + configurationProvided + afterRender":function(evtData){var customField=evtData.beforeInit.data.customField,$target=evtData.afterRender.data.element.find("tr"),finderData=_.deepClone($target.tmplItem().data),view=evtData.afterRender.data.view,cfConfig=evtData.configurationProvided.data,finderConfig=this._createFinderConfig(finderData,customField,cfConfig);this._initBubbleWithFinder($target,view,finderConfig)},_createFinderConfig:function(finderData,customField,cfConfig){var conf={type:"finder",fields:["id","name",{project:["id","name","abbreviation"]}],additionalExtensions:[ModelCustomFieldEntityEditable],maxHeight:400,data:finderData,resetDisabled:customField&&customField.required===!0};return cfConfig.options.length>0&&(conf.$query={entityType:{id:{$in:cfConfig.options.join(",")}}}),conf},_initBubbleWithFinder:function($target,view,finderConfig){$target.addClass("tau-bubble-target"),$target.addClass("ui-customfield_editable_true");var bubbleConfig={target:$target,alignTo:$target.find(".entity-custom-field-link"),onShow:function(){view.config.context.configurator.getKeyBoardManager().pushHandler({})},onHide:function(){view.config.context.configurator.getKeyBoardManager().popHandler()},componentsConfig:{components:[finderConfig]}};this.fire("initBubble",bubbleConfig)}})});
define('tau/ui/templates/common/ui.template.entityLink.full',["tau/core/templates-factory"],function(templates){var config={name:"entity-link-full",markup:['<a href="${url}" class="tau-linkentity tau-linkentity_type_full">','<em class="ui-type-icon ui-type-icon-${__type.toLowerCase()} tau-linkentity__icon">${id}</em>','<span class="tau-linkentity__inner">',"{{if text}}","${text}","{{else}}","${name}","{{/if}}","</span>","</a>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/customField/ui.template.customField.entity',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink.full"],function(templates){var config={name:"customField-entity",markup:['<div class="ui-customfield">',"<table>","<tbody>",'<tr class="{{if !value.id }}ui-customfield_empty_true{{/if}}">','<td class="ui-customfield__label">${name}</td>','<td class="ui_custom_field_value_container">',"{{if value.id }}",'<span class="ui-customfield__value">{{tmpl(value) "entity-link-full"}}</span>',"{{else}}",'<span class="entity-custom-field-link property-text ui-customfield__value">${value.name}</span>',"{{/if}}","</td>","</tr>","</tbody>","</table>","</div>"],dependencies:["entity-link-full"]};return templates.register(config)});
define('tau/components/component.customField.entity',["Underscore","tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.entity.editable","tau/components/extensions/component.creator.extension","tau/components/extensions/bubble/extension.bubble.creator","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/customField/extension.customField.entity.finder","tau/ui/templates/customField/ui.template.customField.entity"],function(_,creator,ModelType,ModelCustomFieldEntityEditable,CreatorExtension,ExtensionBubbleCreator,ExtensionCustomFieldEditable,ExtensionCustomFieldRequired,ExtensionCustomFieldEntityFinder,Template){return{create:function(config){var creatorConfig={template:Template,extensions:[ModelType,ModelCustomFieldEntityEditable,CreatorExtension,ExtensionBubbleCreator,ExtensionCustomFieldEditable,ExtensionCustomFieldRequired,ExtensionCustomFieldEntityFinder]};return creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/list/extension.list.prioritize',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({name:"extension.list.prioritize",category:"edit","bus afterRender":function(evt){var $el=evt.data.element,self=this;this.$el=$el,$el.addClass("tau-list__sortable__true");var $groups=$el.find("[role=group]");$groups.addClass("tau-list__group_sortable_true");var params={sensitivity:7,speed:12};this.config.context.configurator.getConfig("isPopup",!1)&&(params={sensitivity:20,speed:30}),$groups.addClass("tau-list__group_available_true"),$groups.sortable({scroll:!0,scrollSensitivity:params.sensitivity,scrollSpeed:params.speed,cursor:"move",connectWith:".tau-list__group_available_true[role=group]",items:".tau-list__list [role=item]",dropOnEmpty:!0,handle:"[role=sortable-handler]",forcePlaceholderSize:!0,placeholder:{element:function($el){var $placeholder=$('<li class="tau-list__list__item tau-list__sortable-placeholder ui-sortable-placeholder"></li>');return $placeholder.height(50),$placeholder},update:function(container,p){return}},helper:function(e,$tr){var $helper=$tr;return $helper}});var refreshPositionsOnMouseMove=function(){$(this).data("sortable").refreshPositions()};$el.mousedown(function(){$groups.bind("mousemove",refreshPositionsOnMouseMove)}),$el.mouseup(function(){$groups.unbind("mousemove",refreshPositionsOnMouseMove)}),$groups.bind("sortstart",function(event,ui){self.started=!0;var $item=ui.item,itemData=$item.data("tmplItem").data||{},$group=$(event.currentTarget);$group.addClass("tau-list__group_sortover_true"),self.$group=$group;var groupData=$group.data("tmplItem")?$group.data("tmplItem").data:{};self.fire("prioritize.start",{item:itemData,group:groupData})}),$groups.bind("sortstop",function(event,ui){$groups.addClass("tau-list__group_available_true"),$groups.removeClass("tau-list__group_available_false"),$groups.removeClass("tau-list__group_sortover_true")}),$groups.bind("sortupdate",function(event,ui){if(!self.started)return;self.started=!1;var $row=ui.item,$prev=$row.prev("[role=item]"),$next=$row.next("[role=item]"),itemData=$row.data("tmplItem").data||{},prevData=$prev.length?$prev.data("tmplItem").data:{},nextData=$next.length?$next.data("tmplItem").data:{},$targetGroup=$row.parents("[role=group]:first"),groupData=$targetGroup.data("tmplItem")||null;groupData=groupData?groupData.data:null;var isCollapsed=$targetGroup.hasClass("tau-list__group_collapsed_true");$targetGroup.addClass("i-target");var $prevGroup=$(this),prevGroupData=$prevGroup.data("tmplItem")||null;prevGroupData=prevGroupData?prevGroupData.data:null,self.fire("prioritize.checkAvailability",{$item:$row,$prevGroup:$prevGroup,$targetGroup:$targetGroup,item:itemData,prev:prevData,next:nextData,group:groupData,prevGroup:prevGroupData,isCollapsed:isCollapsed})}),$groups.bind("sortchange",function(event,ui){var $group=$groups.find(".tau-list__sortable-placeholder").parents("[role=group]:first");$group.length==1&&$group.hasClass("tau-list__group_sortover_true")==0&&($groups.removeClass("tau-list__group_sortover_true"),$group.addClass("tau-list__group_sortover_true"))});var _newArrange=function(event,i,a,hardRefresh){a?$(a[0]).find(".tau-list__list").append(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],this.direction=="down"?i.item[0]:i.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var self=this,counter=this.counter;window.setTimeout(function(){counter==self.counter&&self.refreshPositions(!hardRefresh)},0)};$groups.each(function(){var $group=$(this);$group.data("sortable")._rearrange=_newArrange})},"bus prioritize.checkAvailability":function(e){this.bus.fire("prioritize.isAvailable.default",{})},"bus prioritize.checkAvailability+prioritize.isNotAvailable":function(e){this.bus.fire("refresh")},"bus prioritize.checkAvailability+prioritize.isAvailable.default+prioritize.isAvailable.comment":function(e){var data=e["prioritize.checkAvailability"].data;this.fire("positionUpdated",data)},"bus prioritize.updateGroupsAvailability":function(e){var data=e.data,availableGroupsData=data.groups,self=this,$groups=this.$el.find("[role=group]");if($groups.length<=1||$groups.length==availableGroupsData.length){$groups.addClass("tau-list__group_available_true").removeClass("tau-list__group_available_false"),this.$group.sortable("refresh");return}var targetGroups=_.filter($groups.toArray(),function(group){var groupData=$(group).data("tmplItem").data;return _.any(availableGroupsData,function(configGroup){return groupData===configGroup})}),$targetGroups=$(targetGroups);$groups.addClass("tau-list__group_available_false").removeClass("tau-list__group_available_true"),$targetGroups.removeClass("tau-list__group_available_false").addClass("tau-list__group_available_true"),this.$group.sortable("refresh")},"bus beforeUpdate":function(){this.$el.find(".i-target [role=counter]").css("backgroundColor","#ffefd5")},"bus afterUpdate":function(evt){this.$el.find("[role=group]").each(function(){$(this).find("[role=counter]").text($(this).find("[role=item]").length)}),this.$el.find(".i-target [role=counter]").animate({backgroundColor:"#ffffff"},200),this.$el.find(".i-target").removeClass("i-target");var item=evt.data.changedItem,$row=this.$el.find(".i-item-"+item.id),$item=$row.parents("[role=item]:first"),itemData=$item.data("tmplItem").data;_.extend(itemData,item);if(this.$el.find("[role=group]").length>1){var className="tau-list__table__row_isfinalstate_true";itemData.entityState&&$row.toggleClass(className,!!itemData.entityState.isFinal)}}})});
define('tau/utils/utils.textConverter',["Underscore","tau/core/class"],function(_,Class){var converter=Class.extend({convert:function(text,escapeHtml){var html=text;if(escapeHtml===!0){var $node=$("<span></span>"),lines=html.split(/\r\n|\r|\n/);for(var i=0;i<lines.length;i++)lines[i]=$node.text(lines[i]).html();html=lines.join("\r\n")}return html=html.replace(/([^\r])\n/gi,"$1<br />\n"),html=html.replace(/\r\n/gi,"<br />\r\n"),html=html.replace(/  /gi,"&nbsp;&nbsp;"),html=html.replace(/&nbsp; /gi,"&nbsp;&nbsp;"),html}});return converter});
define('tau/ui/extensions/list/extension.list.prioritize.comment',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.textConverter"],function(_,$,ExtensionBase,TextConverter){return ExtensionBase.extend({name:"extension.list.prioritize.comment","bus afterRender":function(e){this.$root=e.data.element,this.$el=e.data.element.find("[role=comment-form]")},"bus prioritize.updateGroupsCommentRequirements":function(e){var groupsData=e.data.groups,$groups=this.$root.find("[role=group]");$groups.data("isCommentRequired",!1),_.forEach(groupsData,function(item,i){$groups.eq(i).data("isCommentRequired",item.isCommentRequired)})},"bus prioritize.checkAvailability":function(evt){var $targetGroup=evt.data.$targetGroup,$prevGroup=evt.data.$prevGroup;if(!$targetGroup.data("isCommentRequired")||$targetGroup[0]===$prevGroup[0]){this.fire("prioritize.isAvailable.comment");return}var $item=evt.data.$item;this.$item=$item;var item=evt.data.item;this.item=item;var $form=this.$el;$form.removeClass("updating");var isCollapsed=evt.data.isCollapsed,$alignTo=!1;isCollapsed==0?$alignTo=$item.find("[role=sortable-handler]"):$alignTo=$targetGroup.find("[role=title]"),$item.tauBubble({showOnCreation:!0,alignTo:$alignTo}),$form.detach(),$item.tauBubble("widget").find("[role=content]").append($form),$form.show(),$item.tauBubble("show");var $input=$form.find("textarea");$input.val("").focus();var $buttons=$form.find(":button"),$save=$buttons.eq(0);$save.bind("click",_.bind(this._save,this));var $cancel=$buttons.eq(1);$cancel.bind("click",_.bind(this._cancel,this)),$item.bind("externalClose",_.bind(this._cancel,this));var inputHandler=function(){window.setTimeout(function(){var text=$input.val()||"",disableSave=_.trim(text).length===0;disableSave?$save.attr("disabled","disabled"):$save.attr("disabled")&&$save.removeAttr("disabled"),disableSave?$save.addClass("disable"):$save.removeClass("disable")},50)};inputHandler(),$save.bind("focus",inputHandler),$input.bind("change keyup click propertychange paste",inputHandler)},_save:function(evt){evt.stopPropagation();var self=this,$form=this.$el,textConverter=new TextConverter,text=textConverter.convert($form.find("textarea").val(),!0),store=self.config.store,entity=self.item;$form.addClass("updating"),store.save("comment",{$set:{description:text,general:{id:entity.id}},$include:["id","description","createDate","parentId",{owner:["id","firstName","lastName"]}]}).done({success:function(){$form.removeClass("updating"),self.fire("prioritize.isAvailable.comment"),self.$item.tauBubble("destroy")},failure:function(){self.fire("prioritize.isNotAvailable")}})},_cancel:function(){var self=this;this.$el.addClass("updating");var firePrioritizeIsNotAvailable=function(){self.fire("prioritize.isNotAvailable",{$item:self.$item}),self.$item.tauBubble("destroy")};$.fx.off===!0?firePrioritizeIsNotAvailable():setTimeout(firePrioritizeIsNotAvailable,50)}})});
define('tau/ui/templates/list_/ui.template.list',["tau/core/templates-factory"],function(templates){var config={name:"list",markup:['<div class="tau-list">',"</div>"]};return templates.register(config)});
define('tau/ui/extensions/list/extension.list.groups',["jQuery","tau/components/extensions/component.extension.base","tau/ui/templates/list_/ui.template.list"],function($,ExtensionBase,listTemplate){return ExtensionBase.extend({name:"extension.list.groups","bus afterRender":function(evt){var self=this,$el=evt.data.element;$el.delegate("[role=expander]","click",function(e){var $el=$(e.target);if($el.is("a")||$el.parent("a").length)return;var $group=$el.parents("[role=group]:first");$group.toggleClass("tau-list__group_collapsed_true"),self.bus.fire("toggled")})}})});
define('tau/ui/extensions/list/extension.list.overlay',["tau/components/extensions/component.extension.base","tau/ui/behaviour/overlay/ui.behaviour.overlay"],function(ExtensionBase){return ExtensionBase.extend({name:"extension.list.overlay","bus dataBind+afterRender":function(evt){this.element=evt.afterRender.data.element.parent()},showOverlay:function(){this.element.tauOverlay()},hideOverlay:function(){this.element.tauOverlay("hide")},"bus beforeInit":function(evtArgs){this.element&&this.element.length&&this.showOverlay()},"bus showOverlay":function(evtArgs){this.element&&this.element.length&&this.showOverlay()},"bus afterRender":function(evtArgs){if(this.element&&this.element.length){var self=this;self.hideOverlay()}}})});
define('tau/ui/extensions/list/extension.list.state',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({name:"extension.list.state",initialState:{},"bus beforeInit":function(){},"bus preDataBind":function(evt){var data=evt.data,stateManager=this.stateManager=this.config.context.componentSettings||this.config.context.configurator.getStateManager(),state={};stateManager.get({id:"list",fields:["state"],callback:function(data){state=data.state||{}}});var self=this;_.forEach(data.groups,function(group){var key=_.asString(group.key);self.initialState[key]=group.collapsed,_.isUndefined(state[key])||(group.collapsed=state[key])})},"bus afterInit+afterRender":function(evt){this.$el=evt.afterRender.data.element},"bus toggled":function(evt){var $groups=this.$el.find("[role=group]"),states={},self=this;$groups.each(function(){var $group=$(this),isCollapsedNow=$group.hasClass("tau-list__group_collapsed_true"),data=$group.data("tmplItem").data,key=_.asString(data.key);!_.isUndefined(self.initialState[key])&&self.initialState[key]!==isCollapsedNow&&(states[key]=isCollapsedNow)});var stateManager=this.stateManager,configurator=this.config.context.configurator;stateManager.set({id:"list",set:{state:states},callback:function(){}})}})});
define('tau/ui/extensions/ui.extension.tooltip',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({name:"ui.extension.tooltip",category:"edit","bus afterRender":function(evt){var self=this,$element=evt.data.element;$element.find(".tau-extension-tooltip").each(function(){var $helpEl=$(this),title=$helpEl.prop("title");if(!title)return;$helpEl.prop("title",""),$helpEl.tauBubble({content:'<div class="tau-tooltip-title">'+title+"</div>",zIndex:9999,className:"tau-bubble-tooltip",showEvent:"mouseenter",hideEvent:"mouseleave",mode:"tooltip"})})}})});
define('tau/ui/extensions/list/extension.list.handleAction',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({name:"extension.list.handleAction",getRowElement:function($el,rowId){var $row=$el.find(".i-item-"+rowId);return $row},"bus afterItemsProvided+afterRender+handleGlobalAction":function(evt){var items=evt.afterItemsProvided.data.data,id=evt.handleGlobalAction.data.id,isIdDetected=_(items).detect(function(obj){return obj.id==id});if(isIdDetected){var $el=evt.afterRender.data.element,$row=this.getRowElement($el,id);this.fire("markElementToBeUpdated",{element:$row}),this.fire("updateElement",{element:$row}),this.fire("refreshMainEntity")}},"bus afterRender+beforeDeleteRow":function(evt){var $el=evt.afterRender.data.element,rowId=evt.beforeDeleteRow.data.id,$row=this.getRowElement($el,rowId);this.fire("markElementToBeDeleted",{element:$row}),this.fire("deleteElement",{element:$row,callback:$.noop})},"bus afterRender+afterDeleteRow":function(evt){var self=this,$el=evt.afterRender.data.element,rowId=evt.afterDeleteRow.data.id,$row=this.getRowElement($el,rowId);this.fire("deleteElement",{element:$row,callback:function(){self.fire("refresh")}})}})});
define('tau/ui/extensions/list/extension.list.handleAction.generator',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){var fetchParameterValue=function(obj,jsonSelector){var pathTokens=jsonSelector.split(":"),pointer=obj;return _(pathTokens).each(function(t){pointer=pointer[t]}),pointer};return function(globalEventName,paramName){return ExtensionBase.extend({name:"extension.list.handleAction.generator/"+globalEventName,init:function(){this._super.apply(this,arguments),this.bus.getGlobalBus().on(globalEventName,this.onGlobalAction,this)},destroy:function(){this.bus.getGlobalBus().removeListener(globalEventName,this.onGlobalAction,this),this._super.apply(this,arguments)},onGlobalAction:function(evt){var currentEntityId=fetchParameterValue(evt.data,paramName);this.fire("handleGlobalAction",{id:currentEntityId})}})}});
define('tau/models/dataProviders/model.provider.groups.default',["Underscore","tau/models/dataProviders/model.provider.groups.base"],function(_,Class){return Class.extend({fetch:function(key,items,fnCallback){var groups=[];if(!key){fnCallback(!1);return}_.forEach(items,function(item){var value=_.complexKey(item,key),groupExists=_(groups).any(function(groupItem){return groupItem.key===value});groupExists||groups.push({key:value,items:[]})}),fnCallback(groups)}})});
define('tau/models/model.list',["Underscore","tau/core/model-base","tau/models/dataProviders/model.provider.groups.default"],function(_,ModelBase,GroupsProvider){var entityListModel=ModelBase.extend({name:"model.list",onInit:function(){var self=this;self.store.unbind(this);var itemsProvider=new this.config.itemsDataProvider(this.config);itemsProvider.fetch(function(data){self.fire("afterItemsProvided",{data:data})})},"bus afterItemsProvided":function(e){var self=this,RealGroupsProvider=null;this.config.groupsDataProvider?RealGroupsProvider=this.config.groupsDataProvider:RealGroupsProvider=GroupsProvider;var items=e.data.data,groupFieldName=_.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,provider=new RealGroupsProvider(this.config);provider.fetch(groupFieldName,items,function(groups){self.fireAfterGroupsProvided(groups)})},fireAfterGroupsProvided:function(groups){this.fire("afterGroupsProvided",{data:groups})},createSubscription:function(type,fnDetect){var self=this;self.store.on({eventName:"beforeRemove",type:type,listener:self},function(evt){var removedEntityId=evt.data.id;fnDetect(removedEntityId)&&self.fire("beforeDeleteRow",{id:removedEntityId})}),self.store.on({eventName:"afterRemove",type:type,listener:self},function(evt){var removedEntityId=evt.data.id;fnDetect(removedEntityId)&&self.fire("afterDeleteRow",{id:removedEntityId})})},"bus afterItemsProvided+afterGroupsProvided":function(e){var self=this,items=e.afterItemsProvided.data.data,groups=e.afterGroupsProvided.data.data;if(items&&items.length){var isItemDetected=function(entityId){return _(items).detect(function(item){return item.id==entityId})};_(items).chain().map(function(item){return item.__type}).unique().each(function(type){self.createSubscription(type,isItemDetected)})}var data={items:[],groups:[],isEmpty:items.length?!1:!0};groups!==!1?data.groups=this.innerGroupBy(items,groups):data.items=items,this.data=data,self.fire("afterDataProvided",{data:data})},"bus afterDataProvided":function(e){var result=this.preProcess(e.data.data);this.fire("preDataBind",result),this.fire("dataBind",result)},preProcess:function(data){var currentView=this.config.views[0];return _.forEach(data.groups,function(group){group.title||(_.isObject(group.key)?group.title=_.complexKey(group.key,currentView.group.dataIndex):group.title=group.key)}),data.config={views:this.config.views,currentView:currentView},data},innerGroupBy:function(items,groups){var groupFieldName=_.isArray(this.config.groupBy)?this.config.groupBy[0]:this.config.groupBy,self=this;return _.forEach(groups,function(group){_.forEach(items,function(item){var value=_.complexKey(item,groupFieldName);_.isArray(group.key)&&_.indexOf(group.key,value)>-1?group.items.push(item):_.isEqual(group.key,value)&&group.items.push(item)})}),groups},"bus prioritize.start":function(e){var item=e.data.item,currentGroup=e.data.group,RealGroupsProvider=null;this.config.groupsDataProvider?RealGroupsProvider=this.config.groupsDataProvider:RealGroupsProvider=GroupsProvider;var provider=new RealGroupsProvider(this.config),availableGroups=_.filter(this.data.groups,function(group){return provider.isAvailableForItem(item,group,currentGroup)});this.fire("prioritize.updateGroupsAvailability",{groups:availableGroups});var commentRequirementsConfig=provider.getCommentRequirements(item,this.data.groups,currentGroup);this.fire("prioritize.updateGroupsCommentRequirements",{groups:commentRequirementsConfig})}});return entityListModel});
define('tau/models/model.list.editable',["Underscore","tau/core/model.editable.base"],function(_,ModelBase){var Model=ModelBase.extend({name:"model.list.editable",category:"edit","bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0,deletable:!0})},"bus positionUpdated":function(e){var data=e.data,self=this,item=data.item,store=this.config.store,actions=[];data.isCollapsed==0&&actions.push(function(next){var provider=new self.config.itemsDataProvider(self.config);provider.changePriority(data.item,data.prev,data.next,function(result){next(null,result)})}),data.group&&actions.push(function(next){var provider=new self.config.groupsDataProvider(self.config);provider.moveToGroup(data.item,data.group,data.prevGroup,function(result){next(null,result)})}),data.isCollapsed==1?(self.fire("beforeUpdate"),self.fire("showOverlay"),_.parallel(actions,function(){self.fire("refresh")})):(self.fire("beforeUpdate"),_.parallel(actions,function(err,results){var changed={};_.forEach(results,function(result){result&&_.extend(changed,result.changed||{})}),self.fire("afterUpdate",{changedItem:changed})}))}});return Model});
define('tau/views/view.list',["tau/core/view-base"],function(ViewBase){return ViewBase.extend({name:"view.list","bus initialize":function(evt){var viewConfig=this.config.views[0];viewConfig.type=viewConfig.type||"grid";var listTemplateName=["tau/ui/templates/list_/",viewConfig.type,"/ui.template.list.",viewConfig.type].join(""),self=this;require([listTemplateName],function(listTemplate){self.config.template=listTemplate,self.startLifeCycle(evt)})}})});
define('tau/components/component.list',["Underscore","tau/components/component.creator","tau/ui/extensions/list/extension.list.prioritize","tau/ui/extensions/list/extension.list.prioritize.comment","tau/ui/extensions/list/extension.list.groups","tau/ui/extensions/list/extension.list.overlay","tau/ui/extensions/list/extension.list.state","tau/ui/extensions/ui.extension.tooltip","tau/ui/extensions/list/extension.list.handleAction","tau/ui/extensions/list/extension.list.handleAction.generator","tau/models/model.list","tau/models/model.list.editable","tau/views/view.list","tau/ui/extensions/list/external.refresh.extension"],function(_,creator,SortableExtension,SortableExtensionComment,GroupsExtension,OverlayExtension,StateExtension,TitleTooltipExtension,globalActionsHandler,globalActionsHandlerGenerator,Model,ModelEditable,DefaultView,ExtRefresh){return{create:function(config){config=config||{},config.views=config.views||[{}],_(config.views).each(function(view){view.emptyMessage=view.emptyMessage||"No items found",view.rowTemplateName=view.rowTemplateName||"list-grid-entity__row"});var viewConfig=config.views[0];viewConfig.type=viewConfig.type||"grid",config.multiprojects&&(viewConfig.multiprojects=config.multiprojects),viewConfig.timeTrackingPolicies=config.context.getTimeTrackingPolicies();var extensions=[ModelEditable,GroupsExtension,OverlayExtension,StateExtension,TitleTooltipExtension,ExtRefresh,globalActionsHandler,globalActionsHandlerGenerator("bugWasMarkedAsDuplicate","duplicateBugId"),globalActionsHandlerGenerator("entityWasMovedToProject","entity:id"),globalActionsHandlerGenerator("entityWasCopiedToProject","entity:id")];config.sortable!==!1&&(extensions.push(SortableExtension),extensions.push(SortableExtensionComment));var creatorConfig={extensions:extensions.concat(config.extensions||[]),ModelType:Model,ViewType:config.ViewType||DefaultView};return config.template&&(creatorConfig.template=config.template),creator.create(creatorConfig,config)}}});
define('tau/models/dataProviders/customField/customField.multipleEntities.model.provider.entities.items',["Underscore","tau/models/dataProviders/model.provider.items.base"],function(_,BaseProvider){return BaseProvider.extend({fetch:function(fnCallback){var entityId=this.config.context.entity.id,entityType=this.config.context.entity.entityType.name.toLowerCase(),targetField=this.config.customField,store=this.config.store,self=this;store.get(entityType,{id:entityId,fields:["customFields"]}).done(function(res){var field=_.find(res[0].data.customFields,function(v){return v.name==targetField.name});if(field.value==null){fnCallback([]);return}var values=field.value.split(","),entityMap=_.map(values,function(item){var parts=item.split(" ");return{id:parts[0],type:parts[1]}}),types=_.uniq(_.map(entityMap,function(item){return item.type})),ids=_.uniq(_.map(entityMap,function(item){return item.id})),requests=_.map(types,function(type){return function(next){store.find(type,{fields:self._getFieldsForEntity(type),$query:{id:{$in:ids}}}).done({success:function(r){next(!1,r[0].data)}})}});_.parallel(requests,function(err,results){var adapted=[];_.reduce(results,function(memo,r){return r.length>0&&memo.push({type:r[0].__type,items:r}),memo},adapted),adapted=_.sortBy(adapted,function(item){return item.items.length>0&&item.items[0].entityType.id}),fnCallback(self.transform(adapted))})})},_getFieldsForEntity:function(entityType){var baseFieldSet=["id","name",{entityType:["name"]},{project:["abbreviation"]}];switch(entityType.toLowerCase()){case"userstory":case"bug":case"feature":case"task":case"testplanrun":case"testcaserun":case"request":return baseFieldSet.concat([{entityState:["name","isFinal"]},{release:["name"]},{iteration:["name"]}]);case"project":case"release":case"program":return baseFieldSet.concat(["startDate","endDate"]);case"iteration":return baseFieldSet.concat(["startDate","endDate",{release:["name"]}]);case"build":return baseFieldSet.concat(["buildDate",{release:["name"]},{iteration:["name"]}]);case"impediment":return baseFieldSet.concat([{entityState:["name","isFinal"]}]);case"testcase":return baseFieldSet.concat(["lastStatus"]);default:return baseFieldSet}},transform:function(itemsGrouped){var items=[],maxEntityTypeId=0;_.reduce(itemsGrouped,function(itemsMemo,itemsGroup){return _.forEach(itemsGroup.items,function(item){itemsMemo.push(item),item.entityType.id>maxEntityTypeId&&(maxEntityTypeId=item.entityType.id)},this),itemsMemo},items,this);var self=this;return items=_.map(items,function(v){return v.url=self.config.context.configurator.getUrlBuilder().getNewViewUrl(v.id,v.entityType.name,!0),v}),_.sortBy(items,function(item){return item.entityState&&item.entityState.isFinal?maxEntityTypeId+item.entityType.id:item.entityType.id})}})});
define('tau/ui/extensions/list.customField.multipleEntities/ui.extension.list.customField.multipleEntities.finder.attach',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus beforeInit:last + entitySelected":function(evt,initConfig,selectedData){var targetField=initConfig.config.customField,entity=initConfig.config.context.entity,store=initConfig.config.context.configurator.getStore(),self=this;store.get(entity.entityType.name,{id:entity.id,fields:["customFields"]}).done(function(res){var field=_.find(res[0].data.customFields,function(v){return v.name==targetField.name}),ids=field.value!=null?field.value.split(","):[];self.fire("prevValues.ready",ids)})},"bus beforeInit:last + entitySelected + prevValues.ready":function(evt,initConfig,selectedData,previousValues){var selectedEntity=selectedData.entity,targetField=initConfig.config.customField,entity=initConfig.config.context.entity,store=initConfig.config.context.configurator.getStore(),selected=selectedEntity.id+" "+selectedEntity.entityType.name.toLowerCase();store.save(entity.entityType.name,{id:entity.id,$set:{customFields:[{name:targetField.name,value:_.uniq(previousValues.concat(selected)).join(",")}]},fields:["id","customFields"]}).done(function(res){})}})});
define('tau/ui/extensions/list.customField.multipleEntities/ui.extension.list.customField.multipleEntities.finder',["Underscore","tau/core/extension.base","tau/ui/extensions/list.customField.multipleEntities/ui.extension.list.customField.multipleEntities.finder.attach"],function(_,ExtensionBase,ExtensionAttach){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){this.store=initConfig.config.context.configurator.getStore(),this.entity=initConfig.config.context.entity,this._registerRefreshHandler(this.store,this.entity)},"bus beforeInit + afterRender":function(evt,initConfig,renderData){this.customField=initConfig.config.customField,this.fire("customField.ready",this.customField),this._initFinder(renderData.element.find(".i-role-action-attach"),this.customField)},"bus beforeInit:last + customField.ready + afterRender":function(evt,initEvt,customField,renderData){var self=this;this._retrieveIdsForField(this.store,this.entity.id,this.entity.entityType.name,this.customField.name,function(ids){var $detach=renderData.element.find(".i-role-action-detach");$detach.on("click",function(el){self._doDetach(el,ids,self.store,self.customField,self.entity)})})},_doDetach:function(target,ids,store,customField,entity){var id=$(target.currentTarget).attr("data-entity-id"),entityType=$(target.currentTarget).attr("data-entity-type").toLowerCase(),ids=ids;ids=_.reject(ids,function(el){return el==id+" "+entityType}).join(","),this._saveIds(store,entity.id,entity.entityType.name,customField.name,ids,function(res){})},_saveIds:function(store,entityId,entityTypeName,customFieldName,ids,doneCallback){store.save(entityTypeName,{id:entityId,$set:{customFields:[{name:customFieldName,value:ids}]},fields:["id","customFields"]}).done(function(res){doneCallback&&doneCallback(res)})},_registerRefreshHandler:function(store,entity){var self=this;store.unbind(this),store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,filter:{id:entity.id},hasChanges:["customFields"]},function(){self.fire("refresh")})},_initFinder:function($action,customField){var bubbleConfig={actionOnBlur:"destroy",target:$action,componentsConfig:{components:[{type:"finder",fields:["id","name",{entityType:["name"]},{project:["abbreviation"]}],additionalExtensions:[ExtensionAttach],customField:customField}]}};customField.value&&(bubbleConfig.componentsConfig.components[0].$query={entityType:{id:{$in:_.asString(customField.value).split("\r\n").join(",")}}}),this.fire("initBubble",bubbleConfig)},_retrieveIdsForField:function(store,entityId,entityTypeName,customFieldName,idsCallback){store.get(entityTypeName,{id:entityId,fields:["customFields"]}).done(function(res){var field=_.find(res[0].data.customFields,function(v){return v.name==customFieldName}),ids=field.value!=null?field.value.split(","):[];idsCallback(ids)})}})});
define('tau/ui/templates/list_/customField.multipleEntities/ui.template.list.customField.multipleEntities',["tau/core/templates-factory","tau/utils/utils.date"],function(templates,dateUtils){var config={name:"list.customField.multipleEntities",engine:"jqote2",customFunctions:{dateToString:function(dateStr){return dateUtils.format.date.short(dateUtils.convertToTimezone(dateStr))}},markup:['<div class="tau-container tau-list tau-list__group_flat_true">','<div class="ui-quick-add">','<span class="ui-link ui-quick-add-link i-role-action-attach">Add Item</span>',"</div>","<% if (this.items.length == 0){ %>",'<div class="tau-list__empty-message">No items.</div>',"<% } else { %>",'<table class="tau-list__table tau-list__list" role="list">',"<tbody>","<% _.forEach(this.items, function(item){ %>",'<tr class="i-item-<%= item.id %> tau-list__table__row<% if (item.entityState && item.entityState.isFinal) { %> tau-list__table__row_isfinalstate_true<% };  %>" role="item">','<td class="tau-list__table__cell tau-list__table__cell-id tau-list__list__item" >','<a href="<%= item.url %>"><em class="ui-type-icon ui-type-icon-<%= item.__type.toLowerCase() %>"><%= item.id %></em></a>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-name tau-list__table__cell-padding  tau-list__list__item" width="30%"><%= item.name %></td>','<td class="tau-list__table__cell tau-list__list__item"><%= item.project ? item.project.abbreviation : "" %></td>','<td class="tau-list__table__cell tau-list__list__item">',"<% if (item.entityState) { %>",'<div runas="property.entityState" data-context:general:id="<%= item.id %>" data-context:general:entity-type:name="<%=item.__type %>"><%= item.entityState.name %></div>',"<% } else { %>",'<% if (item.hasOwnProperty("lastStatus")) { %>','<div runas="property.lastStatus" data-context:general:id="<%= item.id%>" data-context:general:entity-type:name="<%= item.__type %>"><%= item.lastStatus %></div>',"<% };  %>","<% };  %>","</td>",'<td class="tau-list__table__cell tau-list__list__item"><%= item.release ? item.release.name : "" %></td>','<td class="tau-list__table__cell tau-list__list__item"><%= item.iteration ? item.iteration.name : "" %></td>','<td class="tau-list__table__cell tau-list__list__item"><%= item.buildDate ? fn.dateToString(item.buildDate) : fn.dateToString(item.startDate) %></td>','<td class="tau-list__table__cell tau-list__list__item"><%= fn.dateToString(item.endDate) %></td>','<td class="tau-list__table__cell tau-list__list__item">',"<% if (item.assignments && item.assignments.length) { _.forEach(item.assignments, function(assignment){ %>",'<span class="ui-assignment__group__users">','<span class="ui-assignment__user user tau-avatar_<%= assignment.generalUser.id %> tau-bubble-target" userid="<%= assignment.generalUser.id %>">','<img class="user-name ui-link" title="<%= assignment.generalUser.firstName %> <%= assignment.generalUser.lastName %>" alt="<%= assignment.generalUser.firstName %> <%= assignment.generalUser.lastName %>" style="width:24px; height:24px;" src="<%= assignment.generalUser.avatarUri %>32">',"</span>","</span>","<% }); } %>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-remove tau-list__list__item">','<button type="button" class="tau-btn tau-attention i-role-action-detach" data-entity-type="<%= item.__type.toLowerCase() %>" data-entity-id="<%= item.id %>">Remove</button>',"</td>",'<td width="1"></td>',"</tr>","<% }); %>","</tbody>","</table>","<% }  %>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.multipleEntities',["Underscore","tau/components/component.list","tau/models/dataProviders/customField/customField.multipleEntities.model.provider.entities.items","tau/ui/extensions/list.customField.multipleEntities/ui.extension.list.customField.multipleEntities.finder","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/list_/customField.multipleEntities/ui.template.list.customField.multipleEntities","tau/views/view.compositeControl","tau/ui/extensions/list/request/extension.list.entityState"],function(_,ComponentList,ItemsDataProvider,ExtensionFinder,ExtensionBubble,ExtensionComponents,Template,ViewCompositeControl,EntityStateListExtension){return{create:function(config){return config=_.extend(config,{itemsDataProvider:ItemsDataProvider,extensions:[ExtensionFinder,ExtensionBubble,ExtensionComponents,EntityStateListExtension],template:Template,ViewType:ViewCompositeControl,dependencies:["property.lastStatus","property.entityState"]}),ComponentList.create(config)}}});
define('tau/components/extensions/customField/extension.customField.multiselect.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");this.$widget=$widget,$el.find(".ui-customfield__label").behaviourCustomFieldRow({}),$el.addClass("ui-customfield_editable_true")}}})});
define('tau/ui/templates/customField/ui.template.customField.multiselect',["tau/core/templates-factory"],function(templates){var config={name:"customField-multiselect",markup:['<div class="ui-customfield ui-customfield-multiselect {{if !output}}ui-customfield_empty_true{{/if}}">',"   <table>","   <tbody>","   <tr>",'       <td class="ui-customfield__label">${name}</td>','       <td class="ui_custom_field_value_container"><div class="ui-customfield__value">${output}</div></td>',"   </tr>","   </tbody>","   </table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.multiselect',["Underscore","tau/components/component.creator","tau/models/model.customField","tau/models/model.customField.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/bubble/extension.bubble.creator.direct","tau/components/extensions/component.creator.extension","tau/components/extensions/customField/extension.customField.multiselect.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/templates/customField/ui.template.customField.multiselect"],function(_,creator,Model,ModelEditable,RequireCustomField,PopupExtension,CreatorExtension,RowExtension,EditableExtension,template){return{create:function(config){var creatorConfig={ModelType:Model,extensions:[ModelEditable,RequireCustomField,RowExtension,EditableExtension,CreatorExtension,{type:PopupExtension,config:{popupEditorContainer:[{target:"tr",alignTo:".ui-customfield__value",componentsConfig:{components:[{type:"customField.multiselect.list"}]}}]}}],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.multiselect.editable',["Underscore","tau/models/model.customField.editable"],function(_,ModelBase){var model=ModelBase.extend({onInit:function(){if(this.config.data){var curValue=this.config.data.value,choices=[];_.map(this.config.data.options,function(item){choices.push({id:item,name:item,selected:_.include(curValue,item)})});var nullableValue=curValue?!this.config.data.required&&choices.length:!1;this.fire("dataBind",{states:choices,nullableValue:nullableValue})}},"bus updateState":function(evt){var val=null;evt.data&&evt.data.id&&(val=evt.data.id);var $set={customFields:[{name:this.config.data.name,type:this.config.data.type,value:_.toArray(val).join(",")}]};this.fire("save",$set)}});return model});
define('tau/ui/extensions/stateList/ui.extension.stateList.editable.multiselect',["Underscore","jQuery","tau/ui/extensions/stateList/ui.extension.stateList.editable"],function(_,$,ExtensionBase){var Extension=ExtensionBase.extend({"bus dataBind+afterRender":function(evt){this._super(evt);var $el=evt.afterRender.data.element;this.$el=$el,this.field=this.config.data,this._updateSave();var $saveButton=$el.find("[role=action-save]"),self=this;$saveButton.click(function(e){var $opts=$el.find("[role=option].tau-option_selected_true"),values=[];_.forEach($opts,function(option){values.push($(option).tmplItem().data.id)}),self._updateState(values)});var $cancelButton=$el.find("[role=action-cancel]");$cancelButton.click(function(e){self.fire("close")})},"bus blur":function(){this.bus.fire("close")},onItemSelected:function(evt){var $option=$(evt.target);$option.toggleClass("tau-option_selected_true"),this._updateSave()},_updateSave:function(){if(this.field.required==1){this.enabled=this.enabled||null;var $opts=this.$el.find("[role=option].tau-option_selected_true"),$saveButton=this.$el.find("[role=action-save]");$opts.length?($saveButton.removeClass("disable"),$saveButton.removeAttr("disabled")):($saveButton.addClass("disable"),$saveButton.attr("disabled","disabled"))}}});return Extension});
define('tau/ui/templates/state/ui.template.state.option.multiselect',["tau/core/templates-factory"],function(templates){var config={name:"state.option.multiselect",markup:["{{if items}}",'<div class="drop-down-group i-group">','<span class="i-group-name">${name}</span>','{{tmpl(items) "state.option.multiselect"}}',"</div>","{{else}}",'<div role="option" data-id="${id}" class="i-role-option drop-down-option tau-option{{if selected}} tau-option_selected_true{{/if}}" {{if description}}title="${description}"{{/if}}>',"${name}","</div>","{{/if}}"]};return templates.register(config)});
define('tau/ui/templates/state/ui.template.state.list.multiselect',["tau/core/templates-factory","tau/ui/templates/state/ui.template.state.option.multiselect"],function(templates){var config={name:"state.list.multiselect",markup:['<div class="ui-drop-down">',"{{if states.length}}",'<div role="list" class="drop-down-list drop-down-list_type_multiselect">','<div class="drop-down-list__inner i-inner">','{{tmpl(states) "state.option.multiselect"}}',"</div>","</div>",'<div class="ui-drop-down__actions ui-form__row ui-form__row-controls button-group">','<input type="button" role="action-save" class="button" value="Save" />','<input type="button" role="action-cancel" class="button" value="Cancel" />',"</div>","{{else}}",'<div class="drop-down-list drop-down-list_type_multiselect">','<div role="placeholder-empty">No items found</div>',"</div>","{{/if}}","</div>"]};return templates.register(config)});
define('tau/components/component.customField.multiselect.list',["tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.multiselect.editable","tau/ui/extensions/stateList/ui.extension.stateList.editable.multiselect","tau/ui/extensions/bubble/ui.extension.bubble.listResizer","tau/ui/templates/state/ui.template.state.list.multiselect"],function(creator,Model,ModelEditable,EditableExtension,ListExtension,template){return{create:function(config){var creatorConfig={extensions:[Model,ModelEditable,EditableExtension,ListExtension],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.number.editable',["Underscore","tau/models/model.customField.editable","tau/utils/utils.jsonSchema"],function(_,ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{type:"number",optional:!1,minimum:0,maximum:_.MAX_INT,minimumCanEqual:!0,pre:["trim","castTolerantlyToType"],"default":0,fallbacks:{type:"setDefault"}}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0],value=data.value+"",delimiter=this.config.context.applicationContext.culture.decimalSeparator;data.value=data.value.toString().replace(",","."),this.schema.properties.value.optional=!this.config.customField.required,this.schema.properties.value.empty=!this.config.customField.empty,args.validation=this.schema.validate(data)},"bus beforeSave":function(evt){var val=evt.data.cmd.$set.customFields[0].value;evt.data.cmd.$set.customFields[0].value=_.isNumber(val)?val:null}});return model});
define('tau/components/extensions/customField/extension.customField.number.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.editableText","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit",$widget:null,fieldData:null,"bus permissionsReady+afterRender":function(eventData){var delimiter=this.config.context.applicationContext.culture.decimalSeparator,self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");self.$widget=$widget;var mask="^[0-9]*(["+delimiter+"][0-9]{0,2})?$";$widget.editableText({mask:mask,restoreText:!1,onSave:function(text){self.bus.fire("save",{customFields:[{name:fieldData.name,type:fieldData.type,value:text.replace(",",".")}]})}}),$el.behaviourCustomFieldRow({onActivate:function(){$widget.editableText("activate"),$widget.focus()}}),$el.addClass("ui-customfield_editable_true")}},"bus validate":function(){this.$widget.editableText("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.editableText("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){this.$widget.editableText("setValidationErrors",evt.data.validation.errors[0].description)}})});
define('tau/ui/templates/customField/ui.template.customField.text',["tau/core/templates-factory"],function(templates){var config={name:"customField-text",markup:['<div class="ui-customfield  {{if !value}}ui-customfield_empty_true{{/if}}">',"   <table>","   <tbody>","   <tr>",'       <td class="ui-customfield__label">${name}</td>','       <td class="ui_custom_field_value_container"><div class="ui-customfield__value">${value}</div></td>',"   </tr>","   </tbody>","   </table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.number',["tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.number.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/customField/extension.customField.number.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/templates/customField/ui.template.customField.text"],function(creator,ModelType,ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[ModelTypeEditable,ExtensionEditable,RequireCustomField,ExtensionHighlight]};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.richtext.editable',["tau/models/model.customField.editable","tau/utils/utils.jsonSchema","tau/utils/utils.htmlConverter"],function(ModelBase,jsonSchema,htmlConverter){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{optional:!0,empty:!0,maxLength:4e3,type:"string",pre:["trim"]}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0];args.validation=this.schema.validate(data)},"bus beforeSave":function(evtData){var item=evtData.data.cmd.$set,field=item.customFields[0];field.value=htmlConverter.fromHtmlToSource(field.value)}});return model});
define('tau/components/extensions/customField/extension.customField.richtext.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,field=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");self.$widget=$widget,$widget.richeditor({text:$el.tmplItem().data.value,placeholder:{text:"Double-click to add content...",className:"ui-description__inner_empty_true"},settings:{fitImgWidth:!1,toolbar:[["Cut","Copy","Paste","PasteText","PasteFromWord","-","Bold","Italic","Underline","Strike","-","Subscript","Superscript"],["NumberedList","BulletedList","-","Outdent","Indent"],["JustifyLeft","JustifyCenter","JustifyRight"],["Link","Unlink","Anchor"],["Image","Table","HorizontalRule","SpecialChar"],"/",["Source","Format","Font","FontSize"],["Replace","-","RemoveFormat","TextColor","BGColor","-","Templates"],["Maximize"]],extraPlugins:"autogrow,charcount",charcount_limit:4e3},onCreateEditor:function(value){self.fire("editor.ready",value)},onStopEdit:function(value){self.fire("stop.editing",value)},onStartEdit:function(value){self.fire("start.editing",value)},onBeforeSaveWithClose:function(text){self.fire("allow.close.editor",text)},onSave:function(text){self.bus.fire("save",{customFields:[{name:field.name,type:field.type,value:text}]})}})}},"bus validate":function(){this.$widget.richeditor("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.richeditor("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){this.$widget.richeditor("setValidationErrors",evt.data.validation.errors[0].description)}})});
define('tau/ui/extensions/customField/ui.extension.customField.richText.editable',["./ui.extension.customField.editable"],function(ExtensionBase){var extension=ExtensionBase.extend({"bus preRefreshRow + allow.close.editor":function(evt){this._markElementAsUpdate()},"bus preRefreshRow":function(evt){},"bus allow.close.editor > afterSave":function(evt){this._refreshElement()},"bus refreshRow":function(evt){}});return extension});
define('tau/ui/templates/customField/ui.template.customField.richtext',["tau/core/templates-factory"],function(templates){var config={name:"customField-richtext",markup:['<div class="ui-customfield ui-customfield-richtext">','   <div class="ui-customfield__value value">{{html value}}</div>',"</div>"]};return templates.register(config)});
define('tau/ui/extensions/ui.extension.content.imagePreview',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,BaseExtension){return BaseExtension.extend({category:"edit","bus afterRender":function(evt){var self=this,afterRenderData=evt.data,$element=afterRenderData.element,contentSelector=this.config.imagePreviewContentSelector,$images=$element.find(contentSelector).find("img");if($images.size()>0)var interval=setInterval(function(){$.contains(document.body,$element[0])&&(clearInterval(interval),self.onDOMReady($element))},1e3)},onDOMReady:function($el){var self=this,contentSelector=this.config.imagePreviewContentSelector,$images=$el.find(contentSelector).find("img"),maxWidth=$el.width();for(var i=0,len=$images.size();i<len;i++){var $img=$images.eq(i),naturalWidth=parseInt($img[0].naturalWidth,10);if(naturalWidth>maxWidth){var $box=$('<div class="tau-lightbox-container"></div>'),$link=$('<a rel="lightbox" target=_blank class="tau-lightbox-full-size">View Full Size</a>');$link.attr("href",$img.attr("src")),$link.click($.proxy(self.pushEscapeHandler,self)),$box.append($img.clone()).append($link),$img.replaceWith($box)}}},pushEscapeHandler:function(e){var self=this,km=this.config.context.configurator.getKeyBoardManager();km.pushHandler({handleKeyDown:function(evt){evt.keyCode==$.ui.keyCode.ESCAPE&&_.bind(self.popHandler,self)()}}),$("body").find("#ux-lightbox-overlay").bind("click",_.bind(self.popHandler,self))},popHandler:function(){var self=this;this.config.context.configurator.getKeyBoardManager().popHandler(),$("body").find("#ux-lightbox-overlay").unbind("click",self.popHandler)}})});
define('tau/components/extensions/field/extension.field.rich-text.auto-save',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus editor.ready":function(evt,editor){var self=this;this.enableAutoSave();if(self.config.disableAutoSave)return;var fireAutoSave=function(){self.fire("auto.save",editor)},dataChangeEvents=["afterCommandExec","key","insertElement","paste"],onChangeData=function(){self.fire("something.changed"),self.timeoutId&&clearTimeout(self.timeoutId),self.timeoutId=setTimeout(fireAutoSave,1e3)};_.each(dataChangeEvents,function(name){editor.api.ckeInstance.on(name,onChangeData)}),self.fire("status.element",$(".ui-richeditor__controls__status_message",editor.api.$editor))},showStatus:function(message){this.fire("set.auto.save.status",message)},"bus auto.save":function(evt,editor){if(this.disabled)return;if(editor.api.ckeInstance.getData()==="")return;editor.api.performSave()!==null&&(this.disableAutoSave(),this.showStatus("Saving..."))},"bus auto.save + afterSave":function(){this.disabled=!1,this.showStatus("All changes saved"),this.fire("reset.status.on.change")},enableAutoSave:function(){this.disabled=!1},"bus start.editing":function(){this.enableAutoSave(),this.showStatus("")},"bus status.element:last > reset.status.on.change > something.changed":function(evt,$status){$status.text("")},"bus status.element:last + set.auto.save.status":function(evt,$status,message){$status.text(message)},"bus allow.close.editor":function(){this.disableAutoSave()},disableAutoSave:function(){this.disabled=!0,clearTimeout(this.timeoutId||0)},"bus stop.editing":function(){this.disableAutoSave()},"bus editor.ready + destroy":function(){this.disableAutoSave()}})});
define('tau/components/component.customField.richtext',["tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.richtext.editable","tau/components/extensions/customField/extension.customField.richtext.editable","tau/ui/extensions/customField/ui.extension.customField.richText.editable","tau/ui/templates/customField/ui.template.customField.richtext","tau/ui/extensions/ui.extension.shortcutProcessor","tau/ui/extensions/ui.extension.content.imagePreview","tau/components/extensions/field/extension.field.rich-text.auto-save"],function(creator,ModelType,ModelTypeEditable,ExtensionEditable,ExtensionHighlight,template,ShortcutProcessorExtension,ImagePreviewExtension,AutoSave){return{create:function(config){config=config||{};var creatorConfig={ModelType:ModelType,template:template,extensions:[ModelTypeEditable,ExtensionEditable,ExtensionHighlight,ImagePreviewExtension,ShortcutProcessorExtension,AutoSave]};return config.shortcutProcessorTarget=".ui-customfield__value.value",config.imagePreviewContentSelector=".ui-customfield__value.value",creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.templatedUrl.editable',["tau/models/model.customField.editable","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{type:"string",optional:!0,maxLength:4e3,minLength:0,pre:["trim"]}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0];this.schema.properties.value.optional=!this.config.customField.required,this.schema.properties.value.empty=!this.config.customField.required,args.validation=this.schema.validate(data)}});return model});
define('tau/components/extensions/customField/extension.customField.templatedUrl.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.editableText","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");self.$widget=$widget;var $h;$widget.editableText({onEditStart:function(){$h=$widget.children().detach(),$widget.text(""),$widget.hasClass("ui-validationerror")||$widget.text($widget.data("textEdit"))},onEditEnd:function(){$widget.hasClass("ui-validationerror")||$widget.html($h)},restoreText:!1,onSave:function(text){self.bus.fire("save",{customFields:[{name:fieldData.name,type:fieldData.type,value:text}]})}}),$widget.on("click","a",function(e){e.stopImmediatePropagation()}),$el.behaviourCustomFieldRow({onActivate:function(){$widget.editableText("activate"),$widget.focus()}}),$el.addClass("ui-customfield_editable_true")}},"bus validate":function(){this.$widget.editableText("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.editableText("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){this.$widget.editableText("setValidationErrors",evt.data.validation.errors[0].description)}})});
define('tau/ui/templates/customField/ui.template.customField.templatedurl',["tau/core/templates-factory"],function(templates){var config={name:"customField-templatedUrl",engine:"jqote2",markup:['<div class="ui-customfield ui-customfield-templatedUrl <% if (this.isEmpty){ %>ui-customfield_empty_true<% } %>">',"<table>","<tbody>","<tr>",'<td class="ui-customfield__label"><%! this.name %></td>','<td class="ui_custom_field_value_container">','<div class="ui-customfield__value" data-text-edit="<%= this.value %>">',"<% _.forEach(this.output, function(v, i){ %>",'<a class="tau-linkentity tau-linkentity_type_full" title="<%! v.title %>" href="<%= v.url %>" target="_blank">','<span class="tau-linkentity__inner"><%! v.title %></span>','<span class="external-view"></span>',"</a>","<% }); %>","</div>","</td>","</tr>","</tbody>","</table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.templatedurl',["Underscore","tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.templatedUrl.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/customField/extension.customField.templatedUrl.editable","tau/ui/templates/customField/ui.template.customField.templatedurl"],function(_,creator,ModelType,ModelTypeEditable,ExtensionEditableMain,ExtensionEditableRequired,ExtensionEditableWidget,template){return{create:function(config){var creatorConfig={extensions:[ModelType,ModelTypeEditable,ExtensionEditableMain,ExtensionEditableRequired,ExtensionEditableWidget],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.text.editable',["tau/models/model.customField.editable","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{type:"string",optional:!0,maxLength:4e3,minLength:0,pre:["trim"]}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0];this.schema.properties.value.optional=!this.config.customField.required,this.schema.properties.value.empty=!this.config.customField.required,args.validation=this.schema.validate(data)}});return model});
define('tau/components/extensions/customField/extension.customField.text.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.editableText","tau/ui/behaviour/customField/ui.behaviour.customField.row"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,fieldData=eventData.afterRender.data.data,permissions=eventData.permissionsReady.data;if(permissions.editable){var $el=eventData.afterRender.data.element,$widget=$el.find(".ui-customfield__value");self.$widget=$widget,$widget.editableText({restoreText:!1,onSave:function(text){self.bus.fire("save",{customFields:[{name:fieldData.name,type:fieldData.type,value:text}]})}}),$el.behaviourCustomFieldRow({onActivate:function(){$widget.editableText("activate"),$widget.focus()}}),$el.addClass("ui-customfield_editable_true")}},"bus validate":function(){this.$widget.editableText("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.editableText("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){this.$widget.editableText("setValidationErrors",evt.data.validation.errors[0].description)}})});
define('tau/components/component.customField.text',["tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.text.editable","tau/ui/extensions/customField/ui.extension.customField.required","tau/components/extensions/customField/extension.customField.text.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/ui/templates/customField/ui.template.customField.text"],function(creator,ModelType,ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight]};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.url.editable',["tau/models/model.customField.editable","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",name:"Editable custom field",schema:jsonSchema.Schema.create({type:"object",properties:{value:{type:"object",optional:!1,pre:function(instance){var notEmpty=!!_.trim(instance.label)||!!_.trim(instance.url);return this.schema.properties.label.optional=this.schema.properties.label.optional&&!notEmpty,this.schema.properties.label.empty=this.schema.properties.label.empty&&!notEmpty,this.schema.properties.url.optional=this.schema.properties.url.optional&&!notEmpty,this.schema.properties.url.empty=this.schema.properties.url.empty&&!notEmpty,instance},properties:{label:{type:"string",optional:!0,maxLength:30,pre:["trim"]},url:{type:"string",optional:!0,pattern:jsonSchema.PATTERN_URL,pre:["trim",function(instance){return instance.length==0&&this.schema.optional&&(this._wasError=1),instance}]}},post:function(instance){return!instance.label&&!instance.url&&(instance={label:null,url:null}),instance}}}}),"bus validate":function(evt){var args=evt.data,data=args.cmd.$set.customFields[0],customField=this.config.customField||this.config.data;this.schema.properties.value.properties.label.optional=!customField.required,this.schema.properties.value.properties.label.empty=!customField.required,this.schema.properties.value.properties.url.optional=!customField.required,this.schema.properties.value.properties.url.empty=!customField.required,args.validation=this.schema.validate(data),delete args.validation.instance.value.__id}});return model});
define('tau/models/customField/model.customField.url.editable.editor',["tau/models/customField/model.customField.url.editable"],function(ModelBase,jsonSchema){var model=ModelBase.extend({onInit:function(){this.beforeSaveHandler=!0,this.afterSaveHandler=!0,this.config.data&&this.fire("dataBind",this.config.data)}});return model});
define('tau/ui/behaviour/customField/ui.behaviour.customField.url.editor',["Underscore","jQuery"],function(_,$){$.widget("ui.behaviourUrlEditor",{options:{onSave:$.noop},_create:function(){var $element=this.element;this.$element=$element;var self=this;$element.find(":button:first").click(function(e){e.preventDefault(),_.bind(self._save,self)()}),$element.find(":input").keyup(function(e){e.keyCode==jQuery.ui.keyCode.ENTER&&(e.preventDefault(),_.bind(self._save,self)())})},_save:function(){var $element=this.element;this.options.onSave({url:$element.find("[name=url]").val(),label:$element.find("[name=label]").val()})},setValidationErrors:function(data){var $form=this.$element;_.each(data,function(value,name){$form.find("[name="+name+"]").addClass("ui-validationerror").attr("title",value)})},resetValidationErrors:function(data){this.$element.find(":text").removeClass("ui-validationerror").attr("title",null)},setValue:function(data){var $form=this.$element;_.each(data,function(value,name){$form.find("[name="+name+"]").val(value)})},destroy:function(){}})});
define('tau/components/extensions/customField/extension.customField.url.editor',["Underscore","jQuery","tau/core/extension.base","tau/ui/behaviour/customField/ui.behaviour.customField.url.editor"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus dataBind+afterRender":function(evt){var self=this,customField=evt.dataBind.data,$el=evt.afterRender.data.element;this.$widget=$el,$el.find("[name=url]").val(customField.value.url),$el.find("[name=label]").val(customField.value.label),$el.behaviourUrlEditor({onSave:function(value){self.bus.fire("save",{customFields:[{name:customField.name,type:"URL",value:value}]})}}),$el.find(":button:eq(1)").click(function(){self.bus.fire("close")})},"bus validate":function(){this.$widget.behaviourUrlEditor("resetValidationErrors")},"bus afterValidate":function(evt){this.$widget.behaviourUrlEditor("setValue",evt.data.validation.instance.value)},"bus validationFailed":function(evt){var errs={};_.each(evt.data.validation.errors,function(item){_.each(["url","label"],function(field){_.indexOf(item.path,field)!==-1&&(errs[field]=item.description)})}),this.$widget.behaviourUrlEditor("setValidationErrors",errs)}})});
define('tau/ui/templates/customField/ui.template.customField.url.editor',["tau/core/templates-factory"],function(templates){var config={name:"customField-url-editor",markup:['<div class="ui-form">','   <div class="ui-form__row"><label for="url">Url</label><input type="text" name="url" /></div>','   <div class="ui-form__row"><label for="label">Description</label><input type="text" name="label" /></div>','   <div class="ui-form__row ui-form__row-controls button-group"><input type="button" value="save" class="button" /><input type="button" value="cancel" class="button" /></div>',"</div>"]};return templates.register(config)});
define('tau/components/component.customField.url.editor',["tau/components/component.creator","tau/models/model.customField","tau/models/customField/model.customField.url.editable.editor","tau/components/extensions/customField/extension.customField.url.editor","tau/ui/templates/customField/ui.template.customField.url.editor"],function(creator,Model,EditableModel,EditableExtension,template){return{create:function(config){var creatorConfig={extensions:[Model,EditableModel,EditableExtension],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/customField/model.customField.url.editable.row',["tau/models/customField/model.customField.url.editable"],function(ModelBase,jsonSchema){var model=ModelBase.extend({onInit:function(){var self=this,ctx=this.config.context,entityTypeName=ctx.entity.entityType.name},"bus afterSaveToStore":function(){this.bus.fire("refreshRow",{})}});return model});
define('tau/ui/templates/customField/ui.template.customField.url',["tau/core/templates-factory"],function(templates){var config={name:"customField-url",markup:['<div class="ui-customfield ui-customfield-url {{if !value.url}}ui-customfield_empty_true{{/if}}">',"   <table>","   <tbody>","   <tr>",'       <td class="ui-customfield__label">${name}</td>','       <td class="ui_custom_field_value_container">',"       {{if value.label}}",'           <a class="tau-linkentity tau-linkentity_type_full" href="${value.url}" title="${value.label}" target="_blank">','               <span class="tau-linkentity__inner">${value.label}</span>','               <span class="external-view"></span>',"           </a>","      {{/if}}","       </td>","   </tr>","   </tbody>","   </table>","</div>"]};return templates.register(config)});
define('tau/components/component.customField.url',["Underscore","tau/components/component.creator","tau/models/model.customField","tau/ui/extensions/customField/ui.extension.customField.required","tau/models/customField/model.customField.url.editable.row","tau/components/extensions/customField/extension.customField.url.editable","tau/ui/extensions/customField/ui.extension.customField.editable","tau/components/extensions/bubble/extension.bubble.creator.direct","tau/components/extensions/component.creator.extension","tau/ui/templates/customField/ui.template.customField.url"],function(_,creator,ModelType,ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight,PopupExtension,ExtCr,template){return{create:function(config){var creatorConfig={extensions:[ModelType,ModelTypeEditable,RequireCustomField,ExtensionEditable,ExtensionHighlight,ExtCr,{type:PopupExtension,config:{popupEditorContainer:[{target:"tr",alignTo:".ui-customfield__value",componentsConfig:{components:[{type:"customField.url.editor"}]}}]}}],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.field.richText',["tau/core/extension.base","tau/utils/utils.htmlConverter"],function(ModelBase,htmlConverter){var descriptionModel=ModelBase.extend({"bus beforeInit":function(evt,initConfig){var self=this,entity=initConfig.config.context.entity,store=initConfig.config.context.configurator.getStore(),fieldName=initConfig.config.fieldName,entityTypeName=entity.entityType.name,entityId=entity.id;store.unbind(self);var onChange=function(name,evt){if(evt.data.id!=entityId)return;var changes=evt.data.changes;if(!changes.hasOwnProperty(fieldName))return;self.fire(name,changes)};store.on({eventName:"beforeSave",type:entityTypeName,listener:this},_.bind(onChange,this,"prepareChanges")).on({eventName:"afterSave",type:entityTypeName,listener:this},_.bind(onChange,this,"applyChanges")),store.get(entityTypeName,{id:entityId,fields:["id",fieldName]}).done(function(res){var data=res[0].data;self.fire("dataBind",{html:htmlConverter.fromSourceToHtml(data[fieldName])})})}});return descriptionModel});
define('tau/models/model.field.richText.editable',["tau/core/model.editable.base","tau/utils/utils.htmlConverter","tau/utils/utils.jsonSchema"],function(ModelBase,htmlConverter,jsonSchema){var editableModel=ModelBase.extend({category:"edit",name:"model.field.richText.editable",schema:null,init:function(config){this._super.apply(this,arguments);var schemaConfig={type:"object",properties:{}};this.fieldName=config.fieldName,schemaConfig.properties[this.fieldName]={optional:!0,empty:!0,type:"string"},this.schema=jsonSchema.Schema.create(schemaConfig)},"bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0,deletable:!0})},"bus beforeSave":function(evtData){var item=evtData.data.cmd.$set;item[this.fieldName]=htmlConverter.fromHtmlToSource(item[this.fieldName])},"bus validate":function(evt){var args=evt.data,data=args.cmd.$set;args.validation=this.schema.validate(data)}});return editableModel});
define('tau/components/extensions/field/extension.field.richText.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.richeditor"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit",init:function(){this._super.apply(this,arguments),this.fire("editMode",!1)},"bus afterRender + prepareChanges + allow.close.editor":function(e,afterRender){this.fire("markElementToBeUpdated",{element:afterRender.element})},"bus editMode:last + applyChanges":function(e,editMode){var self=this;if(editMode)return;this.bus.on("afterRender",function(e){var $element=e.data.element;e.removeListener(),self.fire("updateElement",{element:$element})}),self.fire("refresh")},"bus changeText":function(evt){var self=this,saveData={};saveData[self.config.fieldName]=evt.data,self.fire("save",saveData)},"bus permissionsReady+afterRender":function(e,permissions,afterRender){var self=this,$element=afterRender.element;if(permissions.editable){var flagSavedByAutoSave=!1,flagBeforeSaveIsCalled=!1,editableTitle=$element.find(".ui-description__inner").richeditor({text:$element.tmplItem().data.html,placeholder:{text:"Double-click to add description...",className:"ui-description__inner_empty_true"},onCreateEditor:function(value){self.fire("editor.ready",value)},onStopEdit:function(value){self.fire("editMode",!1),self.fire("stop.editing",value),flagSavedByAutoSave&&self.fire("refresh")},onStartEdit:function(value){self.fire("editMode",!0),self.fire("start.editing",value)},onSave:function(text){flagBeforeSaveIsCalled||(flagSavedByAutoSave=!0),self.fire("changeText",text)},onBeforeSaveWithClose:function(text){flagBeforeSaveIsCalled=!0,editableTitle.addClass("data-saving"),self.fire("editMode",!1),self.fire("allow.close.editor")},settings:{fitImgWidth:!1,toolbar:[["Cut","Copy","Paste","PasteText","PasteFromWord","-","Bold","Italic","Underline","Strike","-","Subscript","Superscript"],["NumberedList","BulletedList","-","Outdent","Indent"],["JustifyLeft","JustifyCenter","JustifyRight"],["Link","Unlink","Anchor"],["Image","Table","HorizontalRule","SpecialChar"],["Source","Format","Font","FontSize"],["Replace","-","RemoveFormat","TextColor","BGColor","-","Templates"],["Maximize"]],height:this.config.richEditorHeight||450,maxHeight:this.config.richEditorHeight||8e3}});editableTitle.bind("richeditorbeforeapply",function(evt,ui){var toolbar=[],currentWidth=0,width=$element.width(),settings=$(evt.target).richeditor("getSettings");_.each(settings.toolbar,function(items){var additionalValue=items.length*28+20;currentWidth+additionalValue>width&&(currentWidth=0,toolbar.push("/")),toolbar.push(items),currentWidth+=additionalValue}),settings.toolbar=toolbar,$(evt.target).richeditor("setSettings",settings)})}}})});
define('tau/ui/templates/field/ui.template.field.richText',["tau/core/templates-factory"],function(templates){var config={name:"description",markup:['<div class="ui-description {{if !html}}ui-field_empty_true{{/if}}">','   <div class="ui-description__inner tau-clientinput">',"      {{html html}}","   </div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.field.richText',["tau/components/component.creator","tau/models/model.field.richText","tau/models/model.field.richText.editable","tau/components/extensions/field/extension.field.richText.editable","tau/ui/extensions/ui.extension.shortcutProcessor","tau/ui/extensions/ui.extension.content.imagePreview","tau/components/extensions/field/extension.field.rich-text.auto-save","tau/ui/templates/field/ui.template.field.richText"],function(creator,ModelType,EditableModelType,EditableExtensionType,ShortcutProcessorExtension,ImagePreviewExtension,AutoSave,template){return{create:function(config){var creatorConfig={extensions:[ModelType,EditableModelType,ShortcutProcessorExtension,EditableExtensionType,ImagePreviewExtension,AutoSave],template:template};return config.shortcutProcessorTarget=".ui-description__inner",config.imagePreviewContentSelector=".ui-description__inner",creator.create(creatorConfig,config)}}});
define('tau/components/component.description',["tau/components/component.field.richText"],function(creator){return{create:function(config){return config=config||{},config.fieldName="description",creator.create(config)}}});
define('tau/ui/templates/diagnostics/ui.template.diagnostics.globalListeners.details',["tau/core/templates-factory"],function(templates){var config={name:"diagnostics.globalListeners.details",markup:['<span class="tau-global-listener ui-link">${name}</span><br/>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/diagnostics/ui.template.diagnostics.globalListeners',["tau/core/templates-factory","tau/ui/templates/diagnostics/ui.template.diagnostics.globalListeners.details"],function(templates){var config={name:"diagnostics.globalListeners",markup:['<div class="tau-diagnostics-globalListeners">',,"<table>",'{{each data}}<tr class="tau-diagnostics-row"><td>${count}</td><td>${name}</td><td>{{tmpl(listeners) "diagnostics.globalListeners.details"}}</td></tr>{{/each}}',"</table>","</div>"],dependencies:["diagnostics.globalListeners.details"]};return templates.register(config)});
define('tau/components/extensions/diagnostics/extension.diagnostics.base',["jQuery","Underscore","tau/configurator","tau/core/bus.reg","tau/components/extensions/component.extension.base"],function($,_,conf,reg,ExtBase){var ext=ExtBase.extend({init:function(config){this._super(config)},_getData:function(){var count=0,events=_.values(conf.getProxy().__subscriptions);return _.each(events,function(v){if(_.isObject(v)){var inEvents=_.values(v);_.each(inEvents,function(z){_.isObject(z)&&(count+=_(z).values().length)})}}),{countOfBuses:reg.count(),globalBusListeners:conf.getGlobalBus().getListenersCount(),storeListeners:count}},"bus beforeInit":function(){var self=this;self.fire("dataBind",self._getData())},signUp:function(){var registryEvents=["create","destroy"],globalBusEvents=["initialize","refresh","afterStoreOn","afterStoreUnbind","afterRender"],self=this,handle=function(args){self.refreshStats()};_.each(registryEvents,function(name){reg.on(name,handle,self)}),_.each(globalBusEvents,function(name){conf.getGlobalBus().on(name,handle,self,null,1e3)})},startMonitoringWithOutRefresh:function(){if(this.monitoringStarted)return;this.monitoringStarted=!0,this.signUp()},startMonitoring:function(){this.startMonitoringWithOutRefresh(),this.refreshStats()},"bus afterRender":function(){var self=this,startPoint=this.config.startMonitoringConfig||{name:/(application|entity component)/,events:["afterRender"]},globalBus=conf.getGlobalBus(),handle=function(args){args.caller.name.match(startPoint.name)&&(_.each(startPoint.events,function(evtName){globalBus.removeAllListeners(self)}),self.startMonitoring())};_.each(startPoint.events,function(evtName){globalBus.on(evtName,handle,self)})},refreshStats:function(){this.fire("refreshData",this._getData())},"bus destroy":function(){conf.getGlobalBus().removeAllListeners(this),reg.removeAllListeners(this)}});return ext});
define('tau/components/component.diagnostics.globalListeners',["jQuery","Underscore","tau/configurator","tau/core/bus.reg","tau/components/component.creator","tau/ui/templates/diagnostics/ui.template.diagnostics.globalListeners","tau/components/extensions/diagnostics/extension.diagnostics.base"],function($,_,conf,reg,creator,template,ExtBase){return{create:function(config){var ext=ExtBase.extend({_getData:function(){return this.startMonitoringWithOutRefresh(),{data:conf.getGlobalBus().getListeners()}},_onDetailsClick:function(){var item=$(this).tmplItem().data.item;console.log(item.fn.toString()),console.log(item.fn)},_signUpOnClick:function(args){$(".tau-global-listener",args.data.element).click(this._onDetailsClick)},"bus elementRefreshedWithData":function(args){this._signUpOnClick(args)},"bus afterRender":function(args){this._signUpOnClick(args)}}),creatorConfig={extensions:[ext],template:template};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/diagnostics/ui.template.diagnostics',["tau/core/templates-factory"],function(templates){var config={name:"diagnostics",markup:['<div class="tau-diagnostics-box">',,'<span class="ui-diag-label">Buses</span><span class="ui-diag-quantity">${countOfBuses}</span>','<span class="ui-diag-label">GB</span><span class="ui-diag-quantity">${globalBusListeners}</span>','<span class="ui-diag-label">Store</span><span class="ui-diag-quantity">${storeListeners}</span>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.diagnostics',["tau/components/component.creator","tau/ui/templates/diagnostics/ui.template.diagnostics","tau/components/extensions/diagnostics/extension.diagnostics.base"],function(creator,template,ExtBase){return{create:function(config){var creatorConfig={extensions:[ExtBase],template:template};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/diagnostics/ui.template.diagnostics.storeListeners.details',["tau/core/templates-factory"],function(templates){var config={name:"diagnostics.storeListeners.details",markup:['<span class="tau-store-listener ui-link">${name}</span><br/>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/diagnostics/ui.template.diagnostics.store',["tau/core/templates-factory","tau/ui/templates/diagnostics/ui.template.diagnostics.storeListeners.details"],function(templates){var config={name:"diagnostics.storeListeners",markup:['<div class="tau-diagnostics-storeListeners">',,"<table>",'{{each data}}<tr class="tau-diagnostics-row"><td>${items.length}</td><td>${name}</td><td>{{tmpl(items) "diagnostics.storeListeners.details"}}</td></tr>{{/each}}',"</table>","</div>"],dependencies:["diagnostics.storeListeners.details"]};return templates.register(config)});
define('tau/components/component.diagnostics.store',["jQuery","Underscore","tau/configurator","tau/core/bus.reg","tau/components/component.creator","tau/ui/templates/diagnostics/ui.template.diagnostics.store","tau/components/extensions/diagnostics/extension.diagnostics.base"],function($,_,conf,reg,creator,template,ExtBase){return{create:function(config){var ext=ExtBase.extend({_getData:function(){this.startMonitoringWithOutRefresh();var count=0,events=_.values(conf.getProxy().__subscriptions),listeners={};return _.each(events,function(v){if(_.isObject(v)){var inEvents=_.values(v);_.each(inEvents,function(z){if(_.isObject(z)){var values=_(z).values();_.each(values,function(sub){var key=sub.config.eventName+"["+sub.config.type+"]";listeners.hasOwnProperty(key)||(listeners[key]={name:key,items:[]});var name="unknown";sub.config.listener&&sub.config.listener.name&&(name=sub.config.listener.name),sub.config.listener&&sub.config.listener.bus&&sub.config.listener.bus.name&&(name=sub.config.listener.bus.name),listeners[key].items.push({name:name,sub:sub})})}})}}),{data:_.values(listeners)}},_onDetailsClick:function(){var item=$(this).tmplItem().data.sub;console.log(item.callback.toString()),console.log(item)},_signUpOnClick:function(args){$(".tau-store-listener",args.data.element).click(this._onDetailsClick)},"bus elementRefreshedWithData":function(args){this._signUpOnClick(args)},"bus afterRender":function(args){this._signUpOnClick(args)}}),creatorConfig={extensions:[ext],template:template};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/common/ui.template.entityLink.icon',["tau/core/templates-factory"],function(templates){var config={name:"entity-link-icon",markup:['<a href="${url}" class="tau-linkentity tau-linkentity_type_icon">','<em class="ui-type-icon ui-type-icon-${__type.toLowerCase()} ui-link-entity__icon">${id}</em>',"</a>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/common/ui.template.entityLink.text',["tau/core/templates-factory"],function(templates){var config={name:"entity-link-text",markup:['<a href="${url}" class="tau-linkentity tau-linkentity_type_text">','<span class="tau-linkentity__inner">',"{{if text}}","${text}","{{else}}","${name}","{{/if}}","</span>","</a>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/list/ui.template.list.baseInfo.item',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink.icon","tau/ui/templates/common/ui.template.entityLink.text"],function(templates){var config={name:"list-base-info-item",markup:['<tr class="{{if $item.index %2 != 0}}alternative-row{{/if}}">','<td class="entity-type tau-list__table__cell-id">{{tmpl($data) "entity-link-icon"}}</td>','<td class="name">{{tmpl($data) "entity-link-text"}}</td>','<td class="state">${state.name}</td>',"</tr>"].join(""),dependencies:["entity-link-icon","entity-link-text"]};return templates.register(config)});
define('tau/ui/templates/list/ui.template.list.baseInfo',["tau/core/templates-factory","tau/ui/templates/list/ui.template.list.baseInfo.item"],function(templates){var config={name:"request-list",options:{contentSelector:".request-list"},markup:['<div class="ui-base-info-list-content">','<table class="ui-table base-info-list" cellpadding="4" cellspacing="0" {{if items.length === 0}}style="display:none"{{/if}}>',"<tbody>","{{each items}}",'    {{tmpl($value, {index:$index}) "list-base-info-item"}}',"{{/each}}","</tbody>","</table>","</div>"].join(""),dependencies:["list-base-info-item"]};return templates.register(config)});
define('tau/components/component.list.baseInfo',["Underscore","tau/components/component.list.creator","tau/models/model.list.baseInfo","tau/models/assignmentsList/extension.model.store.operations","tau/ui/templates/list/ui.template.list.baseInfo","tau/core/termProcessor"],function(_,creator,ModelType,ExtensionModelStoreOperations,template,TermProcessor){return{create:function(config,creatorConfig){var tp=new TermProcessor(config.context.getTerms());return creatorConfig=creatorConfig||{},creatorConfig.extensions=_.compact(_.union(creatorConfig.extensions,[ExtensionModelStoreOperations])),_.extend(creatorConfig,{message:"No "+tp.getTerms(config.typeName).names.toLowerCase()+" found",ModelType:config.ModelType||ModelType,template:template}),creator.create(creatorConfig,config)}}});
define('tau/components/component.duplicateBugList',["Underscore","tau/components/component.list.baseInfo","tau/models/model.duplicateBugList","tau/models/model.duplicateBugRetriever"],function(_,componentListEntity,DuplicateBugModel,DuplicateBugRetriever){return{create:function(config){return config.ModelType=DuplicateBugModel,config.typeName="bug",componentListEntity.create(config,{extensions:[DuplicateBugRetriever]})}}});
define('tau/ui/extensions/ui.extensions.onMarkAsDuplicate',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt){this.config=evt.data.config,this.bus.getGlobalBus().on("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this)},destroy:function(){this.bus.getGlobalBus().removeListener("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this),this._super.apply(this,arguments)},onBugWasMarkedAsDuplicate:function(evt){var currentEntityId=this.config?this.config.context.entity.id:null;if(currentEntityId==evt.data.duplicateBugId||currentEntityId==evt.data.bugId)this.fire("evict"),this.fire("refresh")}})});
define('tau/components/component.duplicateBugListPanel',["Underscore","tau/components/component.collapsible","tau/components/extensions/duplicateBugList/extension.duplicateBugList.visibilityController","tau/models/model.duplicateBugCountCalculator","tau/models/model.duplicateBugRetriever","tau/models/model.extensions","tau/models/assignmentsList/extension.model.store.operations","tau/ui/extensions/ui.extensions.onMarkAsDuplicate","tau/core/termProcessor"],function(_,ComponentCollapsible,VisibilityController,DuplicateBugCountCalculator,DuplicateBugRetriever,modelExtensions,StoreOperations,MarkAsDuplicateRefresher,TermProcessor){return{create:function(config){var tp=new TermProcessor(config.context.getTerms());return config=config||{},_.extend(config,{collapsed:!0,header:[{type:"label",text:tp.getTerms("Bug").name+" Duplicates",quantityCssClass:config.quantityCssClass||"ui-gray-quantity"}],items:[{type:"duplicateBugList"}],extensions:[DuplicateBugRetriever,StoreOperations,MarkAsDuplicateRefresher]}),ComponentCollapsible.create(config)}}});
define('libs/amanda/amanda',[],function(){return function(){var isObject=function(input){return Object.prototype.toString.call(input)==="[object Object]"},isArray=function(input){return Object.prototype.toString.call(input)==="[object Array]"},isEmpty=function(input){if(isArray(input)||typeof input=="string")return input.length===0;if(isObject(input))for(var key in input)if(input.hasOwnProperty(key))return!1;return!0},merge=function(obj1,obj2){for(var key in obj2)obj2.hasOwnProperty(key)&&!obj1.hasOwnProperty(key)&&(obj1[key]=obj2[key]);return obj1},each=function(list,iterator,callback){var syncEach=function(list,iterator){if(isArray(list)&&!isEmpty(list))for(var i=0,len=list.length;i<len;i++)iterator.apply(list,[i,list[i]]);if(isObject(list)&&!isEmpty(list))for(var key in list)list.hasOwnProperty(key)&&iterator.apply(list,[key,list[key]])},asyncEach=function(list,iterator,callback){var queue=[],addToQueue=function(key,value){var index=queue.length+1;queue.push(function(){var next=function(error){var fn=queue[index];return!error&&fn?fn():!error&&!fn?callback():callback(error)};return iterator(key,value,next)})};if(isArray(list)&&!isEmpty(list))for(var i=0,len=list.length;i<len;i++)addToQueue(i,list[i]);else{if(!isObject(list)||!!isEmpty(list))return callback();for(var key in list)list.hasOwnProperty(key)&&addToQueue(key,list[key])}return queue[0]()};return typeof callback=="undefined"?syncEach.apply(this,arguments):asyncEach.apply(this,arguments)},pluck=function(list,propertyName){var output=[];for(var i=0,len=list.length;i<len;i++){var property=list[i][propertyName];output.indexOf(property)===-1&&output.push(property)}return output},Error=function(){this.length=0};Error.prototype.addError=function(error){this[this.length]=error,this.length++},each({getProperties:"property",getMessages:"message"},function(key,value){Error.prototype[key]=function(){return pluck(this,value)}});var messages={required:"The {{property}} property is required.",minLength:"The {{property}} property must be at least {{validator}} characters.",maxLength:"The {{property}} property must not exceed {{validator}} characters.",length:"The {{property}} property must be exactly {{validator}} characters.",format:"The {{property}} property must be a/an {{validator}}.",type:"The {{property}} property must be a/an {{validator}}.",except:"The {{property}} property must not be {{propertyValue}}",minimum:"The minimum value of the {{property}} must be {{validator}}",maximum:"The maximum value of the {{property}} must be {{validator}}",pattern:"The `{{property}}` does not match the {{validator}} pattern.",maxItems:"The `{{property}}` property must not contain more than {{validator}} items.",minItems:"The `{{property}}` property must contain at least {{validator}} items.",divisibleBy:"The {{property}} property is not divisible by {{validator}}.",uniqueItems:"All items in the {{property}} property must be unique.","enum":function(property,propertyValue,validator){return"Value of the "+property+" must be "+validator.join(" or ")+"."}},Validation=function(options){var self=this;this.singleError=options.hasOwnProperty("singleError")?options.singleError:!0,this.validators=validators,this.messages=options.messages?merge(options.messages,messages):messages,this.Errors=new Error};Validation.prototype.renderErrorMessage=function(validatorName,templateData){var errorMessage=this.messages[validatorName];return typeof errorMessage=="function"?errorMessage(templateData.property,templateData.propertyValue,templateData.validator):typeof errorMessage=="string"?(each(templateData,function(key,value){errorMessage=errorMessage.replace(new RegExp("{{"+key+"}}","g"),value)}),errorMessage.replace(/\s+/g," ")):""},Validation.prototype.validateProperty=function(property,propertyValue,propertyValidators,callback){var self=this,iterator=function(validatorName,validatorFn,callback){var onComplete=function(error){if(!error)return callback();var errorMessage=self.renderErrorMessage(validatorName,{property:property,propertyValue:propertyValue,validator:propertyValidators[validatorName]});return self.Errors.addError({property:property,propertyValue:propertyValue,validator:validatorName,validatorValue:propertyValidators[validatorName],message:errorMessage}),callback(self.singleError?!0:null)};return propertyValidators[validatorName]?validatorFn(property,propertyValue,propertyValidators[validatorName],propertyValidators,onComplete):callback()};return propertyValidators.required!==!0&&typeof propertyValue=="undefined"?callback():each(self.validators,iterator,callback)},Validation.prototype.validate=function(instance,schema,callback){var self=this;return this.Errors=new Error,this.validateSchema(instance,schema,"",function(error){return callback(self.Errors.length>0?self.Errors:undefined)})},Validation.prototype.validateProperties=function(instance,schema,path,callback){var self=this;return each(schema.properties,function(property,propertyValidators,callback){var isObject=propertyValidators.type==="object"&&propertyValidators.properties,isArray=propertyValidators.type==="array",propertyValue=self.getProperty(instance,property),propertyName=property.indexOf(" ")!==-1?"['"+property+"']":"."+property,propertyPath=path.length===0?property:path+propertyName;return isObject||isArray?self.validateSchema(propertyValue,schema.properties[property],propertyPath,callback):self.validateProperty(propertyPath,propertyValue,propertyValidators,callback)},callback)},Validation.prototype.validateItems=function(instance,schema,path,callback){var self=this;return instance&&!isEmpty(instance)?["object","array"].indexOf(schema.items.type)!==-1?each(instance,function(index,propertyValue,callback){var propertyPath=path+"["+index+"]";return self.validateSchema(propertyValue,schema.items,propertyPath,callback)},callback):each(instance,function(index,propertyValue,callback){var propertyPath=path+"["+index+"]";return self.validateProperty(propertyPath,propertyValue,schema.items,callback)},callback):callback()},Validation.prototype.validateSchema=function(instance,schema,path,callback){var self=this;return["object","array"].indexOf(schema.type)!==-1?self.validateProperty(path,instance,schema,function(error){return schema.properties?self.validateProperties(instance,schema,path,callback):schema.items?self.validateItems(instance,schema,path,callback):callback()}):self.validateProperty(path,instance,schema,callback)},Validation.prototype.getProperty=function(source,property){return source?source[property]:undefined};var validators={required:function(property,propertyValue,validator,propertyValidators,callback){return validator&&propertyValue===undefined?callback(!0):callback()},type:function(){var types={object:function(input){return Object.prototype.toString.call(input)==="[object Object]"},array:function(input){return Object.prototype.toString.call(input)==="[object Array]"},integer:function(input){return typeof input=="number"&&input%1===0}},ar=["string","number","function","boolean"];for(var i=0,c=ar.length;i<c;i++)types[ar[i]]=function(type){return function(){return typeof arguments[0]===type}}(ar[i]);return function(property,propertyValue,validator,propertyValidators,callback){if(Object.prototype.toString.call(validator)==="[object Array]"){var noError=validator.some(function(type){return types[type](propertyValue)});return noError?callback():callback(!0)}return types[validator](propertyValue)?callback():callback(!0)}}(),format:function(){var formats={alpha:function(input){return typeof input=="string"&&input.match(/^[a-zA-Z]+$/)},alphanumeric:function(input){return typeof input=="string"&&/^[a-zA-Z0-9]+$/.test(input)||typeof input=="number"},ipv4:function(input){return typeof input=="string"&&input.match(/^(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/)},ipv6:function(input){return typeof input=="string"&&input.match(/(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3})|(?:(?:[a-f\d]{1,4}:)*[a-f\d]{1,4})?::(?:(?:[a-f\d]{1,4}:)*(?:[a-f\d]{1,4}|\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}))?)/)},ip:function(input){return formats.ipv4(input)||formats.ipv6},email:function(input){return typeof input=="string"&&input.match(/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/)},url:function(input){return typeof input=="string"&&input.match(/^(?:(?:ht|f)tp(?:s?)\:\/\/|~\/|\/)?(?:\w+:\w+@)?((?:(?:[-\w\d{1-3}]+\.)+(?:com|org|cat|coop|int|pro|tel|xxx|net|gov|mil|biz|info|mobi|name|aero|jobs|edu|co\.uk|ac\.uk|it|fr|tv|museum|asia|local|travel|[a-z]{2})?)|((\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)(\.(\b25[0-5]\b|\b[2][0-4][0-9]\b|\b[0-1]?[0-9]?[0-9]\b)){3}))(?::[\d]{1,5})?(?:(?:(?:\/(?:[-\w~!$+|.,=]|%[a-f\d]{2})+)+|\/)+|\?|#)?(?:(?:\?(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)(?:&(?:[-\w~!$+|.,*:]|%[a-f\d{2}])+=?(?:[-\w~!$+|.,*:=]|%[a-f\d]{2})*)*)*(?:#(?:[-\w~!$ |\/.,*:;=]|%[a-f\d]{2})*)?$/)},date:function(input){return Object.prototype.toString.call(input)==="[object Date]"},decimal:function(input){return/^[0-9]+(\.[0-9]{1,2})?$/.test(input)},"int":function(input){return/^-?[0-9]+$/.test(input)},percentage:function(input){return typeof input=="string"&&input.match(/^-?[0-9]{0,2}(\.[0-9]{1,2})?$|^-?(100)(\.[0]{1,2})?$/)||input>=-100&&input<=100},port:function(input){return/\:\d+/.test(input)},regexp:function(input){return input&&input.test&&input.exec},unsignedInt:function(input){return/^[0-9]+$/.test(input)}};return function(property,propertyValue,validator,propertyValidators,callback){return formats[validator](propertyValue)?callback():callback(!0)}}(),minLength:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&propertyValue.length>=validator?callback():callback(!0)},maxLength:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&propertyValue.length<=validator?callback():callback(!0)},length:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&propertyValue.length===validator?callback():callback(!0)},"enum":function(property,propertyValue,validator,propertyValidators,callback){return validator.indexOf(propertyValue)===-1?callback(!0):callback()},except:function(property,propertyValue,validator,propertyValidators,callback){return validator.indexOf(propertyValue)!==-1?callback(!0):callback()},minimum:function(property,propertyValue,validator,propertyValidators,callback){if(typeof propertyValue=="number"){var condition=propertyValidators.exclusiveMinimum?propertyValue>validator:propertyValue>=validator;return condition?callback():callback(!0)}return callback(!0)},maximum:function(property,propertyValue,validator,propertyValidators,callback){if(typeof propertyValue=="number"){var condition=propertyValidators.exclusiveMaximum?propertyValue<validator:propertyValue<=validator;return condition?callback():callback(!0)}return callback(!0)},pattern:function(property,propertyValue,validator,propertyValidators,callback){return typeof propertyValue=="string"&&!propertyValue.match(validator)?callback(!0):callback()},minItems:function(property,propertyValue,validator,propertyValidators,callback){return isArray(propertyValue)&&propertyValue.length>=validator?callback():callback(!0)},maxItems:function(property,propertyValue,validator,propertyValidators,callback){return isArray(propertyValue)&&propertyValue.length<=validator?callback():callback(!0)},uniqueItems:function(property,propertyValue,validator,propertyValidators,callback){return each(propertyValue,function(index,value,callback){return propertyValue.indexOf(value)<index?callback(!0):callback()},callback)},divisibleBy:function(property,propertyValue,validator,propertyValidators,callback){var isNumber=typeof propertyValue=="number",isDivisible=propertyValue%validator===0;return isNumber&&isDivisible?callback():callback(!0)}},amanda={validate:function(instance,schema,options,callback){return typeof options=="function"&&(callback=options,options={}),(new Validation(options)).validate(instance,schema,callback)},addValidator:function(validatorName,validatorFn){validators[validatorName]=validatorFn},getVersion:function(){return[0,3,0].join(".")},getValidators:function(){return validators}};return Validation}()});
define('tau/models/editor.requester/model.editor.requester',["Underscore","tau/core/model-base","libs/amanda/amanda"],function(_,ModelBase,Validation){var model=ModelBase.extend({"bus afterInit":function(){this.fire("dataBind",{}),this.validation=new Validation({singleError:!1});var store=this.config.store,serverEmailValidator=function(property,value,validator,propertyValidators,callback){if(!validator||!value)return callback();store.find("requester",{$query:{email:value,deleteDate:null}}).done({success:function(results){results[0].data.length==1?callback("uniqueEmail"):callback()}})};this.validation.validators.uniqueEmail=serverEmailValidator,_.extend(this.validation.messages,{required:function(property,propertyValue,validator){var titles={firstName:"First Name",lastName:"Last Name",email:"email"};return"Please enter "+titles[property]},uniqueEmail:"Requester with the same email already exists",format:"Please enter valid {{validator}}"})},"bus form.parametersBound":function(evt){var data=evt.data,store=this.config.store,schema={type:"object",properties:{firstName:{required:!0,type:"string"},lastName:{required:!0,type:"string"},email:{required:!0,type:"string",format:"email",uniqueEmail:!0}}},self=this;this.validation.validate(data.parameters,schema,function(errors){errors?self.fire("form.validationFailed",{errors:errors}):self.fire("form.validationPassed",{data:data.parameters})})},"bus form.validationPassed":function(evt){var data=evt.data.data,store=this.config.store,self=this,entity=this.config.context.entity;store.save("Requester",{$set:{email:data.email,login:data.email,firstName:data.firstName,lastName:data.lastName},fields:["id"]}).done({success:function(results){var generalUser=results[0].data;store.save(entity.entityType.name,{id:entity.id,$set:{requesters:[{id:generalUser.id}]},fields:["id"]}).done({success:function(result){}})}})}});return model});
define('tau/ui/extensions/editor.requester/ui.extension.editor.requester.form',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element;this.$element=$element;var $filterForm=$element.find("[role=form]"),$inputs=$filterForm.find(":input"),$buttons=$filterForm.find(":button");$buttons.eq(0).prop("disabled","disabled"),$buttons.eq(0).addClass("disable");var self=this;$buttons.eq(0).click(function(){var data={};$inputs.each(function(){var $input=$(this),val=_.trim($input.val());val!=""&&(data[$input.attr("name")]=val)}),data.action="search",self.bus.fire("form.parametersBound",{parameters:data})}),$inputs.bind("keyup",function(){$inputs.filter(function(){return $(this).val().length>0}).length==$inputs.length?($buttons.eq(0).prop("disabled",!1),$buttons.eq(0).removeClass("disable")):($buttons.eq(0).prop("disabled","disabled"),$buttons.eq(0).addClass("disable"))})},"bus form.validationFailed":function(evt){this.$element.find(".ui-validationerror").removeClass("ui-validationerror");var errors=_.uniq(evt.data.errors,!1,function(item){return item.property}),$inputs=this.$element.find(":input");_.forEach(errors,function(error){$inputs.filter("[name="+error.property+"]").toggleClass("ui-validationerror",!0).attr("title",error.message)})},"bus form.validationPassed":function(){this.$element.find(".ui-validationerror").removeClass("ui-validationerror")}})});
define('tau/ui/templates/editor.requester/ui.template.editor.requester',["tau/core/templates-factory"],function(templates){var config={name:"editor-requester",markup:["<div>",'<div class="ui-form" role="form">','<div class="ui-form__row">','<label for="url">First Name</label><input type="text" data-autofocus class="user-search-box" name="firstName" />',"</div>",'<div class="ui-form__row">','<label for="label">Last Name</label><input type="text" class="user-search-box" name="lastName" />',"</div>",'<div class="ui-form__row">','<label for="label">Email</label><input type="text" class="user-search-box" name="email" />',"</div>",'<div class="ui-form__row ui-form__row-controls button-group">','<input type="button" name="action" value="Add requester" class="button" />','<input type="button" name="cancel" value="Cancel" role="action-cancel" class="button" />',"</div>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.editor.requester',["tau/components/component.creator","tau/models/editor.requester/model.editor.requester","tau/ui/extensions/editor.requester/ui.extension.editor.requester.form","tau/ui/templates/editor.requester/ui.template.editor.requester"],function(creator,Model,ExtensionForm,template){return{create:function(config){var creatorConfig={name:"finder",extensions:[Model,ExtensionForm],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/editor.team-member/model.editor.team-member',["Underscore","tau/core/model-base","libs/amanda/amanda"],function(_,ModelBase,Validation){var model=ModelBase.extend({"bus afterInit":function(){this.fire("dataBind",{}),this.validation=new Validation({singleError:!1});var store=this.config.store,serverEmailValidator=function(property,value,validator,propertyValidators,callback){if(!validator||!value)return callback();store.find("user",{$query:{email:value,deleteDate:null}}).done({success:function(results){results[0].data.length==1?callback("uniqueEmail"):callback()}})};this.validation.validators.uniqueEmail=serverEmailValidator,_.extend(this.validation.messages,{required:function(property,propertyValue,validator){var titles={firstName:"First Name",lastName:"Last Name",email:"email"};return"Please enter "+titles[property]},uniqueEmail:"User with the same email already exists",format:"Please enter valid {{validator}}"})},"bus form.parametersBound":function(evt){var data=evt.data,store=this.config.store,schema={type:"object",properties:{firstName:{required:!0,type:"string"},lastName:{required:!0,type:"string"},email:{required:!0,type:"string",format:"email",uniqueEmail:!0}}},self=this;this.validation.validate(data.parameters,schema,function(errors){errors?self.fire("form.validationFailed",{errors:errors}):self.fire("form.validationPassed",{data:data.parameters})})},"bus form.validationPassed":function(evt){var data=evt.data.data,store=this.config.store,self=this,entity=this.config.context.entity;store.save("user",{$set:{email:data.email,login:data.email,firstName:data.firstName,lastName:data.lastName},fields:["id"]}).done({success:function(results){var generalUser=results[0].data;store.save(entity.entityType.name,{id:entity.id,$set:{teamMembers:[{user:{id:generalUser.id}}]},fields:["id"]}).done({success:function(result){}})}})}});return model});
define('tau/components/component.editor.team-member',["tau/components/component.creator","tau/models/editor.team-member/model.editor.team-member","tau/ui/extensions/editor.requester/ui.extension.editor.requester.form","tau/ui/templates/editor.requester/ui.template.editor.requester"],function(creator,Model,ExtensionForm,template){return{create:function(config){var creatorConfig={name:"finder",extensions:[Model,ExtensionForm],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/entity/actions/model.entity.actions',["Underscore","tau/core/model-base","tau/configurations/factory.container.config"],function(_,ModelBase,factoryContainerConfig){return ModelBase.extend({name:"model.entity.actions",onInit:function(){var self=this,entityId=self.config.context.id;self.fire("permissionsReady",{editable:!0});var entityConfigObj=factoryContainerConfig.getContextBasedConfigObject(self.config),actionItems=_.filter(entityConfigObj.getActions(),function(item){return!_.contains(item.editions,"~innerList")});self.fire("dataBind",{items:actionItems})}})});
define('tau/ui/templates/menu/ui.template.menu.actions.item',["tau/core/templates-factory"],function(templates){var config={name:"menu.actions.item",engine:"jqote2",markup:["<% if (this.url) { %>",'<div class="ui-menu__item ui-menu__item-action ui-menu__item-action-link <%= this.className %>">','<a class="drop-down-option" href="<%= this.url %>">',"<%= this.label %>","</a>","</div>","<% } else if (this.label) { %>",'<div class="ui-menu__item ui-menu__item-action <%= this.className %> <%= this.alias? "i-role-action-"+this.alias.toLowerCase():"" %> " data-id="<%= this.id||"" %>" data-name="<%= this.name||"" %>" data-alias="<%= this.alias %>">',"<% if (this.icon){ %>",'<span class="drop-down-option">','<i class="tau-entity-icon <%= this.className %>"><%= this.icon %></i>',"<%= this.label %>","</span>","<% } else { %>",'<span class="drop-down-option">',"<%= this.label %>","</span>","<% } %>","</div>","<% } else { %>",'<div class="ui-menu__item-separator">-----</div>',"<% } %>"]};return templates.register(config)});
define('tau/ui/templates/menu/ui.template.menu.actions.list',["tau/core/templates-factory","tau/ui/templates/menu/ui.template.menu.actions.item"],function(templates){var config={name:"menu.actions.list",engine:"jqote2",markup:['<div class="ui-menu-actions">','<div class=" ui-drop-down drop-down-list">',"<% _.forEach(this.items, function(item){ %>",'<%= fn.sub("menu.actions.item", item) %>',"<% }); %>","</div>","</div>"]};return templates.register(config)});
define('tau/ui/extensions/entity/actions/extension.entity.actions.editable',["tau/components/extensions/component.extension.base","tau/ui/templates/menu/ui.template.menu.actions.list"],function(ExtensionBase,menuActionsListTemplate){return ExtensionBase.extend({category:"edit","bus permissionsReady+dataBind+afterRender":function(eventData){var self=this,permissions=eventData.permissionsReady.data,dataToBind=eventData.dataBind.data;if(permissions.editable){var $element=eventData.afterRender.data.element,$targetElement=$element.find(".tau-entity-actions-target"),componentsConfig={components:[{type:"menu.actions",template:menuActionsListTemplate,items:dataToBind.items}],context:self.config.context},bubbleConfig={target:$targetElement,componentsConfig:componentsConfig,onShow:_.bind(function(){this.config.context.configurator.getKeyBoardManager().pushHandler({})},this),onHide:_.bind(function(){this.config.context.configurator.getKeyBoardManager().popHandler()},this)};self.fire("initBubble",bubbleConfig)}}})});
define('tau/ui/templates/entity/ui.template.entity.actions',["tau/core/templates-factory"],function(templates){var config={name:"ui.template.entity.actions",markup:['<div class="tau-entity-actions">','   <span class="tau-entity-actions-target"></span>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.entity.actions',["tau/components/component.creator","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/models/entity/actions/model.entity.actions","tau/ui/extensions/entity/actions/extension.entity.actions.editable","tau/ui/templates/entity/ui.template.entity.actions"],function(creator,ExtensionBubbleCreator,ExtensionComponentCreator,ModelType,EditableExtensionType,template){return{create:function(config){var creatorConfig={extensions:[ExtensionBubbleCreator,ExtensionComponentCreator,ModelType,EditableExtensionType],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/entity.quickAdd/model.entity.quickAdd.templates',["Underscore","jQuery","tau/core/extension.base","tau/core/termProcessor","tau/configurations/converters/converter.context"],function(_,$,BaseModel,TermProcessor,converter){return BaseModel.extend({"bus beforeInit":function(evt,initConfig){var options=initConfig.config.options||{},entity=initConfig.config.context.entity,acid=initConfig.config.context.applicationContext.acid,context=initConfig.config.context,configurator=initConfig.config.context.configurator;this.fire("viewerBus.ready",this.bus),configurator.applicationContextService.getApplicationContext({acid:acid},{success:_.bind(function(event){this.fire("culture.ready",event.culture)},this)}),options=_.defaults(options,{items:[]}),options.items=converter.convert(options.items,_.pluck(context.getPractices(),"name"),context.getEdition()),options.items.length==0?this.fire("dataBind",{isEmpty:!0,types:[],entityTypes:[]}):this.getData(configurator,entity,acid,options).done(_.bind(function(templates){var termProcessor=new TermProcessor(initConfig.config.context.getTerms()),templateData={};_.forEach(templates,function(v){v.entityType={name:v.entityType,title:termProcessor.resolve(v.entityTypeTitle)},entity.entityType.name=="release"&&v.entityType.name.toLowerCase()=="iteration"&&(v.template.items=_.reject(v.template.items,function(v){return v.id.toLowerCase()=="release"})),templateData[v.entityType.name]=v}),this.fire("model.dataItems.template.ready",{types:templateData}),this.fire("dataBind",{types:templateData,entityTypes:_.pluck(templateData,"entityType")})},this))},"bus beforeInit:last + cardDataToShow.ready":function(evt,initConfig,data){var configurator=initConfig.config.context.configurator;configurator.service("navigator").to("#"+data.entityType+"/"+data.entityId)},getData:function(configurator,entity,acid,options){var fs=[],items=options.items;fs.push(function(next){var definition={global:{acid:acid},entityType:entity.entityType.name,entityId:entity.id},slice=configurator.getSliceFactory().create({definition:definition});slice.viewActions().done(function(res){var resultItems=[];_.forEach(items,function(v){var x=_.find(res.data.data.types,function(type){return type.name.toLowerCase()==v.entityType.toLowerCase()});x&&resultItems.push(x)});var actionsData=_.map(resultItems,function(v,k){return{templateAction:"viewDataTemplate",saveAction:"viewAddData",entityType:v.name,entityTypeTitle:v.title,slice:slice}});next(!1,_.compact(actionsData))})}),fs.push(_.bind(function(actionsData,next){return this.getTemplates(actionsData).pipe(function(templates){actionsData=_.map(actionsData,function(v,k){return v.template={items:templates[k]},v}),next(!1,actionsData)})},this));var def=$.Deferred();return _.waterfall(fs,function(err,types){def.resolve(types)}),def},getTemplates:function(actionsData){var fs=[],def=$.Deferred();return _.forEach(actionsData,function(actionData){fs.push(function(next){var set={$set:{entityType:actionData.entityType}};actionData.slice[actionData.templateAction](set).done(function(result){next(!1,result.data)})})}),_.parallel(fs,function(err,templates){def.resolve(templates)}),def}})});
define('tau/models/entity.quickAdd/model.entity.quickAdd.add',["Underscore","jQuery","tau/core/extension.base"],function(_,$,BaseModel){return BaseModel.extend({"bus beforeInit:last + dataBind:last + model.add.item":function(evt,initConfig,dataItems,addItemData){var configurator=initConfig.config.context.configurator,entity=initConfig.config.context.entity,options=initConfig.config.options,dataItem=dataItems.types[addItemData.type];entity.entityType.name=="release"&&dataItem.entityType.name.toLowerCase()=="iteration"&&addItemData.fields.push({id:"release",value:entity.id});var params=_.extend({entityType:addItemData.type,values:addItemData.fields},dataItem.coordinates);dataItem.slice[dataItem.saveAction]({$set:params}).done(_.bind(function(result){var savedEntity=result.data,optionItem=_.find(options.items,function(v){return v.entityType.toLowerCase()==savedEntity.type.toLowerCase()}),relationName=optionItem.relationName;if(relationName){var set={};set[relationName]=[{id:savedEntity.id}],configurator.getStore().save(entity.entityType.name,{id:entity.id,$set:set,fields:["id",relationName]}).done(function(){configurator.getStore().evictProperties(entity.id,entity.entityType.name,[relationName]);var str=savedEntity.type,typeCorrect=str.charAt(0).toLowerCase()+str.substring(1);configurator.getGlobalBus().fire(typeCorrect+".items.added",{entity:{id:savedEntity.id}})})}this.fire("model.data.item.did.add",{message:{dataItem:{data:savedEntity}},nameType:dataItem.entityType})},this)).fail(_.bind(function(result){return this.fire("model.data.item.did.fail.add",result.data.responseText),!1},this))}})});
define('tau/components/component.entity.quickAdd',["tau/components/component.creator","tau/models/entity.quickAdd/model.entity.quickAdd.templates","tau/models/entity.quickAdd/model.entity.quickAdd.add","tau/ui/extensions/board.cell.quick.add/ui.extension.board.cell.quick.add","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/container/ui.extension.container.childrenEvents","tau/components/extensions/error/extension.errorBar","tau/views/view.compositeControl","tau/ui/templates/board.add/ui.template.board.quick.add"],function(Creator,ModelMain,ModelAdd,ExtensionMain,BubbleExtension,CreatorExtension,ChildrenEventsExtension,ErrorExtension,ViewExtension,Template){return{create:function(config){var extensions=[ModelMain,ModelAdd,ExtensionMain,BubbleExtension,CreatorExtension,ChildrenEventsExtension,ErrorExtension],creatorConfig={ViewType:ViewExtension,name:"entity.quickAdd",extensions:extensions,template:Template};return config["queue.bus"]=!0,config.dependencies=["finder.entity"],Creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/entity.quickAddTrigger/ui.extension.entity.quickAddTrigger',["jQuery","tau/core/extension.base","tau/configurations/converters/converter.context"],function($,ExtensionBase,converter){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var options=initConfig.config.options||{};options=_.defaults(options,{items:[]});var context=initConfig.config.context;options.items=converter.convert(options.items,_.pluck(context.getPractices(),"name"),context.getEdition()),this.fire("dataBind",{isEmpty:options.items.length==0})},"bus beforeInit + afterRender":function(e,initConfig,renderData){var configurator=initConfig.config.context.configurator,options=initConfig.config.options||{},$el=renderData.element,$target=$el;if($target.length==0)return;var bubbleConfig={target:$target,cleanupOnHide:!0,stackName:"quickAddGeneral",showOnCreation:!1,zIndex:1e4,className:"tau-quick-add-dialog-general tau-quick-add-dialog-entity",hideOnScroll:!1,onBeforeShow:function(){var $t=$target.parent().find(".ui-menu-actions");$t.length&&$t.behaviourMenuActions("close")},onShow:function(){configurator.getKeyBoardManager().pushHandler({})},onHide:function(){configurator.getKeyBoardManager().popHandler()},onPositionConfig:function(){return{of:$target,collision:"none none",my:"right top",at:"right bottom",offset:"20 0"}},dontCloseSelectors:["#ui-datepicker-div"],componentsConfig:{components:[{type:"entity.quickAdd",options:options}]}};this.fire("initBubble",bubbleConfig),$target.data("tauBubble")._append=function($popup){var $host=this.$target.parents(".i-role-application:first");$host.append($popup)}},"bus afterRender:last + destroy":function(e,renderData){var $target=renderData.element;if($target.length==0)return;$target.tauBubble("hide")}})});
define('tau/ui/templates/entity.quickAddTrigger/ui.template.entity.quickAddTrigger',["tau/core/templates-factory"],function(templates){var config={name:"entity.quickAddTrigger",engine:"jqote2",markup:["<% if (!this.isEmpty){ %>",'<span class="tau-view-quick-add" role="action-quick-add">',"</span>","<% } %>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.entity.quickAddTrigger',["Underscore","tau/components/component.creator","tau/ui/extensions/entity.quickAddTrigger/ui.extension.entity.quickAddTrigger","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/entity.quickAddTrigger/ui.template.entity.quickAddTrigger"],function(_,ComponentCreator,ExtensionMain,ExtensionBubble,ExtensionCreator,Template){return{create:function(config){var creatorConfig={extensions:[ExtensionMain,ExtensionBubble,ExtensionCreator],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/propertyLists/model.propertyList.base',["Underscore","tau/core/model.editable.base"],function(_,ModelBase){return ModelBase.extend({getAssignable:function(successCallback){var self=this,entity=self.config.context.entity,entityTypeName=entity.entityType.name,entityId=entity.id,getEntityCommand={id:entityId,fields:this.getRequiredFields()};return self.store.get(entityTypeName,getEntityCommand).done({success:successCallback}),self},sortProjects:function(projects){var appContext=this.config.context.applicationContext,selectedProjectIdList=_.pluck(appContext.selectedProjects,"id"),sortedProjectList=projects.sort(function(project1,project2){var indexOfProject1=_.indexOf(selectedProjectIdList,project1.id),indexOfProject2=_.indexOf(selectedProjectIdList,project2.id);return indexOfProject1>=0&&indexOfProject2>=0||indexOfProject1<0&&indexOfProject2<0?project1.id-project2.id:-1*indexOfProject1+indexOfProject2});return sortedProjectList},getCurrentEntityId:function(){if(!this.config.data)return null;var value=this.config.data.value;return this.config.data.id||value&&value.id},getRequiredFields:function(){return["id"]},onDataRetrieved:function(results){var dataList=_.pluck(results,"data");this.processData.apply(this,dataList)},propertyIsNotEmpty:function(){return _.isNumber(this.config.data.id)},"bus updateState":function(evt){var $set={},value=null;evt.data&&evt.data.id&&(value={id:evt.data.id}),$set[this.propertyType]=value,this.fire("save",$set)}})});
define('tau/models/propertyLists/model.entityStateList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelProperyListBase){return ModelProperyListBase.extend({name:"states-list",propertyType:"entityState",onInit:function(){var self=this,success=function(r){var assignable=r[0].data;self.store.get(self.propertyType,self.createGetStateForAssignableCommand(assignable)).done({success:_.bind(self.onDataRetrieved,self)})};this.getAssignable(success)},getRequiredFields:function(){return[{entityState:["id"]}]},createGetStateForAssignableCommand:function(assignable){return{id:assignable.entityState.id,fields:["id","name","isCommentRequired",{nextStates:["id","name","isCommentRequired","numericPriority"]}]}},processData:function(assignable){var states=[];assignable.nextStates=_.sortBy(assignable.nextStates,function(item){return item.numericPriority}),_.each(assignable.nextStates,function(state){states.push({id:state.id,name:state.name,isCommentRequired:state.isCommentRequired})}),this.fire("dataBind",{states:states,completed:!0,nullableValue:!1})}})});
define('tau/ui/extensions/stateList/ui.extension.stateList.editable.entityState',["Underscore","jQuery","tau/ui/extensions/stateList/ui.extension.stateList.editable"],function(_,$,ExtensionBase){return ExtensionBase.extend({_updateState:function(value){var isConfirmed=!0;this.config.confirmation&&window.confirm&&(isConfirmed=window.confirm(this.config.confirmation)),isConfirmed&&this.fire("entityState.selected",{id:value})}})});
define('tau/ui/extensions/entityStateList/ui.extension.entityStateList.practices.comment',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.textConverter","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(_,$,ExtensionBase,TextConverter){var stateListEditable=ExtensionBase.extend({"bus afterRender:last+focus.before":function(evt){var element=_.values(evt)[0].data.element;element.find(".ui-entity-state-comment").remove()},"bus afterRender:last+dataBind:last+entityState.selected":function(evt,ar,dataToBind,state){var entityStateId=this.entityStateId=state.id,isCommentRequired=_(dataToBind.states).detect(function(stateObj){return stateObj.id===entityStateId&&stateObj.isCommentRequired});if(!isCommentRequired){this.fire("updateState",state);return}var $element=ar.element;if($element.find(".ui-entity-state-comment").length>0){$element.find(".ui-state-comment-field").focus();return}var $dropdown=$element;$dropdown.find(".drop-down-list").listSelectable("disable");var $commentForm=$("<div class='ui-entity-state-comment'></div>").append($("<div class='ui-state-comment-header'>Please, provide comment</div>")).append($("<div class='ui-state-comment-field-container'></div>").append("<textarea rows='5' class='ui-state-comment-field'></textarea>")).append($("<div class='button-group'></div>").append($("<button type='button' class='save button'>Save</button>").click($.proxy(this._save,this))).append($("<button type='button' class='cancel button'>Cancel</button>").click($.proxy(this._cancel,this)))).appendTo($element),$inputField=$commentForm.find(".ui-state-comment-field").focus(),$saveButton=$commentForm.find(".save"),inputHandler=function(){window.setTimeout(function(){var text=$inputField.val()||"",disableSave=_.trim(text).length===0;disableSave?$saveButton.attr("disabled","disabled"):$saveButton.attr("disabled")&&$saveButton.removeAttr("disabled"),disableSave?$saveButton.addClass("disable"):$saveButton.removeClass("disable")},50)};inputHandler(),$saveButton.bind("focus",inputHandler),$inputField.bind("change keyup click propertychange paste",inputHandler)},_save:function(evt){evt.stopPropagation();var textConverter=new TextConverter,self=this,commentText=this.element.find(".ui-state-comment-field").val(),text=textConverter.convert(commentText,!0);self.fire("save",{$set:{entityState:{id:self.entityStateId},comments:[{description:text}]},$include:[{comments:["id","description"]}]})},_cancel:function(evt){evt.stopPropagation(),this.element.find(".ui-entity-state-comment").remove();var $dropdown=this.element.find(".ui-drop-down");$dropdown.find(".drop-down-list").listSelectable("enable"),$dropdown.show()}});return stateListEditable});
define('tau/ui/templates/state/ui.template.state.list',["tau/core/templates-factory","tau/ui/templates/state/ui.template.state.option"],function(templates){var config={name:"state.list",engine:"jqote2",markup:['<div class="ui-drop-down">','<div role="list" class="drop-down-list">','<div class="drop-down-list__inner i-inner">','<%= fn.sub(this.templateOption || "state.option", this.states) %>',"</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.entityStateList',["tau/components/component.creator","tau/models/propertyLists/model.entityStateList","tau/ui/extensions/stateList/ui.extension.stateList.editable.entityState","tau/ui/extensions/entityStateList/ui.extension.entityStateList.practices.comment","tau/ui/extensions/bubble/ui.extension.bubble.listResizer","tau/ui/templates/state/ui.template.state.list"],function(creator,Model,EditableExtension,CommentExtension,ListExtension,template){return{create:function(config){var creatorConfig={extensions:[Model,EditableExtension,CommentExtension,ListExtension],template:template};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/assignmentsList/ui.template.feature.assignmentsList.userList',["tau/core/templates-factory","tau/ui/templates/common/ui.template.user","tau/ui/templates/assignmentsList/ui.template.assignmentsList.addBtn"],function(templates){var config={name:"feature-assignments-user-list",markup:['<div class="group" roleId="${role.id}">','<table class="role-header">',"   <tr>",'   <td class="role-title">','   {{tmpl "assignments-add-btn"}}',"&nbsp;${role.name}","   </td>","</tr>","</table>",'{{tmpl(users) "user"}}',"</div>"].join(""),dependencies:["user","assignments-add-btn"]};return templates.register(config)});
define('tau/ui/templates/assignmentsList/ui.template.feature.assignmentsList',["tau/core/templates-factory","tau/ui/templates/assignmentsList/ui.template.feature.assignmentsList.userList","tau/ui/templates/common/ui.template.user"],function(templates){var config={name:"feature-assignments-list",markup:['<table class="box assignments-table-readonly assignments-table">','   <tr class="title-row">','      <td class="user-list">','      {{tmpl(assignments.groups, {effortPoints: effortPoints}) "feature-assignments-user-list"}}',"      </td>","   </tr>","</table>"].join(""),dependencies:["feature-assignments-user-list","user"]};return templates.register(config)});
define('tau/components/component.feature.assignmentList',["Underscore","tau/components/component.assignmentsList","tau/ui/templates/assignmentsList/ui.template.feature.assignmentsList"],function(_,ComponentAssignmentList,template){return{create:function(config){return _(config).extend({template:template}),ComponentAssignmentList.create(config)}}});
define('tau/models/model.feature.totalEffort',["tau/core/model-base","tau/core/termProcessor"],function(ModelBase,TermProcessor){var titleModel=ModelBase.extend({onInit:function(){var self=this,ctx=self.config.context,typeName=ctx.entity.entityType.name,entityId=ctx.entity.id;self.store.unbind(self),self.store.on({eventName:"afterSave",type:typeName,filter:{id:entityId},hasChanges:["userStories|effort"],listener:self},_.bind(self.onDataUpdated,self)),self.store.get(typeName,{id:entityId,fields:["id","userStories-count","effort"]},{scope:this,success:this.onGetEntity}).done({scope:this,success:this.onRequestCompleted})},onDataUpdated:function(){this.fire("refresh")},floatToString:function(flt){return flt.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onGetEntity:function(result){if(!this.config)return;var entity=result.data,terms=this.config.context.getTerms(),tp=new TermProcessor(terms),userStoriesCount=entity["userStories-count"];userStoriesCount>0?(this.userStoriesCount=userStoriesCount,this.featureTerm=tp.getTerms("feature").name,this.userStoriesTerm=tp.getTerms("userStory").names,this.effort=this.floatToString(entity.effort),this.point=this._getEffortPoints(),this.hidden=!1):(this.label="",this.hidden=!0)},onRequestCompleted:function(){this.fire("dataBind",{userStoriesCount:this.userStoriesCount,featureTerm:this.featureTerm,userStoriesTerm:this.userStoriesTerm,effort:this.effort,point:this.point,hidden:this.hidden})}});return titleModel});
define('tau/ui/templates/feature/ui.template.totalEffort',["tau/core/templates-factory"],function(templates){var config={name:"total-effort",markup:['<div style="',"{{if hidden}}","display:none","{{/if}}",'">',"{{if !hidden }}",'<div class="ui-total-effort">${featureTerm} has <span class="user-story-count">${userStoriesCount}</span> ${userStoriesTerm} with total effort <span class="effort">${effort}</span> ${point}</div>',"{{/if}}","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.feature.totalEffort',["tau/components/component.creator","tau/models/model.feature.totalEffort","tau/ui/templates/feature/ui.template.totalEffort"],function(creator,ModelFeatureTotalEffort,template){return{create:function(config){var creatorConfig={ModelType:ModelFeatureTotalEffort,template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/finder.entity/model.entity.finder',["Underscore","tau/core/class","tau/core/model-base"],function(_,Class,ModelBase){var QueryBuilder=Class.extend({init:function(){this._collection=null,this._parameters=[],this._values={},this._fields=[],this._page=1,this._onPage=10,this._orderBy=null,this._orderDir="asc"},setFields:function(fields){this._fields=fields},setCollection:function(value){this._collection=value},registerParameters:function(params){this._parameters=_.toArray(params)},setParameter:function(name,val){if(_.indexOf(this._parameters,name)==-1)throw new Error('No "'+name+'" parameter for query');this._values[name]=val},setOnPage:function(value){this._onPage=value},setPage:function(page){this._page=page||1},setOrderBy:function(value){this._orderBy=value},setOrderDir:function(value){this._orderDir=value},create:function(){var query={};query.collection=this.createCollection();var request={};request.fields=this._fields,request.$query=this.createWhere();var paging=this.createPaging();request.$skip=paging.skip,request.$limit=paging.limit;var orderBy=this._orderDir=="asc"?"$orderBy":"$orderByDesc";return request[orderBy]=this.createOrderBy(),query.request=request,query},createCollection:function(){return this._collection},createWhere:function(){var where={};return _.forEach(this._values,function(val,name){where[name]=val}),where},createOrderBy:function(){return this._orderBy||"id"},createPaging:function(){var paging={limit:this._onPage,skip:0};return paging.skip=(this._page-1)*this._onPage,paging}}),RequestersQueryBuilder=QueryBuilder.extend({init:function(){this._super(),this.registerParameters(["name","id","project","action","iteration","release","isCurrent","entityType"])},createCollection:function(){return this._super()},createWhere:function(){var where={};return this._values.name!==undefined&&(where.name={$contains:this._values.name}),this._values.project!==undefined&&(where.project=this._values.project),this._values.iteration!==undefined&&(where.iteration=this._values.iteration),this._values.release!==undefined&&(where.release=this._values.release),this._values.entityType!==undefined&&(where.entityType=this._values.entityType),where}}),SearchResult=Class.extend({init:function(result,dataId){this.items=_.union(dataId,result.data);var command=result.command,length=this.items.length;this.paging={start:command.config.$skip,end:command.config.$skip+length,count:length,hasNext:result.data.isNextPageAvailable()}}});return ModelBase.extend({"bus refresh":function(evt){_.extend(this.config,evt.data,!0)},"bus beforeInit":function(evt){this.config=evt.data.config;var entityType=this.config.entitytype||"generals",self=this,actions=this.config.actions||[];this.config.emptyDataMessage=this.config.emptyDataMessage||"No data found";var fields=["id","name",{entityType:["id","name"]}];entityType=="generals"&&fields.push({project:["id","name","abbreviation"]}),entityType=="releases"&&fields.push("isCurrent");var builder=new RequestersQueryBuilder;builder.setCollection(entityType),builder.setOnPage(15),builder.setFields(fields),builder.setOrderBy("id"),entityType=="releases"&&(fields.push("isCurrent"),builder.setOrderBy("startDate")),builder.setOrderDir("desc"),this.builder=builder;var parameters=_.reduce(this.config.filter||{},function(memo,value,key){return value=="-1"&&(value=null),(value||value===null)&&(memo[key]={id:value}),memo},{});self.fire("search.parametersBound",{parameters:parameters}),self.fire("dataBind",{actions:actions,result:null})},"bus search.readyToExecute":function(){var query=this.builder.create(),searchById=function(query,self){var id=query.request.$query.name&&query.request.$query.name.$contains;id=parseInt(+id);var nameIsNumber=!isNaN(id);nameIsNumber?(query.request.$query.id=id,delete query.request.$query.name,self.config.store.find(query.collection,query.request).done({success:function(result){self.fire("searchId.completed",result[0])}})):self.fire("searchId.completed",{data:[]})};searchById(query,this)},"bus searchId.completed":function(evt,dataSearchId){var query=this.builder.create(),self=this;this.config.store.find(query.collection,query.request).done({success:function(result){var searchResult=new SearchResult(result[0],dataSearchId.data);self.fire("search.completed",{result:searchResult})}})},"bus search.completed":function(evt){this.fire("result.ready",{data:{result:evt.data.result}})},"bus search.parametersBound":function(evt){var parameters=evt.data.parameters,builder=this.builder;_.forEach(parameters,function(val,name){val?builder.setParameter(name,val):builder.setParameter(name,undefined)}),builder.setPage(0),this.fire("search.readyToExecute")},"bus search.pagingBound":function(){var builder=this.builder;builder.setPage(builder._page+1),this.fire("search.readyToExecute")},"bus search.orderBound":function(evt){var builder=this.builder;builder.setOrderBy(evt.data.value),builder.setOrderDir(evt.data.dir),builder.setPage(1),this.fire("search.readyToExecute")}})});
define('tau/ui/extensions/finder.entity/ui.extension.finder.entity.list',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$list=$element.find("[role=list]"),$listPlaceholder=$element.find("[role=list-placeholder]");this.$list=$list,this.$listPlaceholder=$listPlaceholder;var _move=_.bind(function(direction,event){if(this.menu.first()&&/^previous/.test(direction)||this.menu.last()&&/^next/.test(direction)){this.menu.deactivate();return}this.menu[direction](event)},this);this.menu=$list.menuEntity({selected:$.proxy(this,"_signUpOnActionsAndSelection")}).data("menuEntity"),this.first=!0,$listPlaceholder.keydown(_.bind(function(event){var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:_move("previousPage",event);break;case keyCode.PAGE_DOWN:_move("nextPage",event);break;case keyCode.UP:_move("previous",event);break;case keyCode.DOWN:_move("next",event);break;case keyCode.ENTER:this.menu.select(event),event.preventDefault()}},this)),this.attachScrollingEvents($list),this.attachSortingEvents($element.find("[role=list-sorting]")),this.setScrollAvailable(!1)},"bus afterRender:last+result.ready:last":function(evt,afterRender,data){var $list=this.$list,result=data.data.result,template=this.config.templateList,$newList=template.get().bind(this.config,result);result.paging.start==0&&$list.empty();var options=$newList.find("[role=option]");this.setScrollAvailable(result.paging.hasNext),options.appendTo($list),this.$listPlaceholder.toggleClass("tau-finder__result_state_loading",!1),result.paging.count>0&&this.$listPlaceholder.toggleClass("tau-finder__result_state_empty",!1),$list.children().length?$list.find(".tau-finder__result_state_empty").remove():$list.append('<li class="tau-finder__result_state_empty">No entity found.</li>'),this.menu.deactivate(),this.menu.refresh(),options.eq(0).mouseenter()},"bus scroll.reachEnd":function(){this.scrollAvailable&&this.bus.fire("search.pagingBound")},setScrollAvailable:function(value){this.scrollAvailable=value},attachScrollingEvents:function($list){var _handler=_.bind(function(){$list.scrollTop()+$list.innerHeight()+18>=$list[0].scrollHeight&&this.bus.fire("scroll.reachEnd")},this);$list.scroll(_handler)},attachSortingEvents:function($header){var $buttons=$header.find("[role=sorting]"),self=this;$header.delegate("[role=sorting]","click",function(){var $button=$(this),dir="desc";$button.hasClass("tau-finder__sorttrigger_dir_"+dir)&&(dir="asc"),$buttons.toggleClass("tau-finder__sorttrigger_dir_desc",!1),$buttons.toggleClass("tau-finder__sorttrigger_dir_asc",!1),$buttons.toggleClass("tau-finder__sorttrigger_state_active",!1),$button.toggleClass("tau-finder__sorttrigger_dir_"+dir,!0),$button.toggleClass("tau-finder__sorttrigger_state_active",!0);var value=$button.val();self.bus.fire("search.orderBound",{value:value,dir:dir})})},_signUpOnActionsAndSelection:function(event,$element){var data=$element.item&&$element.item.data();if(!data)return;if(!data.tmplItem)return;data=data.tmplItem.data;if(!data)return;this.bus.fire("entitySelected",{entity:data})}})});
define('tau/ui/extensions/finder.entity/ui.extension.finder.entity.filter',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$filterForm=$element.find("[role=filter]"),$input=$filterForm.find('[name="name"]');$input.tauResetableInput();var self=this,searching=null,term=$input.val(),delaySearch=function(){clearTimeout(searching),term!=$input.val()&&(searching=setTimeout(function(){_search("search")},100))},_search=function(action){var data={};data.name=$input.val(),term=$input.val(),data.action=action,self.bus.fire("search.parametersBound",{parameters:data})};$input.on("input",function(){delaySearch()}),$input.on("keydown",function(e){switch(e.keyCode){case $.ui.keyCode.DOWN:case $.ui.keyCode.UP:$(this).blur();var event=jQuery.Event("keydown",{keyCode:e.keyCode});$element.find(".tau-finder__result_user-stories").focus().trigger(event);break;case $.ui.keyCode.ENTER:$element.find(".ui-menu").menuEntity("select"),e.preventDefault();break;default:delaySearch()}return!0})}})});
define('tau/ui/templates/finder.entity/ui.template.finder.result-list.row',["tau/core/templates-factory"],function(templates){var config={name:"finder-entity-result-list-row",markup:['<li class="tau-result-list-row" role="option">','<em class="ui-type-icon tau-result-list-row__icon ui-type-icon-${entityType.name.toLowerCase()}">${id}</em>','<span class="tau-result-list-row__name {{if project}}tau-result-list-row__name_full{{/if}}">${name} {{if isCurrent}}(current){{/if}}</span>','{{if project}}<span class="tau-result-list-row__abbreviation">${project.abbreviation}</span>{{/if}}',"</li>"]};return templates.register(config)});
define('tau/ui/templates/finder.entity/ui.template.finder.result-list',["tau/core/templates-factory","tau/ui/templates/finder.entity/ui.template.finder.result-list.row"],function(templates){var config={name:"finder-entity-result-list",markup:['<div  tabindex="0" class="tau-finder__result_state_loading tau-finder__result_user-stories" role="list-placeholder">','<ul  class="tau-finder__table_quick-add" role="list">',"{{if items}}",'{{tmpl(items) "finder-entity-result-list-row"}}',"{{/if}}",'<li class="tau-resultList-load-more tau-finder__result__loader">loading users stories...</li>',"</ul>","</div>"],dependencies:["finder-entity-result-list-row"]};return templates.register(config)});
define('tau/ui/templates/finder.entity/ui.template.finder.filter',["tau/core/templates-factory"],function(templates){var config={name:"finder-entity-filter",markup:['<input class="tau-in-text" autocomplete="off" placeholder="Enter id or name" type="text" name="name" />'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/finder.entity/ui.template.finder',["tau/core/templates-factory","tau/ui/templates/finder.entity/ui.template.finder.result-list","tau/ui/templates/finder.entity/ui.template.finder.filter"],function(templates){var config={name:"finder-entity",markup:['<div class="ui-finder-placeHolder">','<div class="ui-finder-header">','<p role="filter">','{{tmpl() "finder-entity-filter"}}',"</p>","</div>",'{{tmpl(result) "finder-entity-result-list"}}',"</div>"],dependencies:["finder-entity-result-list","finder-entity-filter"]};return templates.register(config)});
define('tau/components/component.finder.entity',["tau/components/component.creator","tau/models/finder.entity/model.entity.finder","tau/ui/extensions/finder.entity/ui.extension.finder.entity.list","tau/ui/extensions/finder.entity/ui.extension.finder.entity.filter","tau/ui/templates/finder.entity/ui.template.finder","tau/ui/templates/finder.entity/ui.template.finder.result-list","libs/jquery/jquery.placeholder","libs/jquery/jquery.tau.resetableInput","libs/jquery/jquery.ui"],function(creator,Model,ExtensionResult,ExtensionFilter,template,templateList){return $.widget("ui.menuEntity",$.ui.menu,{_create:function(){var self=this;this.element.addClass("ui-menu ui-widget ").attr({role:"list","aria-activedescendant":"ui-active-menuitem"}).click(function(event){if(!$(event.target).closest(".ui-menu-item").length)return;self.select(event)}),this.refresh()},refresh:function(){var self=this,items=this.element.children("li").addClass("ui-menu-item").attr("role","option");items.addClass("ui-corner-all").attr("tabindex",-1).mouseenter(function(event){self.activate(event,$(this))}).mouseleave(function(){self.deactivate()}),this._trigger("refresh")},move:function(direction,edge,event){if(!this.active){this.activate(event,this.element.children(edge));return}var next=this.active[direction+"All"](".ui-menu-item").eq(0);next.length?this.activate(event,next):this.activate(event,this.element.children(edge))},activate:function(event,item){this.deactivate();if(this.hasScroll()){var offset=item.offset().top-this.element.offset().top,scroll=this.element.scrollTop(),elementHeight=this.element.height();offset<0?this.element.scrollTop(scroll+offset):offset>=elementHeight&&this.element.scrollTop(scroll+offset-elementHeight+item.height())}this.active=item.eq(0).addClass("tau-result-list-row_hover").attr("id","ui-active-menuitem").end(),this._trigger("focus",event,{item:item})},deactivate:function(){if(!this.active)return;this.active.removeClass("tau-result-list-row_hover").removeAttr("id"),this._trigger("blur"),this.active=null},hasScroll:function(){return this.element.height()<this.element[$.fn.prop?"prop":"attr"]("scrollHeight")}}),{create:function(config){var extensions=[Model,ExtensionResult,ExtensionFilter],creatorConfig={name:config.allData&&config.allData.name||"finder",extensions:extensions,template:template};return config.templateList=templateList,config["queue.bus"]=!0,creator.create(creatorConfig,config)}}});
define('tau/models/finder/model.entity.finder',["Underscore","tau/core/model-base"],function(_,ModelBase){var model=ModelBase.extend({"bus loadMore+nextPageCommandFormed":function(evt){var self=this,cmd=evt.nextPageCommandFormed.data;self.fire("partialDataRequest",{type:cmd.type,config:cmd.config})},"bus dataRequestCompleted":function(evt){var r=evt.data,self=this,isNextPageAvailable=r.data.isNextPageAvailable();isNextPageAvailable||self.fire("nextPageIsNotAvailable");var emptyMessage=r.data.length===0?this.config.emptyDataMessage:null;self.fire("dataLoaded",{data:{emptyMessage:emptyMessage,items:r.data}}),isNextPageAvailable&&(self.fire("nextPageCommandFormed",r.data.getNextPageCommand()),self.fire("nextPageAvailable",{}))},getFields:function(){var fields=this.config.fields||["id","name",{project:["id","abbreviation"]},{entityState:["id","name"]}];return fields},"bus newSearchQuery":function(evt){this.processSearchQuery(evt)},processSearchQuery:function(evt){var searchConfig=evt.data,self=this;_.extend(searchConfig.config,{fields:self.getFields()}),self.fire("partialDataRequest",{type:searchConfig.type,config:searchConfig.config})},"bus searchConfigFormed":function(evt){this.processSearchQuery(evt)},onInit:function(){var self=this,actions=this.config.actions||[];this.config.emptyDataMessage=this.config.emptyDataMessage||"No data found",self.fire("dataBind",{actions:actions,data:{items:[]}}),self.config.context&&self.config.context.entity?self.fire("dataRequest",{type:"general",config:{id:self.config.context.entity.id,fields:[{project:["id","name"]}]},callback:function(r){self.fire("requireSearchConfig",{project:r.data.project})}}):self.fire("requireSearchConfig",{})}});return model});
define('tau/ui/templates/finder/ui.template.finder.resultList.row',["tau/core/templates-factory"],function(templates){var config={name:"resultList-row",markup:['<tr class="tau-result-list-row">','   <td class="id" style="width:10px; padding-left:10px;"><em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">${id}</em></td>',"   <td>${name}</td>",'   <td style="white-space: nowrap;">{{if entityState }}${entityState.name} {{/if}}</td>','   <td style="white-space: nowrap; width:10px;  padding-right:10px;" >{{if project }}${project.abbreviation}{{/if}}</td>',"</tr>"]};return templates.register(config)});
define('tau/ui/templates/finder/ui.template.finder.resultList',["tau/core/templates-factory","tau/ui/templates/finder/ui.template.finder.resultList.row"],function(templates){var config={name:"resultList",markup:['<div role="list" class="ui-resultList i-filter-list">','<div class="tau-no-results">${emptyMessage}</div>','<table cellspacing="0" cellpadding="4" class="tau-result-list">',"<tbody>",'{{tmpl(items) "resultList-row"}}',"</tbody>","</table>",'<div class="tau-resultList-load-more">loading items...</div>',"</div>"],dependencies:["resultList-row"]};return templates.register(config)});
define('tau/ui/templates/finder/ui.template.finder.action',["tau/core/templates-factory"],function(templates){var config={name:"finder-action",markup:["<span id='${id}' class='action-link tau-finder-action'>${name}</span>"]};return templates.register(config)});
define('tau/ui/templates/finder/ui.template.finder',["tau/core/templates-factory","tau/ui/templates/finder/ui.template.finder.resultList","tau/ui/templates/finder/ui.template.finder.action"],function(templates){var config={name:"finder",markup:['<div class="ui-finder-placeHolder">','<div class="ui-drop-down drop-down-actions tau-finder-actions">','{{tmpl(actions) "finder-action"}}',,"</div>",'<div class="ui-finder-header">','<div class="visual-search ui-drop-down">','<div class="filter-field-wrapper"><input type="text" class="filter-field"></div>',"</div>","</div>",'{{tmpl(data) "resultList"}}',"</div>"],dependencies:["resultList","finder-action"]};return templates.register(config)});
define('tau/models/finder/model.assignable.search',["Underscore","tau/core/model-base","tau/core/termProcessor"],function(_,ModelBase,Terms){return ModelBase.extend({init:function(config){this._super(config);var containsOperator=function($query,propertyName,value){$query.hasOwnProperty(propertyName)||($query[propertyName]={}),$query[propertyName].$contains=value},inComplexStatement=function($query,propertyName,value){if(value==="All uncompleted"){$query[propertyName]={isFinal:0};return}if(!$query.hasOwnProperty(propertyName)||_.isNull($query[propertyName]))$query[propertyName]={name:{$in:[]}};if(value==="Backlog"){$query[propertyName]=null;return}$query[propertyName].name&&$query[propertyName].name.$in&&$query[propertyName].name.$in.push(value)},idStatement=function($query,propertyName,value){$query.hasOwnProperty(propertyName)||($query[propertyName]={$in:[0]});var id=parseInt(value);_.isNumber(id)&&!_.isNaN(id)&&$query[propertyName].$in.push(id)};config.context&&config.context.applicationContext&&config.context.getTerms?this.terms=new Terms(config.context.getTerms()):this.terms=new Terms;var terms=this.terms;this.properties={id:{autoCompletable:!1,statement:idStatement},text:{name:"name",autoCompletable:!1,statement:containsOperator},name:{autoCompletable:!1,statement:containsOperator},description:{autoCompletable:!1,statement:containsOperator},tag:{name:"tags",autoCompletable:!1,statement:containsOperator},project:{label:terms.resolve("project"),autoCompletable:!0,statement:inComplexStatement},state:{name:"entityState",autoCompletable:!0,fields:[{entityType:["id"]}],items:[{label:"All uncompleted",value:"All uncompleted",id:0}],statement:inComplexStatement},iteration:{label:terms.resolve("iteration"),autoCompletable:!0,category:"project",items:[{label:"Backlog",value:"Backlog",id:0}],fields:[{project:["id","abbreviation"]}],statement:inComplexStatement},release:{label:terms.resolve("release"),autoCompletable:!0,category:"project",items:[{label:"Backlog",value:"Backlog",id:0}],fields:[{project:["id","abbreviation"]}],statement:inComplexStatement},priority:{autoCompletable:!0,fields:[{entityType:["id","name"]}],statement:inComplexStatement}}},getType:function(){return"assignable"},"bus autoCompleteRequest":function(evt){var config=evt.data,self=this,property=self.properties[config.property];if(!property)return;if(property.autoCompletable!==!0)return;if(property.autoCompleteValues){var data={config:config,data:property.autoCompleteValues};self["bus autoComplete"]({data:data});return}var type=property.hasOwnProperty("name")?property.name:config.property,fields=["id","name"];property.hasOwnProperty("fields")&&_.mergeFields(fields,property.fields);var callback=function(r){var evtData={data:r.data,config:config};self.fire("autoComplete",evtData)};self.bus.fire("dataRequest",{type:type,config:{fields:fields},callback:callback})},_isEqualByCategory:function(record,property,field){return property.hasOwnProperty("category")?record[property.category]?record[property.category].name===field.category:!0:!0},"bus autoComplete":function(evt){var cfg=evt.data,config=cfg.config,values=[],self=this,property=this.properties[config.property];property.hasOwnProperty("items")&&(values=values.concat(property.items)),_.each(cfg.data,function(v){if(v.name===""||v.name==="-")return;if(_(values).any(function(field){return field.value.toLowerCase()===v.name.toLocaleLowerCase()&&self._isEqualByCategory(v,property,field)}))return;var item={label:v.name,value:v.name,id:v.id,dataItem:v},filter=function(){return!0};property.hasOwnProperty("filter")&&(filter=property.filter);if(!filter.call(this,item,property,config))return;if(property.hasOwnProperty("category")){var category=v[property.category].abbreviation||v[property.category].name;_.extend(item,{category:category,label:v.name+" ["+category+"]"})}values.push(item)});var finalResultFiltering=_(values).select(function(v){return!config.term||config.term==""?!0:v.value.toLowerCase().indexOf(config.term.toLowerCase())>=0});config.callback(finalResultFiltering)},"bus search":function(evt){var config=evt.data,self=this,searchCollection=config.collection,$query=this.config.$query?_.deepClone(this.config.$query):{};_.each(searchCollection,function(val){var property=self.properties[val.property];if(!property)return;var name=property.name?property.name:val.property;property.statement($query,name,val.value)}),self.bus.fire("newSearchQuery",{type:self.getType(),config:{$orderBy:"name",$query:$query,$skip:0,$limit:20}})},getInitialQueryConfig:function(){return{$skip:0,$limit:20,$query:this.config.$query?_.deepClone(this.config.$query):{}}},getInitialQueryString:function(){return""},"bus requireSearchConfig":function(evt){var self=this,project=evt.data.project,config=self.getInitialQueryConfig();_.defaults(config,{$orderBy:"name"});var searchQuery=self.getInitialQueryString();self.fire("searchConfigFormed",{type:self.getType(),config:config,properties:self.properties,searchQuery:searchQuery})}})});
define('tau/models/finder/model.general.search',["Underscore","tau/models/finder/model.assignable.search"],function(_,ModelBase){return ModelBase.extend({init:function(config){var self=this;self._super(config),delete self.properties.release,delete self.properties.iteration,delete self.properties.state,delete self.properties.priority;var idStatement=function($query,propertyName,value){var v=_(self.properties.type.autoCompleteValues).select(function(v){return v.name.indexOf(value.toLowerCase())>=0});$query.hasOwnProperty(propertyName)||($query[propertyName]={id:{$in:[0]}}),_.each(v,function(r){$query[propertyName].id.$in.push(r.id)})};self.properties.type={name:"entityType",autoCompletable:!0,statement:idStatement,autoCompleteValues:[{id:2,name:self.terms.resolve("release")},{id:3,name:self.terms.resolve("iteration")},{id:4,name:self.terms.resolve("story")},{id:5,name:self.terms.resolve("task")},{id:8,name:self.terms.resolve("bug")},{id:9,name:self.terms.resolve("feature")},{id:11,name:self.terms.resolve("build")},{id:12,name:self.terms.resolve("test case")},{id:13,name:self.terms.resolve("test plan")},{id:14,name:self.terms.resolve("test run")},{id:16,name:self.terms.resolve("impediment")},{id:17,name:self.terms.resolve("request")},{id:21,name:self.terms.resolve("solution")}]}},getInitialQueryString:function(){return""},getType:function(){return"general"}})});
define('tau/models/finder/model.data',["Underscore","tau/core/model-base"],function(_,ModelBase){return ModelBase.extend({"bus dataRequest":function(evt){this.config.store.get(evt.data.type,evt.data.config,{success:evt.data.callback}).done()},"bus partialDataRequest":function(evt){var self=this,successFn=function(r){self.fire("dataRequestCompleted",r)};self.config.store.find(evt.data.type,evt.data.config,{success:successFn,failure:function(){}}).done()}})});
define('tau/ui/extensions/finder/ui.extension.finder.list',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/templates/finder/ui.template.finder.resultList"],function(_,$,ExtensionBase,template){return ExtensionBase.extend({appendData:function($element,data){var self=this;self.getShowMoreElement($element).hide();var newElement=template.get().bind(self.config,data),message=data.emptyMessage||"";self._setNoResultsMessage($element,message);var rows=$(".tau-result-list>tbody>tr",newElement);rows.appendTo($(".ui-resultList>table>tbody",$element)),self.bus.fire("dataRendered",{element:$element})},_setScrollingMode:function($element,isAvailable){this.getList($element).data("noScrolling",!isAvailable)},_setNoResultsMessage:function($element,message){var $no=$(".tau-no-results",$element);$no.text(message),message===""||_.isNull(message)||_.isUndefined(message)?$no.hide():$no.show()},"bus elementReady+dataLoaded":function(evt){var $element=evt.elementReady.data.element,data=evt.dataLoaded.data.data;this.appendData($element,data)},"bus dataRendered+nextPageAvailable":function(evt){var $element=evt.dataRendered.data.element;this._setScrollingMode($element,!0)},"bus search+dataLoaded":function(evt){var self=this,$element=evt.search.data.element;this.bus.fire("elementReady",{element:$element})},"bus loadMore+dataLoaded":function(evt){var self=this,$element=evt.loadMore.data.element;this.bus.fire("elementReady",{element:$element})},getList:function($element){return $(".ui-resultList",$element)},attachScrollingEvents:function($element){var self=this,$list=self.getList($element).scroll(function(evt){$list.data("noScrolling")!=1&&$list.scrollTop()+$list.innerHeight()>=$list[0].scrollHeight&&self.bus.fire("scrollToEnd",{element:$element})})},"bus search":function(evt){var $element=evt.data.element;$(".tau-result-list>tbody",$element).html(""),this.getShowMoreElement($element).show(),this._setNoResultsMessage($element,""),this._setScrollingMode($element,!1);var $list=this.getList($element);$list.prop({scrollTop:$list.get(0).scrollHeight})},_signUpOnActionsAndSelection:function($element){var self=this;self.getList($element).click(function(evt){var $row=$(evt.target).parents("tr.tau-result-list-row:first");if(!$row.data)return;var data=$row.data();if(!data)return;if(!data.tmplItem)return;data=data.tmplItem.data;if(!data)return;self.bus.fire("entitySelected",{entity:data})}),$(".action-link",$element).click(function(){var action=$(this).data().tmplItem.data;action.fn.call(self)})},"bus afterRender":function(evt){var $element=evt.data.element,self=this;self.bus.fire("elementReady",{element:$element}),self.attachScrollingEvents($element),self._setScrollingMode($element,!1),this._signUpOnActionsAndSelection($element)},getShowMoreElement:function($element){return $(".tau-resultList-load-more",$element)},"bus scrollToEnd+nextPageAvailable":function(evt){var self=this,$element=evt.scrollToEnd.data.element,$list=self.getList($element);self._setScrollingMode($element,!1),self.getShowMoreElement($element).show(),$list.prop({scrollTop:$list.get(0).scrollHeight}),self.bus.fire("loadMore",{element:$element})}})});
define('tau/ui/extensions/finder/ui.extension.finder.simpleSearch',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase,search){return ExtensionBase.extend({"bus afterRender":function(args){var $element=args.data.element,self=this,$input=$(".filter-field",$element),showHandler=function(){$input.is(":visible")&&$input.focus()};$(".tau-bubble").bind("show",showHandler),self.fire("showHandlerSigned",{handler:showHandler});var searchHandler=function(evt){var $input=$(this),value=$input.val();if(evt.keyCode==jQuery.ui.keyCode.ENTER){self.fire("completeInput",{element:$element,value:value});return}if(evt.keyCode==jQuery.ui.keyCode.DOWN||evt.keyCode==jQuery.ui.keyCode.UP)return;self.fire("inputChange",{element:$element,value:value})};$input.keyup(searchHandler),this.disableChange=!1},"bus inputChange":function(args){var self=this;self.lastChangeDate||(self.lastChangeDate=new Date),self.lastArgs||(self.lastArgs={value:""});if(self.lastArgs.value==args.data.value)return;self.lastArgs=args.data,setTimeout(function(){if(!self.lastChangeDate)return;var diff=new Date-self.lastChangeDate;diff>500&&self.lastArgs&&self.fire("completeInput",self.lastArgs)},501)},"bus partialDataRequest":function(){this.disableChange=!0},"bus dataRequestCompleted":function(){this.disableChange=!1},"bus completeInput":function(args){var self=this;self.lastRequestArgs||(self.lastRequestArgs={value:""});if(self.lastRequestArgs.value==args.data.value)return;var collection=args.data.value!==""&&args.data.value!==null?[{property:"name",value:args.data.value}]:[];self.fire("search",{element:args.data.element,collection:collection}),self.lastChangeDate=null,self.lastRequestArgs=args.data},"bus destroy+showHandlerSigned":function(args){$(".tau-bubble").unbind("show",args.showHandlerSigned.data.handler)}})});
define('tau/components/component.finder',["tau/components/component.creator","tau/models/finder/model.entity.finder","tau/ui/templates/finder/ui.template.finder","tau/models/finder/model.general.search","tau/models/finder/model.data","tau/ui/extensions/finder/ui.extension.finder.list","tau/ui/extensions/finder/ui.extension.finder.simpleSearch","tau/ui/extensions/bubble/ui.extension.bubble.listResizer"],function(creator,MainModel,template,Search,Data,List,VisualSearch,ListExtension){return{create:function(config){var mainModel=MainModel,search=config.searchModel||Search;!config.resetDisabled&&config.data&&(config.data.id||config.data.value&&config.data.value.id)&&(config.actions=[{name:"reset",fn:function(){this.bus.fire("entitySelected",{entity:null})}}]);var creatorConfig={name:"finder",extensions:[Data,mainModel,search,List,VisualSearch,ListExtension],template:template};return config.additionalExtensions&&(creatorConfig.extensions=creatorConfig.extensions.concat(config.additionalExtensions)),creator.create(creatorConfig,config)}}});
define('tau/models/finder.project/model.finder.project.byTeam',["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,ModelBase,configFactory){return ModelBase.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),this.fire("entity.ready",initConfig.config.context.entity)},"bus configurator.ready + entity.ready":function(e,configurator,user){var store=configurator.getStore(),fireRefresh=_.bind(this.fire,this,"refresh");store.unbind(this),store.on({eventName:"afterSave",type:"team",listener:this,hasChanges:["teamProjects"]},fireRefresh)},"bus configurator.ready:last + teamProjects.ready:last + activeTab.ready:last + beforeInit":function(e,configurator,teamProjects,activeTab){var self=this,store=configurator.getStore(),f=[];f.push(_.bind(this._getList,this,store,"project",["id","name","color"],_.pluck(_.compact(_.pluck(teamProjects,"project")),"id"))),f.push(_.bind(this._getList,this,store,"process",["id","name","isDefault"],[])),_.parallel(f,function(err,res){var projects=res[0],processes=res[1];self.fire("dataBind",{projects:projects,activeTab:activeTab,canAddProjects:!0,teams:[],canAddTeams:!1,showTeams:!1,submitLabel:"Assign",showEmpty:!0,showSearch:projects.length>20,colors:configFactory.getConfigByType("project").prototype.colors,processes:processes})})},_getList:function(store,name,fields,excludeIds,next){store.get(name,{fields:fields}).done({success:function(result){var items=result[0].data;items=_.filter(items,function(v){return _.indexOf(excludeIds,v.id)==-1}),items=_.sortBy(items,function(v){return v.name.toUpperCase()}),next(!1,items)}})},"bus configurator.ready:last + entity.ready":function(evt,configurator,entity){var self=this;configurator.getStore().get("team",{id:entity.id,fields:[{teamProjects:[{project:["id","name"]}]}]}).done({success:function(res){self.fire("teamProjects.ready",res[0].data.teamProjects)}})},"bus configurator.ready:last + destroy":function(e,configurator){var store=configurator.getStore();store.unbind(this)}})});
define('tau/models/finder.project/model.finder.project.byTeam.connect',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus configurator.ready:last + entity.ready:last + form.submitted":function(evt,configurator,entity,data){var self=this,ids=data.projectIds;this._connect(configurator,entity,ids).done(function(){self.fire("projects.connected",ids)})},"bus configurator.ready:last + entity.ready:last + project.add.success":function(evt,configurator,entity,project){var self=this,ids=[project.id];this._connect(configurator,entity,ids).done(function(){self.fire("projects.connected",ids)})},_connect:function(configurator,team,ids){var store=configurator.getStore(),saves=[],tps=[];_.forEach(ids,function(projectId){tps.push({project:{id:projectId}})}),saves.push({id:team.id,type:"team",fields:["id","teamProjects"],data:{teamProjects:tps}});var f=[function(next){store.evictProperties(team.id,team.entityType.name,["teamProjects"]),next()}];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})});var def=$.Deferred();return _.parallel(f,function(err,res){def.resolve(ids)}),def}})});
define('tau/ui/extensions/tabs/ui.extension.tabs.modern',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus initialize":function(){this.fire("activeTab.ready",null)},"bus activeTab.ready > refresh":function(evt,tab){this.fire("activeTab.ready",tab)},"bus $el.ready":function(evt,$el){var self=this,$active=$el.find(".i-role-tabheader.tau-active");$active.length&&this._switchTab($el,$active,!0),$el.on("click",".i-role-tabheader",function(){var $tabheader=self._switchTab($el,$(this));self.fire("activeTab.ready",self._getActiveName($el))})},_switchTab:function($el,$tabheader,force){var $tabheaders=$el.find(".i-role-tabheader"),tab=$tabheader.data("tab");$tabheaders.not($tabheader).each(function(){$el.find(".i-role-tab-"+$(this).data("tab")).removeClass("tau-active")}).removeClass("tau-active");var $tab=$el.find(".i-role-tab-"+tab);return $tab.toggleClass("tau-active",force),$tab.hasClass("tau-active")&&this._applyFocus($tab),$tabheader.toggleClass("tau-active",force),$tabheader},_applyFocus:function($tab){$tab.find("form :submit:first:visible").focus(),$tab.find("form :text:first:visible").focus()},_getActiveName:function($el){return $el.find(".i-role-tabheader.tau-active").data("tab")||null}})});
define('tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.main',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $el=renderData.element;this.fire("$el.ready",$el)},"bus $list.ready":function(evt,$list){this.fire("view.component.rendered",{element:$list})}})});
define('tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.attach',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $teamSection.ready + $projectSection.ready + $list.ready":function(evt,$teams,$projects,$el){var self=this,$list=$el;$list.delegate("[role=action-submit]","click",function(){var data={},$checked=$teams.find(".i-role-list :checked");data.teamIds=$checked.map(function(){return $(this).val()}),$checked=$projects.find(" .i-role-list :checked"),data.projectIds=$checked.map(function(){return $(this).val()}),self.fire("form.submitted",data)})}})});
define('tau/ui/extensions/finder.project/ui.extension.finder.project.bubble',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready + $el.ready":function(evt,configurator,$el){var self=this,$bubbled=$el,$content=$el;this.fire("$list.ready",$content),this.fire("$bubbled.ready",$bubbled),this.fire("$popup.ready",$content),this.fire("$teamSection.ready",$()),this.fire("$projectSection.ready",$el),this.fire("$sections.ready",$el)}})});
define('tau/ui/templates/finder.project/ui.template.finder.project',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.projects.list","tau/ui/templates/finder.project/ui.template.finder.project.add.form"],function(templates){var config={name:"finder.project",engine:"jqote2",markup:['<div class="tau-team-control">','<div class="tau-actions i-role-tabheaders">','<div class="tau-assign-btn i-role-tabheader <% if (this.activeTab == "assign"){ %> tau-active <% } %>" data-tab="assign">',"<span></span>Assign to Project","</div>","<i>or</i>",'<div class="tau-new-project i-role-tabheader <% if (this.activeTab == "add"){ %> tau-active <% } %>" data-tab="add">',"<span></span>New project","</div>","</div>",'<div class="tau-tab-content">','<div class="tau-tab-pane tau-teams-list <% if (this.showSearch) { %>tau-teams-list_use_filter<% } %> i-role-tab-assign <% if (this.activeTab == "assign"){ %> tau-active <% } %> ">',"<% if (this.showSearch) { %>",'<div class="tau-search-team">','<span class="tau-inline-group tau-search">','<input name="filter" type="text" class="tau-in-text" placeholder="Search Projects" />','<button type="button" class="tau-btn tau-search"></button>',"</span>",'<i class="tau-pointer"></i>',"</div>","<% } %>",'<div class="tau-existing-team-holder">','<div class="tau-existing-team i-role-section-projects <% if (!this.projects.length) { %>tau-empty<% } %>">','<div class="tau-button-wrap">','<button class="tau-btn tau-primary" role="action-submit" type="button">Assign</button>',"</div>",'<ul class="tau-project-list tau-existing-team-list_cols_3 i-role-list">','<%= fn.sub("board.context.filter.projects.list", this.projects) %>',"</ul>",'<div class="tau-existing-team__message" data-text-nofound="No such project found" data-text-noitems="No available projects"></div>',"</div>","</div>","</div>",'<div class="tau-tab-pane tau-new-entity-holder  i-role-tab-add  <% if (this.activeTab == "add"){ %> tau-active <% } %> ">','<%= fn.sub("finder.project.add.form", this) %>',"</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.finder.project.byTeam',["tau/components/component.creator","tau/models/finder.project/model.finder.project.byTeam","tau/models/board.context.filter/model.board.context.filter.add.project","tau/models/finder.project/model.finder.project.byTeam.connect","tau/ui/extensions/tabs/ui.extension.tabs.modern","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.main","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.attach","tau/ui/extensions/finder.project/ui.extension.finder.project.bubble","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.project","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.members-widget","tau/components/extensions/error/extension.errorBar","tau/ui/templates/finder.project/ui.template.finder.project"],function(ComponentCreator,ModelMain,ModelAdd,ModelConnect,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionAdd,ExtensionAddMembers,ExtensionError,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelMain,ModelAdd,ModelConnect,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionAdd,ExtensionAddMembers,ExtensionError],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/finder.project/model.finder.project.byUser',["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,ModelBase,configFactory){return ModelBase.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),initConfig.config.context.entity.type=initConfig.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",initConfig.config.context.entity)},"bus configurator.ready + entity.ready":function(e,configurator,entity){var store=configurator.getStore(),fireRefresh=_.bind(function(res){res.data.cmd.name=="removeFromList"&&this.fire("refresh")},this);store.unbind(this),store.on({eventName:"afterSave",type:"project",listener:this},fireRefresh)},"bus configurator.ready:last + projectMembers.ready:last + activeTab.ready:last + beforeInit":function(e,configurator,projectMembers,activeTab){var self=this,store=configurator.getStore(),f=[];f.push(_.bind(this._getList,this,store,"project",["id","name","color"],_.pluck(_.compact(_.pluck(projectMembers,"project")),"id"))),_.parallel(f,function(err,res){var projects=res[0];self.fire("dataBind",{activeTab:activeTab,teams:[],showProjects:!1,canAddProjects:!1,projects:projects,canAddprojects:!0,submitLabel:"Assign",showEmpty:!0,showSearch:projects.length>20,icons:configFactory.getConfigByType("project").prototype.icons})})},_getList:function(store,name,fields,excludeIds,next){store.get(name,{fields:fields}).done({success:function(result){var items=result[0].data;items=_.filter(items,function(v){return _.indexOf(excludeIds,v.id)==-1}),items=_.sortBy(items,function(v){return v.name.toUpperCase()}),next(!1,items)}})},"bus configurator.ready:last + entity.ready":function(evt,configurator,entity){var self=this;configurator.getStore().get(entity.type,{id:entity.id,fields:[{projectMembers:[{project:["id","name"]}]}]}).done({success:function(res){self.fire("projectMembers.ready",res[0].data.projectMembers)}})},"bus configurator.ready:last + entity.ready:last + form.submitted":function(evt,configurator,user,data){var self=this,store=configurator.getStore(),saves=[];_.forEach(data.projectIds,function(id){saves.push({id:id,type:"project",fields:["id","projectMembers"],data:{projectMembers:[{user:{id:user.id}}]}})});var f=[];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})}),_.parallel(f,function(err,res){res.length&&configurator.getGlobalBus().fire("projectsAndUsers.connected",res),self.fire("refresh")})},"bus configurator.ready:last + destroy":function(e,configurator){var store=configurator.getStore();store.unbind(this)}})});
define('tau/ui/templates/finder.project.byUser/ui.template.finder.project.byUser',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.projects.list"],function(templates){var config={name:"finder.project.byUser",engine:"jqote2",markup:["<div>",'<div class="tau-actions i-role-tabheaders">','<div class="tau-assign-btn i-role-tabheader <% if (this.activeTab == "assign"){ %> tau-active <% } %>" data-tab="assign">',"<span></span>Assign to Project","</div>","</div>",'<div class="tau-tab-content">','<div class="tau-tab-pane  tau-projects-list <% if (this.showSearch) { %>tau-teams-list_use_filter<% } %> i-role-tab-assign <% if (this.activeTab == "assign"){ %> tau-active <% } %> ">',"<% if (this.showSearch) { %>",'<div class="tau-search-team">','<span class="tau-inline-group tau-search">','<input name="filter" type="text" class="tau-in-text" placeholder="Search Projects" tabindex="-1" />','<button type="button" class="tau-btn tau-search"></button>',"</span>",'<i class="tau-pointer"></i>',"</div>","<% } %>",'<div class="tau-existing-project-holder">','<div class="tau-existing-project i-role-section-projects <% if (!this.projects.length) { %>tau-empty<% } %>">','<div class="tau-button-wrap">','<button class="tau-btn tau-primary" role="action-submit" type="button">Assign</button>',"</div>",'<ul class="tau-project-list i-role-list">','<%= fn.sub("board.context.filter.projects.list", this.projects) %>',"</ul>",'<div class="tau-existing-project__message" data-text-nofound="No such project found" data-text-noitems="No available projects"></div>',"</div>","</div>","</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.finder.project.byUser',["tau/components/component.creator","tau/models/finder.project/model.finder.project.byUser","tau/ui/extensions/tabs/ui.extension.tabs.modern","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.main","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.attach","tau/ui/extensions/finder.project/ui.extension.finder.project.bubble","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection","tau/components/extensions/error/extension.errorBar","tau/ui/templates/finder.project.byUser/ui.template.finder.project.byUser"],function(ComponentCreator,ModelMain,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionError,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelMain,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionError],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/finder.requesters/model.finder.requesters.search',["Underscore","tau/core/class","tau/core/model-base"],function(_,Class,ModelBase){var QueryBuilder=Class.extend({init:function(){this._collection=null,this._parameters=[],this._values={},this._fields=[],this._page=1,this._onPage=10,this._orderBy=null,this._orderDir="asc"},setFields:function(fields){this._fields=fields},setCollection:function(value){this._collection=value},registerParameters:function(params){this._parameters=_.toArray(params)},setParameter:function(name,val){if(_.indexOf(this._parameters,name)==-1)throw new Error('No "'+name+'" parameter for query');this._values[name]=val},setOnPage:function(value){this._onPage=value},setPage:function(page){this._page=page||1},setOrderBy:function(value){this._orderBy=value},setOrderDir:function(value){this._orderDir=value},create:function(){var query={};query.collection=this.createCollection();var request={};request.fields=this._fields,request.$query=this.createWhere();var paging=this.createPaging();request.$skip=paging.skip,request.$limit=paging.limit;var orderBy=this._orderDir=="asc"?"$orderBy":"$orderByDesc";return request[orderBy]=this.createOrderBy(),query.request=request,query},createCollection:function(){return this._collection},createWhere:function(){var where={};return _.forEach(this._values,function(val,name){where[name]=val}),where},createOrderBy:function(){return this._orderBy||"id"},createPaging:function(){var paging={limit:this._onPage,skip:0};return paging.skip=(this._page-1)*this._onPage,paging}}),RequestersQueryBuilder=QueryBuilder.extend({init:function(){this._super(),this.registerParameters(["name","email","type","projectId","companyId","action"])},createCollection:function(){var collection=this._super();if(this._values.type){var val=this._values.type;val=="User"?collection="User":val=="Requester"&&(collection="Requester")}return this._values.companyId&&(collection="Requester"),collection},createWhere:function(){var where={};return this._values.type||(where.kind={$in:["User","Requester"]}),where.isActive=1,where.deleteDate={$isNull:!0},this._values["action"]=="reset"?where:(this._values.name!==undefined&&(where.lastName={$contains:this._values.name}),this._values.email!==undefined&&(where.email={$contains:this._values.email}),this._values.companyId&&this.createCollection()=="Requester"&&(where["company.id"]=this._values.companyId),where)}}),SearchResult=Class.extend({init:function(result){this.items=result.data;var command=result.command,length=result.data.length;this.paging={start:command.config.$skip,end:command.config.$skip+length,count:length,hasNext:result.data.isNextPageAvailable()}}}),model=ModelBase.extend({"bus beforeInit":function(evt){this.config=evt.data.config;var store=this.config.store,self=this,actions=this.config.actions||[];this.config.emptyDataMessage=this.config.emptyDataMessage||"No data found",store.get("company",{fields:["id","name"]}).done({success:function(results){self.fire("dataBind",{actions:actions,result:null,filter:{companies:results[0].data}})}});var builder=new RequestersQueryBuilder;builder.setCollection("generalUser"),builder.setOnPage(15),builder.setFields(["id","firstName","lastName","email","login"]),builder.setOrderBy("id"),builder.setOrderDir("desc"),this.builder=builder,self.fire("search.parametersBound",{parameters:{}})},"bus search.readyToExecute":function(evt){var query=this.builder.create(),self=this;this.config.store.find(query.collection,query.request).done({success:function(result){var searchResult=new SearchResult(result[0]);self.fire("search.completed",{result:searchResult})}})},"bus search.completed":function(evt){this.fire("result.ready",{data:{result:evt.data.result}})},"bus search.parametersBound":function(evt){var parameters=evt.data.parameters,builder=this.builder;_.forEach(parameters,function(val,name){val?builder.setParameter(name,val):builder.setParameter(name,undefined)}),builder.setPage(0),this.fire("search.readyToExecute")},"bus search.pagingBound":function(evt){var builder=this.builder;builder.setPage(builder._page+1),this.fire("search.readyToExecute")},"bus search.orderBound":function(evt){var builder=this.builder;builder.setOrderBy(evt.data.value),builder.setOrderDir(evt.data.dir),builder.setPage(1),this.fire("search.readyToExecute")}});return model});
define('tau/models/finder.requesters/model.finder.requesters.add',["Underscore","tau/core/extension.base"],function(_,ModelBase){var model=ModelBase.extend({"bus afterInit:last+entitySelected":function(evt,initConfig,selected){var generalUser=selected.entity,store=initConfig.config.context.configurator.getStore(),entity=initConfig.config.context.entity,self=this;store.save(entity.entityType.name,{id:entity.id,$set:{requesters:[{id:generalUser.id}]},fields:["id"]}).done({success:function(result){}})}});return model});
define('tau/ui/extensions/finder.requesters/ui.extension.finder.requesters.list',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$list=$element.find("[role=list]"),$listPlaceholder=$element.find("[role=list-placeholder]");this.$list=$list,this.$listPlaceholder=$listPlaceholder,this.first=!0,this.$listPlaceholder.listSelectable({items:"[role=option]",className:"tau-result-list-row_hover",inner:"table",keyboardManager:this.config.context.configurator.getKeyBoardManager()}),this.attachScrollingEvents($listPlaceholder),this.attachSortingEvents($element.find("[role=list-sorting]")),this.setScrollAvailable(!1),this._signUpOnActionsAndSelection($element)},"bus result.ready":function(evt){var index=this.$listPlaceholder.data("listSelectable")._index;this.$listPlaceholder.listSelectable("disable");var self=this,$list=this.$list,result=evt.data.data.result,template=this.config.templateList,$newList=template.get().bind(this.config,result);result.paging.start==0&&($list.empty(),index=-1,result.paging.count==0&&this.$listPlaceholder.toggleClass("tau-finder__result_state_empty",!0)),this.setScrollAvailable(result.paging.hasNext),$newList.find("[role=option]").appendTo($list),this.$listPlaceholder.toggleClass("tau-finder__result_state_loading",!1),result.paging.count>0&&this.$listPlaceholder.toggleClass("tau-finder__result_state_empty",!1),this.$listPlaceholder.listSelectable("enable",{saveScroll:!0}),this.$listPlaceholder.data("listSelectable")._index=index,this.first&&(setTimeout(function(){self.$listPlaceholder.scrollTop(0)},100),this.first=!1)},"bus scroll.reachEnd":function(evt){this.scrollAvailable&&this.bus.fire("search.pagingBound")},setScrollAvailable:function(value){this.scrollAvailable=value},attachScrollingEvents:function($list){var self=this,_handler=function(evt){$list.scrollTop()+$list.innerHeight()>=$list[0].scrollHeight&&self.bus.fire("scroll.reachEnd")};$list.scroll(_handler)},attachSortingEvents:function($header){var $buttons=$header.find("[role=sorting]"),self=this;$header.delegate("[role=sorting]","click",function(){var $button=$(this),dir="desc";$button.hasClass("tau-finder__sorttrigger_dir_"+dir)&&(dir="asc"),$buttons.toggleClass("tau-finder__sorttrigger_dir_desc",!1),$buttons.toggleClass("tau-finder__sorttrigger_dir_asc",!1),$buttons.toggleClass("tau-finder__sorttrigger_state_active",!1),$button.toggleClass("tau-finder__sorttrigger_dir_"+dir,!0),$button.toggleClass("tau-finder__sorttrigger_state_active",!0);var value=$button.val();self.bus.fire("search.orderBound",{value:value,dir:dir})})},_signUpOnActionsAndSelection:function($element){var self=this;$element.delegate("[role=option]","click",function(evt){var $option=$(this),data=$option.data();if(!data)return;if(!data.tmplItem)return;data=data.tmplItem.data;if(!data)return;self.bus.fire("entitySelected",{entity:data})})}})});
define('tau/ui/extensions/finder.requesters/ui.extension.finder.requesters.filter',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $element=evt.data.element,$filterForm=$element.find("[role=filter]"),$inputs=$filterForm.find(":input"),$buttons=$filterForm.find(":button"),self=this;this.state="clear",$buttons.prop("disabled","disabled"),$buttons.addClass("disable"),$inputs.bind("change keyup",function(){self.state="dirty",$buttons.prop("disabled",!1),$buttons.removeClass("disable")});var _search=function(action){var data={};$inputs.each(function(){var $input=$(this),val=_.trim($input.val());data[$input.attr("name")]=val}),data.action=action,self.bus.fire("search.parametersBound",{parameters:data})};$inputs.bind("keydown",function(e){switch(e.keyCode){case $.ui.keyCode.ENTER:_search("search"),e.stopPropagation(),e.preventDefault();break;case $.ui.keyCode.DOWN:$(this).is("input")?$(this).blur():(e.stopPropagation(),e.preventDefault())}}),$buttons.eq(0).click(function(){_search($(this).val())}),$buttons.eq(1).click(function(){var data={};$inputs.each(function(){var $input=$(this);$input.val(null);var val=_.trim($input.val());data[$input.attr("name")]=val}),data.action=$(this).val(),self.bus.fire("search.parametersBound",{parameters:data}),$buttons.prop("disabled","disabled"),$buttons.addClass("disable"),$inputs.filter("[data-autofocus]").focus()});var $companyWidget=$inputs.filter("[name=companyId]"),$typeWidget=$inputs.filter("[name=type]"),dep=function(){$typeWidget.val()=="User"?($companyWidget.val(null),$companyWidget.prop("disabled","disabled")):$companyWidget.prop("disabled",!1)};dep(),$typeWidget.on("change",dep)}})});
define('tau/ui/templates/finder.requesters/ui.template.finder.resultList.row',["tau/core/templates-factory"],function(templates){var config={name:"finder-requesters-resultList-row",markup:['<tr class="tau-result-list-row" role="option">','<td class="tau-finder__cell tau-finder__cell-name">',"{{if firstName || lastName}}","${firstName} ${lastName}","{{else}}","${email}","{{/if}}","</td>",'<td class="tau-finder__cell tau-finder__cell-email">${email}</td>','<td class="tau-finder__cell tau-finder__cell-login">${login}</td>',"</tr>"]};return templates.register(config)});
define('tau/ui/templates/finder.requesters/ui.template.finder.resultList',["tau/core/templates-factory","tau/ui/templates/finder.requesters/ui.template.finder.resultList.row"],function(templates){var config={name:"finder-requesters-resultList",markup:['<table class="tau-finder__table">',"<thead>",'<tr role="list-sorting">','<th class="tau-finder__cell tau-finder__cell-name">','<button type="button" class="tau-finder__sorttrigger" role="sorting" value="firstName">Name</button>',"</th>",'<th class="tau-finder__cell tau-finder__cell-email">','<button type="button" class="tau-finder__sorttrigger" role="sorting" value="email">Email</button>',"</th>",'<th class="tau-finder__cell tau-finder__cell-login">','<button type="button" class="tau-finder__sorttrigger" role="sorting" value="login">Login</button>',"</th>","</tr>","</tbody>","</table>",'<div class="ui-resultList tau-finder__result tau-finder__result_state_loading" role="list-placeholder">','<div class="tau-no-results  tau-finder__result__empty">No requesters found.</div>','<table class="tau-finder__table">','<tbody role="list">',"{{if items}}",'{{tmpl(items) "finder-requesters-resultList-row"}}',"{{/if}}","</tbody>","</table>",'<div class="tau-resultList-load-more tau-finder__result__loader">loading users...</div>',"</div>"],dependencies:["finder-requesters-resultList-row"]};return templates.register(config)});
define('tau/ui/templates/finder.requesters/ui.template.finder.action',["tau/core/templates-factory"],function(templates){var config={name:"finder-requesters-action",markup:["<span id='${id}' class='action-link tau-finder-action'>${name}</span>"]};return templates.register(config)});
define('tau/ui/templates/finder.requesters/ui.template.finder.filter',["tau/core/templates-factory"],function(templates){var config={name:"finder-requesters-filter",markup:['<div class="ui-form">','<div class="ui-form__group">','<div class="ui-form__cols">','<label for="name">Last Name</label>','<input type="text" name="name" />',"</div>",'<div class="ui-form__cols">','<label for="email">Email</label>','<input data-autofocus type="text" name="email" />',"</div>","</div>",'<div class="ui-form__group">','<div class="ui-form__cols">','<label for="type">User Type</label>','<select name="type">','<option value="">All</option>','<option value="Requester">Requesters</option>','<option value="User">Users</option>',"</select>","</div>",'<div class="ui-form__cols">','<label for="type">Company</label>','<select name="companyId">','<option value="">All</option>',"{{each(i, company) filter.companies}}",'<option value="${company.id}">${company.name}</option>',"{{/each}}","</select>","</div>","</div>",'<div class="ui-form__group">','<div class="ui-form__row ui-form__row-controls button-group">','<button type="button" name="action" value="search" class="button" >Filter</button>','<button type="button" name="action" value="reset" class="button" >Clear</button>',"</div>","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/finder.requesters/ui.template.finder',["tau/core/templates-factory","tau/ui/templates/finder.requesters/ui.template.finder.resultList","tau/ui/templates/finder.requesters/ui.template.finder.action","tau/ui/templates/finder.requesters/ui.template.finder.filter"],function(templates){var config={name:"finder-requesters",markup:['<div class="ui-finder-placeHolder">','<div class="ui-finder-header">','<div class="visual-search ui-drop-down" role="filter">','{{tmpl() "finder-requesters-filter"}}',"</div>","</div>",'{{tmpl(result) "finder-requesters-resultList"}}',"</div>"],dependencies:["finder-requesters-resultList","finder-requesters-action","finder-requesters-filter"]};return templates.register(config)});
define('tau/components/component.finder.requesters',["tau/components/component.creator","tau/models/finder.requesters/model.finder.requesters.search","tau/models/finder.requesters/model.finder.requesters.add","tau/ui/extensions/finder.requesters/ui.extension.finder.requesters.list","tau/ui/extensions/finder.requesters/ui.extension.finder.requesters.filter","tau/ui/templates/finder.requesters/ui.template.finder","tau/ui/templates/finder.requesters/ui.template.finder.resultList"],function(creator,ModelSearch,ModelAdd,ExtensionResult,ExtensionFilter,template,templateList){return{create:function(config){var creatorConfig={name:"finder",extensions:[ModelSearch,ModelAdd,ExtensionResult,ExtensionFilter],template:template};return config.templateList=templateList,creator.create(creatorConfig,config)}}});
define('tau/models/finder.team/model.finder.team.byProject',["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,ModelBase,configFactory){return ModelBase.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),initConfig.config.context.entity.type=initConfig.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",initConfig.config.context.entity)},"bus configurator.ready + entity.ready":function(e,configurator,entity){var store=configurator.getStore(),fireRefresh=_.bind(this.fire,this,"refresh");store.unbind(this),store.on({eventName:"afterSave",type:entity.type,listener:this,hasChanges:["teamProjects"]},fireRefresh)},"bus configurator.ready:last + teamProjects.ready:last + activeTab.ready:last + beforeInit":function(e,configurator,teamProjects,activeTab){var self=this,store=configurator.getStore(),f=[];f.push(_.bind(this._getList,this,store,"team",["id","name","icon"],_.pluck(_.compact(_.pluck(teamProjects,"team")),"id"))),_.parallel(f,function(err,res){var teams=res[0];self.fire("dataBind",{activeTab:activeTab,projects:[],showProjects:!1,canAddProjects:!1,teams:teams,canAddTeams:!0,submitLabel:"Assign",showEmpty:!0,showSearch:teams.length>20,icons:configFactory.getConfigByType("team").prototype.icons})})},_getList:function(store,name,fields,excludeIds,next){store.get(name,{fields:fields}).done({success:function(result){var items=result[0].data;items=_.filter(items,function(v){return _.indexOf(excludeIds,v.id)==-1}),items=_.sortBy(items,function(v){return v.name.toUpperCase()}),next(!1,items)}})},"bus configurator.ready:last + entity.ready":function(evt,configurator,entity){var self=this;configurator.getStore().get(entity.type,{id:entity.id,fields:[{teamProjects:[{team:["id","name"]}]}]}).done({success:function(res){self.fire("teamProjects.ready",res[0].data.teamProjects)}})},"bus configurator.ready:last + destroy":function(e,configurator){var store=configurator.getStore();store.unbind(this)}})});
define('tau/models/finder.team/model.finder.team.byProject.connect',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({"bus configurator.ready:last + entity.ready:last + form.submitted":function(evt,configurator,entity,data){var self=this,store=configurator.getStore(),saves=[],tps=[];_.forEach(data.teamIds,function(teamId){tps.push({team:{id:teamId}})}),saves.push({id:entity.id,type:entity.type,fields:["id","teamProjects"],data:{teamProjects:tps}});var f=[function(next){store.evictProperties(entity.id,entity.type,["teamProjects"]),next()}];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})}),_.parallel(f,function(err,res){self.fire("refresh")})},"bus configurator.ready:last + entity.ready:last + team.add.success":function(evt,configurator,entity,team){var self=this,store=configurator.getStore(),saves=[];saves.push({id:entity.id,type:entity.type,fields:["id","teamProjects"],data:{teamProjects:[{team:{id:team.id}}]}});var f=[function(next){store.evictProperties(entity.id,entity.type,["teamProjects"]),next()}];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})}),_.parallel(f,function(err,res){self.fire("refresh")})}})});
define('tau/ui/extensions/finder.team/ui.extension.finder.team.bubble',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready + $el.ready":function(evt,configurator,$el){var self=this,$bubbled=$el,$content=$el;this.fire("$list.ready",$content),this.fire("$bubbled.ready",$bubbled),this.fire("$popup.ready",$content),this.fire("$teamSection.ready",$el),this.fire("$projectSection.ready",$()),this.fire("$sections.ready",$el)}})});
define('tau/ui/templates/finder.team/ui.template.finder.team',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.teams.list","tau/ui/templates/finder.team/ui.template.finder.team.add.form"],function(templates){var config={name:"finder.team",engine:"jqote2",markup:['<div class="tau-team-control">','<div class="tau-actions i-role-tabheaders">','<div class="tau-assign-btn i-role-tabheader <% if (this.activeTab == "assign"){ %> tau-active <% } %>" data-tab="assign">',"<span></span>Assign to Team","</div>","<i>or</i>",'<div class="tau-new-team i-role-tabheader <% if (this.activeTab == "add"){ %> tau-active <% } %>" data-tab="add">',"<span></span>New team","</div>","</div>",'<div class="tau-tab-content">','<div class="tau-tab-pane tau-teams-list <% if (this.showSearch) { %>tau-teams-list_use_filter<% } %> i-role-tab-assign <% if (this.activeTab == "assign"){ %> tau-active <% } %> ">',"<% if (this.showSearch) { %>",'<div class="tau-search-team">','<span class="tau-inline-group tau-search">','<input name="filter" type="text" class="tau-in-text" placeholder="Search Teams" />','<button type="button" class="tau-btn tau-search"></button>',"</span>",'<i class="tau-pointer"></i>',"</div>","<% } %>",'<div class="tau-existing-team-holder">','<i class="tau-pointer"></i>','<div class="tau-existing-team i-role-section-teams <% if (!this.teams.length) { %>tau-empty<% } %>">','<div class="tau-button-wrap">','<button class="tau-btn tau-primary" role="action-submit" type="button">Assign</button>',"</div>",'<ul class="tau-existing-team-list tau-existing-team-list_cols_3 i-role-list">','<%= fn.sub("board.context.filter.teams.list", this.teams) %>',"</ul>",'<div class="tau-existing-team__message" data-text-nofound="No such team found" data-text-noitems="No available teams"></div>',"</div>","</div>","</div>",'<div class="tau-tab-pane tau-new-entity-holder  i-role-tab-add  <% if (this.activeTab == "add"){ %> tau-active <% } %> ">','<%= fn.sub("finder.team.add.form", this) %>',"</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.finder.team.byProject',["tau/components/component.creator","tau/models/finder.team/model.finder.team.byProject","tau/models/board.context.filter/model.board.context.filter.add.team","tau/models/finder.team/model.finder.team.byProject.connect","tau/ui/extensions/tabs/ui.extension.tabs.modern","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.main","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.attach","tau/ui/extensions/finder.team/ui.extension.finder.team.bubble","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.add.team","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.members-widget","tau/components/extensions/error/extension.errorBar","tau/ui/templates/finder.team/ui.template.finder.team"],function(ComponentCreator,ModelMain,ModelAdd,ModelConnect,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionAdd,ExtensionAddMembers,ExtensionError,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelMain,ModelAdd,ModelConnect,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionAdd,ExtensionAddMembers,ExtensionError],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/finder.team/model.finder.team.byUser',["Underscore","tau/core/extension.base","tau/configurations/factory.container.config"],function(_,ModelBase,configFactory){return ModelBase.extend({resetLifecycle:!0,"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator;this.fire("configurator.ready",configurator),initConfig.config.context.entity.type=initConfig.config.context.entity.entityType.name.toLowerCase(),this.fire("entity.ready",initConfig.config.context.entity)},"bus configurator.ready + entity.ready":function(e,configurator,entity){var store=configurator.getStore(),fireRefresh=_.bind(function(res){res.data.cmd.name=="removeFromList"&&this.fire("refresh")},this);store.unbind(this),store.on({eventName:"afterSave",type:"team",listener:this},fireRefresh)},"bus configurator.ready:last + teamMembers.ready:last + activeTab.ready:last + beforeInit":function(e,configurator,teamMembers,activeTab){var self=this,store=configurator.getStore(),f=[];f.push(_.bind(this._getList,this,store,"team",["id","name","icon"],_.pluck(_.compact(_.pluck(teamMembers,"team")),"id"))),_.parallel(f,function(err,res){var teams=res[0];self.fire("dataBind",{activeTab:activeTab,projects:[],showProjects:!1,canAddProjects:!1,teams:teams,canAddTeams:!0,submitLabel:"Assign",showEmpty:!0,showSearch:teams.length>20,icons:configFactory.getConfigByType("team").prototype.icons})})},_getList:function(store,name,fields,excludeIds,next){store.get(name,{fields:fields}).done({success:function(result){var items=result[0].data;items=_.filter(items,function(v){return _.indexOf(excludeIds,v.id)==-1}),items=_.sortBy(items,function(v){return v.name.toUpperCase()}),next(!1,items)}})},"bus configurator.ready:last + entity.ready":function(evt,configurator,entity){var self=this;configurator.getStore().get(entity.type,{id:entity.id,fields:[{teamMembers:[{team:["id","name"]}]}]}).done({success:function(res){self.fire("teamMembers.ready",res[0].data.teamMembers)}})},"bus configurator.ready:last + entity.ready:last + form.submitted":function(evt,configurator,user,data){var self=this,store=configurator.getStore(),saves=[];_.forEach(data.teamIds,function(id){saves.push({id:id,type:"team",fields:["id","teamMembers"],data:{teamMembers:[{user:{id:user.id}}]}})});var f=[];_.forEach(saves,function(save){f.push(function(next){store.save(save.type,{id:save.id,fields:save.fields,$set:save.data}).done({success:function(r){next(!1,r[0].data)}})})}),_.parallel(f,function(err,res){res.length&&configurator.getGlobalBus().fire("teamsAndUsers.connected",res),self.fire("refresh")})},"bus configurator.ready:last + destroy":function(e,configurator,entity){var store=configurator.getStore();store.unbind(this)}})});
define('tau/ui/templates/finder.team.byUser/ui.template.finder.team.byUser',["tau/core/templates-factory","tau/ui/templates/board.context.filter/ui.template.board.context.filter.teams.list"],function(templates){var config={name:"finder.team.byUser",engine:"jqote2",markup:["<div>",'<div class="tau-actions i-role-tabheaders">','<div class="tau-assign-btn i-role-tabheader <% if (this.activeTab == "assign"){ %> tau-active <% } %>" data-tab="assign">',"<span></span>Assign to Team","</div>","</div>",'<div class="tau-tab-content">','<div class="tau-tab-pane tau-teams-list <% if (this.showSearch) { %>tau-teams-list_use_filter<% } %> i-role-tab-assign <% if (this.activeTab == "assign"){ %> tau-active <% } %> ">',"<% if (this.showSearch) { %>",'<div class="tau-search-team">','<span class="tau-inline-group tau-search">','<input name="filter" type="text" class="tau-in-text" placeholder="Search Teams" />','<button type="button" class="tau-btn tau-search"></button>',"</span>",'<i class="tau-pointer"></i>',"</div>","<% } %>",'<div class="tau-existing-team-holder">','<div class="tau-existing-team i-role-section-teams <% if (!this.teams.length) { %>tau-empty<% } %>">','<div class="tau-button-wrap">','<button class="tau-btn tau-primary" role="action-submit" type="button">Assign</button>',"</div>",'<ul class="tau-existing-team-list i-role-list">','<%= fn.sub("board.context.filter.teams.list", this.teams) %>',"</ul>",'<div class="tau-existing-team__message" data-text-nofound="No such team found" data-text-noitems="No available teams"></div>',"</div>","</div>","</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.finder.team.byUser',["tau/components/component.creator","tau/models/finder.team/model.finder.team.byUser","tau/ui/extensions/tabs/ui.extension.tabs.modern","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.main","tau/ui/extensions/finder.projectAndTeam/ui.extension.finder.projectAndTeam.attach","tau/ui/extensions/finder.team/ui.extension.finder.team.bubble","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.filter","tau/ui/extensions/board.context.filter/ui.extension.board.context.filter.selection","tau/components/extensions/error/extension.errorBar","tau/ui/templates/finder.team.byUser/ui.template.finder.team.byUser"],function(ComponentCreator,ModelMain,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionError,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelMain,ExtensionTabs,ExtensionMain,ExtensionAttach,ExtensionBubble,ExtensionFilter,ExtensionSelection,ExtensionError],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/components/component.impedimentList',["Underscore","tau/components/component.list.baseInfo","tau/models/baseInfoList/extension.model.additionalInfoImpedimentFilter"],function(_,componentListEntity,ExtensionModelAdditionalInfoImpedimentFilter){return{create:function(config){return config.typeName="impediment",config.propertyName="impediments",componentListEntity.create(config,{extensions:[ExtensionModelAdditionalInfoImpedimentFilter]})}}});
define('tau/components/extensions/impedimentList/extension.impedimentList.count.label.setter',["jQuery","tau/components/extensions/component.extension.base"],function(jQuery,ExtensionBase){return ExtensionBase.extend({"bus afterRender+impedimentsCountRetrieved":function(evtArgs){var count=evtArgs.impedimentsCountRetrieved.data.count;count>0&&this.fire("setBadgeText",{text:count})}})});
define('tau/models/impedimentsListPanel/model.impedimentsListPanel.refresher',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var entity=initConfig.config.context.entity,configurator=initConfig.config.context.configurator;configurator.getStore().unbind(this),configurator.getStore().on({type:entity.entityType.name,eventName:"afterSave",listener:this},_.bind(function(evt){_.has(evt.data.changes,"impediments")&&this.fire("refresh")},this))},"bus beforeInit > destroy":function(evt,initConfig){var configurator=initConfig.config.context.configurator;configurator.getStore().unbind(this)}})});
define('tau/components/component.impedimentListPanel',["Underscore","tau/components/component.collapsible","tau/components/extensions/impedimentList/extension.impedimentList.visibilityController","tau/components/extensions/impedimentList/extension.impedimentList.count.label.setter","tau/models/model.impedimentsCountCalculator","tau/models/impedimentsListPanel/model.impedimentsListPanel.refresher","tau/models/model.extensions","tau/models/assignmentsList/extension.model.store.operations","tau/core/termProcessor"],function(_,ComponentCollapsible,VisibilityController,ImpedimentCountLabelSetter,ImpedimentsCountCalculator,ExtensionRefresher,modelExtensions,StoreOperations,TermProcessor){return{create:function(config){var tp=new TermProcessor(config.context.getTerms());return config=config||{},_.extend(config,{collapsed:!0,header:[{type:"label",text:tp.getTerms("Impediment").names,quantityCssClass:config.quantityCssClass||"ui-red-quantity"}],items:[{type:"impedimentList"}],extensions:[VisibilityController,ImpedimentsCountCalculator,StoreOperations,ExtensionRefresher]}),ComponentCollapsible.create(config)}}});
define('tau/models/model.leadCycleTime',["Underscore","tau/core/model-base","tau/utils/utils.date"],function(_,ModelBase,UtilsDate){var Date=UtilsDate.Date,tickPerMinute=6e4,ticksPerHour=tickPerMinute*60,tickPerDay=24*ticksPerHour,modelComments=ModelBase.extend({name:"Lead Cycle Time Model",onInit:function(){var self=this,ctx=self.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,cmdSettings={id:entityId,fields:["leadTime","cycleTime","createDate","startDate","endDate"]};self.store.unbind(self),self.store.on({eventName:"afterSave",type:entityTypeName,fields:["entityState"],listener:self},function(){self.fire("refresh")}),self.store.get(entityTypeName,cmdSettings,{scope:self,success:self.onEntityRetrieved}).done()},getTime:function(timeInterval){var dayLabel="d",minuteLabel="min",hourLabel="h";return this.getTimeWithAbbreviation(timeInterval,dayLabel,hourLabel,minuteLabel)},getTimeWithAbbreviation:function(timeInterval,dayLabel,hourLabel,minuteLabel){timeInterval*=tickPerDay;if(timeInterval<ticksPerHour)return(timeInterval/tickPerMinute).toFixed(0)+minuteLabel;if(timeInterval<tickPerDay)return(timeInterval/ticksPerHour).toFixed(0)+hourLabel;var day=parseInt(timeInterval/tickPerDay);timeInterval%=tickPerDay;var hours=(timeInterval/ticksPerHour).toFixed(0);return day+dayLabel+" "+(hours>0?hours+hourLabel:"")},convertDayToMinutes:function(days){return days*24*60},getLongTime:function(timeInterval){return this.getTimeWithAbbreviation(timeInterval," days"," hours"," minutes")},onEntityRetrieved:function(result){var entity=result.data,startDate=UtilsDate.parse(entity.startDate),createDate=UtilsDate.parse(entity.createDate),endDate=UtilsDate.parse(entity.endDate),dataFormatString="dd MMM yy",endDateLabel=endDate?"End Date":"Today";endDate=endDate||new Date;var leadTime=entity.leadTime,data={leadTime:this.getTime(leadTime),leadTimeTooltip:this.getLongTime(leadTime),createDate:createDate.toString(dataFormatString),endDateLabel:endDateLabel,endDate:(endDate||new Date).toString(dataFormatString),id:_.uniqueId()};if(_.isNumber(entity.cycleTime)){var cycleTime=entity.cycleTime;data.cyclePercentage=cycleTime/leadTime,data.cycleTime=this.getTime(cycleTime),data.cycleTimeTooltip=this.getLongTime(cycleTime),data.startDate=(startDate||"").toString(dataFormatString),data.startDate==data.createDate&&(data.startDate="")}else data.cycleTime="",data.cyclePercentage=null;this.fire("dataBind",data)}});return modelComments});
define('tau/models/dataprocessor/model.processor.implementationHistory',["Underscore","tau/core/termProcessor","tau/utils/utils.date/utils.date.wrapper"],function(_,TermProcessor,Date){var extend=function(destination,source,propertyNameList){return _.each(propertyNameList,function(propertyName){propertyName in source&&(destination[propertyName]=source[propertyName])}),destination},HistoryItemsEnhancer=function(historyItems){this._historyItems=historyItems};HistoryItemsEnhancer.enhance=function(historyItems){return(new this(historyItems)).enhance()},HistoryItemsEnhancer.prototype={constructor:HistoryItemsEnhancer,enhance:function(){var _historyItems=this._historyItems;return _historyItems=this._addDateSpan(_historyItems),_historyItems},_addDateSpan:function(historyItems){var itemStateGroups=this._createItemStateGroups(historyItems);return _.each(itemStateGroups,function(stateGroup){var headItemState=_.first(stateGroup).state;headItemState.dateSpan=stateGroup.length}),historyItems},_createItemStateGroups:function(historyItems){var itemStateGroups=[],currentStateName=null,stateGroup=null;return _.each(historyItems,function(item){currentStateName!=item.state.name&&(currentStateName=item.state.name,stateGroup&&itemStateGroups.push(stateGroup),stateGroup=[]),stateGroup.push(item)}),itemStateGroups.push(stateGroup),itemStateGroups}};var HistoryItemsCompressor=function(historyItems){this._historyItems=historyItems};HistoryItemsCompressor.compress=function(historyItems){return(new this(historyItems)).compress()},HistoryItemsCompressor.prototype={constructor:HistoryItemsCompressor,compress:function(){var _historyItems=this._historyItems;return _historyItems=this._compressAssignments(_historyItems),_historyItems=this._compressStates(_historyItems),_historyItems},_compressStates:function(historyItems){var _historyItems=_.select(historyItems,function(item,index){var selector=!0;return this._isItemStateNeedsCompression(item.state)&&this._isItemNeedsCompression(item,index,historyItems)&&(selector=!1),selector},this);return _historyItems},_isItemStateNeedsCompression:function(itemState){return itemState.isInitial||itemState.isFinal||itemState.isPlanned},_isItemNeedsCompression:function(item,index,historyItems){var itemNeedsCompression=!1,prevItem=historyItems[index-1],isItemFirst=!prevItem;if(!isItemFirst){var isItemInNewState=prevItem.state.name!=item.state.name,isItemHasMultipleTransitions=item.transitions>1,isItemHasAssignments=item.assignments,isItemHasRelatedEntities=item.relatedEntities,isItemHasTimeReported=item.spentTime>0;isItemInNewState||!isItemHasMultipleTransitions&&!isItemHasAssignments&&!isItemHasRelatedEntities&&!isItemHasTimeReported&&(itemNeedsCompression=!0)}return itemNeedsCompression},_compressAssignments:function(historyItems){return this._clearDublicatedAssignmentsForState(historyItems),this._mergeIdenticalAssignmentsForItem(historyItems),historyItems},_clearDublicatedAssignmentsForState:function(historyItems){var historyItemsWithExtraAssignments=_.select(historyItems,function(item,index){var selector=!1;if(item.assignments){var prevItem=historyItems[index-1];prevItem&&prevItem.state.name==item.state.name&&this._areAssignmentsTheSame(prevItem.assignments,item.assignments)&&(selector=!0)}return selector},this);_.each(historyItemsWithExtraAssignments,function(item){delete item.assignments})},_mergeIdenticalAssignmentsForItem:function(historyItems){_.each(historyItems,function(item){if(item.assignments){var mergedAssignments=[],map={};_.each(item.assignments,function(assignment){assignment.id in map?map[assignment.id].roles.push(assignment.role):(map[assignment.id]=assignment,assignment.roles=[assignment.role],delete assignment.role,mergedAssignments.push(assignment))}),item.assignments=mergedAssignments}})},_areAssignmentsTheSame:function(assignmentsA,assignmentsB){var assignmentsAIds=_.pluck(assignmentsA,"id").join(""),assignmentsBIds=_.pluck(assignmentsB,"id").join("");return assignmentsAIds==assignmentsBIds}};var ImplementationHistoryDataProcessor=function(inputData){this._inputData=inputData,this._termProcessor=new TermProcessor(inputData.terms)};return ImplementationHistoryDataProcessor.transform=function(inputData){return(new this(inputData)).transform()},ImplementationHistoryDataProcessor.prototype={constructor:ImplementationHistoryDataProcessor,transform:function(){var data={entityStates:this._getEntityStateNames(),historyItems:this._getHistoryItems(),leadTime:this._getLeadTime(),cycleTime:this._getCycleTime()};return data},_getLeadTime:function(){return this._inputData.leadTime},_getCycleTime:function(){return this._inputData.cycleTime},_getHistoryEntries:function(){return this._inputData.response[0].data.statistics.entries},_getAllEntityStatesForProcess:function(){return this._inputData.response[1].data.entityStates},_getAllUsers:function(){return this._inputData.response[2].data},_getAllRoles:function(){return this._inputData.response[3].data},_getEntityStateNames:function(){var entityStates=this._getEntityStates(),sortedEntityStates=this._sortEntityStates(entityStates),entityStateNames=_.map(sortedEntityStates,function(entityState){return entityState.name});return entityStateNames},_getEntityStates:function(){var currentEntityTypeName=this._inputData.entityTypeName,entityStates=_.select(this._getAllEntityStatesForProcess(),function(entityState){return currentEntityTypeName.toLowerCase()==entityState.entityType.name.toLowerCase()});return entityStates},_sortEntityStates:function(entityStates){var sortedEntityStates=_.sortBy(entityStates,function(entityState){var sortRank=entityState.numericPriority;return entityState.isInitial?sortRank=Number.NEGATIVE_INFINITY:entityState.isFinal&&(sortRank=Number.POSITIVE_INFINITY),sortRank}).reverse();return sortedEntityStates},_getHistoryItems:function(){var historyItems=[];return _.each(this._getHistoryEntries(),function(historyEntry){historyItems.push(this._createHistoryItem(historyEntry))},this),historyItems=this._sortHistoryItems(historyItems),historyItems=this._enhanceHistoryItems(historyItems),historyItems=this._compressHistoryItems(historyItems),historyItems},_createHistoryItem:function(historyEntry){var historyItem={date:new Date(Date.parse(historyEntry.date)),spentTime:parseFloat(historyEntry.time),transitions:parseFloat(historyEntry.transitions),state:this._getHistoryEntryState(historyEntry)},relatedEntities=this._getHistoryEntryRelatedEntities(historyEntry);return _.isEmpty(relatedEntities)||(historyItem.relatedEntities=relatedEntities),historyEntry.assignments&&(historyItem.assignments=this._getHistoryEntryAssignments(historyEntry)),historyItem},_getHistoryEntryState:function(historyEntry){var stateInfo=this._getEntityStateInfo(historyEntry.stateId),state=extend({},stateInfo,["name","isInitial","isFinal","isPlanned"]);return stateInfo.role&&(state.roleId=stateInfo.role.id),state},_getEntityStateInfo:function(entityStateId){var entityStateInfo=_.detect(this._getAllEntityStatesForProcess(),function(entityState){return entityStateId==entityState.id});return entityStateInfo},_getHistoryEntryRelatedEntities:function(historyEntry){var entities=extend({},historyEntry,["opened","closed"]);return this._setEntityAlias(entities.opened),this._setEntityAlias(entities.closed),entities},_setEntityAlias:function(entities){_.each(entities,function(entity){var alias=this._getEntityAlias(entity.type);alias&&(entity.alias=alias)},this)},_getEntityAlias:function(entityType){var terms=this._termProcessor.getTerms(entityType);return terms?terms.name:null},_getHistoryEntryAssignments:function(historyEntry){var assignments=[];return _.each(historyEntry.assignments,function(assignment){var userInfo=this._getUserInfo(assignment.userId);userInfo&&assignments.push({id:assignment.userId,firstName:userInfo.firstName,lastName:userInfo.lastName,role:{id:parseInt(assignment.roleId),name:this._roleIdToName(assignment.roleId)}})},this),assignments},_getUserInfo:function(id){var userInfo=null,user=_.detect(this._getAllUsers(),function(user){return id==user.id});return user&&(userInfo=extend({},user,["firstName","lastName"])),userInfo},_roleIdToName:function(id){var role=_.detect(this._getAllRoles(),function(role){return id==role.id});return role.name},_sortHistoryItems:function(historyItems){return _.sortBy(historyItems,function(item){return new Date(Date.parse(item.date))})},_enhanceHistoryItems:function(historyItems){return HistoryItemsEnhancer.enhance(historyItems)},_compressHistoryItems:function(historyItems){return HistoryItemsCompressor.compress(historyItems)}},ImplementationHistoryDataProcessor});
define('tau/models/model.implementationHistory',["Underscore","tau/models/model.leadCycleTime","tau/models/dataprocessor/model.processor.implementationHistory"],function(_,ModelBase,dataProcessor){return ModelBase.extend({onInit:function(){var context=this.config.context,entityType="implementationHistory",entityId=this.config.context.entity.id;this.store.evictProperties(entityId,"implementationHistory",["statistics"]),this.store.get(entityType,{id:context.entity.id,fields:["id","statistics"]}).get("process",{id:context.getProcessId(),nested:!0,fields:[{entityStates:["id","name","isInitial","isFinal","isPlanned","numericPriority",{entityType:["id","name"]},{role:["id"]}]}]}).get("user",{fields:["id","firstName","lastName"]}).get("roles",{fields:["id","name"]}).get(this.config.context.entity.entityType.name,{id:entityId,fields:["leadTime","cycleTime"]}).done({scope:this,success:this.onDone}),this.store.unbind(this),this._bindToStoreChanges()},_bindToStoreChanges:function(){this._bindToStoreAfterSafe(),this._bindToStoreAfterRemove()},_bindToStoreAfterSafe:function(){this.store.on({eventName:"afterSave",type:this.config.context.entity.entityType.name,listener:this,filter:{id:this.config.context.entity.id},hasChanges:["entityState"]},this._getOnStoreChangesProxy()),_.each(this._getStoreObservableEntityTypes(),function(entityType){this.store.on({eventName:"afterSave",type:entityType,listener:this},this._getOnStoreChangesProxy())},this)},_bindToStoreAfterRemove:function(){_.each(this._getStoreObservableEntityTypes(),function(entityType){this.store.on({eventName:"afterRemove",type:entityType,listener:this},this._getOnStoreChangesProxy())},this)},_getStoreObservableEntityTypes:function(){if(!this._storeObservableEntityTypes){var entityList=["assignment","impediment"];switch(this.config.context.entity.entityType.name){case"userstory":entityList.push("task","bug");break;case"feature":entityList.push("userstory");break;case"request":entityList.push("feature","userstory","task","bug")}this._storeObservableEntityTypes=entityList}return this._storeObservableEntityTypes},_onStoreChanges:function(evt){this.store.evictProperties(this.config.context.entity.id,"implementationHistory",["statistics"]),this.fire("afterUpdate")},_getOnStoreChangesProxy:function(){return this._onStoreChangesProxy||(this._onStoreChangesProxy=_.bind(this._onStoreChanges,this)),this._onStoreChangesProxy},shouldShowLeadCycleTimes:function(){var entityType=this.config.context.entity.entityType.name;return["userstory","bug","feature"].indexOf(entityType.toLowerCase())!=-1},onDone:function(response){if(!this.config)return;var cycleTime=response[4].data.cycleTime,cycleMinutes=this.convertDayToMinutes(cycleTime).toFixed(0),times={};this.shouldShowLeadCycleTimes()&&(times={leadTime:this.getLongTime(response[4].data.leadTime),cycleTime:cycleMinutes>0?this.getLongTime(cycleTime):null});var data=dataProcessor.transform(_.extend({response:response,entityTypeName:this.config.context.entity.entityType.name,terms:this.config.context.getTerms()},times));this.fire("dataBind",data)}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.dateRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date"],function(_,$,ComponentExtensionBase,dateUtils){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){var $historyItems=this._$element.find(".tau-historyGrid td.tau-historyItem");_.each(this._data.historyItems,function(historyItem,index){var $historyItem=$historyItems.eq(index),$dateContainer=$historyItem.find(".tau-date"),$day=$("<span/>").addClass("tau-day"),$month=$("<span/>").addClass("tau-month");$day.text(dateUtils.formatAs(historyItem.date,"dd")),$month.text(dateUtils.formatAs(historyItem.date,"MMM")),$dateContainer.attr("title",dateUtils.format.date.short(historyItem.date)).append($day,$month)})}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.stateProgressRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){this._createFlowIndicators(),this._connectMarkers(),this.fire("stateProgressRendered")},_createFlowIndicators:function(){var $historyItems=this._$element.find(".tau-historyGrid .tau-historyItem");_.each(this._data.historyItems,function(historyItemData,index){this._markProgressStep($historyItems.eq(index),historyItemData)},this)},_getHistoryItemStateIndex:function(historyItemState){return _.indexOf(this._data.entityStates,historyItemState)},_getFlowType:function(historyItemData){var flowType="NORMAL";return historyItemData.state.isFinal?flowType="DONE":this._isUnderImpediment(historyItemData)?flowType="IMPEDIMENT":historyItemData.transitions>1&&(flowType="MULTITRANS"),flowType},_isUnderImpediment:function(historyItem){var underImpediment=_.any(this._getImpedimentRangeList(),function(impedimentRange){return this._isInImpedimentRange(historyItem,impedimentRange)},this);return underImpediment},_getImpedimentRangeList:function(){if(!this._impedimentRangeList){this._impedimentRangeList=[];var allImpediments=this._getAllImpediments();_.each(allImpediments.opened,function(openedImpedimentDate,openedImpedimentId){this._impedimentRangeList.push({start:openedImpedimentDate,end:allImpediments.closed[openedImpedimentId]||Number.POSITIVE_INFINITY})},this),this._impedimentRangeList.sort(function(rangeA,rangeB){return rangeB.end-rangeB.start-(rangeA.end-rangeA.start)})}return this._impedimentRangeList},_getAllImpediments:function(){var allImpediments={opened:{},closed:{}};return _.each(this._data.historyItems,function(item){item.relatedEntities&&(_.each(item.relatedEntities.opened,function(openedEntity){this._isImpediment(openedEntity)&&(allImpediments.opened[openedEntity.id]=item.date)},this),_.each(item.relatedEntities.closed,function(closedEntity){this._isImpediment(closedEntity)&&(allImpediments.closed[closedEntity.id]=item.date)},this))},this),allImpediments},_isImpediment:function(entity){return entity.type.toLowerCase()=="impediment"},_isInImpedimentRange:function(historyItem,impedimentRange){return historyItem.date>=impedimentRange.start&&historyItem.date<=impedimentRange.end},_markProgressStep:function($historyItem,historyItemData){var historyItemStateIndex=this._getHistoryItemStateIndex(historyItemData.state.name),flowType=this._getFlowType(historyItemData),$flowIndicator=this._createFlowIndicator(flowType),dateSpan=historyItemData.state.dateSpan;dateSpan&&!historyItemData.state.isFinal&&$("<span/>").addClass("datespan").text(dateSpan).attr("title",dateSpan+" days in this state").appendTo($flowIndicator),$historyItem.find(".tau-progressSteps .tau-step:nth-child("+(historyItemStateIndex+1)+") .tau-marker").append($flowIndicator)},_createFlowIndicator:function(flowType){var $flow=$("<div/>").addClass("tau-flow");switch(flowType){case"NORMAL":$flow.addClass("tau-normal");break;case"MULTITRANS":$flow.addClass("tau-transitions");break;case"IMPEDIMENT":$flow.addClass("tau-impediment");break;case"DONE":$flow.addClass("tau-done")}return $flow},_connectMarkers:function(){_.each(this._data.historyItems,function(historyItemData,historyItemIndex){var historyItemStateIndex=this._getHistoryItemStateIndex(historyItemData.state.name);this._connect(historyItemIndex,historyItemStateIndex,historyItemIndex-1,"in"),this._connect(historyItemIndex,historyItemStateIndex,historyItemIndex+1,"out")},this)},_connect:function(historyItemIndex,historyItemStateIndex,altHistoryItemIndex,connectionType){var altHistoryItemData=this._data.historyItems[altHistoryItemIndex];if(altHistoryItemData){var altHistoryItemStateIndex=this._getHistoryItemStateIndex(altHistoryItemData.state.name),indexDelta=historyItemStateIndex-altHistoryItemStateIndex;indexDelta>0&&this._$element.find(".tau-historyGrid .tau-historyItem").eq(historyItemIndex).find(".tau-progressSteps .tau-step").filter(function(index){return index>=altHistoryItemStateIndex+1&&index<=historyItemStateIndex}).find(".tau-marker").addClass("tau-"+connectionType)}}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.stateHistogramRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){var stateDateItemsHash=this._createStateDateItemsHash();this._$element.find(".tau-historyGridInterpretation .stateName").each(function(index,state){var $state=$(state),stateInfo=stateDateItemsHash[$state.text()],title=$state.attr("title")+" ("+stateInfo.absolute+" days)";$state.attr("title",title).addClass("tau-dateItems-"+stateInfo.relative)})},_createStateDateItemsHash:function(){var hash={};return _.each(this._data.entityStates,function(stateName){hash[stateName]={absolute:0,relative:0}}),this._calculateAbsoluteHashValues(hash),this._calculateRelativeHashValues(hash),hash},_calculateAbsoluteHashValues:function(hash){_.each(this._data.historyItems,function(item){var dateSpan=item.state.dateSpan;dateSpan&&(hash[item.state.name].absolute+=dateSpan)})},_calculateRelativeHashValues:function(hash){var maxValue=_.max(hash,function(dateItemsCount){return dateItemsCount.absolute}).absolute;_.each(hash,function(dateItemsCount,stateName){var relativeCount=dateItemsCount.absolute*100/maxValue;hash[stateName].relative=Math.round(relativeCount/10)*10})}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.timeLoadRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){if(this._timeLoadWasReported()){var maxSpentTime=this._calculateMaxSpentTime(),$historyItems=this._$element.find(".tau-historyGrid td.tau-historyItem");_.each(this._data.historyItems,function(historyItem,index){var actualSpentTime=historyItem.spentTime,$timeLoadIndicator=$historyItems.eq(index).find(".tau-date"),relatedSpentTime=this._calculateRelatedRoundedSpentTime(maxSpentTime,actualSpentTime);if(!isNaN(relatedSpentTime)){var title=$timeLoadIndicator.attr("title");$timeLoadIndicator.addClass("tau-timeLoad-"+relatedSpentTime).attr("title",title+" ("+actualSpentTime+" hours)")}},this)}},_timeLoadWasReported:function(){return _.any(this._data.historyItems,function(historyItem){return historyItem.spentTime>0})},_calculateMaxSpentTime:function(){return _.max(this._data.historyItems,function(historyItem){return historyItem.spentTime}).spentTime},_calculateRelatedRoundedSpentTime:function(maxSpentTime,actualSpentTime){var relatedValue=actualSpentTime*100/maxSpentTime,roundedValue=Math.round(relatedValue/10)*10;return roundedValue}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.relatedEntitiesRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){var entityTemplateFactory={create:function(entityInfo,isClosed){return $("<a></a>").addClass(this._createClassName(entityInfo,isClosed)).attr("href","#"+entityInfo.type+"/"+entityInfo.id).attr("title",this._createTitle(entityInfo,isClosed)).data("entityInfo",{id:entityInfo.id,type:entityInfo.type,alias:entityInfo.alias||entityInfo.type})},_createTitle:function(entityInfo,isClosed){var title=["["+(entityInfo.alias||entityInfo.type)+"]"," #"+entityInfo.id,entityInfo.name,isClosed?"(closed)":"(added)"].join(" ");return title},_createClassName:function(entityInfo,isClosed){var className=["tau-entity","tau-"+entityInfo.type.toLowerCase(),isClosed?"tau-closed":""].join(" ");return className}};return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){var $historyItems=this._$element.find(".tau-historyGrid .tau-historyItem");_.each(this._data.historyItems,function(historyItem,index){var $entityContainer=$historyItems.eq(index).find(".tau-relatedEntities");historyItem.relatedEntities&&(_.each(historyItem.relatedEntities.opened,function(entity){$entityContainer.append(entityTemplateFactory.create(entity))}),_.each(historyItem.relatedEntities.closed,function(entity){$entityContainer.append(entityTemplateFactory.create(entity,!0))}))})}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.assignmentsRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender+stateProgressRendered":function(evt){this._$element=evt.afterRender.data.element,this._data=evt.afterRender.data.data,this._render()},_render:function(){var $historyItems=this._$element.find(".tau-historyGrid .tau-historyItem");_.each(this._data.historyItems,function(historyItem,index){historyItem.assignments&&!historyItem.state.isFinal&&$('<div class="tau-assignments"/>').insertAfter($historyItems.eq(index).find(".tau-flow")).append(this._getAssignments(historyItem))},this)},_getAssignments:function(historyItem){var assignments=[];return _.each(historyItem.assignments,function(assignment){var avatarTitle=[assignment.firstName,assignment.lastName,"("+this._getAssignmentRoles(assignment)+")"].join(" "),avatarUrl=this.config.context.configurator.getApplicationPath()+"/Avatar.ashx?UserId="+assignment.id+"&size=50",activeClass=this._isActiveAssignment(assignment,historyItem)?' class="active"':"";assignments.push("<img"+activeClass+' alt="avatar" title="'+avatarTitle+'" src="'+avatarUrl+'"/>')},this),assignments.join("")},_getAssignmentRoles:function(assignment){return _.map(assignment.roles,function(role){return role.name}).join(", ")},_isActiveAssignment:function(assignment,historyItem){return _.any(assignment.roles,function(role){return role.id==historyItem.state.roleId})}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.statsRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render()},_render:function(){var $stats=$('<div class="tau-historyStats"/>'),$table=$(["<table>","<tbody>",'<tr style="display: ',this._calculateCycleTime()?"":"none",'" >',"<td>Cycle Time:</td>","<td>"+this._calculateCycleTime()+"</td>","</tr>",'<tr style="display: ',this._calculateLeadTime()?"":"none",'">',"<td>Lead Time:</td>","<td>"+this._calculateLeadTime()+"</td>","</tr>","</tbody>","</table>"].join(""));(this._calculateCycleTime()||this._calculateLeadTime())&&$stats.append($table).appendTo(this._$element)},_calculateLeadTime:function(){return this._data.leadTime},_calculateCycleTime:function(){return this._data.cycleTime}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.legendRenderer',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","tau/utils/utils.storage","tau/utils/utils.date/utils.date.wrapper"],function(_,$,ComponentExtensionBase,dateUtils,storage,Date){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$element=evt.data.element,this._data=evt.data.data,this._render(),this._bindEvents()},_render:function(){var $legendContainer=$('<div class="tau-legend"></div>'),$legendTitle=$('<h3><span class="tau-legendToggler">Legend</span></h3>');$legendContainer.append($legendTitle,this._createGroups()),this._setState($legendContainer),$legendContainer.appendTo(this._$element)},_createGroups:function(){var $groupsContainer=$('<div class="tau-groups"></div>');this._createGroupElement("Progress Flow",this._getProgressFlowTypes()).appendTo($groupsContainer);var relatedEntitiesTypes=this._getRelatedEntitiesTypes();return relatedEntitiesTypes&&this._createGroupElement("Related Entities",relatedEntitiesTypes).appendTo($groupsContainer),this._createGroupElement("Histograms",this._getHistogramTypes()).appendTo($groupsContainer),$groupsContainer},_createGroupElement:function(groupTitle,groupItems){var $group=$("<dl/>"),$groupTitle=$("<dt/>").text(groupTitle);return $group.append($groupTitle),_.each(groupItems,function(item){var $groupItem=$("<dd/>"),$glyph=$(item.element).addClass("glyph");$groupItem.text(item.description),$groupItem.prepend($glyph),$group.append($groupItem)}),$group},_getProgressFlowTypes:function(){var $flowElements=this._$element.find(".tau-historyGrid .tau-historyItem .tau-flow"),flowTypesHash={};_.each($flowElements,function(flow){var className=$.trim(flow.className.replace("tau-flow",""));className in flowTypesHash||(flowTypesHash[className]=$(flow).clone().empty().removeAttr("title"))});var flowTypes=_.map(flowTypesHash,function($flow,flowType){var flowInfo={element:$flow};switch(flowType){case"tau-normal":flowInfo.description="normal flow";break;case"tau-transitions":flowInfo.description="multiple state transitions";break;case"tau-impediment":flowInfo.description="impediment";break;case"tau-done":flowInfo.description="final state"}return flowInfo});return flowTypes},_getRelatedEntitiesTypes:function(){var relatedEntitiesTypes=null,$relatedEntities=this._$element.find(".tau-historyGrid .tau-historyItem .tau-entity");if($relatedEntities.size()>0){var entityTypesHash={};_.each($relatedEntities,function(entity){var className=$.trim(entity.className.replace(/tau-entity|tau-closed/g,""));className in entityTypesHash||(entityTypesHash[className]=$(entity).clone(!0).unbind().removeAttr("title"))});var entityTypes=_.map(entityTypesHash,function($entity,entityType){return{element:$entity,description:$entity.data("entityInfo").alias}});relatedEntitiesTypes=[{element:$('<div class="tau-entity"></div>'),description:"entity (added)"},{element:'<div class="tau-entity tau-closed"></div>',description:"entity (closed)"}].concat(entityTypes)}return relatedEntitiesTypes},_getHistogramTypes:function(){var histogramTypes=[];return histogramTypes.push({element:this._getElementForStateHistogram(),description:"total days in entity state"}),this._timeLoadWasReported()&&histogramTypes.push({element:this._getElementForTimeLoadHistogram(),description:"daily total spent time"}),histogramTypes},_getElementForStateHistogram:function(){var $element=$(['<div class="tau-historyGridInterpretation">','<div class="stateName tau-dateItems-50">',"<span>State name</span>","</div>","</div>"].join(""));return $element},_timeLoadWasReported:function(){return _.any(this._data.historyItems,function(historyItem){return historyItem.spentTime>0})},_getElementForTimeLoadHistogram:function(){var date=new Date(0),$element=$(['<div class="tau-date tau-timeLoad-50">','<span class="tau-day">'+dateUtils.formatAs(date,"dd")+"</span>",'<span class="tau-month">'+dateUtils.formatAs(date,"MMM")+"</span>","</div>"].join(""));return $element},_setState:function($legendContainer){this._isCollapsed()&&this._collapse($legendContainer)},_bindEvents:function(){this._$element.find(".tau-legend .tau-legendToggler").click($.proxy(this,"_toggleState"))},_toggleState:function(evt){var $legend=$(evt.currentTarget).parents(".tau-legend");this._isCollapsed()?this._uncollapse($legend):this._collapse($legend)},_isCollapsed:function(){return storage.get("implementationHistoryLegendState")=="collapsed"},_uncollapse:function($legend){storage.remove("implementationHistoryLegendState"),$legend.removeClass("tau-collapsed")},_collapse:function($legend){storage.set("implementationHistoryLegendState","collapsed"),$legend.addClass("tau-collapsed")}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.historyGridScroller',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){evt.data.element.find(".tau-historyGrid").mousewheel($.proxy(this,"_onMouseWheel"))},_onMouseWheel:function(evt,delta){var targetElement=evt.currentTarget;if(this._isScrollActive(targetElement)){evt.preventDefault();var $el=$(targetElement),currentScrollOffset=$el.scrollLeft(),newScrollOffset=currentScrollOffset+ -delta*100;$el.scrollLeft(newScrollOffset)}},_isScrollActive:function(element){return element.scrollWidth>element.offsetWidth}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.relatedEntitiesHighlighter',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ComponentExtensionBase){return ComponentExtensionBase.extend({"bus afterRender":function(evt){this._$relatedEntities=evt.data.element.find(".tau-relatedEntities .tau-entity"),this._$relatedEntities.hover($.proxy(this,"_onHoverIn"),$.proxy(this,"_onHoverOut"))},_getRelatedEntities:function(entity){var referenceEntityId=$(entity).data("entityInfo").id;return this._$relatedEntities.filter(function(){return referenceEntityId==$(this).data("entityInfo").id})},_onHoverIn:function(evt){this._getRelatedEntities(evt.currentTarget).addClass("tau-highlight")},_onHoverOut:function(evt){this._getRelatedEntities(evt.currentTarget).removeClass("tau-highlight")}})});
define('tau/components/extensions/implementationHistory/component.implementationHistory.updateOverlay',["jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/overlay/ui.behaviour.overlay"],function($,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=this._$element=evt.data.element;setTimeout(function(){var $grid=$el.find(".tau-historyGrid"),$lastHistoryItem=$grid.find(".tau-historyItem:last");$($grid).scrollTo($lastHistoryItem,1e3,{axis:"x",easing:"easeOutQuart"})},500)},"bus afterUpdate":function(evt){this._$element.tauOverlay(),this.fire("refresh")}})});
define('tau/ui/templates/implementationHistory/ui.template.implementationHistoryItem',["tau/core/templates-factory"],function(templates){var config={name:"implementationHistoryItem",options:{},dependencies:[],markup:['<td class="tau-historyItem">','<div class="tau-progressSteps">',"{{each(index, step) $item.parent.data.entityStates}}",'<div class="tau-step">','<div class="tau-marker"/>',"</div>","{{/each}}","</div>",'<div class="tau-date"></div>','<div class="tau-relatedEntities"></div>',"</td>"].join("")};return templates.register(config)});
define('tau/ui/templates/implementationHistory/ui.template.implementationHistory',["tau/core/templates-factory","tau/ui/templates/implementationHistory/ui.template.implementationHistoryItem"],function(templateFactory){var config={name:"implementationHistory",options:{},dependencies:["implementationHistoryItem"],markup:['<div class="tau-implementationHistory">','<div class="tau-historyGridInterpretation">',"{{each(index, stateName) entityStates}}",'<div class="stateName" title="${stateName}">',"<span>${stateName}</span>","</div>","{{/each}}","<div>Date</div>","<div>Related Entities</div>","</div>",'<div class="tau-historyGrid">',"<table>","<tbody>","<tr>",'{{tmpl(historyItems) "implementationHistoryItem"}}',"</tr>","</tbody>","</table>","</div>","</div>"].join("")};return templateFactory.register(config)});
define('tau/components/component.implementationHistory',["tau/components/component.creator","tau/models/model.implementationHistory","tau/components/extensions/implementationHistory/component.implementationHistory.dateRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.stateProgressRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.stateHistogramRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.timeLoadRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.relatedEntitiesRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.assignmentsRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.statsRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.legendRenderer","tau/components/extensions/implementationHistory/component.implementationHistory.historyGridScroller","tau/components/extensions/implementationHistory/component.implementationHistory.relatedEntitiesHighlighter","tau/components/extensions/implementationHistory/component.implementationHistory.updateOverlay","tau/ui/templates/implementationHistory/ui.template.implementationHistory"],function(creator,Model,dateRenderer,stateProgressRenderer,stateHistogramRenderer,timeLoadRenderer,relatedEntitiesRenderer,assignmentsRenderer,statsRenderer,legendRenderer,historyGridScroller,relatedEntitiesHighlighter,updateOverlay,template){return{create:function(config){var _config=config||{},creatorConfig={extensions:[Model,dateRenderer,stateProgressRenderer,stateHistogramRenderer,timeLoadRenderer,relatedEntitiesRenderer,assignmentsRenderer,statsRenderer,legendRenderer,historyGridScroller,relatedEntitiesHighlighter,updateOverlay],template:template};return creator.create(creatorConfig,_config)}}});
define('tau/models/common/model.common.events',["Underscore","tau/core/extension.base"],function(_,ModelBase){var model=ModelBase.extend({"bus beforeInit":function(evt,initData){var context=initData.config.context;this.fire("configurator.ready",context.configurator),this.fire("entity.ready",context.entity)},"bus afterRender":function(evt,renderData){this.fire("$el.ready",renderData.element)}});return model});
define('tau/models/inviter/model.inviter',["Underscore","tau/core/extension.base"],function(_,ModelBase){var model=ModelBase.extend({"bus beforeInit + activeTab.ready":function(evt,initData,activeTab){this.fire("dataBind",{activeTab:activeTab})}});return model});
define('tau/models/inviter/model.inviter.add',["Underscore","tau/core/extension.base","tau/libs/inviter/inviter"],function(_,BaseModel,Inviter){return BaseModel.extend({"bus configurator.ready:last + form.submitted":function(evt,configurator,formData){var self=this,inviter=new Inviter(configurator);inviter.invite(formData.members).done(function(members){self.fire("members.saved",members)})},"bus configurator.ready:last + entity.ready:last + members.saved":function(evt,configurator,entity,members){var self=this,store=configurator.getStore(),entityType=entity.entityType.name,entityMembers=entityType+"Members",failed=_.compact(_.pluck(members,"failure"));failed.length&&this.fire("team.add.nonFatalFailure","Can't assign users.");var succeeded=_.compact(_.pluck(members,"success")),setData={};setData[entityMembers]=_.map(succeeded,function(id){return{user:{id:id}}});var fields=["id","name"];fields.push(entityType==="team"?"icon":"color");var memberFields={};memberFields[entityMembers]=[{user:["id","firstName","lastName","avatarUri"]},{role:["id","name"]}],fields.push(memberFields),store.save(entityType,{id:entity.id,$set:setData,fields:fields}).done(function(res){self.fire("members.connected",res[0].data)})},"bus entity.ready:last + members.saved + members.connected":function(evt,teamSimple,members,teamFull){this.fire("invitation.success",teamFull)}})});
define('tau/ui/extensions/inviter/ui.extension.inviter.form',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){this.fire("$form.ready",$el.find(".i-role-form"))},"bus $form.ready":function(evt,$form){var self=this;$form.on("submit",function(e){e.preventDefault();var data={};data.members=[],$form.find(".i-role-members-widget").trigger("process");var $members=$form.find(".i-role-member");$members.each(function(){data.members.push($(this).data())}),self.fire("form.submitted",data)})},"bus configurator.ready:last + $form.ready:last + invitation.success":function(evt,configurator,$form,data){$form.trigger("reset")}})});
define('tau/ui/extensions/inviter/ui.extension.inviter.widget',["Underscore","jQuery","tau/ui/extensions/inviter/ui.extension.inviter.widget.abstract"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(evt,configurator){this._initTemplates(configurator)},"bus configurator.ready + $el.ready + entity.ready":function(evt,configurator,$section,entity){var entityType=entity.entityType.name,entityMembers=entityType+"Members",entityRestriction=" AND "+entityMembers+".count("+entityType+".id="+entity.id+")==0 ";this._initWidget(configurator,$section,entityRestriction)}})});
define('tau/ui/templates/inviter/ui.template.inviter',["tau/core/templates-factory","tau/ui/templates/inviter/ui.template.inviter.widget.members"],function(templates){var config={name:"inviter",engine:"jqote2",markup:['<div class="tau-team-control">','<div class="tau-actions i-role-tabheaders">','<div class="tau-new-team i-role-tabheader <% if (this.activeTab == "add"){ %> tau-active <% } %>" data-tab="add">',"<span></span>Invite people","</div>","</div>",'<div class="tau-tab-content">','<div class="tau-tab-pane tau-new-entity-holder  i-role-tab-add  <% if (this.activeTab == "add"){ %> tau-active <% } %> ">','<form class="tau-new-item_active_false i-role-form">','<div class="tau-new-entity-form">','<div class="tau-invite-widget">','<%= fn.sub("inviter.widget.members") %>','<div class="tau-invite-footer">','<button class="tau-btn tau-success" type="submit">Invite people</button>',"</div>","</div>","</div>","</form>","</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.inviter',["tau/components/component.creator","tau/models/common/model.common.events","tau/models/inviter/model.inviter","tau/models/inviter/model.inviter.add","tau/ui/extensions/tabs/ui.extension.tabs.modern","tau/ui/extensions/inviter/ui.extension.inviter.form","tau/ui/extensions/inviter/ui.extension.inviter.widget","tau/components/extensions/error/extension.errorBar","tau/ui/templates/inviter/ui.template.inviter"],function(ComponentCreator,ModelCommonEvents,ModelMain,ModelAdd,ExtensionTabs,ExtensionAddForm,ExtensionAddWidget,ExtensionError,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ModelCommonEvents,ModelMain,ModelAdd,ExtensionTabs,ExtensionAddForm,ExtensionAddWidget,ExtensionError],template:Template};return ComponentCreator.create(creatorConfig,config)}}});
define('tau/ui/templates/common/ui.template.attributeValue',["tau/core/templates-factory"],function(templates){var config={name:"common-attributeValue",markup:['<span class="attr-item popup-target"><span class="attr-name">${name}</span></span>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/progressBar/ui.template.iteration.progressBar',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/common/ui.template.attributeValue"],function(templates,termTag){var config={name:"iteration-progress-bar",tags:[termTag],markup:['<div class="entity-progress-box">','   <div class="ui-progressbar__data">','      <span class="ui-label-completed">Completed&nbsp;<b class="value">${effortCompleted}${point}</b></span>','      <span class="ui-label-todo">ToDo&nbsp;<b class="value">${effortToDo}${point}</b></span>',"   </div>",'   <div class="ui-progress-bar-progress ui-progressbar__progress">',"{{if percentCompleted !== 0 }}",'      <span class="ui-progress-progress ui-progressbar__progress__indicator" style="width:${ Math.round(percentCompleted) < 15 ? 15 : Math.round(percentCompleted) }%;">','         <span class="ui-label ui-progressbar__progress__label"><b class="value">${ Math.round(percentCompleted) }%</b></span>',"      </span>","{{/if}}","   </div>","</div>"],dependencies:["common-attributeValue"]};return templates.register(config)});
define('tau/components/component.iteration.progressBar',["tau/components/component.creator","tau/models/model.iteration.progressBar","tau/ui/templates/progressBar/ui.template.iteration.progressBar"],function(creator,ModelIterationProgressBar,template){return{create:function(config){var creatorConfig={extensions:[ModelIterationProgressBar],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.label',["Underscore","tau/core/model-base"],function(_,baseModel){var _calculateCounts=function(fields,callbackInfo){},labelModel=baseModel.extend({onInit:function(){this.store.unbind(this);var dataToBind={text:this.config.text};this.config.cssClass&&(dataToBind.cssClass=this.config.cssClass),this.bus.fire("dataBind",dataToBind);var getBadgeText=this.config.getBadgeText;typeof getBadgeText=="function"&&(this.fire("beforeGetBadgeText",{prevValue:this.badgeText}),getBadgeText.call(this,{callback:this.onBadgeTextRetrieved,scope:this}));var fields=this.getCollectionFileds();if(_.isArray(fields)&&fields.length>0){var entityId=this.config.context.entity.id,typeName=this.config.context.entity.entityType.name||"general",changes=fields.join("|");this.config.store.on({type:typeName,eventName:"afterSave",hasChanges:[changes],filter:{id:entityId},listener:this},_.bind(this.onEntityChanged,this)),this.calculateCount()}},onEntityChanged:function(){var entityId=this.config.context.entity.id,typeName=this.config.context.entity.entityType.name||"general";this.config.store.evictProperties(entityId,typeName,_.map(this.getCollectionFileds(),function(val){return val+"-count"})),this.calculateCount()},calculateCount:function(){var self=this,ctx=self.config.context,type=ctx.entity.entityType.name,copyFields=[],fields=this.config.countFieldNames;for(var i=0;i<fields.length;i++)copyFields.push(fields[i]+"-count");var cmdSettings={id:ctx.entity.id,fields:copyFields};self.store.get(type,cmdSettings,{success:this.countersRetreived,scope:this}).done()},getCollectionFileds:function(){var fields=_.reject(this.config.countFieldNames,function(fieldName){return fieldName=="id"});return fields},countersRetreived:function(evtData){if(!this.config)return;var fields=this.getCollectionFileds(),data=evtData.data,totalCount=0;for(var i=0;i<fields.length;i++)totalCount+=data[fields[i]+"-count"];this.fire("setBadgeText",{text:totalCount})},onBadgeTextRetrieved:function(data){var text=data[this.config.badgeFieldName];this.badgeText=text,this.bus?this.bus.fire("setBadgeText",{text:text}):this.fire("badgeTextChanged",{text:text})}});return labelModel});
define('tau/ui/templates/label/ui.template.label',["tau/core/templates-factory","tau/ui/tags/ui.tag.implode"],function(templates,implodeTag){var config={name:"label",tags:[implodeTag],markup:['<div><span class="ui-label{{if cssClass}} ${cssClass}{{/if}}">${$item.$tau.text_implode(text)}</span></div>'],dependencies:[]};return templates.register(config)});
define('tau/ui/extensions/label/ui.extension.label',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender:last+setBadgeText":function(evtArgs){this.element=evtArgs.afterRender.data.element,this._getBadgeElement().text(evtArgs.setBadgeText.data.text),this.config.quantityCssClass&&this._getBadgeElement().addClass(this.config.quantityCssClass)},_getBadgeElement:function(){var $badge=this.element.find(".ui-quantity");return $badge.length==0&&($badge=$('<span class="ui-quantity"></span>').appendTo(this.element)),$badge}})});
define('tau/components/component.label',["Underscore","tau/components/component.creator","tau/models/model.label","tau/ui/templates/label/ui.template.label","tau/ui/extensions/label/ui.extension.label"],function(_,creator,ModelType,template,LabelExtension){return{create:function(config){var creatorConfig={ModelType:ModelType,template:config.template||template,extensions:_.clone(config.extensions||[])};return config.hideCounter||creatorConfig.extensions.push(LabelExtension),creator.create(creatorConfig,config)}}});
define('tau/components/extensions/duplicateBugList/extension.duplicateBugList.count.label.setter',["jQuery","tau/components/extensions/component.extension.base"],function(jQuery,ExtensionBase){return ExtensionBase.extend({"bus afterRender+duplicateBugCountRetrieved":function(evtArgs){var count=evtArgs.duplicateBugCountRetrieved.data.count;count>0&&this.fire("setBadgeText",{text:count})}})});
define('tau/components/component.label.duplicateBugCount',["Underscore","tau/components/component.label","tau/components/extensions/duplicateBugList/extension.duplicateBugList.count.label.setter","tau/models/model.duplicateBugCountCalculator","tau/models/model.duplicateBugRetriever","tau/models/model.extensions","tau/models/assignmentsList/extension.model.store.operations","tau/core/termProcessor"],function(_,ComponentCollapsible,DuplicateBugCountLabelSetter,DuplicateBugCountCalculator,DuplicateBugRetriever,modelExtensions,StoreOperations,TermProcessor){return{create:function(config){var terms=config.context.applicationContext.processes[0].terms,tp=new TermProcessor(terms);return config=config||{},_.extend(config,{text:"Duplicate "+tp.getTerms("Bug").names,quantityCssClass:config.quantityCssClass||"ui-gray-quantity",extensions:[DuplicateBugCountLabelSetter,DuplicateBugCountCalculator,StoreOperations,DuplicateBugRetriever]}),ComponentCollapsible.create(config)}}});
define('tau/components/component.label.impedimentsCount',["Underscore","tau/components/component.label","tau/components/extensions/impedimentList/extension.impedimentList.count.label.setter","tau/models/model.impedimentsCountCalculator","tau/models/model.extensions","tau/models/assignmentsList/extension.model.store.operations","tau/core/termProcessor"],function(_,ComponentCollapsible,ImpedimentCountLabelSetter,ImpedimentsCountCalculator,modelExtensions,StoreOperations,TermProcessor){return{create:function(config){var tp=new TermProcessor(config.context.getTerms());return config=config||{},_.extend(config,{text:tp.getTerms("Impediment").names,quantityCssClass:config.quantityCssClass||"ui-red-quantity",extensions:[ImpedimentCountLabelSetter,ImpedimentsCountCalculator,StoreOperations]}),ComponentCollapsible.create(config)}}});
define('tau/components/component.label.relations',["Underscore","tau/components/component.creator","tau/core/templates-factory"],function(_,creator,templates){return{create:function(config){var templateConfig={name:"label-relations",markup:['<div class="tau-relations-item tau-relations-this-entity">','    <div class="tau-entity-caption">',"        <h2>This entity (#${entity.id})</h2>","    </div>",'    <div class="tau-pointer"></div>',"</div>"]},template=templates.register(templateConfig),componentConfig={template:template},component=creator.create(componentConfig,config);return component.on("afterInit",function(e){component.fire("dataBind",{entity:config.context.entity})}),component}}});
define('tau/components/extensions/leadCycleTime/extension.ui.leadCycleTime',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){var addBubble=function(config){var position=null,target=config.target,caption=config.caption,value=config.value;target.click(function(evt){position={x:evt.pageX,y:evt.pageY}}),target.addClass("ui-link").tauBubble({onShow:function(){var popupInner=this.$popup.find(".tau-bubble__inner");if(popupInner.find(".tau-time-interval-header").size()>0)return;popupInner.append(['<div class="tau-time-interval-container">',"<table>","<tr>","   <td>",'       <div class="tau-time-interval-header">',config.caption,":</div>","   </td>","   <td>",'       <div class="tau-time-interval-value">',value,"</div>","   </td>","</tr>","<tr>","   <td>",'       <div class="tau-time-interval-header">',config.startCaption,":</div>","   </td>","   <td>",'       <div class="tau-time-interval-value">',config.startDate,"</div>","   </td>","</tr>","<tr>","   <td>",'       <div class="tau-time-interval-header">',config.endCaption,":</div>","   </td>","   <td>",'       <div class="tau-time-interval-value">',config.endDate,"</div>","   </td>","</tr>","</table>","</div>"].join(""))},alignTo:target,onArrowPositionConfig:function(config){var offset=this.target.offset();return config.offset=position.x-offset.left+" 0",config},onPositionConfig:function(config){var offset=this.target.offset();return config.offset=position.x-offset.left-70+" 0",config},target:target})};return ExtensionBase.extend({extractDataFromEvent:function(evtArgs,eventName){return(evtArgs[eventName]||{}).data||{}},"bus afterRender+dataBind":function(evtArgs){var dataToBind=this.extractDataFromEvent(evtArgs,"dataBind"),element=$(this.extractDataFromEvent(evtArgs,"afterRender").element);addBubble({target:element.find("svg.main-plot rect").eq(4),caption:"Cycle Time",value:dataToBind.cycleTimeTooltip,startCaption:"Start Date",startDate:(dataToBind.startDate||"").length>0?dataToBind.startDate:dataToBind.createDate,endCaption:dataToBind.endDateLabel,endDate:dataToBind.endDate}),addBubble({target:element.find("svg.main-plot rect").eq(0),caption:"Lead Time",value:dataToBind.leadTimeTooltip,startCaption:"Create Date",startDate:dataToBind.createDate,endCaption:dataToBind.endDateLabel,endDate:dataToBind.endDate})}})});
define('tau/ui/templates/leadCycleTime/ui.template.leadCycleTime',["tau/core/templates-factory"],function(templates){var config={name:"lead-cycle-time",options:{contentSelector:".request-list"},markup:['<div class="ui-lead-cycle-time" style="position: relative;">','<div style="position: absolute; top:0px;left: 6.5%;">','   <svg width="30" height="65" style="position: relative;left: -15px;">','       <text x="10" y="55" fill="rgb(174,174,174)" style="font-size: 10px;font-weight: bold;" transform="rotate(-90 10 55)">${createDate}</text>',"   </svg>","</div>","{{if (startDate)}}",'<div style="position: absolute; top:0px;left:{{if (cyclePercentage < 0.9)}} ${83-cyclePercentage*80}{{/if}}{{if (!(cyclePercentage<0.9))}}${86-cyclePercentage*80}{{/if}}%;">','   <svg width="30" height="57">','       <text x="10" y="55" fill="rgb(174,174,174)" style="font-size: 10px;font-weight: bold;" transform="rotate(-90 10 55)">${startDate}</text>',"   </svg>","</div>",'<div style="position:absolute;left:6.5%;top:65px;width:80%; height:4px;">&nbsp;</div>',"{{/if}}",'<div style="position: absolute; ',"{{if (cyclePercentage && cyclePercentage<0.2)}}","top:-5px;left: 91","{{/if}}","{{if (!cyclePercentage || cyclePercentage > 0.2)}}","top:-5px;left: 87","{{/if}}",'%;">','   <svg width="30" height="60" style="position: relative;left: -15px;">','       <text x="10" y="55" fill="rgb(174,174,174)" style="font-size: 10px;font-weight: bold;" transform="rotate(-90 10 55)">${endDateLabel}<tspan  x="10" dy="1.4em">${endDate}</tspan></text>',"   </svg>","</div>",'<div style="position: absolute;left:87.5%;top:51px;">','   <svg width="50" height="50">','    <text x="0" y="11" fill="rgb(70,155,219)" width="50" style="font-size: 10px;font-weight: bold;">${cycleTime}</text>','    <text x="0" y="23" fill="rgb(95,95,95)" style="font-size: 10px;font-weight: bold;">${leadTime}</text>',"   </svg>","</div>",'<svg width="100%" height="80" class="main-plot">',"   <defs>",'   <linearGradient id="cycleTime_${id}" x1="0%" y1="0%" x2="0%" y2="100%">','            <stop offset="0%" style="stop-color:rgb(186,210,239);stop-opacity:1"/>','            <stop offset="100%" style="stop-color:rgb(98,143,198);stop-opacity:1"/>',"        </linearGradient>",'        <linearGradient id="leadTime_${id}" x1="0%" y1="0%" x2="0%" y2="100%">','            <stop offset="0%" style="stop-color:rgb(178,184,194);stop-opacity:1"/>','            <stop offset="100%" style="stop-color:rgb(141,144,152);stop-opacity:1"/>',"        </linearGradient>","    </defs>",'    <rect x="6.5%" y="67" rx="3" ry="3" width="80%" height="5"','          fill="url(#leadTime_${id})" style="cursor: pointer;"/>','    <rect x="6%" y="5" width="1" height="70"','       style="fill:rgb(226,226,227);"/>','    <rect x="86.8%" y="5" width="1" height="70"','          style="fill:rgb(226,226,227);"/>',"{{if (cyclePercentage)}}",'    <rect class="lead-time-rect" x="${86-cyclePercentage*80}%" y="5" width="1" height="60"','       style="fill:rgb(226,226,227);"/>','    <rect x="${86.5-cyclePercentage*80}%" y="58" rx="3" ry="3" width="${cyclePercentage*80}%" height="5" style="cursor: pointer;"','          fill="url(#cycleTime_${id})"/>',"{{/if}}","</svg>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.leadCycleTime',["Underscore","tau/components/component.creator","tau/models/model.leadCycleTime","tau/components/extensions/leadCycleTime/extension.ui.leadCycleTime","tau/ui/templates/leadCycleTime/ui.template.leadCycleTime"],function(_,creator,ModelType,ExtensionLeadCycleTime,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:_.union(config.extensions||[],[ExtensionLeadCycleTime])};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/list_/grid.entity/relation/ui.template.list.grid.entity.row.relation',["tau/core/templates-factory"],function(templates){var config={name:"list-grid-entity__row_relation",markup:["",'<tr class="i-item-${id}{{if entityState && entityState.isFinal}} tau-list__table__row_isfinalstate_true{{/if}}">',"<td>",'<div class="tau-relation-type">','<span runas="property.relationType" data-context:general:id="${relation.id}" data-context:general:entity-type:name="${relation.__type}">${relation.relationType.name}</span>',"</div>","</td>",'<td class="tau-entity-id">','<a class="tau-entitylink" href="${url}" title="${name}">','<em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">${id}</em>',"</a>","</td>",'<td class="tau-entity-name"><span>${name}</span></td>',"<td><span>${project}</span></td>","<td>","{{if entityState}}",'<div runas="property.entityState" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">${entityState.name}</div>',"{{else}}","{{if hasLastStatus}}",'<div runas="property.lastStatus" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">${lastStatus}</div>',"{{/if}}","{{/if}}","</td>","<td><span>${release}</span></td>","<td><span>${iteration}</span></td>","<td>",'<button class="tau-btn tau-attention i-role-action-detach" type="button" data-relation-id="${relation.id}">Remove</button>',"</td>","</tr>"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/request/ui.template.list.grid.entity.row.requester',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__row_requester",markup:["",'<li class="tau-list__list__item tau-list__list__item_requester" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="i-item-${id} tau-list__table__row  ">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-avatar">','{{if avatar}}<img src="${avatar}" class="owner-avatar" />{{/if}}',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-name">','<a href="${url}">',"{{if firstName || lastName}}","${firstName} ${lastName}","{{else}}","${email}","{{/if}}","</a>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-email">','<span class="tau-extension-tooltip" title="Email: ${email}">',"${email}","</span>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-login">','<span class="tau-extension-tooltip" title="Login: ${login}">',"${login}","</span>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-requesteractions">','<button class="action-detach button small" role="action-detach" type="button">Detach</button>',"</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/testcase/ui.template.list.grid.entity.row.testcaserun',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__rowtestcaserun_testcase",markup:["",'<li class="tau-list__list__item tau-list__list__item-testcaserun tau-list__list__item-testcaserun-testcase" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-id">','<a class="tau-entitylink" href="${testplanrun.url}" title="${testplanrun.name}">','<em class="ui-type-icon ui-type-icon-testplanrun">${testplanrun.id}</em>',"</a>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-name">',"${testplanrun.name}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-date">','<span class="tau-extension-tooltip" title="Run Date: ${runDate}">',"${runDate}","</span>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-release">',"{{if release}}",'<span class="tau-extension-tooltip" title="Release: ${release.name}">',"${release.name}","</span>","{{/if}}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-iteration">',"{{if iteration}}",'<span class="tau-extension-tooltip" title="Iteration: ${iteration.name}">',"${iteration.name}","</span>","{{/if}}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-build">',"{{if build}}",'<span class="tau-extension-tooltip" title="Build: ${build.name}">',"${build.name}","</span>","{{/if}}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-laststatus">','<div class="ui-status ',"{{if passed === true}}","ui-status_type_passed green ","{{/if}}","{{if passed === false}}","ui-status_type_failed red ","{{if comment}}tau-extension-tooltip{{/if}}  ","{{/if}}",'{{if passed === null}}ui-status_type_na grey{{/if}}" ',"{{if comment}}",'title="Comment: \n ${comment}"',"{{/if}}",">","{{if runDate !== null}}","{{if passed === true}}","Passed","{{/if}}","{{if passed === false}}","Failed","{{/if}}","{{if passed === null}}","Skipped","{{/if}}","{{/if}}","</div>","</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/user/ui.template.list.grid.entity.row.team',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__rowteam_user",markup:["",'<li class="tau-list__list__item tau-list__list__item-testcaserun tau-list__list__item-testcaserun-testcase" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-name" style=" white-space: nowrap;">',"${team.name}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-role">','<div runas="property.role" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${role.name}","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-entityactions">','<button class="action-detach button small" role="action-detach" type="button" data-confirm-message="Removing person from team  \'${team.name}\' will unassign that person from ALL tasks, stories, bugs, etc. (except for completed). Are you sure you want to proceed?">Remove from team</button>',"</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/user/ui.template.list.grid.entity.row.project',["tau/core/templates-factory"],function(templates){var config={name:"list-grid-entity__rowproject_user",markup:["",'<li class="tau-list__list__item tau-list__list__item-testcaserun tau-list__list__item-testcaserun-testcase" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-name" style="white-space: nowrap;">',"${project.name}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-role">','<div runas="property.role" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${role.name}","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-entityactions">','<button class="action-detach button small" role="action-detach" type="button" data-confirm-message="Removing person from project  \'${project.name}\' will unassign that person from ALL tasks, stories, bugs, etc. (except for completed). Are you sure you want to proceed?">Remove from project</button>',"</td>","</tr>","</tbody>","</table>","</li>"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/project/ui.template.list.grid.entity.row.team',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__rowteam_project",markup:["",'<li class="tau-list__list__item tau-list__list__item-testcaserun tau-list__list__item-testcaserun-testcase" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-name"  style=" white-space: nowrap;">',"${team.name}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-entityactions">','<button class="action-detach button small" role="action-detach" type="button" ',"data-confirm-message=\"Detach project from team  '${team.name}' blablabla. Are you sure you want to proceed?\">Remove from team</button>","</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/team/ui.template.list.grid.entity.row.project',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__rowproject_team",markup:["",'<li class="tau-list__list__item tau-list__list__item-testcaserun tau-list__list__item-testcaserun-testcase" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="tau-list__table__row">','<td class="tau-list__table__cell tau-list__table__cell-name">',"${project.name}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-entityactions">','<button class="action-detach button small" role="action-detach" type="button" ',"data-confirm-message=\"Detach team from team  '${project.name}' blablabla. Are you sure you want to proceed?\">Remove from team</button>","</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/team/ui.template.list.grid.entity.row.member',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.cell.progress","tau/ui/templates/list_/grid.entity/ui.template.cell.assignments","tau/ui/templates/list_/grid.entity/ui.template.cell.name","tau/ui/templates/assignmentsList/ui.template.assignments.mini","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"list-grid-entity__rowmember_team",engine:"jqote2",markup:["",'<li class="tau-list__list__item tau-list__list__item_requester" role="item">','<table class="tau-list__table">',"<tbody>",'<tr class="i-item-${id} tau-list__table__row  ">','<td class="tau-list__table__cell tau-list__table__cell-dragdrop"  role="sortable-handler" ><div class="dragdrop_indicator"></div></td>','<td class="tau-list__table__cell tau-list__table__cell-name">','<a href="${url}">',"${user.name}","</a>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-avatar">',"{{if user.avatarUri}}",'<img src="${user.avatarUri}24" class="owner-avatar" />',"{{/if}}","</td>",'<td class="tau-list__table__cell tau-list__table__cell-login">','<div runas="property.role" data-context:general:id="${id}" data-context:general:entity-type:name="${__type}">',"${role.name}","</div>","</td>",'<td class="tau-list__table__cell tau-list__table__cell-name">','<span class="tau-extension-tooltip" title="Email: ${user.email}">',"${user.email}","</span>","</td>",'<td class="tau-list__table__cell" style="width:20px;">','<span class="property" title="is admin"><div class="ui-checkbox {{if user.isAdmin}}checked{{else}}unchecked{{/if}}">&nbsp;</div></span>',"</td>",'<td class="tau-list__table__cell" style="width:20px;">','<span class="property" title="is active"><div class="ui-checkbox {{if user.isActive}}checked{{else}}unchecked{{/if}}">&nbsp;</div></span>',"</td>",'<td class="tau-list__table__cell tau-list__table__cell-requesteractions">','<button class="action-detach button small" role="action-detach" type="button">Detach</button>',"</td>","</tr>","</tbody>","</table>","</li>"],dependencies:["ui.template.property.effort.content","ui.template.assignments.mini","cell-progress","cell-assignments","cell-name"]};return templates.register(config)});
define('tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.group","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity.row","tau/ui/templates/list_/grid.entity/testplan/ui.template.list.grid.entity.row.testplanrun","tau/ui/templates/list_/grid.entity/testplanrun/ui.template.list.grid.entity.row.testcaserun","tau/ui/templates/list_/grid.entity/userstory/ui.template.list.grid.entity.row.testcase","tau/ui/templates/list_/grid.entity/relation/ui.template.list.grid.entity.row.relation","tau/ui/templates/list_/grid.entity/request/ui.template.list.grid.entity.row.requester","tau/ui/templates/list_/grid.entity/testcase/ui.template.list.grid.entity.row.testcaserun","tau/ui/templates/list_/grid.entity/user/ui.template.list.grid.entity.row.team","tau/ui/templates/list_/grid.entity/user/ui.template.list.grid.entity.row.project","tau/ui/templates/list_/grid.entity/project/ui.template.list.grid.entity.row.team","tau/ui/templates/list_/grid.entity/team/ui.template.list.grid.entity.row.project","tau/ui/templates/list_/grid.entity/team/ui.template.list.grid.entity.row.member","tau/ui/templates/list_/grid.entity/relation/ui.template.list.grid.entity.row.relation","tau/ui/templates/list_/ui.template.list.comment"],function(templates){var config={name:"list-grid-entity",markup:['<div class="tau-list">',"   {{if isEmpty === true}}",'       <div class="tau-list__empty-message">${config.currentView.emptyMessage}</div>',"   {{else}}",'       <div class="tau-list__content">',"           {{if groups && groups.length}}",'               {{tmpl(groups) "list-grid-entity__group"}}',"           {{/if}}","           {{if items && items.length}}",'               <div class="tau-list__group tau-list__group_flat_true" role="group">','                   <ul class="tau-list__list" role="list">',"                       {{tmpl(items) $item.data.config.currentView.rowTemplateName}}","                   </ul>","               </div>","           {{/if}}","       </div>","   {{/if}}",'   <div class="tau-list__comment-holder">','       {{tmpl({}) "list-grid__comment"}}',"   </div>","</div>"],dependencies:["list-grid-entity__group","list-grid-entity__row","list-grid-entity__rowtestplanrun","list-grid-entity__rowtestcaserun","list-grid-entity__rowtestcase","list-grid-entity__row_relation","list-grid-entity__row_requester","list-grid-entity__rowtestcaserun_testcase","list-grid-entity__rowteam_user","list-grid-entity__rowproject_user","list-grid-entity__rowteam_project","list-grid-entity__rowproject_team","list-grid-entity__rowmember_team","list-grid__comment"]};return templates.register(config)});
define('tau/ui/extensions/list/extension.list.editable.progress',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({name:"extension.list.editable.progress",category:"edit","bus afterRender":function(evt){var $el=evt.data.element;$el.addClass("tau-list-editable")}})});
define('tau/components/component.list.editable',["Underscore","tau/components/component.list","tau/ui/templates/list_/grid.entity/ui.template.list.grid.entity","tau/ui/extensions/list/extension.list.editable.progress","tau/views/view.compositeControl"],function(_,ComponentListFactory,listGridEntityTemplate,ExtensionEditableProgress,ViewCompositeControl){return{create:function(config){return config=_(config).defaults({ViewType:ViewCompositeControl,template:config.template||listGridEntityTemplate,extensions:[],dependencies:["title","property.severity","property.priority","property.relationType","property.entityState","assignmentsList","property.effort","entity.actions","progressBar.small","property.release","property.responsible","property.iteration","property.build","property.build.testPlanRun","property.lastStatus","property.lastRunDate.list","property.status.testCaseRun","property.endDate","property.endDate.list","property.role","property.role.modern","steps","success","menu.testPlanRun"]}),config.extensions.push(ExtensionEditableProgress),ComponentListFactory.create(config)}}});
define('tau/ui/templates/ui.template.lookswitcher',["tau/core/templates-factory"],function(templates){var config={name:"ui.lookswitcher",markup:['<div class="ui-lookswitcher tau-look-switcher">','   {{if !loveNewLook }}<a class="ui-lookswitcher-love-link">Always use this awesome UI</a>{{/if}}','   {{if loveNewLook }}<a class="ui-lookswitcher-hate-link">Switch back to the old look</a>{{/if}}',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.lookswitcher',["jQuery","Underscore","tau/configurator","tau/components/component.creator","tau/ui/templates/ui.template.lookswitcher","tau/components/extensions/component.extension.base"],function($,_,conf,creator,template,ExtBase){var c={create:function(config){var SwitcherExt=ExtBase.extend({"bus beforeInit":function(){var self=this,globSettingsService=conf.getGlobalSettingsService();globSettingsService.getGlobalSettings({success:function(r){self.fire("dataBind",{loveNewLook:r.LoveNewLook})}})},execute:function(method,fnCallback){var globalSettingsService=conf.getGlobalSettingsService(),self=this;globalSettingsService.sendRequest("GlobalSettingsService",method,null,function(r){globalSettingsService.resetSettings(),fnCallback&&fnCallback()},function(r){})},"bus feltInLove+afterRender":function(args){var self=this;this.execute("WantToSeeBeatyAlways",function(){self.fire("refresh")})},"bus hateIt+afterRender":function(args){var self=this;self.execute("HateNewLook",function(){document.location.href=conf.getApplicationPath()+"/view.aspx?id="+self.config.context.entity.id})},"bus afterRender":function(args){var self=this,$element=args.data.element,attachHandler=function(lnk,method){$(lnk,$element).click(function(){$(this).unbind(),$(this).addClass("tau-disabled"),$(this).attr("disabled"),self.fire(method)})};attachHandler(".ui-lookswitcher-love-link","feltInLove"),attachHandler(".ui-lookswitcher-hate-link","hateIt")}}),creatorConfig={extensions:[SwitcherExt],template:template};return creator.create(creatorConfig,config)}};return c});
define('tau/views/view.master.board',["Underscore","tau/core/view-base","tau/components/component.board.container","tau/configurations/board.container.config"],function(_,ViewBase,ContainerComponent,PageConfig){return ViewBase.extend({init:function(config){this._super(config)},initialize:function(){},"bus view.dom.ready":function(e){this.container.fire("view.dom.ready",e.data)},"bus beforeInit + boardSettings.ready":function(e,initConfig,bs){var self=this,config=initConfig.config,boardSettings=bs,configurator=initConfig.config.context.configurator,pageConfig=new PageConfig(configurator),containerConfig=_.extend(config,pageConfig.getMasterConfig()),c=self.container=ContainerComponent.create({name:"board page container",layout:containerConfig.layout,template:containerConfig.template,store:config.store,extensions:_.union([],containerConfig.extensions||[]),context:config.context});c.on("afterInit",self["container afterInit"],self),c.on("afterRender",self["container afterRender"],self),c.on("componentsCreated",self["container componentsCreated"],self),c.fire("boardSettings.ready",boardSettings),self.fire("component.ready",c),c.initialize(containerConfig)},"bus component.ready:last > boardSettings.ready":function(e){var component=e["component.ready"].data,boardSettings=e["boardSettings.ready"].data;component.fire("boardSettings.ready",boardSettings)},"container afterInit":function(evt){this.fireAfterInit()},"container componentsCreated":function(evt){this.fire(evt.name,evt.data)},"container afterRender":function(evt){this.fireBeforeRender(),this.element=evt.data.element,this.fireAfterRender()},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.destroyContainer(),this._super()}})});
define('tau/components/component.master.board',["tau/components/component.page.base","tau/views/view.master.board"],function(BaseCreator,ViewType){return{create:function(componentContext){var componentConfig={name:"board page component",turnOffErrorEmiter:!0,extensions:[],ViewType:ViewType};return BaseCreator.create(componentConfig,componentContext)}}});
define('tau/ui/templates/ui.template.empty.container',["tau/core/templates-factory"],function(templates){var config={name:"container.empty.master",engine:"jqote2",markup:["<div>",'<div role="main"></div>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/configurations/empty.container.config',["Underscore","tau/core/class","tau/ui/templates/ui.template.empty.container"],function(_,BaseClass,MainLayoutTemplate){var ConfigClass=BaseClass.extend({getMasterConfig:function(){return{layout:"selectable",template:MainLayoutTemplate,children:[]}}});return new ConfigClass});
define('tau/views/view.master.empty',["Underscore","tau/core/view-base","tau/components/component.container","tau/configurations/empty.container.config"],function(_,ViewBase,containerComponent,factoryConfig){return ViewBase.extend({init:function(config){this._super(config)},initialize:function(){},"bus view.dom.ready":function(e){this.container.fire("view.dom.ready",e.data)},"bus beforeInit":function(e,initConfig){var self=this,config=initConfig.config,containerConfig=_.extend(config,factoryConfig.getMasterConfig(config)),c=self.container=containerComponent.create({name:"empty page container",layout:containerConfig.layout,template:containerConfig.template,store:config.store,extensions:_.union([],containerConfig.extensions||[]),context:config.context});c.on("afterInit",self["container afterInit"],self),c.on("afterRender",self["container afterRender"],self),c.on("componentsCreated",self["container componentsCreated"],self),self.fire("component.ready",c),c.initialize(containerConfig)},"container afterInit":function(evt){this.fireAfterInit()},"container componentsCreated":function(evt){this.fire(evt.name,evt.data)},"container afterRender":function(evt){this.fireBeforeRender(),this.element=evt.data.element,this.fireAfterRender()},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.destroyContainer(),this._super()}})});
define('tau/components/component.master.empty',["tau/components/component.page.base","tau/views/view.master.empty"],function(BaseCreator,ViewType){return{create:function(componentContext){var componentConfig={name:"empty page component",turnOffErrorEmiter:!0,turnOffLoadingIndicator:!0,extensions:[],ViewType:ViewType};return BaseCreator.create(componentConfig,componentContext)}}});
define('tau/models/model.menu.actions',["Underscore","tau/core/extension.base","tau/core/termProcessor"],function(_,BaseModel,TermProcessor){var TASK_ENTITYTYPE_ID=45,model=BaseModel.extend({"bus beforeInit":function(evt,initConfig){var config=initConfig.config,configurator=initConfig.config.context.configurator,entity=initConfig.config.context.entity;this.fire("configurator.ready",configurator),this.fire("entity.ready",entity);var items=config.items,eventNames=config.eventNamesCommon||{};_.defaults(eventNames,{dataBind:"dataBind"});var eventName=eventNames.dataBind,processedItems=[],groupItemsCount=0;_.forEach(items,function(item){if(item==="-----"){if(groupItemsCount===0)return;groupItemsCount=0}else++groupItemsCount;processedItems.push(item)}),this.fire(eventName,{items:processedItems})},"bus configurator.ready:last + beforeInit:last + entity.ready:last + menu.show.first":function(evt,configurator,initConfig,entity){var tp=new TermProcessor(initConfig.config.context.getTerms()),actionsService=configurator.getActionsService();actionsService.getEntityTypesToConvert(entity.id).done(_.bind(function(entityTypes){var items=_(entityTypes).chain().filter(function(v){return v.id!=TASK_ENTITYTYPE_ID}).map(function(v){var terms=tp.getTerms(v.name);return{id:v.id,label:terms.name,name:v.name,className:"tau-"+v.name.toLowerCase(),icon:terms.iconSmall}}).value(),task=_.find(entityTypes,function(et){return et.id==TASK_ENTITYTYPE_ID});if(task){var terms=tp.getTerms(task.name);items.push({id:task.id,label:terms.name+"&hellip;",name:task.name,className:"tau-"+task.name.toLowerCase(),icon:terms.iconSmall,alias:"convertToTask"})}this.fire("convertSubmenuData.ready",{items:items})},this))}});return model});
define('tau/ui/extensions/editable-base',["tau/components/extensions/component.extension.base"],function(BaseExtension){return BaseExtension.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,permissions=eventData.permissionsReady.data;if(!permissions.editable)return;self.onEditActivated({element:eventData.afterRender.data.element})},onEditActivated:function(config){}})});
define('tau/ui/behaviour/menu/ui.behaviour.menu.actions',["Underscore","jQuery","tau/core/tau-widget"],function(_,$,tau){tau.widget("ui.behaviourMenuActions",{_create:function(){this.init()},init:function(){var self=this,onClick=this.options.onClick||function(e){self.show()},$element=$(this.element);this.$element=$element,this.$popup=$element.find(".ui-menu__popup"),this.$items=this.$element.find(".ui-menu__item-action .drop-down-option"),this.currentIndex=-1,this.options.classActive="drop-down-option_hover",self.isOpened=!1,this.$element.find(".ui-menu__trigger").click(function(e){onClick(e)}),this._bindEvents()},show:function(){var self=this;self.$popup.slideToggle(100,function(){self.isOpened=!self.isOpened,self.isOpened?self._mapKeyboard():self._unmapKeyboard()})},_bindEvents:function(){var self=this;self.$items.hover(function(){self.$items.not(this).removeClass(self.options.classActive),$(this).addClass(self.options.classActive),self.currentIndex=self.$items.index(this)},function(){$(this).removeClass(self.options.classActive)}),$("body").click(function(e){if($(e.target).closest(".ui-menu__item").hasClass("ui-menu__item-dont-close"))return;self.isOpened&&!$(e.target).parents(".tau-bubble").length&&self.close();if($(e.target).parents(".ui-menu:first").length)return})},_mapKeyboard:function(){var self=this;this.options.keyboardManager.pushHandler({handleKeyDown:function(evt){switch(evt.keyCode){case $.ui.keyCode.ESCAPE:evt.preventDefault(),self.close();break;case $.ui.keyCode.DOWN:evt.preventDefault(),self.currentIndex++,self.currentIndex=self.currentIndex>=self.$items.length?0:self.currentIndex,self.$items.removeClass(self.options.classActive),self.$items.eq(self.currentIndex).addClass(self.options.classActive);break;case $.ui.keyCode.UP:evt.preventDefault(),self.currentIndex--,self.currentIndex=self.currentIndex<0?self.$items.length-1:self.currentIndex,self.$items.removeClass(self.options.classActive),self.$items.eq(self.currentIndex).addClass(self.options.classActive);break;case $.ui.keyCode.ENTER:evt.preventDefault();var $active=self.$items.filter("."+self.options.classActive);$active&&$active.parent().trigger("click")}}})},_unmapKeyboard:function(){this.options.keyboardManager.popHandler()},close:function(){var self=this;this.$popup.slideUp(100,function(){self.isOpened=!1,self._unmapKeyboard()})},destroy:function(){self.isOpened&&this._unmapKeyboard()}})});
define('tau/components/extensions/menu/extension.menu.actions',["Underscore","jQuery","tau/ui/extensions/editable-base","tau/ui/behaviour/menu/ui.behaviour.menu.actions","libs/jquery/jquery.ui.tauConfirm"],function(_,$,Class,event){return Class.extend({"bus configurator.ready + afterRender + dataBind":function(evt,configurator,renderData,bindData){var self=this;this.bindData=bindData,this.redirect=configurator.getRedirect();var $el=this.$el=renderData.element;this.fire("$el.ready",$el),$el.behaviourMenuActions({keyboardManager:configurator.getKeyBoardManager(),onClick:function(e){self.wasShownBefore?self.fire("menu.show",$el):(self.fire("menu.show.first",$el),self.wasShownBefore=!0)}}),$el.find(".ui-menu__item-action").click(_.bind(this.executeCommand,this))},"bus select":function(){this.$el.behaviourMenuActions("show")},removeEntity:function(){var entity=this.config.context.entity,store=this.config.context.configurator.getStore();store.remove(entity.entityType.name,{id:entity.id}).done(),this.config.context.configurator.getHistory().exclude(entity.id)},redirectTo:function(url,target){this.redirect.redirect(url,target)},split:function(){var generalID=this.config.context.entity.id,data={generalID:generalID};this.fire("split",data)},markAsDuplicate:function(){var generalID=this.config.context.entity.id,data={generalID:generalID};this.fire("markAsDuplicate",data)},attachToRequest:function(){var generalID=this.config.context.entity.id;this.fire("attachToRequest",{generalID:generalID})},moveOrCopy:function(){var id=this.config.context.entity.id;this.fire("moveOrCopy",{generalID:id})},executeCommand:function(evt){if($(evt.target).is("a")||$(evt.target).is("i"))return;var self=this,$target=$(evt.currentTarget),alias=$target.data("alias"),data=_.find(this.bindData.items,function(x){return x.alias==alias});if(!data)return;var commandConfig=data.command,confirmation=data.confirmation||!1,actionSuccess=_.bind(function(){if(_.isFunction(commandConfig))_.bind(commandConfig,self)(self);else if(typeof commandConfig=="object"){var componentsConfig={components:commandConfig,context:self.config.context};self.createComponents(componentsConfig,function(data){var container=data[0].component;container.initialize()})}else data.url&&self.redirectTo(data.url);this.fire("beforeSave",{})},this);confirmation?$target.tauConfirm({showOnCreation:!0,content:["<h3>"+confirmation+"</h3>"].join(""),callbacks:{success:actionSuccess}}):actionSuccess()}})});
define('tau/ui/templates/actions/ui.template.moveOrCopy',["tau/core/templates-factory"],function(templates){var config={name:"move-or-copy",markup:['<div style="display: none;">','	<div id="copyActionPopup" style="padding: 10px">','				<table cellpadding="6" cellspacing="0">',"					<tr>","						<td>",'                           <select id="projectSelector">','                               <option value="0" >- Select Project -</option>','                               {{each projects}}<option value="${ID}" >${Name}</option>{{/each}}',"                           </select>","						</td>","						<td>",'                           <input type="button" value="Copy" class="copy" disabled></button> ',"						</td>","						<td>",'                           <input type="button" value="Move" class="move" disabled></button> ',"						</td>","					</tr>","				</table>",'					<div style="font-size: 90%">',"						Custom fields will be saved only when the entity is copied or moved to a project with the same process","					</div>","	</div>","</div>"]};return templates.register(config)});
define('tau/components/extensions/menu/extensions.menu.moveOrCopy',["tau/components/extensions/component.extension.base","tau/core/templates-factory","tau/ui/templates/actions/ui.template.moveOrCopy"],function(ExtensionBase,templates){var popupId=0;return ExtensionBase.extend({"bus moveOrCopy":function(evt){var generalID=evt.data.generalID;this.moveOrCopy(generalID)},moveOrCopy:function(generalID){var self=this;Ext.WindowMgr.zseed=99999;var service=this.config.context.configurator.getActionsService(),getActiveProjectSuccess=function(data){function doAction(action,success){var projectId=$("#"+popupElementId+" #projectSelector").val();projectId!=0&&service[action](self.config.context.entity.id,projectId,function(r){wnd.close(),success&&success(generalID,projectId)},function(r){wnd.close();var message=$.parseJSON(r.responseText).Message;self.fire("error",{message:message})})}popupId++;var el=templates.get("move-or-copy").bind(self.config,{projects:data.d}).appendTo("body"),popupElementId="copyActionPopup"+popupId;el.find("#copyActionPopup").prop("id",popupElementId);var buttons=el.find(".copy,.move");el.find("#projectSelector").change(function(){var disabled="disabled";$(this).val()!="0"?buttons.removeAttr(disabled):buttons.attr(disabled,disabled)}),el.find(".copy").click(function(){var successDelegate=function(entityId,projectId){self.fire("entityWasCopiedToProject",{entity:{id:entityId},project:{id:projectId}})};doAction("copyGeneralToProject",successDelegate)}),el.find(".move").click(function(){var successDelegate=function(entityId,projectId){self.fire("entityWasMovedToProject",{entity:{id:entityId},project:{id:projectId}})};doAction("moveGeneralToProject",successDelegate)});var wnd=showModalPopup(popupElementId,{title:"Move or Copy",width:440,height:126})};service.getActiveProjectForEntity(generalID,getActiveProjectSuccess)}})});
define('tau/components/extensions/menu/extensions.menu.attachToRequest',["tau/components/extensions/component.extension.base"],function(ExtensionBase){var popupId=0;return ExtensionBase.extend({"bus attachToRequest":function(evt){var generalID=evt.data.generalID;this.attachToRequest(generalID)},attachToRequest:function(generalID){Ext.WindowMgr.zseed=99999;var self=this,projectID=this.config.context.getProjectId(),projectIds=[];for(var i=0;i<_projectContext.length;i++)projectIds.push(_projectContext[i].id);var actionsService=this.config.context.configurator.getActionsService();actionsService.getProjectIds(function(result){var lookup=Ext.create({xtype:"lookupgenerallistitemgrid",listeners:{lookupactionlinkclick:{fn:function(e,el,grid,record,row,cell){wnd.close(),wnd.destroy();var success=function(data){self.fire("requestWasAttachedToEntity",{entity:{id:generalID}},{project:{id:record.json.GeneralID}})},error=function(data){};actionsService.attachGeneralToRequest(generalID,record.json.GeneralID,success,error)},scope:this}},showReleaseIteration:!1,showEntityType:!1,excludeEntityId:0,showProjects:!0,entityTypeIds:[17],showState:!1,projectIds:result.d,projectId:projectID,appendItems:[]}),wnd=showModalPopupForComponent(lookup,{width:680,height:500,title:"Attach to Request"})})}})});
define('tau/components/extensions/menu/extensions.menu.markAsDuplicate',["tau/components/extensions/component.extension.base"],function(ExtensionBase){var popupId=0;return ExtensionBase.extend({"bus markAsDuplicate":function(evt){var generalID=evt.data.generalID;this.markAsDuplicate(generalID)},markAsDuplicate:function(generalID){var configurator=this.config.context.configurator;Ext.WindowMgr.zseed=99999;var projectIds=[];for(var i=0;i<_projectContext.length;i++)projectIds.push(_projectContext[i].id);var self=this,wnd=Tp.controls.Duplicate.CreatePopup(projectIds,generalID,undefined,{onMarkDelegate:function(data){var store=self.config.context.configurator.getStore(),promise=store.freeze();self.fire("bugWasMarkedAsDuplicate",data),promise.unfreeze()}});wnd.show(projectIds,generalID),configurator.getKeyBoardManager().pushHandler({handleKeyDown:function(evt){evt.which==27&&(configurator.getKeyBoardManager().popHandler(),wnd.hide(),wnd.destroy())}})}})});
define('tau/components/extensions/menu/extensions.menu.split',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({"bus split":function(evt){var generalID=evt.data.generalID;this.split(generalID)},split:function(generalID){var self=this,configurator=this.config.context.configurator,service=configurator.getActionsService();service.splitUserStory(generalID,_.bind(this._success,this,generalID,configurator),function(r){var err={Message:"Split operation is failed due to server error"};try{err=$.parseJSON(r.responseText)}catch(e){}self.fire("error",{message:err.Message})})},_success:function(generalID,configurator,result){var splittedId=result.d,url=configurator.getUrlBuilder().getSplitForUserStoryUrl(generalID,splittedId);configurator.getRedirect().redirect(url)}})});
define('tau/components/extensions/menu/extensions.menu.converter',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus configurator.ready:last + entity.ready:last + convertTo":function(evt,configurator,entity,convertTo){var self=this,service=configurator.getActionsService();self.fire("showProgress",{text:"Converting..."});var generalId=entity.id,convertSuccess=function(result){self.fire("hideProgress");var general=result.d,parts=general.EntityTypeName.split("."),typeName=parts[parts.length-1],data={entity:{id:general.GeneralID},entityType:{name:typeName}};configurator.getHistory().exclude(generalId,!1),configurator.service("navigator").to(typeName.toLowerCase()+"/"+general.GeneralID),window._criticalTauChanges=!0,self.fire("generalWasConverted",data)},convertFailed=function(result){self.fire("hideProgress");var parseJSON=jQuery.parseJSON(result.responseText)||{Message:"Server is not available"},errorMessage=parseJSON.Message;self.fire("error",{message:errorMessage})};convertTo.entityType.name.toLowerCase()=="task"?service.convertGeneralToTask(generalId,convertTo.userStory.id,convertSuccess,convertFailed):service.convertGeneralToType(generalId,convertTo.entityType.id,convertSuccess,convertFailed)}})});
define('tau/models/finder/model.userStory.search',["Underscore","tau/models/finder/model.assignable.search"],function(_,ModelBase){return ModelBase.extend({init:function(config){this._super(config);var containsOperator=function($query,propertyName,value){$query[propertyName]={name:{$contains:value}}};this.properties.feature={label:this.terms.resolve("feature"),autoCompletable:!1,statement:containsOperator},this.properties.state.filter=function(v){return v?v.dataItem?v.dataItem.entityType.id===4:!0:!0}},getType:function(){return"userStory"}})});
define('tau/components/extensions/menu/extensions.menu.converter.menu',["Underscore","tau/components/extensions/component.extension.base","tau/core/termProcessor","tau/ui/behaviour/menu/ui.behaviour.menu.actions","tau/components/component.finder","tau/models/finder/model.userStory.search","libs/jquery/jquery.ui.tauConfirm"],function(_,ExtensionBase,TermProcessor,ui,Finder,UserStorySearch){return ExtensionBase.extend({"bus menu.show":function(evt,$menu){$menu.behaviourMenuActions("show")},"bus configurator.ready:last + $el.ready:last + convertSubmenuData.ready + menu.show.first":function(evt,configurator,$el,data,$menu){var $item=$el.find(".i-role-action-convert");if(data.items.length>0){var $submenu=configurator.getTemplateFactory().get("menu.actions.submenu").bind({},data);$item.append($submenu),this.fire("$submenu.ready",$submenu)}else $item.hide();$menu.behaviourMenuActions("show")},"bus $submenu.ready":function(evt,$submenu){var self=this,entity=this.config.context.entity,tp=new TermProcessor(this.config.context.getTerms()),$items=$submenu.find(".ui-menu__item"),thisEntityType=tp.getTerms(entity.entityType.name).name;$items.each(function(){var $item=$(this);if($item.data("alias")!="convertToTask"){var name=$item.data("name"),id=$item.data("id"),entityType={id:id,name:name},thatEntityType=tp.getTerms(name).name;$item.tauConfirm({content:["<h3>Do you really want to convert "+thisEntityType+" to "+thatEntityType+"?</h3>"].join(""),onPositionConfig:function(conf){conf.my="left center",conf.at="right center",conf.offset="0 20",conf.collision="flip flip"},onArrowPositionConfig:function(conf){conf.offset="0 6"},onHide:function(){$submenu.toggleClass("sub-ui-menu_dont-hide",!1),$item.find(".drop-down-option").toggleClass("drop-down-option_hover",!1)},onShow:function(){$submenu.toggleClass("sub-ui-menu_dont-hide",!0),$item.find(".drop-down-option").toggleClass("drop-down-option_hover",!0)},callbacks:{success:_.bind(function(){this.fire("convertTo",{entityType:entityType})},self)},zIndex:130})}})}})});
define('tau/components/extensions/menu/extensions.menu.converterToTask',["tau/components/extensions/component.extension.base","tau/core/termProcessor","tau/components/component.finder","tau/models/finder/model.userStory.search"],function(ExtensionBase,TermProcessor,Finder,UserStorySearch){return ExtensionBase.extend({"bus configurator.ready:last + $submenu.ready":function(evt,configurator,$submenu){var self=this,entity=this.config.context.entity,tp=new TermProcessor(this.config.context.getTerms()),$items=$submenu.find(".ui-menu__item"),thisEntityType=tp.getTerms(entity.entityType.name).name,$item=$items.filter("[data-alias=convertToTask]");if($item.length){var finder=Finder.create({resetDisabled:!0,searchModel:UserStorySearch}),name=$item.data("name"),id=$item.data("id"),entityType={id:id,name:name};finder.on("afterRender",function(evt,data){var $wrapped=$("<div/>").append(data.element),thatEntityType=tp.getTerms(name).name,$content=$wrapped.append(['<div class="i-role-confirmation-content" style="display: none">',"<h3>Do you really want to convert "+thisEntityType+" to "+thatEntityType+"?</h3>",'<div class="tau-buttons">','<button type="button" class="tau-btn tau-primary i-role-actionok">Yes, I\'m sure</button>','<button type="button" class="tau-btn i-role-actioncancel">No</button>',"</div>","</div>"].join("")),$bubbled=$item.tauBubble({template:['<div class="tau-bubble">','<div class="tau-bubble__arrow" role="arrow"></div>','<div class="tau-bubble__inner tau-container"  role="content"></div>',"</div>"].join(""),content:$content,onPositionConfig:function(conf){conf.my="center top",conf.at="center bottom",conf.offset="0 0",conf.collision="flip flip"},onHide:function(){configurator.getKeyBoardManager().popHandler(),$submenu.toggleClass("sub-ui-menu_dont-hide",!1),$item.find(".drop-down-option").toggleClass("drop-down-option_hover",!1)},onShow:function(){configurator.getKeyBoardManager().pushHandler({}),$submenu.toggleClass("sub-ui-menu_dont-hide",!0),$item.find(".drop-down-option").toggleClass("drop-down-option_hover",!0);var $w=$bubbled.tauBubble("widget");$w.find(".ui-finder-placeHolder").show(),$w.find(".i-role-confirmation-content").hide(),$w.removeClass("tau-warning-bubble"),$w.find(".filter-field").focus(),$w.unbind("click"),finder.fire("popupResize",$bubbled),$item.tauBubble("adjustPosition"),$w.one("click",".i-role-actioncancel",function(){$bubbled.tauBubble("hide")}),$w.one("click",".i-role-actionok",function(){$bubbled.tauBubble("hide"),self.fire("convertToTask",entityType)})},zIndex:130})}),finder.on("entitySelected",function(evt,entity){var $w=$item.tauBubble("widget");$w.find(".ui-finder-placeHolder").hide(),$w.find(".i-role-confirmation-content").show(),$w.addClass("tau-warning-bubble"),$item.tauBubble("adjustPosition"),self.fire("entitySelected",entity)}),this.reFire(finder),finder.initialize()}},reFire:function(finder){var childBus=finder,bus=this.bus,originalFire=childBus.fire,childName=childBus.name;childBus.fire=function(eventName,data){var params=_.toArray(arguments);originalFire.apply(childBus,params),bus.fire(childName+"."+eventName,data)}},"bus entitySelected + convertToTask":function(evt,userStory,entityType){this.fire("convertTo",{entityType:entityType,userStory:userStory.entity})}})});
define('tau/ui/templates/menu/ui.template.menu.actions.submenu',["tau/core/templates-factory","tau/ui/templates/menu/ui.template.menu.actions.item"],function(templates){var config={name:"menu.actions.submenu",engine:"jqote2",markup:['<div class="sub-ui-menu">','<div class="sub-ui-menu-cont">',"<% _.forEach(this.items, function(item){ %>",'<%= fn.sub("menu.actions.item", item) %>',"<% }); %>","</div>","</div>"]};return templates.register(config)});
define('tau/ui/templates/menu/ui.template.menu.actions',["tau/core/templates-factory","tau/ui/templates/menu/ui.template.menu.actions.item","tau/ui/templates/menu/ui.template.menu.actions.submenu"],function(templates){var config={name:"menu.actions",engine:"jqote2",markup:['<div class="ui-menu-actions">','<span class="ui-menu__trigger">',"Actions",'<span class="ui-menu__indicator"></span>',"</span>",'<div class="ui-menu__popup ui-drop-down">','<div class="ui-drop-down drop-down-list">',"<% _.forEach(this.items, function(item){ %>",'<%= fn.sub("menu.actions.item", item) %>',"<% }); %>","</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.menu.actions',["tau/components/component.creator","tau/models/model.menu.actions","tau/components/extensions/menu/extension.menu.actions","tau/components/extensions/menu/extensions.menu.moveOrCopy","tau/components/extensions/menu/extensions.menu.attachToRequest","tau/components/extensions/menu/extensions.menu.markAsDuplicate","tau/components/extensions/menu/extensions.menu.split","tau/components/extensions/menu/extensions.menu.converter","tau/components/extensions/menu/extensions.menu.converter.menu","tau/components/extensions/menu/extensions.menu.converterToTask","tau/components/extensions/error/extension.errorBar","tau/ui/templates/menu/ui.template.menu.actions"],function(creator,Model,Actions,MoveOrCopy,AttachToRequest,MarkAsDuplicate,Split,Converter,ConverterMenu,ConverterToTask,ErrorBar,template){return{create:function(config){var creatorConfig={extensions:[Model,Actions,MoveOrCopy,AttachToRequest,MarkAsDuplicate,Split,Converter,ConverterMenu,ConverterToTask,ErrorBar],template:config.template||template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.menu.testPlanRun',["Underscore","tau/core/model-base"],function(_,BaseModel){var model=BaseModel.extend({"bus beforeInit":function(evt){var config=evt.data.config,eventNames=config.eventNamesSpecial||{};_.defaults(eventNames,{dataBind:"dataBind"});var eventName=eventNames.dataBind,id=config.context.entity.id,path=this.config.context.configurator.getApplicationPath(),additionalActions={run:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id,label:"Run"},completeRun:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id+"&CompleteRun=1",label:"Complete Last Run"},newRun:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id+"&ReRun=1",label:"New Run"},changeLastRun:{show:!1,url:path+"/Project/QA/TestPlanRun/TestsRunner.aspx?TestPlanRunID="+id+"&Edit=1",label:"Change Last Run"}},self=this,entity=config.context.entity;this.store.get("testplanrun",{id:entity.id,fields:["testCaseRuns-count","passedCount","failedCount","notRunCount",{entityState:["isFinal"]}]}).done({success:function(result){var item=result[0].data;!item.entityState.isFinal&&item["testCaseRuns-count"]>0&&(item.passedCount>0||item.failedCount>0?(additionalActions.newRun.show=!0,item.notRunCount>0?additionalActions.completeRun.show=!0:additionalActions.changeLastRun.show=!0):additionalActions.run.show=!0),self.bus.fire(eventName,{additionalActions:additionalActions})}}),this.store.on({eventName:"afterSave",type:"testplanrun",listener:this,filter:{id:entity.id},hasChanges:["entityState"]},function(res){self.fire("refresh")})}});return model});
define('tau/models/model.menu.testPlanRun.union',["Underscore","tau/core/model-base"],function(_,BaseModel){var model=BaseModel.extend({"bus dataBind.special+dataBind.common":function(evt){var specialActions=evt["dataBind.special"].data.additionalActions,commonActions=[];_.forEach(specialActions,function(action,key){action.show==1&&commonActions.push({label:action.label||key,url:action.url})}),commonActions=commonActions.concat(evt["dataBind.common"].data.items),this.fire("dataBind",{items:commonActions})}});return model});
define('tau/components/component.menu.actions.testplanrun',["tau/components/component.creator","tau/models/model.menu.actions","tau/models/model.menu.testPlanRun","tau/models/model.menu.testPlanRun.union","tau/components/extensions/menu/extension.menu.actions","tau/components/extensions/menu/extensions.menu.converter","tau/components/extensions/menu/extensions.menu.converter.menu","tau/components/extensions/error/extension.errorBar","tau/ui/templates/menu/ui.template.menu.actions"],function(creator,ModelCommon,ModelSpecial,ModelUnion,ExtensionBase,ConverterMenu,ConverterMenuUI,ErrorBar,template){return{create:function(config){config.eventNamesCommon={dataBind:"dataBind.common"},config.eventNamesSpecial={dataBind:"dataBind.special"};var creatorConfig={extensions:[ModelCommon,ModelSpecial,ModelUnion,ExtensionBase,ConverterMenu,ConverterMenuUI,ErrorBar],template:config.template||template};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/menu.testPlanRun/ui.template.menu.testPlanRun',["tau/core/templates-factory"],function(templates){var config={name:"menu-testPlanRun",markup:['<div class="tau-menu-testplanrun">',"{{if additionalActions.run.show == true}}",'<a class="tau-action tau-action-run" href="${additionalActions.run.url}"><span class="tau-action__icon"></span>Run</a>',"{{/if}}","{{if additionalActions.newRun.show == true}}",'<a class="tau-action tau-action-newrun" href="${additionalActions.newRun.url}"><span class="tau-action__icon"></span>New Run</a>',"{{/if}}","{{if additionalActions.completeRun.show == true}}",'<a class="tau-action" href="${additionalActions.completeRun.url}">Complete Last Run</a>',"{{/if}}","{{if additionalActions.changeLastRun.show == true}}",'<a class="tau-action" href="${additionalActions.changeLastRun.url}">Change Last Run</a>',"{{/if}}","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.menu.testPlanRun',["tau/components/component.creator","tau/models/model.menu.testPlanRun","tau/ui/templates/menu.testPlanRun/ui.template.menu.testPlanRun"],function(creator,Model,template){return{create:function(config){var creatorConfig={extensions:[Model],template:config.template||template};return creator.create(creatorConfig,config)}}});
define('tau/views/view.page.board',["Underscore","tau/core/view-base","tau/components/component.board.container","tau/configurations/board.container.config"],function(_,ViewBase,ContainerComponent,PageConfig){return ViewBase.extend({init:function(config){this._super(config)},initialize:function(){},"bus view.dom.ready":function(e){this.container.fire("view.dom.ready",e.data)},"bus beforeInit+boardSettings.ready":function(evt,initConfig,bs){var self=this,config=initConfig.config,boardSettings=bs.boardSettings,configurator=initConfig.config.context.configurator;configurator.registeredServices&&delete configurator.registeredServices.boardSettings,configurator.registerService("boardSettings",boardSettings),boardSettings.unbind({listener:self}),boardSettings.bind({fields:["name"],listener:self,callback:function(r){configurator.getTitleManager().setTitle(_.asString(r.name)),configurator.getHistory().updateCurrent({title:_.asString(r.name)})}}),boardSettings.get({fields:["id","name"],callback:function(r){configurator.getTitleManager().setTitle(_.asString(r.name)),configurator.getHistory().process(),configurator.getHistory().setCurrent({url:configurator.getUrlBuilder().getRelativeBoardUrl(r.id),title:_.asString(r.name),id:r.id}),configurator.getRouting().setReferer({id:r.id})}});var pageConfig=new PageConfig(configurator),containerConfig=_.extend(config,pageConfig.getPageBoardConfig()),c=self.container=ContainerComponent.create({name:"board page container",layout:containerConfig.layout,template:containerConfig.template,store:config.store,extensions:_.union([],containerConfig.extensions||[]),context:config.context});c.on("afterInit",self["container afterInit"],self),c.on("afterRender",self["container afterRender"],self),c.on("componentsCreated",self["container componentsCreated"],self),configurator.getConfig("tmpBoardIsJustAdded",!1)||(boardSettings.settings.edit=!1,boardSettings.fieldsRetrieved.push("edit")),c.fire("boardSettings.ready",{boardSettings:boardSettings}),c.initialize(containerConfig)},"container afterInit":function(evt){this.fireAfterInit()},"container componentsCreated":function(evt){this.fire(evt.name,evt.data)},"container afterRender":function(evt){this.fireBeforeRender(),this.element=evt.data.element,this.fireAfterRender()},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.destroyContainer(),this._super()}})});
define('tau/components/component.page.board',["tau/components/component.page.base","tau/views/view.page.board"],function(BaseCreator,ViewType){return{create:function(componentContext){var componentConfig={name:"board page component",turnOffErrorEmiter:!0,turnOffLoadingIndicator:!0,extensions:[],ViewType:ViewType};return BaseCreator.create(componentConfig,componentContext)}}});
define('tau/configurations/reports.container.config',["Underscore","tau/core/class"],function(_,Class){var repContainerConfig=Class.extend({init:function(appConfig){this.tabs=[this.getProcessControlChartTabConfig(appConfig),this.getBurnDownTabConfig(appConfig),this.getCycleTimeDistributionChartTabConfig(appConfig)];var featureService=appConfig.context.configurator.getFeaturesService();featureService.isEnabled("relations.network.chart")&&this.tabs.push(this.getRelationsNetworkChartTabConfig(appConfig))},getProcessControlChartTabConfig:function(appConfig){return{selected:!0,label:"processControlChart",header:[{type:"label",text:"Process Control"}],items:[{path:"tp/reports/processControl/component.report"}]}},getBurnDownTabConfig:function(appConfig){return{label:"burnDown",header:[{type:"label",text:"Burn Down"}],items:[{path:"tp/reports/burnDown/component.report"}]}},getCycleTimeDistributionChartTabConfig:function(appConfig){return{label:"cycleTimeDistribution",header:[{type:"label",text:"Cycle Time Distribution"}],items:[{path:"tp/reports/cycleTimeDistribution/component.report"}]}},getRelationsNetworkChartTabConfig:function(appConfig){return{label:"relationsNetwork",header:[{type:"label",text:"Relations Network"}],items:[{path:"tp/reports/relationsNetwork/component.report"}]}},getConfig:function(){return{type:"container",layout:"list",name:"reports container",children:[{type:"tabs",cssClass:"tau-tabs",tabs:this.tabs,stateName:"reports"}]}},getReportNameByKey:function(key){var tabs=this.tabs.filter(function(item){return item.label==key});return tabs.length?tabs[0].header[0].text:"Reports"}});return repContainerConfig});
define('tau/views/view.page.reports',["Underscore","jQuery","tau/core/view-base","tau/components/component.container","tau/configurations/reports.container.config"],function(_,$,ViewBase,containerComponent,factoryConfig){return ViewBase.extend({init:function(config){this._super(config)},initialize:function(){},"bus beforeInit":function(evt){var self=this,config=self.config,reportConfig=new factoryConfig(config),configurator=self.config.context.configurator;configurator.getTitleManager().setTitle("Report");var history=configurator.getHistory();setTimeout(_.bind(function(){history.reset(),history.setCurrent({id:0,url:"#reports/"+this.config.reportType,title:reportConfig.getReportNameByKey(this.config.reportType)})},this),1);var componentSettings=configurator.getBoardSettingsFactory().createComponentSettings({id:"reports"});self.config.context.componentSettings=componentSettings;var containerConfig=_.extend(config,reportConfig.getConfig()),c=self.container=containerComponent.create({name:"board page container",layout:containerConfig.layout,template:containerConfig.template,extensions:_.union([],containerConfig.extensions||[]),context:config.context}),initialize=function(states){configurator.setConfig("states",states),c.on("afterInit",self["container afterInit"],self),c.on("afterRender",self["container afterRender"],self),c.on("componentsCreated",self["container componentsCreated"],self),c.initialize(containerConfig)};this.processStates().done(function(states){initialize(states)}),componentSettings.unbind({listener:self,callback:self.onStateChanged}),componentSettings.bind({fields:["reports"],listener:self,callback:function(data){history.updateCurrent({url:"#reports/"+data.reports,title:reportConfig.getReportNameByKey(data.reports)})}})},"container afterInit":function(evt){this.fireAfterInit()},"container componentsCreated":function(evt){this.fire(evt.name,evt.data)},"container afterRender":function(evt){this.fireBeforeRender(),this.element=evt.data.element,evt.data.element.addClass("tau-page-entity"),this.fireAfterRender()},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},processStates:function(){var reportType=this.config.reportType,settings=this.config.context.componentSettings,def=$.Deferred();return reportType?settings.set({set:{reports:reportType},callback:function(states){def.resolve(states)}}):settings.get({fields:["reports"],callback:function(states){def.resolve(states)}}),def},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.config.context.componentSettings.unbind({listener:this}),this.destroyContainer(),this._super()}})});
define('tau/components/component.page.reports',["tau/components/component.page.base","tau/views/view.page.reports"],function(BaseCreator,ViewType){return{create:function(componentContext){var componentConfig={name:"reports page component",turnOffErrorEmiter:!0,extensions:[],ViewType:ViewType};return BaseCreator.create(componentConfig,componentContext)}}});
define('tau/configurations/search.container.config',["Underscore","tau/core/class"],function(_,Class){var Config=Class.extend({getConfig:function(appConfig){return{children:[{type:"container",name:"search results container",layout:"selectable",template:{name:"search-results-container",markup:['<div class="tau-container i-role-container-target"></div>']},children:[{type:"search.filter",selector:".i-role-container-target"},{type:"search",selector:".i-role-container-target"}]}]}}});return Config});
define('tau/views/view.page.search',["Underscore","jQuery","tau/core/view-base","tau/components/component.container","tau/configurations/search.container.config"],function(_,$,ViewBase,containerComponent,factoryConfig){return ViewBase.extend({init:function(config){this._super(config)},initialize:function(){},"bus beforeInit":function(evt){var self=this,configurator=self.config.context.configurator;configurator.getTitleManager().setTitle("Search");var history=configurator.getHistory();history.reset(),history.process(),history.setCurrent({id:0,url:"#"+self.config.entity,title:"Back to search results"});var config=self.config,containerConfig=_.extend(config,(new factoryConfig(config)).getConfig(config)),c=self.container=containerComponent.create({name:"board page container",layout:containerConfig.layout,template:containerConfig.template,extensions:_.union([],containerConfig.extensions||[]),context:config.context});c.on("afterInit",self["container afterInit"],self),c.on("afterRender",self["container afterRender"],self),c.on("componentsCreated",self["container componentsCreated"],self),c.initialize(containerConfig)},"container afterInit":function(evt){this.fireAfterInit()},"container componentsCreated":function(evt){this.fire(evt.name,evt.data)},"container afterRender":function(evt){this.fireBeforeRender(),this.element=evt.data.element,this.fireAfterRender()},lifeCycleCleanUp:function(){this.destroyContainer(),this._super()},destroyContainer:function(){if(!this.container)return;this.container.destroy(),this.container=null},destroy:function(){this.destroyContainer(),this._super()}})});
define('tau/components/component.page.search',["tau/components/component.page.base","tau/views/view.page.search"],function(BaseCreator,ViewType){return{create:function(componentContext){var componentConfig={name:"search page component",turnOffErrorEmiter:!0,extensions:[],ViewType:ViewType};return componentContext["queue.bus"]=!0,BaseCreator.create(componentConfig,componentContext)}}});
define('tau/ui/extensions/pluginsList/ui.extension.pluginsList.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){var pluginsListEditable=ExtensionBase.extend({"bus dataBind+afterRender":function(evtArgs){this.element=evtArgs.afterRender.data.element,this.dataToBind=evtArgs.dataBind.data;var pluginsBlocks=this.element.find(".plugin-block");_(pluginsBlocks).each(function(pluginBlock){$(pluginBlock).find(".tau-profile-actions").click($.proxy(this.onDeleteProfile,{pluginBlock:$(pluginBlock),parentExtension:this}))},this)},onDeleteProfile:function(evt){evt.preventDefault();var self=this.parentExtension,data=$(evt.target).tmplItem().data,pluginBlock=this.pluginBlock,proxyHandler=function(){pluginBlock.confirmation("hide"),pluginBlock.tauOverlay("hide"),self.fire("refresh")};pluginBlock.confirmation({message:"Do you really want to delete profile?",okLabel:"OK",cancelLabel:"Cancel",ok:function(){pluginBlock.tauOverlay({showOnCreation:!1}),pluginBlock.tauOverlay("showLarge"),pluginBlock.confirmation("hideConfirmationMessage"),self.config.context.pluginRepository.deleteProfile(data.pluginName,data.name,proxyHandler)},cancel:function(){pluginBlock.confirmation("hide")}}),this.pluginBlock.confirmation("show")}});return pluginsListEditable});
define('tau/ui/extensions/pluginsList/ui.extension.pluginsList.errorDisplay',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){var pluginsListErrorDisplay=ExtensionBase.extend({"bus dataBind+afterRender":function(evtArgs){this.element=evtArgs.afterRender.data.element,this.dataToBind=evtArgs.dataBind.data,_(this.element.find(".plugin-block")).each(function(element){var pluginName=$(element).tmplItem().data.name;this.config.context.pluginRepository.getProfilesErrors(pluginName,$.proxy(this.onProfilesErrorsRetrieved,{element:$(element),data:$(element).tmplItem().data}))},this)},onProfilesErrorsRetrieved:function(data){_(this.element.find(".tau-profileName")).each(function(element){_(data).each(function(profileErrorCheckResult){if(profileErrorCheckResult.ProfileName==$(element).tmplItem().data.name&&profileErrorCheckResult.ErrorsExist){var el=$(element);el.fadeOut("slow"),el.children("a").addClass("error-indicator"),$(element).fadeIn("slow")}})},this)}});return pluginsListErrorDisplay});
define('tau/ui/extensions/pluginsList/ui.extension.pluginsCategory.collapsible',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){var pluginsCategoryCollapsible=ExtensionBase.extend({"bus dataBind+afterRender":function(evtArgs){_(evtArgs.afterRender.data.element.find(".plugins-category")).each(function(element){var el=$(element);el.find(".tau-pluginCategory").click(function(evt){evt.preventDefault();var self=$(this),wasCollapsed=self.hasClass("collapsed"),toRemove=wasCollapsed?"collapsed":"expanded",toAdd=wasCollapsed?"expanded":"collapsed";self.removeClass(toRemove),self.addClass(toAdd),wasCollapsed?(el.find(".plugin-block").show(),el.find(".create-me").show()):(el.find(".plugin-block").hide(),el.find(".create-me").hide())})})}});return pluginsCategoryCollapsible});
define('tau/ui/extensions/pluginsList/ui.extension.pluginsList.showMore',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){var pluginsListShowMore=ExtensionBase.extend({"bus dataBind+afterRender":function(evtArgs){this.element=evtArgs.afterRender.data.element,this.dataToBind=evtArgs.dataBind.data,_(this.element.find(".plugin-block")).each(function(element){var pluginBlock=$(element),profilesMoreCount=pluginBlock.tmplItem().data.profilesMore.length;if(profilesMoreCount>0){var moreProfilesElement=pluginBlock.find(".tau-profiles-more"),moreLink=pluginBlock.find(".tau-profiles-moreLink");moreLink.show(),moreLink.click([moreLink,moreProfilesElement],$.proxy(this.onShowMoreClick,{profilesMoreCount:profilesMoreCount}))}},this)},onShowMoreClick:function(evt){evt.preventDefault();var moreLink=evt.data[0].find(".more-link"),moreProfilesElement=evt.data[1];moreProfilesElement.is(":visible")?moreLink.text(["Show more (",this.profilesMoreCount,")"].join("")):moreLink.text("Show less"),moreProfilesElement.animate({opacity:"toggle",height:"toggle"},"slow")}});return pluginsListShowMore});
define('tau/models/model.pluginsList',["Underscore","jQuery","tau/core/model-base"],function(_,$,ModelBase){var pluginsListModel=ModelBase.extend({onInit:function(){this.config.context.pluginRepository.getPlugins($.proxy(this.onPluginsRetrieved,this))},onPluginsRetrieved:function(data){this.augmentData(data),this.fire("dataBind",{items:data})},augmentData:function(data){var configurator=this.config.context.configurator;_(data).each(function(category){_(category.plugins).each(function(plugin){plugin.iconSrc=[configurator.getApplicationPath(),"/PluginIcon.ashx?pluginName=",plugin.name].join(""),plugin.profilesShort=plugin.profiles.slice(0,3),plugin.profilesMore=plugin.profiles.slice(3)},this)},this)}});return pluginsListModel});
define('tau/ui/templates/pluginsList/ui.template.pluginsList.profile',["tau/core/templates-factory"],function(templates){var config={name:"pluginsList-profile",markup:["<ul>",'   <li class="name tau-profileName"><a href="${editUrl}">${name}</a></li>','   <li class="delete"><a class="tau-profile-actions button danger" href=""><span class="delete-icon"></span></a></li>',"</ul>"]};return templates.register(config)});
define('tau/ui/templates/pluginsList/ui.template.pluginsList.plugin',["tau/core/templates-factory","tau/ui/templates/pluginsList/ui.template.pluginsList.profile"],function(templates){var config={name:"pluginsList-plugin",markup:['<div class="plugin-block">','   <img src="${iconSrc}" />','   <h4 class="_pluginName">${name}</h4>','   <p class="note-p">${description}</p>','   <div class="separator"></div>','   <div class="profiles-list">','       <div class="tau-profiles-short">','           {{tmpl(profilesShort) "pluginsList-profile"}}',"       </div>",'       <div class="tau-profiles-more" style="display:none">','           {{tmpl(profilesMore) "pluginsList-profile"}}',"       </div>","   </div>",'   <div class="pb-5 tau-profiles-moreLink" style="display:none">','       <a class="more-link">Show more (${profilesMore.length})</a>',"   </div>",'   <div class="pt-5">','       <button type="button" class="button bold" onClick="window.location.href = \'${newProfileUrl}\';">Add Profile</button>',"   </div>","</div>"],dependencies:["pluginsList-profile"]};return templates.register(config)});
define('tau/ui/templates/pluginsList/ui.template.pluginsList.category',["tau/core/templates-factory","tau/ui/templates/pluginsList/ui.template.pluginsList.plugin"],function(templates){var config={name:"pluginsList-category",markup:['<div class="plugins-category">','<div class="expanded tau-pluginCategory">','<span class="label">${category}</span>',"</div>",'{{tmpl(plugins) "pluginsList-plugin"}}',"</div>"],dependencies:["pluginsList-plugin"]};return templates.register(config)});
define('tau/ui/templates/pluginsList/ui.template.pluginsList',["tau/core/templates-factory","tau/ui/templates/pluginsList/ui.template.pluginsList.category"],function(templates){var config={name:"pluginsList",options:{contentSelector:".ui-pluginsList-table"},markup:['<div class="plugins">','   <div class="list">','       <h2 class="h2 icon">Plugins</h2>','       {{tmpl(items) "pluginsList-category"}}',"   </div>","</div>"],dependencies:["pluginsList-category"]};return templates.register(config)});
define('tau/components/component.pluginsList',["tau/components/component.list.creator","tau/ui/extensions/pluginsList/ui.extension.pluginsList.editable","tau/ui/extensions/pluginsList/ui.extension.pluginsList.errorDisplay","tau/ui/extensions/pluginsList/ui.extension.pluginsCategory.collapsible","tau/ui/extensions/pluginsList/ui.extension.pluginsList.showMore","tau/models/model.pluginsList","tau/ui/extensions/ui.extension.loading","tau/ui/templates/pluginsList/ui.template.pluginsList"],function(creator,PluginsEditableExtension,PluginsErrorDisplayExtension,PluginsCategoryCollapsible,PluginsShowMoreExtension,ModelType,LoadingExtension,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,message:"No plugins found",extensions:[PluginsEditableExtension,PluginsErrorDisplayExtension,PluginsCategoryCollapsible,PluginsShowMoreExtension,LoadingExtension]};return creator.create(creatorConfig,config)}}});
define('tau/ui/templates/common/ui.template.buttonAction',["tau/core/templates-factory"],function(templates){var config={name:"button-action",markup:['<a class="button-box ${id}-button user-action button small ${className}"',' role="button">','   <span class="">${title}</span>',"</a>"].join("")};return templates.register(config)});
define('tau/ui/templates/print/ui.template.print',["tau/core/templates-factory","tau/ui/templates/common/ui.template.buttonAction"],function(templates){var config={name:"print",markup:['<div class="ui-print">','   <div class="ui-print__controls">','       {{tmpl([{id: "x", className: "ui-print__controls__print", title: "Print"}]) "button-action"}}',"   </div>","</div>"],dependencies:["button-action"]};return templates.register(config)});
define('tau/ui/extensions/print/ui.extension.print',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt){this.options=evt.data.config,this.options.window=this.options.window||window},"bus afterRender":function(evtArgs){this.element=evtArgs.data.element,this.entity=evtArgs.data.data.context.entity;var $el=this.element,self=this;this._printHandler||(this._printHandler=_.bind(this._print,this),$el.find(".ui-print__controls__print").bind("click",this._printHandler));var $close=$el.find(".ui-print__controls__close");this._closeHandler||(this._closeHandler=_.bind(this._close,this),$el.find(".ui-print__controls__close").bind("click",this._closeHandler))},_print:function(e){this.options.window.print()},_close:function(e){e.preventDefault(),this.options.window.opener?this.options.window.close():this.config.context.configurator.getRedirect().redirect("View.aspx?noRedirect=1&id=${entity.id}",null,this.options.context)}})});
define('tau/components/component.print',["Underscore","tau/core/component-base","tau/views/view.container","tau/ui/templates/print/ui.template.print","tau/ui/extensions/print/ui.extension.print"],function(_,ComponentType,ViewType,template,PrintExtension){return{create:function(config){return config=config||{},_.defaults(config,{template:template}),(new ComponentType(config)).attach(PrintExtension).attach(ViewType).bus}}});
define('tau/views/view.composer',["Underscore","jQuery","tau/core/view-base","tau/core/event-dispatcher"],function(_,$,ViewBase,EventDispatcher){var ComposerView=ViewBase.extend({init:function(config){this._loaded=!1,this._super(config)},initialize:function(){var self=this,children=self.config.children,loadDependencies=_.isArray(children)&&_.size(children)>0&&self.config.visible;if(loadDependencies){var components=self.config.children,context=self.config.context||{};this.fire("createComponents",{components:components,context:context})}else self._super.apply(self,arguments),self._fireChildrenRendered({children:[],childrenEvtArgs:[]})},"bus componentCreated":function(evtArgs){var component=evtArgs.data.component;this.fire("childComponentCreated",component)},"bus componentsCreated":function(evtArgs){this.fire("beforeComponentsInitialize",evtArgs.data),this.initializeChildrenComponents(evtArgs),this.fire("afterComponentsInitialize",evtArgs.data)},initializeChildrenComponents:function(evtArgs){var self=this,childrenComponents=_(evtArgs.data).pluck("component"),childrenConfigs=_(evtArgs.data).pluck("config");self.dispatcher=new EventDispatcher(childrenComponents),self.dispatcher.listen("afterInit",function(evt){self.fireAfterInit()}),self.dispatcher.listen("afterRender",function(evt){var childrenEvtArgs=evt.argsArr,data={children:childrenComponents,childrenEvtArgs:childrenEvtArgs};self._fireChildrenRendered(data)}),_(childrenComponents).each(function(c,index){c.fire("initialize",childrenConfigs[index])})},_fireChildrenRendered:function(childrenData){this.fire("internalChildrenRendered",childrenData)},"bus afterInit+dataBind":function(evts){},"bus afterInit+dataBind+internalChildrenRendered":function(evts){this.destroyChildComponents();var self=this,afterInitEvtData=evts.afterInit.data,dataBindEvtData=evts.dataBind.data,internalChildrenRenderedEvtData=evts.internalChildrenRendered.data;self.children=internalChildrenRenderedEvtData.children,self.config.visible&&(self._loaded=!0);if(internalChildrenRenderedEvtData.children.length===0)self.render(dataBindEvtData,afterInitEvtData);else{self.fireBeforeRender({data:dataBindEvtData});var newElement=self.bindTemplate(dataBindEvtData);newElement.find("[runas]").each(function(i,node){var $el=$(this),componentType=$el.attr("runas"),componentId=$el.attr("componentId"),detectedItem=_(internalChildrenRenderedEvtData.childrenEvtArgs).detect(function(item,i){var itemCfg=item.view.config;return itemCfg.type===componentType&&itemCfg.id.toString()===componentId});if(!detectedItem){var message='Component "'+componentId+'" type of ['+componentType+"] not found";throw message}var $ctrlElement=detectedItem.element;$el.replaceWith($ctrlElement)}),newElement=self.prepareElement(newElement),self.fire("childrenRendered",internalChildrenRenderedEvtData.children),self.updateElement(newElement,afterInitEvtData.refreshSelector),!self.config.visible&&self.hide(),self.fireAfterRender({data:dataBindEvtData})}},"bus show":function(){this._super(),this._loaded||this.fire("initialize",{})},lifeCycleCleanUp:function(){this._super()},destroyChildComponents:function(){delete this.dispatcher;var item=null;if(this.children&&this.children.length)while(item=this.children.pop())item.destroy();delete this.children},destroy:function(){this.destroyChildComponents(),this._super()}});return ComposerView});
define('tau/models/model.progressBar',["tau/core/model-base"],function(ModelBase){var initialDataProcessor=function(model){this.model=model};initialDataProcessor.prototype={setEntity:function(result){this.entity=result.data},done:function(){if(!this.model.config)return;var e=this.model.entity=this.entity;if(!e)return;var data={id:e.id,entityType:{name:e.__type},entityState:{id:e.entityState.id,name:e.entityState.name,isFinal:e.entityState.isFinal},effortCompleted:e.effortCompleted,effortToDo:e.effortToDo,timeSpent:e.timeSpent,timeRemain:e.timeRemain},total=Math.round(100*parseFloat(data.effortToDo)+100*parseFloat(data.effortCompleted))/100;data.percentCompleted=Math.round(1e4*(data.effortCompleted/total))/100,data.percentCompleted=isNaN(data.percentCompleted)?0:data.percentCompleted,data.percentCompleted=data.percentCompleted>100?100:data.percentCompleted,e.entityState.isFinal&&(data.percentCompleted=100),data.disableSpentRemain=this.model.config.context.getTimeTrackingPolicies().disableSpentRemain;var max=this.model.config.maxWidthPercents;_.isUndefined(max)===!1?data.maxWidthPercents=max:data.maxWidthPercents=100,this.model.bus.fire("dataBind",data)}};var progressBarModel=ModelBase.extend({name:"Progress Bar",beforeSaveRoleEffort:function(evt){var config=evt.data.cmd.config;config.fields=config.fields||[],config.fields.push({assignable:["id","effortCompleted","effortToDo","timeSpent","timeRemain"]})},afterSaveEntity:function(command){var data=command.data;data.changes.hasOwnProperty("timeRemain")&&data.id===this.config.context.entity.id&&this.fire("remainTimeChanged")},afterSaveRoleEffort:function(command){var self=this;self.fire("roleEffortChanged")},onDataUpdated:function(evt){var self=this;self.fire("refresh")},onInit:function(){var self=this,proc=new initialDataProcessor(this),ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,fields=["effortCompleted","effortToDo","timeSpent","timeRemain",{entityState:["id","name","isFinal"]}],beforeSaveCallback=function(evt){var requiredUpdates=evt.data.cmd.config.fields;evt.data.cmd.config.fields=requiredUpdates.concat(fields),self.fire("beforeChanges",evt.data.changes)},afterSaveCallback=function(evt){var cmd=evt.data?evt.data.cmd:null;if(cmd!=null&&self.isInTransaction(evt))return;self.fire("applyChanges",evt.data.changes)};self.store.unbind(this),self.store.on({eventName:"beforeSave",type:entityTypeName,filter:{id:ctx.entity.id},hasChanges:["entityState"],listener:this},beforeSaveCallback),self.store.on({eventName:"afterSave",type:entityTypeName,filter:{id:ctx.entity.id},hasChanges:["entityState"],listener:this},afterSaveCallback),self.store.on({eventName:"afterSave",type:entityTypeName,filter:{id:ctx.entity.id},hasChanges:["effort|effortCompleted|effortToDo|timeSpent|timeRemain"],listener:self},_.bind(self.onDataUpdated,self)),self.store.on({eventName:"beforeSave",type:"roleEffort",listener:this},function(){self.beforeSaveRoleEffort.apply(self,arguments)}),self.store.on({eventName:"afterSave",type:"roleEffort",filter:{assignable:{id:ctx.entity.id}},listener:this},function(evt){if(self.isInTransaction(evt))return;self.afterSaveRoleEffort.apply(self,arguments)}),self.store.on({eventName:"afterSave",type:entityTypeName,listener:this},function(){self.afterSaveEntity.apply(self,arguments)}),this.store.get(entityTypeName,{id:entityId,fields:fields},{success:proc.setEntity,scope:proc}).done({success:proc.done,scope:proc})},isInTransaction:function(evt){var self=this,cmd=evt.data?evt.data.cmd:{};return cmd===self.lastCmd?!0:(self.lastCmd=cmd,!1)},"bus evict":function(){var entity=this.config.context.entity;this.store.evictProperties(entity.id,entity.entityType.name,["effortCompleted","effortToDo","timeSpent","timeRemain","entityState"])}});return progressBarModel});
define('tau/models/model.state.editable',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({category:"edit",name:"Editable State","bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0})},"bus beforeSave":function(evt){var config=evt.data.cmd,fields=config.fields||[];fields=fields.concat(["effortCompleted","effortToDo","timeSpent","timeRemain"]),config.fields=fields}})});
define('tau/ui/extensions/progressBar/ui.extension.progressBar.updater',["tau/components/extensions/component.extension.base","tau/ui/behaviour/overlay/ui.behaviour.overlay"],function(ExtensionBase){var progressBarUpdater=ExtensionBase.extend({"bus afterRender":function(evt){this.$el=evt.data.element,this.config.context.getTimeTrackingPolicies().disableSpentRemain&&this.$el.find(".ui-progressbar__data").hide()},"bus roleEffortChanged":function(){this.fire("refresh")},"bus remainTimeChanged":function(){this.fire("refresh")},"bus beforeChanges":function(evt){this.$el.tauOverlay()},"bus applyChanges":function(evt){this.$el.tauOverlay("hide"),this.fire("refresh")}});return progressBarUpdater});
define('tau/ui/templates/progressBar/ui.template.progressBar',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/common/ui.template.attributeValue"],function(templates,termTag){var config={name:"progress-bar",tags:[termTag],markup:['<div class="entity-progress-box">','   <div class="state-select">{{term(entityType.name) "name"}} is','      <div componentId="ctrlEntityState" runas="property.entityState"></div>',"   </div>",'   <div class="ui-progressbar__data">','      <span class="ui-label-spent ui-progressbar__data__spent">Spent&nbsp;<b class="value">${timeSpent}h</b></span>','      <span class="ui-label-remain  ui-progressbar__data__remain">Remain&nbsp;<b class="value">${timeRemain}h</b></span>',"   </div>",'   <div class="ui-progress-bar-progress ui-progressbar__progress">',"{{if percentCompleted !== 0 }}",'      <span class="ui-progress-progress ui-progressbar__progress__indicator" style="width:${ Math.round(percentCompleted) < 15 ? 15 : Math.round(percentCompleted) }%;">','         <span class="ui-label ui-progressbar__progress__label"><b class="value">${ Math.round(percentCompleted) }%</b></span>',"      </span>","{{/if}}","   </div>","</div>"],dependencies:["common-attributeValue"]};return templates.register(config)});
define('tau/components/component.progressBar',["Underscore","tau/components/component.creator","tau/views/view.composer","tau/components/extensions/component.creator.extension","tau/models/model.progressBar","tau/models/model.state.editable","tau/ui/extensions/progressBar/ui.extension.progressBar.updater","tau/ui/extensions/ui.extensions.onMarkAsDuplicate","tau/ui/templates/progressBar/ui.template.progressBar"],function(_,creator,ViewComposer,ComponentCreatorExtension,ModelType,Editable,Updater,ExtensionMarkAsDuplicate,template){return{create:function(config,componentConfig){componentConfig=componentConfig||{};var creatorConfig={ViewType:ViewComposer,extensions:[componentConfig.model||ModelType,Editable,ComponentCreatorExtension,Updater,ExtensionMarkAsDuplicate],template:componentConfig.template||template},extensions=config.extensions||[];for(var i=0;i<extensions.length;i++)creatorConfig.extensions.push(extensions[i]);return _(config).extend({children:[{id:"ctrlEntityState",type:"property.entityState",disabledExtensionCategories:config.disabledExtensionCategories}]}),creator.create(creatorConfig,config)}}});
define('tau/ui/templates/progressBar/ui.template.progressBar.small',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/common/ui.template.attributeValue"],function(templates,termTag){var titleTmpl=["{{if disableSpentRemain === false}}","Time spent: ${timeSpent}{{if timeSpent}}h{{/if}}  ","Time remain: {{if !timeRemain && timeRemain !== 0}}N/A{{else}}${timeRemain}{{if timeRemain}}h{{/if}}{{/if}}  ","{{/if}}","Percent complete: ${Math.round(percentCompleted)}%"].join(""),config={name:"progress-bar-small",tags:[termTag],markup:["<div>","{{if maxWidthPercents > 0}}",'    <div class="ui-progress-bar-progress ui-progressbar__progress tau-extension-tooltip" style="width:${maxWidthPercents}%;" title="'+titleTmpl+'">','        <span class="ui-progress-progress ui-progressbar__progress__indicator" style="width:${percentCompleted}%;{{if percentCompleted == 0}}display:none;{{/if}}"></span>',"    </div>","{{else}}",'   <div{{if maxWidthPercents == 0}} class="tau-extension-tooltip" title="'+titleTmpl+'"{{/if}}>',"   </div>","{{/if}}","</div>"]};return templates.register(config)});
define('tau/components/component.progressBar.small',["Underscore","tau/components/component.creator","tau/components/extensions/component.creator.extension","tau/models/model.progressBar","tau/ui/extensions/progressBar/ui.extension.progressBar.updater","tau/ui/extensions/ui.extension.tooltip","tau/ui/templates/progressBar/ui.template.progressBar.small"],function(_,creator,ComponentCreatorExtension,Model,Updater,Tooltip,template){return{create:function(config,componentConfig){componentConfig=componentConfig||{};var creatorConfig={extensions:[Model,Updater,Tooltip],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.property.simple',["tau/core/model-base"],function(ModelBase){return ModelBase.extend({init:function(config){this._super.apply(this,arguments);if(!config.propertyName)throw"PropertyName was not configured";this.propertyName=config.propertyName,this.placeholderText=_.asString(config.placeholderText),this.listenedEntities={}},getEntityTypeName:function(){return this.config.context.entity.entityType.name},getEntityId:function(){return this.config.context.entity.id},listenOfPropertyChanged:function(){var entityId=this.config.context.entity.id;this.listenedEntities[entityId]||(this.listenedEntities[entityId]=!0,this.attachToChangePropertiesOfCurrentEntity(this.propertyName))},onInit:function(){this.listenOfPropertyChanged(),this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",this.propertyName]}).done({success:this.onEntityRetrieved,scope:this})},onEntityRetrieved:function(r){var value=this.config?r[0].data[this.propertyName]||this.config.defaultText:"";this.fire("dataBind",{name:this.propertyName,text:value,output:value,placeholderText:this.placeholderText})}})});
define('tau/models/model.property.text',["tau/models/model.property.simple"],function(ModelBase,datesUtil){return ModelBase.extend({})});
define('tau/models/model.property.text.editable',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({"bus dataBind":function(){this.bus.fire("permissionsReady",{editable:this.config.editable})}})});
define('tau/models/model.property.text.validation',["tau/core/model-base","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema,dateUtils){var model=ModelBase.extend({category:"edit",name:"Model text validation",schema:jsonSchema.Schema.create({type:"string",optional:!1,empty:!1,maxLength:50,minLength:0,pre:["trim"]}),"bus afterRender":function(evt){this.$element=evt.data.element},"bus validate":function(evt){this.$element.find(".property-text").dateEditor("resetValidationErrors");var args=evt.data,data=args.cmd.$set[this.config.propertyName];args.validation=this.schema.validate(data);if(!args.validation||args.validation.isError()!=1)args.validation=this.schema.validate(data),args.cmd.$set[this.config.propertyName]=args.validation.instance},"bus afterValidate":function(evt){var validation=evt.data.validation;this.$element.find(".property-text").editableText("setValue",validation.instance)},"bus validationFailed":function(evt){var validation=evt.data.validation;this.$element.find(".property-text").editableText("setValidationErrors",validation.errors[0].description)}});return model});
define('tau/models/model.property.abbreviation.validation',["tau/models/model.property.text.validation","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",schema:jsonSchema.Schema.create({type:"string",optional:!0,empty:!0,maxLength:3,pre:["trim"],post:[function(d){return(d+"").toUpperCase()},function(d){var reg=/^[\d-a-z]{1,3}$/i;return d.match(reg)||new this.Error("Abbr","Should contain letters or digits"),d}]}),"bus beforeInit":function(evt,initConfig){initConfig.config.required?(this.schema.empty=!1,this.schema.optional=!1):(this.schema.empty=!0,this.schema.optional=!0)}});return model});
define('tau/components/extensions/property/extension.property.text.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender":function(eventData){var self=this,permissions=this.permissions=eventData.permissionsReady.data;if(permissions.editable){var config=this.config,$el=this.$el=eventData.afterRender.data.element,$widget=$el.hasClass("property-text")?$el:$el.find(".property-text");self.$widget=$widget,$widget.editableText({restoreText:config.restoreText?!0:!1,mask:(config||{}).mask,onSave:function(date){var $set={};$set[self.config.propertyName]=date;var savedData={$set:$set};savedData.$include=[self.config.propertyName],self.bus.fire("save",savedData)}})}},"bus edit":function(){this.permissions.editable&&this.$el.find(".property-text").editableText("activate")}})});
define('tau/components/extensions/property/extension.property.refresher',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"refresher","bus propertyChanged":function(){this.fire("refresh")},"bus avatarChanged":function(){this.fire("refresh")}})});
define('tau/ui/templates/property/ui.template.property',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink.full"],function(templates){var config={name:"property",markup:["<div>",'<span class="property tau-property{{if name}} tau-property-${name}{{/if}}{{if !text}} tau-property_empty_true{{/if}}">',"{{if hasUrl}}",'<span class="property-text tau-property__value" data-placeholder="${placeholderText}">','{{tmpl($data) "entity-link-full"}}',"</span>","{{else}}",'<span class="property-text tau-property__value" data-placeholder="${placeholderText}">${text}</span>',"{{/if}}","</span>","{{if subtext}}",'<div class="tau-property__subtext">${subtext}</div>',"{{/if}}","</div>"].join(""),dependencies:["entity-link-full"]};return templates.register(config)});
define('tau/components/component.property.abbreviation',["Underscore","tau/components/component.creator","tau/models/model.property.text","tau/models/model.property.text.editable","tau/models/model.property.abbreviation.validation","tau/components/extensions/property/extension.property.text.editable","tau/components/extensions/property/extension.property.refresher","tau/ui/templates/property/ui.template.property"],function(_,creator,Model,ModelEditable,ModelValidation,ExtensionEditable,ExtensionRefresher,template){return{create:function(config){config.propertyName="abbreviation";var creatorConfig={ModelType:Model,extensions:[ModelEditable,ModelValidation,ExtensionEditable,ExtensionRefresher],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.property',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({init:function(config){this._super.apply(this,arguments);if(!config.propertyName)throw"PropertyName was not configured";this.propertyName=config.propertyName,this.displayField=config.displayField||"name",this.valueField=config.valueField||"id",this.listenedEntities={}},isPropertyChanged:function(propertyList,data){var changes=data.changes,$set=data.cmd&&data.cmd.config.$set||{},id=data.cmd&&data.cmd.config.id;return _.any(propertyList,function(property){return changes&&changes.hasOwnProperty(property)||id&&$set.hasOwnProperty(property)})},getEntityTypeName:function(){return this.config.context.entity.entityType.name},getEntityId:function(){return this.config.context.entity.id},buildRequest:function(propertyField){var chain=this.store;return chain=chain.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",propertyField]}),chain},getPropertyData:function(propertyField){var chain=this.buildRequest(propertyField);chain.done({success:this.onEntityRetrieved,scope:this})},getPropertyFields:function(){return[this.displayField,this.valueField]},onInit:function(){this._super.apply(this,arguments);var propertyField={};propertyField[this.propertyName]=this.getPropertyFields(),this.listenOfPropertyChanged(),this.getPropertyData(propertyField)},listenOfPropertyChanged:function(){var entityId=this.config.context.entity.id;this.listenedEntities[entityId]||(this.listenedEntities[entityId]=!0,this.attachToChangePropertiesOfCurrentEntity(this.propertyName))},onProcessProperty:function(property){if(!this.config)return;var data={id:property[this.valueField],name:this.propertyName.toLowerCase(),text:property[this.displayField],isEditable:this.config.editable};return this.config.showUrl&&property.id&&(data.hasUrl=!0,data.__type=property.__type,data.id=property.id,data.url=this.config.context.configurator.getUrlBuilder().getNewViewUrl(property.id,property.__type,!0)),data.placeholderText=this.config.placeholderText,data.value=data.text,data},processProperty:function(property){var data=this.onProcessProperty(property);this.fire("dataBind",data)},onEntityRetrieved:function(r){if(!this.config)return;var property=this.property=r[0].data[this.propertyName]||{};this.processProperty(property)},entityBelongCurrentContext:function(data){return data.changes.hasOwnProperty(this.config.propertyName)&&data.cmd.config.id==this.config.context.entity.id},onEntityAfterSave:function(evtArgs){var data=evtArgs.data;this.entityBelongCurrentContext(data)&&this.fire("changed",data)},onEntityBeforeSave:function(evtArgs){var data=evtArgs.data;this.entityBelongCurrentContext(data)&&this.fire("beforeChanged",data)}})});
define('tau/models/model.property.editable',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({"bus beforeInit+dataBind":function(evt){this.fire("permissionsReady",{editable:this.config.editable!=0})}})});
define('tau/components/extensions/property/extension.property.editable',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,$element=this.element=eventData.afterRender.data.element;eventData.afterRender.data.element.find(".external-view").click(function(e){e.stopPropagation()});var permissions=this.permissions=eventData.permissionsReady.data;if(permissions.editable===!1)return;$element.find(".tau-property").addClass("tau-property_editable_true"),$element.addClass("tau-editable");var data=eventData.dataBind.data;(!data.text||!data.text.length)&&$element.find(".property").addClass("editable");if(permissions.editable){this.config.targetElementSelector=this.config.targetElementSelector||".property-text";var target=this.config.targetElementSelector||"",align=this.config.alignElementSelector||"",componentsConfig={components:[_.extend({data:data},this.config.editorComponentConfig)],context:self.config.context},bubbleConfig={target:$element.is(target)?$element:$element.find(target),alignTo:$element.is(align)?$element:$element.find(align),componentsConfig:componentsConfig,applyBubbleClasses:this.config.applyBubbleClasses,stackName:this.config.alignElementSelector||"default",className:this.config.bubbleClassName,onShow:_.bind(function(){this.config.context.configurator.getKeyBoardManager().pushHandler({})},this),onHide:_.bind(function(){this.config.context.configurator.getKeyBoardManager().popHandler()},this)};this.fire("initBubble",bubbleConfig)}},"bus edit":function(){this.permissions.editable&&this.fire("toggleBubble")}})});
define('tau/components/component.property',["Underscore","tau/components/component.creator","tau/core/termProcessor","tau/models/model.property","tau/models/model.property.editable","tau/components/extensions/property/extension.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/property/ui.template.property"],function(_,creator,TermProcessor,PropertyModelType,PropertyModelTypeEditable,ExtensionPropertyEditable,ExtensionPropertyRefresher,BubbleCreator,ComponentCreatorExtension,template){return{create:function(config){var tp=new TermProcessor(config.context.getTerms()),editorConfig=config.editorComponentConfig||{};editorConfig.resetDisabled=config.resetDisabled,editorConfig.showEmptyDataMessage&&(editorConfig.emptyDataMessage="No "+tp.getTerms(config.propertyName).names.toLowerCase()+" found"),editorConfig.showClearValue&&(config.clearValueLabel="reset "+tp.getTerms(config.propertyName).name.toLowerCase()),config.placeholderText=config.placeholderText||"click to edit";var creatorConfig={ModelType:config.Model||PropertyModelType,template:config.template||template,extensions:_.concat([config.extensions,BubbleCreator,ComponentCreatorExtension,PropertyModelTypeEditable,ExtensionPropertyRefresher,ExtensionPropertyEditable])};return creator.create(creatorConfig,config)}}});
define('tau/models/model.property.assignable',["tau/models/model.property"],function(ModelBase){return ModelBase.extend({onInit:function(){var self=this;self._super.apply(self,arguments),self.store.unbind(self),self.store.on({type:self.getEntityTypeName(),eventName:"beforeSave",listener:self,filter:{id:self.getEntityId()},hasChanges:[self.propertyName]},function(args){self.store.evictProperties(self.getEntityId(),self.getEntityTypeName(),[self.config.refField]),self.fire("beforeChanged",args.data)}),self.store.on({type:self.getEntityTypeName(),eventName:"afterSave",listener:self,filter:{id:self.getEntityId()},hasChanges:[self.propertyName]},function(args){self.fire("propertyChanged",args.data)})},getPropertyData:function(){var self=this;self.store.get(self.getEntityTypeName(),{id:self.getEntityId(),fields:["id",self.config.refField]},{success:function(args){if(!args.data[self.config.refField]||args.data[self.config.refField].length===0){self.processProperty({});return}self.store.get("assignable",{id:args.data[self.config.refField][0],fields:[self.displayField,self.valueField]},{success:function(args){self.processProperty(args.data)}}).done()},scope:self}).done()}})});
define('tau/models/finder/model.relation.editor',["Underscore","tau/core/model.editable.base"],function(_,ModelBase){return ModelBase.extend({"bus entitySelected":function(evt){var $set={};$set[this.config.propertyName]=null;var entity=evt.data.entity;entity&&entity.id&&($set[this.config.propertyName]={id:entity.id});var context=this.config.context;this.config.store.evictProperties(context.entity.id,context.entity.entityType.name,[this.config.propertyName]),this.fire("save",{$set:$set})}})});
define('tau/components/component.property.assignable',["tau/components/component.property","tau/models/model.property.assignable","tau/models/finder/model.assignable.search","tau/models/finder/model.relation.editor"],function(PropertyComponent,Model,Search,Edit){return{create:function(config){return config.propertyName="assignable",config.refField="$ref:assignable[id]",config.showUrl=!0,config.Model=Model,config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"finder",resetDisabled:!0,propertyName:"assignable",searchModel:Search,additionalExtensions:[Edit],listType:"userStory",maxHeight:400},PropertyComponent.create(config)}}});
define('tau/models/model.property.bool',["tau/core/model-base"],function(ModelBase){return ModelBase.extend({init:function(config){this._super.apply(this,arguments);if(!config.propertyName)throw"PropertyName was not configured";this.propertyName=config.propertyName},getEntityTypeName:function(){return this.config.context.entity.entityType.name},getEntityId:function(){return this.config.context.entity.id},onInit:function(){this.store.unbind(this),this.attachToChangePropertiesOfCurrentEntity(this.propertyName),this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",this.propertyName]}).done({success:this.onEntityRetrieved,scope:this})},onEntityRetrieved:function(r){if(!this.config)return;var entity=r[0].data,data={value:entity[this.propertyName]},label=this.config.label;label&&(data.label=label),this.fire("dataBind",data)}})});
define('tau/components/extensions/property/extension.property.bool.editable',["Underscore","tau/components/extensions/component.extension.base","tau/ui/behaviour/checkbox/ui.behaviour.checkboxToggle"],function(_,ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,$element=this.element=eventData.afterRender.data.element,permissions=this.permissions=eventData.permissionsReady.data,data=eventData.dataBind.data;if(permissions.editable){var $widget=$element.find(".property .ui-checkbox");$widget.checkboxToggle({classNames:{checked:"checked",unchecked:"unchecked"},onSave:function(checked){self.fire("elementUpdated");var $cmd={};$cmd[self.config.propertyName]=checked,self.fire("save",$cmd)}})}},"bus edit":function(){this.permissions.editable&&this.element.find(".property .ui-checkbox").checkboxToggle("toggle")}})});
define('tau/ui/templates/property/ui.template.bool',["tau/core/templates-factory"],function(templates){var config={name:"property-bool",markup:["<div>",'<span class="property"><div class="ui-checkbox {{if value}}checked{{/if}}{{if !value}}unchecked{{/if}}">&nbsp;</div></span>','{{if label}}<span class="tau-label">${label}</span>{{/if}}',"</div>"].join("")};return templates.register(config)});
define('tau/components/component.property.bool',["Underscore","tau/components/component.creator","tau/models/model.property.bool","tau/models/model.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/property/extension.property.bool.editable","tau/ui/templates/property/ui.template.bool"],function(_,creator,PropertyModelType,PropertyModelEditable,ExtensionRefresher,EditableExtension,template){return{create:function(config){var extensions=_.concat([config.extensions,ExtensionRefresher]);config.editable===!0&&(extensions=_.concat([extensions,EditableExtension,PropertyModelEditable]));var creatorConfig={ModelType:PropertyModelType,template:config.template||template,extensions:extensions};return creator.create(creatorConfig,config)}}});
define('tau/models/finder/model.build.search',["Underscore","tau/models/finder/model.assignable.search"],function(_,ModelBase){return ModelBase.extend({init:function(config){this._super(config),delete this.properties.state,delete this.properties.priority},setInitialLimits:function(data){this.initialLimits=data},getInitialQueryConfig:function(){return{$skip:0,$limit:20,$query:{}}},getInitialQueryString:function(){return""},getType:function(){return"build"},"bus requireSearchConfig":function(evt){var self=this,project=evt.data.project,entity=this.config.context.entity;this.config.store.get(entity.entityType.name,{id:entity.id,fields:["id",{project:["id"]}]}).done({success:function(result){var entity=result[0].data,q={"Project.Id":null};entity.project&&(q["Project.Id"]=entity.project.id),self.setInitialLimits(q);var config={$skip:0,$limit:20,$query:q},searchQuery=self.getInitialQueryString();self.fire("searchConfigFormed",{type:self.getType(),config:config,properties:self.properties,searchQuery:searchQuery})}})},"bus search":function(evt){var config=evt.data,self=this,searchCollection=config.collection,$query={};_.each(searchCollection,function(val){var property=self.properties[val.property];if(!property)return;var name=property.name?property.name:val.property;property.statement($query,name,val.value)}),$query=_.extend($query,this.initialLimits),self.bus.fire("newSearchQuery",{type:self.getType(),config:{$query:$query,$skip:0,$limit:20}})}})});
define('tau/components/component.property.build',["tau/components/component.property","tau/models/finder/model.build.search","tau/models/finder/model.relation.editor"],function(PropertyComponent,SearchModel,Model){return{create:function(config){return config.propertyName="build",config.showUrl=!0,config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"finder",propertyName:"build",fields:["id","name",{project:["id","abbreviation"]}],searchModel:SearchModel,additionalExtensions:[Model],listType:"build",maxHeight:400},PropertyComponent.create(config)}}});
define('tau/components/extensions/property/extension.property.build.refresher',["Underscore","tau/core/model-base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"refresher","bus afterInit":function(){var store=this.store,entity=this.config.context.entity,self=this;this.store.unbind(this),store.on({eventName:"afterSave",type:"testplanrun",listener:this,filter:{id:entity.id}},function(e){var changes=e.data.changes;(changes.hasOwnProperty("release")||changes.hasOwnProperty("iteration"))&&self.bus.fire("refresh")})}})});
define('tau/models/finder/model.build.testPlanRun.search',["Underscore","tau/models/finder/model.build.search"],function(_,ModelBase){return ModelBase.extend({"bus requireSearchConfig":function(evt){var self=this,project=evt.data.project,entity=this.config.context.entity;this.config.store.get("testPlanRun",{id:entity.id,fields:["id",{project:["id",{process:["id",{practices:["id","name"]}]}]},{release:["id"]},{iteration:["id"]}]}).done({success:function(result){var entity=result[0].data||{};_.defaults(entity.project,{process:{practices:[]}});var practices=entity.project.process.practices,isAvailableIterations=_.any(practices,function(practice){return practice.name.toLowerCase()=="iterations"}),q={"Project.Id":null,"Release.Id":null};entity.project&&(q["Project.Id"]=entity.project.id),entity.release&&(q["Release.Id"]=entity.release.id),entity.iteration&&isAvailableIterations==1&&(q["Iteration.Id"]=entity.iteration.id),self.setInitialLimits(q);var config={$skip:0,$limit:20,$query:q},searchQuery=self.getInitialQueryString();self.fire("searchConfigFormed",{type:self.getType(),config:config,properties:self.properties,searchQuery:searchQuery})}})}})});
define('tau/components/component.property.build.testPlanRun',["tau/components/component.property","tau/components/extensions/property/extension.property.build.refresher","tau/models/finder/model.build.testPlanRun.search","tau/models/finder/model.relation.editor"],function(PropertyComponent,Refresher,SearchModel,Model){return{create:function(config){return config.propertyName="build",config.showUrl=!0,config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.extensions=[Refresher],config.editorComponentConfig={type:"finder",propertyName:"build",fields:["id","name",{project:["id","abbreviation"]}],searchModel:SearchModel,additionalExtensions:[Model],listType:"build",maxHeight:400},PropertyComponent.create(config)}}});
define('tau/models/model.property.date',["tau/models/model.property.simple","tau/utils/utils.date"],function(ModelBase,datesUtil){return ModelBase.extend({onEntityRetrieved:function(r){if(!this.config)return;var format=this.config.format?this.config.format:"date",entity=r[0].data;this.property=entity[this.propertyName];var text=datesUtil.format[format].short(datesUtil.convertToTimezone(this.property)),date=datesUtil.parse(this.property),data={text:text};this.fire("extendData",{dataToBind:data,entity:entity,date:date}),this.fire("dataBind",data)}})});
define('tau/models/model.property.date.validation',["tau/core/model-base","tau/utils/utils.jsonSchema","tau/utils/utils.date"],function(ModelBase,jsonSchema,dateUtils){var model=ModelBase.extend({category:"edit",name:"Model date validation",schema:jsonSchema.Schema.create({type:"string",optional:!1,empty:!1,post:function(val){if(this.wasError()==0){var date=dateUtils.parse(val),max=dateUtils.parse(this.schema.additionalProperties.max),min=dateUtils.parse(this.schema.additionalProperties.min);date==null?new this.Error("Date","Incorrect date format"):date<new Date("01/01/1900")?new this.Error("Date","Date must be greater then 1-Jan-1900"):max&&date>max?new this.Error("Date","Date must be less then "+dateUtils.format.date.short(max)):min&&date<min?new this.Error("Date","Date must be greater then "+dateUtils.format.date.short(max)):val=dateUtils.formatAs(date,this.schema.additionalProperties.dateFormat)}return val},additionalProperties:{dateFormat:dateUtils.getFormatData().date.short,max:null,min:null}}),"bus afterInit":function(){this.config.format=="datetime"&&(this.schema.additionalProperties.dateFormat=dateUtils.getFormatData().datetime.short)},"bus afterRender":function(evt){this.element=evt.data.element},"bus validateDate":function(evtArgs){var validation=this.schema.validate(evtArgs.data.value);evtArgs.data.value=validation.instance},"bus validate":function(evt){var element=this.element.find(".property");element.dateEditor("resetValidationErrors");var args=evt.data,data=args.cmd.$set[this.config.propertyName];if(!args.validation||args.validation.isError()!=1)args.validation=this.schema.validate(data),args.cmd.$set[this.config.propertyName]=args.validation.instance},"bus resetValidationErrors":function(){var element=this.element.find(".property");element.dateEditor("resetValidationErrors")},"bus afterValidate":function(evt){var validation=evt.data.validation;this.element.find(".property").dateEditor("setValue",validation.instance)},"bus validationFailed":function(evt){var element=this.element.find(".property");element.dateEditor("setValidationErrors",evt.data.validation.errors[0].description)}});return model});
define('tau/models/model.property.date.editable',["tau/core/model.editable.base","tau/utils/utils.date"],function(ModelBase,dateUtils){return ModelBase.extend({"bus dataBind":function(){this.bus.fire("permissionsReady",{editable:this.config.editable})},"bus afterValidate":function(evt){var val=evt.data.cmd.$set[this.config.propertyName];val&&(val=dateUtils.parse(val),val=dateUtils.format.datetime.short(val),evt.data.cmd.$set[this.config.propertyName]=val)}})});
define('tau/components/extensions/property/extension.property.date.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/utils/utils.date","tau/ui/behaviour/date/ui.behaviour.dateEditor"],function(_,$,ExtensionBase,dateUtils){return ExtensionBase.extend({category:"edit",init:function(){this._super.apply(this,arguments),this.onClickProxy=$.proxy(this.onClickHandler,this)},"bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,$element=this.element=eventData.afterRender.data.element,permissions=this.permissions=eventData.permissionsReady.data,data=this.date=eventData.dataBind.data,format=this.config.format;if(permissions.editable){this.element.bind("click",this.onClickProxy);var $widget=this.$widget=$element.find(".property"),widgetName=null;format=="datetime"?widgetName="datetimepicker":widgetName="datepicker",$.datepicker.parseDate=function(format,value,settings){return dateUtils.parse(value)},$.datepicker.formatDate=function(format,date,settings){return dateUtils.formatAs(date,format)},$widget.dateEditor({keyboardManager:this.config.context.configurator.getKeyBoardManager(),dateFormat:dateUtils.getFormatData().date.short,widgetName:widgetName,beforeChange:function(data){self.fire("validateDate",data)},onSave:function(date){var $set={};$set[self.config.propertyName]=date;if(self.trimString(date)!=self.trimString(data.text)){var savedData={$set:$set};savedData.$include=[self.config.propertyName],self.bus.fire("save",savedData)}else self.fire("resetValidationErrors")}})}},trimString:function(value){return _.trim(value||"")},showEditor:function(){this.$widget.dateEditor("activate"),this.$widget.focus()},"bus edit":function(){this.permissions.editable&&this.showEditor()},onClickHandler:function(){this.showEditor()},removeHandlers:function(){this.element&&this.element.unbind("click",this.onClickProxy)},removeWidget:function(){this.$widget&&this.$widget.dateEditor("destroy")},destroy:function(){this.removeHandlers(),this.removeWidget(),this._super.apply(this,arguments)}})});
define('tau/ui/templates/property/ui.template.property.date',["tau/core/templates-factory"],function(templates){var config={name:"property-date",markup:'<div><div class="property"><div class="property-text">${text}</div></div>'};return templates.register(config)});
define('tau/components/component.property.date',["Underscore","tau/components/component.creator","tau/models/model.property.date","tau/models/model.property.date.validation","tau/models/model.property.date.editable","tau/components/extensions/property/extension.property.date.editable","tau/components/extensions/property/extension.property.refresher","tau/ui/templates/property/ui.template.property.date"],function(_,creator,PropertyModelType,DateValidation,ModelEditable,ExtensionDateEditable,ExtensionRefresher,template){return{create:function(config){config=_.extend(_.clone(config)),config.validationExtension=config.validationExtension||DateValidation;var creatorConfig={ModelType:PropertyModelType,template:config.template||template,extensions:_.concat([config.extensions,ExtensionRefresher,ModelEditable,ExtensionDateEditable,config.validationExtension])};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.buildDate',["tau/components/component.property.date"],function(creator){return{create:function(config){return config=config||{},config.propertyName="buildDate",config.format="datetime",creator.create(config)}}});
define('tau/models/property.simple/model.property.simple',["tau/core/model-base"],function(ModelBase){return ModelBase.extend({"bus beforeInit":function(evt,initConfig){var configurator=initConfig.config.context.configurator,entity=initConfig.config.context.entity,fieldName=initConfig.config.editorComponentConfig.name;this.attachToChangePropertiesOfCurrentEntity(fieldName);var self=this;configurator.getStore().get(entity.entityType.name,{id:entity.id,fields:[fieldName]}).done({success:function(r){var data=r[0].data;self.fire("dataBind",{name:fieldName,value:data[fieldName],output:data[fieldName]})}})}})});
define('tau/ui/templates/property/ui.template.property.color',[],function(){return{name:"property.color",engine:"jqote2",markup:["<div>",'<span class="property tau-property tau-property-<%! this.name %> <% if (!this.value) { %> tau-property_empty_true<% } %>">','<span class="property-text tau-property__value i-role-output" data-placeholder="<%! this.placeholderText || "click to edit" %>">',"<% if (this.value) { %>",'<i class="tau-icon tau-icon_type_color" style="background-color: <%= this.value %>;"></i>',"<% } %>","</span>","</span>","</div>"]}});
define('tau/components/component.property.color',["tau/components/component.creator","tau/models/property.simple/model.property.simple","tau/models/model.property.editable","tau/components/extensions/property/extension.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/property/ui.template.property.color"],function(creator,Model,ModelEditable,ExtensionEditable,ExtensionRefresher,ExtensionBubble,ExtensionCreator,Template){return{create:function(config){config=config||{},config.editable=!0,config.bubbleClassName="tau-bubble-color",config.editorComponentConfig={type:"state-list",listType:"static",name:"color",showClearValue:!0,allowToReset:!0,clearValueLabel:"reset",showReset:!1,values:[{id:null,name:'<i  class="tau-icon tau-i-close"></i>',asHtml:!0}].concat(_.map(config.values,function(v){return{id:v,name:v?'<i class="tau-icon tau-icon_type_color" style="background-color:'+v+';"></i>':"",asHtml:!0}})||[])};var creatorConfig={extensions:[Model,ModelEditable,ExtensionEditable,ExtensionRefresher,ExtensionBubble,ExtensionCreator].concat(config.extensions||[]),template:Template};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.company',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="company",config.showUrl=!1,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"company",maxHeight:200,filter:!1,expandable:!1,showEmptyDataMessage:!1,clearValueLabel:"no company",defaultValueLabel:"current",fullModeLabel:"show old",emptyDataMessage:"No company found",showReset:!0},PropertyComponent.create(config)}}});
define('tau/components/component.property.completeDate',["tau/components/component.property.date"],function(creator){return{create:function(config){return config=_.clone(config||{}),config.propertyName="endDate",creator.create(config)}}});
define('tau/components/component.property.createDate',["tau/components/component.property.date"],function(creator){return{create:function(config){return config=config||{},config.propertyName="createDate",creator.create(config)}}});
define('tau/models/model.property.effort',["tau/core/model-base"],function(ModelBase){var EffortModel=ModelBase.extend({onInit:function(){var self=this,ctx=self.config.context,typeName=ctx.entity.entityType.name,entityId=ctx.entity.id;self.store.unbind(self),self.store.on(self.getSubscriptionConfig("afterSave"),_.bind(self.onEntityAfterSave,self)),self.store.on(self.getSubscriptionConfig("beforeSave"),_.bind(self.onEntityBeforeSave,self)),self.store.get(typeName,{id:entityId,fields:["id","effort",{roleEfforts:["id",{role:["id","hasEffort"]}]}]}).done({scope:self,success:self.done})},done:function(r){var self=this,entity=r[0].data,ctx=self.config.context,typeName=ctx.entity.entityType.name,data={id:entity.id,effort:Math.round(100*entity.effort)/100,unit:ctx.getEffortPoint(typeName),roleEfforts:entity.roleEfforts};self.fire("dataBind",data)},getSubscriptionConfig:function(eventName){var self=this,entity=self.config.context.entity;return{eventName:eventName,type:"roleEffort",listener:self,filter:{assignable:{id:entity.id}},hasChanges:["effort"]}},onEntityAfterSave:function(evtArgs){this.fire("propertyChanged")},onEntityBeforeSave:function(evtArgs){this.fire("beforeChangeProperty")}});return EffortModel});
define('tau/models/model.property.effort.editable',["tau/core/model.editable.base","Underscore"],function(ModelBase,_){var EditablePropertyEffortModel=ModelBase.extend({name:"Effort Editable","bus beforeInit+dataBind":function(){var self=this,permissions={editable:!0};this.fire("permissionsReady",permissions)}});return EditablePropertyEffortModel});
define('tau/ui/templates/assignmentsList/ui.template.assignments.effortsOnly.effortsList',["tau/core/templates-factory"],function(templates){var config={name:"ui.template.assignments.effortsOnly.effortsList",markup:["{{if roleEffort}}",'<tr class="tau-row group" roleId="${role.id}">',"   <td><span>${role.name}</span></td>",'   <td class="tau-cell-role-effort-value role-effort"><div class="effort">${roleEffort.effort}<span class="point">${$item.effortPoints}</span></div></td>',"</tr>","{{/if}}"].join(""),dependencies:[]};return templates.register(config)});
define('tau/ui/templates/assignmentsList/ui.template.assignments.effortsOnly',["tau/core/templates-factory","tau/ui/templates/assignmentsList/ui.template.assignments.effortsOnly.effortsList"],function(templates){var config={name:"ui.template.assignments.effortsOnly",markup:['<table class="assignments-table-readonly tau-assignments-effort-only">','   <tr class="tau-header-row tau-row-delimiter">','       <td class="tau-header-cell-title"></td>','       <td class="tau-header-cell-value">Effort</td>',"    </tr>",'   {{tmpl(assignments.groups, {effortPoints: effortPoints}) "ui.template.assignments.effortsOnly.effortsList"}}',"{{if tasksEffort}}",'   <tr class="tau-footer-row tau-row-delimiter">',"       <td>Tasks</td>","       <td>${tasksEffort.effort} h</td>","   </tr>","{{/if}}",'   <tr class="tau-footer-row tau-footer-row-total">',"       <td>Total</td>","       <td><span>${totalEffort.effort} ${effortPoints}</span></td>","   </tr>","</table>"].join(""),dependencies:["ui.template.assignments.effortsOnly.effortsList"]};return templates.register(config)});
define('tau/ui/extensions/effort/extension.effort.editable',["tau/components/extensions/component.extension.base","tau/ui/templates/assignmentsList/ui.template.assignments.effortsOnly","tau/ui/behaviour/common/ui.behaviour.editableText"],function(ExtensionBase,templateAssignmentsEfforts){return ExtensionBase.extend({category:"edit",normalizeEffort:function(effortVal){return Math.abs(Math.round(parseFloat(effortVal)*100)/100)||0},"bus afterRender+beforeChangeProperty":function(evt){var $element=evt.afterRender.data.element;this.fire("markElementToBeUpdated",{element:$element})},"bus propertyChanged":function(evt){this.fire("refresh")},"bus refresh+afterRender":function(evt){var $element=evt.afterRender.data.element;this.fire("updateElement",{element:$element})},hasEffortIterator:function(roleEffort){return roleEffort.role.hasEffort},"bus permissionsReady+dataBind+afterRender":function(eventData){var self=this,permissions=eventData.permissionsReady.data,dataToBind=eventData.dataBind.data;if(permissions.editable){var rolesCount=_(dataToBind.roleEfforts).chain().select(self.hasEffortIterator).size().value();permissions.editMode="disabled",rolesCount&&(permissions.editMode=rolesCount===1&&self.config.entitiesCount==0?"inline":"roleEfforts");var $element=eventData.afterRender.data.element,$effortText=$element.find(".entity-effort");if(permissions.editMode==="inline")$effortText.editableText({mask:/^\d*\.?\d*$/,restoreText:!0,onSave:function(effortText){var effortValue=self.normalizeEffort(effortText),theRoleEffort=_(dataToBind.roleEfforts).detect(self.hasEffortIterator),cmd={typeName:"roleEffort",id:theRoleEffort.id,$set:{effort:effortValue}};self.bus.fire("save",cmd)},onEditStart:function(){self._$additionalInfo=$effortText.find(".entity-effort-info").detach()},onEditEnd:function(){self._$additionalInfo.appendTo($effortText)}});else if(permissions.editMode==="roleEfforts"){var componentsConfig={components:[{type:"assignmentsList",template:templateAssignmentsEfforts}],context:self.config.context},bubbleConfig={target:$effortText,componentsConfig:componentsConfig};self.fire("initBubble",bubbleConfig)}}}})});
define('tau/ui/templates/property.effort/ui.template.property.effort',["tau/core/templates-factory","tau/ui/templates/property.effort/ui.template.property.effort.content"],function(templates){var config={name:"ui.template.property.effort",markup:['<div class="tau-property">{{tmpl($item.data) "ui.template.property.effort.content"}}</div>'],dependencies:["ui.template.property.effort.content"]};return templates.register(config)});
define('tau/components/component.property.effort',["tau/components/component.creator","tau/models/model.property.effort","tau/models/model.property.effort.editable","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/extensions/effort/extension.effort.editable","tau/ui/extensions/ui.extension.tooltip","tau/ui/templates/property.effort/ui.template.property.effort"],function(creator,ModelType,EditableModelType,ExtensionBubbleCreator,ExtensionComponentCreator,EditableExtensionType,ExtensionTooltip,template){return{create:function(config){var creatorConfig={extensions:[ModelType,EditableModelType,EditableExtensionType,ExtensionBubbleCreator,ExtensionComponentCreator,ExtensionTooltip],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.property.email.validation',["tau/models/model.property.text.validation","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var model=ModelBase.extend({category:"edit",schema:jsonSchema.Schema.create({type:"string",optional:!0,empty:!0,pre:["trim"],post:[function(val){var reg=/^(?:[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+\.)*[\w\!\#\$\%\&\'\*\+\-\/\=\?\^\`\{\|\}\~]+@(?:(?:(?:[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!\.)){0,61}[a-zA-Z0-9]?\.)+[a-zA-Z0-9](?:[a-zA-Z0-9\-](?!$)){0,61}[a-zA-Z0-9]?)|(?:\[(?:(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\.){3}(?:[01]?\d{1,2}|2[0-4]\d|25[0-5])\]))$/;return val.match(reg)||new this.Error("Email","Provide a valid email address"),val}]})});return model});
define('tau/components/component.property.email',["Underscore","tau/components/component.creator","tau/models/model.property.text","tau/models/model.property.text.editable","tau/models/model.property.email.validation","tau/components/extensions/property/extension.property.text.editable","tau/components/extensions/property/extension.property.refresher","tau/ui/templates/property/ui.template.property"],function(_,creator,Model,ModelEditable,ModelValidation,ExtensionEditable,ExtensionRefresher,template){return{create:function(config){config.propertyName="mailReplyAddress";var creatorConfig={ModelType:Model,extensions:[ModelEditable,ModelValidation,ExtensionEditable,ExtensionRefresher],template:template};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.endDate',["tau/components/component.property.date"],function(creator,ModelValidation){return{create:function(config){return config=config||{},config.propertyName="endDate",creator.create(config)}}});
define('tau/ui/templates/property/ui.template.property.endDate.list',["tau/core/templates-factory"],function(templates){var config={name:"property-endDate-list",markup:['<span><span class="tau-extension-tooltip" title="Completion date: ${text}">',"${text}","</span>","</span>"].join("")};return templates.register(config)});
define('tau/components/component.property.endDate.list',["tau/components/component.property.date","tau/ui/extensions/ui.extension.tooltip","tau/ui/templates/property/ui.template.property.endDate.list"],function(creator,TooltipExtension,template){return{create:function(config){return config=config||{},config.propertyName="endDate",config.template=template,config.extensions=[TooltipExtension],creator.create(config)}}});
define('tau/models/model.property.date.validation.project',["Underscore","tau/core/model-base","tau/utils/utils.jsonSchema","tau/utils/utils.date"],function(_,ModelBase,jsonSchema,dateUtils){var model=ModelBase.extend({category:"edit",name:"Model date validation","bus afterInit":function(){this.schema=jsonSchema.Schema.create({type:"string",optional:!0,empty:!0,pre:["trim"],post:function(val){if(this.wasError()==0){var date=dateUtils.parse(val),max=dateUtils.parse(this.schema.additionalProperties.max),min=dateUtils.parse(this.schema.additionalProperties.min);date==null?new this.Error("Date","Incorrect date format"):date<new Date("01/01/1900")?new this.Error("Date","Date must be greater then 1-Jan-1900"):max&&date>max?new this.Error("Date","Start Date should be earlier than End Date"):min&&date<min?new this.Error("Date","End Date should be later than Start Date"):val=dateUtils.format.date.short(date)}return val},additionalProperties:{dateFormat:dateUtils.getFormatData().date.short,max:null,min:null}});var store=this.config.store,entity=this.config.context.entity,self=this,_success=function(result){var data=result[0].data;this.config.propertyName=="startDate"&&(this.schema.additionalProperties.max=dateUtils.parse(data.endDate)),this.config.propertyName=="endDate"&&(this.schema.additionalProperties.min=dateUtils.parse(data.startDate))};store.get("project",{id:entity.id,fields:["startDate","endDate"]}).done({success:_.bind(_success,this)}),this.config.propertyName=="startDate"?store.on({eventName:"afterSave",type:"project",listener:this,filter:{id:entity.id},hasChanges:["endDate"]},function(res){var value=dateUtils.parse(res.data.changes.endDate);self.schema.additionalProperties.max=value}):this.config.propertyName=="endDate"&&store.on({eventName:"afterSave",type:"project",listener:this,filter:{id:entity.id},hasChanges:["startDate"]},function(res){var value=dateUtils.parse(res.data.changes.startDate);self.schema.additionalProperties.min=value})},"bus afterRender":function(evt){this.element=evt.data.element},"bus validateDate":function(evtArgs){var validation=this.schema.validate(evtArgs.data.value||"");evtArgs.data.value=validation.instance},"bus validate":function(evt){var element=this.element.find(".property");element.dateEditor("resetValidationErrors");var args=evt.data,data=args.cmd.$set[this.config.propertyName];if(!args.validation||args.validation.isError()!=1)args.validation=this.schema.validate(data),args.cmd.$set[this.config.propertyName]=args.validation.instance||null},"bus resetValidationErrors":function(){var element=this.element.find(".property");element.dateEditor("resetValidationErrors")},"bus afterValidate":function(evt){var validation=evt.data.validation;this.element.find(".property").dateEditor("setValue",validation.instance)},"bus validationFailed":function(evt){var element=this.element.find(".property");element.dateEditor("setValidationErrors",evt.data.validation.errors[0].description)}});return model});
define('tau/components/component.property.endDate.project',["tau/components/component.property.date","tau/models/model.property.date.validation.project"],function(creator,ModelValidation){return{create:function(config){return config=config||{},config.propertyName="endDate",config.validationExtension=ModelValidation,creator.create(config)}}});
define('tau/models/model.property.entityState',["tau/core/model-base","Underscore"],function(ModelBase,_){var initialDataProcessor=function(model){this.model=model};initialDataProcessor.prototype={done:function(r){var data=r[0].data.entityState;this.model.fire("dataBind",data)}};var entityStateModel=ModelBase.extend({onInit:function(){var self=this,proc=new initialDataProcessor(this),ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,fields=[{entityState:["id","name","isFinal","isCommentRequired",{nextStates:["id"]}]}],beforeSaveCallback=function(evt){var changes=evt.data.changes,requiredUpdates=evt.data.cmd.config.fields;evt.data.cmd.config.fields=_.union(requiredUpdates,fields),self.fire("beforeChanges",changes),self.fire("beforeChangeProperty")},afterSaveCallback=function(evt){self.fire("applyChanges",evt.data.changes),self.fire("propertyChanged")};self.store.unbind(self),self.store.on({eventName:"beforeSave",type:entityTypeName,hasChanges:["entityState"],listener:this},beforeSaveCallback),self.store.on({eventName:"afterSave",type:entityTypeName,hasChanges:["entityState"],listener:this},afterSaveCallback),this.store.get(entityTypeName,{id:entityId,fields:fields},{success:proc.setEntity,scope:proc}).done({success:proc.done,scope:proc})}});return entityStateModel});
define('tau/models/model.property.entityState.editable',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({name:"Entity state editable","bus dataBind":function(){this.fire("permissionsReady",{editable:!0})}})});
define('tau/components/extensions/entityState/extension.entityState.editable',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({category:"edit","bus prepareChanges":function(evt){this.bus.fire("markElementToBeUpdated",{element:this.element})},"bus applyChanges":function(evt){var self=this;this.bus.on("afterRender",function(e){e.removeListener(),self.bus.fire("updateElement",{element:self.element})}),this.bus.fire("refresh")},"bus ownerChanged":function(){this.fire("refresh")},"bus beforeChangeOwner":function(){this.fire("markElementToBeUpdated",{element:this.element})},"bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,$element=this.element=eventData.afterRender.data.element,permissions=eventData.permissionsReady.data,data=eventData.dataBind.data;if(data.nextStates.length>0&&permissions.editable){var componentsConfig={components:[{type:"entityStateList",data:data}],context:self.config.context},bubbleConfig={target:$element,componentsConfig:componentsConfig,alignTo:$element.find(".attr-name")};this.fire("initBubble",bubbleConfig)}this.bus.on("edit",function(){this.fire("toggleBubble")},this)}})});
define('tau/components/component.property.entityState',["tau/components/component.creator","tau/models/model.property.entityState","tau/models/model.property.entityState.editable","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/component.creator.extension","tau/ui/templates/common/ui.template.attributeValue","tau/components/extensions/entityState/extension.entityState.editable"],function(creator,ModelType,EditableModel,BubbleCreator,Refresher,ComponentCreatorExtension,template,EntityStateListEditorContainer){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[EditableModel,BubbleCreator,Refresher,ComponentCreatorExtension,EntityStateListEditorContainer]};return creator.create(creatorConfig,config)}}});
define('tau/models/finder/model.feature.search',["Underscore","tau/models/finder/model.assignable.search"],function(_,ModelBase){return ModelBase.extend({init:function(config){this._super(config),this.properties.state.filter=function(v){return v?v.dataItem?v.dataItem.entityType.id===9:!0:!0}},getType:function(){return"feature"}})});
define('tau/components/component.property.feature',["tau/components/component.property","tau/models/finder/model.feature.search","tau/models/finder/model.relation.editor"],function(PropertyComponent,FeatureSearchModel,Model){return{create:function(config){return config.propertyName="feature",config.showUrl=!0,config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"finder",propertyName:"feature",searchModel:FeatureSearchModel,additionalExtensions:[Model],maxHeight:400,filter:!0,expandable:!0,showEmptyDataMessage:!0},PropertyComponent.create(config)}}});
define('tau/ui/templates/property/ui.template.property.icon',[],function(){return{name:"property.icon",engine:"jqote2",markup:["<div>",'<span class="property tau-property tau-property-<%! this.name %> <% if (!this.value) { %> tau-property_empty_true<% } %>">','<span class="property-text tau-property__value i-role-output" data-placeholder="<%! this.placeholderText || "click to edit" %>">','<% if (this.value) { %><i class="tau-icon tau-icon_type_svg tau-icon_name_<%= this.value %>"></i><% } %>',"</span>","</span>","</div>"]}});
define('tau/components/component.property.icon',["tau/components/component.creator","tau/models/property.simple/model.property.simple","tau/models/model.property.editable","tau/components/extensions/property/extension.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/property/ui.template.property.icon"],function(creator,Model,ModelEditable,ExtensionEditable,ExtensionRefresher,ExtensionBubble,ExtensionCreator,Template){return{create:function(config){config=config||{},config.editable=!0,config.bubbleClassName="tau-bubble-icon",config.editorComponentConfig={type:"state-list",listType:"static",name:"icon",showClearValue:!0,allowToReset:!0,clearValueLabel:"reset",showReset:!1,values:[{id:null,name:'<i class="tau-icon tau-i-close"></i>',asHtml:!0}].concat(_.map(config.values,function(v){return{id:v,name:'<i class="tau-icon tau-icon_type_svg tau-icon_name_'+v+'"></i>',asHtml:!0}})||[])};var creatorConfig={extensions:[Model,ModelEditable,ExtensionEditable,ExtensionRefresher,ExtensionBubble,ExtensionCreator].concat(config.extensions||[]),template:Template};return creator.create(creatorConfig,config)}}});
define('tau/components/extensions/impedimentDate/extensions.model.impedimentDate.daysPassedCalculator',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){function days_between(date1,date2){var date1_ms=date1.getTime(),date2_ms=date2.getTime(),difference_ms=Math.abs(date1_ms-date2_ms);return Math.round(difference_ms/ONE_DAY)}var ONE_DAY=864e5,additionalInfoModel=ExtensionBase.extend({"bus extendData":function(evtArgs){var dataToBind=evtArgs.data.dataToBind||{},date=evtArgs.data.date;date?dataToBind.daysPassed=days_between(this.config.context.configurator.getCurrentDate(),date):dataToBind.daysPassed=null}});return additionalInfoModel});
define('tau/components/extensions/impedimentDate/extension.ui.impedimentDate.daysPassed',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({extractDataFromEvent:function(evtArgs,eventName){return(evtArgs[eventName]||{}).data||{}},"bus afterRender+dataBind":function(evtArgs){var dataToBind=this.extractDataFromEvent(evtArgs,"dataBind"),element=$(this.extractDataFromEvent(evtArgs,"afterRender").element),daysPassedLabel=$(['<span class="ui-days-passed">(<span class="days-count">',dataToBind.daysPassed,"</span> days passed)</span>"].join(""));element.find(".property").parent().append(daysPassedLabel)}})});
define('tau/components/component.property.impedimentDate',["Underscore","tau/components/component.property.createDate","tau/components/extensions/impedimentDate/extensions.model.impedimentDate.daysPassedCalculator","tau/components/extensions/impedimentDate/extension.ui.impedimentDate.daysPassed"],function(_,creator,DaysPassedCalculatorExtension,UIDaysPassedExtension){return{create:function(config){return config=config||{},config.extensions=_.concat([config.extensions,DaysPassedCalculatorExtension,UIDaysPassedExtension]),creator.create(config)}}});
define('tau/models/model.property.time',["tau/models/model.property.simple"],function(ModelBase){return ModelBase.extend({floatToString:function(flt){return flt.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onEntityRetrieved:function(r){var time=r[0].data[this.propertyName];time||(time=0);var data={text:this.floatToString(time),point:this._getEffortPoints()};this.fire("dataBind",data)}})});
define('tau/models/model.property.time.editable',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({"bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0})}})});
define('tau/components/extensions/property/extension.property.time.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base","tau/ui/behaviour/date/ui.behaviour.dateEditor"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit",normalizeEffort:function(effortVal){return Math.abs(Math.round(parseFloat(effortVal)*100)/100)||0},"bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,permissions=this.permissions=eventData.permissionsReady.data;permissions.editable&&(self.$el=eventData.afterRender.data.element,self.$el.find(".property-text").editableText({mask:/^\d*\.?\d*$/,restoreText:!0,onSave:function(text){var data=eventData.dataBind.data,currEffort=self.normalizeEffort(data.text),newEffort=self.normalizeEffort(text);if(currEffort===newEffort)return this.restoreInitialText(),!1;var $set={};$set[self.config.propertyName]=newEffort;var saveCmd={$include:["id"],id:self.config.context.entity.id,$set:$set};self.bus.fire("save",saveCmd)},onEditStart:function(){this.$element.data("points",this.$element.find("span").detach())},onEditEnd:function(){this.$element.append(this.$element.data("points"))}}))},showEditor:function(){this.$el.find(".property-text").editableText("activate")},"bus edit":function(){this.permissions.editable&&this.showEditor()},onClickHandler:function(){},removeHandlers:function(){},removeWidget:function(){this.$widget&&this.$widget.editableText("destroy")},destroy:function(){this.removeHandlers(),this.removeWidget(),this._super.apply(this,arguments)}})});
define('tau/ui/templates/property/ui.template.property.time',["tau/core/templates-factory"],function(templates){var config={name:"property-time",markup:["<div>",'   <div class="property"><div class="property-text">${text}<span class="point">${point}</span></div></div>',"</div>"].join("")};return templates.register(config)});
define('tau/components/component.property.time',["Underscore","tau/components/component.creator","tau/models/model.property.time","tau/models/model.property.time.editable","tau/components/extensions/property/extension.property.time.editable","tau/components/extensions/property/extension.property.refresher","tau/ui/templates/property/ui.template.property.time","tau/ui/behaviour/common/ui.behaviour.editableText"],function(_,creator,PropertyModelType,ModelEditable,ExtensionTimeEditable,ExtensionRefresher,template){return{create:function(config){var creatorConfig={ModelType:PropertyModelType,template:template,extensions:[ExtensionTimeEditable,ModelEditable,ExtensionRefresher]};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.initialEstimate',["Underscore","tau/components/component.property.time"],function(_,ComponentPropertyTime){return{create:function(config){return config=_.clone(config||{}),config.propertyName="initialEstimate",ComponentPropertyTime.create(config)}}});
define('tau/components/component.property.isActive',["tau/components/component.property.bool"],function(creator){return{create:function(config){return config=config||{},config.propertyName="isActive",creator.create(config)}}});
define('tau/components/component.property.isPrivate',["Underscore","tau/components/component.property.bool"],function(_,creator){return{create:function(config){return config=_.clone(config||{}),config.propertyName="isPrivate",config.editable=!0,creator.create(config)}}});
define('tau/components/component.property.isProduct',["tau/components/component.property.bool"],function(creator){return{create:function(config){return config=config||{},config.propertyName="isProduct",creator.create(config)}}});
define('tau/components/component.property.iteration',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="iteration",config.showUrl=!0,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"iteration",maxHeight:200,filter:!0,expandable:!0,showEmptyDataMessage:!0,clearValueLabel:"backlog",defaultValueLabel:"current",fullModeLabel:"show old"},PropertyComponent.create(config)}}});
define('tau/components/extensions/property/extension.property.password.editable',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit",init:function(){this._super.apply(this,arguments),this.onBlurProxy=_.bind(this.onBlur,this),this.onKeyDownProxy=_.bind(this.onKeyDown,this)},findPasswordElements:function(element){return element.find(".tau-password,.tau-password-verify")},"bus permissionsReady+afterRender":function(evt){if(evt.permissionsReady.data.editable){var element=evt.afterRender.data.element;this.findPasswordElements(element).blur(this.onBlurProxy),element.find(".tau-password,tau-password-verify").keydown(this.onBlurProxy)}},"bus view.password.ready:last+view.password.confirmation.ready:last":function(evt){var password=evt["view.password.ready"].data,passwordConfirmation=evt["view.password.confirmation.ready"].data,passwordIsNotEmpty=password.length>0;if(passwordIsNotEmpty&&password===passwordConfirmation){var data={};data[this.config.propertyName]=password,this.fire("save",data)}},"bus after_save":function(){this.fire("view.clear.passwords")},"bus afterRender:last+view.clear.passwords":function(evt){this.findPasswordElements($(evt.afterRender.data.element)).val("")},getEventNameFromTarget:function(target){var isPasswordConfirmation=$(target).hasClass("tau-password-verify");return isPasswordConfirmation?"view.password.confirmation.ready":"view.password.ready"},firePasswordReadyEventDependOnTarget:function(target){var value=$(target).val();this.fire(this.getEventNameFromTarget(target),value)},onBlur:function(evt){var target=evt.target;this.firePasswordReadyEventDependOnTarget(target)},onKeyDown:function(evt){var target=evt.target;evt.keyCode==13&&this.firePasswordReadyEventDependOnTarget(target)}})});
define('tau/ui/templates/property/ui.template.property.password',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink.full"],function(templates){var config={name:"property.password",markup:["<div>",'<span class="property tau-property{{if name}} tau-property-${name}{{/if}}{{if !text}} tau-property_empty_true{{/if}}">',"<div>",'<span class="">Password</span>&nbsp;','{{if (passwordHint)}}<span class="">${passwordHint}</span>{{/if}}','<div class="tau-property__value"><input type="password" value="${text}" class="tau-password tau-in-text"/></div>',"</div>","<div>",'<span class="">Confirm Password</span>','<div class="tau-property__value"><input type="password" value="${text}" class="tau-password-verify tau-in-text"/></div>',"</div>","</span>","</div>"].join(""),dependencies:["entity-link-full"]};return templates.register(config)});
define('tau/components/component.property.text',["Underscore","tau/components/component.creator","tau/models/model.property.text","tau/models/model.property.text.editable","tau/models/model.property.text.validation","tau/components/extensions/property/extension.property.text.editable","tau/components/extensions/property/extension.property.password.editable","tau/components/extensions/property/extension.property.refresher","tau/ui/templates/property/ui.template.property","tau/ui/templates/property/ui.template.property.password"],function(_,creator,Model,ModelEditable,ModelValidation,ExtensionEditable,ExtensionPasswordEditable,ExtensionRefresher,template,templatePassword){return{create:function(config){var textFieldTypeIsPassword=config.editorType==="password",textFieldTemplate=textFieldTypeIsPassword?templatePassword:template,TextFieldEditableExtension=textFieldTypeIsPassword?ExtensionPasswordEditable:ExtensionEditable,creatorConfig={ModelType:Model,extensions:_.concat([config.extensions,ModelEditable,ModelValidation,TextFieldEditableExtension,ExtensionRefresher]),template:config.template||textFieldTemplate};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.lastFailureComment',["Underscore","tau/components/component.property.text"],function(_,ComponentPropertyTime){return{create:function(config){return config=_.clone(config||{}),config.propertyName="lastFailureComment",config.defaultText="N/A",ComponentPropertyTime.create(config)}}});
define('tau/components/component.property.lastRunDate',["tau/components/component.property.date"],function(creator){return{create:function(config){return config=_.clone(config||{}),config.propertyName="lastRunDate",config.editable=!1,config.format="datetime",creator.create(config)}}});
define('tau/ui/templates/property/ui.template.property.lastRunDate.list',["tau/core/templates-factory"],function(templates){var config={name:"property-lastRunDate-list",markup:'<div><div class="property tau-extension-tooltip" title="Run Date: ${text}"><div class="property-text">${text}</div></div>'};return templates.register(config)});
define('tau/components/component.property.lastRunDate.list',["tau/components/component.property.date","tau/ui/extensions/ui.extension.tooltip","tau/ui/templates/property/ui.template.property.lastRunDate.list"],function(creator,TooltipExtension,template){return{create:function(config){return config=_.clone(config||{}),config.propertyName="lastRunDate",config.editable=!1,config.format="datetime",config.extensions=[TooltipExtension],config.template=template,creator.create(config)}}});
define('tau/ui/templates/property/ui.template.property.status',["tau/core/templates-factory"],function(templates){var config={name:"property-last-status",markup:["<div>",'   <div class="ui-status {{if value === true}}ui-status_type_passed green{{/if}}{{if value === false}}ui-status_type_failed red{{/if}}{{if value === null}}ui-status_type_na grey{{/if}}">',"   {{if value === true}}","       Passed","   {{/if}}","   {{if value === false}}","       Failed","   {{/if}}","</div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.property.lastStatus',["tau/components/component.property.bool","tau/ui/templates/property/ui.template.property.status"],function(creator,template){return{create:function(config){return config=config||{},config.propertyName="lastStatus",config.template=template,creator.create(config)}}});
define('tau/models/model.property.user',["tau/models/model.property"],function(ModelBase){return ModelBase.extend({onInit:function(){this.listenOfPropertyChanged();var entity=this.config.context.entity,typeName=entity.entityType.name,userFields={};userFields[this.config.propertyName]=["id","firstName","lastName","email","avatarUri"],this.store.get(typeName,{id:entity.id,fields:["id",userFields]}).done({scope:this,success:this.initialDataProcessor}),this.bindStoreListeners()},initialDataProcessor:function(result){var config=this.config;if(!config)return;var entity=result[0].data,user=entity[config.propertyName];if(!user)return;var username=user.email;if(user.firstName||user.lastName)username=_.trim([user.firstName,user.lastName].join(" "));var visibleName=username;config.hidename&&(username="");var data={id:user.id,avatar:user.avatarUri+"24",name:username,visibleName:visibleName};this.fire("dataBind",data)},bindStoreListeners:function(){var self=this;self.store.on({eventName:"afterSave",type:"user",hasChanges:["avatarUri"],listener:self},function(){self.afterUserSaved.apply(self,arguments)})},afterUserSaved:function(command){this.fire("userAvatarChanged",command.data)},"bus dataBind:last + userAvatarChanged":function(evt,dataBind,userData){dataBind.id===userData.id&&this.fire("avatarChanged",userData)}})});
define('tau/ui/templates/common/ui.template.owner',["tau/core/templates-factory","tau/ui/templates/common/ui.template.userName"],function(templates){return templates.register({name:"owner",markup:["<table class='owner' userId='${id}'><tr>","<td class='owner-avatar-container tau-avatar_${id}'>","{{if avatar}}<img  role='avatar' src='${avatar}' alt='${visibleName}' title='${visibleName}' class='owner-avatar {{if !name}} user-name{{/if}}'/>{{/if}}","</td>","<td class='owner-info'>","   {{tmpl 'user-name'}}","</td>","</tr></table>"].join(""),dependencies:["user-name"]})});
define('tau/components/extensions/user/extension.user.editable',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({category:"edit","bus permissionsReady+afterRender+dataBind":function(eventData){var self=this,$element=this.element=eventData.afterRender.data.element,permissions=eventData.permissionsReady.data,data=eventData.dataBind.data;if(permissions.editable){var userListConfig={type:"userList",data:data,extensions:this.getExtensions(),v2:!0};this.extendEditorConfig(userListConfig);var componentsConfig={components:[userListConfig],context:self.config.context},bubbleConfig={target:$element,componentsConfig:componentsConfig,alignTo:$element.find(".user-name"),onShow:_.bind(function(){this.config.context.configurator.getKeyBoardManager().pushHandler({})},this),onHide:_.bind(function(){this.config.context.configurator.getKeyBoardManager().popHandler()},this)};this.fire("initBubble",bubbleConfig)}this._toggle&&this.bus.removeListener("edit",this._toggle,this),this._toggle=function(){self.fire("toggleBubble")},this.bus.on("edit",this._toggle,this)},extendEditorConfig:function(){},getExtensions:function(){return[]}})});
define('tau/models/assignment/model.property.owner.editable',["Underscore","tau/models/assignment/model.property.assignUser.editable.base"],function(_,EditableBase){return EditableBase.extend({assignTo:function(userId){var cmd={type:this.config.context.entity.entityType.name,$set:{owner:{id:userId}},$include:[{owner:["id","firstName","lastName","email"]}]};this.fire("save",cmd)}})});
define('tau/models/userList/extension.model.user.Excluder',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({"bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}},userFields=["id","firstName","lastName"],userType={};userType[this.getUserPropertyName()]=userFields,this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:[userType]},callback:{scope:this,success:this.onEntityRetrieved}})},getUserPropertyName:function(){throw"Use Excluder getUserPropertyName should be ovveriden"},onEntityRetrieved:function(evtArgs){var entity=evtArgs.data||{},excludedUsers=[entity[this.getUserPropertyName()]];this.fire("excludedUserReady",excludedUsers)}})});
define('tau/models/userList/extension.model.owner.Excluder',["Underscore","tau/models/userList/extension.model.user.Excluder"],function(_,EditableBase){return EditableBase.extend({getUserPropertyName:function(){return"owner"}})});
define('tau/components/extensions/user/extension.owner.editable',["tau/components/extensions/user/extension.user.editable","tau/models/assignment/model.property.owner.editable","tau/models/userList/extension.model.owner.Excluder"],function(ExtensionBase,ModelOwnerEditable,UserExcluder){return ExtensionBase.extend({category:"edit",extendEditorConfig:function(userListConfig){userListConfig.UserExcluder=UserExcluder},getExtensions:function(){return[ModelOwnerEditable]}})});
define('tau/components/component.property.owner',["tau/components/component.creator","tau/models/model.property.user","tau/models/model.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/common/ui.template.owner","tau/components/extensions/user/extension.owner.editable"],function(creator,ModelType,EditableModel,RefresherExtension,BubbleCreator,ComponentCreatorExtension,template,OwnerEditorContainer){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[EditableModel,BubbleCreator,ComponentCreatorExtension,RefresherExtension,OwnerEditorContainer]};return config=config||{},config.propertyName="owner",creator.create(creatorConfig,config)}}});
define('tau/models/extensions/team/extension.model.allUserRetriever',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({"bus registerStoreRequest":function(){var self=this;this.store.get("user",{fields:["id","firstName","lastName","email","isActive","deleteDate",{role:["id","name"]}]}).done({success:function(data){var users=data[0].data,roles={},members=[];users=_.filter(users,function(user){return user.deleteDate===null}),_.forEach(users,function(user){var role=user.role;role&&(roles[role.id]=role),user.name=_.trim([user.firstName,user.lastName].join(" "))||user.email,members.push({user:user,role:role})}),self.fire("projectMembersReady",members),self.fire("projectRolesReady",_.values(roles))}})}})});
define('tau/components/extensions/user/extension.owner.project.editable',["tau/components/extensions/user/extension.user.editable","tau/models/assignment/model.property.owner.editable","tau/models/userList/extension.model.owner.Excluder","tau/models/extensions/team/extension.model.allUserRetriever"],function(ExtensionBase,ModelOwnerEditable,UserExcluder,AllUserRetriever){return ExtensionBase.extend({category:"edit",extendEditorConfig:function(userListConfig){userListConfig.UserExcluder=UserExcluder,userListConfig.Retriever=AllUserRetriever},getExtensions:function(){return[ModelOwnerEditable]}})});
define('tau/components/component.property.owner.project',["tau/components/component.creator","tau/models/model.property.user","tau/models/model.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/common/ui.template.owner","tau/components/extensions/user/extension.owner.project.editable"],function(creator,ModelType,EditableModel,RefresherExtension,BubbleCreator,ComponentCreatorExtension,template,OwnerEditorContainer){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[EditableModel,BubbleCreator,ComponentCreatorExtension,RefresherExtension,OwnerEditorContainer]};return config=config||{},config.propertyName="owner",creator.create(creatorConfig,config)}}});
define('tau/models/extensions/team/extension.model.requestOwners.retriever',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({"bus registerStoreRequest":function(){var entity=this.config.context.entity,store=this.config.store,self=this;store.get(entity.entityType.name,{id:entity.id,fields:[{project:["id",{projectMembers:[{user:["id","firstName","lastName","email","isActive","deleteDate"]},{role:["id","name"]}]}]},{team:["id",{teamMembers:[{user:["id","firstName","lastName","email","isActive","deleteDate"]},{role:["id","name"]}]}]}]}).done({success:function(results){results[0].data.project=results[0].data.project||{},_.defaults(results[0].data.project,{projectMembers:[]}),results[0].data.team=results[0].data.team||{},_.defaults(results[0].data.team,{teamMembers:[]});var members=results[0].data.project.projectMembers.concat(results[0].data.team.teamMembers||[]);members=_.uniq(members,!1,function(u){return u.user.id}),self.fire("members.provided",members)}}),store.get(entity.entityType.name,{id:entity.id,fields:[{requesters:["id","firstName","lastName","email","isActive","deleteDate","kind"]}]}).done({success:function(results){var requesters=results[0].data.requesters;self.fire("requesters.provided",requesters)}})},"bus members.provided+requesters.provided":function(evt){var members=evt["members.provided"].data,requesters=evt["requesters.provided"].data,ids=_.pluck(requesters,"id");members=_.reject(members,function(member){return _.indexOf(ids,member.user.id)>-1}),_.forEach(requesters,function(user){members.unshift({role:{id:0,name:"Requesters"},user:user})}),members=_.filter(members,function(member){return member.user.deleteDate===null});var roles=[];_.forEach(members,function(member){var role=member.role;role&&roles.push(role),member.username=_.trim([member.firstName,member.lastName].join(" "))||member.email}),roles=_.uniq(roles,!1,function(item){return item.id}),this.fire("projectMembersReady",members),this.fire("projectRolesReady",roles)}})});
define('tau/components/extensions/user/extension.owner.request.editable',["tau/components/extensions/user/extension.user.editable","tau/models/assignment/model.property.owner.editable","tau/models/userList/extension.model.owner.Excluder","tau/models/extensions/team/extension.model.requestOwners.retriever"],function(ExtensionBase,ModelOwnerEditable,UserExcluder,AllUserRetriever){return ExtensionBase.extend({category:"edit",extendEditorConfig:function(userListConfig){userListConfig.UserExcluder=UserExcluder,userListConfig.Retriever=AllUserRetriever},getExtensions:function(){return[ModelOwnerEditable]},"bus initBubble":function(evt){var $target=evt.data.target,_empty=function(){$target.tauBubble("empty"),$target.data("bubbleLoaded",!1)};$target.bind("externalClose",_empty),$target.bind("close",_empty)}})});
define('tau/components/component.property.owner.request',["tau/components/component.creator","tau/models/model.property.user","tau/models/model.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/common/ui.template.owner","tau/components/extensions/user/extension.owner.request.editable"],function(creator,ModelType,EditableModel,RefresherExtension,BubbleCreator,ComponentCreatorExtension,template,OwnerEditorContainer){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[EditableModel,BubbleCreator,ComponentCreatorExtension,RefresherExtension,OwnerEditorContainer]};return config=config||{},config.propertyName="owner",creator.create(creatorConfig,config)}}});
define('tau/models/model.property.password',["tau/core/model-base"],function(ModelBase){return ModelBase.extend({init:function(config){this._super.apply(this,arguments);if(!config.propertyName)throw"PropertyName was not configured";this.propertyName=config.propertyName,this.listenedEntities={}},getEntityTypeName:function(){return this.config.context.entity.entityType.name},getEntityId:function(){return this.config.context.entity.id},listenOfPropertyChanged:function(){var entityId=this.config.context.entity.id;this.listenedEntities[entityId]||(this.listenedEntities[entityId]=!0,this.attachToChangePropertiesOfCurrentEntity(this.propertyName))},onInit:function(){this.fire("dataBind",{name:this.propertyName,text:this.config.defaultText||"",passwordHint:this.config.passwordHint})}})});
define('tau/components/component.property.password',["Underscore","tau/components/component.creator","tau/models/model.property.password","tau/models/model.property.text.editable","tau/models/model.property.text.validation","tau/components/extensions/property/extension.property.password.editable","tau/ui/templates/property/ui.template.property.password"],function(_,creator,ModelPassword,ModelEditable,ModelValidation,ExtensionPasswordEditable,templatePassword){return{create:function(config){var creatorConfig={ModelType:ModelPassword,extensions:_.concat([config.extensions,ModelEditable,ModelValidation,ExtensionPasswordEditable]),template:templatePassword};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.priority',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="priority",config.editorType="",config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"state-list",listType:"priority",maxHeight:200},PropertyComponent.create(config)}}});
define('tau/models/model.property.process',["Underscore","tau/models/model.property"],function(_,ModelBase){return ModelBase.extend({getPropertyData:function(propertyField){this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",{process:["id","name",{practices:["id","name"]}]}]}).done({success:this.onEntityRetrieved,scope:this})},processProperty:function(property){var data={id:property[this.valueField],text:property[this.displayField],subtext:_.pluck(property.practices,"name").join(", ")};this.fire("dataBind",data)}})});
define('tau/components/component.property.process',["Underscore","tau/components/component.creator","tau/core/termProcessor","tau/models/model.property.process","tau/models/model.property.editable","tau/components/extensions/property/extension.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/property/ui.template.property"],function(_,creator,TermProcessor,PropertyModelType,PropertyModelTypeEditable,ExtensionPropertyEditable,ExtensionPropertyRefresher,BubbleCreator,ComponentCreatorExtension,template){return{create:function(config){config.propertyName="process",config.showUrl=!1,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"process",maxHeight:200,filter:!1,expandable:!1,showEmptyDataMessage:!1,showClearValue:!1,allowToReset:!1,defaultValueLabel:"current",fullModeLabel:"show old",confirmation:"It is strongly recommended to NOT change Process for Projects in progress as some data will be lost (esp. the Custom fields data). Are you sure you want to change process?"};var tp=new TermProcessor(config.context.getTerms()),editorConfig=config.editorComponentConfig;editorConfig.resetDisabled=config.resetDisabled,editorConfig.showEmptyDataMessage&&(editorConfig.emptyDataMessage="No "+tp.getTerms(config.propertyName).names.toLowerCase()+" found"),editorConfig.showClearValue&&(config.clearValueLabel="reset "+tp.getTerms(config.propertyName).name.toLowerCase());var creatorConfig={ModelType:config.Model||PropertyModelType,template:template,extensions:_.concat([config.extensions,BubbleCreator,ComponentCreatorExtension,PropertyModelTypeEditable,ExtensionPropertyEditable])};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.program',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="program",config.showUrl=!1,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"program",expandable:!0,filter:!0,showEmptyDataMessage:!0,defaultValueLabel:"current",fullModeLabel:"show old",clearValueLabel:"reset",showReset:!0},PropertyComponent.create(config)}}});
define('tau/models/model.property.project',["Underscore","tau/models/model.property"],function(_,ModelBase){return ModelBase.extend({getPropertyData:function(propertyField){this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",{project:["id","name","color"]}]}).done({success:this.onEntityRetrieved,scope:this})},processProperty:function(property){var data={id:property[this.valueField],name:property[this.displayField]||"No Project",type:"project",color:property.color,url:this.config.context.configurator.getUrlBuilder().getNewViewUrl(property[this.valueField],"project",!0),isEditable:this.config.editable};this.fire("dataBind",data)}})});
define('tau/ui/templates/property/ui.template.property.project',["tau/core/templates-factory"],function(templates){var config={name:"property.project",engine:"jqote2",markup:["<div>",'<span class="property tau-property tau-property-<%= this.type %><% if (!this.name) { %> tau-property_empty_true<% } %>">','<span class="property-text tau-property__value">',"<% if (this.id) { %>",'<a href="<%= this.url %>" class="tau-linkentity tau-linkentity_type_full">',"<% if (this.color) { %>",'<i style="background-color: <%! this.color %>;" class="tau-icon tau-icon_type_color"></i>',"<% } else { %>",'<i class="tau-icon tau-icon_type_color tau-icon_name_empty"></i>',"<% } %>",'<span class="tau-linkentity__inner">',"<%! this.name %>","</span>","</a>","<% } else { %>",'<span  <% if (this.isEditable){ %>class="ui-link"<% } %>><%! this.name %></span>',"<% } %>","</span>","</span>","</div>"]};return templates.register(config)});
define('tau/ui/templates/state/project/ui.template.state.project.option',["tau/core/templates-factory"],function(templates){var config={name:"state.project.option",engine:"jqote2",markup:['<div role="option" data-id="<%! this.id %>" class="drop-down-option drop-down-option-project  i-role-option" <% if (this.description) { %> title=<%! this.description %> <% } %> >','<span class="drop-down-option__prefix">',"<% if (this.color) { %>",'<i style="background-color: <%! this.color %>;" class="tau-icon tau-icon_type_color"></i>',"<% } else { %>",'<i class="tau-icon tau-icon_type_color tau-icon_name_empty "></i>',"<% } %>","</span>",'<span class="drop-down-option__text i-role-optiontext"><%! this.name %></span>',"</div>"]};return templates.register(config)});
define('tau/components/component.property.project',["tau/components/component.property","tau/models/model.property.project","tau/ui/templates/property/ui.template.property.project","tau/ui/templates/state/project/ui.template.state.project.option"],function(Component,Model,Template,TemplateOption){return{create:function(config){var entityType=config.context.entity.entityType.name.toLowerCase(),isBoard=config.context.hasEdition("board"),hasTeams=config.context.hasEdition("hasTeams");return config.propertyName="project",config.Model=Model,config.template=Template,config.editable=_.contains(["feature","userstory","bug","request","testcase"],entityType),config.showUrl=!0,config.alignElementSelector=".property-text",config.applyBubbleClasses=!1,config.editorComponentConfig={type:"state-list",listType:"project",showReset:hasTeams,filter:!0,clearValueLabel:"No Project",emptyDataMessage:"No projects found",templateOption:TemplateOption.name},Component.create(config)}}});
define('tau/ui/templates/property/ui.template.property.relationType',["tau/core/templates-factory"],function(templates){var config={name:"property-relationType",markup:["<div>",'   <span class="tau-relation-icon tau-${value.toLowerCase()}"/>','   <span class="ui-link property-text i-role-relation-type" >${text}</span>',"</div>"]};return templates.register(config)});
define('tau/components/component.property.relationType',["tau/components/component.property","tau/ui/templates/property/ui.template.property.relationType"],function(PropertyComponent,template){return{create:function(config){return config.propertyName="relationType",config.editorType="",config.template=template,config.alignElementSelector=".i-role-relation-type",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"state-list",listType:"relationType",maxHeight:200},PropertyComponent.create(config)}}});
define('tau/components/component.property.release',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="release",config.showUrl=!0,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"release",expandable:!0,filter:!0,showEmptyDataMessage:!0,defaultValueLabel:"current",fullModeLabel:"show old",clearValueLabel:"backlog"},PropertyComponent.create(config)}}});
define('tau/components/component.property.requestSource',["tau/components/component.property","tau/models/model.property.simple"],function(PropertyComponent,Model){return{create:function(config){return config.propertyName="sourceType",config.Model=Model,config.showUrl=!1,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"static",values:["None","Email","Phone","Internal","External"],expandable:!0,filter:!1,showEmptyDataMessage:!1},PropertyComponent.create(config)}}});
define('tau/components/component.property.requestType',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="requestType",config.editorType="",config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"state-list",listType:"requestType",maxHeight:200,showReset:!1},PropertyComponent.create(config)}}});
define('tau/models/assignment/model.property.responsible.editable',["Underscore","tau/models/assignment/model.property.assignUser.editable.base"],function(_,EditableBase){return EditableBase.extend({assignTo:function(userId){var cmd={type:this.config.context.entity.entityType.name,$set:{responsible:{id:userId}},$include:[{responsible:["id","firstName","lastName"]}]};this.fire("save",cmd)}})});
define('tau/models/userList/extension.model.responsible.Excluder',["Underscore","tau/models/userList/extension.model.user.Excluder"],function(_,EditableBase){return EditableBase.extend({getUserPropertyName:function(){return"responsible"}})});
define('tau/components/extensions/user/extension.responsible.editable',["tau/components/extensions/user/extension.user.editable","tau/models/assignment/model.property.responsible.editable","tau/models/userList/extension.model.responsible.Excluder"],function(ExtensionBase,ModelResponsibleEditable,UserExcluder){return ExtensionBase.extend({category:"edit",extendEditorConfig:function(userListConfig){userListConfig.UserExcluder=UserExcluder},getExtensions:function(){return[ModelResponsibleEditable]}})});
define('tau/components/component.property.responsible',["tau/components/component.creator","tau/models/model.property.user","tau/models/model.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/common/ui.template.owner","tau/components/extensions/user/extension.responsible.editable"],function(creator,ModelType,EditableModel,RefresherExtension,BubbleCreator,ComponentCreatorExtension,template,OwnerEditorContainer){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[EditableModel,BubbleCreator,ComponentCreatorExtension,RefresherExtension,OwnerEditorContainer].concat(config.extensions||[])};return config=config||{},config.propertyName="responsible",creator.create(creatorConfig,config)}}});
define('tau/components/component.property.role',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="role",config.editable=config.context.getLoggedUser().isAdministrator,config.displayField="name",config.valueField="id",config.alignElementSelector=".property-text",config.showUrl=!1,config.stackName="role",config.editorComponentConfig={type:"state-list",listType:"role",expandable:!0,showEmptyDataMessage:!0,defaultValueLabel:"current",fullModeLabel:"show all"},PropertyComponent.create(config)}}});
define('tau/ui/templates/property/ui.template.property.modern',["tau/core/templates-factory"],function(templates){var config={name:"property.modern",engine:"jqote2",markup:['<span class="tau-dropdown-toggle i-role-property " data-value="<%! this.value %>">',"<i><%! this.value %></i>","</span>"]};return templates.register(config)});
define('tau/components/component.property.role.modern',["tau/components/component.property","tau/ui/templates/property/ui.template.property.modern"],function(Component,Template){return{create:function(config){return config.propertyName="role",config.editable=config.context.configurator.getLoggedUser().isAdministrator,config.displayField="name",config.valueField="id",config.alignElementSelector=".i-role-property",config.showUrl=!1,config.targetElementSelector=".i-role-property",config.stackName="role",config.applyBubbleClasses=!1,config.editorComponentConfig={type:"state-list",listType:"role",expandable:!0,showEmptyDataMessage:!0,defaultValueLabel:"current",fullModeLabel:"show all"},config.template=Template,Component.create(config)}}});
define('tau/models/model.property.severity',["Underscore","tau/models/model.property","tau/models/dataprocessor/model.processor.importance"],function(_,ModelPropertyBase,ImportanceProcessor){return ModelPropertyBase.extend({getPropertyFields:function(){var baseFields=this._super(),result=_.union(baseFields,["importance"]);return result},buildRequest:function(propertyField){var chain=this._super(propertyField);return chain=chain.get("severity",{fields:["id","importance"]}),chain},onProcessProperty:function(property){if(!this.config)return;var data=this._super(property);return data.kind=this.importanceProcessor.getKind(property.importance),data},onEntityRetrieved:function(r){var property=this.property=r[0].data[this.propertyName]||{},importanceList=_(r[1].data).pluck("importance"),min=_.min(importanceList),max=_.max(importanceList);this.importanceProcessor=new ImportanceProcessor(min,max),this.processProperty(property)}})});
define('tau/ui/templates/property/ui.template.property.severity',["tau/core/templates-factory"],function(templates){var config={name:"property-severity",markup:["<div>",'   <span class="property  tau-list-severity-${kind}">','       <span class="property-text">${text}</span>',"   </span>","</div>"].join(""),dependencies:[]};return templates.register(config)});
define('tau/components/component.property.severity',["tau/components/component.property","tau/models/model.property.severity","tau/ui/templates/property/ui.template.property.severity"],function(PropertyComponent,ModelPropertySeverity,severityTemplate){return{create:function(config){return config.propertyName="severity",config.editorType="",config.showUrl=!1,config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"state-list",listType:"severity",maxHeight:200},config.Model=ModelPropertySeverity,config.template=severityTemplate,PropertyComponent.create(config)}}});
define('tau/components/component.property.startDate',["tau/components/component.property.date"],function(creator){return{create:function(config){return config=config||{},config.propertyName="startDate",creator.create(config)}}});
define('tau/components/component.property.startDate.project',["tau/components/component.property.date","tau/models/model.property.date.validation.project"],function(creator,ModelValidation){return{create:function(config){return config=config||{},config.propertyName="startDate",config.validationExtension=ModelValidation,creator.create(config)}}});
define('tau/ui/templates/property/ui.template.property.status.testCaseRun',["tau/core/templates-factory"],function(templates){var config={name:"property-last-status-testcaserun",markup:["<div>",'   <div class="ui-status {{if value === true}}ui-status_type_passed green{{/if}}{{if value === false}}ui-status_type_failed red{{/if}}{{if value === null}}ui-status_type_na grey{{/if}}">',"   {{if value === true}}","       Passed","   {{/if}}","   {{if value === false}}","       Failed","   {{/if}}","   {{if value === null}}","       Skipped","   {{/if}}","</div>","</div>"].join("")};return templates.register(config)});
define('tau/components/component.property.status.testCaseRun',["tau/components/component.property.bool","tau/ui/templates/property/ui.template.property.status.testCaseRun"],function(creator,template){return{create:function(config){return config=config||{},config.propertyName="passed",config.template=template,creator.create(config)}}});
define('tau/models/model.property.team',["Underscore","tau/models/model.property"],function(_,ModelBase){return ModelBase.extend({getPropertyData:function(propertyField){this.store.get(this.getEntityTypeName(),{id:this.getEntityId(),fields:["id",{team:["id","name","icon"]}]}).done({success:this.onEntityRetrieved,scope:this})},processProperty:function(property){var data={id:property[this.valueField],type:property.__type,name:property[this.displayField]||"No Team",icon:property.icon,url:"#team/"+property[this.valueField],isEditable:this.config.editable};this.fire("dataBind",data)}})});
define('tau/ui/templates/property/ui.template.property.team',["tau/core/templates-factory"],function(templates){var config={name:"property.team",engine:"jqote2",markup:["<div>",'<span class="property tau-property tau-property-<%= this.type %><% if (!this.name) { %> tau-property_empty_true<% } %>">','<span class="property-text tau-property__value">',"<% if (this.id) { %>",'<a href="<%= this.url %>" class="tau-linkentity tau-linkentity_type_full">','<i class="tau-icon tau-icon_type_svg tau-icon_name_<%! this.icon || "trihead" %>"></i>','<span class="tau-linkentity__inner">',"<%! this.name %>","</span>","</a>","<% } else { %>",'<span <% if (this.isEditable){ %>class="ui-link"<% } %>><%! this.name %></span>',"<% } %>","</span>","</span>","</div>"]};return templates.register(config)});
define('tau/ui/templates/state/team/ui.template.state.team.option',["tau/core/templates-factory"],function(templates){var config={name:"state.team.option",engine:"jqote2",markup:['<div role="option" data-id="<%! this.id %>" class="drop-down-option drop-down-option-team i-role-option " <% if (this.description) { %> title=<%! this.description %> <% } %> >','<span class="drop-down-option__prefix">','<i class="tau-icon tau-icon_type_svg tau-icon_name_<%! this.icon || "trihead" %>"></i>',"</span>",'<span class="i-role-optiontext drop-down-option__text"><%! this.name %></span>',"</div>"]};return templates.register(config)});
define('tau/components/component.property.team',["tau/components/component.property","tau/models/model.property.team","tau/ui/templates/property/ui.template.property.team","tau/ui/templates/state/team/ui.template.state.team.option"],function(Component,Model,Template,TemplateOption){return{create:function(config){var entityType=config.context.entity.entityType.name.toLowerCase(),hasTeams=config.context.hasEdition("hasTeams");return config.propertyName="team",config.Model=Model,config.template=Template,config.editable=_.contains(["feature","userstory","bug","request","testcase"],entityType)&&hasTeams,config.showUrl=!0,config.alignElementSelector=".property-text",config.applyBubbleClasses=!1,config.editorComponentConfig={type:"state-list",listType:"team",showReset:!0,filter:!0,clearValueLabel:"No Team",emptyDataMessage:"No teams found",templateOption:TemplateOption.name},Component.create(config)}}});
define('tau/components/component.property.teamIteration',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config.propertyName="teamIteration",config.showUrl=!0,config.alignElementSelector=".property-text",config.editorComponentConfig={type:"state-list",listType:"teamIteration",maxHeight:200,filter:!0,expandable:!0,showEmptyDataMessage:!0,clearValueLabel:"reset",defaultValueLabel:"current",fullModeLabel:"show old"},PropertyComponent.create(config)}}});
define('tau/components/component.property.testPlan',["tau/components/component.property"],function(PropertyComponent){return{create:function(config){return config=config||{},config.propertyName="testPlan",config.showUrl=!0,config.editable=!1,PropertyComponent.create(config)}}});
define('tau/models/model.timeInterval',["Underscore","tau/models/model.leadCycleTime","tau/utils/utils.date"],function(_,ModelBase,datesUtil){var ticksPerHour=36e5,ticksPerDay=ticksPerHour*24;return ModelBase.extend({onInit:function(){var ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,timeField=this.config.timeField,cmdSettings={id:entityId,fields:[timeField]};this.store.get(entityTypeName,cmdSettings,{scope:this,success:this.onEntityRetrieved}).done()},onEntityRetrieved:function(res){var timeInterval=res.data[this.config.timeField];if(timeInterval){var timeInterval=this.getLongTime(timeInterval);this.fire("dataBind",{text:timeInterval,point:""})}else this.fire("dataBind",{text:"",point:""})}})});
define('tau/components/component.property.timeInterval',["Underscore","tau/components/component.creator","tau/models/model.timeInterval","tau/ui/templates/property/ui.template.property.time"],function(_,creator,Model,Template){return{create:function(config){config=config||{};var creatorConfig={ModelType:Model,template:Template,extensions:_.concat([config.extensions])};return creator.create(creatorConfig,config)}}});
define('tau/components/component.property.user',["tau/components/component.creator","tau/models/model.property.user","tau/models/model.property.editable","tau/components/extensions/property/extension.property.refresher","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/common/ui.template.owner","tau/components/extensions/user/extension.owner.editable"],function(creator,ModelType,EditableModel,RefresherExtension,BubbleCreator,ComponentCreatorExtension,template,OwnerEditorContainer){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[EditableModel,BubbleCreator,ComponentCreatorExtension,RefresherExtension,OwnerEditorContainer]};return config=config||{},config.propertyName="user",creator.create(creatorConfig,config)}}});
define('tau/components/component.property.userStory',["tau/components/component.property","tau/models/finder/model.userStory.search","tau/models/finder/model.relation.editor"],function(PropertyComponent,UserStorySearchModel,Model){return{create:function(config){return config.propertyName="userStory",config.showUrl=!0,config.alignElementSelector=".property-text",config.showEmptyDataMessage=!0,config.editorComponentConfig={type:"finder",propertyName:"userStory",searchModel:UserStorySearchModel,additionalExtensions:[Model],listType:"userStory",maxHeight:400},PropertyComponent.create(config)}}});
define('tau/components/component.property.velocity',["tau/components/component.property.time"],function(PropertyComponent){return{create:function(config){return config.propertyName="velocity",PropertyComponent.create(config)}}});
define('tau/ui/templates/quick.add/ui.template.quick.add.content',["tau/core/templates-factory"],function(templates){var config={name:"quick.add.content",markup:['<div class="ui-quick-add-stats"></div>','<div class="ui-quick-add-content">','<div class="quick-add-lines">',"</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/quick.add/ui.template.quick.add.line',["tau/core/templates-factory"],function(templates){var config={name:"quick.add.line",markup:['<div class="ui-quick-add-line">',' <div class="quick-add-input ui-quick-add-new-item"></div>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/ui/extensions/quick.add/ui.extension.quick.add',["jQuery","Underscore","tau/core/extension.base.stateful","tau/ui/templates/quick.add/ui.template.quick.add.content","tau/ui/templates/quick.add/ui.template.quick.add.line","tau/ui/behaviour/common/ui.behaviour.editableText"],function($,_,ExtensionBase,templateContent,templateLine){return ExtensionBase.extend({"bus beforeInit":function(){var self=this;self.fire("dataBind",{label:this.config.label,entityType:this.config.entityType})},_attachKeyBoardHandling:function(){var self=this,keyBoardHandler={handleKeyDown:function(){}};this.config.context.configurator.getKeyBoardManager().pushHandler(keyBoardHandler)},_getEntityId:function(){return this.config.context.entity.id},_getEntityType:function(){return this.config.context.entity.entityType.name},"bus close":function(){var self=this;this.config.context.configurator.getKeyBoardManager().popHandler();if(!self.itemsAdded)return;self.config.store.evictProperties(self._getEntityId(),this._getEntityType(),self.config.evictProperties),setTimeout(function(){self.bus.fire(self.config.entityType+".items.added",self.config.context)},1)},_appendAddLine:function($content){var self=this,$existingAddLine=$(".ui-quick-add-new-item",$content);if($existingAddLine.length>0){setTimeout(function(){$existingAddLine.click()},1);return}var $line=templateLine.get().bind({},{entityType:self.config.entityType});$content.find(".quick-add-lines").append($line);var $input=$(".quick-add-input",$line);$input.editableText({restoreText:!0,resetOnBlur:!0,onSave:function(text){if(!text||!_.trim(text))return;text.length>255&&(text=text.substring(0,254)),text=text.replace(/\s+/gi," ");var store=self.config.store;if($input.hasClass("ui-quick-add-saving"))return;$input.removeClass("ui-quick-add-new-item").addClass("ui-quick-add-saving");var $set={name:text};self.config.additionalFieldsSet&&_.extend($set,self.config.additionalFieldsSet),$set[self.config.property]={id:self._getEntityId()};var relation={};relation[self.config.property]=["id"];var fields=["id","name",relation],cmd={$set:$set,fields:fields};$line.data("item-id")&&(cmd.id=$line.data("item-id"));var onStoreSave=function(r){$line.data("item-id",r.data.id),$line.addClass("ui-quick-add-item-saved"),$input.removeClass("ui-quick-add-saving").text(r.data.name),self.itemsAdded=!0;var message=$(".ui-quick-add-item-saved",$content).length+" item(s) saved";$(".ui-quick-add-stats",$content).text(message)},quickAdd=function(project,team){var addRefs=store.config.proxy.types[self.config.entityType].refs;project&&addRefs.project&&(cmd.$set.project={id:project.id}),team&&addRefs.team&&(cmd.$set.team={id:team.id}),self.config.onBeforeAdd&&self.config.onBeforeAdd(cmd),store.save(self.config.entityType,cmd,{success:function(r){onStoreSave(r)}}).done()};$(".ui-quick-add-stats",$content).text("saving...");var refs=store.config.proxy.types[self._getEntityType()].refs,fields=[{project:["id"]}];refs.team&&fields.push({team:["id"]}),store.get(self._getEntityType(),{id:self._getEntityId(),fields:fields},{success:function(r){quickAdd(r.data.project,r.data.team)}}).done(),self._appendAddLine($content)}}),$input.data("textEditor").onEscape=function(event){event.preventDefault(),this._cancelEdit(),this.$element.blur()},setTimeout(function(){$input.click()},1)},"bus displayQuickAdd":function(evt){var data=evt.data,self=this;self.itemsAdded=!1;var $content=data.popup.find(".tau-bubble__inner");if($content.find(".ui-quick-add-content").length==0){var $contentElements=templateContent.get().bind({},{});$content.append($contentElements)}data.api.adjustPosition(),$content.find(".quick-add-lines").html(""),$content.find(".ui-quick-add-stats").text(""),$content.find(".button-box").click(function(){data.api.hide()}),this._appendAddLine($content),self._attachKeyBoardHandling()},"bus afterRender":function(args){var self=this,$element=args.data.element,$addLink=$(".ui-quick-add-link",$element).tauBubble({onPositionConfig:function(c){return c.offset="-20 0",c}});$addLink.bind("show",function(e,data){self.bus.fire("displayQuickAdd",data)}),$addLink.bind("close",function(e,data){data.event&&(data.event.preventDefault(),data.event.stopPropagation()),self.bus.fire("close",data)})}})});
define('tau/ui/templates/quick.add/ui.template.quick.add',["tau/core/templates-factory"],function(templates){var config={name:"quick.add",markup:['<div class="ui-quick-add">','<span class="ui-link ui-quick-add-link">${label}</span>',"</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.quick.add',["tau/components/component.creator","tau/ui/extensions/quick.add/ui.extension.quick.add","tau/ui/templates/quick.add/ui.template.quick.add"],function(creator,ExtensionAdd,Template){return{create:function(config){var creatorConfig={extensions:[ExtensionAdd],template:Template};return creator.create(creatorConfig,config)}}});
define('tau/components/extensions/redirect/extension.redirect',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({_redirect:function(url){this.redirect.redirect(url)},"bus afterInit":function(evtData){this.redirect=this.config.context.configurator.getRedirect(),this._redirect(evtData.data.config.to)},"bus redirect":function(evtData){this._redirect(evtData.data.to)}})});
define('tau/components/component.redirect',["tau/components/component.creator","tau/models/model.menu.actions","tau/components/extensions/redirect/extension.redirect","tau/ui/templates/menu/ui.template.menu.actions"],function(creator,Model,ExtensionBase,template){return{create:function(config){var creatorConfig={extensions:[ExtensionBase]};return creator.create(creatorConfig,config)}}});
define('tau/models/relations/model.relations.add.popup',["tau/core/model-base"],function(ModelBase){return ModelBase.extend({"bus afterInit":function(evt){var self=this;self.store.get("relationTypes",{relationType:["id","name"]}).done({success:function(data){self.fire("dataBind",{relationTypes:data[0].data,relationTypeId:data[0].data[0].id})}})}})});
define('tau/ui/extensions/relations/ui.extension.relations.add',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus dataBind":function(evt){this.relationTypeId=evt.data.relationTypeId},"bus entityFinder.entitySelected":function(evt,data){this.entityId=data.entity.id,$(".i-role-add").removeAttr("disabled").addClass("tau-success")},"bus afterRender":function(evt,data){var $element=data.element;this._entityBehavior($element.find(".cf-input"));var self=this;$element.find(".i-role-selector").click(function(e){self._selectRelationType(e)}),$element.find(".i-role-add").click(function(e){self._addEntity()})},_addEntity:function(){var self=this,entity=this.config.context.entity;this.store.save("relation",{$set:{master:{id:this.config.dependencyType==="slave"?entity.id:this.entityId},slave:{id:this.config.dependencyType==="slave"?this.entityId:entity.id},relationType:{id:this.relationTypeId}}}).done(function(){self.store.evictProperties(entity.id,entity.entityType.name,["masterRelations","slaveRelations"]),setTimeout(function(){self.bus.fire("relations.changed",self.config.context)},1)})},_selectRelationType:function(e){var $target=$(e.target);$target.siblings("button.i-role-selector").removeClass("tau-checked"),$target.addClass("tau-checked"),this.relationTypeId=$target.data("id")},_entityBehavior:function($element){var $entityField=$element.closest(".i-role-entity-selector"),$entitySelector=$entityField.find(".tau-userStorySelector"),entityUniqueName=$element.data("entityuniquename"),$entitySelectorControl=$entityField.find(".tau-userStorySelector__control"),intervalID=null,position={of:$entitySelectorControl,my:"left top",at:"left bottom",collision:"flip flip",offset:"0 2"};$entitySelector.on("click keydown focus",function(e){var keyCode=$.ui.keyCode;if(!$(this).hasClass("focus")&&e.type=="focus"||e.type=="click"||e.type=="keydown"&&(e.keyCode==keyCode.DOWN||e.keyCode==keyCode.UP)){$entitySelector.hide();var entityList=$entitySelectorControl.show(),list=entityList.find(".tau-finder__result_user-stories");list.outerWidth(entityList.outerWidth()),entityList.find(".tau-finder__table_quick-add").on("menuentityrefresh",function(){entityList.find(".tau-finder__result_user-stories").position().top<0&&entityList.is(":visible")&&(position={of:$entitySelectorControl,my:"left bottom",at:"left top",collision:"flip flip",offset:"0 0"}),entityList.find(".tau-finder__result_user-stories").position(position)}),entityList.find(".tau-finder__result_user-stories").position(position),entityList.find("input").focus()}}),$entitySelector.focusout(function(){$(this).removeClass("focus")}),$entitySelectorControl.focusout(function(){clearTimeout(intervalID),intervalID=setTimeout(function(){$entitySelectorControl.hide(),$entitySelector.show()},0)}),$entitySelectorControl.keydown(function(event){event.keyCode==$.ui.keyCode.ESCAPE&&($entitySelectorControl.hide(),$entitySelector.show().addClass("focus").focus(),event.stopImmediatePropagation())}),$entitySelectorControl.focusin(function(){clearTimeout(intervalID)}),this.on("entityFinder.entitySelected",function(evt,data){var entity=data.entity;$element.data("value",data.entity),$element.val(entity.id).change();var $entityTypeIcon=$entitySelector.find(".tau-linkentity__icon"),classes=$entityTypeIcon.attr("class").replace(/ui-type-icon-\S+/ig,"ui-type-icon-"+entity.entityType.name.toLowerCase());$entityTypeIcon.attr("class",classes),$entityTypeIcon.text(entity.id).show(),$entitySelector.find(".tau-linkentity__inner").text(entity.name).removeClass("tau-linkentity__inner_placeholder"),$entitySelectorControl.hide(),$entitySelector.show().addClass("focus").focus()})}})});
define('tau/ui/templates/relations/ui.template.relations.add.popup',["tau/core/templates-factory"],function(templates){var t="",config={name:"relations-add-popup",engine:"jqote2",markup:['<div class="tau-quick-add-dialog tau-add-relations-dialog">','<div class="tau-entity-selector">','<div class="quick-add__entity-items" style="padding:10px">',"<% for(var i=0; i<this.relationTypes.length; i++){%>",'<button type="button" data-id="<%= this.relationTypes[i].id %>" data-name="<%= this.relationTypes[i].name%>"','class="i-role-selector tau-btn tau-<%=this.relationTypes[i].name.toLowerCase()%> ','<%= (this.relationTypeId === this.relationTypes[i].id ? "tau-checked" : "")%>">',"<%= this.relationTypes[i].name %>","</button>","<%}%>","</div>","</div>",'<div class="tau-entity-fields">','<form class="tau-fieldset tau-active">','<div class="i-role-entity-selector tau-field_entity tau-field" style="font-size: 16px;">','<div tabindex="0" class="tau-userStorySelector">','<input type="hidden" data-entityuniquename="userstories" name="entity" class="cf-input">','<span class="userStorySelector ui-link"><em class="ui-type-icon ui-type-icon-userstory tau-linkentity__icon" style="display: none;"></em>','<span class="tau-linkentity__inner tau-linkentity__inner_placeholder">Select Entity</span>',"</span>","</div>",'<div tabindex="0" class="tau-userStorySelector__control">','<span data-name="entityFinder" runas="finder.entity" data-context:general=""></span>',"</div>","</div>","</form>","</div>",'<div style="padding:10px">','<button type="button" class="tau-btn i-role-add <%= this.entity ? "tau-success" : "" %>" ','<%= this.entity ? "" : "disabled" %> >Add</button>',"</div>","</div>"]};return templates.register(config)});
define('tau/components/component.relations.add.popup',["tau/components/component.creator","tau/components/extensions/component.creator.extension","tau/components/extensions/bubble/extension.bubble.creator","tau/models/relations/model.relations.add.popup","tau/views/view.compositeControl","tau/ui/extensions/relations/ui.extension.relations.add","tau/ui/extensions/container/ui.extension.container.childrenEvents","tau/ui/templates/relations/ui.template.relations.add.popup"],function(ComponentCreator,CreatorExtension,BubbleCreatorExtension,Model,ViewCompositeControl,RelationsAddExtension,ChildrenEvents,Template){return{create:function(config){var creatorConfig={ViewType:ViewCompositeControl,extensions:[CreatorExtension,BubbleCreatorExtension,Model,RelationsAddExtension,ChildrenEvents],template:Template};return config.dependencies=["finder.entity"],ComponentCreator.create(creatorConfig,config)}}});
define('tau/models/dataProviders/model.provider.items.relations',["Underscore","tau/core/class"],function(_,Class){return Class.extend({init:function(config){this.entityId=config.context.entity.id,this.store=config.store,this.relatedEntityFieldName=config.dependencyType||"master",this.relationsFieldName=this.relatedEntityFieldName+"Relations",this.entityTypeName=config.context.entity?config.context.entity.entityType.name:"general",this.config=config},fetch:function(callback){var command={id:this.entityId,fields:[this._buildRelationsField()]};this.store.get(this.entityTypeName,command).done({success:function(data){this._fetchRelatedEntitiesInfo(data[0].data[this.relationsFieldName],callback)},scope:this})},_buildRelationsField:function(){var relationsField={};relationsField[this.relationsFieldName]=[{relationType:["name"]}];var relationsRelatedEntityField={};return relationsRelatedEntityField[this.relatedEntityFieldName]=["id",{entityType:["name"]}],relationsField[this.relationsFieldName].push(relationsRelatedEntityField),relationsField},_fetchRelatedEntitiesInfo:function(relations,callback){var relationsGrouped=_.groupBy(relations,_.bind(function(relation){return relation[this.relatedEntityFieldName].entityType.name},this)),requests=this._buildRelatedEntitiesInfoRequests(relationsGrouped);_.parallel(requests,_.bind(function(error,relatedEntityInfosGrouped){relationsGrouped=this._fillRelatedEntitiesInfo(relationsGrouped,relatedEntityInfosGrouped),callback(this.transform(relationsGrouped))},this))},_buildRelatedEntitiesInfoRequests:function(relationsGrouped){return _.map(_.keys(relationsGrouped),function(relatedEntityTypeName){return _.bind(function(onSuccess){this.store.find(relatedEntityTypeName,{fields:this._getFieldsForRelatedEntityInfo(relatedEntityTypeName),$query:{id:{$in:_.map(relationsGrouped[relatedEntityTypeName],function(relation){return relation[this.relatedEntityFieldName].id},this)}}}).done({success:function(result){onSuccess(!1,result[0].data)}})},this)},this)},_fillRelatedEntitiesInfo:function(relationsGrouped,relatedEntityInfosGrouped){return relationsGrouped=_.reduce(relatedEntityInfosGrouped,function(relationsGroupedMemo,relatedEntityInfos){return relatedEntityInfos.length>0&&(relationsGroupedMemo[relatedEntityInfos[0].entityType.name]=_.reduce(relatedEntityInfos,function(relationsOfTypeMemo,relatedEntityInfo){var relationToBeFilled=_.find(relationsOfTypeMemo,_.bind(function(relation){return relation[this.relatedEntityFieldName].id==relatedEntityInfo.id},this)),relatedEntityToBeFilled=relationToBeFilled[this.relatedEntityFieldName];return _.extend(relatedEntityToBeFilled,relatedEntityInfo,{relatedEntityInfoIsFilled:!0}),relationsOfTypeMemo},relationsGroupedMemo[relatedEntityInfos[0].entityType.name],this)),relationsGroupedMemo},relationsGrouped,this),relationsGrouped},_getFieldsForRelatedEntityInfo:function(entityTypeName){var baseFieldSet=["id","name",{entityType:["name"]},{project:["abbreviation"]}];switch(entityTypeName.toLowerCase()){case"userstory":case"bug":case"feature":case"task":case"testplanrun":case"testcaserun":case"request":return baseFieldSet.concat([{entityState:["name","isFinal"]},{release:["name"]},{iteration:["name"]}]);case"iteration":return baseFieldSet.concat([{release:["name"]}]);case"build":return baseFieldSet.concat([{release:["name"]},{iteration:["name"]}]);case"impediment":return baseFieldSet.concat([{entityState:["name","isFinal"]}]);case"testcase":return baseFieldSet.concat(["lastStatus"]);default:return baseFieldSet}},transform:function(relationsGrouped){var items=[],maxEntityTypeId=0,urlBuilder=this.config.context.configurator.getUrlBuilder();return _.reduce(_.values(relationsGrouped),function(itemsMemo,relations){return _.forEach(relations,function(relation){var relatedEntity=relation[this.relatedEntityFieldName];relatedEntity.relatedEntityInfoIsFilled&&(itemsMemo.push({id:relatedEntity.id,__type:relatedEntity.__type,entityType:relatedEntity.entityType,name:relatedEntity.name,project:relatedEntity.project?relatedEntity.project.abbreviation:"",entityState:relatedEntity.entityState,hasLastStatus:relatedEntity.hasOwnProperty("lastStatus"),lastStatus:relatedEntity.lastStatus,release:relatedEntity.release?relatedEntity.release.name:"",iteration:relatedEntity.iteration?relatedEntity.iteration.name:"",url:urlBuilder.getNewViewUrl(relatedEntity.id,relatedEntity.entityType.name,!0),relation:{id:relation.id,__type:relation.__type,relationType:relation.relationType}}),relatedEntity.entityType.id>maxEntityTypeId&&(maxEntityTypeId=relatedEntity.entityType.id))},this),itemsMemo},items,this),_.sortBy(items,function(item){return item.entityState&&item.entityState.isFinal?maxEntityTypeId+item.entityType.id:item.entityType.id})}})});
define('tau/ui/extensions/list/relations/ui.extension.list.relations.action.detach',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var $el=evt.data.element,store=this.config.store,bus=this.bus;$el.on("click",".i-role-action-detach",function(e){var relationId=$(e.target).data("relationId");store.remove("relation",{id:relationId}).done({success:function(){bus.fire("refresh")}})})}})});
define('tau/ui/extensions/list/relations/ui.extension.list.relations.action.attach',["Underscore","JQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var $attachButton=$(renderData.element).find(".i-role-action-attach");this._initBubble($attachButton)},_initBubble:function($target){var bubbleConfig={target:$target,className:"tau-bubble__inner_without_scroll",actionOnBlur:"destroy",componentsConfig:{components:[{type:"relations.add.popup",dependencyType:this.config.dependencyType}]}};this.fire("initBubble",bubbleConfig)}})});
define('tau/ui/extensions/ui.extension.help',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({name:"ui.extension.help",category:"view","bus afterRender":function(evt){var view=evt.data.view;evt.data.element.find(".i-role-help").each(function(){var $helpEl=$(this),$content=$helpEl.next(".i-role-help-content").detach();$content.show(),$helpEl.tauBubble({content:$content,className:"tau-bubble-tooltip",zIndex:999,onShow:function(){view.config.context.configurator.getKeyBoardManager().pushHandler({})},onHide:function(){view.config.context.configurator.getKeyBoardManager().popHandler()}})})}})});
define('tau/ui/templates/list_/grid.entity.relations/ui.template.list.grid.entity.relations',["tau/core/templates-factory","tau/ui/templates/list_/grid.entity/relation/ui.template.list.grid.entity.row.relation"],function(templates){var config={name:"list-grid-entity-relations",markup:['<div class="tau-relations-item">','<div class="tau-entity-caption">',"<h2>${config.currentView.headerText}</h2>",'<button type="button" tabindex="-1" class="tau-help i-role-help"></button>','<div class="tau-help-content i-role-help-content">{{html config.currentView.headerHelp}}</div>','<div class="tau-btn-wrap">','<button type="button" class="tau-btn tau-success i-role-action-attach">Add more</button>',"</div>","</div>",'<div class="tau-relations-cont">','<table class="tau-table">',"<colgroup>",'<col class="tau-relation-type" />','<col class="tau-entity-id" />',"<col />",'<col class="tau-entity-field" />','<col class="tau-entity-field" />','<col class="tau-entity-field" />','<col class="tau-entity-field" />','<col class="tau-relation-action" />',"</colgroup>","<tbody>","{{tmpl(items) $item.data.config.currentView.rowTemplateName }}","</tbody>","</table>","{{if items.length > 0}}",'<div class="tau-pointer"></div>',"{{/if}}","</div>","{{if items.length == 0}}",'<div class="tau-pointer"></div>',"{{/if}}"],dependencies:["list-grid-entity__row_relation"]};return templates.register(config)});
define('tau/components/component.relations.container',["Underscore","tau/components/component.container","tau/components/extensions/component.creator.extension","tau/components/extensions/bubble/extension.bubble.creator","tau/models/dataProviders/model.provider.items.relations","tau/ui/extensions/list/relations/ui.extension.list.relations.action.detach","tau/ui/extensions/list/relations/ui.extension.list.relations.action.attach","tau/ui/extensions/ui.extension.help","tau/ui/extensions/list/request/extension.list.entityState","tau/ui/templates/list_/grid.entity.relations/ui.template.list.grid.entity.relations"],function(_,ComponentContainer,CreatorExtension,BubbleCreatorExtension,RelationsDataProvider,RelationsActionDetachExtension,RelationsActionAttachExtension,HelpExtension,EntityStateListExtension,EntityRelationsGridTemplate){return{create:function(config){var creatorConfig={template:{name:"relations-container",markup:['<div class="tau-relations"></div>']},children:[{name:"master relations list",type:"list.editable",itemsDataProvider:RelationsDataProvider,dependencyType:"master",externalRefreshEvents:["relations.changed"],extensions:[CreatorExtension,BubbleCreatorExtension,RelationsActionDetachExtension,RelationsActionAttachExtension,HelpExtension,EntityStateListExtension],views:[{rowTemplateName:"list-grid-entity__row_relation",headerText:"Inbound",headerHelp:"The inbound entities must be completed <b>BEFORE</b> the core entity is done."}],template:EntityRelationsGridTemplate},{type:"label.relations",entity:config.context.entity},{name:"slave relations list",type:"list.editable",itemsDataProvider:RelationsDataProvider,dependencyType:"slave",externalRefreshEvents:["relations.changed"],extensions:[CreatorExtension,BubbleCreatorExtension,RelationsActionDetachExtension,RelationsActionAttachExtension,HelpExtension,EntityStateListExtension],views:[{rowTemplateName:"list-grid-entity__row_relation",headerText:"Outbound",headerHelp:"The outbound entities can be completed only <b>AFTER</b> the core entity is done."}],template:EntityRelationsGridTemplate}]};return ComponentContainer.create(_.extend(config,creatorConfig))}}});
define('tau/models/model.release.progressBar',["Underscore","tau/core/model-base"],function(_,ModelBase){var IterationProgressBarModel=ModelBase.extend({name:"Iteration Progress Bar",afterSaveRoleEffort:function(command){var self=this;self.fire("roleEffortChanged")},onDataUpdate:function(evt){var self=this;self.fire("refresh")},floatToString:function(flt){return flt.toFixed(2).replace(".00","")},_getEffortPoints:function(){return this.config.context.getEffortPoint().shortName},onInit:function(){var self=this,ctx=this.config.context,entityTypeName=ctx.entity.entityType.name,entityId=ctx.entity.id,fields=["bugs-effortToDo-sum","bugs-effortCompleted-sum","userStories-effortToDo-sum","userStories-effortCompleted-sum",{features:["effortToDo","effortCompleted","userStories-count"]}];self.store.unbind(self),self.store.on({eventName:"afterSave",type:"roleEffort",listener:self,filter:{assignable:{id:entityId}}},_.bind(self.afterSaveRoleEffort,self)),self.store.on({eventName:"afterSave",type:entityTypeName,listener:self,filter:{id:entityId},hasChanges:[fields.join("|")]},_.bind(self.onDataUpdate,self)),self.store.get(entityTypeName,{id:entityId,fields:fields},{success:self.onEntityRetrieved,scope:self}).done({success:self.done,scope:self})},onEntityRetrieved:function(result){var src=result.data,filter=function(feature){return feature["userStories-count"]==0},features=result.data.features,featuresWithoutUserStories=_.filter(features,filter),toDo=_.pluck(featuresWithoutUserStories,"effortToDo"),completed=_.pluck(featuresWithoutUserStories,"effortCompleted"),sum=function(arr){return _.reduce(arr,function(memo,num){return memo+num},0)},effortToDo=src["bugs-effortToDo-sum"]+src["userStories-effortToDo-sum"]+sum(toDo),effortCompleted=src["bugs-effortCompleted-sum"]+src["userStories-effortCompleted-sum"]+sum(completed),total=Math.round(100*parseFloat(effortToDo)+100*parseFloat(effortCompleted))/100,percentCompleted=Math.round(1e4*(effortCompleted/total))/100;percentCompleted=isNaN(percentCompleted)?0:percentCompleted,percentCompleted=percentCompleted>100?100:percentCompleted,this.effortToDo=effortToDo,this.effortCompleted=effortCompleted,this.percentCompleted=percentCompleted},done:function(){this.fire("dataBind",{effortToDo:this.floatToString(this.effortToDo),effortCompleted:this.floatToString(this.effortCompleted),percentCompleted:this.percentCompleted,totalEffort:this.floatToString(this.effortToDo+this.effortCompleted),point:this._getEffortPoints()})}});return IterationProgressBarModel});
define('tau/components/component.release.assignedEffort',["tau/components/component.creator","tau/models/model.release.progressBar","tau/ui/templates/label/ui.template.assignmentEffort.label"],function(creator,ModelIterationProgressBar,template){return{create:function(config){var creatorConfig={extensions:[ModelIterationProgressBar],template:template};return creator.create(creatorConfig,config)}}});
define('tau/components/component.release.progressBar',["tau/components/component.creator","tau/models/model.release.progressBar","tau/ui/templates/progressBar/ui.template.iteration.progressBar"],function(creator,ModelIterationProgressBar,template){return{create:function(config){var creatorConfig={extensions:[ModelIterationProgressBar],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.releaseNotes',["Underscore","tau/core/model-base","tau/utils/utils.date"],function(_,ModelBase,dateUtils){var model=ModelBase.extend({onInit:function(){var entity=this.config.context.entity,store=this.config.store,self=this;store.unbind(this),store.on({eventName:"afterSave",type:"assignable",listener:this},function(e){var changes=["entityState","name"],types=["feature","userstory","bug"];_.include(types,e.data.cmd.type.toLowerCase())&&_.intersect(_.keys(e.data.changes),changes).length&&self.bus.fire("refresh")});var types=["feature","userstory","bug"];_.forEach(types,function(type){store.on({eventName:"afterRemove",type:type,listener:self},function(e){self.bus.fire("refresh")})}),store.get("release",{id:entity.id,fields:["id","name","startDate","endDate"]}).find("bugs",{fields:["id","name"],$query:{"Release.Id":entity.id,"EntityState.isFinal":1},$orderBy:"id"}).find("features",{fields:["id","name",{release:["id"]},{entityState:["id","isFinal"]},{userStories:["id","name",{release:["id"]},{entityState:["id","isFinal"]}]}],$query:{"Release.Id":entity.id},$orderBy:"id"}).find("userStories",{fields:["id","name",{release:["id"]},{feature:["id"]},{entityState:["id","isFinal"]}],$query:{"Release.Id":entity.id,"EntityState.isFinal":1},$orderBy:"id"}).done({success:function(res){var features=res[2].data,targetFeatures=[],allFeatureIds=_.pluck(features,"id");_.forEach(features,function(feature){var finalUs=[],openUs=[];_.forEach(feature.userStories,function(userStory){userStory.release&&userStory.release.id===feature.release.id&&(userStory.entityState.isFinal==1?finalUs.push(userStory):openUs.push(userStory))}),finalUs.length>0?(feature.userStories=finalUs,targetFeatures.push(feature)):feature.entityState.isFinal==1&&openUs.length>0&&openUs.length==feature.userStories.length&&(feature.userStories=[],targetFeatures.push(feature))});var item=res[0].data;item.endDate=dateUtils.format.date.short(item.endDate);var bugs=res[1].data,userStories=res[3].data;userStories=_.filter(userStories,function(us){return!us.feature||!us.feature.id||_.indexOf(allFeatureIds,us.feature.id)==-1}),self.bus.fire("dataBind",{item:item,features:targetFeatures,bugs:bugs,userStories:userStories})}})}});return model});
define('tau/ui/templates/releaseNotes/ui.template.releaseNotes',["tau/core/templates-factory"],function(templates){var config={name:"releaseNotes",markup:['<div class="tau-releaseNotes">','<div class="tau-releaseNotes__inner">','<span class="tau-releaseNotes__title">${item.name} / ${item.endDate}</span><br />',"----------------------------------------------------------<br /><br />","{{if features.length || userStories.length}}",'<div class="tau-releaseNotes__subtitle">Added features</div><br /><br />',"{{each features}}",'<div class="tau-releaseNotes__feature" data-name="${name}">',"- ${name}<br />","{{each userStories}}",'<div class="tau-releaseNotes__userstory" data-name="${name}">',"&nbsp;&nbsp;&nbsp;&nbsp;- ${name}<br />","</div>","{{/each}}","</div>","{{/each}}","{{each userStories}}",'<div class="tau-releaseNotes__userstory tau-releaseNotes__userstory_separate_true" data-name="${name}">',"- ${name}<br />","</div>","{{/each}}","<br /><br />","{{/if}}","{{if bugs.length}}",'<div class="tau-releaseNotes__subtitle">Fixed Bugs</div><br /><br />',"{{each bugs}}",'<div class="tau-releaseNotes__bug" data-name="${name}">',"#${id} ${name}<br />","</div>","{{/each}}","{{/if}}","</div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.releaseNotes',["tau/components/component.creator","tau/models/model.releaseNotes","tau/ui/templates/releaseNotes/ui.template.releaseNotes"],function(creator,Model,template){return{create:function(config){var creatorConfig={extensions:[Model],template:template};return creator.create(creatorConfig,config)}}});
define('tau/components/extensions/requestsList/extension.requestList.refresher',["tau/components/extensions/component.extension.base"],function(ExtensionBase){return ExtensionBase.extend({init:function(){this._super.apply(this,arguments),this.bus.getGlobalBus().on("requestWasAttachedToEntity",this.onRequestsUpdates,this),this.bus.getGlobalBus().on("requestIsDetachedFromEntity",this.onRequestsUpdates,this),this.bus.getGlobalBus().on("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this)},destroy:function(){this.bus.getGlobalBus().removeListener("requestWasAttachedToEntity",this.onRequestsUpdates,this),this.bus.getGlobalBus().removeListener("requestIsDetachedFromEntity",this.onRequestsUpdates,this),this.bus.getGlobalBus().removeListener("bugWasMarkedAsDuplicate",this.onBugWasMarkedAsDuplicate,this),this._super.apply(this,arguments)},refreshComponentIfEntityFromCurrentContext:function(evt){this.isEntityInContext(evt)&&this.refresh()},onRequestsUpdates:function(evt){this.refreshComponentIfEntityFromCurrentContext(evt)},onBugWasMarkedAsDuplicate:function(evt){var entityId=this.config.context.entity.id;entityId===evt.data.bugId&&this.refresh()},refresh:function(){this.fire("evictProperty"),this.fire("refresh")}})});
define('tau/components/extensions/requestsList/extension.requestList.actions.detach',["jQuery","tau/components/extensions/component.extension.base"],function($,ExtensionBase){return ExtensionBase.extend({category:"edit","bus dataBind+afterRender":function(evt){var self=this,data=evt.dataBind.data,$element=evt.afterRender.data.element;if(data.items&&data.items.length){var $cell=$('<td class="action"></td>'),$actionDetach=$('<span class="action-detach button small">Detach</span>');$actionDetach.click($.proxy(self.onActionDetach,self)),$cell.append($actionDetach);var $rows=$element.find("table.base-info-list tbody > tr");$rows.append($cell)}},onActionDetach:function(evt){var self=this,generalId=self.config.context.entity.id,requestId=$(evt.target).parent().parent().data().tmplItem.data.id,actionsService=self.config.context.configurator.getActionsService();actionsService.detachRequest({generalId:generalId,requestId:requestId,success:$.proxy(self.onRequestDetachedSuccess,self)})},onRequestDetachedSuccess:function(){var self=this;self.fire("evictProperty");var generalId=self.config.context.entity.id;self.fire("requestIsDetachedFromEntity",{entity:{id:generalId}})}})});
define('tau/components/component.requestList',["tau/components/component.list.baseInfo","tau/components/extensions/requestsList/extension.requestList.refresher","tau/components/extensions/requestsList/extension.requestList.actions.detach"],function(componentListEntity,RequestListRefresher,RequestListActionDetach){return{create:function(config){var creatorConfig={extensions:[RequestListRefresher,RequestListActionDetach]};return config.typeName="request",config.propertyName="requests",componentListEntity.create(config,creatorConfig)}}});
define('tau/models//model.revisionList',["Underscore","tau/core/model-base","tau/utils/utils.date"],function(_,ModelBase,dateUtils){return ModelBase.extend({retrieveRevisions:function(entities){var store=this.store,revisionFields=["id","sourceControlId","description","commitDate",{author:["firstName","lastName"]},{revisionFiles:["id","fileName","fileAction"]}];for(var i=0;i<entities.length;i++)store=store.get(entities[i].type,{id:entities[i].id,nested:!0,fields:["id",{revisions:revisionFields}]});store.done({success:this.onRevisionsRetrieved,scope:this})},onInit:function(){var self=this,assignable=self.config.context.entity,entityType=assignable.entityType.name,entityId=assignable.id,entities=[{type:entityType,id:entityId}],store=this.store;entityType.toLowerCase()=="userstory"?store.get(entityType,{id:entityId,fields:[{tasks:["id"]}]}).done({success:this.onTasksIdRetrieved,scope:this}):this.retrieveRevisions(entities)},onTasksIdRetrieved:function(result){var us=result[0].data,entities=[{type:us.__type,id:us.id}];entities=entities.concat(_.map(us.tasks,function(task){return{id:task.id,type:task.__type}})),this.retrieveRevisions(entities)},onRevisionsRetrieved:function(result){var revisions=_.pluck(result,"data");revisions=_.pluck(revisions,"revisions"),revisions=_.flatten(revisions),this.bindRevisions(revisions)},onRevisionIdsRetrieved:function(result){var allRevisions=_.clone(result[0].data.revisions);if(result.length>1){var revisionsOfTasks=_.pluck(result[1].data,"revisions");_.each(revisionsOfTasks,function(revisions){allRevisions=allRevisions.concat(revisions)})}var revisionsId=_.pluck(allRevisions,"id")},bindRevisions:function(revisions){var actionText={Add:"Added",Delete:"Deleted",Modify:"Modified"};revisions=_.sortBy(revisions,function(revision){return-revision.id}),this.fire("dataBind",{items:_.map(revisions,function(revision){var author=revision.author||{firstName:"unknown",lastName:""},authorName=_.trim([author.firstName,author.lastName].join(" ")),refs={commitDate:dateUtils.format.datetime.short(revision.commitDate),author:authorName,revisionFiles:_.map(revision.revisionFiles,function(revisionFile){return _.extend(_.clone(revisionFile),{fileAction:actionText[revisionFile.fileAction]||revisionFile.fileAction})})};return _.extend(_.clone(revision),refs)})})},onEntityRetrieved:function(result){var revisions=result.data.revisions;this.bindRevisions(revisions)},"bus evictTestCases":function(){var assignable=this.config.context.entity;this.store.evictProperties(assignable.id,assignable.entityType.name,["testCases","testCases-count"])}})});
define('tau/ui/extensions/testCaseList/ui.extension.testCaseList',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt){var self=this;self.element=evt.data.element,self.element.find("tbody .extra-info").click(function(){self._onButtonClick.call(self,this)}),self.element.find("thead .extra-info.expand").click(function(){self.expandAll()}),self.element.find("thead .extra-info.collapse").click(function(){self.collapseAll()})},"bus expandTestCase":function(evtArgs){var testCaseId=evtArgs.data.testCaseId;this.element.find("tbody.collapsed").each(function(){$(this).tmplItem().data.id==testCaseId&&$(this).removeClass("collapsed").find(".extra-info").removeClass("expand").addClass("collapse")})},expandAll:function(){this.element.find("tbody.collapsed").removeClass("collapsed"),this._changeButtonsState("expand","collapse","-")},collapseAll:function(){this.element.find("tbody:not(.collapsed)").addClass("collapsed"),this._changeButtonsState("collapse","expand","+")},_changeButtonsState:function(buttonClsName,addCls,text){var selector="tbody .extra-info."+buttonClsName,expandItem=function(){$(this).addClass(addCls).removeClass(buttonClsName).children("div").text(text)};this.element.find(selector).each(expandItem)},_onButtonClick:function(target){$(target).toggleClass("collapse").toggleClass("expand").parents("tbody").toggleClass("collapsed");var $child=$(target).children("div"),text=$child.text();text=="+"?text="-":text="+",$child.text(text)}})});
define('tau/ui/templates/common/ui.template.entityLink',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/common/ui.template.entityLink"],function(templates,termTag){var config={tags:[termTag],name:"entity-link",markup:['<a href="${url}" class="ui-link-entity">','<em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">${id}</em>',"</a>&nbsp;&nbsp;"],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/revisionList/ui.template.revisionList.files',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink"],function(templates){var config={name:"revision-list-files",markup:["<tr>",'   <td class="actions"><span>${fileAction}</span></td>','   <td class="diff"></td>','   <td class="files"><a target="_blank" class="vcsViewDisabled" disabled="disabled">${fileName}</a></td>',"</tr>"].join(""),dependencies:["entity-link"]};return templates.register(config)});
define('tau/ui/templates/revisionList/ui.template.revisionList.revision',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink","tau/ui/templates/revisionList/ui.template.revisionList.files"],function(templates){var config={name:"revision-list-revision",markup:['<tbody class="collapsed">','   <tr class="first-row">','       <td class="toggler"><button class="extra-info expand" type="button"><div>+</div></button></td>','       <td class="revision-id">#&nbsp;${sourceControlId}</td>','       <td class="revision">${commitDate}&nbsp;by&nbsp;<span class="author">${author}</span></td>','       <td class="revision-comment">${description}</td>',"   </tr>",'   <tr class="revision-files second-row">',"       <td></td>",'       <td colspan="3">',"           <table>",'           {{tmpl(revisionFiles) "revision-list-files"}}',"           </table>","       </td>","   </tr>","</tbody>"].join(""),dependencies:["entity-link"]};return templates.register(config)});
define('tau/ui/templates/revisionList/ui.template.revisionList',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/revisionList/ui.template.revisionList.revision"],function(templates,termTag){var config={name:"revision-list",options:{contentSelector:".ui-revisionList-content"},tags:[termTag],markup:['<div class="ui-revisionList">','   <div class="ui-revisionList-content"{{if items.length === 0}} style="display:none"{{/if}}>','       <table class="ui-revisionList">',"           <colgroup>",'               <col class="toggler">','               <col class="revision-id">','               <col class="revision">','               <col class="comment">',"           </colgroup>","           <thead>","               <tr>",'                   <th class="toggler"></th>','                   <th class="revision-id"></th>','                   <th class="revision"></th>','                   <th class="comment"></th>',"               </tr>","           </thead>",'           {{tmpl(items) "revision-list-revision"}}',"       </table>","   </div>","</div>"].join(""),dependencies:["revision-list-revision"]};return templates.register(config)});
define('tp/gateway',["jQuery"],function($){function Gateway(){}return Gateway.prototype={postJSON:function(url,data,success,fail,error){$.ajax({url:url,data:data?JSON.stringify(data):data,success:success,error:$.proxy(function(response){if(!response||!response.getResponseHeader)return;var contentType=response.getResponseHeader("content-type");if(!contentType)return;contentType.indexOf("application/json")!=-1?response.status==400&&fail?fail(response):response.status==500&&error&&error(response):error&&error(response)},this),type:"POST",dataType:"json",contentType:"application/json"})},getJSON:function(url,success){$.ajax({url:url,dataType:"json",contentType:"application/json",success:success})}},new Gateway});
define('tp/plugins/pluginsRepository',["app.path","tp/gateway","jQuery"],function(AppPath,gateway,$){function PluginsRepository(){this._ctor()}var appPath=AppPath.get();return PluginsRepository.prototype={_requestUrlBase:"/api/v1/Plugins.asmx",_registeredPlugins:null,_waitingForPluginsCallbacks:null,_ctor:function(){this.gateway=gateway},_getUrl:function(){var url=appPath+this._requestUrlBase;return url},pluginsRetrieved:function(plugins){this._registeredPlugins=plugins;for(var i=0;i<this._waitingForPluginsCallbacks.length;i++)this._waitingForPluginsCallbacks[i](this._registeredPlugins)},getStartedPlugins:function(success){!this._registeredPlugins&&!this._waitingForPluginsCallbacks?(this._waitingForPluginsCallbacks=[success],this.gateway.postJSON(this._getUrl(),{},$.proxy(this.pluginsRetrieved,this))):!this._registeredPlugins&&this._waitingForPluginsCallbacks?this._waitingForPluginsCallbacks.push(success):this._registeredPlugins&&success(this._registeredPlugins)},pluginStartedAndHasAtLeastOneProfile:function(pluginName,success){this.getStartedPlugins($.proxy(function(data){var plugins=$.grep(data,function(element){var plugin=$.grep(element.plugins,function(item){return item.name==pluginName});if(plugin.length===0)return!1;var hasProfiles=!1;return $(plugin).each(function(index,item){item.profiles.length>0&&(hasProfiles=!0)}),hasProfiles});plugins.length>0&&success()},this))}},new PluginsRepository});
define('tp/bus',["jQuery"],function($){var bus=function(){var components={},publish=function(event,args,source){var e=event||!1,a=args||[];if(!e)return;for(var c in components)if(typeof components[c]["on"+e]=="function")try{var s=source||components[c];components[c]["on"+e].apply(s,a)}catch(err){}},subscribe=function(name,component,replaceDuplicate){if(name in components){if(!replaceDuplicate)throw new Error("Mediator name conflict: "+name);unsubscribe(name)}components[name]=component},unsubscribe=function(name){name in components&&delete components[name]};return{name:"Bus",publish:publish,subscribe:subscribe,unsubscribe:unsubscribe}};return bus()});
define('tp/plugins/profileNameSource',["tp/bus","app.path","jQuery","tp/mashups"],function(bus,appPath){function ProfileNameSource(config){this._create(config)}return ProfileNameSource.prototype={_create:function(config){this.bus=bus,this.bus.subscribe("ProfileNameSource",{onProfileSaveSucceed:$.proxy(function(profile){this.setProfileName(profile.Name)},this)},!0)},getPluginName:function(){return(new appPath.tp.URL(location.href)).getArgumentValue("PluginName")},getProfileNameKey:function(){return"ProfileName"},getProfileName:function(){var url=new appPath.tp.URL(location.href),profileName=url.getArgumentValue(this.getProfileNameKey());if(!profileName){var hash=url.getReference();hash&&(profileName=hash.substr(1))}return profileName},setProfileName:function(profileName){if(this.getProfileName())return;window.location=window.location+"#"+profileName}},new ProfileNameSource});
define('tp/plugins/commandGateway',["jQuery","tp/plugins/profileNameSource","tp/gateway","app.path"],function($,profileNameSource,gateway,appPath){function CommandGateway(config){this._create(config)}return CommandGateway.prototype={_requestUrlBase:"/api/v1/Plugins.asmx/{PluginName}/Commands/{CommandName}",_requestForProfileUrlBase:"/api/v1/Plugins.asmx/{PluginName}/Profiles/{ProfileName}/Commands/{CommandName}",_pluginName:null,_create:function(config){this.profileNameSource=profileNameSource,this.gateway=gateway,config&&config.pluginName?this._pluginName=config.pluginName:this._pluginName=this.profileNameSource.getPluginName()},_getUrl:function(commandName){var relativeUrl=this._requestUrlBase.replace(/{PluginName}/g,this._pluginName).replace(/{CommandName}/g,commandName);return(new appPath.tp.WebServiceURL(relativeUrl)).url},_getUrlForProfile:function(commandName){var relativeUrl=this._requestForProfileUrlBase.replace(/{PluginName}/g,this._pluginName).replace(/{ProfileName}/g,this.profileNameSource.getProfileName()).replace(/{CommandName}/g,commandName);return(new appPath.tp.WebServiceURL(relativeUrl)).url},_post:function(url,data,success,fail,error){this.gateway.postJSON(url,data,function(response){success&&success(response)},function(response){fail&&fail(response.responseText)},function(response){error&&error(response.responseText)})},execute:function(command,data,success,fail,error){this._post(this._getUrl(command),data,success,fail,error)},executeForProfile:function(command,data,success,fail,error){this._post(this._getUrlForProfile(command),data,success,fail,error)}},CommandGateway});
define('tp/popup',["jQuery"],function($){$.widget("ui.popup",$.ui.dialog,{options:{modal:!0,position:"center",draggable:!1,resizable:!1,fitToWindow:!0,horizontalPadding:20,verticalPadding:20},_create:function(){$.ui.dialog.prototype._create.apply(this);var resizeHandler=$.proxy(this._resize,this),closeHandler=$.proxy(this.close,this);this.element.bind("popupopen",function(){$(window).bind("resize",resizeHandler),$(".ui-widget-overlay").click(closeHandler)}),this.element.unbind("popupclose",function(){$(window).unbind("resize",resizeHandler),$("ui-widget-overlay").unbind("click",closeHandler)});var that=this;this.element.bind("popupresize",function(){that.uiDialog.width()<that.options.minWidth&&that.uiDialog.width(that.options.minWidth),that.element.width()!=that.uiDialog.width()&&that.element.width(that.uiDialog.width())})},close:function(){$.ui.dialog.prototype.close.apply(this)},_init:function(){$.ui.dialog.prototype._init.apply(this),this.element.parent().addClass("tau-dialog-container"),this._resize()},destroy:function(){$.ui.dialog.prototype.destroy.apply(this)},open:function(){$.ui.dialog.prototype.open.apply(this,arguments),this._resize()},_setOption:function(key,value){$.ui.dialog.prototype._setOption.apply(this,arguments)},_resize:function(){if(this.options.fitToWindow){var windowWidth=$(window).width(),width=Math.max(this.options.minWidth,windowWidth-2*this.options.horizontalPadding);this.uiDialog.width(width),this.element.width(width);var windowHeight=$(window).height(),height=Math.max(this.options.minHeight,windowHeight-2*this.options.verticalPadding);this.uiDialog.height(height),this.element.height(height-this.uiDialog.find(".ui-dialog-titlebar").outerHeight(!1))}this._setOption("position",this._getOffset()),this._trigger("resize")},_getOffset:function(){var body=$("body"),width=body.width(),height=body.height(),left=(width-this.element.width())/2,top=Math.max((height-this.element.height())/2,50);return{top:top,left:left}}})});
define('tp/codemirror/mode/diff/diff',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("diff",function(){return{token:function(stream){var ch=stream.next();stream.skipToEnd();if(ch=="+")return"plus";if(ch=="-")return"minus";if(ch=="@")return"rangeinfo"}}}),CodeMirror.defineMIME("text/x-diff","diff")});
define('tp/codemirror/mode/clike/clike',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("clike",function(config,parserConfig){function tokenBase(stream,state){var ch=stream.next();if(hooks[ch]){var result=hooks[ch](stream,state);if(result!==!1)return result}if(ch=='"'||ch=="'")return state.tokenize=tokenString(ch),state.tokenize(stream,state);if(/[\[\]{}\(\),;\:\.]/.test(ch))return curPunc=ch,null;if(/\d/.test(ch))return stream.eatWhile(/[\w\.]/),"number";if(ch=="/"){if(stream.eat("*"))return state.tokenize=tokenComment,tokenComment(stream,state);if(stream.eat("/"))return stream.skipToEnd(),"comment"}if(isOperatorChar.test(ch))return stream.eatWhile(isOperatorChar),"operator";stream.eatWhile(/[\w\$_]/);var cur=stream.current();return keywords.propertyIsEnumerable(cur)?(blockKeywords.propertyIsEnumerable(cur)&&(curPunc="newstatement"),"keyword"):atoms.propertyIsEnumerable(cur)?"atom":"word"}function tokenString(quote){return function(stream,state){var escaped=!1,next,end=!1;while((next=stream.next())!=null){if(next==quote&&!escaped){end=!0;break}escaped=!escaped&&next=="\\"}if(end||!escaped&&!multiLineStrings)state.tokenize=tokenBase;return"string"}}function tokenComment(stream,state){var maybeEnd=!1,ch;while(ch=stream.next()){if(ch=="/"&&maybeEnd){state.tokenize=tokenBase;break}maybeEnd=ch=="*"}return"comment"}function Context(indented,column,type,align,prev){this.indented=indented,this.column=column,this.type=type,this.align=align,this.prev=prev}function pushContext(state,col,type){return state.context=new Context(state.indented,col,type,null,state.context)}function popContext(state){var t=state.context.type;if(t==")"||t=="]"||t=="}")state.indented=state.context.indented;return state.context=state.context.prev}var indentUnit=config.indentUnit,keywords=parserConfig.keywords||{},blockKeywords=parserConfig.blockKeywords||{},atoms=parserConfig.atoms||{},hooks=parserConfig.hooks||{},multiLineStrings=parserConfig.multiLineStrings,isOperatorChar=/[+\-*&%=<>!?|\/]/,curPunc;return{startState:function(basecolumn){return{tokenize:null,context:new Context((basecolumn||0)-indentUnit,0,"top",!1),indented:0,startOfLine:!0}},token:function(stream,state){var ctx=state.context;stream.sol()&&(ctx.align==null&&(ctx.align=!1),state.indented=stream.indentation(),state.startOfLine=!0);if(stream.eatSpace())return null;curPunc=null;var style=(state.tokenize||tokenBase)(stream,state);if(style=="comment"||style=="meta")return style;ctx.align==null&&(ctx.align=!0);if(curPunc!=";"&&curPunc!=":"||ctx.type!="statement")if(curPunc=="{")pushContext(state,stream.column(),"}");else if(curPunc=="[")pushContext(state,stream.column(),"]");else if(curPunc=="(")pushContext(state,stream.column(),")");else if(curPunc=="}"){while(ctx.type=="statement")ctx=popContext(state);ctx.type=="}"&&(ctx=popContext(state));while(ctx.type=="statement")ctx=popContext(state)}else curPunc==ctx.type?popContext(state):(ctx.type=="}"||ctx.type=="top"||ctx.type=="statement"&&curPunc=="newstatement")&&pushContext(state,stream.column(),"statement");else popContext(state);return state.startOfLine=!1,style},indent:function(state,textAfter){if(state.tokenize!=tokenBase&&state.tokenize!=null)return 0;var firstChar=textAfter&&textAfter.charAt(0),ctx=state.context,closing=firstChar==ctx.type;return ctx.type=="statement"?ctx.indented+(firstChar=="{"?0:indentUnit):ctx.align?ctx.column+(closing?0:1):ctx.indented+(closing?0:indentUnit)},electricChars:"{}"}}),function(){function words(str){var obj={},words=str.split(" ");for(var i=0;i<words.length;++i)obj[words[i]]=!0;return obj}function cppHook(stream,state){return state.startOfLine?(stream.skipToEnd(),"meta"):!1}function tokenAtString(stream,state){var next;while((next=stream.next())!=null)if(next=='"'&&!stream.eat('"')){state.tokenize=null;break}return"string"}var cKeywords="auto if break int case long char register continue return default short do sizeof double static else struct entry switch extern typedef float union for unsigned goto while enum void const signed volatile";CodeMirror.defineMIME("text/x-csrc",{name:"clike",keywords:words(cKeywords),blockKeywords:words("case do else for if switch while struct"),atoms:words("null"),hooks:{"#":cppHook}}),CodeMirror.defineMIME("text/x-c++src",{name:"clike",keywords:words(cKeywords+" asm dynamic_cast namespace reinterpret_cast try bool explicit new "+"static_cast typeid catch operator template typename class friend private "+"this using const_cast inline public throw virtual delete mutable protected "+"wchar_t"),blockKeywords:words("catch class do else finally for if struct switch try while"),atoms:words("true false null"),hooks:{"#":cppHook}}),CodeMirror.defineMIME("text/x-java",{name:"clike",keywords:words("abstract assert boolean break byte case catch char class const continue default do double else enum extends final finally float for goto if implements import instanceof int interface long native new package private protected public return short static strictfp super switch synchronized this throw throws transient try void volatile while"),blockKeywords:words("catch class do else finally for if switch try while"),atoms:words("true false null"),hooks:{"@":function(stream,state){return stream.eatWhile(/[\w\$_]/),"meta"}}}),CodeMirror.defineMIME("text/x-csharp",{name:"clike",keywords:words("abstract as base bool break byte case catch char checked class const continue decimal default delegate do double else enum event explicit extern finally fixed float for foreach goto if implicit in int interface internal is lock long namespace new object operator out override params private protected public readonly ref return sbyte sealed short sizeof stackalloc static string struct switch this throw try typeof uint ulong unchecked unsafe ushort using virtual void volatile while add alias ascending descending dynamic from get global group into join let orderby partial remove select set value var yield"),blockKeywords:words("catch class do else finally for foreach if struct switch try while"),atoms:words("true false null"),hooks:{"@":function(stream,state){return stream.eat('"')?(state.tokenize=tokenAtString,tokenAtString(stream,state)):(stream.eatWhile(/[\w\$_]/),"meta")}}}),CodeMirror.defineMIME("text/x-groovy",{name:"clike",keywords:words("abstract as assert boolean break byte case catch char class const continue def default do double else enum extends final finally float for goto if implements import in instanceof int interface long native new package property private protected public return short static strictfp super switch synchronized this throw throws transient try void volatile while"),atoms:words("true false null"),hooks:{"@":function(stream,state){return stream.eatWhile(/[\w\$_]/),"meta"}}})}()});
define('tp/codemirror/mode/css/css',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("css",function(config){function ret(style,tp){return type=tp,style}function tokenBase(stream,state){var ch=stream.next();if(ch=="@")return stream.eatWhile(/[\w\\\-]/),ret("meta",stream.current());if(ch=="/"&&stream.eat("*"))return state.tokenize=tokenCComment,tokenCComment(stream,state);if(ch=="<"&&stream.eat("!"))return state.tokenize=tokenSGMLComment,tokenSGMLComment(stream,state);if(ch!="=")return ch!="~"&&ch!="|"||!stream.eat("=")?ch=='"'||ch=="'"?(state.tokenize=tokenString(ch),state.tokenize(stream,state)):ch=="#"?(stream.eatWhile(/[\w\\\-]/),ret("atom","hash")):ch=="!"?(stream.match(/^\s*\w*/),ret("keyword","important")):/\d/.test(ch)?(stream.eatWhile(/[\w.%]/),ret("number","unit")):/[,.+>*\/]/.test(ch)?ret(null,"select-op"):/[;{}:\[\]]/.test(ch)?ret(null,ch):(stream.eatWhile(/[\w\\\-]/),ret("variable","variable")):ret(null,"compare");ret(null,"compare")}function tokenCComment(stream,state){var maybeEnd=!1,ch;while((ch=stream.next())!=null){if(maybeEnd&&ch=="/"){state.tokenize=tokenBase;break}maybeEnd=ch=="*"}return ret("comment","comment")}function tokenSGMLComment(stream,state){var dashes=0,ch;while((ch=stream.next())!=null){if(dashes>=2&&ch==">"){state.tokenize=tokenBase;break}dashes=ch=="-"?dashes+1:0}return ret("comment","comment")}function tokenString(quote){return function(stream,state){var escaped=!1,ch;while((ch=stream.next())!=null){if(ch==quote&&!escaped)break;escaped=!escaped&&ch=="\\"}return escaped||(state.tokenize=tokenBase),ret("string","string")}}var indentUnit=config.indentUnit,type;return{startState:function(base){return{tokenize:tokenBase,baseIndent:base||0,stack:[]}},token:function(stream,state){if(stream.eatSpace())return null;var style=state.tokenize(stream,state),context=state.stack[state.stack.length-1];if(type=="hash"&&context=="rule")style="atom";else if(style=="variable")if(context=="rule")style="number";else if(!context||context=="@media{")style="tag";return context=="rule"&&/^[\{\};]$/.test(type)&&state.stack.pop(),type=="{"?context=="@media"?state.stack[state.stack.length-1]="@media{":state.stack.push("{"):type=="}"?state.stack.pop():type=="@media"?state.stack.push("@media"):context=="{"&&type!="comment"&&state.stack.push("rule"),style},indent:function(state,textAfter){var n=state.stack.length;return/^\}/.test(textAfter)&&(n-=state.stack[state.stack.length-1]=="rule"?2:1),state.baseIndent+n*indentUnit},electricChars:"}"}}),CodeMirror.defineMIME("text/css","css")});
define('tp/codemirror/mode/htmlmixed/htmlmixed',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("htmlmixed",function(config,parserConfig){function html(stream,state){var style=htmlMode.token(stream,state.htmlState);return style=="tag"&&stream.current()==">"&&state.htmlState.context&&(/^script$/i.test(state.htmlState.context.tagName)?(state.token=javascript,state.localState=jsMode.startState(htmlMode.indent(state.htmlState,"")),state.mode="javascript"):/^style$/i.test(state.htmlState.context.tagName)&&(state.token=css,state.localState=cssMode.startState(htmlMode.indent(state.htmlState,"")),state.mode="css")),style}function maybeBackup(stream,pat,style){var cur=stream.current(),close=cur.search(pat);return close>-1&&stream.backUp(cur.length-close),style}function javascript(stream,state){return stream.match(/^<\/\s*script\s*>/i,!1)?(state.token=html,state.curState=null,state.mode="html",html(stream,state)):maybeBackup(stream,/<\/\s*script\s*>/,jsMode.token(stream,state.localState))}function css(stream,state){return stream.match(/^<\/\s*style\s*>/i,!1)?(state.token=html,state.localState=null,state.mode="html",html(stream,state)):maybeBackup(stream,/<\/\s*style\s*>/,cssMode.token(stream,state.localState))}var htmlMode=CodeMirror.getMode(config,{name:"xml",htmlMode:!0}),jsMode=CodeMirror.getMode(config,"javascript"),cssMode=CodeMirror.getMode(config,"css");return{startState:function(){var state=htmlMode.startState();return{token:html,localState:null,mode:"html",htmlState:state}},copyState:function(state){if(state.localState)var local=CodeMirror.copyState(state.token==css?cssMode:jsMode,state.localState);return{token:state.token,localState:local,mode:state.mode,htmlState:CodeMirror.copyState(htmlMode,state.htmlState)}},token:function(stream,state){return state.token(stream,state)},indent:function(state,textAfter){return state.token==html||/^\s*<\//.test(textAfter)?htmlMode.indent(state.htmlState,textAfter):state.token==javascript?jsMode.indent(state.localState,textAfter):cssMode.indent(state.localState,textAfter)},compareStates:function(a,b){return htmlMode.compareStates(a.htmlState,b.htmlState)},electricChars:"/{}:"}}),CodeMirror.defineMIME("text/html","htmlmixed")});
define('tp/codemirror/mode/javascript/javascript',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("javascript",function(config,parserConfig){function chain(stream,state,f){return state.tokenize=f,f(stream,state)}function nextUntilUnescaped(stream,end){var escaped=!1,next;while((next=stream.next())!=null){if(next==end&&!escaped)return!1;escaped=!escaped&&next=="\\"}return escaped}function ret(tp,style,cont){return type=tp,content=cont,style}function jsTokenBase(stream,state){var ch=stream.next();if(ch=='"'||ch=="'")return chain(stream,state,jsTokenString(ch));if(/[\[\]{}\(\),;\:\.]/.test(ch))return ret(ch);if(ch=="0"&&stream.eat(/x/i))return stream.eatWhile(/[\da-f]/i),ret("number","number");if(/\d/.test(ch))return stream.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),ret("number","number");if(ch=="/")return stream.eat("*")?chain(stream,state,jsTokenComment):stream.eat("/")?(stream.skipToEnd(),ret("comment","comment")):state.reAllowed?(nextUntilUnescaped(stream,"/"),stream.eatWhile(/[gimy]/),ret("regexp","string")):(stream.eatWhile(isOperatorChar),ret("operator",null,stream.current()));if(ch=="#")return stream.skipToEnd(),ret("error","error");if(isOperatorChar.test(ch))return stream.eatWhile(isOperatorChar),ret("operator",null,stream.current());stream.eatWhile(/[\w\$_]/);var word=stream.current(),known=keywords.propertyIsEnumerable(word)&&keywords[word];return known?ret(known.type,known.style,word):ret("variable","variable",word)}function jsTokenString(quote){return function(stream,state){return nextUntilUnescaped(stream,quote)||(state.tokenize=jsTokenBase),ret("string","string")}}function jsTokenComment(stream,state){var maybeEnd=!1,ch;while(ch=stream.next()){if(ch=="/"&&maybeEnd){state.tokenize=jsTokenBase;break}maybeEnd=ch=="*"}return ret("comment","comment")}function JSLexical(indented,column,type,align,prev,info){this.indented=indented,this.column=column,this.type=type,this.prev=prev,this.info=info,align!=null&&(this.align=align)}function inScope(state,varname){for(var v=state.localVars;v;v=v.next)if(v.name==varname)return!0}function parseJS(state,style,type,content,stream){var cc=state.cc;cx.state=state,cx.stream=stream,cx.marked=null,cx.cc=cc,state.lexical.hasOwnProperty("align")||(state.lexical.align=!0);for(;;){var combinator=cc.length?cc.pop():jsonMode?expression:statement;if(combinator(type,content)){while(cc.length&&cc[cc.length-1].lex)cc.pop()();return cx.marked?cx.marked:type=="variable"&&inScope(state,content)?"variable-2":style}}}function pass(){for(var i=arguments.length-1;i>=0;i--)cx.cc.push(arguments[i])}function cont(){return pass.apply(null,arguments),!0}function register(varname){var state=cx.state;if(state.context){cx.marked="def";for(var v=state.localVars;v;v=v.next)if(v.name==varname)return;state.localVars={name:varname,next:state.localVars}}}function pushcontext(){cx.state.context||(cx.state.localVars=defaultVars),cx.state.context={prev:cx.state.context,vars:cx.state.localVars}}function popcontext(){cx.state.localVars=cx.state.context.vars,cx.state.context=cx.state.context.prev}function pushlex(type,info){var result=function(){var state=cx.state;state.lexical=new JSLexical(state.indented,cx.stream.column(),type,null,state.lexical,info)};return result.lex=!0,result}function poplex(){var state=cx.state;state.lexical.prev&&(state.lexical.type==")"&&(state.indented=state.lexical.indented),state.lexical=state.lexical.prev)}function expect(wanted){return function(type){return type==wanted?cont():wanted==";"?pass():cont(arguments.callee)}}function statement(type){return type=="var"?cont(pushlex("vardef"),vardef1,expect(";"),poplex):type=="keyword a"?cont(pushlex("form"),expression,statement,poplex):type=="keyword b"?cont(pushlex("form"),statement,poplex):type=="{"?cont(pushlex("}"),block,poplex):type==";"?cont():type=="function"?cont(functiondef):type=="for"?cont(pushlex("form"),expect("("),pushlex(")"),forspec1,expect(")"),poplex,statement,poplex):type=="variable"?cont(pushlex("stat"),maybelabel):type=="switch"?cont(pushlex("form"),expression,pushlex("}","switch"),expect("{"),block,poplex,poplex):type=="case"?cont(expression,expect(":")):type=="default"?cont(expect(":")):type=="catch"?cont(pushlex("form"),pushcontext,expect("("),funarg,expect(")"),statement,poplex,popcontext):pass(pushlex("stat"),expression,expect(";"),poplex)}function expression(type){return atomicTypes.hasOwnProperty(type)?cont(maybeoperator):type=="function"?cont(functiondef):type=="keyword c"?cont(maybeexpression):type=="("?cont(pushlex(")"),expression,expect(")"),poplex,maybeoperator):type=="operator"?cont(expression):type=="["?cont(pushlex("]"),commasep(expression,"]"),poplex,maybeoperator):type=="{"?cont(pushlex("}"),commasep(objprop,"}"),poplex,maybeoperator):cont()}function maybeexpression(type){return type.match(/[;\}\)\],]/)?pass():pass(expression)}function maybeoperator(type,value){if(type=="operator"&&/\+\+|--/.test(value))return cont(maybeoperator);if(type=="operator")return cont(expression);if(type==";")return;if(type=="(")return cont(pushlex(")"),commasep(expression,")"),poplex,maybeoperator);if(type==".")return cont(property,maybeoperator);if(type=="[")return cont(pushlex("]"),expression,expect("]"),poplex,maybeoperator)}function maybelabel(type){return type==":"?cont(poplex,statement):pass(maybeoperator,expect(";"),poplex)}function property(type){if(type=="variable")return cx.marked="property",cont()}function objprop(type){type=="variable"&&(cx.marked="property");if(atomicTypes.hasOwnProperty(type))return cont(expect(":"),expression)}function commasep(what,end){function proceed(type){return type==","?cont(what,proceed):type==end?cont():cont(expect(end))}return function(type){return type==end?cont():pass(what,proceed)}}function block(type){return type=="}"?cont():pass(statement,block)}function vardef1(type,value){return type=="variable"?(register(value),cont(vardef2)):cont()}function vardef2(type,value){if(value=="=")return cont(expression,vardef2);if(type==",")return cont(vardef1)}function forspec1(type){return type=="var"?cont(vardef1,forspec2):type==";"?pass(forspec2):type=="variable"?cont(formaybein):pass(forspec2)}function formaybein(type,value){return value=="in"?cont(expression):cont(maybeoperator,forspec2)}function forspec2(type,value){return type==";"?cont(forspec3):value=="in"?cont(expression):cont(expression,expect(";"),forspec3)}function forspec3(type){type!=")"&&cont(expression)}function functiondef(type,value){if(type=="variable")return register(value),cont(functiondef);if(type=="(")return cont(pushlex(")"),pushcontext,commasep(funarg,")"),poplex,statement,popcontext)}function funarg(type,value){if(type=="variable")return register(value),cont()}var indentUnit=config.indentUnit,jsonMode=parserConfig.json,keywords=function(){function kw(type){return{type:type,style:"keyword"}}var A=kw("keyword a"),B=kw("keyword b"),C=kw("keyword c"),operator=kw("operator"),atom={type:"atom",style:"atom"};return{"if":A,"while":A,"with":A,"else":B,"do":B,"try":B,"finally":B,"return":C,"break":C,"continue":C,"new":C,"delete":C,"throw":C,"var":kw("var"),"const":kw("var"),let:kw("var"),"function":kw("function"),"catch":kw("catch"),"for":kw("for"),"switch":kw("switch"),"case":kw("case"),"default":kw("default"),"in":operator,"typeof":operator,"instanceof":operator,"true":atom,"false":atom,"null":atom,"undefined":atom,NaN:atom,Infinity:atom}}(),isOperatorChar=/[+\-*&%=<>!?|]/,type,content,atomicTypes={atom:!0,number:!0,variable:!0,string:!0,regexp:!0},cx={state:null,column:null,marked:null,cc:null},defaultVars={name:"this",next:{name:"arguments"}};return poplex.lex=!0,{startState:function(basecolumn){return{tokenize:jsTokenBase,reAllowed:!0,cc:[],lexical:new JSLexical((basecolumn||0)-indentUnit,0,"block",!1),localVars:null,context:null,indented:0}},token:function(stream,state){stream.sol()&&(state.lexical.hasOwnProperty("align")||(state.lexical.align=!1),state.indented=stream.indentation());if(stream.eatSpace())return null;var style=state.tokenize(stream,state);return type=="comment"?style:(state.reAllowed=type=="operator"||type=="keyword c"||type.match(/^[\[{}\(,;:]$/),parseJS(state,style,type,content,stream))},indent:function(state,textAfter){if(state.tokenize!=jsTokenBase)return 0;var firstChar=textAfter&&textAfter.charAt(0),lexical=state.lexical,type=lexical.type,closing=firstChar==type;return type=="vardef"?lexical.indented+4:type=="form"&&firstChar=="{"?lexical.indented:type=="stat"||type=="form"?lexical.indented+indentUnit:lexical.info=="switch"&&!closing?lexical.indented+(/^(?:case|default)\b/.test(textAfter)?indentUnit:2*indentUnit):lexical.align?lexical.column+(closing?0:1):lexical.indented+(closing?0:indentUnit)},electricChars:":{}"}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0})});
define('tp/codemirror/mode/perl/perl',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("perl",function(config,parserConfig){function tokenChain(stream,state,chain,style,tail){return state.chain=null,state.style=null,state.tail=null,state.tokenize=function(stream,state){var e=!1,c,i=0;while(c=stream.next()){if(c===chain[i]&&!e)return chain[++i]!==undefined?(state.chain=chain[i],state.style=style,state.tail=tail):tail&&stream.eatWhile(tail),state.tokenize=tokenPerl,style;e=!e&&c=="\\"}return style},state.tokenize(stream,state)}function tokenSOMETHING(stream,state,string){return state.tokenize=function(stream,state){return stream.string==string&&(state.tokenize=tokenPerl),stream.skipToEnd(),"string"},state.tokenize(stream,state)}function tokenPerl(stream,state){if(stream.eatSpace())return null;if(state.chain)return tokenChain(stream,state,state.chain,state.style,state.tail);if(stream.match(/^\-?[\d\.]/,!1)&&stream.match(/^(\-?(\d*\.\d+(e[+-]?\d+)?|\d+\.\d*)|0x[\da-fA-F]+|0b[01]+|\d+(e[+-]?\d+)?)/))return"number";if(stream.match(/^<<(?=\w)/))return stream.eatWhile(/\w/),tokenSOMETHING(stream,state,stream.current().substr(2));if(stream.sol()&&stream.match(/^\=item(?!\w)/))return tokenSOMETHING(stream,state,"=cut");var ch=stream.next();if(ch=='"'||ch=="'"){if(stream.prefix(3)=="<<"+ch){var p=stream.pos;stream.eatWhile(/\w/);var n=stream.current().substr(1);if(n&&stream.eat(ch))return tokenSOMETHING(stream,state,n);stream.pos=p}return tokenChain(stream,state,[ch],"string")}if(ch=="q"){var c=stream.look(-2);if(!c||!/\w/.test(c)){c=stream.look(0);if(c=="x"){c=stream.look(1);if(c=="(")return stream.eatSuffix(2),tokenChain(stream,state,[")"],RXstyle,RXmodifiers);if(c=="[")return stream.eatSuffix(2),tokenChain(stream,state,["]"],RXstyle,RXmodifiers);if(c=="{")return stream.eatSuffix(2),tokenChain(stream,state,["}"],RXstyle,RXmodifiers);if(c=="<")return stream.eatSuffix(2),tokenChain(stream,state,[">"],RXstyle,RXmodifiers);if(/[\^'"!~\/]/.test(c))return stream.eatSuffix(1),tokenChain(stream,state,[stream.eat(c)],RXstyle,RXmodifiers)}else if(c=="q"){c=stream.look(1);if(c=="(")return stream.eatSuffix(2),tokenChain(stream,state,[")"],"string");if(c=="[")return stream.eatSuffix(2),tokenChain(stream,state,["]"],"string");if(c=="{")return stream.eatSuffix(2),tokenChain(stream,state,["}"],"string");if(c=="<")return stream.eatSuffix(2),tokenChain(stream,state,[">"],"string");if(/[\^'"!~\/]/.test(c))return stream.eatSuffix(1),tokenChain(stream,state,[stream.eat(c)],"string")}else if(c=="w"){c=stream.look(1);if(c=="(")return stream.eatSuffix(2),tokenChain(stream,state,[")"],"bracket");if(c=="[")return stream.eatSuffix(2),tokenChain(stream,state,["]"],"bracket");if(c=="{")return stream.eatSuffix(2),tokenChain(stream,state,["}"],"bracket");if(c=="<")return stream.eatSuffix(2),tokenChain(stream,state,[">"],"bracket");if(/[\^'"!~\/]/.test(c))return stream.eatSuffix(1),tokenChain(stream,state,[stream.eat(c)],"bracket")}else if(c=="r"){c=stream.look(1);if(c=="(")return stream.eatSuffix(2),tokenChain(stream,state,[")"],RXstyle,RXmodifiers);if(c=="[")return stream.eatSuffix(2),tokenChain(stream,state,["]"],RXstyle,RXmodifiers);if(c=="{")return stream.eatSuffix(2),tokenChain(stream,state,["}"],RXstyle,RXmodifiers);if(c=="<")return stream.eatSuffix(2),tokenChain(stream,state,[">"],RXstyle,RXmodifiers);if(/[\^'"!~\/]/.test(c))return stream.eatSuffix(1),tokenChain(stream,state,[stream.eat(c)],RXstyle,RXmodifiers)}else if(/[\^'"!~\/(\[{<]/.test(c)){if(c=="(")return stream.eatSuffix(1),tokenChain(stream,state,[")"],"string");if(c=="[")return stream.eatSuffix(1),tokenChain(stream,state,["]"],"string");if(c=="{")return stream.eatSuffix(1),tokenChain(stream,state,["}"],"string");if(c=="<")return stream.eatSuffix(1),tokenChain(stream,state,[">"],"string");if(/[\^'"!~\/]/.test(c))return tokenChain(stream,state,[stream.eat(c)],"string")}}}if(ch=="m"){var c=stream.look(-2);if(!c||!/\w/.test(c)){c=stream.eat(/[(\[{<\^'"!~\/]/);if(c){if(/[\^'"!~\/]/.test(c))return tokenChain(stream,state,[c],RXstyle,RXmodifiers);if(c=="(")return tokenChain(stream,state,[")"],RXstyle,RXmodifiers);if(c=="[")return tokenChain(stream,state,["]"],RXstyle,RXmodifiers);if(c=="{")return tokenChain(stream,state,["}"],RXstyle,RXmodifiers);if(c=="<")return tokenChain(stream,state,[">"],RXstyle,RXmodifiers)}}}if(ch=="s"){var c=/[\/>\]})\w]/.test(stream.look(-2));if(!c){c=stream.eat(/[(\[{<\^'"!~\/]/);if(c)return c=="["?tokenChain(stream,state,["]","]"],RXstyle,RXmodifiers):c=="{"?tokenChain(stream,state,["}","}"],RXstyle,RXmodifiers):c=="<"?tokenChain(stream,state,[">",">"],RXstyle,RXmodifiers):c=="("?tokenChain(stream,state,[")",")"],RXstyle,RXmodifiers):tokenChain(stream,state,[c,c],RXstyle,RXmodifiers)}}if(ch=="y"){var c=/[\/>\]})\w]/.test(stream.look(-2));if(!c){c=stream.eat(/[(\[{<\^'"!~\/]/);if(c)return c=="["?tokenChain(stream,state,["]","]"],RXstyle,RXmodifiers):c=="{"?tokenChain(stream,state,["}","}"],RXstyle,RXmodifiers):c=="<"?tokenChain(stream,state,[">",">"],RXstyle,RXmodifiers):c=="("?tokenChain(stream,state,[")",")"],RXstyle,RXmodifiers):tokenChain(stream,state,[c,c],RXstyle,RXmodifiers)}}if(ch=="t"){var c=/[\/>\]})\w]/.test(stream.look(-2));if(!c){c=stream.eat("r");if(c){c=stream.eat(/[(\[{<\^'"!~\/]/);if(c)return c=="["?tokenChain(stream,state,["]","]"],RXstyle,RXmodifiers):c=="{"?tokenChain(stream,state,["}","}"],RXstyle,RXmodifiers):c=="<"?tokenChain(stream,state,[">",">"],RXstyle,RXmodifiers):c=="("?tokenChain(stream,state,[")",")"],RXstyle,RXmodifiers):tokenChain(stream,state,[c,c],RXstyle,RXmodifiers)}}}if(ch=="`")return tokenChain(stream,state,[ch],"variable-2");if(ch=="/")return/~\s*$/.test(stream.prefix())?tokenChain(stream,state,[ch],RXstyle,RXmodifiers):"operator";if(ch=="$"){var p=stream.pos;if(stream.eatWhile(/\d/)||stream.eat("{")&&stream.eatWhile(/\d/)&&stream.eat("}"))return"variable-2";stream.pos=p}if(/[$@%]/.test(ch)){var p=stream.pos;if(stream.eat("^")&&stream.eat(/[A-Z]/)||!/[@$%&]/.test(stream.look(-2))&&stream.eat(/[=|\\\-#?@;:&`~\^!\[\]*'"$+.,\/<>()]/)){var c=stream.current();if(PERL[c])return"variable-2"}stream.pos=p}if(/[$@%&]/.test(ch))if(stream.eatWhile(/[\w$\[\]]/)||stream.eat("{")&&stream.eatWhile(/[\w$\[\]]/)&&stream.eat("}")){var c=stream.current();return PERL[c]?"variable-2":"variable"}if(ch=="#"&&stream.look(-2)!="$")return stream.skipToEnd(),"comment";if(/[:+\-\^*$&%@=<>!?|\/~\.]/.test(ch)){var p=stream.pos;stream.eatWhile(/[:+\-\^*$&%@=<>!?|\/~\.]/);if(PERL[stream.current()])return"operator";stream.pos=p}if(ch=="_"&&stream.pos==1){if(stream.suffix(6)=="_END__")return tokenChain(stream,state,["\0"],"comment");if(stream.suffix(7)=="_DATA__")return tokenChain(stream,state,["\0"],"variable-2");if(stream.suffix(7)=="_C__")return tokenChain(stream,state,["\0"],"string")}if(/\w/.test(ch)){var p=stream.pos;if(stream.look(-2)=="{"&&(stream.look(0)=="}"||stream.eatWhile(/\w/)&&stream.look(0)=="}"))return"string";stream.pos=p}if(/[A-Z]/.test(ch)){var l=stream.look(-2),p=stream.pos;stream.eatWhile(/[A-Z_]/);if(!/[\da-z]/.test(stream.look(0))){var c=PERL[stream.current()];return c?(c[1]&&(c=c[0]),l!=":"?c==1?"keyword":c==2?"def":c==3?"atom":c==4?"operator":c==5?"variable-2":"meta":"meta"):"meta"}stream.pos=p}if(/[a-zA-Z_]/.test(ch)){var l=stream.look(-2);stream.eatWhile(/\w/);var c=PERL[stream.current()];return c?(c[1]&&(c=c[0]),l!=":"?c==1?"keyword":c==2?"def":c==3?"atom":c==4?"operator":c==5?"variable-2":"meta":"meta"):"meta"}return null}var PERL={"->":4,"++":4,"--":4,"**":4,"=~":4,"!~":4,"*":4,"/":4,"%":4,x:4,"+":4,"-":4,".":4,"<<":4,">>":4,"<":4,">":4,"<=":4,">=":4,lt:4,gt:4,le:4,ge:4,"==":4,"!=":4,"<=>":4,eq:4,ne:4,cmp:4,"~~":4,"&":4,"|":4,"^":4,"&&":4,"||":4,"//":4,"..":4,"...":4,"?":4,":":4,"=":4,"+=":4,"-=":4,"*=":4,",":4,"=>":4,"::":4,not:4,and:4,or:4,xor:4,BEGIN:[5,1],END:[5,1],PRINT:[5,1],PRINTF:[5,1],GETC:[5,1],READ:[5,1],READLINE:[5,1],DESTROY:[5,1],TIE:[5,1],TIEHANDLE:[5,1],UNTIE:[5,1],STDIN:5,STDIN_TOP:5,STDOUT:5,STDOUT_TOP:5,STDERR:5,STDERR_TOP:5,$ARG:5,$_:5,"@ARG":5,"@_":5,$LIST_SEPARATOR:5,'$"':5,$PROCESS_ID:5,$PID:5,$$:5,$REAL_GROUP_ID:5,$GID:5,"$(":5,$EFFECTIVE_GROUP_ID:5,$EGID:5,"$)":5,$PROGRAM_NAME:5,$0:5,$SUBSCRIPT_SEPARATOR:5,$SUBSEP:5,"$;":5,$REAL_USER_ID:5,$UID:5,"$<":5,$EFFECTIVE_USER_ID:5,$EUID:5,"$>":5,$a:5,$b:5,$COMPILING:5,"$^C":5,$DEBUGGING:5,"$^D":5,"${^ENCODING}":5,$ENV:5,"%ENV":5,$SYSTEM_FD_MAX:5,"$^F":5,"@F":5,"${^GLOBAL_PHASE}":5,"$^H":5,"%^H":5,"@INC":5,"%INC":5,$INPLACE_EDIT:5,"$^I":5,"$^M":5,$OSNAME:5,"$^O":5,"${^OPEN}":5,$PERLDB:5,"$^P":5,$SIG:5,"%SIG":5,$BASETIME:5,"$^T":5,"${^TAINT}":5,"${^UNICODE}":5,"${^UTF8CACHE}":5,"${^UTF8LOCALE}":5,$PERL_VERSION:5,"$^V":5,"${^WIN32_SLOPPY_STAT}":5,$EXECUTABLE_NAME:5,"$^X":5,$1:5,$MATCH:5,"$&":5,"${^MATCH}":5,$PREMATCH:5,"$`":5,"${^PREMATCH}":5,$POSTMATCH:5,"$'":5,"${^POSTMATCH}":5,$LAST_PAREN_MATCH:5,"$+":5,$LAST_SUBMATCH_RESULT:5,"$^N":5,"@LAST_MATCH_END":5,"@+":5,"%LAST_PAREN_MATCH":5,"%+":5,"@LAST_MATCH_START":5,"@-":5,"%LAST_MATCH_START":5,"%-":5,$LAST_REGEXP_CODE_RESULT:5,"$^R":5,"${^RE_DEBUG_FLAGS}":5,"${^RE_TRIE_MAXBUF}":5,$ARGV:5,"@ARGV":5,ARGV:5,ARGVOUT:5,$OUTPUT_FIELD_SEPARATOR:5,$OFS:5,"$,":5,$INPUT_LINE_NUMBER:5,$NR:5,"$.":5,$INPUT_RECORD_SEPARATOR:5,$RS:5,"$/":5,$OUTPUT_RECORD_SEPARATOR:5,$ORS:5,"$\\":5,$OUTPUT_AUTOFLUSH:5,"$|":5,$ACCUMULATOR:5,"$^A":5,$FORMAT_FORMFEED:5,"$^L":5,$FORMAT_PAGE_NUMBER:5,"$%":5,$FORMAT_LINES_LEFT:5,"$-":5,$FORMAT_LINE_BREAK_CHARACTERS:5,"$:":5,$FORMAT_LINES_PER_PAGE:5,"$=":5,$FORMAT_TOP_NAME:5,"$^":5,$FORMAT_NAME:5,"$~":5,"${^CHILD_ERROR_NATIVE}":5,$EXTENDED_OS_ERROR:5,"$^E":5,$EXCEPTIONS_BEING_CAUGHT:5,"$^S":5,$WARNING:5,"$^W":5,"${^WARNING_BITS}":5,$OS_ERROR:5,$ERRNO:5,"$!":5,"%OS_ERROR":5,"%ERRNO":5,"%!":5,$CHILD_ERROR:5,"$?":5,$EVAL_ERROR:5,"$@":5,$OFMT:5,"$#":5,"$*":5,$ARRAY_BASE:5,"$[":5,$OLD_PERL_VERSION:5,"$]":5,"if":[1,1],elsif:[1,1],"else":[1,1],"while":[1,1],unless:[1,1],"for":[1,1],foreach:[1,1],abs:1,accept:1,alarm:1,atan2:1,bind:1,binmode:1,bless:1,bootstrap:1,"break":1,caller:1,chdir:1,chmod:1,chomp:1,chop:1,chown:1,chr:1,chroot:1,close:1,closedir:1,connect:1,"continue":[1,1],cos:1,crypt:1,dbmclose:1,dbmopen:1,"default":1,defined:1,"delete":1,die:1,"do":1,dump:1,each:1,endgrent:1,endhostent:1,endnetent:1,endprotoent:1,endpwent:1,endservent:1,eof:1,eval:1,exec:1,exists:1,exit:1,exp:1,fcntl:1,fileno:1,flock:1,fork:1,format:1,formline:1,getc:1,getgrent:1,getgrgid:1,getgrnam:1,gethostbyaddr:1,gethostbyname:1,gethostent:1,getlogin:1,getnetbyaddr:1,getnetbyname:1,getnetent:1,getpeername:1,getpgrp:1,getppid:1,getpriority:1,getprotobyname:1,getprotobynumber:1,getprotoent:1,getpwent:1,getpwnam:1,getpwuid:1,getservbyname:1,getservbyport:1,getservent:1,getsockname:1,getsockopt:1,given:1,glob:1,gmtime:1,"goto":1,grep:1,hex:1,"import":1,index:1,"int":1,ioctl:1,join:1,keys:1,kill:1,last:1,lc:1,lcfirst:1,length:1,link:1,listen:1,local:2,localtime:1,lock:1,log:1,lstat:1,m:null,map:1,mkdir:1,msgctl:1,msgget:1,msgrcv:1,msgsnd:1,my:2,"new":1,next:1,no:1,oct:1,open:1,opendir:1,ord:1,our:2,pack:1,"package":1,pipe:1,pop:1,pos:1,print:1,printf:1,prototype:1,push:1,q:null,qq:null,qr:null,quotemeta:null,qw:null,qx:null,rand:1,read:1,readdir:1,readline:1,readlink:1,readpipe:1,recv:1,redo:1,ref:1,rename:1,require:1,reset:1,"return":1,reverse:1,rewinddir:1,rindex:1,rmdir:1,s:null,say:1,scalar:1,seek:1,seekdir:1,select:1,semctl:1,semget:1,semop:1,send:1,setgrent:1,sethostent:1,setnetent:1,setpgrp:1,setpriority:1,setprotoent:1,setpwent:1,setservent:1,setsockopt:1,shift:1,shmctl:1,shmget:1,shmread:1,shmwrite:1,shutdown:1,sin:1,sleep:1,socket:1,socketpair:1,sort:1,splice:1,split:1,sprintf:1,sqrt:1,srand:1,stat:1,state:1,study:1,sub:1,substr:1,symlink:1,syscall:1,sysopen:1,sysread:1,sysseek:1,system:1,syswrite:1,tell:1,telldir:1,tie:1,tied:1,time:1,times:1,tr:null,truncate:1,uc:1,ucfirst:1,umask:1,undef:1,unlink:1,unpack:1,unshift:1,untie:1,use:1,utime:1,values:1,vec:1,wait:1,waitpid:1,wantarray:1,warn:1,when:1,write:1,y:null},RXstyle="string-2",RXmodifiers=/[goseximacplud]/;return{startState:function(){return{tokenize:tokenPerl,chain:null,style:null,tail:null}},token:function(stream,state){return(state.tokenize||tokenPerl)(stream,state)},electricChars:"{}"}}),CodeMirror.defineMIME("text/x-perl","perl"),CodeMirror.StringStream.prototype.look=function(c){return this.string.charAt(this.pos+(c||0))},CodeMirror.StringStream.prototype.prefix=function(c){if(c){var x=this.pos-c;return this.string.substr(x>=0?x:0,c)}return this.string.substr(0,this.pos-1)},CodeMirror.StringStream.prototype.suffix=function(c){var y=this.string.length,x=y-this.pos+1;return this.string.substr(this.pos,c&&c<y?c:x)},CodeMirror.StringStream.prototype.nsuffix=function(c){var p=this.pos,l=c||this.string.length-this.pos+1;return this.pos+=l,this.string.substr(p,l)},CodeMirror.StringStream.prototype.eatSuffix=function(c){var x=this.pos+c,y;x<=0?this.pos=0:x>=(y=this.string.length-1)?this.pos=y:this.pos=x}});
define('tp/codemirror/mode/php/php',["tp/codemirror/lib/codemirror"],function(CodeMirror){(function(){function keywords(str){var obj={},words=str.split(" ");for(var i=0;i<words.length;++i)obj[words[i]]=!0;return obj}function heredoc(delim){return function(stream,state){return stream.match(delim)?state.tokenize=null:stream.skipToEnd(),"string"}}var phpConfig={name:"clike",keywords:keywords("abstract and array as break case catch cfunction class clone const continue declare default do else elseif enddeclare endfor endforeach endif endswitch endwhile extends final for foreach function global goto if implements interface instanceof namespace new or private protected public static switch throw try use var while xor returndie echo empty exit eval include include_once isset list require require_once print unset"),blockKeywords:keywords("catch do else elseif for foreach if switch try while"),atoms:keywords("true false null TRUE FALSE NULL"),multiLineStrings:!0,hooks:{$:function(stream,state){return stream.eatWhile(/[\w\$_]/),"variable-2"},"<":function(stream,state){return stream.match(/<</)?(stream.eatWhile(/[\w\.]/),state.tokenize=heredoc(stream.current().slice(3)),state.tokenize(stream,state)):!1},"#":function(stream,state){return stream.skipToEnd(),"comment"}}};CodeMirror.defineMode("php",function(config,parserConfig){function dispatch(stream,state){if(state.curMode==htmlMode){var style=htmlMode.token(stream,state.curState);return style=="meta"&&/^<\?/.test(stream.current())?(state.curMode=phpMode,state.curState=state.php,state.curClose=/^\?>/,state.mode="php"):style=="tag"&&stream.current()==">"&&state.curState.context&&(/^script$/i.test(state.curState.context.tagName)?(state.curMode=jsMode,state.curState=jsMode.startState(htmlMode.indent(state.curState,"")),state.curClose=/^<\/\s*script\s*>/i,state.mode="javascript"):/^style$/i.test(state.curState.context.tagName)&&(state.curMode=cssMode,state.curState=cssMode.startState(htmlMode.indent(state.curState,"")),state.curClose=/^<\/\s*style\s*>/i,state.mode="css")),style}return stream.match(state.curClose,!1)?(state.curMode=htmlMode,state.curState=state.html,state.curClose=null,state.mode="html",dispatch(stream,state)):state.curMode.token(stream,state.curState)}var htmlMode=CodeMirror.getMode(config,"text/html"),jsMode=CodeMirror.getMode(config,"text/javascript"),cssMode=CodeMirror.getMode(config,"text/css"),phpMode=CodeMirror.getMode(config,phpConfig);return{startState:function(){var html=htmlMode.startState();return{html:html,php:phpMode.startState(),curMode:parserConfig.startOpen?phpMode:htmlMode,curState:parserConfig.startOpen?phpMode.startState():html,curClose:parserConfig.startOpen?/^\?>/:null,mode:parserConfig.startOpen?"php":"html"}},copyState:function(state){var html=state.html,htmlNew=CodeMirror.copyState(htmlMode,html),php=state.php,phpNew=CodeMirror.copyState(phpMode,php),cur;return state.curState==html?cur=htmlNew:state.curState==php?cur=phpNew:cur=CodeMirror.copyState(state.curMode,state.curState),{html:htmlNew,php:phpNew,curMode:state.curMode,curState:cur,curClose:state.curClose}},token:dispatch,indent:function(state,textAfter){return state.curMode!=phpMode&&/^\s*<\//.test(textAfter)||state.curMode==phpMode&&/^\?>/.test(textAfter)?htmlMode.indent(state.html,textAfter):state.curMode.indent(state.curState,textAfter)},electricChars:"/{}:"}}),CodeMirror.defineMIME("application/x-httpd-php","php"),CodeMirror.defineMIME("application/x-httpd-php-open",{name:"php",startOpen:!0}),CodeMirror.defineMIME("text/x-php",phpConfig)})()});
define('tp/codemirror/mode/ruby/ruby',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("ruby",function(config,parserConfig){function wordObj(words){var o={};for(var i=0,e=words.length;i<e;++i)o[words[i]]=!0;return o}function chain(newtok,stream,state){return state.tokenize.push(newtok),newtok(stream,state)}function tokenBase(stream,state){curPunc=null;if(stream.sol()&&stream.match("=begin")&&stream.eol())return state.tokenize.push(readBlockComment),"comment";if(stream.eatSpace())return null;var ch=stream.next();if(ch=="`"||ch=="'"||ch=='"'||ch=="/")return chain(readQuoted(ch,"string",ch=='"'),stream,state);if(ch=="%"){var style,embed=!1;stream.eat("s")?style="atom":stream.eat(/[WQ]/)?(style="string",embed=!0):stream.eat(/[wxqr]/)&&(style="string");var delim=stream.eat(/[^\w\s]/);return delim?(matching.propertyIsEnumerable(delim)&&(delim=matching[delim]),chain(readQuoted(delim,style,embed,!0),stream,state)):"operator"}if(ch=="#")return stream.skipToEnd(),"comment";if(ch=="<"&&stream.eat("<")){stream.eat("-"),stream.eat(/[\'\"\`]/);var match=stream.match(/^\w+/);return stream.eat(/[\'\"\`]/),match?chain(readHereDoc(match[0]),stream,state):null}if(ch=="0")return stream.eat("x")?stream.eatWhile(/[\da-fA-F]/):stream.eat("b")?stream.eatWhile(/[01]/):stream.eatWhile(/[0-7]/),"number";if(/\d/.test(ch))return stream.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if(ch=="?"){while(stream.match(/^\\[CM]-/));return stream.eat("\\")?stream.eatWhile(/\w/):stream.next(),"string"}return ch==":"?stream.eat("'")?chain(readQuoted("'","atom",!1),stream,state):stream.eat('"')?chain(readQuoted('"',"atom",!0),stream,state):(stream.eatWhile(/[\w\?]/),"atom"):ch=="@"?(stream.eat("@"),stream.eatWhile(/[\w\?]/),"variable-2"):ch=="$"?(stream.next(),stream.eatWhile(/[\w\?]/),"variable-3"):/\w/.test(ch)?(stream.eatWhile(/[\w\?]/),stream.eat(":")?"atom":"ident"):ch!="|"||!state.varList&&state.lastTok!="{"&&state.lastTok!="do"?/[\(\)\[\]{}\\;]/.test(ch)?(curPunc=ch,null):ch=="-"&&stream.eat(">")?"arrow":/[=+\-\/*:\.^%<>~|]/.test(ch)?(stream.eatWhile(/[=+\-\/*:\.^%<>~|]/),"operator"):null:(curPunc="|",null)}function tokenBaseUntilBrace(){var depth=1;return function(stream,state){if(stream.peek()=="}"){depth--;if(depth==0)return state.tokenize.pop(),state.tokenize[state.tokenize.length-1](stream,state)}else stream.peek()=="{"&&depth++;return tokenBase(stream,state)}}function readQuoted(quote,style,embed,unescaped){return function(stream,state){var escaped=!1,ch;while((ch=stream.next())!=null){if(ch==quote&&(unescaped||!escaped)){state.tokenize.pop();break}if(embed&&ch=="#"&&!escaped&&stream.eat("{")){state.tokenize.push(tokenBaseUntilBrace(arguments.callee));break}escaped=!escaped&&ch=="\\"}return style}}function readHereDoc(phrase){return function(stream,state){return stream.match(phrase)?state.tokenize.pop():stream.skipToEnd(),"string"}}function readBlockComment(stream,state){return stream.sol()&&stream.match("=end")&&stream.eol()&&state.tokenize.pop(),stream.skipToEnd(),"comment"}var keywords=wordObj(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload"]),indentWords=wordObj(["def","class","case","for","while","do","module","then","unless","catch","loop","proc"]),dedentWords=wordObj(["end","until"]),matching={"[":"]","{":"}","(":")"},curPunc;return{startState:function(){return{tokenize:[tokenBase],indented:0,context:{type:"top",indented:-config.indentUnit},continuedLine:!1,lastTok:null,varList:!1}},token:function(stream,state){stream.sol()&&(state.indented=stream.indentation());var style=state.tokenize[state.tokenize.length-1](stream,state),kwtype;if(style=="ident"){var word=stream.current();style=keywords.propertyIsEnumerable(stream.current())?"keyword":/^[A-Z]/.test(word)?"tag":state.lastTok=="def"||state.lastTok=="class"||state.varList?"def":"variable",indentWords.propertyIsEnumerable(word)?kwtype="indent":dedentWords.propertyIsEnumerable(word)?kwtype="dedent":word=="if"&&stream.column()==stream.indentation()&&(kwtype="indent")}if(curPunc||style&&style!="comment")state.lastTok=word||curPunc||style;return curPunc=="|"&&(state.varList=!state.varList),kwtype=="indent"||/[\(\[\{]/.test(curPunc)?state.context={prev:state.context,type:curPunc||style,indented:state.indented}:(kwtype=="dedent"||/[\)\]\}]/.test(curPunc))&&state.context.prev&&(state.context=state.context.prev),stream.eol()&&(state.continuedLine=curPunc=="\\"||style=="operator"),style},indent:function(state,textAfter){if(state.tokenize[state.tokenize.length-1]!=tokenBase)return 0;var firstChar=textAfter&&textAfter.charAt(0),ct=state.context,closing=ct.type==matching[firstChar]||ct.type=="keyword"&&/^(?:end|until|else|elsif|when)\b/.test(textAfter);return ct.indented+(closing?0:config.indentUnit)+(state.continuedLine?config.indentUnit:0)}}}),CodeMirror.defineMIME("text/x-ruby","ruby")});
define('tp/codemirror/mode/xml/xml',["tp/codemirror/lib/codemirror"],function(CodeMirror){CodeMirror.defineMode("xml",function(config,parserConfig){function inText(stream,state){function chain(parser){return state.tokenize=parser,parser(stream,state)}var ch=stream.next();if(ch=="<"){if(stream.eat("!"))return stream.eat("[")?stream.match("CDATA[")?chain(inBlock("atom","]]>")):null:stream.match("--")?chain(inBlock("comment","-->")):stream.match("DOCTYPE",!0,!0)?(stream.eatWhile(/[\w\._\-]/),chain(inBlock("meta",">"))):null;if(stream.eat("?"))return stream.eatWhile(/[\w\._\-]/),state.tokenize=inBlock("meta","?>"),"meta";type=stream.eat("/")?"closeTag":"openTag",stream.eatSpace(),tagName="";var c;while(c=stream.eat(/[^\s\u00a0=<>\"\'\/?]/))tagName+=c;return state.tokenize=inTag,"tag"}return ch=="&"?(stream.eatWhile(/[^;]/),stream.eat(";"),"atom"):(stream.eatWhile(/[^&<]/),null)}function inTag(stream,state){var ch=stream.next();return ch==">"||ch=="/"&&stream.eat(">")?(state.tokenize=inText,type=ch==">"?"endTag":"selfcloseTag","tag"):ch=="="?(type="equals",null):/[\'\"]/.test(ch)?(state.tokenize=inAttribute(ch),state.tokenize(stream,state)):(stream.eatWhile(/[^\s\u00a0=<>\"\'\/?]/),"word")}function inAttribute(quote){return function(stream,state){while(!stream.eol())if(stream.next()==quote){state.tokenize=inTag;break}return"string"}}function inBlock(style,terminator){return function(stream,state){while(!stream.eol()){if(stream.match(terminator)){state.tokenize=inText;break}stream.next()}return style}}function pass(){for(var i=arguments.length-1;i>=0;i--)curState.cc.push(arguments[i])}function cont(){return pass.apply(null,arguments),!0}function pushContext(tagName,startOfLine){var noIndent=Kludges.doNotIndent.hasOwnProperty(tagName)||curState.context&&curState.context.noIndent;curState.context={prev:curState.context,tagName:tagName,indent:curState.indented,startOfLine:startOfLine,noIndent:noIndent}}function popContext(){curState.context&&(curState.context=curState.context.prev)}function element(type){if(type=="openTag")return curState.tagName=tagName,cont(attributes,endtag(curState.startOfLine));if(type=="closeTag"){var err=!1;return curState.context?err=curState.context.tagName!=tagName:err=!0,err&&(setStyle="error"),cont(endclosetag(err))}return type=="string"?((!curState.context||curState.context.name!="!cdata")&&pushContext("!cdata"),curState.tokenize==inText&&popContext(),cont()):cont()}function endtag(startOfLine){return function(type){return type=="selfcloseTag"||type=="endTag"&&Kludges.autoSelfClosers.hasOwnProperty(curState.tagName.toLowerCase())?cont():type=="endTag"?(pushContext(curState.tagName,startOfLine),cont()):cont()}}function endclosetag(err){return function(type){return err&&(setStyle="error"),type=="endTag"?(popContext(),cont()):(setStyle="error",cont(arguments.callee))}}function attributes(type){return type=="word"?(setStyle="attribute",cont(attributes)):type=="equals"?cont(attvalue,attributes):type=="string"?(setStyle="error",cont(attributes)):pass()}function attvalue(type){return type=="word"&&Kludges.allowUnquoted?(setStyle="string",cont()):type=="string"?cont(attvaluemaybe):pass()}function attvaluemaybe(type){return type=="string"?cont(attvaluemaybe):pass()}var indentUnit=config.indentUnit,Kludges=parserConfig.htmlMode?{autoSelfClosers:{br:!0,img:!0,hr:!0,link:!0,input:!0,meta:!0,col:!0,frame:!0,base:!0,area:!0},doNotIndent:{pre:!0,"!cdata":!0},allowUnquoted:!0}:{autoSelfClosers:{},doNotIndent:{"!cdata":!0},allowUnquoted:!1},alignCDATA=parserConfig.alignCDATA,tagName,type,curState,setStyle;return{startState:function(){return{tokenize:inText,cc:[],indented:0,startOfLine:!0,tagName:null,context:null}},token:function(stream,state){stream.sol()&&(state.startOfLine=!0,state.indented=stream.indentation());if(stream.eatSpace())return null;setStyle=type=tagName=null;var style=state.tokenize(stream,state);state.type=type;if((style||type)&&style!="comment"){curState=state;for(;;){var comb=state.cc.pop()||element;if(comb(type||style))break}}return state.startOfLine=!1,setStyle||style},indent:function(state,textAfter){var context=state.context;if(context&&context.noIndent)return 0;if(alignCDATA&&/<!\[CDATA\[/.test(textAfter))return 0;context&&/^<\//.test(textAfter)&&(context=context.prev);while(context&&!context.startOfLine)context=context.prev;return context?context.indent+indentUnit:0},compareStates:function(a,b){if(a.indented!=b.indented||a.tokenize!=b.tokenize)return!1;for(var ca=a.context,cb=b.context;;ca=ca.prev,cb=cb.prev){if(!ca||!cb)return ca==cb;if(ca.tagName!=cb.tagName)return!1}},electricChars:"/"}}),CodeMirror.defineMIME("application/xml","xml"),CodeMirror.defineMIME("text/html",{name:"xml",htmlMode:!0})});
define('tp/plugins/vcs/viewDiff/sourcePopup',["tp/codemirror/lib/codemirror","jQuery","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tp/popup","tp/codemirror/mode/diff/diff","tp/codemirror/mode/clike/clike","tp/codemirror/mode/css/css","tp/codemirror/mode/htmlmixed/htmlmixed","tp/codemirror/mode/javascript/javascript","tp/codemirror/mode/perl/perl","tp/codemirror/mode/php/php","tp/codemirror/mode/python/python","tp/codemirror/mode/ruby/ruby","tp/codemirror/mode/xml/xml"],function(codeMirror,$,ProgressIndicator){function SourcePopup(){this._ctor()}return SourcePopup.prototype={_ctor:function(){this.placeholder=$('<div class="_viewSourcePopup viewSourcePopup" />'),this.emptyText="No data to display",this.codeViewer=codeMirror(this.placeholder[0],{readOnly:!0,lineNumbers:!0});var that=this;this.popup=this.placeholder.popup({zIndex:2e4,autoOpen:!1,minWidth:300,open:function(){that.resizeCodeViewer()},resize:function(){that.resizeCodeViewer()}}),this.placeholder.parent().addClass("vcsSource")},resizeCodeViewer:function(){var height=$("._viewSourcePopup").height(),width=$("._viewSourcePopup").width();$(".CodeMirror-scroll").css("height",height),$(".CodeMirror-scroll").css("width",width)},view:function(thirdPartyRevisionId,content,path){var text=content||this.emptyText,title="File: "+path+'<br /><span class="subTitle">Revision: '+thirdPartyRevisionId+"</span>";this.placeholder.removeClass("_refreshing"),ProgressIndicator.get(this.placeholder).hide(),this._setModeByFileExtension(path),this.codeViewer.setValue(text),this.popup.popup("option","title",title),this.popup.popup("open"),this.codeViewer.refresh()},loading:function(){var ph=this.placeholder;ph.addClass("_refreshing"),ProgressIndicator.get(ph).show(),this.popup.popup("option","title",""),this.popup.popup("open")},_getExtension:function(fileName){return fileName.substr(fileName.lastIndexOf(".")+1)},_setModeByFileExtension:function(path){var extension=this._getExtension(path),mode="clike";switch(extension){case"css":mode="text/css";break;case"cs":mode="text/x-csharp";break;case"c":case"h":mode="text/x-csrc";break;case"cpp":mode="text/x-c++src";break;case"html":case"htm":case"shtml":mode="text/html";break;case"js":mode="text/javascript";break;case"java":mode="text/x-java";break;case"perl":mode="text/x-perl";break;case"php":case"phtml":case"phl":mode="application/x-httpd-php";break;case"py":mode="text/x-python";break;case"rb":mode="text/x-ruby";break;case"xml":case"config":mode="application/xml";break;default:mode="null"}this.codeViewer.setOption("mode",mode)}},new SourcePopup});
define('tp/plugins/vcs/viewDiff/diffPopup',["jQuery","tau/ui/behaviour/common/ui.behaviour.progressIndicator","tp/popup"],function($,ProgressIndicator){function DiffPopup(){this._ctor()}return DiffPopup.prototype={placeholder:$(['<div class="_viewDiffPopup viewDiffPopup">','<div class="diffHeader">','<div class="_legend legend">','<span class="lineAdded">line added</span>&nbsp;&nbsp;','<span class="lineUpdated">line changed</span>&nbsp;&nbsp;','<span class="lineDeleted">line deleted</span>',"</div>",'<div class="revisionsContainer">','<div class="revisionContainer right">','<div class="_rightRevision revision"></div>',"</div>",'<div class="revisionContainer left">','<div class="_leftRevision revision"></div>',"</div>","</div>","</div>",'<div class="diffContainer _diffContainer">','<div class="_rightContainer sourceContainer right">',"<pre>",'<div class="_rightPan"></div>',"</pre>","</div>",'<div class="_leftContainer sourceContainer left">',"<pre>",'<div class="_leftPan"></div>',"</pre>","</div>",'<div style="clear:both;"></div>',"</div>",'<div class="scrollers">','<div class="_rightScroller rightScroller right">','<div class="_scrollerInternals scrollerInternals"></div>',"</div>",'<div class="_leftScroller leftScroller left">','<div class="_scrollerInternals scrollerInternals"></div>',"</div>","</div>","</div>"].join("")),lineTemplate:'<div {{if line.Action}}class="line${actions[line.Action]}"{{/if}}>${line.LineNumber}  ${line.Line}</div>',actions:{0:"None",10:"Added",20:"Updated",30:"Deleted"},_ctor:function(){this.emptyText="No data to display";var syncFromLeftToRight=$.proxy(this._getSyncFunction("left","right"),this),syncFromRightToLeft=$.proxy(this._getSyncFunction("right","left"),this),that=this,resizeScrollersHandler=$.proxy(function(){that._processScroller("right"),that._processScroller("left")},this);this.popup=this.placeholder.popup({autoOpen:!1,zIndex:2e4,minWidth:300,open:function(){that._processScroller("right").bind("scroll",syncFromRightToLeft),that._processScroller("left").bind("scroll",syncFromLeftToRight),$(window).bind("resize",resizeScrollersHandler)},close:function(){that.placeholder.find("._rightScroller").unbind("scroll",syncFromRightToLeft),that.placeholder.find("._leftScroller").unbind("scroll",syncFromLeftToRight),$(window).unbind("resize",resizeScrollersHandler)},resize:function(){resizeScrollersHandler()}}),this.placeholder.parent().addClass("vcsDiff")},_getSyncFunction:function(from,to){var that=this;return function(){var scroller=that.placeholder.find("._"+from+"Scroller");that.placeholder.find("._"+to+"Scroller").scrollLeft(scroller.scrollLeft()),that.placeholder.find("._"+to+"Container").scrollLeft(scroller.scrollLeft()),that.placeholder.find("._"+from+"Container").scrollLeft(scroller.scrollLeft())}},_processScroller:function(side){var panWidth=$("._"+side+"Pan").width(),container=this.placeholder.find("._"+side+"Container"),containerWidth=container.width(),scroller=this.placeholder.find("._"+side+"Scroller"),diffContainer=this.placeholder.find("._diffContainer");return container.height()<diffContainer.height()?(container.height(diffContainer.height()),scroller.css("right",0)):(container.css("height","auto"),scroller.css("right","17px")),scroller.find("._scrollerInternals").width(panWidth),scroller.width(containerWidth),containerWidth<panWidth?scroller.show():scroller.hide(),scroller},view:function(thirdPartyRevisionId,data,path){var title="Changed file: "+path,ph=this.placeholder;ph.removeClass("_refreshing"),ProgressIndicator.get(ph).hide(),ph.find("._leftRevision").text("Revision "+data.LeftPanRevisionId),ph.find("._rightRevision").text("Revision "+data.RightPanRevisionId),this._processPan(ph.find("._leftPan").html(""),data.LeftPan),this._processPan(ph.find("._rightPan").html(""),data.RightPan),this.popup.popup("option","title",title),this.popup.popup("open")},loading:function(){this.placeholder.addClass("_refreshing"),ProgressIndicator.get(this.placeholder).show(),this.popup.popup("option","title",""),this.popup.popup("open")},_processPan:function(container,lines){for(var i=0;i<lines.length;i++){var line=lines[i];line.LineNumber=this._normalizeLineNumber(line.LineNumber),line.Line=line.Line.replace(/\t/g,"&#9;")||"&nbsp;",container.append($.tmpl(this.lineTemplate,{line:line,actions:this.actions}))}},_normalizeLineNumber:function(lineNumber){var number=lineNumber;if(number<0)return"     ";var result=new String(number+1);while(result.length<5)result=" "+result;return result}},new DiffPopup});
define('tau/ui/extensions/revisionList/ui.extension.revisionList.showDiff',["Underscore","jQuery","tau/components/extensions/component.extension.base","tp/plugins/pluginsRepository","tp/plugins/commandGateway","tp/plugins/vcs/viewDiff/sourcePopup","tp/plugins/vcs/viewDiff/diffPopup"],function(_,$,ExtensionBase,pluginsRepository,CommandGateway,ViewSourcePopup,ViewDiffPopup){function loadCss(url){var link=document.createElement("link");link.type="text/css",link.rel="stylesheet",link.href=url,document.getElementsByTagName("head")[0].appendChild(link)}var supportedPlugins=["Subversion","Git","Mercurial","TFS"];return loadCss(require.toUrl("tp/codemirror/theme/default.css")),ExtensionBase.extend({plugins:[],"bus afterRender+dataBind":function(evt){var plugins=this.plugins,revisions=_.pluck(evt.dataBind.data.items,"id"),self=this;_.each(supportedPlugins,function(pluginName){var config={pluginName:pluginName},commandGateway=new CommandGateway(config),pluginConfig={extension:this,pluginName:pluginName,commandGateway:commandGateway,revisions:revisions,viewSourcePopup:ViewSourcePopup,viewDiffPopup:ViewDiffPopup,getImportedRevisions:function(revisions){this.commandGateway.execute("GetImportedRevisions",this.revisions,$.proxy(this.getImportedRevisionsSuccess,this))},getImportedRevisionsSuccess:function(importedRevisions){if(importedRevisions.length==0)return;var element=evt.afterRender.data.element,revisions={};for(var i=0;i<importedRevisions.length;i++)revisions[importedRevisions[i]]=!0;element.find(".ui-revisionList > tbody").each(function(scope){var $row=$(this),data=$row.tmplItem().data;revisions.hasOwnProperty(data.id)&&scope.attachViewDiffBehaviourForElement($row)},[this])},attachViewDiffBehaviourForElement:function(element){var data=element.tmplItem().data,$files=element.find(".files");$files.each(function(scope){var $file=$(this),fileData=$file.tmplItem().data,pathLink=$file.find(".vcsViewDisabled");fileData.fileAction!="Deleted"&&(pathLink.attr("href","#").removeAttr("disabled").addClass("vcsView"),pathLink.click(function(e){e.preventDefault(),scope.showView(data.id,data.sourceControlId,fileData.fileName)}),pathLink.removeClass("vcsViewDisabled"));if(fileData.fileAction==="Modified"){var $actions=$file.parent().find(".diff");$actions.append($('<a href="#" class="_diff button small">Diff</a>').click(function(e){e.preventDefault(),scope.showDiff(data.id,data.sourceControlId,fileData.fileName)}))}},[this])},showView:function(revisionId,thirdPartyRevisionId,path){var config=self.config;config.context.configurator.getKeyBoardManager().pushHandler({handleKeyDown:function(evt){evt.keyCode==27&&config.context.configurator.getKeyBoardManager().popHandler()}}),this.viewSourcePopup.loading();var that=this;this.commandGateway.execute("ViewSource",{TpRevisionId:revisionId,Path:path},function(data){var content=data.Content||"File is empty";that.viewSourcePopup.view(thirdPartyRevisionId,content,path)},null,this.showError)},showDiff:function(revisionId,thirdPartyRevisionId,path){var config=self.config;config.context.configurator.getKeyBoardManager().pushHandler({handleKeyDown:function(evt){evt.keyCode==27&&config.context.configurator.getKeyBoardManager().popHandler()}}),this.viewDiffPopup.loading();var that=this;this.commandGateway.execute("ViewDiff",{TpRevisionId:revisionId,Path:path},function(data){that.viewDiffPopup.view(thirdPartyRevisionId,data,path)},null,this.showError)},showError:function(responseText){$("<div />").html('<p class="p-15">'+responseText+"</p>").popup({title:"Error occured",fitToWindow:!1})}};plugins[pluginName]=pluginConfig,pluginsRepository.pluginStartedAndHasAtLeastOneProfile(pluginName,$.proxy(pluginConfig.getImportedRevisions,pluginConfig))},this)}})});
define('tau/components/component.revisionList',["tau/components/component.list.creator","tau/models//model.revisionList","tau/ui/extensions/testCaseList/ui.extension.testCaseList","tau/ui/templates/revisionList/ui.template.revisionList","tau/ui/extensions/revisionList/ui.extension.revisionList.showDiff","tau/ui/templates/common/ui.template.entityLink"],function(creator,ModelType,Expander,template,ShowDiffExtension){return{create:function(config){var creatorConfig={template:template,extensions:[ModelType,Expander,ShowDiffExtension],message:"No revisions found"};return creator.create(creatorConfig,config)}}});
define('tau/components/component.search.filter',["Underscore","jQuery","tau/components/component.creator","tau/components/extensions/error/extension.errorBar"],function(_,$,ComponentCreator,ErrorBar){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ErrorBar],template:{engine:"jqote2",name:"search-filter-template",markup:['<div class="tau-search-header">','<form action="">','<div class="tau-search-wrap">','<span class="tau-inline-group tau-search">','<input type="text" class="tau-in-text i-role-search-string" placeholder="Search" value="<%! this.params.searchString %>">','<button class="tau-btn tau-search i-role-search-trigger"></button>',"</span>","</div>",'<div class="search-settings">',"<span>Search in</span>",'<select class="tau-select i-role-entity-type-filter">','<option value=""<% if (!this.params.entityTypeId) { %> selected<% } %>>Any entities</option>',"<% for(var i = 0; i < this.entityTypes.length; i++) { %>","<% var et = this.entityTypes[i]; %>",'<option value="<%= et.id %>"<% if (et.id == this.params.entityTypeId) { %> selected<% } %>>',"<%= et.term %>","</option>","<% } %>","</select>",'<select class="tau-select i-role-entity-state-filter">','<option value=""<% if (!this.params.entityStateIds) { %> selected<% } %>>Any states</option>',"<% for(var i = 0; i < this.entityStates.length; i++) { %>","<% var es = this.entityStates[i]; %>",'<option value="<%= es.id %>"<% if (es.id == this.params.entityStateIds) { %> selected<% } %>>',"<%= es.name %>","</option>","<% } %>","</select>",'<label class="tau-checkbox">','<input<% if (this.params.isAllProjects) { %> checked<% } %> type="checkbox" class="i-role-all-projects-filter"><i></i><span>All projects &amp; teams</span>',"</label>","</div>","</form>","</div>"]}},component=ComponentCreator.create(creatorConfig,config),resolveSearchToken=function(searchToken,configurator){var $tokenResolver=$.Deferred();if(/^\d+$/.test(searchToken)){var store=configurator.getStore();store.get("general",{id:searchToken,fields:["id",{entityType:["id","name"]}]}).done({success:function(r){var d=r[0].data;"project"===d.entityType.name.toLowerCase()?store.get("project",{id:d.id,fields:["id","name"]}).done({success:function(r){$tokenResolver.resolve({id:d.id,entity:d.entityType.name})},failure:function(r){$tokenResolver.resolve({id:null,entity:"search"})}}):$tokenResolver.resolve({id:d.id,entity:d.entityType.name})},failure:function(){$tokenResolver.resolve({id:null,entity:"search"})}})}else searchToken.length>2?$tokenResolver.resolve({id:null,entity:"search"}):$tokenResolver.reject("Enter more than 2 chars");return $tokenResolver};return component.on("afterInit",function(e){var configurator=e.data.config.context.configurator,searchServiceInstance=configurator.service("search"),params=searchServiceInstance.params().get();searchServiceInstance.getSearchDomain(params).done(function(d){component.fire("dataBind",d)})}),component.on("afterRender",function(e){var $node=e.data.element,configurator=config.context.configurator,enableForm=function(enable){var selectors=[".i-role-search-string",".i-role-entity-type-filter",".i-role-entity-state-filter",".i-role-all-projects-filter"].join(",");enable===!1?$node.find(selectors).attr("disabled","disabled"):$node.find(selectors).removeAttr("disabled")},searchService=configurator.service("search"),disposable=searchService.onParamsChanged(function(delta){if(_(delta).has("entityTypeId")){var params=searchService.params();params.set("entityStateIds",null),searchService.getSearchDomain(params.get()).done(function(r){var $select=$node.find(".i-role-entity-state-filter"),ids=$select.val(),name=$select.find('option[value="'+ids+'"]').text();name=_.trim(name),$select.empty().append('<option value="">Any state</option>'),_(r.entityStates).each(function(s){var selectedAttr=s.name===name?" selected":"";$select.append('<option value="'+s.id+'"'+selectedAttr+">"+s.name+"</option>")})})}});this.on("destroy",disposable.dispose);var triggerSearch=function(){component.fire("clearError"),enableForm(!1);var searchString=_.trim($node.find(".i-role-search-string").val());resolveSearchToken(searchString,configurator).fail(function(message){enableForm(!0),component.fire("error",{message:message})}).done(function(d){if(d.entity!=="search")configurator.service("navigator").to(d.entity+"/"+d.id);else{var searchService=configurator.service("search");searchService.offSearch(enableForm),searchService.onSearch(enableForm),searchService.params().set("searchString",searchString).set("entityTypeId",$node.find(".i-role-entity-type-filter").val()||null).set("entityStateIds",$node.find(".i-role-entity-state-filter").val()).set("isAllProjects",$node.find(".i-role-all-projects-filter").prop("checked")).submit()}})};$node.find(".i-role-search-trigger").click(function(e){e.preventDefault(),triggerSearch()}),$node.on("change",".i-role-entity-type-filter,.i-role-entity-state-filter,.i-role-all-projects-filter",function(e){e.preventDefault(),triggerSearch()})}),component}}});
define('tau/services/service.search',["jQuery","Underscore","tau/core/termProcessor","tau/core/class","tau/utils/utils.date"],function($,_,TermProcessor,Class,dateUtils){var strategies={comment:function(item){item.entityType={name:"comment"};var tp=new TermProcessor;return item.general.entityType.term=tp.getTerms(item.general.entityType.name).name,item}},itemAdapter=function(item){var t=item.__type.toLowerCase(),preProcessing=strategies[t]||_.fixedPoint;item=preProcessing(item);var tp=new TermProcessor;return item.entityType.term=tp.getTerms(item.entityType.name).name,item.nameExt=item.nameExt||item.name,item.descExt=item.descExt||item.description||"",item.tags=item.tags?item.tags.split(", "):[],item.createDate=dateUtils.parse(item.createDate),item},Service=Class.extend({init:function(config){var x=this;x.defaultParams={searchString:"",entityTypeId:null,entityStateIds:null,pageSize:10,pageNo:0},x.storage=config.storage,x._params=config.storage,x.configurator=config.configurator,x.$paramsChangedCallbacks=$.Callbacks(),x.$dParamsChanged=$.Deferred(),x.$dParamsChanged.progress(x.$paramsChangedCallbacks.fire),x.$clearCallbacks=$.Callbacks(),x.$dClear=$.Deferred(),x.$dClear.progress(x.$clearCallbacks.fire),x.$submitCallbacks=$.Callbacks(),x.$dSubmit=$.Deferred(),x.$dSubmit.progress(x.$submitCallbacks.fire),x.$searchCallbacks=$.Callbacks(),x.$dSearch=$.Deferred(),x.$dSearch.progress(x.$searchCallbacks.fire)},asDisposable:function(callback,methodName){var o=this,r={};return r.dispose=_.bind(function(o,callback,methodName){o[methodName](callback)},r,o,callback,methodName),r},onParamsChanged:function(callback){var o=this;return o.$paramsChangedCallbacks.add(callback),o.asDisposable(callback,"offParamsChanged")},offParamsChanged:function(callback){this.$paramsChangedCallbacks.remove(callback)},onClear:function(callback){return this.$clearCallbacks.add(callback),this.asDisposable(callback,"offClear")},offClear:function(callback){this.$clearCallbacks.remove(callback)},onSubmit:function(callback){return this.$submitCallbacks.add(callback),this.asDisposable(callback,"offSubmit")},offSubmit:function(callback){this.$submitCallbacks.remove(callback)},onSearch:function(callback){return this.$searchCallbacks.add(callback),this.asDisposable(callback,"offSearch")},offSearch:function(callback){this.$searchCallbacks.remove(callback)},params:function(){var service=this;return{get:function(key){return arguments.length?service._params[key]:service._params},set:function(key,val){var keys=[],params={};if(_.isString(key))keys=[key],params[key]=val;else{if(!_.isObject(key))throw new Error("Unsupported argument [key]");keys=_.keys(key),params=key}var isPageNoParameter=keys.length===1&&keys[0]==="pageNo";isPageNoParameter||(params.pageNo=0);var k=_.keys(params),delta={};return _.each(k,function(key){params[key]!==service._params[key]&&(delta[key]=params[key])}),service._params=_.extend(service._params,params),service.$dParamsChanged.notify(delta),this},submit:function(){var params=service._params;service.$dSubmit.notify(params)},clear:function(){service._params=_.clone(service.defaultParams),service.$dClear.notify(service._params)}}},__adaptEntityTypes:function(items){var tp=new TermProcessor;return _(items).chain().filter(function(x){var n=x.name.toLowerCase();return n!=="solution"&&n!=="impediment"}).map(function(x){return x.term=tp.getTerms(x.name).name,x}).value()},__adaptEntityStates:function(items){return _(items).chain().reduce(function(memo,d){return memo[d.name]=memo[d.name]||[],memo[d.name].push(d.id),memo},{}).map(function(v,k){return{id:v.join(","),name:k}}).sortBy(function(o){return o.name}).value()},getSearchDomain:function(parameters){var x=this;parameters=parameters||x.params().get();var configurator=this.configurator,$resultDefer=$.Deferred(),store=configurator.getStore(),acidStore=configurator.getAppStateStore(),ctxService=configurator.getApplicationContextService();return acidStore.get({fields:["acid"],callback:function(r){ctxService.getApplicationContext({acid:r.acid},{success:function(r){var processIds=_.pluck(r.processes,"id"),$query={process:{id:{$in:processIds}}};store.find("entityType",{list:!0,fields:["id","name"],$query:{isSearchable:1}}).find("entityState",{list:!0,fields:["id","name",{entityType:["id","name"]}],$query:$query}).done(function(r){var entityTypes=x.__adaptEntityTypes(r[0].data),iterator=parameters.entityTypeId?function(d){return d.entityType.id==parameters.entityTypeId}:function(d){return!0},raw=_(r[1].data).filter(iterator),entityStates=x.__adaptEntityStates(raw);$resultDefer.resolve({entityTypes:entityTypes,entityStates:entityStates,params:parameters})})}})}}),$resultDefer},extractPluralIDs:function(str){var isIDs=!1,parts=str.split(",");if(parts.length>1){var IDs=[];isIDs=_(parts).every(function(p){var token=_.trim(p),isDigit=/^\d+$/.test(token);return isDigit&&IDs.push(parseInt(token)),isDigit})}return isIDs?IDs:null},search:function(params){var self=this,configurator=this.configurator;return _.defaults(params,self.defaultParams),{done:function(callback){var $defer;_.isFunction(callback)?($defer=$.Deferred(),$defer.always(callback)):$defer=callback,$defer.always(self.$dSearch.notify);var root=configurator.getApplicationPath(),store=configurator.getStore(),acidStore=configurator.getAppStateStore(),ctxService=configurator.getApplicationContextService(),searchIDs=function(ctx){var plgn="{AppPath}/api/v1/Plugins.asmx/Search/Profiles/Now%20running/Commands/Search".replace(/{AppPath}/g,root),post=JSON.stringify({Command:"Search",Plugin:"Search",TeamIds:_.without(ctx.selectedTeamIds,"null"),IncludeNoTeam:ctx.includeNoTeam,ProjectIds:_.without(ctx.selectedProjectIds,"null"),IncludeNoProject:ctx.includeNoProject,Query:params.searchString,EntityTypeId:params.entityTypeId,EntityStateIds:_.isArray(params.entityStateIds)?params.entityStateIds:_((params.entityStateIds||"").split(",")).chain().without("").map(function(n){return parseInt(n)}).value(),Page:{Number:params.pageNo,Size:params.pageSize}});return $.ajax({url:plgn,type:"POST",data:post,dataType:"json"})},fetchDetailsByIDs=function(r){var indexProgress=_.defaults(r.IndexProgressData||{},{CompleteInPercents:100}),rData={info:{pageNo:params.pageNo,pageSize:params.pageSize,total:r.Total,indexProgress:indexProgress.CompleteInPercents},items:[]},$r=$.Deferred();if(rData.info.total>0){var assignableIds=r.AssignableIds,testCaseIds=r.TestCaseIds,generalIds=r.GeneralIds,commentIds=r.CommentIds,configurator=self.configurator,storeChain=configurator.getStore();if(assignableIds.length){var $assignableQuery={fields:["id","name","description","tags","createDate",{entityType:["id","name"]},{entityState:["id","name","isFinal"]},{project:["id","name"]},{team:["id","name"]}],$query:{id:{$in:assignableIds}}};storeChain=storeChain.find("assignable",$assignableQuery)}if(testCaseIds.length){var $testCaseQuery={fields:["id","name","description","steps","success","tags","createDate",{entityType:["id","name"]},{project:["id","name"]}],$query:{id:{$in:testCaseIds}}};storeChain=storeChain.find("testcase",$testCaseQuery)}if(generalIds.length){var $generalQuery={fields:["id","name","description","tags","createDate",{entityType:["id","name"]},{project:["id","name"]}],$query:{id:{$in:generalIds}}};storeChain=storeChain.find("general",$generalQuery)}if(commentIds.length){var $commentQuery={fields:["id","description","createDate",{general:["id","name",{entityType:["id","name"]}]}],$query:{id:{$in:commentIds}}};storeChain=storeChain.find("comment",$commentQuery)}storeChain.done({success:function(r){var resultItems=[];_.each(r,function(x){resultItems=resultItems.concat(x.data)}),rData.items=_.sortBy(resultItems,function(e){return-1*e.id}),$r.resolve(rData)},failure:function(r){$r.reject(r)}})}else $r.resolve(rData);return $r},handleSearchResult=function(chained){chained.fail(function(r){$defer.reject({data:{error:!0,response:r}})}).done(function(r){var ss=_.trim(params.searchString),keywords=_.without(ss?ss.split(/\s|\?|\*|\+|-|:|'|"/g):[],"");$defer.resolve({data:{keywords:keywords,info:r.info,items:_.map(r.items,itemAdapter)}})})},pluralIds=self.extractPluralIDs(params.searchString);if(pluralIds)store.get("general",{fields:["id",{entityType:["name"]}],$query:{id:{$in:pluralIds}}}).done(function(r){var adapter=_(r[0].data).chain().filter(function(d){return _.contains(pluralIds,d.id)&&d.hasOwnProperty("entityType")}).reduce(function(memo,d){var typeName=d.entityType.name,memoKey=typeName+"Ids";if(!memo.hasOwnProperty(memoKey)){var ref=store.typeMetaInfo(typeName);memoKey=_.titleize(ref.parent)+"Ids"}return memo.hasOwnProperty(memoKey)&&(memo[memoKey].push(d.id),++memo.Total),memo},{AssignableIds:[],CommentIds:[],GeneralIds:[],TestCaseIds:[],Total:0}).value();handleSearchResult(fetchDetailsByIDs(adapter))});else if(params.isAllProjects){var user=configurator.getLoggedUser(),continuation=function(r){var ctx={includeNoProject:!0,selectedProjectIds:r.projIds,includeNoTeam:!0,selectedTeamIds:r.teamIds};handleSearchResult(searchIDs(ctx).pipe(fetchDetailsByIDs))};ctxService.getTeamsProjectsAvailable(user.id).pipe(function(r){return{teamIds:_(r.teams).pluck("id"),projIds:_(r.projects).pluck("id")}}).done(continuation)}else acidStore.get({fields:["acid"],callback:function(r){ctxService.getApplicationContext({acid:r.acid},{success:function(r){var ctx={includeNoProject:r.appContext.projectContext.no,selectedProjectIds:r.selectedProjectIdsAvailable,includeNoTeam:r.appContext.teamContext.no,selectedTeamIds:r.selectedTeamIdsAvailable};handleSearchResult(searchIDs(ctx).pipe(fetchDetailsByIDs))}})}})}}}});return Service});
define('tau/ui/extensions/search.input/ui.extension.search.input',["jQuery","tau/core/extension.base","tau/services/service.search"],function($,ExtensionBase,SearchServiceClass){return ExtensionBase.extend({loadSearchSettingsData:function(configurator){var x=this;return x.$d||(x.$d=$.Deferred(),configurator.getStore().get("entityType",{fields:["id","name"],list:!0}).done(function(r){var entityTypes=r[0].data;x.$d.resolve({entityTypes:entityTypes})})),x.$d},bindSearchSettingsTemplate:function(configurator,data){return configurator.getTemplateFactory().register({name:"search-input-settings",engine:"jqote2",markup:["<h3>Advanced search</h3>",'<div class="tau-line">','<select class="tau-select i-role-entity-types-filter">','<option value=""<% if (!this.params.entityTypeId) { %> selected<% } %>>Any entities</option>',"<% for(var i = 0; i < this.entityTypes.length; i++) { %>",'<option value="<%= this.entityTypes[i].id %>"<% if (this.entityTypes[i].id == this.params.entityTypeId) { %> selected<% } %>>',"<%= this.entityTypes[i].name %>","</option>","<% } %>","</select>","</div>",'<div class="tau-line">','<label class="tau-checkbox">','<input type="checkbox" class="i-role-all-projects-flag"<% if (this.params.isAllProjects) { %> checked="checked"<% } %>>',"<i></i><span>All projects</span>","</label>","</div>"]}).get().bind({},data)},setupSearchSettings:function($node,configurator){var self=this,searchServiceInstance=configurator.service("search"),onArrowPositionConfig=function(config){config.at="right bottom",config.my="center top",config.offset="-46 0"},onPositionConfig=function(config){config.at="right bottom",config.my="center top",config.offset="-100 5"},targetSelector=".tau-search:not(input,button)";$node.find(targetSelector).tauBubble({content:$("<span>Loading...</span>"),className:"tau-bubble-search",onArrowPositionConfig:onArrowPositionConfig,onPositionConfig:onPositionConfig,onShow:function(content){self.loadSearchSettingsData(configurator).done(function(d){d.params=searchServiceInstance.params().get();var $filters=self.bindSearchSettingsTemplate(configurator,d);content.find("[role=content]").html($filters)}),content.on("change",".i-role-entity-types-filter",function(e){var $target=$(e.target),v=$target.val();searchServiceInstance.params().set("entityTypeId",v?v:null)}),content.on("change",".i-role-entity-states-filter",function(e){var $target=$(e.target),v=$target.val();searchServiceInstance.params().set("entityStateIds",v?[v]:[])}),content.on("change",".i-role-all-projects-flag",function(e){var $target=$(e.target);searchServiceInstance.params().set("isAllProjects",$target.prop("checked"))})},onHide:function(content){content.off("change")}})},setupSearchTrigger:function($node,configurator){$node.find(".i-role-search-trigger").click(function(e){e.preventDefault(),configurator.service("search").params().set("searchString",$node.find(".i-role-search-string").val());var req=configurator.getRequireLoader();req(["all.components"],function(){req(["tau/components/component.application.generic","tau/components/extensions/comet/extension.comet.rest"],function(appComponent,CometExtension){var APP_ID="sp",external=configurator.getExternal(),d={};d[APP_ID]="search";var hashParams=external.hashParams(),newHashParams=_.extend(hashParams,d);external.applyHashObject(newHashParams,!0),configurator._id=_.uniqueId("search_results_viewer"),configurator.isBoardEdition=!0;var ROUTING_PATTERNS=[{pattern:/search/,adapter:function(){var ext=configurator.getExternal(),hashParams=ext.hashParams();this.resolve({id:null,entity:"search",searchArgs:hashParams})},type:"tau/components/component.page.search",host:"tau/components/component.master.empty"},{pattern:/(\w+)\/([0-9]+)($|\s|&)/,adapter:function(entityType,entityId,tail){this.resolve({id:parseInt(entityId),entity:entityType,action:"show"})},type:"tau/components/component.page.entity",host:"tau/components/component.master.empty"},{pattern:/(\w+)\/([0-9]+)\/(\w+)[&|]*.*/,adapter:function(entityType,entityId,action){this.resolve({id:parseInt(entityId),entity:entityType,action:action})},type:"tau/components/component.page.entity",host:"tau/components/component.master.empty"}],integration={showInPopup:!0,keepAlive:!1},appConfig={name:"application search",applicationId:APP_ID,pageType:"search",pageId:"",routes:ROUTING_PATTERNS,configurator:configurator,routing:{silent:!0},integration:integration,options:{integration:integration}},isCometFeatureEnabled=configurator.getFeaturesService().isEnabled("comet.notifications");isCometFeatureEnabled&&(appConfig.extensions=[CometExtension]);var appBus=appComponent.create(appConfig);appBus.on("beforeInit",function(e){var self=this,cfg=e.data.config;cfg.applicationId=APP_ID,cfg.routing={silent:!0};var configurator=cfg.context.configurator;self.fire("configurator.ready",configurator),self.fire("options.ready",cfg)}),appBus.on("contentRendered",function(e){var $el=e.data.element;setTimeout(function(){$el.parent(".ui-popup").addClass("tau-search-popup")},200)}),appBus.initialize(appConfig)})})})},"bus beforeInit":function(){this.fire("dataBind",{})},"bus afterInit + afterRender":function(e,init,render){var $node=render.element,searchSettings={searchString:"",entityTypeId:null,entityStateIds:[],isAllProjects:!1},parentConfigurator=init.config.context.configurator,searchViewConfigurator=parentConfigurator.createChild();searchViewConfigurator.getExternal().setFakeWindow();var searchServiceInstance=new SearchServiceClass({storage:searchSettings,configurator:searchViewConfigurator});searchViewConfigurator.registerService("search",searchServiceInstance),this.setupSearchSettings($node,searchViewConfigurator),this.setupSearchTrigger($node,searchViewConfigurator)}})});
define('tau/ui/templates/search.input/ui.template.search.input',["tau/core/templates-factory"],function(templates){var config={name:"search.input",engine:"jqote2",markup:['<form action="">','<div class="tau-main-search">','<span class="tau-inline-group tau-search"><input type="text" class="tau-in-text i-role-search-string" placeholder="Search"><button class="tau-btn tau-search i-role-search-trigger"></button></span>',"</div>","</form>"]};return templates.register(config)});
define('tau/components/component.search.input',["tau/components/component.creator","tau/ui/extensions/search.input/ui.extension.search.input","tau/ui/templates/search.input/ui.template.search.input"],function($,ExtensionSearch,ComponentCreator,Template){return{create:function(config){config["queue.bus"]=!0;var creatorConfig={"queue.bus":!0,extensions:[ExtensionSearch],template:Template},component=ComponentCreator.create(creatorConfig,config);return component}}});
define('tau/models/model.search',["Underscore","tau/core/extension.base"],function(_,ModelBase){return ModelBase.extend({init:function(c){var ext=this;ext._super.apply(ext,arguments);var configurator=c.context.configurator,ssi=configurator.service("search");ext.refreshTrigger=function(){ext.fire("refresh")},ssi.onSubmit(ext.refreshTrigger),ext.destructor=function(){ssi.offSubmit(ext.refreshTrigger)}},destroy:function(){this.destructor(),this._super.apply(this,arguments)},"bus afterInit":function(e){var self=this,configurator=e.data.config.context.configurator,ssi=configurator.service("search"),params=ssi.params().get();ssi.search(params).done(function(r){r.data.items=_.map(r.data.items,function(v){var id=v.id,entityTypeName=v.entityType.name;return v.entityType.name.toLowerCase()=="comment"&&(id=v.general.id,entityTypeName=v.general.entityType.name),v.url=configurator.getUrlBuilder().getNewViewUrl(id,entityTypeName,!0),v}),r.data.srcParams=params,self.fire("dataBind",r.data)})}})});
define('tau/ui/templates/search/ui.template.search',["Underscore","jQuery","app.path","tau/core/templates-factory","tau/utils/utils.date"],function(_,$,appPath,templates,dateUtils){var config={name:"search",engine:"jqote2",customFunctions:{oldSearchUrl:function(searchString){return appPath.get()+"/Search/Search.aspx?SearchString="+searchString},esc:function(str){return _.escape(str)},generatePagingItems:function(current,total,radix){var r=[],lb=_.max([current-radix,0]),rb=_.min([current+radix,total-1]);for(var i=0;i<total;i++)i===0||i===total-1?r.push({index:i,text:i+1}):i>=lb&&i<=rb?r.push({index:i,text:i+1}):(i===lb-1||i===rb+1)&&r.push({index:i,text:"..."});return r},formatDate:function(createDate){var xAge=dateUtils.getAge(createDate),age=xAge.isZero?"Just added":xAge.toString(),fmt=dateUtils.format.date.short(dateUtils.convertToTimezone(createDate));return fmt+" ("+age+")"},highlight:function(textNode,key){function innerHighlight(node,pat){var skip=0;if(node.nodeType==Node.TEXT_NODE){var pos=node.data.toUpperCase().indexOf(pat);if(pos>=0){var spannode=document.createElement("span");spannode.className="tau-search-txt";var middlebit=node.splitText(pos),endbit=middlebit.splitText(pat.length),middleclone=middlebit.cloneNode(!0);spannode.appendChild(middleclone),middlebit.parentNode.replaceChild(spannode,middlebit),skip=1}}else if(node.nodeType==1&&node.childNodes&&!/(script|style)/i.test(node.tagName))for(var i=0;i<node.childNodes.length;++i)i+=innerHighlight(node.childNodes[i],pat);return skip}return textNode.each(function(){innerHighlight(this,key.toUpperCase())})},nodeCutOffIterator:function(htmlNode,radix){if(htmlNode){var txt=htmlNode.textContent.replace(/\s+/g," "),len=txt.length,splitChars=[" ","[","]","{","}","(",")","/","\\",",",".",":",";","?","!","&","+","-","*"];if(len>2*radix){var startIndex=_.indexOfAnyChar(txt,splitChars,radix);startIndex=startIndex===-1?radix:startIndex;var partStart=txt.substring(0,startIndex),rest=len-radix,endIndex=_.indexOfAnyChar(txt,splitChars,rest);endIndex=endIndex===-1?rest:endIndex;var partEnd=txt.substring(endIndex,len);htmlNode.textContent=partStart+" ... "+partEnd}}return htmlNode},format:function(originText,keywords,doShort){var fn=this;originText=originText||"",originText=$("<div>"+originText+"</div>").text(),originText=$.trim(originText).replace(/</g,"&lt;").replace(/>/g,"&gt;");if(originText.length===0)return"";var newTextNode=$("<div>"+originText+"</div>");$.each(keywords,function(i,val){newTextNode=fn.highlight(newTextNode,val)});var resultNode;if(!doShort)resultNode=newTextNode;else{resultNode=$("<div></div>");var textIterator=fn.nodeCutOffIterator,hiddenMatches=0,charsCounter=0;newTextNode.contents().each(function(i,val){var isTextNode=val.nodeType==Node.TEXT_NODE,node;if(!isTextNode){var text=$(val).text();charsCounter+=text.length,node=val}else node=textIterator(val,30),charsCounter+=node.textContent.length;charsCounter>315?!isTextNode&&++hiddenMatches:resultNode.append(node)}),hiddenMatches>0&&resultNode.append('... <strong class="more-matches">+ '+hiddenMatches+" more match"+(hiddenMatches>1?"es":"")+".</strong>")}return resultNode.html()}},markup:["<% if (this.error) { %>",'<div class="tau-search-results">','<div class="tau-items">','<div class="tau-search-item">','<div class="tau-search-content">','<div class="tau-body">',"Something&apos;s wrong with the search. ","Try again or ",'<a class="tau-popup-link" href="<%= fn.oldSearchUrl(this.srcParams.searchString) %>">switch to the old search</a>',"</div>","</div>","</div>","</div>","</div>","<% } else { %>",'<div class="tau-search-results">','<div class="tau-items">',"<% if (this.info.indexProgress < 100) { %>",'<div class="tau-search-item tau-search-notification">','<div class="tau-search-content">','<div class="tau-body">Search results might be incomplete at this point. Indexing is still in progress...</div>',"</div>","</div>","<% } %>","<% var keywords = this.keywords; %>","<% if (this.items.length === 0) { %>",'<div class="tau-search-item">','<div class="tau-search-content">','<div class="tau-body">Nothing found</div>',"</div>","</div>","<% } %>","<% _.forEach(this.items, function(d) { %>","<% var entityType = d.entityType.name.toLowerCase(); %>",'<% var isComment = (entityType === "comment"); %>','<% var isTestCase = (entityType === "testcase"); %>','<div class="tau-search-item">','<div class="tau-search-content">','<div class="tau-header">','<span class="tau-entity tau-<%= d.entityType.name.toLowerCase() %>"><%= d.entityType.term %></span>',"<% if (isComment) { %>",'<span class="tau-entity tau-<%= d.general.entityType.name.toLowerCase() %>"><%= d.general.entityType.term %></span>','<a href="<%= d.url %>" class="tau-entity-id">#<%= d.general.id %></a>',"<% } else { %>",'<a href="<%= d.url %>" class="tau-entity-id">#<%= d.id %></a>','<span class="tau-entity-filter"><%= fn.format(d.tags.join(" "), keywords, false) %></span>',"<% } %>","</div>",'<div class="tau-body">',"<% if (isComment) { %>",'<h3><a href="<%= d.url %>"><%= fn.esc(d.general.name) %></a></h3>',"<% } else { %>",'<h3><a href="<%= d.url %>"><%= fn.format(fn.esc(d.nameExt), keywords, false) %></a></h3>',"<% } %>","<% if (isTestCase) { %>","<% if (d.steps) { %><p><strong>Steps:</strong> <%= fn.format(d.steps, keywords, true) %></p><% } %>","<% if (d.success) { %><p><strong>Success:</strong> <%= fn.format(d.success, keywords, true) %></p><% } %>","<% } else { %>","<p><%= fn.format(d.descExt, keywords, true) %></p>","<% } %>","</div>","</div>",'<div class="tau-search-info">',"<% if (d.entityState) { %>",'<div class="tau-line<% if (d.entityState.isFinal) { %> tau-done-entity<% } %>">','<div class="tau-caption">State</div>','<div class="tau-txt"><%= d.entityState.name %></div>',"</div>","<% } %>",'<div class="tau-line">','<div class="tau-caption">reated</div>','<div class="tau-txt"><%= fn.formatDate(d.createDate) %></div>',"</div>","<% if (d.project) { %>",'<div class="tau-line">','<div class="tau-caption">Project</div>','<div class="tau-txt"><%= d.project.name %></div>',"</div>","<% } %>","<% if (d.team) { %>",'<div class="tau-line">','<div class="tau-caption">Team</div>','<div class="tau-txt">','<span><%= d.team.name %></span><% if (d.team.icon) { %><i class="tau-icon tau-icon_type_svg tau-icon_name_<%! d.team.icon %>"></i><% } %>',"</div>","</div>","<% } %>","</div>","</div>","<% }); %>","</div>","<% var pagesCount = Math.ceil(this.info.total / this.info.pageSize); %>","<% if (pagesCount > 1) { %>",'<div class="tau-paging i-role-paging-container">','<div class="tau-links">','<a href="" class="tau-prev<% if (this.info.pageNo == 0) { %> tau-disabled<% } %> i-role-paging-prev">Previous <%= this.info.pageSize %></a>','<a href="" class="tau-next<% if (this.info.pageNo == (pagesCount - 1)) { %> tau-disabled<% } %> i-role-paging-next">Next <%= this.info.pageSize %></a>',"</div>",'<ul class="i-role-paging-pageno">',"<% var pagingItems = fn.generatePagingItems(this.info.pageNo, pagesCount, 5); %>","<% for (var i = 0; i < pagingItems.length; i++) { %>","<% var item = pagingItems[i]; %>","<% if (item.index == this.info.pageNo) { %>",'<li class="active"><span><%= item.text %></span></li>',"<% } else { %>",'<li><a href="" data-page="<%= item.index %>"><%= item.text %></a></li>',"<% } %>","<% } %>","</ul>","</div>","<% } %>","</div>","<% } %>"]};return templates.register(config)});
define('tau/components/component.search',["jQuery","tau/components/component.creator","tau/core/extension.base","tau/models/model.search","tau/ui/templates/search/ui.template.search","tau/ui/behaviour/common/ui.behaviour.progressIndicator"],function($,creator,ExtensionBase,ModelType,template,ProgressIndicator){return{create:function(config){config=config||{};var creatorConfig={extensions:[ModelType,ExtensionBase.extend({"bus afterRender":function(e,render){var $el=render.element;ProgressIndicator.get($el).hide()},"bus afterRender > refresh":function(e,render){var $el=render.element;$el.css("opacity",.5),ProgressIndicator.get($el).show()},"bus afterInit + afterRender":function(e,init,render){var configurator=init.config.context.configurator,ssi=configurator.service("search"),$node=render.element;$node.on("click",".i-role-paging-container .i-role-paging-prev",function(e){e.preventDefault();if($(e.target).hasClass("tau-disabled"))return;var currPageNo=ssi.params().get("pageNo");ssi.params().set("pageNo",--currPageNo).submit()}),$node.on("click",".i-role-paging-container .i-role-paging-next",function(e){e.preventDefault();if($(e.target).hasClass("tau-disabled"))return;var currPageNo=ssi.params().get("pageNo");ssi.params().set("pageNo",++currPageNo).submit()}),$node.on("click",".i-role-paging-container .i-role-paging-pageno a",function(e){e.preventDefault();var targetPage=$(e.target).data("page");ssi.params().set("pageNo",targetPage).submit()})}})],template:config.template||template};return creator.create(creatorConfig,config)}}});
define('tau/models/propertyLists/model.defaultList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({onInit:function(){var self=this,config=this.config,entity=this.config.context.entity;this.propertyType=config.listType,self.store.get(config.listType,{fields:["id","name"]}).get(entity.entityType.name,{id:entity.id,fields:["id",config.listType]}).done({success:_.bind(self.onDataRetrieved,self)})},onDataRetrieved:function(result){var items=result[0].data,entity=result[1].data,current=this.config.data,showReset=!!(this.config.showReset&&current&&current.id),data={states:_.reject(items,function(item){return current&&item.id===current.id}),completed:!0,nullableValue:showReset};this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.staticList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({onInit:function(){var self=this,config=this.config,entity=this.config.context.entity;self.store.get(entity.entityType.name,{id:entity.id,fields:["id",config.data.name]}).done({success:_.bind(self.onDataRetrieved,self)})},onDataRetrieved:function(result){var entity=result[0].data,current=entity[this.config.data.name],items=this.config.values;_.forEach(items,function(item,k){_.isObject(item)==0&&(item={id:item,name:item},items[k]=item)});var showReset=!!this.config.showReset&&!!current,data={states:_.reject(items,function(item){return current&&item.id==current}),completed:!0,nullableValue:showReset};this.fire("dataBind",data)},"bus updateState":function(evt){var $set={},value=null;evt.data&&evt.data.id&&(value=evt.data.id),$set[this.config.data.name]=value,this.fire("save",$set)}})});
define('tau/models/propertyLists/model.prioritiesList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({name:"priority-list-model",propertyType:"priority",onInit:function(){var self=this,success=function(r){var assignable=r[0].data;self.assignable=assignable,self.store.get(self.propertyType,self.createGetPrioritiesCommand()).done({success:_.bind(self.onDataRetrieved,self)})};this.getAssignable(success)},getRequiredFields:function(){return[{entityType:["id"]}]},createGetPrioritiesCommand:function(){return{fields:["id","name","importance",{entityType:["id"]}]}},processData:function(priorities){var currentId=this.getCurrentEntityId(),currentEntityTypeId=this.assignable.entityType.id,filteredPriorities=[];_.each(priorities,function(priority){priority.id!==currentId&&priority.entityType.id===currentEntityTypeId&&filteredPriorities.push({id:priority.id,name:priority.name,importance:priority.importance||0})}),filteredPriorities.sort(function(a,b){return a.importance-b.importance}),this.fire("dataBind",{states:filteredPriorities,completed:!0,nullableValue:!1})}})});
define('tau/models/propertyLists/model.relationTypeList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({name:"relationType-list-model",propertyType:"relationType",onInit:function(){var self=this,success=function(r){self.assignable=r[0].data,self.store.get(self.propertyType,self.createGetRelationTypesCommand()).done({success:_.bind(self.onDataRetrieved,self)})};this.getAssignable(success)},getRequiredFields:function(){return[{relationType:["id"]}]},createGetRelationTypesCommand:function(){return{fields:["id","name"]}},processData:function(relationTypes){var currentRelationTypeId=this.assignable.relationType.id;this.fire("dataBind",{states:_.select(relationTypes,function(i){return i.id!==currentRelationTypeId}),completed:!0,nullableValue:!1})}})});
define('tau/models/propertyLists/model.severityList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelProperyListBase){return ModelProperyListBase.extend({name:"severity-list",propertyType:"severity",onInit:function(){var self=this;self.store.get(self.propertyType,{fields:["id","name","importance"]}).done({success:_.bind(self.onDataRetrieved,self)})},getRequiredFields:function(){return["id","name","importance"]},createGetStateForAssignableCommand:function(){return{fields:["id","name","importance"]}},processData:function(severities){var currentSeverityId=this.getCurrentEntityId(),items=[];_.each(severities,function(severity){severity.id!==currentSeverityId&&items.push({id:severity.id,name:severity.name,importance:severity.importance})}),items.sort(function(a,b){return a.importance-b.importance}),this.fire("dataBind",{states:items,completed:!0,nullableValue:!1})}})});
define('tau/models/propertyLists/model.roleList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({onInit:function(){var self=this,config=this.config,entity=this.config.context.entity;this.propertyType=config.listType,self.store.get("role",{fields:["id","name"]}).get(entity.entityType.name,{id:entity.id,fields:["id",{role:["id","name"]}]}).done({success:_.bind(self.onDataRetrieved,self)})},onDataRetrieved:function(result){var items=result[0].data,entity=result[1].data,current=this.config.data,showReset=!!(this.config.showReset&&current&&current.id),data={states:_.reject(items,function(item){return current&&item.id===current.id}),completed:!0,nullableValue:showReset};this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.releaseList',["Underscore","tau/models/propertyLists/model.propertyList.base","tau/store/types","tau/utils/utils.date"],function(_,ModelBase,tauTypes,dateUtils){return ModelBase.extend({name:"release-list",propertyType:"release",onInit:function(){var entity=this.config.context.entity,self=this;this.store.get(entity.entityType.name,{id:entity.id,fields:["id",{project:["id",{releases:["id","name","isCurrent","startDate","endDate"]}]}]}).done({success:function(result){result[0].data.project=result[0].data.project||{};var project=_.defaults(result[0].data.project,{releases:[]});self.processData.call(self,project)}})},"bus beforeSave":function(evtArgs){var cmd=evtArgs.data.cmd,$set=cmd.$set,fields=cmd.fields=cmd.fields||[];this.entityContainIteration()&&fields.push({iteration:["id","name"]})},entityContainIteration:function(){var type=tauTypes.findByKeyword(this.config.context.entity.entityType.name);return type.refs.hasOwnProperty("iteration")},getRequiredFields:function(){return[{entityState:["id"]}]},convertReleaseToDto:function(release){var isCurrent=this.isCurrentRelease(release),itemName=release.name+(isCurrent?" (current)":"");return{id:release.id,name:itemName,description:"From "+dateUtils.format.date.short(release.startDate)+" to "+dateUtils.format.date.short(release.endDate)}},isOldRelease:function(release){var currentDate=this.config.context.configurator.getCurrentDate();return release.endDate<currentDate},isCurrentRelease:function(release){return release.isCurrent},isCurrentOrFeatureRelease:function(release){return!this.isOldRelease(release)},selectOldReleases:function(){return _.select(this.projectReleaseList,this.isOldRelease,this)},selectCurrentAndFeatureReleases:function(releaseList){return _.select(this.projectReleaseList,this.isCurrentOrFeatureRelease,this)},getCurrentRelease:function(){return _.detect(this.projectReleaseList,this.isCurrentRelease,this)},initProjectReleaseList:function(project){var currentReleaseId=this.getCurrentEntityId(),projectReleaseList=_.select(project.releases,function(release){return release.id!=currentReleaseId});_.each(projectReleaseList,function(release){release.startDate=dateUtils.parse(release.startDate),release.endDate=dateUtils.parse(release.endDate)}),this.projectReleaseList=projectReleaseList},processData:function(project){this.initProjectReleaseList(project);var currentReleaseId=this.getCurrentEntityId(),config=this.config,mode=config.mode||"short",currentAndFeatureReleaseList=this.selectCurrentAndFeatureReleases(),releases=[],oldReleases=this.selectOldReleases(),completed=oldReleases.length==0;mode=="short"&&currentAndFeatureReleaseList.length>0?releases=currentAndFeatureReleaseList:(mode=="full",releases=releases.concat(oldReleases,currentAndFeatureReleaseList),completed=!0),releases=_.map(releases,this.convertReleaseToDto,this);var data={nullableValue:currentReleaseId!==null&&this.config.context.entity.entityType.name.toLowerCase()!=="iteration"&&this.propertyIsNotEmpty(),states:releases,completed:completed},currentRelease=this.getCurrentRelease();currentRelease&&(data.defaultValue=currentRelease.id),this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.iterationList',["Underscore","tau/models/propertyLists/model.propertyList.base","tau/utils/utils.date"],function(_,ModelProperyListBase,dateUtils){return ModelProperyListBase.extend({name:"iteration-list",propertyType:"iteration",onInit:function(){var entity=this.config.context.entity,self=this;this.store.get(entity.entityType.name,{id:entity.id,fields:["id",{project:["id",{iterations:["id","name","startDate","endDate","isCurrent",{release:["id","name"]}]}]}]}).done({success:function(result){result[0].data.project=result[0].data.project||{};var project=_.defaults(result[0].data.project,{iterations:[]});self.processData.call(self,project)}})},getRequiredFields:function(){return[{entityState:["id"]}]},"bus beforeSave":function(evtArgs){var fields=evtArgs.data.cmd.fields=evtArgs.data.cmd.fields||[];fields.push({release:["id","name"]})},processData:function(project){var config=this.config,currentStateId=this.getCurrentEntityId(),states=[],mode=config.mode||"short",fnFilter=null,currentIteration=null,currentDate=this.config.context.configurator.getCurrentDate(),fnFilterFull=function(iteration){iteration.id!==currentStateId&&states.push(iteration)};mode==="full"?fnFilter=fnFilterFull:fnFilter=function(item){var start=dateUtils.parse(item.startDate),end=dateUtils.parse(item.endDate);item.id!==currentStateId&&(start>=currentDate||end>=currentDate)&&states.push(item)},_.each(project.iterations,fnFilter),states.length==0&&(config.mode=="full",fnFilter=fnFilterFull,_.each(project.iterations,fnFilter));var groups=[],registered={};_(states).each(function(iter){var iteration=registered[iter.release.id]||{id:iter.release.id,name:iter.release.name};iteration.items=iteration.items||[];var start=dateUtils.parse(iter.startDate),end=dateUtils.parse(iter.endDate),isCurrent=iter.isCurrent,iterationName=iter.name+(isCurrent?" (current)":"");isCurrent&&(currentIteration=iter),iteration.items.push({id:iter.id,name:iterationName,description:"From "+dateUtils.format.date.short(start)+" to "+dateUtils.format.date.short(end)}),registered[iteration.id]||(groups.push(iteration),registered[iteration.id]=iteration)});var fullLength=project.iterations.length,tailLength=currentStateId?fullLength-1:fullLength,data={nullableValue:currentStateId!==null&&this.propertyIsNotEmpty(),states:groups,completed:0===states.length-tailLength};currentIteration&&(data.defaultValue=currentIteration.id),this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.teamIterationList',["Underscore","tau/models/propertyLists/model.propertyList.base","tau/utils/utils.date"],function(_,ModelProperyListBase,dateUtils){return ModelProperyListBase.extend({name:"team-iteration-list",propertyType:"teamIteration",onInit:function(){var entity=this.config.context.entity,self=this;this.store.get(entity.entityType.name,{id:entity.id,fields:["id",{team:["id",{teamIterations:["id","name","startDate","endDate","isCurrent"]}]}]}).done({success:function(result){result[0].data.team=result[0].data.team||{};var team=_.defaults(result[0].data.team,{teamIterations:[]});self.processData.call(self,team)}})},processData:function(team){var config=this.config,currentStateId=this.getCurrentEntityId(),availableToSelect=[],mode=config.mode||"short",fnFilter=null,currentTeamIteration=null,currentDate=this.config.context.configurator.getCurrentDate(),fnFilterFull=function(item){item.id!==currentStateId&&availableToSelect.push(item)};mode==="full"?fnFilter=fnFilterFull:fnFilter=function(item){var start=dateUtils.parse(item.startDate),end=dateUtils.parse(item.endDate);item.id!==currentStateId&&(start>=currentDate||end>=currentDate)&&availableToSelect.push(item)},_.each(team.teamIterations,fnFilter),availableToSelect.length===0&&(fnFilter=fnFilterFull,_.each(team.teamIterations,fnFilter));var resultTeamIterations=[];_(availableToSelect).each(function(teamIterationItem){var start=dateUtils.parse(teamIterationItem.startDate),end=dateUtils.parse(teamIterationItem.endDate),isCurrent=teamIterationItem.isCurrent,name=teamIterationItem.name+(isCurrent?" (current)":"");!currentTeamIteration&&isCurrent&&(currentTeamIteration=teamIterationItem),resultTeamIterations.push({id:teamIterationItem.id,name:name,description:"From "+dateUtils.format.date.short(start)+" to "+dateUtils.format.date.short(end)})});var fullLength=team.teamIterations.length,tailLength=currentStateId?fullLength-1:fullLength,data={nullableValue:currentStateId!==null&&this.propertyIsNotEmpty(),states:resultTeamIterations,completed:0===resultTeamIterations.length-tailLength};currentTeamIteration&&(data.defaultValue=currentTeamIteration.id),this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.userStoryList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelProperyListBase){return ModelProperyListBase.extend({name:"userStory-list",propertyType:"userStory",onInit:function(){var self=this,success=function(){self.store.get("userStory",{fields:["id","name",{project:["id","name"]}]}).done({success:_.bind(self.onDataRetrieved,self)})};success()},processData:function(stories){var currentUserStoryId=this.getCurrentEntityId(),projectList={};_.each(stories,function(story){story.project=story.project||{};if(story.id==currentUserStoryId)return;projectList.hasOwnProperty(story.project.id)||(projectList[story.project.id]=story.project,projectList[story.project.id].items=[]),projectList[story.project.id].items.push(story)});var data={states:this.sortProjects(_.values(projectList)),completed:!0,nullableValue:currentUserStoryId!==null&&this.config.context.entity.entityType.name.toLowerCase()!="task"&&this.propertyIsNotEmpty()};this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.featureList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelProperyListBase){return ModelProperyListBase.extend({name:"release-list",propertyType:"feature",onInit:function(){var self=this;self.store.get("project",{fields:["id","name",{process:["id"]},{features:["id","name"]}]},{success:_.bind(self.onProjectRetrieved,self)}).get("feature",{fields:["id","name",{project:["id"]}]},{success:_.bind(self.onFeatureRetrieved,self)}).get("process",{fields:["id",{practices:["name"]}]},{success:_.bind(self.onProcessesRetrieved,self)}).done({success:_.bind(self.onDataRetrieved,self)})},onFeatureRetrieved:function(result){this.featureList=result.data},onProjectRetrieved:function(result){this.projectList=result.data},onProcessesRetrieved:function(result){this.processList=result.data},getFeaturesForProject:function(project){var currentFeatureId=this.getCurrentEntityId(),fnFilter=function(feature){feature.id!==currentFeatureId&&this.push(feature)},featureList=[];return this.projectHasRequirementsPractice(project)&&_.each(project.features,fnFilter,featureList),featureList},onDataRetrieved:function(){this.processData(this.projectList,this.processList)},projectHasRequirementsPractice:function(project){var projectProcessId=project.process.id,process=_.detect(this.processList,function(process){return process.id==projectProcessId}),requirementsProcess=_.detect(process.practices,function(practice){return practice.name=="Requirements"});return!_.isEmpty(requirementsProcess)},processData:function(availableProjectList,processList){var projectsToBind=[];this.processList=processList,_.each(this.sortProjects(availableProjectList),function(project){var featureForProjectList=this.getFeaturesForProject(project);_.isEmpty(featureForProjectList)||projectsToBind.push({id:project.id,name:project.name,items:featureForProjectList})},this);var data={states:projectsToBind,completed:!0,nullableValue:this.getCurrentEntityId()!==null&&this.propertyIsNotEmpty()};this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.projectList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({propertyType:"project","bus beforeInit":function(evt,initConfig){var entity=initConfig.config.context.entity,configurator=initConfig.config.context.configurator,store=configurator.getStore(),fire=_.bind(this.fire,this);store.get("project",{fields:["id","name","color","isActive",{process:["id",{practices:["id","name"]}]}]}).done(function(result){fire("items.ready",result[0].data)}),store.get(entity.entityType.name,{id:entity.id,fields:["id",{project:["id"]}]}).done(function(result){fire("currentItem.ready",result[0].data.project||{})})},"bus beforeInit:last + items.ready + currentItem.ready":function(evt,initConfig,items,currentItem){var config=initConfig.config,entityType=initConfig.config.context.entity.entityType.name.toLowerCase(),practices={bug:["Bug Tracking"],feature:["Requirements"],release:["Requirements"],testcase:["Test Cases"],testplan:["Test Cases"],iteration:["Iterations"],request:["Help Desk"]}[entityType]||[];items=_.filter(items,function(v){var byPractice=!0;if(practices.length&&v.isActive){var prs=_.pluck(v.process.practices,"name");byPractice=_.any(prs,function(pr){return _.indexOf(practices,pr)>=0})}return v.isActive&&byPractice}),items=_.sortBy(items,function(v){return v.name.toLowerCase()});var showReset=!!(config.showReset&&currentItem&&currentItem.id),data={states:_.reject(items,function(item){return currentItem&&item.id===currentItem.id}),completed:!0,nullableValue:showReset,templateOption:config.templateOption};this.fire("dataBind",data)}})});
define('tau/models/propertyLists/model.teamList',["Underscore","tau/models/propertyLists/model.propertyList.base"],function(_,ModelBase){return ModelBase.extend({propertyType:"team","bus beforeInit":function(evt,initConfig){var entity=initConfig.config.context.entity,configurator=initConfig.config.context.configurator,store=configurator.getStore(),fire=_.bind(this.fire,this);store.get("team",{fields:["id","name","icon"]}).done(function(result){fire("items.ready",result[0].data)}),store.get(entity.entityType.name,{id:entity.id,fields:["id",{team:["id"]}]}).done(function(result){fire("currentItem.ready",result[0].data.team||{})})},"bus beforeInit:last + items.ready + currentItem.ready":function(evt,initConfig,items,currentItem){var config=initConfig.config;items=_.sortBy(items,function(v){return v.name.toLowerCase()});var showReset=!!(config.showReset&&currentItem&&currentItem.id),data={states:_.reject(items,function(item){return currentItem&&item.id===currentItem.id}),completed:!0,nullableValue:showReset,templateOption:config.templateOption};this.fire("dataBind",data)}})});
define('tau/components/component.state-list',["tau/components/component.creator","tau/models/propertyLists/model.defaultList","tau/models/propertyLists/model.staticList","tau/models/propertyLists/model.entityStateList","tau/models/propertyLists/model.prioritiesList","tau/models/propertyLists/model.relationTypeList","tau/models/propertyLists/model.severityList","tau/models/propertyLists/model.roleList","tau/models/propertyLists/model.releaseList","tau/models/propertyLists/model.iterationList","tau/models/propertyLists/model.teamIterationList","tau/models/propertyLists/model.userStoryList","tau/models/propertyLists/model.featureList","tau/models/propertyLists/model.projectList","tau/models/propertyLists/model.teamList","tau/ui/extensions/stateList/ui.extension.stateList.editable","tau/ui/extensions/bubble/ui.extension.bubble.listResizer","tau/ui/templates/state/ui.template.state.list"],function(creator,ModelDefault,ModelStaticList,ModelEntityStateList,ModelPriorityList,ModelRelationTypeList,ModelSeverityList,ModelRoleList,ModelReleaseList,ModelIterationList,ModelTeamIterationList,ModelUserStoryList,ModelFeatureList,ModelProjectList,ModelTeamList,StateListEditableExtension,ListExtension,template){var stateLists={entityState:ModelEntityStateList,priority:ModelPriorityList,severity:ModelSeverityList,relationType:ModelRelationTypeList,role:ModelRoleList,release:ModelReleaseList,iteration:ModelIterationList,teamIteration:ModelTeamIterationList,userStory:ModelUserStoryList,feature:ModelFeatureList,project:ModelProjectList,team:ModelTeamList,"static":ModelStaticList,hasModel:function(name){return this.hasOwnProperty(name)},getByName:function(name){if(this.hasModel(name))return this[name];throw"Model for property list  [mode."+name+"] was not found."}};return{create:function(config){var Model=ModelDefault;stateLists.hasModel(config.listType)&&(Model=stateLists.getByName(config.listType));var extensions=[Model,StateListEditableExtension,ListExtension],creatorConfig={extensions:extensions,template:template};return creator.create(creatorConfig,config)}}});
define('tau/components/component.steps',["tau/components/component.field.richText"],function(creator){return{create:function(config){return config=config||{},config.fieldName="steps",creator.create(config)}}});
define('tau/components/component.success',["tau/components/component.field.richText"],function(creator){return{create:function(config){return config=config||{},config.fieldName="success",creator.create(config)}}});
define('tau/ui/extensions/tabsHeader/ui.extension.tabsHeader.layout',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var config=initConfig.config;this.options=_.defaults(config.options||{},{itemClassName:"tab-item",itemRightClassName:"tab-item tab-item-right-part",selectedClassName:"selected"})},"bus afterRender + childrenRendered":function(evt,renderData,childrenData){var self=this,$el=renderData.element,$holder=$el.is(".i-role-tabheaders")?$el:$el.find(".i-role-tabheaders:first"),childrenArgs=childrenData.childrenEvtArgs,childrenConfigList=childrenData.config.children;_.forEach(childrenArgs,function(data,index){var $childEl=data.element,childConfig=childrenConfigList[index];self.insertChild($holder,$childEl,childConfig)}),$el.on("click",".i-role-tabheader",function(){var label=$(this).data("label");label&&self.fire("switched",label)}),this.fire("$el.ready",$el)},insertChild:function($holder,$childEl,config){var opts=this.options,classNames=[];_.has(config.position||{},"right")&&config.position.right?classNames.push(opts.itemRightClassName):(classNames=["i-role-tabheader"],classNames.push(opts.itemClassName)),config.selected&&classNames.push(opts.selectedClassName),config.className&&classNames.push(config.className);var label=config.label||$childEl.text();$childEl.length&&$("<li></li>").addClass(classNames.join(" ")).data("label",label).append($childEl).appendTo($holder)},"bus $el.ready:last + switched.after":function(evt,$el,id){var $items=$el.find(".i-role-tabheader"),opts=this.options;$items.each(function(){var $item=$(this);$item.toggleClass(opts.selectedClassName,$item.data("label")==id)})}})});
define('tau/ui/templates/container/ui.template.container.tabsHeader',["tau/core/templates-factory"],function(templates){var config={name:"container.tabsHeader",markup:['<div class="box table ui-helper-clearfix">','<ul class="entity-tabs i-role-tabheaders">',"</ul>","</div>"]};return templates.register(config)});
define('tau/components/component.tabsHeader',["tau/components/component.creator","tau/views/view.container","tau/components/extensions/component.creator.extension","tau/ui/extensions/tabsHeader/ui.extension.tabsHeader.layout","tau/ui/templates/container/ui.template.container.tabsHeader"],function(Creator,ExtensionView,ExtensionCreator,ExtensionLayout,Template){return{create:function(config){var creatorConfig={extensions:[ExtensionCreator,ExtensionLayout].concat(config.extensions||[]),ViewType:ExtensionView,template:config.template||Template};return Creator.create(creatorConfig,config)}}});
define('tau/views/view.tabs',["Underscore","tau/views/view.container","tau/components/component.tabsHeader"],function(_,ViewType){var tabsView=ViewType.extend({startLifeCycle:function(evt){var self=this;self.setDefaultConfig(),_.extend(self.config,(evt||{}).data),self.config=this.processConfig(self.config),self.fire("beforeInit",{config:self.config})},"bus beforeInit + state.processed":function(){var self=this,children=self.config.children;self.children=[];var loadDependencies=_.isArray(children)&&_.size(children)>0&&self.config.visible;if(loadDependencies){var components=self.config.children,context=self.config.context||{};this.fire("createComponents",{components:components,context:context})}else self.completeInitializationWithoutChildren()},processConfig:function(configRef){var self=this;return self._selectedIndex=-1,this.additionalHeaderTabIndexList={},this.tabsHeader={type:"tabsHeader",children:[]},this.panels=[],_.each(configRef.tabs,this.addTabInfo,this),_.each(configRef.additionalHeaders||[],this.addAdditionalActionToTab,this),configRef.children=[this.tabsHeader].concat(this.panels),configRef},addTabInfo:function(config,index){var selected=config.selected===!0,tabItem={type:"container",name:config.label+" tab container",selected:selected,children:config.header||[],label:config.label};this.tabsHeader.children.push(tabItem);var panelItem={type:"container",visible:selected,children:config.items||[]};this.panels.push(panelItem),selected&&(this._selectedIndex=index)},addAdditionalActionToTab:function(config){var tabItem=config||{};tabItem.position={right:!0};var tabsHeader=this.tabsHeader;tabsHeader.children.push(tabItem),this.additionalHeaderTabIndexList[tabsHeader.children.length]=!0}});return tabsView});
define('tau/ui/extensions/tabs/ui.extension.tabs.state.base',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){var Extension=ExtensionBase.extend({getRestoredState:function(){return $.Deferred().resolve(null)},"bus beforeInit":function(evt){var config=evt.data.config,tabs=config.children,headerItems=_.filter(tabs[0].children,function(item){return item.type=="container"&&_.has(item,"selected")});this.initialLabel=null;var self=this;_.forEach(headerItems,function(header,i){header.selected==1&&(self.initialLabel=header.label)});var tabsItems=tabs.slice(1);this.getRestoredState().done(function(state){var selected=!1;state&&_.forEach(headerItems,function(header,i){header.label==state?(selected=!0,tabsItems[i].visible=!0,header.selected=!0):(tabsItems[i].visible=!1,header.selected=!1)}),selected==0&&_.forEach(headerItems,function(header,i){header.label==self.initialLabel&&(tabsItems[i].visible=!0,header.selected=!0)}),self.fire("state.processed",{})})},"bus childrenRendered":function(evt){var switchConfig=[];_.forEach(evt.data.config.tabs,function(data,i){switchConfig[i]={label:data.label}}),this.fire("headerRendered",{component:evt.data.children[0],switchConfig:switchConfig});var tabs=evt.data.children.slice(1);this.fire("tabsRendered",{components:tabs})},"bus headerRendered":function(e){var header=e.data.component,_switched=_.bind(function(evt,id){_.bind(this.onHeaderSwitched,this)(id)},this);header.on("switched",_switched),this.header=header},"bus headerRendered+tabsRendered":function(e){var switchConfig=e.headerRendered.data.switchConfig,tabs=e.tabsRendered.data.components,tabsConfig={};_.forEach(tabs,function(component,i){tabsConfig[switchConfig[i].label]=component}),this.tabs=tabsConfig},onHeaderSwitched:function(id){this.tabs[id]&&this.selectTabExternal(id)},selectTabInternal:function(id){var id=id||this.initialLabel;if(this.tabs[id]){var tabToShow=this.tabs[id];_.forEach(this.tabs,function(tab){tab.fire("hide")}),tabToShow.once("show.completed",_.bind(function(){this.fire("tabs.switched.completed",id)},this)),tabToShow.fire("show"),this.header.fire("switched.after",id),this.fire("tabs.switched")}},selectTabExternal:function(index){this.selectTabInternal(index)}});return Extension});
define('tau/ui/extensions/tabs/ui.extension.tabs.state.routing',["Underscore","tau/ui/extensions/tabs/ui.extension.tabs.state.base"],function(_,ExtensionBase){return ExtensionBase.extend({getRestoredState:function(){var def=$.Deferred(),stateName=this.getStateName();return this.config.context.componentSettings.get({fields:[stateName],callback:function(data){def.resolve(data[stateName])}}),def},getStateName:function(){return this.config.stateName},selectTabExternal:function(index){var componentSettings=this.config.context.componentSettings,set={},stateName=this.getStateName();set[stateName]=index,componentSettings.set({set:set})},onStateChanged:function(stateObject){var state=stateObject[this.getStateName()]||this.defaultState;this.selectTabInternal(state)},"bus initialize":function(){var self=this,componentSettings=self.config.context.componentSettings;componentSettings.bind({fields:[this.getStateName()],listener:self,callback:self.onStateChanged})},"bus destroy":function(){var self=this,componentSettings=self.config.context.componentSettings;componentSettings.unbind({listener:self,callback:self.onStateChanged})}})});
define('tau/ui/extensions/tabs/ui.extension.tabs.state.simple',["Underscore","tau/ui/extensions/tabs/ui.extension.tabs.state.base"],function(_,ExtensionBase){var extension=ExtensionBase.extend({});return extension});
define('tau/components/component.tabs',["tau/components/component.creator","tau/views/view.tabs","tau/components/extensions/component.creator.extension","tau/ui/extensions/tabs/ui.extension.tabs.state.routing","tau/ui/extensions/tabs/ui.extension.tabs.state.simple","tau/ui/extensions/layout/ui.extension.layout","tau/ui/templates/container/ui.template.container.list"],function(creator,ViewType,ComponentCreatorExtension,RoutingStateExtension,SimpleStateExtension,LayoutExtension,template){return{create:function(config){var StateExtension=config.stateName?RoutingStateExtension:SimpleStateExtension,creatorConfig={extensions:[ComponentCreatorExtension,StateExtension,LayoutExtension].concat(config.extensions||[]),ViewType:ViewType,template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/tags/model.tags.data',["Underscore","tau/core/extension.base","tau/models/tags/tagsProcessor"],function(_,ExtensionBase,TagsProcessor){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var entity=initConfig.config.context.entity,configurator=initConfig.config.context.configurator;this.fire("entity.ready",entity),this.fire("configurator.ready",configurator),this.fire("tagsProcessor.ready",new TagsProcessor)},"bus configurator.ready + entity.ready + tagsProcessor.ready + beforeInit":function(evt,configurator,entity,tagsProcessor){var store=configurator.getStore();store.get(entity.entityType.name,{id:entity.id,fields:["id","tags"]}).done(_.bind(function(res){this.fire("dataBind",{tags:this._process(tagsProcessor.asArray(res[0].data.tags))})},this))},_process:function(tags){return tags=_.map(tags,function(v){var tag={name:v},dupl=tag.name.match(/^duplicateOf\#(\d+)$/i);return dupl&&(tag.isDuplicate=!0,tag.href="#bug/"+dupl[1]),tag}),tags}})});
define('tau/models/tags/model.tags.editable',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus configurator.ready:last + entity.ready:last + tagsProcessor.ready:last + form.submitted":function(evt,configurator,entity,tagsProcessor,formData){var store=configurator.getStore();store.save(entity.entityType.name,{id:entity.id,$set:{tags:tagsProcessor.asString(formData.tags)},fields:["id","tags"]}).done()},"bus configurator.ready + entity.ready + beforeInit":function(evt,configurator,entity){var store=configurator.getStore();store.unbind(this),store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,filter:{id:entity.id}},_.bind(function(e){e.data.cmd&&e.data.cmd.config.$set&&_.has(e.data.cmd.config.$set,"tags")&&this.fire("refresh")},this))},"bus configurator.ready > destroy":function(evt,configurator){var store=configurator.getStore();store.unbind(this)}})});
define('tau/models/tags/model.tags.duplicateBug',["tau/core/extension.base"],function(ExtensionBase){return ExtensionBase.extend({"bus configurator.ready":function(evt,configurator){var gb=configurator.getGlobalBus();gb.removeAllListeners(this),gb.on("bugWasMarkedAsDuplicate",_.bind(function(evt){this.fire("bug.duplicated",{sourceId:evt.data.bugId,duplicateId:evt.data.duplicateBugId})},this),this)},"bus configurator.ready:last + entity.ready:last + bug.duplicated":function(evt,configurator,entity,bugData){if(entity.id==bugData.duplicateId||entity.id==bugData.sourceId)configurator.getStore().evictProperties(entity.id,entity.entityType.name,["tags"]),this.fire("refresh")},"bus configurator.ready > destroy":function(evt,configurator){configurator.getGlobalBus().removeAllListeners(this)}})});
define('tau/ui/behaviour/tags/ui.behaviour.tagsEditor',["Underscore","jQuery"],function(_,$){$.widget("ui.tagsEditor",{options:{selector:".ui-tags__tag",onSave:$.noop,onShow:$.noop},_create:function(){this.init()},init:function(){this.$list=$(this.element);var selector=this.options.selector,$items=this.$list.find(selector);$items.append('<span class="ui-tags__control-delete i-role-actiondelete" title="Delete tag">Delete tag</span>');var self=this;this.$list.delegate(".ui-tags__control-delete","click",function(e){e.preventDefault(),$(this).parents(selector).eq(0).remove(),self.options.onSave(self.getTags())}),this.$widget=$(['<li class="ui-tags__editor">','<span title="Add tag" class="ui-tags__editor__control-show i-role-control_show">',"<i>Add tag</i>","</span>","</li>"].join(""));var show=_.bind(this.showEditor,this);this.$widget.find(".i-role-control_show").click(function(e){e.preventDefault(),show()}),this.$list.append(this.$widget)},_processAddTag:function($editor){var self=this,newTags=self.parseTags($editor.find(":text").val()),tags=self.getTags();tags=tags.concat(newTags),self.options.onSave(tags)},showEditor:function(e){if(!this._editorIsVisible){if(!this.$editor){var $editor=$(['<form class="ui-tags__editor__inner">','<input type="text" maxlength="50" class="tau-in-text ui-tags__editor__input" />','<span class="tau-inline-group">','<button title="Add"  type="submit"  class="tau-btn tau-btn-small ui-tags__editor__button-submit">Add</button>','<button title="Cancel" type="reset"  class="tau-btn tau-btn-small tau-close ui-tags__editor__button-cancel"></button>',"</span>","</form>"].join("")),self=this;$editor.on("submit",function(e){e.preventDefault(),self._processAddTag($editor)}),$editor.on("reset",function(e){self.hideEditor()}),$editor.find(":text").keydown(_.bind(this.mapKeys,this)),$editor.appendTo(this.$widget),this.$editor=$editor,this.$text=$editor.find(":text")}this.resetEditor(),this.$widget.toggleClass("ui-tags__editor-active",!0),this._editorIsVisible=!0,this.$editor.find(":text").focus(),this._trigger("show",this.$editor)}},hideEditor:function(){this.$editor&&this._editorIsVisible&&(this.$editor.find(":text").blur(),this.$widget.toggleClass("ui-tags__editor-active",!1),this._editorIsVisible=!1,this.resetEditor())},resetEditor:function(){this.$editor&&this.$editor.find(":text").val("")},setValue:function(text){_.isArray(text)&&(text=text.join(", ")),this.$editor&&this.$editor.find(":text").val(text)},getValue:function(text){return this.parseTags(this.$editor.find(":text").val())},mapKeys:function(event){switch(event.which){case 27:event.preventDefault(),this.hideEditor(event)}},getTagText:function($el){return _.trim($el.find("span:first").text())},getTags:function(){var tags=[],scope=this;return this.$list.find(this.options.selector).each(function(k,v){var $el=$(v);tags.push(scope.getTagText($el))}),tags},parseTags:function(string){string=string||"";var tags=string.split(",");return tags=_(tags).map(function(token){return _.trim(token)}),tags=_.uniq(tags),tags=_.compact(tags),tags}})});
define('tau/ui/extensions/tags/ui.extension.tags.editable',["Underscore","tau/core/extension.base","tau/ui/behaviour/tags/ui.behaviour.tagsEditor"],function(_,ExtensionBase){return ExtensionBase.extend({category:"edit","bus afterRender":function(evt,renderData){var $el=renderData.element;this.fire("$el.ready",$el);var self=this,$editor=$el.find(".i-role-editor");$editor.tagsEditor({validation:{trim:!0},onSave:function(tags){$editor.addClass("data-saving"),self.fire("form.submitted",{tags:tags})}}),$editor.bind("tagseditorshow",_.bind(this.fire,this,"$editor.shown",$editor)),this.fire("$editor.ready",$editor)},"bus tagsProcessor.ready:last + $editor.ready:last + external.toggleTag":function(evt,processor,$editor,tag){$editor.tagsEditor("showEditor");var $text=$editor.find(":text"),tags=processor.asArray($text.val());tag.checked?tags.push(tag.text):tags=_.without(tags,tag.text);var v=processor.asString(tags);v.length?$text.val(v):$editor.tagsEditor("hideEditor")}})});
define('tau/ui/extensions/tags/ui.extension.tags.autocomplete',["Underscore","tau/libs/store2/store2","tau/core/extension.base"],function(_,Store2,ExtensionBase){return ExtensionBase.extend({category:"edit","bus configurator.ready":function(evt,configurator){this.fire("store2.ready",new Store2(configurator))},"bus store2.ready:last + tagsProcessor.ready:last + autocomplete.resolve":function(evt,store2,tagsProcessor,autocompleteData){var pos=autocompleteData.$input[0].selectionEnd;if(_.isUndefined(pos)&&document.selection){var Sel=document.selection.createRange(),SelLength=document.selection.createRange().text.length;Sel.moveStart("character",-autocompleteData.$input.val().length),pos=Sel.text.length-SelLength}var fullTerm=autocompleteData.request.term.substr(0,pos),tagTerm=_.ltrim(_.strRightBack(fullTerm,","));tagTerm.length>1?(pos-=tagTerm.length,autocompleteData.$input.data("acTerm",tagTerm),autocompleteData.$input.data("acPos",pos),store2.findAll("Tag?select={"+["name"].join(",")+'}&where=name.startsWith("'+store2.arg(tagTerm.toLowerCase())+'")').done(function(items){var vals=tagsProcessor.asArray(_.pluck(items,"name"));vals=_.sortBy(vals,function(v){return v.toLowerCase()}),autocompleteData.next(vals)})):autocompleteData.next([])},"bus tagsProcessor.ready:last + $editor.shown":function(evt,tagsProcessor,$editor){var self=this,$input=$editor.find(":text");$input.autocomplete({minLength:2,source:function(request,next){self.fire("autocomplete.resolve",{$input:$input,request:request,next:next})},focus:function(){return!1},select:function(event,ui){var selected=ui.item.value,val=$input.val(),s=tagsProcessor.asArray(val.substr(0,$input.data("acPos"))+val.slice($input.data("acPos")+$input.data("acTerm").length));return s.push(selected),s=tagsProcessor.asString(s),$input.val(s),$input.focus(),event.preventDefault(),event.stopPropagation(),!1}}),$input.data("autocomplete")._renderItem=function(ul,item){return $("<li class='tau-autocomplete__item'></li>").data("item.autocomplete",item).append("<a class='tau-autocomplete__itemtrigger drop-down-option'>"+_.escape(item.label)+"</a>").appendTo(ul)},$input.data("autocomplete")._renderMenu=function(ul,items){$(ul).addClass("tau-autocomplete__menu drop-down-list tau-autocomplete__menu__tags").css("maxHeight",$(window).height()*.4);var that=this;$.each(items,function(index,item){that._renderItem(ul,item)})}}})});
define('tau/ui/templates/tags/ui.template.tags.item',["tau/core/templates-factory"],function(templates){var config={name:"tags.item",engine:"jqote2",markup:['<li class="ui-tags__tag i-role-tag" rel="tag">',"<span>","<% if (this.isDuplicate) { %>",'<a class="ui-tags__duplicateBug" href=<%= this.href %>>',"<%! this.name %>","</a>","<% } else { %>","<%! this.name %>","<% } %>","</span>","</li>"]};return templates.register(config)});
define('tau/ui/templates/tags/ui.template.tags',["tau/core/templates-factory","tau/ui/templates/tags/ui.template.tags.item"],function(templates){var config={name:"tags",engine:"jqote2",markup:["<span>",'<ul class="ui-tags i-role-editor">','<%= fn.sub("tags.item", this.tags) %>',"</ul>","</span>"]};return templates.register(config)});
define('tau/components/component.tags',["tau/components/component.creator","tau/models/tags/model.tags.data","tau/models/tags/model.tags.editable","tau/models/tags/model.tags.duplicateBug","tau/ui/extensions/tags/ui.extension.tags.editable","tau/ui/extensions/tags/ui.extension.tags.autocomplete","tau/ui/templates/tags/ui.template.tags"],function(Creator,Model,ModelEditable,ModelDuplicateBug,ExtensionEditable,ExtensionAutocomplete,Template){return{create:function(config){var creatorConfig={extensions:[Model,ModelEditable,ModelDuplicateBug,ExtensionEditable,ExtensionAutocomplete],template:Template};return Creator.create(creatorConfig,config)}}});
define('tau/models/tagsCloud/model.tagsCloud',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus beforeInit":function(evt,initConfig){var entity=initConfig.config.context.entity,configurator=initConfig.config.context.configurator;this.fire("entity.ready",entity),this.fire("configurator.ready",configurator)},"bus configurator.ready + entity.ready + beforeInit":function(evt,configurator,entity){var store=configurator.getStore(),fields=["id","tags"];_.has(store.config.proxy.types[entity.entityType.name].refs,"project")&&fields.push({project:["id"]}),store.get(entity.entityType.name,{id:entity.id,fields:fields}).done(_.bind(function(res){this.fire("entityTags.ready",res[0].data.tags),this.fire("entityProject.ready",res[0].data.project)},this)),store.unbind(this),store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,filter:{id:entity.id}},_.bind(function(e){e.data.cmd.config.$set&&_.has(e.data.cmd.config.$set,"tags")&&this.fire("refresh")},this)),store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,filter:{id:entity.id},hasChanges:["project"]},_.bind(function(e){this.fire("refresh")},this))},"bus configurator.ready + entityProject.ready + beforeInit":function(evt,configurator,project){var projectId=project&&project.id?project.id:0;$.ajax({url:configurator.getApplicationPath()+"/PageServices/WebMethods.asmx/GetAllTags",type:"post",data:JSON.stringify({projectID:projectId}),contentType:"application/json; charset=utf-8"}).done(_.bind(function(res){var items=_.map(res.d,function(v,k){return{name:k,size:v}});items=this._process(items),this.fire("cloudData.ready",items)},this))},"bus cloudData.ready + entityTags.ready":function(evt,cloudTags,entityTags){entityTags=_.asString(entityTags).split(", "),_.forEach(cloudTags,function(tag){!(_.indexOf(entityTags,tag.name)>=0)}),this.fire("dataBind",{showSearch:cloudTags.length>20,tags:cloudTags})},"bus configurator.ready > destroy":function(evt,configurator){var store=configurator.getStore();store.unbind(this)},_process:function(items){var maxSize=_.max(_.pluck(items,"size"))||1,minSize=_.min(_.pluck(items,"size"))||0,avg=7/maxSize;return items=_.map(items,function(v){return v.size=Math.round(avg*v.size),v}),items=_.sortBy(items,function(v){return 20-v.size+"_"+v.name.toLowerCase()}),items=_.map(items,function(v,k){return k>=100&&(v.hidden=!0),v}),items}})});
define('tau/ui/extensions/tagsCloud/ui.extension.tagsCloud.editable',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({"bus afterRender":function(evt,renderData){var self=this,$el=renderData.element;this.fire("$el.ready",$el),$el.on("click",".i-role-tag",function(){var $l=$(this);$l.toggleClass("tau-active"),self.fire("tag.toggled",{text:$l.text(),checked:$l.hasClass("tau-active")})})}})});
define('tau/ui/extensions/tagsCloud/ui.extension.tagsCloud.filter',["Underscore","jQuery","tau/core/extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus $el.ready":function(evt,$el){var self=this;$el.delegate("input[name=filter]","keyup",function(){self.fire("filter.changed",$(this).val())}),$el.delegate("input[name=filter]","keydown",function(e){e.keyCode==$.ui.keyCode.ESCAPE&&e.stopPropagation(),e.which==$.ui.keyCode.ENTER&&$(this).trigger("blur")})},match:function(source,filter){var index=source.toLowerCase();return filter.length==0||_.any(filter,function(v){return index.indexOf(v)>=0})},"bus $el.ready:last + filter.changed":function(evt,$el,text){var filterIndex=_.trim(text).toLowerCase().split(/\s+/g),match=this.match,$items=$el.find(".i-role-tag"),found=0;_.trim(text).length>0?($items.each(function(){var $item=$(this),itemText=$item.text(),matched=match(itemText,filterIndex);matched&&(found+=1),$item.toggleClass("tau-tags-cloud__item_filtered_false",!matched),$item.toggleClass("tau-tags-cloud__item_filtered_true",matched)}),$el.toggleClass("tau-tags-cloud_filtered_none",found==0)):($el.toggleClass("tau-tags-cloud_filtered_none",!1),$items.toggleClass("tau-tags-cloud__item_filtered_false",!1),$items.toggleClass("tau-tags-cloud__item_filtered_true",!1)),this.fire("filter.completed")}})});
define('tau/ui/templates/tagsCloud/ui.template.tagsCloud.item',["tau/core/templates-factory"],function(templates){var config={name:"tagsCloud.item",engine:"jqote2",markup:['<span class="tau-tags-cloud__item tau-tag-rank-<%= this.size %> <% if (this.hidden){ %> tau-tags-cloud__item_hidden_true<% } %> i-role-tag">',"<%! this.name %>","</span>"]};return templates.register(config)});
define('tau/ui/templates/tagsCloud/ui.template.tagsCloud',["tau/core/templates-factory","tau/ui/templates/tagsCloud/ui.template.tagsCloud.item"],function(templates){var config={name:"tagsCloud",engine:"jqote2",markup:['<div class="tau-tags-cloud">',"<% if (this.showSearch) { %>",'<div class="tau-search-team">','<span class="tau-inline-group tau-search">','<input name="filter" type="text" class="tau-in-text" placeholder="Search Tag" tabindex="-1" />','<button type="button" class="tau-btn tau-search"></button>',"</span>","</div>","<% } %>",'<div class="tau-tags-cloud__inner">','<div class="tau-tags-cloud-items">','<%= fn.sub("tagsCloud.item", this.tags) %>',"</div>",'<div class="tau-tags-cloud__message" data-text-nofound="No such tag found" data-text-noitems="No available tags"></div>',"</div>","</div>"]};return templates.register(config)});
define('tau/components/component.tagsCloud',["tau/components/component.creator","tau/models/tagsCloud/model.tagsCloud","tau/ui/extensions/tagsCloud/ui.extension.tagsCloud.editable","tau/ui/extensions/tagsCloud/ui.extension.tagsCloud.filter","tau/ui/templates/tagsCloud/ui.template.tagsCloud"],function(Creator,Model,ExtensionEditable,ExtensionFilter,Template){return{create:function(config){var creatorConfig={extensions:[Model,ExtensionEditable,ExtensionFilter],template:Template};return Creator.create(creatorConfig,config)}}});
define('tau/ui/extensions/tagsEditor/ui.extension.tagsEditor.integration',["Underscore","tau/core/extension.base"],function(_,ExtensionBase){return ExtensionBase.extend({category:"edit","bus beforeInit":function(evt,initConfig){this.fire("configurator.ready",initConfig.config.context.configurator)},"bus afterRender":function(evt,renderData){this.fire("$el.ready",renderData.element)},"bus configurator.ready":function(evt,configurator){configurator.getComponentBusRegistry().getByName("tagsCloud").done(_.bind(function(bus){bus.removeAllListeners(this),bus.on("tag.toggled",_.bind(function(evt,tag){this.fire("tagsCloudTag.toggled",tag)},this),this),this.fire("tagsCloudBus.ready",bus)},this))},"bus componentsCreated":function(evt,componentsData){var buses=_.pluck(componentsData,"component"),tagsBus=buses[0],tagsCloudContainerBus=buses[1];this.fire("tagsBus.ready",tagsBus),this.fire("tagsCloudContainerBus.ready",tagsCloudContainerBus)},"bus $el.ready:last + tagsCloudContainerBus.ready":function(evt,$el,tagCloudContainerBus){var self=this;$el.on("click",".i-role-action-cloud",function(){$(this).toggleClass("tau-active"),$el.find(".i-role-tagscloudcontainer").toggleClass("tau-active"),self.cloudVisible||(self.cloudVisible=!0,tagCloudContainerBus.fire("refresh",{visible:!0}))})},"bus $el.ready:last + tagsBus.ready":function(evt,$el,tagsBus){var $tabheader=$el.find(".i-role-tabheader").detach().removeAttr("hidden");this.fire("$tabheader.ready",$tabheader),$el.find(".i-role-editor").append($tabheader),tagsBus.on("afterRender",function(el,renderData){$el.find(".i-role-editor").append($tabheader)}),$el.on("click",".i-role-editor :submit",function(){$el.find(".i-role-action-cloud").toggleClass("tau-active",!1),$el.find(".i-role-tagscloudcontainer").toggleClass("tau-active",!1)})},"bus tagsCloudBus.ready + tagsBus.ready":function(evt,tagsCloudBus,tagsBus){tagsCloudBus.removeAllListeners(this),tagsCloudBus.on("tag.toggled",_.bind(function(evt,tag){tagsBus.fire("external.toggleTag",tag)},this),this),tagsCloudBus.on("afterRender",_.bind(function(evt,renderData){this.fire("$cloudEl.ready",renderData.element)},this),this)},"bus $el.ready:last + $cloudEl.ready":function(evt,$el,$cloudEl){var hasFilter=$cloudEl.find("[name=filter]").length>0,$link=$el.find(".i-role-action-cloud");$link.toggleClass("tau-tags-cloud__trigger_filter_true",hasFilter)}})});
define('tau/ui/templates/tagsEditor/ui.template.tagsEditor',["tau/core/templates-factory"],function(templates){var config={name:"tagsEditor",engine:"jqote2",markup:['<div class="tau-container">','<div class="ui-tagsEditor">','<div class="tau-actions i-role-tabheaders i-role-tagslistcontainer">',"</div>",'<li class="i-role-tabheader ui-tags__action" hidden data-tab="tagsCloud">','<div class="tau-tags-cloud__trigger i-role-action-cloud" >',"<i>","Tags Cloud","</i>","</div>","</li>",'<div class="tau-tab-content">','<div class="tau-tab-pane i-role-tagscloudcontainer">',"</div>","</div>","</div>","</div>"]};return templates.register(config)});
define('tau/components/component.tagsEditor',["tau/components/component.creator","tau/views/view.container","tau/components/extensions/component.creator.extension","tau/ui/extensions/layout/ui.extension.layout","tau/ui/extensions/tagsEditor/ui.extension.tagsEditor.integration","tau/ui/templates/tagsEditor/ui.template.tagsEditor"],function(creator,ViewExtension,ComponentCreatorExtension,LayoutExtension,IntegrationExtension,Template){return{create:function(config){var creatorConfig={ViewType:ViewExtension,extensions:[ComponentCreatorExtension,LayoutExtension,IntegrationExtension],template:Template};return creator.create(creatorConfig,config)}}});
define('tau/models/team-members-editor/model.team-members-editor',["tau/core/extension.base","tau/ui/extensions/list/request/extension.requesters.tabs"],function(ExtensionBase,ExtensionFocus){return ExtensionBase.extend({"bus beforeInit":function(evt){this.fire("dataBind",{})},"bus afterRender":function(evt){var $action=evt.data.element.find("[role=action-add]"),bubbleConfig={actionOnBlur:"destroy",target:$action,alignTo:$action,componentsConfig:{components:[{type:"tabs",cssClass:"tau-tabs-small",extensions:[ExtensionFocus],tabs:[{label:"select",header:[{type:"label",text:"Select user"}],items:[{type:"finder.team-members"}],selected:!0}]}]}};this.fire("initBubble",bubbleConfig);var _empty=function(){$action.tauBubble("empty"),$action.data("bubbleLoaded",!1)};$action.bind("externalClose",_empty),$action.bind("close",_empty),$action.on("show",function(){var $popup=$action.tauBubble("widget");$popup.delegate("[role=action-cancel]","click",_empty)})},"bus beforeInit + $target.ready":function(evt,initConfig,$target){var store=initConfig.config.context.configurator.getStore();store.unbind(this),store.on({eventName:"afterSave",type:"team",listener:this},_.bind(function(){this.fire("refresh")},this))}})});
define('tau/ui/templates/team-members-editor/ui.template.team-members-editor',["tau/core/templates-factory"],function(templates){var config={name:"team-members-editor",engine:"jqote2",markup:["<div>",'<br /><button type="button" role="action-add" class="tau-button-add">Assign users</button>',"</div>"]};return templates.register(config)});
define('tau/components/component.team-members-editor',["tau/components/component.creator","tau/models/team-members-editor/model.team-members-editor","tau/components/extensions/bubble/extension.bubble.creator","tau/components/extensions/component.creator.extension","tau/ui/templates/team-members-editor/ui.template.team-members-editor"],function(Creator,Model,ExtensionBubble,ExtensionCreator,Template){return{create:function(externalConfig){var componentConfig={extensions:[Model,ExtensionBubble,ExtensionCreator],template:Template};return Creator.create(componentConfig,externalConfig)}}});
define('tau/components/component.teamiteration.progressBar',["tau/components/component.creator","tau/models/model.iteration.progressBar","tau/ui/templates/progressBar/ui.template.iteration.progressBar"],function(creator,ModelTeamIterationProgressBar,template){return{create:function(config){var creatorConfig={extensions:[ModelTeamIterationProgressBar],template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.testCaseList',["Underscore","tau/core/model-base","tau/utils/utils.date","tau/utils/utils.htmlConverter"],function(_,ModelBase,dateUtils,htmlConverter){function dataProcessor(model){this.model=model}dataProcessor.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},onAssignableRetrieved:function(result){var initData={labelAdd:this.model.config.labelAdd||"Add",items:[]};this.model.assignable=result.data;var testCases=_.sortBy(result.data.testCases,function(a){return a.numericPriority}),testCasesCount=testCases.length;for(var i=0;i<testCasesCount;i++)initData.items.push(this.convertServerDataModelData(testCases[i]));this.model.bus&&this.model.bus.fire("dataBind",initData)},convertServerDataModelData:function(serverData){var lastRunDate=null;serverData.lastRunDate&&(lastRunDate=dateUtils.format.datetime.short(serverData.lastRunDate));var lastRunStatus=undefined;serverData.lastStatus!=undefined&&(lastRunStatus={isPassed:serverData.lastStatus});var urlBuilder=this.config.context.configurator.getUrlBuilder(),data={__type:"testCase",id:serverData.id,name:serverData.name,lastRunDate:lastRunDate,applicationUrl:"#testcase/"+serverData.id,externalUrl:urlBuilder.getViewUrl(serverData.id),steps:htmlConverter.fromSourceToHtml(serverData.steps),success:htmlConverter.fromSourceToHtml(serverData.success)};return lastRunStatus&&(data.lastRunStatus=lastRunStatus),data}};var testCaseListModel=ModelBase.extend({onInit:function(){var self=this,processor=new dataProcessor(self),assignable=self.config.context.entity;this.store.get(assignable.entityType.name,{id:assignable.id,fields:["id",{testCases:["id","name","lastRunDate","lastStatus","steps","success","numericPriority"]}]},processor.getAssignableRetrievedCallback()).done()},"bus evictTestCases":function(){var assignable=this.config.context.entity;this.store.evictProperties(assignable.id,assignable.entityType.name,["testCases","testCases-count"])}});return testCaseListModel});
define('tau/models/model.testCaseList.editable',["tau/core/model.editable.base"],function(ModelBase){return ModelBase.extend({category:"edit",name:"Editable State","bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0})}})});
define('tau/components/extensions/testCaseList/extension.testCaseList.edit.addTestCase',["Underscore","jQuery","tau/components/extensions/component.extension.base","app.path"],function(_,$,ExtensionBase,appPath){return ExtensionBase.extend({"bus afterRender+permissionsReady":function(evtArgs){if(evtArgs.permissionsReady.data.editable){var $el=evtArgs.afterRender.data.element;$el.find(".tau-add-testCase").click($.proxy(this.addTestCaseClickHandler,this))}},addTestCaseClickHandler:function(){function showTestCaseEditor(){Ext.WindowMgr.zseed=9999999;var panel=new Tp.controls.TestCaseCreateEditorWindow({userStoryId:userStoryId,processId:context.getProcessId()});panel.show(),panel.on("saved",function(){self.fire("testCaseWasAdded",{assignable:{id:userStoryId}})})}var context=this.config.context,userStoryId=context.entity.id,self=this;if(!window.processConfigurations){var progress=window.progressDialog||{show:function(){},hide:function(){}};progress.show("Loading..."),Ext.Ajax.request({url:(new appPath.tp.WebServiceURL("/PageServices/TestCaseListService.asmx/GetProcessConfiguration")).toString(),headers:{"Content-Type":"application/json"},success:function(result){progress.hide();var processes=$.parseJSON(result.responseText).d;processConfigurations=processes,showTestCaseEditor()},jsonData:{userStoryId:userStoryId}})}else showTestCaseEditor()}})});
define('tau/components/extensions/testCaseList/extension.testCaseList.edit.runner',["Underscore","jQuery","tau/components/extensions/component.extension.base","app.path"],function(_,$,ExtensionBase,appPath){return ExtensionBase.extend({"bus dataBind":function(evt){this.data=evt.data},onAfterRender:function(){},"bus afterRender":function(evt){this.element=evt.data.element,this.onAfterRender()},"bus afterRender+permissionsReady":function(evtArgs){if(evtArgs.permissionsReady.data.editable){var $el=evtArgs.afterRender.data.element;$el.find(".last-run").removeClass("hidden"),$el.find(".buttons").removeClass("hidden"),$el.find(".passed").click($.proxy(this.passedClickHandler,this)),$el.find(".failed").click($.proxy(this.failedClickHandler,this))}},getTestCaseId:function(evt){return $(evt.target).parents("tbody").eq(0).tmplItem().data.id},passedClickHandler:function(evt){var testCaseId=this.getTestCaseId(evt);this.setTestCaseStatus(testCaseId,!0)},failedClickHandler:function(evt){var testCaseId=this.getTestCaseId(evt);this.setTestCaseStatus(testCaseId,!1)},setTestCaseStatus:function(testCaseId,status){Ext.Ajax.request({url:(new appPath.tp.WebServiceURL("/PageServices/TestCaseListService.asmx/ChangeRunState")).toString(),headers:{"Content-Type":"application/json"},success:this._onChangeStateComplete.createDelegate(this),failure:this._onChangeStateFailed.createDelegate(this),jsonData:{testCaseID:testCaseId,status:status}})},openNextTestCase:function(){var testCaseId=this.testCaseId,items=this.data.items;for(var i=0;i<items.length-1;i++)items[i].id===testCaseId&&this.fire("expandTestCase",{testCaseId:items[i+1].id});this.onAfterRender=function(){}},_onChangeStateComplete:function(result){this.testCaseId=$.parseJSON(result.responseText).d.TestCaseID,this.onAfterRender=this.openNextTestCase,this.fire("testCaseStateWasChanged")},_onChangeStateFailed:function(fatalError){this.fire("showError",{message:fatalError.get_message()})},destroy:function(){delete this.data,delete this.element}})});
define('tau/components/extensions/testCaseList/extension.testCaseList.refresher',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus testCaseWasAdded":function(evtArgs){this.fire("evictTestCases"),this.fire("refresh")},"bus testCaseStateWasChanged":function(evtArgs){this.fire("evictTestCases"),this.fire("refresh")}})});
define('tau/ui/templates/testCaseList/ui.template.testCaseList.testCase',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityLink"],function(templates){var config={name:"test-case-list-test-case",markup:['<tbody class="collapsed">',"   <tr>",'       <td class="toggler"><button class="extra-info expand" type="button"><div>+</div></button></td>','       <td class="testcase-id">','           {{tmpl($data) "entity-link"}}',"       </td>","       <td>${name}</td>","       <td>${lastRunDate}</td>","       <td>","{{if  lastRunStatus }}","   {{if lastRunStatus.isPassed === true}}",'       <span class="passed">Passed</span>',"   {{/if}}","   {{if lastRunStatus.isPassed === false}}",'       <span class="failed">Failed</span>',"   {{/if}}","{{/if}}",'       <td class="buttons hidden">','           <button class="passed green-button" type="button">Pass</button>','           <button class="failed  red-button" type="button">Fail</button>',"       </td>","</td>","   </tr>","   <tr>","       <td></td>",'       <td colspan="5">','           <div class="steps">',"               <h4>Steps</h4>","               <span>{{html steps}}</span>","           </div>",'           <div class="success">',"               <h4>Success</h4>","               <span>{{html success}}</span>","           </div>","       </td>","   </tr>","</tbody>"].join(""),dependencies:["entity-link"]};return templates.register(config)});
define('tau/ui/templates/testCaseList/ui.template.testCaseList',["tau/core/templates-factory","tau/ui/tags/ui.tag.term","tau/ui/templates/testCaseList/ui.template.testCaseList.testCase"],function(templates,termTag){var config={name:"test-case-list",options:{contentSelector:".ui-testCaseList-content"},tags:[termTag],markup:['<div class="ui-testCaseList">','   <div class="button-panel">','       <button class="tau-add-testCase" type="button">${labelAdd} {{term("TestCase") "name"}}</button>',"   </div>",'   <div class="ui-testCaseList-content"{{if items.length === 0}} style="display:none"{{/if}}>','       <table class="ui-testCaseList">',"           <colgroup>",'               <col class="toggler">','               <col class="id">','               <col class="name">','               <col class="last-run-date">','               <col class="last-status">','               <col class="last-run">',"           </colgroup>","           <thead>","               <tr>",'                   <th class="toggler">','                       <button class="extra-info expand" type="button"><div>+</div></button>','                        <button class="extra-info collapse" type="button"><div>-</div></button>',"                   </th>",'                   <th class="identificator">ID</th>',"                   <th>Name</th>","                   <th>Last Run Date</th>","                   <th>Last Status</th>",'                   <th class="last-run">Run</th>',"               </tr>","           </thead>",'           {{tmpl(items) "test-case-list-test-case"}}',"       </table>","   </div>","</div>"].join(""),dependencies:["test-case-list-test-case"]};return templates.register(config)});
define('tau/components/component.testCaseList',["tau/components/component.list.creator","tau/models/model.testCaseList","tau/models/model.testCaseList.editable","tau/components/extensions/testCaseList/extension.testCaseList.edit.addTestCase","tau/components/extensions/testCaseList/extension.testCaseList.edit.runner","tau/components/extensions/testCaseList/extension.testCaseList.refresher","tau/ui/templates/testCaseList/ui.template.testCaseList","tau/ui/extensions/testCaseList/ui.extension.testCaseList"],function(creator,ModelType,TestCaseEditableModel,AddTestCaseExtension,TestCaseRunnerExtension,RefresherTestCaseExtension,template,TestCaseListExtension){return{create:function(config){var creatorConfig={template:template,extensions:[ModelType,TestCaseEditableModel,TestCaseListExtension,config.addTestCaseExtension||AddTestCaseExtension,TestCaseRunnerExtension,RefresherTestCaseExtension],message:"No test cases found"};return creator.create(creatorConfig,config)}}});
define('tau/models/model.testCasesRunResults',["tau/core/model-base"],function(baseModel){var testCasesRunResultsModel=baseModel.extend({onInit:function(){var self=this,ctx=self.config.context,typeName=ctx.entity.entityType.name,entityId=ctx.entity.id;this.store.get(typeName,{id:entityId,fields:["passedCount","failedCount","notRunCount"]},{success:this.onDataRetrieved,scope:this}).done()},onDataRetrieved:function(result){var data=result.data,dataToBind={passedCount:data.passedCount,failedCount:data.failedCount,notRunCount:data.notRunCount};this.bus.fire("dataBind",dataToBind)}});return testCasesRunResultsModel});
define('tau/ui/templates/testCasesRunResults/ui.template.testCasesRunResults',["tau/core/templates-factory"],function(templates){var config={name:"test-cases-run-results",markup:['<div class="tau-testCasesRunResults">','   <div class="tau-testCasesRunResults-container">','       <span class="tau-testCasesRunResults-item tau-testCasesRunResults-passed">Passed: ${passedCount}</span>','       <span class="tau-testCasesRunResults-item tau-testCasesRunResults-failed">Failed: ${failedCount}</span>','       <span class="tau-testCasesRunResults-item tau-testCasesRunResults-notRun">Not Run: ${notRunCount}</span>',"   </div>","</div>"],dependencies:[]};return templates.register(config)});
define('tau/components/component.testCasesRunResults',["tau/components/component.creator","tau/models/model.testCasesRunResults","tau/ui/templates/testCasesRunResults/ui.template.testCasesRunResults"],function(creator,ModelType,template){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.timeList',["Underscore","tau/core/model-base","tau/utils/utils.date"],function(_,ModelBase,dateUtils){function getTimesOfEntityQueryConfig(id){return{id:id,fields:["id","name",{times:["id","date","spent","remain","description",{assignable:["id"]},{user:["id","firstName","lastName"]}]}]}}function getTimesOfTasksQueryConfig(id){var tasksConfig={id:id,fields:["id",{tasks:["id","name",{times:["id","date","spent","remain","description",{assignable:["id"]},{user:["id","firstName","lastName"]}]}]}],list:!0,nested:!0};return tasksConfig}function dataProcessor(model){this.model=model,this.times=[]}dataProcessor.prototype={getAssignableRetrievedCallback:function(){return{scope:this,success:this.onAssignableRetrieved}},getTaskRetrievedCallbackInfo:function(){return{scope:this,success:this.onTasksRetrieved}},getAllTasksRetrievedCallbackInfo:function(){return{scope:this,success:this.onAllTasksRetrieved}},onAssignableRetrieved:function(result){this.assignable=this.model.assignable=result.data;var assignable=this.model.assignable,times=assignable.times;this._addTimesToTimeArray(times,this.assignable)},onTasksRetrieved:function(result){_(result.data.tasks).each(function(task){task.__type="task"});var tasks=result.data.tasks;for(var i=0;i<tasks.length;i++)this._addTimesToTimeArray(tasks[i].times,tasks[i])},onAllTasksRetrieved:function(){var initialData={items:this.getTimes()};this.model.bus.fire("dataBind",initialData)},getTimesSortedByDate:function(){var times=[],timesCount=this.times.length;for(var i=0;i<timesCount;i++){var time=_(this.times[i]).clone();time.date=dateUtils.parse(time.date),times.push(time)}return times.sort(function(a,b){var dateDiff=b.date-a.date;return dateDiff!=0?dateDiff:b.id-a.id}),times},getTimes:function(){var times=[],actualTimes=this.getTimesSortedByDate(),timesCount=actualTimes.length;for(var i=0;i<timesCount;i++)times.push(this.convertServerDataModelData(actualTimes[i]));return times},convertServerDataModelData:function(serverData){var user=serverData.user,urlBuilder=this.model.config.context.configurator.getUrlBuilder();return{id:serverData.id,date:dateUtils.format.date.short(dateUtils.convertToTimezone(serverData.date)),spent:serverData.spent,remain:serverData.remain,description:serverData.description,person:[user.firstName,user.lastName].join(" "),workOn:{__type:serverData.workOn.__type,name:serverData.workOn.name},editUrl:urlBuilder.getEditUrl(serverData.id,"time")}},_addTimesToTimeArray:function(times,workOn){var cloneOfTimes=[];for(var i=0;i<times.length;i++){var timeClone=_(times[i]).clone();timeClone.workOn=workOn,cloneOfTimes.push(timeClone)}this.times=this.times.concat(cloneOfTimes)}};var timeListModel=ModelBase.extend({isUserStory:function(entityTypeName){return entityTypeName.toLowerCase()=="userstory"},onInit:function(){var processor=new dataProcessor(this),assignable=this.config.context.entity,id=assignable.id,entityTypeName=assignable.entityType.name,config=getTimesOfEntityQueryConfig(id),isUserStory=this.isUserStory(entityTypeName),storeChain=this.store;storeChain=storeChain.get(entityTypeName,config,processor.getAssignableRetrievedCallback());if(isUserStory){var tasksConfig=getTimesOfTasksQueryConfig(id);storeChain=storeChain.get(entityTypeName,tasksConfig,processor.getTaskRetrievedCallbackInfo())}storeChain.done(processor.getAllTasksRetrievedCallbackInfo())}});return timeListModel});
define('tau/models/model.timeList.editable',["Underscore","tau/components/extensions/component.extension.base"],function(_,ExtensionBase){var timeListModel=ExtensionBase.extend({category:"edit","bus beforeInit":function(){this.fire("permissionsReady",{editable:!0})}});return timeListModel});
define('tau/ui/templates/common/ui.template.entityIcon',["tau/core/templates-factory","tau/ui/tags/ui.tag.term"],function(templates,termTag){var config={tags:[termTag],name:"entity-icon",markup:['<em class="ui-type-icon ui-type-icon-${__type.toLowerCase()}">{{term(__type) "iconBig"}}</em>'],dependencies:[]};return templates.register(config)});
define('tau/ui/templates/timeList/ui.template.timeList.time',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityIcon"],function(templates){var config={name:"time-list-time",markup:["<tr>",'   <td class="date">${date}</td>','   <td class="spent">${spent} h</td>','   <td class="remain">${remain} h</td>','   <td class="description">${description}</td>','   <td class="work-on">','    {{tmpl(workOn) "entity-icon"}}',"    <span>${workOn.name}</span>","   </td>",'   <td class="person">${person}</td>','   <td class="edit-time hidden"><a href="${editUrl}">Edit</a></td>','   <td class="delete-time hidden"><button type="button" class="action-detach button small">Delete</button></td>',"</tr>"].join(""),dependencies:["entity-icon"]};return templates.register(config)});
define('tau/ui/templates/timeList/ui.template.timeList',["tau/core/templates-factory","tau/ui/templates/timeList/ui.template.timeList.time"],function(templates){var config={name:"time-list",options:{contentSelector:".time-list"},markup:['<div class="ui-timeList-content">','<table class="ui-table box time-list"{{if items.length === 0}} style="display:none"{{/if}}>',"<thead>",'   <tr class="head-row">','       <th class="header-cell">Date</th>','       <th class="header-cell">Time Spent</th>','       <th class="header-cell">Time Remain</th>','       <th class="header-cell">Description</th>','       <th class="header-cell">Work On</th>','       <th class="header-cell">Person</th>','       <th class="header-cell edit-time hidden"></th>','       <th class="header-cell delete-time hidden"></th>',"   </tr>","</thead>","<tbody>",'    {{tmpl(items) "time-list-time"}}',"</tbody>","</table>","</div>"].join(""),dependencies:["time-list-time"]};return templates.register(config)});
define('tau/components/extensions/timeList/extension.timeList.delete',["Underscore","jQuery","tau/components/extensions/component.extension.base"],function(_,$,ExtensionBase){return ExtensionBase.extend({"bus afterRender+permissionsReady+dataBind":function(evtArgs){if(evtArgs.permissionsReady.data.editable){var element=evtArgs.afterRender.data.element;element.find(".delete-time,.edit-time").removeClass("hidden"),element.find(".delete-time button").click($.proxy(this.onDeleteClick,this))}},"bus afterRemove":function(){this.fire("refresh")},onDeleteClick:function(evt){var timeId=$(evt.target).parents("tr").tmplItem().data.id;this.fire("remove",{id:timeId,typeName:"time"})}})});
define('tau/components/component.timeList',["tau/components/component.list.creator","tau/models/model.timeList","tau/models/model.timeList.editable","tau/ui/templates/timeList/ui.template.timeList","tau/components/extensions/timeList/extension.timeList.delete","tau/core/model.editable.base"],function(creator,ModelType,ModelEditable,template,DeleteTimeExtension,ModelEditableBase){return{create:function(config){var creatorConfig={ModelType:ModelType,template:template,extensions:[DeleteTimeExtension,ModelEditableBase,ModelEditable],message:"No time records found"};return creator.create(creatorConfig,config)}}});
define('tau/models/model.title',["tau/core/extension.base"],function(ModelBase){var Model=ModelBase.extend({"bus beforeInit":function(evt,initConfig){var context=initConfig.config.context,configurator=context.configurator,store=configurator.getStore(),entity=context.entity;store.unbind(this),store.on({eventName:"afterSave",type:entity.entityType.name,listener:this,filter:{id:entity.id},hasChanges:["name"]},_.bind(function(){this.fire("refresh")},this));var fields=["id","name"];store.get(entity.entityType.name,{id:entity.id,fields:fields}).done({success:_.bind(function(r){this.fire("data.ready",r[0].data)},this)})},"bus beforeInit+data.ready":function(evt,initConfig,data){var context=initConfig.config.context,configurator=context.configurator,entity=context.entity,dataToBind=_.pick(data,"id","name");dataToBind.entityType={name:entity.entityType.name.toLowerCase()},dataToBind.entity={name:data.name},dataToBind.url=configurator.getUrlBuilder().getNewViewUrl(dataToBind.id,dataToBind.entityType.name,!0),this.fire("dataBind",dataToBind)}});return Model});
define('tau/models/model.title.editable',["tau/core/model.editable.base","tau/utils/utils.jsonSchema"],function(ModelBase,jsonSchema){var editableTitleModel=ModelBase.extend({category:"edit",name:"Editable title",schema:jsonSchema.Schema.create({type:"object",properties:{name:{optional:!1,type:"string",maxLength:255,pre:["trim",function(){return _.trim(this.instance.name.replace(/\s+/gi," "))}],fallbacks:{maxLength:"truncateToMaxLength",optional:function(){}}}}}),"bus dataBind":function(){this.bus.fire("permissionsReady",{editable:!0,deletable:!0})},"bus validate":function(evt){var args=evt.data,data=args.cmd.$set;args.validation=this.schema.validate(data)}});return editableTitleModel});
define('tau/ui/extensions/title/ui.extension.title.editable',["tau/core/extension.base","tau/ui/behaviour/common/ui.behaviour.editableText"],function(ExtensionBase){return ExtensionBase.extend({category:"edit","bus changeName":function(evt){var name=evt.data||"";this.fire("save",{name:name})},"bus permissionsReady+afterRender":function(eventData,permissions,renderData){var self=this;if(permissions.editable){var $titleContainer=renderData.element,$entityTitle=$titleContainer.find(".i-role-title");this.$widget=$entityTitle,$entityTitle.editableText({restoreText:!0,onSave:function(text){self.fire("changeName",text)}})}},"bus validate":function(){if(!this.$widget)return;this.$widget.editableText("resetValidationErrors")},"bus afterValidate":function(evt){if(!this.$widget)return;this.$widget.editableText("setValue",evt.data.validation.instance.name)},"bus validationFailed":function(evt){if(!this.$widget)return;this.$widget.editableText("setValidationErrors",evt.data.validation.errors[0].description)}})});
define('tau/ui/templates/title/ui.template.title.main',["tau/core/templates-factory","tau/ui/templates/common/ui.template.entityIcon"],function(templates){var config={name:"title.main",markup:['<table class="ui-title ui-title_type_main">',"<tbody>","<tr>","<td>",'<div class="ui-title__info">','{{tmpl({__type:entityType.name}) "entity-icon"}}','<span class="entity-id"><a class="ui-link" href="${url}" data-target="new">#${id}</a></span>',"</div>","</td>","<td>",'<div class="ui-title__title i-role-title">',"${name}","</div>","</td>","</tr>","</tbody>","</table>"],dependencies:["entity-icon"]};return templates.register(config)});
define('tau/components/component.title',["tau/components/component.creator","tau/models/model.title","tau/models/model.title.editable","tau/ui/extensions/title/ui.extension.title.editable","tau/ui/templates/title/ui.template.title.main"],function(creator,Model,ModelEditable,ExtensionEditable,Template){return{create:function(config){config=config||{};var creatorConfig={extensions:[Model,ModelEditable,ExtensionEditable],template:config.template||Template};return creator.create(creatorConfig,config)}}});
define('tau/models/model.user.settings',["Underscore","tau/core/model.editable.base"],function(_,ModelBase){var UserSettingsModel=ModelBase.extend({onInit:function(){var config=this.config,userId=config.context.entity.id,self=this,loggedUser=config.context.applicationContext.loggedUser,isAdminOrLoggedUser=loggedUser.isAdministrator||loggedUser.id===userId;this.store.get("user",{id:userId,fields:["login","email","weeklyAvailableHours","isActive","isObserver","isAdministrator","activeDirectoryName"]}).done(function(result){self.fire("dataBind",_.extend(_.clone(result[0].data),{allowToEditAdmin:loggedUser.id!=userId&&loggedUser.isAdministrator,allowToEditObserver:loggedUser.isAdministrator,allowToEdit:isAdminOrLoggedUser}))})},"bus model.save":function(evt,data){var userId=this.config.context.entity.id,self=this;this.store.save("user",{id:userId,$set:_.extend(data,{id:userId})}).done(function(result){self.fire("refresh"),self.fire("model.data.changed",data)})}});return UserSettingsModel});
define('tau/ui/extensions/user.settings/ui.extension.user.settings',["Underscore","jQuery","tau/ui/extensions/ui.extension.domOperationsBase","tau/nls/translator","libs/jquery/jquery.inputMaskEditor"],function(_,$,ExtensionBase,T){return ExtensionBase.extend({init:function(){this._super.apply(this,arguments),this.onSaveProxy=_.bind(this.onSave,this),this.onDeleteProxy=_.bind(this.onDelete,this)},"bus afterRender":function(evt,afterRender){this.fire("view.update.state");var delimiter=this.config.context.applicationContext.culture.decimalSeparator,digitMask="^[0-9]*(["+delimiter+"][0-9]{0,2})?$";afterRender.element.find(".tau-weekly-hours").inputMaskEditor({mask:digitMask}),afterRender.element.on("submit",this.onSaveProxy),afterRender.element.find(".tau-btn.tau-delete").click(this.onDeleteProxy)},"bus afterRender:last+dataBind:last+view.state.updated":function(evt,afterRender,dataBind,viewState){var objectsAreEqual=!0;_.each(dataBind,function(value,key){viewState.hasOwnProperty(key)&&viewState[key]!=value&&(objectsAreEqual=!1)});if(viewState.password&&viewState.password.length>0||viewState.passwordConfirmation&&viewState.passwordConfirmation.length>0)objectsAreEqual=!1},"bus refresh>afterRender:last>model.data.changed":function(evt,refreshData,afterRender,changedData){var uiSelectorsByFieldName={login:".tau-login",email:".tau-email",weeklyAvailableHours:".tau-weekly-hours",activeDirectoryName:".tau-active-directory-name",isActive:".tau-is-active-container",isObserver:".tau-is-observer-container",isAdministrator:".tau-is-administrator-container",password:".tau-password,.tau-password-confirmation"};for(var key in uiSelectorsByFieldName)changedData[key]!==undefined&&this.fire("updateElement",{element:afterRender.element.find(uiSelectorsByFieldName[key])})},"bus afterRender:last+before_view.save.changes":function(evt,afterRender,viewState){viewState=this.getState(afterRender.element);var validationFormInfo=[],formHasError=!1,weeklyValidation={selector:".tau-weekly-hours",hasError:!1};validationFormInfo.push(weeklyValidation),_.isNaN(parseInt(viewState.weeklyAvailableHours))&&(weeklyValidation.hasError=formHasError=!0,weeklyValidation.message=T("Please provide weekly hours"));var loginValidation={selector:".tau-login",hasError:!1};validationFormInfo.push(loginValidation),viewState.login==""&&(loginValidation.hasError=formHasError=!0,loginValidation.message=T("Please enter login"));var emailValidation={selector:".tau-email",hasError:!1};validationFormInfo.push(emailValidation),viewState.email!=""?this.config.context.configurator.getConstObject().get("emailRegexp").test(_.trim(viewState.email))||(emailValidation.hasError=formHasError=!0,emailValidation.message=T("Invalid email address")):(emailValidation.hasError=formHasError=!0,emailValidation.message=T("Please enter email"));var activeDirectoryNameValidator={selector:".tau-active-directory-name",hasError:!1};validationFormInfo.push(activeDirectoryNameValidator);var activeDirectoryNameIsNotEmpty=viewState.activeDirectoryName&&viewState.activeDirectoryName.length>0;activeDirectoryNameIsNotEmpty&&!(new RegExp("^[A-Za-z0-9]+[\\\\][A-Za-z0-9]+$")).test(viewState.activeDirectoryName)&&(activeDirectoryNameValidator.hasError=formHasError=!0,activeDirectoryNameValidator.message=T("Invalid active directory user name"));var passwordValidation={selector:".tau-password",hasError:!1},passwordConfirmationValidation={selector:".tau-password-confirmation",hasError:!1};validationFormInfo.push(passwordValidation),validationFormInfo.push(passwordConfirmationValidation);var passwordInfoProvided=viewState.password&&viewState.password.length>0||viewState.passwordConfirmation&&viewState.passwordConfirmation.length>0,passwordAndConfirmationIsEqual=viewState.password===viewState.passwordConfirmation;passwordInfoProvided&&!passwordAndConfirmationIsEqual&&(passwordConfirmationValidation.hasError=passwordValidation.hasError=formHasError=!0,passwordConfirmationValidation.message=passwordValidation.message=T("Your password and confirmation password don't match")),_.each(validationFormInfo,function(info){var element=afterRender.element.find(info.selector);info.hasError?element.addClass("tau-error").attr("title",info.message):element.removeClass("tau-error").removeAttr("title")}),formHasError&&evt["before_view.save.changes"].cancelMain()},"bus dataBind:last+view.save.changes":function(evt,dataBind,viewState){var changes=this.getChanges(dataBind,viewState);this.fire("model.save",changes)},getChanges:function(data,currentState){var fields=["login","email","password","weeklyAvailableHours","isActive","isObserver","isAdministrator","activeDirectoryName"],changes={};return _.each(fields,function(key){(data[key]||"")!=currentState[key]&&(changes[key]=currentState[key])}),changes},onSave:function(e){return this.fire("view.save.changes",this.getState($(e.target))),!1},onDelete:function(){confirm(T("Do you really want to delete user?"))&&this.fire("remove",{id:this.config.context.entity.id})},getState:function(element){var password=element.find(".tau-password").val();return{login:element.find(".tau-login").val(),email:element.find(".tau-email").val(),password:password.length>0?password:undefined,passwordConfirmation:element.find(".tau-password-confirmation").val(),weeklyAvailableHours:element.find(".tau-weekly-hours").val(),activeDirectoryName:element.find(".tau-active-directory-name").val(),isAdministrator:element.find(".tau-is-admin").prop("checked"),isObserver:element.find(".tau-is-observer").prop("checked"),isActive:element.find(".tau-is-active").prop("checked")}}})});
define('tau/ui/templates/user.settings/ui.template.user.settings',["tau/core/templates-factory"],function(templates){var config={name:"user.settings",markup:["<form>",'<div class="tau-account-settings-container">','<div class="tau-account-settings">','<table class="tau-account-settings-data">',"<tbody>","<tr>","<td>","<label>","Login",'<input type="text" tabindex="1" class="tau-in-text tau-large tau-login" value="${login}" {{if (!allowToEdit )}} disabled="disabled"{{/if}}>',"</label>","</td>","<td>","<label>","Email",'<input type="text" tabindex="4" class="tau-in-text tau-large tau-email" value="${email}" {{if (!allowToEdit )}} disabled="disabled"{{/if}}>',"</label>","</td>","</tr>","<tr>","<td>","<label>","Password <small>(Type the new password if you want to change it)</small>",'<input tabindex="2" type="password" class="tau-in-text tau-large tau-password" {{if (!allowToEdit )}} disabled="disabled"{{/if}}>',"</label>","</td>","<td>","<label>","Active Directory User Name <small>(Ex: MyDomain\\Ted)</small>",'<input tabindex="5" type="text" class="tau-in-text tau-large tau-active-directory-name" value="${activeDirectoryName}" {{if (!allowToEdit )}} disabled="disabled"{{/if}}>',"</label>","</td>","</tr>","<tr>","<td>","<label>","Confirm Password",'<input type="password" tabindex="3" class="tau-in-text tau-large tau-password-confirmation" {{if (!allowToEdit )}} disabled="disabled"{{/if}}>',"</label>","</td>","<td>","<label>","Weekly Hours",'<input type="text" tabindex="6" class="tau-in-text tau-small tau-weekly-hours" value="${weeklyAvailableHours}" {{if (!allowToEdit )}} disabled="disabled"{{/if}} >',"</label>","</td>","</tr>","</tbody>","</table>",'<ul class="tau-account-settings-features">','<li class="tau-is-administrator-container {{if (!allowToEditObserver)}} tau-account-settings-features__item_disabled{{/if}}">','<label class="tau-checkbox">','<input tabindex="7" type="checkbox" class="tau-is-admin" {{if (isAdministrator )}} checked="checked"{{/if}} {{if (!allowToEditObserver)}} disabled="disabled"{{/if}} >',"<i></i>","<span>Administrator <small>(unlimited access)</small></span>","</label>","</li>",'<li class="tau-is-observer-container {{if (!allowToEditObserver )}} tau-account-settings-features__item_disabled{{/if}}">','<label class="tau-checkbox ">','<input tabindex="8" type="checkbox" class="tau-is-observer"{{if (isObserver )}} checked="checked"{{/if}} {{if (!allowToEditObserver )}} disabled="disabled"{{/if}}>',"<i></i>","<span>Observer <small>(read-only access)</small></span>","</label>","</li>",'<li class="tau-is-active-container {{if (!allowToEditObserver )}} tau-account-settings-features__item_disabled{{/if}}">','<label class="tau-checkbox ">','<input tabindex="9" type="checkbox" class="tau-is-active" {{if (isActive )}} checked="checked"{{/if}} {{if (!allowToEditObserver)}} disabled="disabled"{{/if}}>',"<i></i>","<span>Active <small>(deactivate if you want to free up a license for an active user)</small></span>","</label>","</li>","</ul>",'<button tabindex="10" class="tau-btn tau-primary tau-update" {{if (!allowToEdit )}} disabled="disabled"{{/if}} type="submit">Update Settings</button>','<button tabindex="11" class="tau-btn tau-danger tau-delete" {{if (!allowToEditAdmin)}} disabled {{/if}} type="button">Delete User</button>',"</div>","</div>","</form>"].join("")};return templates.register(config)});
define('tau/components/component.user.settings',["tau/components/component.creator","tau/models/model.user.settings","tau/ui/extensions/user.settings/ui.extension.user.settings","tau/ui/templates/user.settings/ui.template.user.settings"],function(creator,ModelUserSettings,UserExtension,template){return{create:function(config){var creatorConfig={name:"avatar",extensions:[ModelUserSettings,UserExtension],template:template};return config["queue.bus"]=!0,creator.create(creatorConfig,config)}}});
define('tau/models/model.userList',["Underscore","tau/store/types","tau/core/model-base","tau/utils/utils.textsearch"],function(_,tauTypes,EditableBase,TextSearch){return EditableBase.extend({init:function(){this._super.apply(this,arguments),this.textSearch=new TextSearch},"bus setFilter":function(evtArgs){this.config.data.filter=evtArgs.data.filter,this.fire("refresh",{refreshSelector:".user-list,.footer-box"})},setShowMore:function(showMore){this.config.data.showMore=showMore},"bus showMore":function(){this.setShowMore(!0),this.fire("refresh",{refreshSelector:".user-list,.footer-box"})},onInit:function(){this.fire("registerStoreRequest"),this.fire("commitTransaction",{})},"bus projectMembersReady+excludedUserReady+projectRolesReady":function(evtArgs){var projectMembers=evtArgs.projectMembersReady.data,excludedUser=evtArgs.excludedUserReady.data,roles=evtArgs.projectRolesReady.data,groups=[],headerActions=[];!this.excludedUsersContainsLoggedUser(excludedUser)&&this.loggedUserInProjectTeam(projectMembers)&&(headerActions=[{id:"assign-to-me",title:"Assign To Me"}]),this.filterIsNotEmpty()?groups=this.getFilteredGroups(roles,projectMembers,excludedUser):(groups=this.getGroups(projectMembers,excludedUser,roles),groups.length==0&&(this.setShowMore(!0),groups=this.getGroups(projectMembers,excludedUser,roles)));var data={headerActions:headerActions,moreAvailable:!1,groups:groups};this.fire("extendDataToBind",data),this.fire("dataBind",data)},getGroups:function(projectMembers,excludedUsers,roles){var groups=[];for(var i=0;i<roles.length;i++){var role=roles[i];if(this.usersForRoleIsVisible(role)){var usersForRole=this.getUsersForRole(role,projectMembers,excludedUsers);usersForRole.length>0&&groups.push({role:role,users:usersForRole})}}return groups},isStringValidForFilter:function(value){return this.textSearch.match(value,this.config.data.filter)!==null},getFilteredGroups:function(roles,projectMembers,excludedUsers){var groups=[];for(var roleIndex=0;roleIndex<roles.length;roleIndex++){var role=roles[roleIndex],usersForRole=[];usersForRole=this.getUsersForRole(role,projectMembers,excludedUsers);var filteredUsers=[];for(var userIndex=0;userIndex<usersForRole.length;userIndex++)this.isStringValidForFilter(usersForRole[userIndex].name)&&filteredUsers.push(usersForRole[userIndex]);usersForRole=filteredUsers,usersForRole.length>0&&groups.push({role:role,users:usersForRole})}return groups},usersForRoleIsVisible:function(role){var data=this.config.data||{};if(this.isMoreAvailable()){if(data.hasOwnProperty("roleId"))return data.roleId===role.id;if(data.role)return role.id==data.role.id}return!0},userIsNotExcluded:function(currentTeam,excludedUser){if(!currentTeam.user.isActive)return!1;var userId=currentTeam.user.id;if(excludedUser.constructor!=Array)return userId!=excludedUser.id;for(var i=0;i<excludedUser.length;i++)if(userId==excludedUser[i].id)return!1;return!0},getUsersForRole:function(role,projectMembers,excludedUser){var usersInRole=[];for(var i=0;i<projectMembers.length;i++){var currentTeam=projectMembers[i];currentTeam.role.id==role.id&&this.userIsNotExcluded(currentTeam,excludedUser)&&usersInRole.push(this.convertUser(currentTeam.user))}return usersInRole.sort(function(a,b){var nameA=a.name.toLowerCase(),nameB=b.name.toLowerCase();return nameA<nameB?-1:nameA>nameB?1:0}),usersInRole},convertUser:function(user){var username=_.trim(user.email);if(user.firstName||user.lastName)username=_.trim([user.firstName,user.lastName].join(" "));var configurator=this.config.context.configurator;return{id:user.id,name:username,role:user.role,avatar:[configurator.getApplicationPath(),"/Avatar.ashx?UserId=",user.id,"&size=32"].join("")}},getLoggedUser:function(){return this.config.context.configurator.getLoggedUser()||this.config.context.getLoggedUser()},loggedUserInProjectTeam:function(projectMembers){var loggedUser=this.getLoggedUser();return _.any(projectMembers,function(projectMember){return projectMember.user.id===loggedUser.id})},excludedUsersContainsLoggedUser:function(excludedUser){var loggedUser=this.getLoggedUser();for(var i=0;i<excludedUser.length;i++)if(excludedUser[i].id===loggedUser.id)return!0;return!1},filterIsNotEmpty:function(){return this.config.data.filter&&this.config.data.filter.length},filterIsEmpty:function(){return!this.filterIsNotEmpty()},isMoreAvailable:function(){var data=this.config.data;return this.filterIsEmpty()&&data.showMore!==!0&&(data.hasOwnProperty("roleId")||data.hasOwnProperty("role"))},destroy:function(){this.project=null,this.entity=null,this._super()}})});
define('tau/models/extensions/team/extension.model.teamOfEntityRetriever',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({"bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}},refs=this.config.context.configurator.getStore().config.proxy.types[entity.entityType.name].refs,fields=[{project:["id"]}];refs.team&&fields.push({team:["id"]}),this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:fields},callback:{scope:this,success:function(res){this.fire("teamOfEntityRetriever",res),this.fire("commitTransaction")}}})},"bus teamOfEntityRetriever":function(evtArgs){var entity=this.config.context.entity||{entityType:{name:""}},entityType=entity.entityType.name.toLowerCase(),projectId=null,teamId=null,data=evtArgs.data.data;data.project?projectId=data.project.id:entityType==="project"&&(projectId=data.id),data.team?teamId=data.team.id:entityType==="team"&&(teamId=data.id);var f=[],fire=_.bind(this.fire,this);projectId&&f.push(function(next){fire("get",{type:"project",query:{id:projectId,fields:["id",{projectMembers:[{user:["id","firstName","lastName","isActive","email"]},{role:["id","name"]}]}]},callback:{success:function(res){next(!1,res.data.projectMembers)}}})}),teamId&&f.push(function(next){fire("get",{type:"team",query:{id:teamId,fields:["id",{teamMembers:[{user:["id","firstName","lastName","email","isActive"]},{role:["id","name"]}]}]},callback:{success:function(res){next(!1,res.data.teamMembers)}}})});var self=this;_.parallel(f,function(err,res){var members=_.flatten(res,!0);members=_.uniq(members,!1,function(u){return u.user.id}),_.forEach(members,function(member){member.username=member.email;if(member.firstName||member.lastName)member.username=_.trim([member.firstName,member.lastName].join(" "))}),fire("projectMembersReady",members);var roles=self.getRoles(members);fire("projectRolesReady",roles)})},getRoles:function(projectMembers){var roleIds={},roles=[];return _.each(projectMembers,function(projectMember){var role=projectMember.role;roleIds.hasOwnProperty(role.id)||(roleIds[role.id]=!0,roles.push(role))}),roles}})});
define('tau/models/userList/extension.model.assignmentsUser.Excluder',["Underscore","tau/core/model-base"],function(_,EditableBase){return EditableBase.extend({"bus registerStoreRequest":function(){var entity=this.config.context.entity||{entityType:{}},roleType={role:["id","name"]},userType={generalUser:["id","firstName","lastName"]};this.fire("get",{type:entity.entityType.name,query:{id:entity.id,fields:[{assignments:["id",roleType,userType],list:!0}]},callback:{scope:this,success:this.onEntityRetrieved}})},"bus assignmentsUserExluder":function(evtArgs){var data=this.config.data||{},entity=evtArgs.data.data,excludedUsers=[],roleId=data.roleId||(data.role||{}).id;if(roleId){var assignments=entity.assignments||[];for(var i=0;i<assignments.length;i++)assignments[i].role.id==roleId&&excludedUsers.push(assignments[i].generalUser)}this.fire("excludedUserReady",excludedUsers)},onEntityRetrieved:function(evtArgs){this.fire("assignmentsUserExluder",evtArgs)}})});
define('tau/components/extensions/userList/extension.userList.editable',["Underscore","jQuery","tau/core/extension.base.stateful","tau/ui/behaviour/common/ui.behaviour.listSelectable"],function(_,$,ExtensionBase){return ExtensionBase.extend({category:"edit",name:"user list","bus initialize + afterRender":function(evt,initConfig,renderData){var $element=renderData.element;$element.delegate(".unassign-button","click",_.bind(this.onUnassignClick,this)),$element.delegate(".assign-to-me-button","click",_.bind(this.onAssignToMeClick,this)),$element.delegate(".user-search-box","keyup",_.bind(this.onFilterChanged,this)),$element.delegate(".user","click",_.bind(this.onUserClick,this)),$element.delegate(".more-link","click",_.bind(this.onMoreClick,this))},"bus afterRender":function(evt,renderData){var $element=renderData.element,$list=$element.find("[role=list]");$list.listSelectable({items:".user",className:"user_hover",keyboardManager:this.config.context.configurator.getKeyBoardManager()}),this.fire("$listSelectable.ready",$list)},"bus $listSelectable.ready:last+afterRender:last+focus":function(evt,$list,renderData){var $element=renderData.element;$list.listSelectable("enable"),$element.find(".user-search-box").focus()},"bus $listSelectable.ready:last+blur":function(evt,$list){$list.is(":visible")&&$list.listSelectable("disable")},onMoreClick:function(evt){evt.stopPropagation(),this.fire("showMore")},onUserClick:function(evt){var $target=$(evt.target),data=$target.tmplItem().data;this.fire("changeAssignment",{user:data})},onUnassignClick:function(){this.fire("removeAssignment")},onAssignToMeClick:function(){this.fire("assignToLoggedUser")},onFilterChanged:function(evt){if(evt.keyCode==$.ui.keyCode.DOWN||evt.keyCode==$.ui.keyCode.UP||evt.keyCode==$.ui.keyCode.ENTER)return;evt.preventDefault(),this.fire("setFilter",{filter:$(evt.target).val()})}})});
define('tau/ui/templates/filteredUserList/ui.template.filteredUserList.userList',["tau/core/templates-factory","tau/ui/templates/common/ui.template.user"],function(templates){var config={name:"user-list",markup:'<div class="role-title" role="user-group">${role.name}</div>{{tmpl(users) "user"}}',dependencies:["user"]};return templates.register(config)});
define('tau/ui/templates/common/ui.template.linkAction',["tau/core/templates-factory"],function(templates){var config={name:"link-action",markup:['<a class="${id}-link user-action" >',"   ${title}","</a>"].join("")};return templates.register(config)});
define('tau/ui/templates/filteredUserList/ui.template.filteredUserList',["tau/core/templates-factory","tau/ui/templates/filteredUserList/ui.template.filteredUserList.userList","tau/ui/templates/common/ui.template.buttonAction","tau/ui/templates/common/ui.template.linkAction"],function(templates){var config={name:"filtered-user-list",markup:['<div class="filtered-user-list">','<div class="header-box">','{{tmpl(headerActions) "button-action"}}',"</div>",'<div class="search-box-container">','<input type="text" class="user-search-box" />','<div class="help">For filter start typing name</div>',"</div>",'<div role="list" class="user-list i-user-list">','<div class="i-inner">{{tmpl(groups) "user-list"}}</div>',"</div>",'<div class="footer-box">','<a class="more-link ',"{{if moreAvailable == false}}","link-hidden","{{/if}}",'" >',"more...","</a>","</div>","</div>"],dependencies:["user-list","button-action","link-action"]};return templates.register(config)});
define('tau/components/component.userList',["Underscore","tau/components/component.creator","tau/models/model.userList","tau/models/assignmentsList/extension.model.store.operations","tau/models/extensions/team/extension.model.teamOfEntityRetriever","tau/models/userList/extension.model.assignmentsUser.Excluder","tau/components/extensions/userList/extension.userList.editable","tau/ui/extensions/bubble/ui.extension.bubble.listResizer","tau/ui/templates/filteredUserList/ui.template.filteredUserList"],function(_,creator,ModelType,StoreOperations,TeamOfEntityRetriever,AssignmentsUserExcluder,EditableUserList,ListExtension,template){return{create:function(config){var extensions=[];_.isArray(config.extensions)&&(extensions=_.clone(config.extensions));var creatorConfig={extensions:extensions,template:template};return extensions.push(ModelType),extensions.push(EditableUserList),extensions.push(StoreOperations),extensions.push(config.Retriever||TeamOfEntityRetriever),extensions.push(config.UserExcluder||AssignmentsUserExcluder),extensions.push(ListExtension),creator.create(creatorConfig,config)}}});
require(["tracking/tauspy","tau/components/component.additionalInfo","tau/components/component.application.generic","tau/components/component.application","tau/components/component.application.old","tau/components/component.assignedEffort","tau/components/component.assignmentsList","tau/components/component.attachments","tau/components/component.attachmentsPreview","tau/components/component.auditHistory","tau/components/component.avatar.editor","tau/components/component.avatar","tau/components/component.board.add","tau/components/component.board.cell.quick.add","tau/components/component.board.clipboard","tau/components/component.board.clone","tau/components/component.board.collapser.aside","tau/components/component.board.container","tau/components/component.board.context.filter","tau/components/component.board.editor.access","tau/components/component.board.editor.container","tau/components/component.board.editor.customize","tau/components/component.board.editor.encoding","tau/components/component.board.editor","tau/components/component.board.editor.prioritization","tau/components/component.board.editor.remember.context","tau/components/component.board.entityViewer","tau/components/component.board.flowHelp","tau/components/component.board.general.quick.add","tau/components/component.board.header","tau/components/component.board.limits","tau/components/component.board.main.menu","tau/components/component.board.overview","tau/components/component.board.owner","tau/components/component.board.paging","tau/components/component.board.plus.base","tau/components/component.board.plus","tau/components/component.board.plus.list","tau/components/component.board.plus.newlist","tau/components/component.board.plus.timeline","tau/components/component.board.selector","tau/components/component.board.startScreen","tau/components/component.board.templates.editor","tau/components/component.board.templates.selector","tau/components/component.board.toolbar","tau/components/component.board.tools.container","tau/components/component.board.tools.switcher","tau/components/component.board.zoomLevel","tau/components/component.breadcrumbs","tau/components/component.bubble.container","tau/components/component.button","tau/components/component.buttonGroup","tau/components/component.collapsible","tau/components/component.collapsibleHeader","tau/components/component.comment","tau/components/component.comment.new.editor","tau/components/component.commentList","tau/components/component.comments","tau/components/component.container","tau/components/component.creator","tau/components/component.customField.checkbox","tau/components/component.customField.date","tau/components/component.customField.dropdown","tau/components/component.customField.dropdown.list","tau/components/component.customField.entity","tau/components/component.customField.multipleEntities","tau/components/component.customField.multiselect","tau/components/component.customField.multiselect.list","tau/components/component.customField.number","tau/components/component.customField.richtext","tau/components/component.customField.templatedurl","tau/components/component.customField.text","tau/components/component.customField.url.editor","tau/components/component.customField.url","tau/components/component.description","tau/components/component.diagnostics.globalListeners","tau/components/component.diagnostics","tau/components/component.diagnostics.store","tau/components/component.duplicateBugList","tau/components/component.duplicateBugListPanel","tau/components/component.editor.requester","tau/components/component.editor.team-member","tau/components/component.entity.actions","tau/components/component.entity.quickAdd","tau/components/component.entity.quickAddTrigger","tau/components/component.entityStateList","tau/components/component.feature.assignmentList","tau/components/component.feature.totalEffort","tau/components/component.field.richText","tau/components/component.finder.entity","tau/components/component.finder","tau/components/component.finder.project.byTeam","tau/components/component.finder.project.byUser","tau/components/component.finder.requesters","tau/components/component.finder.team.byProject","tau/components/component.finder.team.byUser","tau/components/component.impedimentList","tau/components/component.impedimentListPanel","tau/components/component.implementationHistory","tau/components/component.inviter","tau/components/component.iteration.progressBar","tau/components/component.label.duplicateBugCount","tau/components/component.label.impedimentsCount","tau/components/component.label","tau/components/component.label.relations","tau/components/component.leadCycleTime","tau/components/component.list.baseInfo","tau/components/component.list.creator","tau/components/component.list.editable","tau/components/component.list","tau/components/component.lookswitcher","tau/components/component.master.board","tau/components/component.master.empty","tau/components/component.menu.actions","tau/components/component.menu.actions.testplanrun","tau/components/component.menu.testPlanRun","tau/components/component.page.base","tau/components/component.page.board","tau/components/component.page.entity","tau/components/component.page.reports","tau/components/component.page.search","tau/components/component.pluginsList","tau/components/component.print","tau/components/component.progressBar","tau/components/component.progressBar.small","tau/components/component.property.abbreviation","tau/components/component.property.assignable","tau/components/component.property.bool","tau/components/component.property.build","tau/components/component.property.build.testPlanRun","tau/components/component.property.buildDate","tau/components/component.property.color","tau/components/component.property.company","tau/components/component.property.completeDate","tau/components/component.property.createDate","tau/components/component.property.date","tau/components/component.property.effort","tau/components/component.property.email","tau/components/component.property.endDate","tau/components/component.property.endDate.list","tau/components/component.property.endDate.project","tau/components/component.property.entityState","tau/components/component.property.feature","tau/components/component.property.icon","tau/components/component.property.impedimentDate","tau/components/component.property.initialEstimate","tau/components/component.property.isActive","tau/components/component.property.isPrivate","tau/components/component.property.isProduct","tau/components/component.property.iteration","tau/components/component.property","tau/components/component.property.lastFailureComment","tau/components/component.property.lastRunDate","tau/components/component.property.lastRunDate.list","tau/components/component.property.lastStatus","tau/components/component.property.owner","tau/components/component.property.owner.project","tau/components/component.property.owner.request","tau/components/component.property.password","tau/components/component.property.priority","tau/components/component.property.process","tau/components/component.property.program","tau/components/component.property.project","tau/components/component.property.relationType","tau/components/component.property.release","tau/components/component.property.requestSource","tau/components/component.property.requestType","tau/components/component.property.responsible","tau/components/component.property.role","tau/components/component.property.role.modern","tau/components/component.property.severity","tau/components/component.property.startDate","tau/components/component.property.startDate.project","tau/components/component.property.status.testCaseRun","tau/components/component.property.team","tau/components/component.property.teamIteration","tau/components/component.property.testPlan","tau/components/component.property.text","tau/components/component.property.time","tau/components/component.property.timeInterval","tau/components/component.property.user","tau/components/component.property.userStory","tau/components/component.property.velocity","tau/components/component.quick.add","tau/components/component.redirect","tau/components/component.relations.add.popup","tau/components/component.relations.container","tau/components/component.release.assignedEffort","tau/components/component.release.progressBar","tau/components/component.releaseNotes","tau/components/component.requestList","tau/components/component.revisionList","tau/components/component.search.filter","tau/components/component.search.input","tau/components/component.search","tau/components/component.state-list","tau/components/component.steps","tau/components/component.success","tau/components/component.tabs","tau/components/component.tabsHeader","tau/components/component.tags","tau/components/component.tagsCloud","tau/components/component.tagsEditor","tau/components/component.team-members-editor","tau/components/component.teamiteration.progressBar","tau/components/component.testCaseList","tau/components/component.testCasesRunResults","tau/components/component.timeList","tau/components/component.title","tau/components/component.user.settings","tau/components/component.userList","tau/components/extensions/print.convert.extension"],function(){return{}});
define("all.components", function(){});
